#! /bin/bash

build=""
if [[ $1 != "" ]];then
  build=".$1"
fi

# fail fast
set euo -pipefail

. ../config

# Test eventstore
testCommand="for i in {1..10}; do curl -S http://localhost:2113/web/index.html && break; sleep 1; if [[ \$i == 10 ]];then false;fi; done"
docker run -t         \
  --net=host          \
  $testtoolsContainer \
  bash -c "$testCommand"

if [[ $? != 0 ]];then
  echo "Eventstore test as fail"
  exit 1
fi

# smoke tests
echo " "

# TODO Reenable when test runner is fixed: https://github.com/xunit/xunit/issues/848
echo "Skipping tests - current xunit test runner does not work"
# echo "Starting local tests ..."
# docker run                           \
#   --net=host $serversContainer$build \
#   bash -c "dotnet test --configuration Release -p Adaptive.ReactiveTrader.Server.IntegrationTests -parallel none" # TODO UPDATE
