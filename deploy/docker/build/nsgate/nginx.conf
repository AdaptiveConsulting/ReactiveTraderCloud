daemon off;

worker_processes  1;

pid               /var/run/nginx.pid;

events {
  worker_connections  1024;
}

http {

  include                         /etc/nginx/mime.types;
  sendfile                        on;
  default_type                    application/octet-stream;

  server_names_hash_bucket_size   128;

  server {
    server_name _;
    root        /www/404;
    expires     1M;

    error_page 404 /404.html;

    log_format upstreamlog
      '=======================================================\n'
      'nsgate-version             __NSGATE_VERSION__\n'
      'nsgate-config              404\n'
      'date_gmt                   \$date_gmt\n'
      'cookie_                    \$cookie_\n'
      'host                       \$host\n'
      'hostname                   \$hostname\n'
      'proxy_add_x_forwarded_for  \$proxy_add_x_forwarded_for\n'
      'proxy_host                 \$proxy_host\n'
      'proxy_port                 \$proxy_port\n'
      'query_string               \$query_string\n'
      'realip_remote_addr         \$realip_remote_addr\n'
      'realip_remote_port         \$realip_remote_port\n'
      'realpath_root              \$realpath_root\n'
      'remote_addr:               \$remote_addr\n'
      'remote_port:               \$remote_port\n'
      'remote_user:               \$remote_user\n'
      'request:                   \$request\n'
      'request_body:              \$request_body\n'
      'request_id:                \$request_id\n'
      'scheme                     \$scheme\n'
      'server_addr:               \$server_addr\n'
      'server_name:               \$server_name\n'
      'server_port:               \$server_port\n'
      'server_protocol:           \$server_protocol\n'
      'session_log_binary_id      \$session_log_binary_id\n'
      'session_log_id             \$session_log_id\n'
      'status:                    \$status\n'
      'upstream_addr:             \$upstream_addr\n'
      ;
    error_log       /dev/stderr upstreamlog;
    access_log      /dev/stdout upstreamlog;

    location / {
        add_header  X-ReactiveTraderCloud-Proxy-NsGate-Config   '404';
        add_header  X-ReactiveTraderCloud-Proxy-NsGate-Version  "__NSGATE_VERSION__";

        index   index.html;
        rewrite ^/(.*)/$ /$1 permanent;
        try_files "${uri}.html" $uri $uri/ =404;
    }

    location = /404.html {
        internal;
    }
  }

  include /servers/*;
}