!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("tick42-glue",[],t):"object"==typeof exports?exports["tick42-glue"]=t():e["tick42-glue"]=t()}(this,function(){return function(e){function __webpack_require__(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,__webpack_require__),i.l=!0,i.exports}var t={};return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=69)}([function(e,t,n){"use strict";function createRegistry(e){function add(e,t){var i=n[e];return i||(i=[],n[e]=i),i.push(t),function(){var i=n[e];i&&(i=i.reduce(function(e,n,i){return n===t&&e.length===i||e.push(n),e},[]),n[e]=i)}}function execute(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var r=n[e];if(!r||0===r.length)return[];var o=[];return r.forEach(function(n){try{var i=n.apply(undefined,t);o.push(i)}catch(t){o.push(undefined),_handleError(t,e)}}),o}function _handleError(n,i){var r=n instanceof Error?n:new Error(n);if(t)return void t(r);var o='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+r.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}function clear(){n={}}function clearKey(e){n[e]&&delete n[e]}if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,n={};return{add:add,execute:execute,clear:clear,clearKey:clearKey}}createRegistry["default"]=createRegistry,e.exports=createRegistry},function(e,t,n){"use strict";function isNumber(e){return"number"==typeof e}function isString(e){return"string"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isArray(e){return Array.isArray?Array.isArray(e):"[object Array]"===toString.call(e)}function isUndefined(e){return void 0===e}function isUndefinedOrNull(e){return!e||void 0===e}function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function isFunction(e){return!!(e&&e.constructor&&e.call&&e.apply)}function some(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n))return!0;return!1}function first(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n))return e[n];return undefined}function ifNotUndefined(e,t){void 0!==e&&t(e)}function promisify(e,t,n){if("function"!=typeof t&&"function"!=typeof n)return e;"function"!=typeof t?t=function(){}:"function"!=typeof n&&(n=function(){}),e.then(t,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.isNumber=isNumber,t.isString=isString,t.isObject=isObject,t.isArray=isArray,t.isUndefined=isUndefined,t.isUndefinedOrNull=isUndefinedOrNull,t.isEmpty=isEmpty,t.isFunction=isFunction,t.some=some,t.first=first,t.ifNotUndefined=ifNotUndefined,t.promisify=promisify},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function EntityEvent(e,t){this.entity=e,this.context=t}return EntityEvent}();t.EntityEvent=r;var o=function(){function EntityEventContext(e){this.type=e}return EntityEventContext}();t.EntityEventContext=o;var a=function(e){function ActivityStatusChangeEventContext(t,n){var i=e.call(this,c.StatusChange)||this;return i.newStatus=t,i.oldStatus=n,i}return i(ActivityStatusChangeEventContext,e),ActivityStatusChangeEventContext}(o);t.ActivityStatusChangeEventContext=a;var s=function(e){function ActivityContextChangedEventContext(t,n,i){var r=e.call(this,c.ActivityContextChange)||this;return r.context="string"==typeof t?JSON.parse(t):t,r.updated=n,r.removed=i,r}return i(ActivityContextChangedEventContext,e),ActivityContextChangedEventContext}(o);t.ActivityContextChangedEventContext=s;var c=function(){function EntityEventType(){}return EntityEventType.Added="added",EntityEventType.Removed="removed",EntityEventType.Updated="updated",EntityEventType.Closed="closed",EntityEventType.StatusChange="statusChange",EntityEventType.ActivityContextChange="activityContextUpdate",EntityEventType.ActivityWindowEvent="activityWindowEvent",EntityEventType.ActivityWindowJoinedActivity="joined",EntityEventType.ActivityWindowLeftActivity="left",EntityEventType}();t.EntityEventType=c;var u=function(){function ActivityState(){}return ActivityState.Created="created",ActivityState.Started="started",ActivityState.Destroyed="destroyed",ActivityState}();t.ActivityState=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=function(){function WindowStore(){this.waitForTimeoutInMilliseconds=6e4,this._windows={},this._pendingWindows={},this._pendingWindowsStates={},this._registry=i()}return WindowStore.prototype.init=function(e){this._logger=e},WindowStore.prototype.get=function(e){return this._windows[e]||this._pendingWindows[e]},WindowStore.prototype.getIfReady=function(e){return this._windows[e]},Object.defineProperty(WindowStore.prototype,"list",{get:function(){return this._windows},enumerable:!0,configurable:!0}),WindowStore.prototype.add=function(e){if(!!this._pendingWindows[e.API.id])return void this._logger.error("trying to add window with id "+e.API.id+" from windowStore, which already exists");var t="remote"===e.API.windowType;this._pendingWindows[e.API.id]=e,this._pendingWindowsStates[e.API.id]={ready:!1,urlChanged:t},this._registry.execute("on-added",e)},WindowStore.prototype.remove=function(e){delete this._windows[e.API.id],delete this._pendingWindows[e.API.id],delete this._pendingWindowsStates[e.API.id],this._registry.execute("on-removed",e)},WindowStore.prototype.setReadyState=function(e){var t=this._pendingWindowsStates[e];void 0!==t&&(t.ready=!0,t.urlChanged&&this.markReadyToShow(e))},WindowStore.prototype.setUrlChangedState=function(e){var t=this._pendingWindowsStates[e];void 0!==t&&(t.urlChanged=!0,t.ready&&this.markReadyToShow(e))},WindowStore.prototype.waitFor=function(e){var t=this;return new Promise(function(n,i){var r,o=setTimeout(function(){r(),i("waitFor timed out.")},t.waitForTimeoutInMilliseconds),a=t._windows[e];a?(clearTimeout(o),n(a.API)):r=t.onReadyWindow(function(t){t.API.id===e&&(clearTimeout(o),r(),n(t.API))})})},WindowStore.prototype.onReadyWindow=function(e){return this._registry.add("on-ready",e)},WindowStore.prototype.onAdded=function(e){return this._registry.add("on-added",e)},WindowStore.prototype.onRemoved=function(e){return this._registry.add("on-removed",e)},WindowStore.prototype.markReadyToShow=function(e){this._pendingWindows[e]&&(this._windows[e]=this._pendingWindows[e],delete this._pendingWindows[e],delete this._pendingWindowsStates[e]),this._registry.execute("on-ready",this._windows[e])},WindowStore}();t.WindowStore=r,t["default"]=new r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function LogLevel(){}return LogLevel.Trace="trace",LogLevel.Debug="debug",LogLevel.Info="info",LogLevel.Warn="warn",LogLevel.Error="error",LogLevel}();t.LogLevel=r;var o=function(){function Logger(e){this._name=e,i.isUndefinedOrNull(Logger.GlueLogger)||(this._glueLogger=Logger.GlueLogger.subLogger(e))}return Logger.GetNamed=function(e){return new Logger(e)},Logger.Get=function(e){return new Logger(Logger.GetTypeName(e))},Logger.prototype.trace=function(e){i.isUndefinedOrNull(this._glueLogger)?Logger.Level===r.Trace&&console.info(this._getMessage(e,r.Trace)):this._glueLogger.trace(e)},Logger.prototype.debug=function(e){i.isUndefinedOrNull(this._glueLogger)?Logger.Level!==r.Debug&&Logger.Level!==r.Trace||console.info(this._getMessage(e,r.Debug)):this._glueLogger.debug(e)},Logger.prototype.info=function(e){i.isUndefinedOrNull(this._glueLogger)?Logger.Level!==r.Debug&&Logger.Level!==r.Trace&&Logger.Level!==r.Info||console.info(this._getMessage(e,r.Info)):this._glueLogger.info(e)},Logger.prototype.warn=function(e){i.isUndefinedOrNull(this._glueLogger)?Logger.Level!==r.Debug&&Logger.Level!==r.Trace&&Logger.Level!==r.Info&&Logger.Level!==r.Warn||console.info(this._getMessage(e,r.Info)):this._glueLogger.warn(e)},Logger.prototype.error=function(e){i.isUndefinedOrNull(this._glueLogger)?(console.error(this._getMessage(e,r.Error)),console.trace()):this._glueLogger.error(e)},Logger.prototype._getMessage=function(e,t){return"["+t+"] "+this._name+" - "+e},Logger.GetTypeName=function(e){var t=/function (.{1,})\(/,n=t.exec(e.constructor.toString());return n&&n.length>1?n[1]:""},Logger.Level=r.Info,Logger}();t.Logger=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShutdownMethodName="T42.ACS.Shutdown",t.FeedackMethodName="T42.ACS.Feedback",t.GetConfigurationRegionMethodName="T42.ACS.GetConfigurationRegion",t.SetConfigurationRegionMethodName="T42.ACS.SetConfigurationRegion",t.GetUserMethodName="T42.ACS.GetUser",t.GetBranchesMethodName="T42.ACS.GetBranches",t.GetCurrentBranchMethodName="T42.ACS.GetCurrentBranch",t.SetCurrentBranchMethodName="T42.ACS.SetCurrentBranch",t.GetFunctionalEntitlementMethodName="T42.ACS.GetFunctionalEntitlement",t.CanIMethodName="T42.ACS.CanI",t.StartApplicationMethodName="T42.ACS.StartApplication",t.StopApplicationMethodName="T42.ACS.StopApplication",t.ActivateApplicationMethodName="T42.ACS.ActivateApplication",t.RunApplicationMethodName="T42.ACS.RunApplication",t.OnEventMethodName="T42.ACS.OnEvent",t.GetApplicationsMethodName="T42.ACS.GetApplications"},function(e,t,n){"use strict";function reset(){o=!1}function setCharacters(e){if(!e)return void(i!==s&&(i=s,reset()));if(e!==i){if(e.length!==s.length)throw new Error("Custom alphabet for shortid must be "+s.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+s.length+" unique characters. These characters were not unique: "+t.join(", "));i=e,reset()}}function characters(e){return setCharacters(e),i}function setSeed(e){a.seed(e),r!==e&&(reset(),r=e)}function shuffle(){i||setCharacters(s);for(var e,t=i.split(""),n=[],r=a.nextValue();t.length>0;)r=a.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function getShuffled(){return o||(o=shuffle())}function lookup(e){return getShuffled()[e]}function get(){return i||s}var i,r,o,a=n(34),s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";e.exports={get:get,characters:characters,seed:setSeed,lookup:lookup,shuffled:getShuffled}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function ActivityEntity(e){this._id=e}return Object.defineProperty(ActivityEntity.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),ActivityEntity.prototype._update=function(e){if(e._id!==this._id)throw Error("Can not update from entity with different id.");this._updateCore(e)},ActivityEntity.prototype._updateCore=function(e){},ActivityEntity.prototype._beforeDelete=function(e){},ActivityEntity}();t["default"]=i},function(e,t,n){"use strict";function nodeify(e,t){if(!i.isFunction(t))return e;e.then(function(e){r(function(){t(null,e)})},function(e){r(function(){t(e,null)})})}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(e){setTimeout(e,0)};t.nodeify=nodeify},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(1),o=function(){function ActivityAGM(e){this._activity=e}return ActivityAGM.prototype.register=function(e,t){this._ensureHasAgm(),ActivityAGM.AGM.register(e,t)},ActivityAGM.prototype.servers=function(){return this._ensureHasAgm(),i.isUndefinedOrNull(this._activity)?[]:this._activity.windows.map(function(e){return e.instance})},ActivityAGM.prototype.methods=function(){var e=this;if(this._ensureHasAgm(),i.isUndefinedOrNull(this._activity))return[];var t=this._activity.windows,n=[],r=[];return t.forEach(function(t){e.methodsForWindow(t).forEach(function(e){-1===n.indexOf(e.name)&&(n.push(e.name),r.push(e))})}),r},ActivityAGM.prototype.methodsForWindow=function(e){return this._ensureHasAgm(),e.instance?ActivityAGM.AGM.methodsForInstance(e.instance):[]},ActivityAGM.prototype.invoke=function(e,t,n,o,a,s){this._ensureHasAgm();var c=this.servers();if(i.isUndefinedOrNull(n)&&(n="activity.all"),i.isString(n))if("activity.all"===n)c;else{if("activity.best"!==n){if("all"===n||"best"===n)return r.promisify(ActivityAGM.AGM.invoke(e,t,n,o),a,s);throw new Error("Invalid invoke target "+n)}var u=c.filter(function(t){return ActivityAGM.AGM.methodsForInstance(t).filter(function(t){return t.name===e}).length>0});u.length>0&&[u[0]]}else if(i.isArray(n)){if(n.length>=0){var d=n[0];if(this._isInstance(d))n.map(function(e){return e});else{if(!this._isActivityWindow(d))throw new Error("Unknown target object");n.map(function(e){return e.instance})}}}else if(this._isInstance(n))[n];else{if(!this._isActivityWindow(n))throw new Error("Unknown target object");[n.instance]}throw new Error("Not implemented")},ActivityAGM.prototype.unregister=function(e){return this._ensureHasAgm(),ActivityAGM.AGM.unregister(e)},ActivityAGM.prototype.createStream=function(e,t,n){this._ensureHasAgm(),ActivityAGM.AGM.createStream(e,{subscriptionAddedHandler:t,subscriptionRemovedHandler:n,subscriptionRequestHandler:undefined})},ActivityAGM.prototype.subscribe=function(e,t,n){return this._ensureHasAgm(),ActivityAGM.AGM.subscribe(e,t)},ActivityAGM.prototype._ensureHasAgm=function(){if(i.isUndefinedOrNull(ActivityAGM.AGM))throw new Error("Agm should be configured to be used in activity")},ActivityAGM.prototype._isInstance=function(e){return e.application!==undefined},ActivityAGM.prototype._isActivityWindow=function(e){return e.instance!==undefined},ActivityAGM}();t.ActivityAGM=o},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(1),a=function(e){function ActivityType(t,n,i,r){var o=e.call(this,t)||this;return o._name=t,o._description=r,o._ownerWindow=n,o._helperWindows=i||[],o}return i(ActivityType,e),Object.defineProperty(ActivityType.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityType.prototype,"description",{get:function(){return this._description},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityType.prototype,"helperWindows",{get:function(){return this._helperWindows},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityType.prototype,"ownerWindow",{get:function(){return this._ownerWindow},enumerable:!0,configurable:!0}),ActivityType.prototype.initiate=function(e,t,n){return this._manager.initiate(this._name,e,t,n)},ActivityType.prototype._updateCore=function(t){var n=this;e.prototype._updateCore.call(this,t),o.ifNotUndefined(t._description,function(e){return n._description=e}),o.ifNotUndefined(t._ownerWindow,function(e){return n._ownerWindow=e}),o.ifNotUndefined(t._helperWindows,function(e){return n._helperWindows=e})},ActivityType}(r["default"]);t["default"]=a},function(e,t,n){"use strict";function objectValues(e){return e?Object.keys(e).map(function(t){return e[t]}):[]}function objectClone(e){var t;try{t=JSON.parse(JSON.stringify(e||{}))}catch(e){t={}}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.objectValues=objectValues,t.objectClone=objectClone},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(13),o=n(10),a=n(16),s=n(14),c=n(15),u=n(4),d=n(17),p=n(1),f=function(){function HCBridge(e,t,n,i,r){this._activityTypeEntityName="activityType",this._windowTypeEntityName="windowType",this._activityEntityName="activity",this._windowEntityName="activityWindow",this._logger=u.Logger.Get("hcBridge"),this._lastSeq=0,this._eventQueue=[],this._activityTypeCallbacks=[],this._windowTypeCallbacks=[],this._activityCallbacks=[],this._windowCallbacks=[],this._agm=e,this._windows=t,this._appManagerGetter=n,this._mode=i,this._typesToTrack=r}return HCBridge._hcToJsActivityType=function(e){return new o["default"](e.name,e.ownerWindowType,e.helperWindowTypes,e.description)},HCBridge._getURLParameter=function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},Object.defineProperty(HCBridge.prototype,"bridgeType",{get:function(){return"HC"},enumerable:!0,configurable:!0}),HCBridge.prototype.joinActivity=function(e,t){throw new Error("Not implemented")},HCBridge.prototype.leaveActivity=function(e,t){throw new Error("Not implemented")},HCBridge.prototype.init=function(){var e=this;this._readyMarker=new d.ReadyMarker("HC Bridge",1),this._htmlContainer=window.htmlContainer.activityFacade,this._htmlContainer.subscribeForJoinBreakEvents&&this._htmlContainer.subscribeForJoinBreakEvents(function(t){e._handleGenericEvents(t)});var t=this._agm?this._agm.instance:undefined,n=this._htmlContainer.init;this._htmlContainer.init2&&(n=this._htmlContainer.init2,t={jsAgmInstance:t,glueVersion:3,mode:this._mode,typesToTrack:this._typesToTrack}),n(t,this._hcEventHandler.bind(this),function(){e._readyMarker.signal("Init done from HC")},function(t){e._readyMarker.error(t)})},HCBridge.prototype.initReady=function(){var e=this;return new Promise(function(t,n){e._readyMarker.setCallback(function(i){i?(e._logger.error("Error initializing HC bridge - "+i),n(e._readyMarker.getError())):t(e)})})},HCBridge.prototype.ready=function(){return this.initReady()},HCBridge.prototype._handleGenericEvents=function(e){this._processEventBySeq(e)},HCBridge.prototype._hcEventHandler=function(e){this._logger.trace(e);var t=JSON.parse(e);this._processEventBySeq(t)},HCBridge.prototype._processEventBySeq=function(e){var t=e.sequence;if(t===this._lastSeq+1){this._processEvent(e),this._lastSeq++;var n=this._eventQueue[t+1];p.isUndefined(n)||(this._logger.debug("replaying message number "+t),this._processEventBySeq(n),delete this._eventQueue[t+1])}else this._eventQueue[t]=e,this._logger.debug("Got out of order event with number "+t+". Will wait for previous event(s) before replaying.")},HCBridge.prototype._processEvent=function(e){var t=this;if(e.genericEvent)return void this._processGenericEvent(e);var n,r=e.entityType,o=this._convertContext(e.context);if(e.context.type===i.EntityEventType.ActivityContextChange&&!this._htmlContainer.contextUpdateRaceFixed)return void this.getActivities().then(function(n){var r=e.context.updated,o=e.context.removed,a=t._hcToJsActivity(e.entity),s=e.entity.context;n.forEach(function(e){if(e.id===a.id){var n=new i.ActivityContextChangedEventContext(s,r,o);t._publishActivityStatusChange(a,n)}})});switch(r){case this._activityTypeEntityName:n=HCBridge._hcToJsActivityType(e.entity),this._publishActivityTypeStatusChange(n,o);break;case this._windowTypeEntityName:n=this._hcToJsWindowType(e.entity),this._publishWindowTypeStatusChange(n,o);break;case this._activityEntityName:n=this._hcToJsActivity(e.entity),this._publishActivityStatusChange(n,o);break;case this._windowEntityName:n=this._hcToJsWindow(e.entity),this._publishActivityWindowEvent(n,o)}},HCBridge.prototype._processGenericEvent=function(e){var t=e.data;"ActivitiesAttached"===e.type?this._activitiesAttachedHandler&&this._activitiesAttachedHandler(t):"ActivitiesDetached"===e.type?this._activitiesDetached&&this._activitiesDetached(t):"ActivityAttachedDescriptorsRefreshed"===e.type&&this._activityAttachedDescriptorsRefreshed&&this._activityAttachedDescriptorsRefreshed(t)},HCBridge.prototype._convertContext=function(e){if(e.type===i.EntityEventType.StatusChange){var t=new r.ActivityStatus(e.oldStatus.state,e.oldStatus.statusMessage,e.oldStatus.statusTime),n=new r.ActivityStatus(e.newStatus.state,e.newStatus.statusMessage,e.newStatus.statusTime);return new i.ActivityStatusChangeEventContext(n,t)}return e.type===i.EntityEventType.ActivityWindowEvent?new i.EntityEventContext(e.event):e.type===i.EntityEventType.ActivityContextChange?new i.ActivityContextChangedEventContext(e.newContext,e.updated,e.removed):new i.EntityEventContext(e.type)},HCBridge.prototype._hcToJsActivity=function(e){var t=e.owner?this._hcToJsWindow(e.owner):null,n=t?t.id:null,i=new r.ActivityStatus(e.status.state,e.status.statusMessage,e.status.statusTime),o=JSON.parse(e.context);return new s["default"](e.id,e.type.name,i,o,n)},HCBridge.prototype._hcToJsWindowType=function(e){var t=this;return p.isUndefined(e.factories)&&(e.factories=[]),this._appByWindowTypeGetter||(this._appManagerGetter||(this._appByWindowTypeGetter=function(){return undefined}),this._appByWindowTypeGetter=function(e){return t._appManagerGetter().applications().filter(function(t){return t.activityWindowType===e})[0]}),new a["default"](e.name,this._appByWindowTypeGetter)},HCBridge.prototype.getActivityTypes=function(){var e=this;return new Promise(function(t,n){e._htmlContainer.getActivityTypes(function(e){var n=e.map(function(e){return HCBridge._hcToJsActivityType(e)});t(n)},function(e){n(e)})})},HCBridge.prototype.registerActivityType=function(e,t,n,i,r){var o=this;return new Promise(function(a,s){n===undefined&&(n=[]);var c={name:e,ownerWindowType:t,helperWindowTypes:n,description:r,layoutConfig:JSON.stringify(i)};o._htmlContainer.registerActivityType(JSON.stringify(c),function(e){var t=HCBridge._hcToJsActivityType(e);a(t)},function(e){s(e)})})},HCBridge.prototype.unregisterActivityType=function(e){var t=this;return new Promise(function(n,i){t._htmlContainer.unregisterActivityType(e,function(){n()},function(e){i(e)})})},HCBridge.prototype.getWindowTypes=function(){var e=this;return new Promise(function(t,n){e._htmlContainer.getWindowTypes(function(n){var i=n.map(function(t){return e._hcToJsWindowType(t)});t(i)},function(e){n(e)})})},HCBridge.prototype.registerWindowFactory=function(e,t,n){var i=this;return new Promise(function(n,r){if(p.isUndefinedOrNull(e))return void r("windowTypeName should be provided");i._htmlContainer.registerWindowFactory(e,t.create.bind(t),function(){n()},function(e){r(e)})})},HCBridge.prototype.initiateActivity=function(e,t,n){var i=this;return new Promise(function(n,r){if(p.isUndefinedOrNull(e))return void r("windowTypeName should be provided");p.isUndefinedOrNull(t)&&(t={}),i._htmlContainer.initiate(e,JSON.stringify(t),function(e){n(e)},function(e){r(e)})})},HCBridge.prototype.getAnnouncementInfo=function(){var e=window.htmlContainer,t=e.getContext(),n={activityWindowId:"",activityWindowType:"",activityWindowIndependent:!1,activityWindowName:""};return t.activityId?(n.activityWindowType=t.activityWindowType,p.isUndefined(n.activityWindowType)&&(n.activityWindowType=HCBridge._getURLParameter("activityWindowType")),n.activityWindowId=t.activityWindowId,p.isUndefined(n.activityWindowId)&&(n.activityWindowId=HCBridge._getURLParameter("activityWindowId")),n.activityWindowIndependent=t.activityWindowIndependent,p.isUndefined(n.activityWindowIndependent),n.activityWindowName=t.activityWindowName,p.isUndefined(n.activityWindowName)&&(n.activityWindowName=HCBridge._getURLParameter("activityWindowName")),n):n},HCBridge.prototype.announceWindow=function(e,t){var n=this;if(p.isUndefined(e))throw new Error("can not determine window type");if(p.isUndefined(e))throw new Error("can not determine window activityWindowId");this._htmlContainer.announceWindow(e,t,function(e){n._logger.error("Error announcing activity window with id '"+t+"'. "+e)})},HCBridge.prototype.getActivities=function(){var e=this;return new Promise(function(t,n){e._logger.trace("Executing getActivities()"),e._htmlContainer.getActivities(function(n){e._logger.trace("Got getActivities() :"+n);var i=JSON.parse(n),r=i.map(function(t){return e._hcToJsActivity(t)});t(r)},function(t){e._logger.trace("Error in getActivities() :"+t),n(t)})})},HCBridge.prototype.updateActivityContext=function(e,t,n,i){var r=this;return new Promise(function(o,a){p.isUndefined(i)&&(i=[]);var s={fullReplace:n,removedKeys:i};r._htmlContainer.setActivityContext(e.id,JSON.stringify(t),JSON.stringify(s),function(e){var t=JSON.parse(e);o(t)},function(e){return a(e)})})},HCBridge.prototype.getActivityWindows=function(){var e=this;return new Promise(function(t,n){e._htmlContainer.getWindows(function(n){var i=n.map(function(t){return e._hcToJsWindow(t)});t(i)},function(e){n(e)})})},HCBridge.prototype.stopActivity=function(e){var t=this;return new Promise(function(n,i){t._htmlContainer.stopActivity(e.id,function(e){n(e)},function(e){i(e)})})},HCBridge.prototype.unregisterWindowFactory=function(e){var t=this;return new Promise(function(n,i){t._htmlContainer.registerWindowFactory(e,function(){n()},function(e){i(e)})})},HCBridge.prototype.createWindow=function(e,t){var n=this;return new Promise(function(i,r){var o=t,a=n._htmlContainer.createWindow2;a||(a=n._htmlContainer.createWindow,o=JSON.stringify(t)),a(e,o,function(e){i(e)},function(e){r(e)})})},HCBridge.prototype.createStackedWindows=function(e,t,n){var i=this;return new Promise(function(r,o){var a=t,s=i._htmlContainer.createStackedWindows2;s||(s=i._htmlContainer.createStackedWindows,a=JSON.stringify(t)),s(e,a,n,function(e){r(e)},function(e){o(e)})})},HCBridge.prototype.onActivityTypeStatusChange=function(e){this._activityTypeCallbacks.push(e)},HCBridge.prototype.onWindowTypeStatusChange=function(e){this._windowTypeCallbacks.push(e)},HCBridge.prototype.onActivityStatusChange=function(e){this._activityCallbacks.push(e)},HCBridge.prototype.onActivityWindowChange=function(e){this._windowCallbacks.push(e)},HCBridge.prototype.getWindowBounds=function(e){var t=this;return new Promise(function(n,i){t._htmlContainer.getWindowBounds(e,function(e){n(e)},function(e){i(e)})})},HCBridge.prototype.setWindowBounds=function(e,t){var n=this;return new Promise(function(i,r){n._htmlContainer.setWindowBounds(e,JSON.stringify(t),function(){i()},function(e){r(e)})})},HCBridge.prototype.registerWindow=function(e,t,n){var i=this;return new Promise(function(r,o){i._htmlContainer.registerWindow(e,t,n,function(e){r(e)},function(e){o(e)})})},HCBridge.prototype.closeWindow=function(e){var t=this;return new Promise(function(n,i){t._htmlContainer.closeWindow(e,function(){n()},function(e){i(e)})})},HCBridge.prototype.activateWindow=function(e,t){var n=this;return new Promise(function(i,r){n._htmlContainer.activateWindow(e,t,function(){i()},function(e){r(e)})})},HCBridge.prototype.setWindowVisibility=function(e,t){var n=this;return new Promise(function(i,r){n._htmlContainer.setWindowVisibility(e,t,function(){i()},function(e){r(e)})})},HCBridge.prototype.cloneActivity=function(e,t){var n=this;return new Promise(function(i,r){n._htmlContainer.cloneActivity(e,t,function(e){i(e)},function(e){r(e)})})},HCBridge.prototype._publishStatusChange=function(e,t,n){var r=new i.EntityEvent(e,t);n.forEach(function(e){e(r)})},HCBridge.prototype._publishActivityTypeStatusChange=function(e,t){this._publishStatusChange(e,t,this._activityTypeCallbacks)},HCBridge.prototype._publishWindowTypeStatusChange=function(e,t){this._publishStatusChange(e,t,this._windowTypeCallbacks)},HCBridge.prototype._publishActivityStatusChange=function(e,t){this._publishStatusChange(e,t,this._activityCallbacks)},HCBridge.prototype._publishActivityWindowEvent=function(e,t){this._publishStatusChange(e,t,this._windowCallbacks)},HCBridge.prototype.attachActivities=function(e,t,n){var i=this;return new Promise(function(r,o){i._htmlContainer.attachActivities(e,t,n,function(e){r(e)},function(e){o(e)})})},HCBridge.prototype.detachActivities=function(e,t){var n=this;return new Promise(function(i,r){n._htmlContainer.detachActivities(e,t,function(e){i(e)},function(e){r(e)})})},HCBridge.prototype.onActivitiesAttached=function(e){this._activitiesAttachedHandler=e},HCBridge.prototype.onActivitiesDetached=function(e){this._activitiesDetached=e},HCBridge.prototype.onActivityAttachedDescriptorsRefreshed=function(e){this._activityAttachedDescriptorsRefreshed=e},HCBridge.prototype.getAttachedDescriptors=function(){var e=this;return new Promise(function(t,n){if(!e._htmlContainer.getAttachedDescriptors)return void t([]);e._htmlContainer.getAttachedDescriptors(function(e){t(e)},function(e){n(e)})})},HCBridge.prototype._hcToJsWindow=function(e){var t=this,n=function(){return undefined};return this._windows&&(n=e.hcWindowId?function(){return t._windows.list().filter(function(t){return t.id===e.hcWindowId})[0]}:function(){return t._windows.list().filter(function(t){return t.application===e.instance.application})[0]}),new c["default"](e.id,e.name,e.type,e.activityId,e.instance,e.isIndependent,n,e.hcWindowId)},HCBridge}();t["default"]=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function ActivityStatus(e,t,n){this.state=e,this.message=t,this.time=n}return ActivityStatus.prototype.getState=function(){return this.state},ActivityStatus.prototype.getMessage=function(){return this.message},ActivityStatus.prototype.getTime=function(){return this.time},ActivityStatus}();t.ActivityStatus=i},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(9),a=n(46),s=n(8),c=n(1),u=function(e){function Activity(t,n,i,r,a){var s=e.call(this,t)||this;return s._id=t,s._actType=n,s._status=i,s._context=r,s._ownerId=a,s._agm=new o.ActivityAGM(s),s}return i(Activity,e),Object.defineProperty(Activity.prototype,"type",{get:function(){return this._manager?this._manager.getActivityType(this._actType):undefined},enumerable:!0,configurable:!0}),Object.defineProperty(Activity.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(Activity.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(Activity.prototype,"owner",{get:function(){return this._ownerId?this._manager.getWindows({id:this._ownerId})[0]:null},enumerable:!0,configurable:!0}),Object.defineProperty(Activity.prototype,"windows",{get:function(){return this._manager.getWindows({activityId:this._id})},enumerable:!0,configurable:!0}),Object.defineProperty(Activity.prototype,"agm",{get:function(){return this._agm},enumerable:!0,configurable:!0}),Activity.prototype.addWindow=function(e,t){return this._manager.addWindowToActivity(this,e,t)},Activity.prototype.createWindow=function(e,t){return this._manager.createWindow(this,e,t)},Activity.prototype.createStackedWindows=function(e,t,n){return this._manager.createStackedWindows(this,e,t,n)},Activity.prototype.leave=function(e,t){return this._manager.leaveWindowFromActivity(this,e,t)},Activity.prototype.getWindowsByType=function(e){var t={activityId:this._id,type:e};return this._manager.getWindows(t)},Activity.prototype.setContext=function(e,t){return this._manager.setActivityContext(this,e,t)},Activity.prototype.updateContext=function(e,t){return this._manager.updateActivityContext(this,e,t)},Activity.prototype.onStatusChange=function(e){var t=this;return this._manager.subscribeActivityEvents(function(n,i,r){n.id===t.id&&e(n,i,r)})},Activity.prototype.onWindowEvent=function(e){var t=this;return this._manager.subscribeWindowEvents(function(n,i,r){n.id===t.id&&e(n,i,r)})},Activity.prototype.onContextChanged=function(e){var t=this;this._manager.subscribeActivityContextChanged(function(n,i,r,o){n.id===t.id&&e(i,r,o,n)});try{e(this.context,this.context,[],this)}catch(e){return}},Activity.prototype.stop=function(){this._manager.stopActivity(this)},Activity.prototype.clone=function(e){return this._manager.clone(this,e)},Activity.prototype.attach=function(e,t){var n;return n="string"==typeof e?e:e.id,this._manager.attachActivities(n,this.id,t)},Activity.prototype.onActivityAttached=function(e){var t=this;this._manager.subscribeActivitiesAttached(function(n,i,r){n===t._id&&e(r)})},Activity.prototype.onDetached=function(e){var t=this;this._manager.subscribeActivitiesDetached(function(n,i,r){i.id===t._id&&e(n,r)})},Activity.prototype._updateCore=function(t){var n=this;e.prototype._updateCore.call(this,t),c.ifNotUndefined(t._actType,function(e){return n._actType=e}),c.ifNotUndefined(t._context,function(e){return n._context=e}),c.ifNotUndefined(t._ownerId,function(e){return n._ownerId=e}),!t._status||this._status&&this._status.state===t._status.state||(this._status=t._status)},Activity.prototype._updateDescriptors=function(e){var t=this;this._attached=e.map(function(e){return new a.AttachedActivityDescriptor(t._manager,t._id,e)})},Object.defineProperty(Activity.prototype,"attached",{get:function(){return this._attached},enumerable:!0,configurable:!0}),Activity.prototype.setFrameColor=function(e,t){var n=this,i=new Promise(function(t,i){var r=n.windows.length;0===r&&t(n),n.windows.forEach(function(i){i.underlyingWindow.setFrameColor(e,function(){--r<=0&&t(n)})}),setTimeout(function(){r>0&&i(n.id+" - timed out waiting for setFrameColor with"+e)},5e3)});return s.nodeify(i,t)},Activity.prototype.getFrameColor=function(){return this.windows&&0!==this.windows.length?this.windows[0].underlyingWindow.frameColor:""},Activity}(r["default"]);t["default"]=u},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=n(4),a=n(1),s=n(1),c=n(2),u=function(e){function ActivityWindow(t,n,i,r,a,s,c,u){var d=e.call(this,t)||this;return d._logger=o.Logger.Get("window"),d._type=i,d._activityId=r,d._name=n,d._instance=a,d._isIndependent=s,d._windowGetter=c,d._hcWindowId=u,d}return i(ActivityWindow,e),ActivityWindow.prototype.getBounds=function(){return this._manager.getWindowBounds(this.id)},Object.defineProperty(ActivityWindow.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityWindow.prototype,"isIndependent",{get:function(){return this._isIndependent},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityWindow.prototype,"type",{get:function(){return this._manager?this._manager.getWindowType(this._type):undefined},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityWindow.prototype,"activity",{get:function(){return a.isUndefined(this._activityId)?undefined:this._manager.getActivityById(this._activityId)},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityWindow.prototype,"isOwner",{get:function(){var e=this.activity;return!a.isUndefined(e)&&e.owner.id===this.id},enumerable:!0,configurable:!0}),ActivityWindow.prototype.setVisible=function(e,t){return this._manager.setWindowVisibility(this.id,e)},ActivityWindow.prototype.activate=function(e){return this._manager.activateWindow(this.id,e)},ActivityWindow.prototype.setBounds=function(e,t){return this._manager.setWindowBounds(this.id,e,t)},ActivityWindow.prototype.close=function(){return this._manager.closeWindow(this.id)},Object.defineProperty(ActivityWindow.prototype,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityWindow.prototype,"underlyingWindow",{get:function(){var e=this._windowGetter();return e||{id:this._hcWindowId}},enumerable:!0,configurable:!0}),ActivityWindow.prototype.onActivityJoined=function(e){this._subscribeForActivityWindowEvent(c.EntityEventType.ActivityWindowJoinedActivity,e)},ActivityWindow.prototype.onActivityRemoved=function(e){this._subscribeForActivityWindowEvent(c.EntityEventType.ActivityWindowLeftActivity,e)},ActivityWindow.prototype._updateCore=function(e){var t=this;s.ifNotUndefined(e._activityId,function(e){return t._activityId=e}),s.ifNotUndefined(e._isIndependent,function(e){return t._isIndependent=e}),s.ifNotUndefined(e._hcWindowId,function(e){return t._hcWindowId=e}),s.ifNotUndefined(e._type,function(e){return t._type=e}),s.ifNotUndefined(e._name,function(e){return t._name=e}),a.isUndefinedOrNull(e._instance)||(this._instance=e._instance)},ActivityWindow.prototype._subscribeForActivityWindowEvent=function(e,t){var n=this;this._manager.subscribeWindowEvents(function(i,r,o){r.id===n.id&&o===e&&t(i)})},ActivityWindow.prototype._beforeDelete=function(e){this._hcWindowId=e._hcWindowId},ActivityWindow}(r["default"]);t["default"]=u},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=function(e){function WindowType(t,n){var i=e.call(this,t)||this;return i._name=t,i._appByWindowTypeGetter=n,i}return i(WindowType,e),Object.defineProperty(WindowType.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(WindowType.prototype,"config",{get:function(){return this._appByWindowTypeGetter(this._name)},enumerable:!0,configurable:!0}),Object.defineProperty(WindowType.prototype,"windows",{get:function(){return this._manager.getWindows({type:this._name})},enumerable:!0,configurable:!0}),WindowType.prototype.create=function(e,t){var n=Object.assign({type:this.name,name:this.name,isIndependent:!1},t);return this._manager.createWindow(e,n)},WindowType}(r["default"]);t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),r=n(1),o=function(){function ReadyMarker(e,t){if(this._logger=i.Logger.Get("ReadyMarker ["+e+"]"),this._logger.debug("Initializing ready marker for '"+e+"' with "+t+" signals to wait"),t<=0)throw new Error("Invalid signal number. Should be > 0");this._signals=t,this._callbacks=[],this._name=e}return ReadyMarker.prototype.setCallback=function(e){return this.isSet()?void e(undefined):this.isError()?void e(this._error):void this._callbacks.push(e)},ReadyMarker.prototype.signal=function(e){if(this._logger.debug("Signaled - "+e+" - signals left "+(this._signals-1)),--this._signals<0)throw new Error("Error in ready marker '"+this._name+" - signals are "+this._signals);this.isSet()&&this._callbacks.forEach(function(e){e(undefined)})},ReadyMarker.prototype.error=function(e){this._error=e,this._callbacks.forEach(function(t){t(e)})},ReadyMarker.prototype.isSet=function(){return!this.isError()&&0===this._signals},ReadyMarker.prototype.isError=function(){return!r.isUndefined(this._error)},ReadyMarker.prototype.getError=function(){return this._error},ReadyMarker}();t.ReadyMarker=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function LayoutImpl(e){this.name=e.name,this.type=e.type,this.components=e.components,this.context=e.context,this.metadata=e.metadata}return LayoutImpl}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function LayoutStore(){this.layouts=[]}return LayoutStore.prototype.removeWhere=function(e){this.layouts=this.layouts.filter(e)},LayoutStore.prototype.add=function(e){this.layouts.push(e)},Object.defineProperty(LayoutStore.prototype,"all",{get:function(){return this.layouts},enumerable:!0,configurable:!0}),LayoutStore.prototype.where=function(e){return this.layouts.filter(e)},LayoutStore.prototype.first=function(e){return this.where(e)[0]},LayoutStore}();t.LayoutStore=i,t["default"]=new i},function(e,t,n){"use strict";function transformACSLayout(e){if(!e)return e;if(Array.isArray(e))return e.map(function(e){return transformACSLayout(e)});if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;var t={};return Object.keys(e).reduce(function(t,n){var i=e[n],r=transformACSLayout(i),o=n;return n[0].toLowerCase()!==n[0]&&(o=n[0].toLowerCase()+n.substr(1)),t[o]=r,t},t)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=transformACSLayout},function(e,t,n){"use strict";function getWindowsByTabGroupId(e,t){var n=i["default"].list;return Object.keys(n).reduce(function(i,r){var o=n[r];return o.API.tabGroupId===t&&o.API.id!==e&&(i[r]=o),i},{})}Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.getWindowsByTabGroupId=getWindowsByTabGroupId},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(3);t["default"]=function(e,t,n,o,a){function close(e,t){return new Promise(function(i,r){n.close(c).then(function(){"function"==typeof e&&e(c),i(c)})["catch"](function(e){"function"==typeof t&&t(e),r(e)})})}function navigate(t,i,r){return new Promise(function(o,a){n.navigate(c,t).then(function(){if(t===l)return"function"==typeof i&&i(c),o(c);var n=onUrlChanged(function(t,r){r.id===e&&t===r.url&&("function"==typeof i&&i(c),n(),o(c))})})["catch"](function(e){"function"==typeof r&&r(e),a(e)})})}function setStyle(e,t,i){return new Promise(function(r,o){n.setStyle(c,e).then(function(){"function"==typeof t&&t(c),r(c)})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function setTitle(e,t,i){return new Promise(function(r,o){n.setTitle(c,e).then(function(){"function"==typeof t&&t(c),r(c)})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function moveResize(e,t,i){return new Promise(function(r,o){n.moveResize(c,e).then(function(){var n=!e.height||g.height===e.height,i=!e.width||g.width===e.width,o=!e.left||g.left===e.left,a=!e.top||g.top===e.top;if(n&&i&&o&&a)return"function"==typeof t&&t(c),r(c);var s=onBoundsChanged(function(u){n=!e.height||u.bounds.height===e.height,i=!e.width||u.bounds.width===e.width,o=!e.left||u.bounds.left===e.left,a=!e.top||u.bounds.top===e.top,u.id===c.id&&n&&i&&o&&a&&("function"==typeof t&&t(c),s(),r(c))})})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function addFrameButton(e,t,i){return new Promise(function(r,o){return void 0===e?"function"==typeof i?void i("No button info"):void o("No button info"):e.buttonId===undefined?"function"==typeof i?void i("No buttonId"):void o("No buttonId"):e.imageBase64===undefined?"function"==typeof i?void i("No imageBase64"):void o("No imageBase64"):void n.addFrameButton(c,e).then(function(){"function"==typeof t&&t(c),r(c)})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function removeFrameButton(e,t,i){return new Promise(function(r,o){if(e===undefined||""===e)return"function"==typeof i?void i("No buttonId"):void o("No buttonId");n.removeFrameButton(c,e).then(function(){"function"==typeof t&&t(c),r(c)})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function activate(e,t){return new Promise(function(i,r){n.activate(c).then(function(){"function"==typeof e&&e(c),i(c)})["catch"](function(e){"function"==typeof t&&t(e),r(e)})})}function focus(e,t){return new Promise(function(i,r){n.focus(c).then(function(){"function"==typeof e&&e(c),i(c)})["catch"](function(e){"function"==typeof t&&t(e),r(e)})})}function maximizeRestore(e,t){return new Promise(function(i,r){var o="normal"===T?onMaximized:onNormal;n.maximizeRestore(c).then(function(){var t=o(function(){"function"==typeof e&&e(c),t&&t(),i(c)})})["catch"](function(e){"function"==typeof t&&t(e),r(e)})})}function maximize(t,i){return new Promise(function(r,o){n.maximize(c).then(function(){if("maximized"===T)return"function"==typeof t&&t(c),r(c);var n=onMaximized(function(i){i.id===e&&"maximized"===i.state&&("function"==typeof t&&t(c),n(),r(c))})})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function restore(t,i){return new Promise(function(r,o){n.restore(c).then(function(){if("normal"===T)return"function"==typeof t&&t(c),r(c);var n=onNormal(function(i){e===i.id&&"normal"===i.state&&("function"==typeof t&&t(c),n(),r(c))})})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function minimize(t,i){return new Promise(function(r,o){n.minimize(c).then(function(){if("minimized"===T)return"function"==typeof t&&t(c),r(c);var n=onMinimized(function(i){if(e===i.id&&"minimized"===i.state)return"function"==typeof t&&t(c),n(),r(c)})})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function collapse(t,i){return new Promise(function(r,o){if(M)return"function"==typeof t&&t(c),r(c);n.collapse(c).then(function(){if(M)return"function"==typeof t&&t(c),r(c);var n=onCollapsed(function(i){i.id===e&&("function"==typeof t&&t(c),n(),r(c))})})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function expand(t,i){return new Promise(function(r,o){if(!M)return"function"==typeof t&&t(c),r(c);n.expand(c).then(function(){if(!M)return"function"==typeof t&&t(c),r(c);var n=onExpanded(function(i){i.id===e&&("function"==typeof t&&t(c),n(),r(c))})})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function toggleCollapse(t,i){return new Promise(function(r,o){var a=M?onExpanded:onCollapsed;n.toggleCollapse(c).then(function(){a(function(n){n.id===e&&("function"==typeof t&&t(c),r(c))})})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function snap(e,t,i,r){return new Promise(function(o,a){n.snap(c,e,t).then(function(){"function"==typeof i&&i(c),o(c)})["catch"](function(e){"function"==typeof r&&r(e),a(e)})})}function attachTab(e,t,i,o){return new Promise(function(a,s){var u,d=c.id,p="Invalid tab parameter - should be an object with property id or a string. Invoked for source window id:"+c.id;if(!e)return void s(p);if("string"==typeof e)u=e;else{if("undefined"==typeof e.id)return void s(p);u=e.id}var f={sourceWindowId:u,targetWindowId:d};t&&(f.index=t);var l=r["default"].get(f.sourceWindowId).API,h=l.onAttached(function(e){e.id===l.id&&("function"==typeof i&&i(c),h(),a(c))});n.attachTab(c,f)["catch"](function(e){"function"==typeof o&&o(e),h(),s(e)})})}function detachTab(t,i,r){return new Promise(function(o,a){var s={windowId:c.id},d=t||{};"undefined"!=typeof d.relativeTo&&("string"==typeof d.relativeTo?s.relativeTo=d.relativeTo:"undefined"!=typeof d.relativeTo.id&&(s.relativeTo=d.relativeTo.id),"undefined"!=typeof d.relativeDirection&&(s.relativeDirection=d.relativeDirection),"undefined"!=typeof d.width&&(s.width=d.width),"undefined"!=typeof d.height&&(s.height=d.height)),"undefined"!=typeof d.bounds&&(s.bounds=d.bounds),"undefined"!=typeof d.hideTabHeader&&(s.hideTabHeader=d.hideTabHeader);var p=!1,f=!1,l=u.add("frame-attached",function(t){var n=d.hideTabHeader===undefined||d.hideTabHeader!==t.isTabHeaderVisible;e===t.id&&n&&(p=!0,l(),f&&("function"==typeof i&&i(c),o(c),"function"==typeof h&&h()))}),h=onDetached(function(t){e===t.id&&(f=!0,h(),p&&("function"==typeof i&&i(c),o(c),"function"==typeof l&&l()))});n.detachTab(c,s)["catch"](function(e){"function"==typeof r&&r(e),h(),l(),a(e)})})}function setVisible(t,i,r){return new Promise(function(o,a){n.setVisible(c,t).then(function(){var n=t===undefined?!0===I:I===t;if(n)return"function"==typeof i&&i(c),o(c);var r=onVisibilityChanged(function(a){n=t===undefined?!0===a.isVisible:a.isVisible===t,a.id===e&&n&&("function"==typeof i&&i(c),r(),o(c))})})["catch"](function(e){"function"==typeof r&&r(e),a(e)})})}function showLoader(e){return new Promise(function(t,i){n.showLoader(c,e).then(function(){t(c)})["catch"](function(e){i(e)})})}function hideLoader(){return new Promise(function(e,t){n.hideLoader(c).then(function(){e(c)})["catch"](function(e){t(e)})})}function updateContext(e,t,i){return new Promise(function(r,o){n.updateContext(c,e).then(function(){"function"==typeof t&&t(c),r(c)})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function lock(e,t){return new Promise(function(i,r){n.lock(c).then(function(){"function"==typeof e&&e(c),i(c)})["catch"](function(e){"function"==typeof t&&t(e),r(e)})})}function unlock(e,t){return new Promise(function(i,r){n.unlock(c).then(function(){"function"==typeof e&&e(c),i(c)})["catch"](function(e){"function"==typeof t&&t(e),r(e)})})}function getIcon(e,t){return new Promise(function(i,r){n.getIcon(c).then(function(t){"function"==typeof e&&e(t),i(t)})["catch"](function(e){"function"==typeof t&&t(e),r(e)})})}function setIcon(e,t,i){return new Promise(function(r,o){n.setIcon(c,e).then(function(){"function"==typeof t&&t(c),r(c)})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function setFrameColor(e,t,i){return new Promise(function(r,o){n.setFrameColor(c,e).then(function(){"function"==typeof t&&t(c),r(c)})["catch"](function(e){"function"==typeof i&&i(e),o(e)})})}function setTabHeaderVisible(t,i,r){return new Promise(function(o,a){n.setTabHeaderVisible(c,t).then(function(){if(S===t)return"function"==typeof i&&i(c),o(c);var n=onTabHeaderVisibilityChanged(function(r){r.id===e&&r.isTabHeaderVisible===t&&("function"==typeof i&&i(c),n(),o(c))})})["catch"](function(e){"function"==typeof r&&r(e),a(e)})})}function onTitleChanged(e){return e(c.title,c),u.add("onTitleChanged",e)}function onClose(e){return u.add("onClose",e)}function onUrlChanged(e){return u.add("onUrlChanged",e)}function onFrameButtonAdded(e){return u.add("onFrameButtonAdded",e)}function onFrameButtonRemoved(e){return u.add("onFrameButtonRemoved",e)}function onFrameButtonClicked(e){return u.add("onFrameButtonClicked",e)}function onCollapsed(e){return M&&e(c),u.add("collapsed",e)}function onExpanded(e){return M||e(c),u.add("expanded",e)}function onMaximized(e){return"maximized"===T&&e(c),u.add("maximized",e)}function onMinimized(e){return"minimized"===T&&e(c),u.add("minimized",e)}function onNormal(e){return"normal"===T&&e(c),u.add("normal",e)}function onAttached(e){return u.add("attached",e)}function onDetached(e){return u.add("detached",e)}function onVisibilityChanged(e){return u.add("visibility-changed",e)}function onContextUpdated(e){return u.add("context-updated",e)}function onLockingChanged(e){return u.add("lock-changed",e)}function onBoundsChanged(e){return u.add("bounds-changed",e)}function onFocusChanged(e){return u.add("focus-changed",e)}function onFrameColorChanged(e){return u.add("frame-color-changed",e)}function onTabHeaderVisibilityChanged(e){return u.add("tab-header-visibility-changed",e)}function onWindowAttached(e){return u.add("window-attached",e)}function onWindowDetached(e){return u.add("window-detached",e)}function onGroupChanged(e){return u.add("group-changed",e)}function onTabSelectionChanged(e){return u.add("tab-selection-changed",e)}function handleTitleChanged(e){h=e,u.execute("onTitleChanged",e,c)}function handleUrlChanged(e){l=e,u.execute("onUrlChanged",e,c)}function handleVisibilityChanged(e){e!==I&&(I=e,u.execute("visibility-changed",c))}function handleWindowSettingsChanged(e){C=e,u.execute("settings-changed",c)}function handleContextUpdated(e){y=e,u.execute("context-updated",y,c)}function handleWindowClose(){c.id!==undefined&&(c.id=undefined,u.execute("onClose",c))}function handleFrameButtonAdded(e){var t=["buttonId","imageBase64","order","tooltip"].reduce(function(t,n){return t[n]=e[n],t},{});-1===x.map(function(e){return e.buttonId}).indexOf(e.buttonId)&&x.push(t),u.execute("onFrameButtonAdded",t,c)}function handleFrameButtonRemoved(e){var t;x=x.reduce(function(n,i){return i.buttonId===e?t=i:n.push(i),n},[]),t!==undefined&&u.execute("onFrameButtonRemoved",t,c)}function handleFrameButtonClicked(e){var t=x.filter(function(t){return t.buttonId===e.buttonId});t.length>0&&u.execute("onFrameButtonClicked",t[0],c)}function handleWindowChangeState(e){"collapsed"===e?M=!0:"expanded"===e?M=!1:T=e,u.execute(e,c)}function handleFrameIsLockedChanged(e){j=e,u.execute("lock-changed",c)}function handleBoundsChanged(e){g.top===e.top&&g.left===e.left&&g.width===e.width&&g.height===e.height||(g.top=e.top,g.left=e.left,g.width=e.width,g.height=e.height,u.execute("bounds-changed",c))}function handleFocusChanged(e){m=e,u.execute("focus-changed",c)}function handleFrameColorChanged(e){v=e,u.execute("frame-color-changed",c)}function handleFrameAttached(e,t){E=e,S=t,u.execute("frame-attached",c)}function handleCompositionChanged(e,t){b=e||{},w=t}function handleGroupHeaderVisibilityChanged(e){_=e}function handleTabHeaderVisibilityChanged(e){S!==e&&(S=e,u.execute("tab-header-visibility-changed",c))}function handleFrameSelectionChanged(t,n){var i;void 0!==t&&t===e?(A=!0,i=c):(A=!1,i=r["default"].get(t)?r["default"].get(t).API:undefined);var o=r["default"].get(n)?r["default"].get(n).API:undefined;if(A&&o)var a=o.onTabSelectionChanged(function(e,t){(t&&t.id)===o.id&&(a(),u.execute("tab-selection-changed",i,o,c))});else u.execute("tab-selection-changed",i,o,c)}function handleAttached(e,t){E=e,S=t,u.execute("attached",c)}function handleWindowAttached(e){u.execute("window-attached",e)}function handleDetached(t){E=t;var n=u.add("frame-attached",function(t){t.id===e&&(n(),u.execute("detached",c))})}function handleWindowDetached(e){u.execute("window-detached",e)}function handleGroupChanged(t,n){o.trace("handle group changed to win: "+e+" with group id: "+t.id),s=t,w=t.id,u.execute("group-changed",c,t,n)}function handleGroupAssociation(t){t&&d.trace("setting group to win: "+e+" with group id: "+t.id),s=t}function getAllTabs(){var e=r["default"].list;return"tab"!==f.toLowerCase()?[]:Object.keys(e).reduce(function(t,n){var i=e[n];return i&&i.API.tabGroupId&&"undefined"!=typeof i.API.tabGroupId&&"undefined"!=typeof c.tabGroupId&&i.API.tabGroupId===c.tabGroupId&&t.push(i.API),t},[])}function mapWindowIdsToWindowObjects(e){return e.reduce(function(e,t){var n=r["default"].get(t);return n&&e.push(n.API),e},[])}function getNeighboursByDirection(e){var t=b[e];if(void 0!==t)return mapWindowIdsToWindowObjects(t)}function getApplicationName(){if(y._APPLICATION_NAME)return y._APPLICATION_NAME;if(y&&y._t42&&y._t42.application)return y._t42.application;var e=getWindowInfo();return e?e.applicationName:undefined}function getWindowInfo(){if("undefined"!=typeof window.glue42gd&&window.glue42gd.getWindowInfo){var t=window.glue42gd.getWindowInfo(e);return t||undefined}}var s,c,u=i["default"](),d=o.subLogger("window "+e),p=t.name,f=t.mode,l=t.url,h=t.title,y=t.context||{},g=t.bounds,v=t.frameColor,m=t.focus,b=t.neighbours||{},w=t.groupId,_=t.isGroupHeaderVisible,S=t.isTabHeaderVisible,A=t.isTabSelected,C=t.settings,I=t.isVisible,M=t.isCollapsed,T=t.state,E=t.tabGroupId,j=t.isLocked,x=[];return c={get name(){return p},get application(){var e=a();return e?e.application(getApplicationName()):undefined},get hostInstance(){return n.hostInstance},get agmInstance(){var e=getApplicationName();return e?{application:e}:undefined},get url(){return l},id:e,get title(){return h},get windowStyleAttributes(){return C},get settings(){return C},get tabGroupId(){return"tab"===f.toLowerCase()?E:undefined},get frameButtons(){return x},get mode(){return f},get state(){return T},get isCollapsed(){return M},get isVisible(){return I},get isLocked(){return j},get context(){return y},get bounds(){return g},get isFocused(){return m},get frameColor(){return v},get opened(){return c.id!==undefined},get group(){return s},get groupId(){return w},get topNeighbours(){return getNeighboursByDirection("top")},get leftNeighbours(){return getNeighboursByDirection("left")},get rightNeighbours(){return getNeighboursByDirection("right")},get bottomNeighbours(){return getNeighboursByDirection("bottom")},get isGroupHeaderVisible(){return _},get activityId(){if(y._t42)return y._t42.activityId;var e=getWindowInfo();return e?e.activityId:undefined},get activityWindowId(){if(y._t42)return y._t42.activityWindowId;var e=getWindowInfo();return e?e.activityWindowId:undefined},get windowType(){return t.windowType||"electron"},maximize:maximize,restore:restore,minimize:minimize,maximizeRestore:maximizeRestore,collapse:collapse,expand:expand,toggleCollapse:toggleCollapse,focus:focus,activate:activate,moveResize:moveResize,setTitle:setTitle,setStyle:setStyle,navigate:navigate,addFrameButton:addFrameButton,removeFrameButton:removeFrameButton,setVisible:setVisible,close:close,snap:snap,showLoader:showLoader,hideLoader:hideLoader,updateContext:updateContext,lock:lock,unlock:unlock,getIcon:getIcon,setIcon:setIcon,setFrameColor:setFrameColor,attachTab:attachTab,detachTab:detachTab,setTabHeaderVisible:setTabHeaderVisible,onClose:onClose,onUrlChanged:onUrlChanged,onTitleChanged:onTitleChanged,onFrameButtonAdded:onFrameButtonAdded,onFrameButtonRemoved:onFrameButtonRemoved,onFrameButtonClicked:onFrameButtonClicked,onCollapsed:onCollapsed,onExpanded:onExpanded,onMinimized:onMinimized,onMaximized:onMaximized,onNormal:onNormal,onAttached:onAttached,onDetached:onDetached,onVisibilityChanged:onVisibilityChanged,onContextUpdated:onContextUpdated,onLockingChanged:onLockingChanged,onBoundsChanged:onBoundsChanged,onFrameColorChanged:onFrameColorChanged,onFocusChanged:onFocusChanged,onGroupChanged:onGroupChanged,onWindowAttached:onWindowAttached,onWindowDetached:onWindowDetached,onTabSelectionChanged:onTabSelectionChanged,onTabHeaderVisibilityChanged:onTabHeaderVisibilityChanged,get tabs(){return getAllTabs()},get isTabHeaderVisible(){return S},get isTabSelected(){return A}},{API:c,Events:{handleWindowClose:handleWindowClose,handleWindowChangeState:handleWindowChangeState,handleTitleChanged:handleTitleChanged,handleVisibilityChanged:handleVisibilityChanged,handleUrlChanged:handleUrlChanged,handleWindowSettingsChanged:handleWindowSettingsChanged,handleContextUpdated:handleContextUpdated,handleFrameIsLockedChanged:handleFrameIsLockedChanged,handleBoundsChanged:handleBoundsChanged,handleFocusChanged:handleFocusChanged,handleFrameButtonAdded:handleFrameButtonAdded,handleFrameButtonRemoved:handleFrameButtonRemoved,handleFrameButtonClicked:handleFrameButtonClicked,handleFrameColorChanged:handleFrameColorChanged,handleFrameAttached:handleFrameAttached,handleFrameSelectionChanged:handleFrameSelectionChanged,handleCompositionChanged:handleCompositionChanged,handleGroupHeaderVisibilityChanged:handleGroupHeaderVisibilityChanged,handleTabHeaderVisibilityChanged:handleTabHeaderVisibilityChanged,handleGroupChanged:handleGroupChanged,handleGroupAssociation:handleGroupAssociation,handleAttached:handleAttached,handleDetached:handleDetached,handleWindowAttached:handleWindowAttached,handleWindowDetached:handleWindowDetached}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(36),r=n(48),o=n(55),a=n(78),s=n(66),c=n(60),u=n(63),d=n(24),p=n(61),f=n(70);t["default"]=function(e){function createWindows(e){if(n.windows){var i=getLibLogger("windows",e.logger,n.windows);return y=a["default"](e.agm,i,function(){return l},t),debugLog(y),y}}function createActivities(e){if(n.activities&&(2===t||r.ActivityModule.checkIsUsingGW3Implementation&&r.ActivityModule.checkIsUsingGW3Implementation(e.connection))){var i=getLibLogger("activity",e.logger,n.activities);return h=new r.ActivityModule({connection:e.connection,contexts:e.contexts,agm:e.agm,logger:i,logLevel:"info",disableAutoAnnounce:!1,disposeRequestHandling:"ignore",announcementInfo:null,windows:y,appManagerGetter:function(){return l},mode:n.activities.mode,typesToTrack:n.activities.typesToTrack,activityId:"undefined"!=typeof window&&window.glue42gd&&window.glue42gd.activityInfo&&window.glue42gd.activityInfo.activityId,gdMajorVersion:t}).api,debugLog(h),h}}function createAppManager(e){if(n.appManager){var i=getLibLogger("appManager",e.logger,n.appManager);return l=o["default"]({agm:e.agm,windows:y,logger:i,activities:h,mode:n.appManager.mode,gdMajorVersion:t}),debugLog(l),l}}function createLayouts(e){if(n.layouts){var t=getLibLogger("layouts",e.logger,n.layouts),i=s["default"]({agm:e.agm,appManager:l,activityGetter:function(){return h},logger:t,mode:n.layouts.mode});return debugLog(i),i}}function createChannels(e){if(n.channels&&e.contexts){var t=c.factory(e.contexts,e.agm);return debugLog(t),t}}function createHotkeys(e){var t=u.factory(e.agm);return debugLog(t),t}function getLibLogger(e,t,n){var i=t.subLogger(e);if(n&&n.logger){var r=n.logger;r.console&&i.consoleLevel(r.console),r.publish&&i.publishLevel(r.publish),r.metrics&&i.metricsLevel(r.metrics)}return i}function debugLog(e){v.push(e)}var t=f["default"].getGDMajorVersion();e=e||{};var n=p["default"](e);e.gateway=e.gateway||{};var l,h,y,g=("undefined"!=typeof window&&window.htmlContainer,{libs:[{name:"windows",create:createWindows},{name:"activities",create:createActivities},{name:"appManager",create:createAppManager},{name:"layouts",create:createLayouts},{name:"channels",create:createChannels},{name:"hotkeys",create:createHotkeys}],version:d.version,enrichGlue:function(e){e.config.activities=n.activities,e.config.windows=n.windows,e.config.appManager=n.appManager,e.config.layouts=n.layouts,e.config.channels=n.channels}}),v=[];return"undefined"!=typeof window&&(window.glueFactoryLog||(window.glueFactoryLog=[]),window.glueFactoryLog.push(v)),i["default"](e,g)}},function(e,t){e.exports={name:"tick42-glue",description:"Tick42 GLUE",version:"4.4.1",main:"./dist/node/tick42-glue.js",browser:"./dist/web/tick42-glue.js",types:"./glue.d.ts",docName:"Glue",scripts:{"init-dev-mode":"node ./build/scripts/init-dev-mode.js","remove-installed-dependencies":"node ./build/scripts/remove-installed-dependencies.js",clean:"node ./build/scripts/clean.js","file-versionify":"node ./build/scripts/file-versionify.js","pre:build":"npm run tslint && tsc && set NODE_ENV=development && npm run clean",tslint:"tslint -t codeFrame ./src/**/*.ts","tslint:fix":"tslint -t codeFrame --fix ./src/**/*.ts",watch:"onchange ./src/**/*.ts -- npm run build:dev","build:dev":"npm run tslint && npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify",prepublish:"npm run build:prod && npm run test:only","build:prod":"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify",test:"npm run build:dev && mocha ./tests","test:only":"mocha ./tests","generate-docs":"glue-js-documentation-builder build-reference --project g4e -q reference --modules ./glue.d.ts,./node_modules/tick42-glue-core/glue.d.ts"},repository:{type:"git",url:"https://stash.tick42.com:8443/scm/ofgw/js-glue.git"},author:{name:"Tick42",url:"http://www.glue42.com"},license:"ISC",dependencies:{"callback-registry":"2.5.1","es6-promise":"^4.1.1","object-assign":"^4.1.1",shortid:"^2.2.8","tick42-glue-core":"^4.3.7","tick42-promisify":"1.0.3"},devDependencies:{"@types/node":"^10.7.1","@types/object-assign":"^4.0.30","@types/shortid":"0.0.29",chai:"^4.1.0","glue-js-documentation-builder":"*",mocha:"^2.4.5",onchange:"3.*","pre-commit":"^1.1.3","readline-sync":"^1.4.5",shelljs:"^0.6.0","tick42-gateway":"0.2.7","tick42-webpack-config":"4.1.6",tslint:"^5.5.0",typescript:"^3.0.1",webpack:"2.3.3"},bundleDependencies:["tick42-glue-core","tick42-promisify","callback-registry"]}},function(e,t){e.exports=function(e,t,n){for(var i=(2<<Math.log(t.length-1)/Math.LN2)-1,r=Math.ceil(1.6*i*n/t.length),o="";;)for(var a=e(r),s=0;s<r;s++){var c=a[s]&i;if(t[c]&&(o+=t[c],o.length===n))return o}}},function(e,t,n){"use strict";function toObject(e){if(null===e||e===undefined)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(e){i[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,a,s=toObject(e),c=1;c<arguments.length;c++){n=Object(arguments[c]);for(var u in n)r.call(n,u)&&(s[u]=n[u]);if(i){a=i(n);for(var d=0;d<a.length;d++)o.call(n,a[d])&&(s[a[d]]=n[a[d]])}}return s}},function(e,t){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(n===setTimeout)return setTimeout(e,0);if((n===defaultSetTimout||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}function runClearTimeout(e){if(i===clearTimeout)return clearTimeout(e);if((i===defaultClearTimeout||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{return i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}function cleanUpNextTick(){s&&o&&(s=!1,o.length?a=o.concat(a):c=-1,a.length&&drainQueue())}function drainQueue(){if(!s){var e=runTimeout(cleanUpNextTick);s=!0;for(var t=a.length;t;){for(o=a,a=[];++c<t;)o&&o[c].run();c=-1,t=a.length}o=null,s=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var n,i,r=e.exports={};!function(){try{n="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){n=defaultSetTimout}try{i="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){i=defaultClearTimeout}}();var o,a=[],s=!1,c=-1;r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new Item(e,t)),1!==a.length||s||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=noop,r.addListener=noop,r.once=noop,r.off=noop,r.removeListener=noop,r.removeAllListeners=noop,r.emit=noop,r.prependListener=noop,r.prependOnceListener=noop,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";e.exports=n(31)},function(e,t,n){"use strict";function build(e){var t="",n=Math.floor(.001*(Date.now()-a));return n===r?i++:(i=0,r=n),t+=o(s),t+=o(e),i>0&&(t+=o(i)),t+=o(n)}var i,r,o=n(30),a=(n(6),1459707606518),s=6;e.exports=build},function(e,t,n){"use strict";function generate(e){for(var t,n=0,a="";!t;)a+=o(r,i.get(),1),t=e<Math.pow(16,n+1),n++;return a}var i=n(6),r=n(33),o=n(25);e.exports=generate},function(e,t,n){"use strict";function seed(t){return i.seed(t),e.exports}function worker(t){return a=t,e.exports}function characters(e){return e!==undefined&&i.characters(e),i.shuffled()}function generate(){return r(a)}var i=n(6),r=n(29),o=n(32),a=n(35)||0;e.exports=generate,e.exports.generate=generate,e.exports.seed=seed,e.exports.worker=worker,e.exports.characters=characters,e.exports.isValid=o},function(e,t,n){"use strict";function isShortId(e){return!(!e||"string"!=typeof e||e.length<6)&&!new RegExp("[^"+i.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)}var i=n(6);e.exports=isShortId},function(e,t,n){"use strict";var i,r="object"==typeof window&&(window.crypto||window.msCrypto);i=r&&r.getRandomValues?function(e){return r.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t},e.exports=i},function(e,t,n){"use strict";function getNextValue(){return(i=(9301*i+49297)%233280)/233280}function setSeed(e){i=e}var i=1;e.exports={nextValue:getNextValue,seed:setSeed}},function(e,t,n){"use strict";e.exports=0},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function __webpack_require__(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,__webpack_require__),i.l=!0,i.exports}var t={};return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=75)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={DEFAULT:0,STRING:1,NUMBER:2,COUNT:3,RATE:4,STATISTICS:6,TIMESTAMP:7,ADDRESS:8,TIMESPAN:10,OBJECT:11}},function(e,t,n){"use strict";function createRegistry(e){function add(e,t){var i=n[e];return i||(i=[],n[e]=i),i.push(t),function(){var i=n[e];i&&(i=i.reduce(function(e,n,i){return n===t&&e.length===i||e.push(n),e},[]),n[e]=i)}}function execute(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var r=n[e];if(!r||0===r.length)return[];var o=[];return r.forEach(function(n){try{var i=n.apply(undefined,t);o.push(i)}catch(t){o.push(undefined),_handleError(t,e)}}),o}function _handleError(n,i){var r=n instanceof Error?n:new Error(n);if(t)return void t(r);var o='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+r.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}function clear(){n={}}if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,n={};return{add:add,execute:execute,clear:clear}}createRegistry["default"]=createRegistry,e.exports=createRegistry},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={validate:function(e,t,n){if(null===e||"object"!=typeof e)throw new Error("Missing definition");if(null===t||"object"!=typeof t)throw new Error("Missing parent");if(null===n||"object"!=typeof n)throw new Error("Missing transport")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6);t["default"]=i},function(e,t,n){"use strict";function reset(){o=!1}function setCharacters(e){if(!e)return void(i!==s&&(i=s,reset()));if(e!==i){if(e.length!==s.length)throw new Error("Custom alphabet for shortid must be "+s.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+s.length+" unique characters. These characters were not unique: "+t.join(", "));i=e,reset()}}function characters(e){return setCharacters(e),i}function setSeed(e){a.seed(e),r!==e&&(reset(),r=e)}function shuffle(){i||setCharacters(s);for(var e,t=i.split(""),n=[],r=a.nextValue();t.length>0;)r=a.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function getShuffled(){return o||(o=shuffle())}function lookup(e){return getShuffled()[e]}function get(){return i||s}var i,r,o,a=n(24),s="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";e.exports={get:get,characters:characters,seed:setSeed,lookup:lookup,shuffled:getShuffled}},function(e,t,n){"use strict";function convertInfoToInstance(e){return"object"!=typeof e&&(e={}),{application:e.ApplicationName,environment:e.Environment,machine:e.MachineName,pid:e.ProcessId,region:e.Region,service:e.ServiceName,user:e.UserName,started:e.ProcessStartTime}}function isStreamingFlagSet(e){if("number"!=typeof e||isNaN(e))return!1;return 32==(32&e)}function convertInstance(e){return{ApplicationName:e.application,ProcessId:e.pid,MachineName:e.machine,UserName:e.user,Environment:e.environment,Region:e.region}}Object.defineProperty(t,"__esModule",{value:!0}),t.convertInfoToInstance=convertInfoToInstance,t.isStreamingFlagSet=isStreamingFlagSet,t.convertInstance=convertInstance},function(e,t,n){"use strict";e.exports=n(21)},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function default_1(e,t,n){if("function"!=typeof t&&"function"!=typeof n)return e;"function"!=typeof t?t=function(){}:"function"!=typeof n&&(n=function(){}),e.then(t,n)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=default_1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function ServerSubscription(e,t,n){this.protocol=e,this.repoMethod=t,this.subscription=n}return Object.defineProperty(ServerSubscription.prototype,"stream",{get:function(){return this.repoMethod.stream},enumerable:!0,configurable:!0}),Object.defineProperty(ServerSubscription.prototype,"arguments",{get:function(){return this.subscription.arguments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(ServerSubscription.prototype,"branchKey",{get:function(){return this.subscription.branchKey},enumerable:!0,configurable:!0}),Object.defineProperty(ServerSubscription.prototype,"instance",{get:function(){return this.subscription.instance},enumerable:!0,configurable:!0}),ServerSubscription.prototype.close=function(){this.protocol.server.closeSingleSubscription(this.repoMethod,this.subscription)},ServerSubscription.prototype.push=function(e){this.protocol.server.pushDataToSingle(this.repoMethod,this.subscription,e)},ServerSubscription}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(14);t.ContextMessageReplaySpec={get name(){return"context"},get types(){return[i.GW_MESSAGE_CREATE_CONTEXT,i.GW_MESSAGE_ACTIVITY_CREATED,i.GW_MESSAGE_ACTIVITY_DESTROYED,i.GW_MESSAGE_CONTEXT_CREATED,i.GW_MESSAGE_CONTEXT_ADDED,i.GW_MESSAGE_SUBSCRIBE_CONTEXT,i.GW_MESSAGE_SUBSCRIBED_CONTEXT,i.GW_MESSAGE_UNSUBSCRIBE_CONTEXT,i.GW_MESSAGE_DESTROY_CONTEXT,i.GW_MESSAGE_CONTEXT_DESTROYED,i.GW_MESSAGE_UPDATE_CONTEXT,i.GW_MESSAGE_CONTEXT_UPDATED,i.GW_MESSAGE_JOINED_ACTIVITY]}}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function Utils(){}return Utils.getGDMajorVersion=function(){if("undefined"==typeof window)return-1;if(!window.glueDesktop)return-1;if(!window.glueDesktop.version)return-1;var e=Number(window.glueDesktop.version.substr(0,1));return isNaN(e)?-1:e},Utils.isNode=function(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}},Utils}();t["default"]=n}).call(t,n(7))},function(e,t){e.exports={name:"tick42-glue-core",version:"4.3.7",description:"Glue42 core library including logger, connection, agm and metrics",main:"./dist/node/tick42-glue-core.js",types:"./glue.d.ts",browser:"./dist/web/tick42-glue-core.js",scripts:{"init-dev-mode":"node ./build/scripts/init-dev-mode.js","remove-installed-dependencies":"node ./build/scripts/remove-installed-dependencies.js",clean:"node ./build/scripts/clean.js","pre:build":"npm run clean && npm run tslint && tsc && set NODE_ENV=development","file-versionify":"node ./build/scripts/file-versionify.js",tslint:"tslint -t codeFrame ./src/**.ts","tslint:fix":"tslint -t codeFrame --fix ./src/**.ts",watch:"onchange ./src/**/*.ts -- npm run build:dev","build:dev":"npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify","build:prod":"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify",docs:"typedoc --options typedoc.json ./src",prepublish:"npm run build:prod && npm run test:only",test:"npm run build:dev && npm run test:only","test:only":"mocha ./tests/ --recursive","test:core":"mocha ./tests/core","test:agm":"mocha ./tests/agm","test:bus":"mocha ./tests/bus"},repository:{type:"git",url:"https://stash.tick42.com/scm/tg/js-glue-core.git"},author:{name:"Tick42",url:"http://www.glue42.com"},license:"ISC",dependencies:{"callback-registry":"^2.4.0","es6-promise":"^4.1.0",shortid:"^2.2.6","util-deprecate":"^1.0.2",ws:"^0.7.2"},devDependencies:{"@types/node":"^10.7.0","@types/shortid":"0.0.29",archiver:"^1.3.0","babel-core":"^6.25.0","babel-loader":"^6.4.1","babel-plugin-add-module-exports":"^0.2.1","babel-preset-es2015":"^6.16.0","babel-preset-stage-2":"^6.22.0",chai:"^4.0.2","deep-equal":"^1.0.1",mocha:"^2.5.3",onchange:"3.*","pre-commit":"^1.1.3","readline-sync":"^1.4.5",shelljs:"^0.6.0","tick42-gateway":"0.2.7","tick42-webpack-config":"4.1.6",tslint:"^5.11.0",typescript:"^3.0.1",webpack:"2.3.3"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function ConnectionImpl(e){this.messageHandlers={},this.ids=1,this.registry=i["default"](),this._connected=!1,this._settings=e,this._logger=e.logger}return ConnectionImpl.prototype.init=function(e,t){this._protocol=t,this._transport=e,this._transport.onConnectedChanged(this.handleConnectionChanged.bind(this)),this._transport.onMessage(this.handleTransportMessage.bind(this))},ConnectionImpl.prototype.send=function(e,t,n,i,r){if(this._transport.isObjectBasedTransport){var o=this._protocol.createObjectMessage(e,t,n,i);return this._transport.sendObject(o,e,t,r)}var a=this._protocol.createStringMessage(e,t,n,i);return this._transport.send(a,e,t,r)},ConnectionImpl.prototype.on=function(e,t,n){t=t.toLowerCase(),this.messageHandlers[t]===undefined&&(this.messageHandlers[t]={});var i=this.ids++;return this.messageHandlers[t][i]=n,{type:t,id:i}},ConnectionImpl.prototype.off=function(e){delete this.messageHandlers[e.type.toLowerCase()][e.id]},Object.defineProperty(ConnectionImpl.prototype,"isConnected",{get:function(){return this._connected},enumerable:!0,configurable:!0}),ConnectionImpl.prototype.connected=function(e){return this._connected&&e(this._settings.ws||this._settings.http),this.registry.add("connected",e)},ConnectionImpl.prototype.disconnected=function(e){return this.registry.add("disconnected",e)},ConnectionImpl.prototype.login=function(e){return this._transport.open(),this._protocol.login(e)},ConnectionImpl.prototype.logout=function(){this._protocol.logout(),this._transport.close()},ConnectionImpl.prototype.loggedIn=function(e){return this._protocol.loggedIn(e)},Object.defineProperty(ConnectionImpl.prototype,"protocolVersion",{get:function(){return this._settings.protocolVersion||1},enumerable:!0,configurable:!0}),ConnectionImpl.prototype.toAPI=function(){var e=this;return{send:e.send.bind(e),on:e.on.bind(e),off:e.off.bind(e),login:e.login.bind(e),logout:e.logout.bind(e),loggedIn:e.loggedIn.bind(e),connected:e.connected.bind(e),disconnected:e.disconnected.bind(e),get protocolVersion(){return e.protocolVersion}}},ConnectionImpl.prototype.distributeMessage=function(e,t){var n=this,i=this.messageHandlers[t.toLowerCase()];i!==undefined&&Object.keys(i).forEach(function(t){var r=i[t];if(r!==undefined)try{r(e)}catch(e){n._logger.error("Message handler failed with "+e.stack)}})},ConnectionImpl.prototype.handleConnectionChanged=function(e){this._connected!==e&&(this._connected=e,e?this.registry.execute("connected"):this.registry.execute("disconnected"))},ConnectionImpl.prototype.handleTransportMessage=function(e){var t;t="string"==typeof e?this._protocol.processStringMessage(e):this._protocol.processObjectMessage(e),this.distributeMessage(t.msg,t.msgType)},ConnectionImpl}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GW_MESSAGE_CREATE_CONTEXT="create-context",t.GW_MESSAGE_ACTIVITY_CREATED="created",t.GW_MESSAGE_ACTIVITY_DESTROYED="destroyed",t.GW_MESSAGE_CONTEXT_CREATED="context-created",t.GW_MESSAGE_CONTEXT_ADDED="context-added",t.GW_MESSAGE_SUBSCRIBE_CONTEXT="subscribe-context",t.GW_MESSAGE_SUBSCRIBED_CONTEXT="subscribed-context",t.GW_MESSAGE_UNSUBSCRIBE_CONTEXT="unsubscribe-context",t.GW_MESSAGE_DESTROY_CONTEXT="destroy-context",t.GW_MESSAGE_CONTEXT_DESTROYED="context-destroyed",t.GW_MESSAGE_UPDATE_CONTEXT="update-context",t.GW_MESSAGE_CONTEXT_UPDATED="context-updated",t.GW_MESSAGE_JOINED_ACTIVITY="joined"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={protocolVersion:-1,send:function(e,t,n,i,r){return Promise.resolve(undefined)},on:function(e,t,n){return{type:"1",id:1}},off:function(e){},login:function(e){return undefined},logout:function(){},loggedIn:function(e){return undefined},connected:function(e){return undefined},disconnected:function(e){return undefined}};t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(89),r=n(57),o=n(74),a=n(35),s=n(52),c=n(55),u=n(15),d=n(92),p=n(11),f=n(15),l=n(71),h=n(10),y=function(e,t){function registerLib(e,t,n){t.initStartTime=n.startTime,t.ready?t.ready().then(function(){t.initTime=n.stop(),t.initEndTime=n.endTime}):(t.initTime=n.stop(),t.initEndTime=n.endTime),T[e]=t,y[e]=t}function setupConnection(){var e=d["default"]();M.connection.logger=_.subLogger("connection"),b=r["default"](M.connection);var t=Promise.resolve(M.auth);if(M.connection&&!M.auth){var n=M.connection.protocolVersion;if(!n||1===n)return registerLib("connection",b,e),Promise.resolve({});if(2===n)return Promise.reject("You need to provide auth information");3===n&&(t=g?g.getGWToken().then(function(e){return{gatewayToken:e}}):Promise.reject("You need to provide auth information"))}return t.then(function(e){var t;if("string"==typeof e||"number"==typeof e)t={token:e};else{if("[object Object]"!==Object.prototype.toString.call(e))throw new Error("Invalid auth object - "+JSON.stringify(e));t=e}return t}).then(function(e){return b.login(e)}).then(function(t){return t&&(t.machine&&(M.agm.instance.machine=t.machine),t.user&&(M.agm.instance.user=t.user)),registerLib("connection",b,e),M})["catch"](function(e){throw b&&b.logout(),e})}function setupMetrics(){if(M.metrics){var e=d["default"]();S=i["default"]({identity:M.metrics.identity,connection:M.metrics?b:u["default"],logger:_.subLogger("metrics")}),A=S.subSystem("App");var t,n=A.subSystem("reporting"),r={name:"features",conflation:1};A.featureMetric=function(e,i,o){if(void 0===e||""===e)throw new Error("name is mandatory");if(void 0===i||""===i)throw new Error("action is mandatory");if(void 0===o||""===o)throw new Error("payload is mandatory");t?t.update({name:e,action:i,payload:o}):t=n.objectMetric(r,{name:e,action:i,payload:o})},_.metricsLevel("warn",A.parent.subSystem("LogEvents")),registerLib("metrics",A,e)}return Promise.resolve(undefined)}function setupAGM(){var e=d["default"](),t={instance:M.agm.instance,connection:b,logger:_.subLogger("agm"),forceGW:M.connection&&M.connection.force,gdVersion:v};return new Promise(function(n,i){a["default"](t).then(function(t){w=t,registerLib("agm",w,e),n(M)})["catch"](function(e){return i(e)})})}function setupContexts(){var e=M.activities&&3===f["default"].protocolVersion;if(M.contexts||e){var t=d["default"]();return C=new l.ContextsModule({connection:b,logger:_.subLogger("contexts"),gdMajorVersion:v}),registerLib("contexts",C,t),C}var n=f["default"].replayer;n&&n.drain(h.ContextMessageReplaySpec.name,null)}function setupExternalLibs(e){try{return e.forEach(function(e){setupExternalLib(e.name,e.create)}),Promise.resolve()}catch(e){return Promise.reject(e)}}function setupExternalLib(e,t){var n=d["default"](),i=t(T);i&&registerLib(e,i,n)}function waitForLibs(){var e=Object.keys(T).map(function(e){var t=T[e];return t.ready?t.ready():Promise.resolve()});return Promise.all(e)}function constructGlueObject(){var i=function(){w&&w.invoke("T42.ACS.Feedback",{},"best")},r={glueVersion:M.version};m.stop();var o={feedback:i,info:r,version:M.version,userConfig:e,done:function(){return b.logout(),Promise.resolve()}};if(o.performance={get browser(){return window.performance.timing.toJSON()},get memory(){return window.performance.memory},get initTimes(){var e=Object.keys(o).filter(function(e){return"initTimes"!==e&&o[e].initTime}).map(function(e){return{name:e,time:o[e].initTime,startTime:o[e].initStartTime,endTime:o[e].initEndTime}});return e.push({name:"glue",startTime:m.startTime,endTime:m.endTime,time:m.period}),e}},Object.keys(T).forEach(function(e){var t=T[e];o[e]=t,r[e]=t.version}),n&&n.perfDataNeeded&&n.updatePerfData){var a=n.perfDataDelay||100;setTimeout(function(){n.updatePerfData(o.performance)},a)}return g&&g.updatePerfData&&g.updatePerfData(o.performance),o.config={},t.enrichGlue&&t.enrichGlue(o),Object.keys(M).forEach(function(e){o.config[e]=M[e]}),t.extOptions&&Object.keys(t.extOptions).forEach(function(e){o.config[e]=t.extOptions[e]}),o}function setupBus(){if(!M.bus)return Promise.resolve(undefined);var e=d["default"](),t={connection:b,logger:_.subLogger("bus")};return new Promise(function(n,i){s["default"](t).then(function(t){I=t,registerLib("bus",I,e),n()})["catch"](function(e){return i(e)})})}var n,g,v=-1;"undefined"!=typeof window&&(v=p["default"].getGDMajorVersion(),2===v?n=window.htmlContainer:v>=3&&(g=window.glue42gd));var m=d["default"]();e=e||{},t=t||{};var b,w,_,S,A,C,I,M=c["default"](e,t,n,g,v),T={};return function(){var e=d["default"](),t={identity:M.identity,getConnection:function(){return b||u["default"]},publish:M.logger.publish||"off",console:M.logger.console||"info",metrics:M.metrics&&M.logger.metrics||"off"};return _=o["default"](t),registerLib("logger",_,e),Promise.resolve(undefined)}().then(setupConnection).then(function(){return Promise.all([setupMetrics(),setupAGM(),setupContexts(),setupBus()])}).then(function(){return setupExternalLibs(M.libs||[])}).then(waitForLibs).then(constructGlueObject)["catch"](function(e){return Promise.reject({err:e,libs:T})})};t["default"]=y},function(e,t){e.exports=function(e,t,n){for(var i=(2<<Math.log(t.length-1)/Math.LN2)-1,r=Math.ceil(1.6*i*n/t.length),o="";;)for(var a=e(r),s=0;s<r;s++){var c=a[s]&i;if(t[c]&&(o+=t[c],o.length===n))return o}}},function(e,t){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(n===setTimeout)return setTimeout(e,0);if((n===defaultSetTimout||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}function runClearTimeout(e){if(i===clearTimeout)return clearTimeout(e);if((i===defaultClearTimeout||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{return i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}function cleanUpNextTick(){s&&o&&(s=!1,o.length?a=o.concat(a):c=-1,a.length&&drainQueue())}function drainQueue(){if(!s){var e=runTimeout(cleanUpNextTick);s=!0;for(var t=a.length;t;){for(o=a,a=[];++c<t;)o&&o[c].run();c=-1,t=a.length}o=null,s=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var n,i,r=e.exports={};!function(){try{n="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){n=defaultSetTimout}try{i="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){i=defaultClearTimeout}}();var o,a=[],s=!1,c=-1;r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new Item(e,t)),1!==a.length||s||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=noop,r.addListener=noop,r.once=noop,r.off=noop,r.removeListener=noop,r.removeAllListeners=noop,r.emit=noop,r.prependListener=noop,r.prependOnceListener=noop,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";function build(e){var t="",n=Math.floor(.001*(Date.now()-a));return n===r?i++:(i=0,r=n),t+=o(s),t+=o(e),i>0&&(t+=o(i)),t+=o(n)}var i,r,o=n(20),a=(n(4),1459707606518),s=6;e.exports=build},function(e,t,n){"use strict";function generate(e){for(var t,n=0,a="";!t;)a+=o(r,i.get(),1),t=e<Math.pow(16,n+1),n++;return a}var i=n(4),r=n(23),o=n(17);e.exports=generate},function(e,t,n){"use strict";function seed(t){return i.seed(t),e.exports}function worker(t){return a=t,e.exports}function characters(e){return e!==undefined&&i.characters(e),i.shuffled()}function generate(){return r(a)}var i=n(4),r=n(19),o=n(22),a=n(25)||0;e.exports=generate,e.exports.generate=generate,e.exports.seed=seed,e.exports.worker=worker,e.exports.characters=characters,e.exports.isValid=o},function(e,t,n){"use strict";function isShortId(e){return!(!e||"string"!=typeof e||e.length<6)&&!new RegExp("[^"+i.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]").test(e)}var i=n(4);e.exports=isShortId},function(e,t,n){"use strict";var i,r="object"==typeof window&&(window.crypto||window.msCrypto);i=r&&r.getRandomValues?function(e){return r.getRandomValues(new Uint8Array(e))}:function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(256*Math.random()));return t},e.exports=i},function(e,t,n){"use strict";function getNextValue(){return(i=(9301*i+49297)%233280)/233280}function setSeed(e){i=e}var i=1;e.exports={nextValue:getNextValue,seed:setSeed}},function(e,t,n){"use strict";e.exports=0},function(e,t){function ws(e,t,n){return t?new i(e,t):new i(e)}var n=function(){return this}(),i=n.WebSocket||n.MozWebSocket;e.exports=i?ws:null,i&&(ws.prototype=i.prototype)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(28),r=n(49),o=function(){function AGMImpl(e,t,n,o,a){this.protocol=e,this.clientRepository=t,this.serverRepository=n,this.instance=o,this.configuration=a,this.client=new i["default"](e,t,o,a),this.server=new r["default"](e,n,o,a)}return AGMImpl.prototype.serverRemoved=function(e){return this.client.serverRemoved(e)},AGMImpl.prototype.serverAdded=function(e){return this.client.serverAdded(e)},AGMImpl.prototype.serverMethodRemoved=function(e){return this.client.serverMethodRemoved(e)},AGMImpl.prototype.serverMethodAdded=function(e){return this.client.serverMethodAdded(e)},AGMImpl.prototype.methodRemoved=function(e){return this.client.methodRemoved(e)},AGMImpl.prototype.methodAdded=function(e){return this.client.methodAdded(e)},AGMImpl.prototype.methodsForInstance=function(e){return this.client.methodsForInstance(e)},AGMImpl.prototype.methods=function(e){return this.client.methods(e)},AGMImpl.prototype.servers=function(e){return this.client.servers(e)},AGMImpl.prototype.subscribe=function(e,t,n,i){return this.client.subscribe(e,t,n,i)},AGMImpl.prototype.createStream=function(e,t,n,i){return this.server.createStream(e,t,n,i)},AGMImpl.prototype.unregister=function(e){return this.server.unregister(e)},AGMImpl.prototype.registerAsync=function(e,t){return this.server.registerAsync(e,t)},AGMImpl.prototype.register=function(e,t){return this.server.register(e,t)},AGMImpl.prototype.invoke=function(e,t,n,i,r,o){return this.client.invoke(e,t,n,i,r,o)},AGMImpl.prototype.updateInstance=function(e){this.instance.machine===undefined&&(this.instance.machine=e.MachineName||e.machine),this.instance.user===undefined&&(this.instance.user=e.UserName||e.user),this.instance.environment===undefined&&(this.instance.environment=e.Environment||e.environment),this.instance.region===undefined&&(this.instance.region=e.Region||e.region)},AGMImpl}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(29),r=n(8),o=function(){function Client(e,t,n,r){this.protocol=e,this.repo=t,this.instance=n,this.configuration=r,this.clientInvocations=new i["default"](e)}return Client.prototype.subscribe=function(e,t,n,i){var o=this,a=function(e,n,i,r){o.protocol.client.subscribe(n,t.arguments,e,{methodResponseTimeout:t.waitTimeoutMs},i,r)},s=new Promise(function(n,i){var r,s=function(e){n(e)},c=function(e){i(e)};r="string"==typeof e?{name:e}:e,t===undefined&&(t={});var u=t.target;u===undefined&&(u="best"),"string"==typeof u&&"all"!==u&&"best"!==u&&i({message:'"'+u+'" is not a valid target. Valid targets are "all", "best", or an instance.'}),t.methodResponseTimeout===undefined&&(t.methodResponseTimeout=t.method_response_timeout,t.methodResponseTimeout===undefined&&(t.methodResponseTimeout=o.configuration.methodResponseTimeout)),t.waitTimeoutMs===undefined&&(t.waitTimeoutMs=t.wait_for_method_timeout,t.waitTimeoutMs===undefined&&(t.waitTimeoutMs=o.configuration.waitTimeoutMs));var d=0,p=o.getServerMethodsByFilterAndTarget(r,u);if(p.length>0)a(p,p[0].methods[0],s,c);else{var f=function(){if(d+=500,p=o.getServerMethodsByFilterAndTarget(r,u),p.length>0){var n=p[0].methods[0];a(p,n,s,c)}else if(d>=t.waitTimeoutMs){var i="string"==typeof e?{name:e}:e,l={id:undefined,info:i,getInfoForUser:function(){return r},protocolState:undefined};a(p,l,s,c)}else setTimeout(f,500)};setTimeout(f,500)}});return r["default"](s,n,i)},Client.prototype.servers=function(e){return this.getServers(e).map(function(e){return e.server.getInfoForUser()})},Client.prototype.methods=function(e){return this.getMethods(e).map(function(e){return e.getInfoForUser()})},Client.prototype.methodsForInstance=function(e){return this.getMethodsForInstance(e).map(function(e){return e.getInfoForUser()})},Client.prototype.methodAdded=function(e){return this.repo.onMethodAdded(function(t){e(t.getInfoForUser())})},Client.prototype.methodRemoved=function(e){return this.repo.onMethodRemoved(function(t){e(t.getInfoForUser())})},Client.prototype.serverAdded=function(e){return this.repo.onServerAdded(function(t){e(t.getInfoForUser())})},Client.prototype.serverRemoved=function(e){return this.repo.onServerRemoved(function(t,n){e(t.getInfoForUser(),n)})},Client.prototype.serverMethodAdded=function(e){return this.repo.onServerMethodAdded(function(t,n){e({server:t.getInfoForUser(),method:n.getInfoForUser()})})},Client.prototype.serverMethodRemoved=function(e){return this.repo.onServerMethodRemoved(function(t,n){e({server:t.getInfoForUser(),method:n.getInfoForUser()})})},Client.prototype.invoke=function(e,t,n,i,o,a){var s=this,c=new Promise(function(r,o){var a=function(e){r(e)},c=function(e){o(e)};if(t||(t={}),n||(n="best"),"string"==typeof n&&"all"!==n&&"best"!==n&&o({message:'"'+n+'" is not a valid target. Valid targets are "all" and "best".'}),i||(i={}),i.methodResponseTimeoutMs===undefined&&(i.methodResponseTimeoutMs=i.method_response_timeout,i.methodResponseTimeoutMs===undefined&&(i.methodResponseTimeoutMs=s.configuration.methodResponseTimeout)),i.waitTimeoutMs===undefined&&(i.waitTimeoutMs=i.wait_for_method_timeout,i.waitTimeoutMs===undefined&&(i.waitTimeoutMs=s.configuration.waitTimeoutMs)),i.waitTimeoutMs!==undefined&&"number"!=typeof i.waitTimeoutMs)return void o({message:'"'+i.waitTimeoutMs+"\" is not a valid number for 'waitTimeoutMs'"});if("object"!=typeof t)return void o({message:"The method arguments must be an object."});"string"==typeof e&&(e={name:e});var u=s.getServerMethodsByFilterAndTarget(e,n);if(0===u.length)s.invokeUnExisting(e,t,n,i,a,c);else if(1===u.length){var d=u[0];s.clientInvocations.invoke(d.methods[0],t,d.server,i,a,c)}else s.invokeOnAll(u,t,i,a,c)});return r["default"](c,o,a)},Client.prototype.invokeUnExisting=function(e,t,n,i,r,o){var a=this,s=function(){o({method:e,called_with:t,message:"Can not find a method matching "+JSON.stringify(e)+" with server filter "+JSON.stringify(n),executed_by:undefined,returned:undefined,status:undefined})};if(0===i.waitTimeoutMs)s();else{var c=0,u=function(){c+=500,a.getServerMethodsByFilterAndTarget(e,n).length>0?a.invoke(e,t,n,i,r,o):c>=i.waitTimeoutMs?s():setTimeout(u,500)};setTimeout(u,500)}},Client.prototype.invokeOnAll=function(e,t,n,i,r){var o=this,a=[],s=[],c=function(e){a.push(e),d()},u=function(e){s.push(e),d()},d=function(){if(!(a.length+s.length<e.length))if(0!==a.length){var t=a.reduce(function(e,t){return e.method=t.method,e.called_with=t.called_with,e.returned=t.returned,e.all_return_values.push({executed_by:t.executed_by,returned:t.returned,called_with:t.called_with,method:t.method,message:undefined,status:undefined}),e.executed_by=t.executed_by,e},{all_return_values:[]});0!==s.length&&(t.all_errors=[],s.forEach(function(e){t.all_errors.push({executed_by:e.executed_by,called_with:e.called_with,name:e.method.name,message:e.message})})),i(t)}else 0!==s.length&&r(s.reduce(function(e,t){return e.method=t.method,e.called_with=t.called_with,e.message=t.message,e.all_errors.push({executed_by:t.executed_by,message:t.message}),e},{all_errors:[]}))};e.forEach(function(e){o.clientInvocations.invoke(e.methods[0],t,e.server,n,c,u)})},Client.prototype.filterByTarget=function(e,t){var n=this,i=[];if("string"==typeof e){if("all"===e)i=t;else if("best"===e){var r=t.filter(function(e){return e.server.info.machine===n.instance.machine})[0];if(r)return[r];i=t[0]!==undefined?[t[0]]:[]}}else Array.isArray(e)||(e=[e]),Array.isArray(e)&&(i=e.reduce(function(e,i){var r=t.filter(function(e){return n.instanceMatch(i,e.server.info)});return e.concat(r)},[]));return i},Client.prototype.instanceMatch=function(e,t){return this.containsProps(e,t)},Client.prototype.methodMatch=function(e,t){return this.containsProps(e,t)},Client.prototype.containsProps=function(e,t){return Object.keys(e).reduce(function(n,i){return e[i]&&"function"!=typeof e[i]?e[i].constructor===RegExp?!!e[i].test(t[i])&&n:String(e[i]).toLowerCase()===String(t[i]).toLowerCase()&&n:n},!0)},Client.prototype.getMethods=function(e){var t=this;return e===undefined?this.repo.getMethods():("string"==typeof e&&(e={name:e}),this.repo.getMethods().filter(function(n){return t.methodMatch(e,n.info)}))},Client.prototype.getMethodsForInstance=function(e){var t=this,n=this.repo.getServers(),i=n.filter(function(n){return t.instanceMatch(e,n.info)});if(0===i.length)return[];var r={};return 1===i.length?r=i[0].methods:i.forEach(function(e){Object.keys(e.methods).forEach(function(t){var n=e.methods[t];r[n.id]=n})}),Object.keys(r).map(function(e){return r[e]})},Client.prototype.getServers=function(e){var t=this,n=this.repo.getServers();return e===undefined?n.map(function(e){return{server:e}}):this.getMethods(e)===undefined?[]:n.reduce(function(n,i){var r=t.repo.getServerMethodsById(i.id),o=r.filter(function(n){return t.methodMatch(e,n.info)});return o.length>0&&n.push({server:i,methods:o}),n},[])},Client.prototype.getServerMethodsByFilterAndTarget=function(e,t){var n=this.getServers(e);return this.filterByTarget(t,n)},Client}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=function(){function ClientInvocations(e){var t=this;this._protocol=e,this._pendingCallbacks={},e.client.onInvocationResult(function(e,n,i,r,o){return t.processInvocationResult(e,n,i,r,o)})}return ClientInvocations.prototype.invoke=function(e,t,n,r,o,a){var s=i["default"]();this.registerInvocation(s,{method:e,calledWith:t},o,a,r.methodResponseTimeoutMs),this._protocol.client.invoke(s,e,t,n,r)},ClientInvocations.prototype.registerInvocation=function(e,t,n,i,r){var o=this;this._pendingCallbacks[e]={invocationInfo:t,success:n,error:i},setTimeout(function(){o._pendingCallbacks[e]!==undefined&&(i({method:t.method.getInfoForUser(),called_with:t.calledWith,executed_by:undefined,status:undefined,returned:undefined,message:"Invocation timeout ("+r+" ms) reached"}),delete o._pendingCallbacks[e])},r)},ClientInvocations.prototype.processInvocationResult=function(e,t,n,i,r){var o=this._pendingCallbacks[e];o!==undefined&&(0===n&&"function"==typeof o.success?o.success({method:o.invocationInfo.method.getInfoForUser(),called_with:o.invocationInfo.calledWith,executed_by:t,returned:i,message:r,status:n}):"function"==typeof o.error&&o.error({method:o.invocationInfo.method.getInfoForUser(),called_with:o.invocationInfo.calledWith,executed_by:t,message:r,status:n,returned:i}),delete this._pendingCallbacks[e])},ClientInvocations}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function ClientRepository(){this.servers={},this.methodsCount={},this.callbacks=i["default"]()}return ClientRepository.prototype.addServer=function(e,t){var n=this,i=this.servers[t];if(i)return i.id;var r={id:t,info:e,methods:{},getInfoForUser:function(){var e=n.createUserServerInfo(r.info);return e.getMethods=function(){return n.getServerMethodsById(r.id).map(function(e){return e.getInfoForUser()})},e.getStreams=function(){return n.getServerMethodsById(r.id).filter(function(e){return e.info.supportsStreaming}).map(function(e){return e.getInfoForUser()})},e}};return this.servers[t]=r,this.callbacks.execute("onServerAdded",r),t},ClientRepository.prototype.removeServerById=function(e,t){var n=this,i=this.servers[e];Object.keys(i.methods).forEach(function(t){n.removeServerMethod(e,t)}),delete this.servers[e],this.callbacks.execute("onServerRemoved",i,t)},ClientRepository.prototype.addServerMethod=function(e,t,n){n||(n={});var i=this.servers[e];if(!i)throw new Error("server does not exists");var r=this.createMethodId(t);if(!i.methods[r]){var o=this,a={id:r,info:t,getInfoForUser:function(){var e=o.createUserMethodInfo(a.info);return e.getServers=function(){return o.getServersByMethod(r)},e},protocolState:n};i.methods[r]=a,this.methodsCount[r]||(this.methodsCount[r]=0,this.callbacks.execute("onMethodAdded",a)),this.methodsCount[r]=this.methodsCount[r]+1,this.callbacks.execute("onServerMethodAdded",i,a)}},ClientRepository.prototype.createMethodId=function(e){var t=e.accepts!==undefined?e.accepts:"",n=e.returns!==undefined?e.returns:"";return(e.name+t+n).toLowerCase()},ClientRepository.prototype.removeServerMethod=function(e,t){var n=this.servers[e];if(!n)throw new Error("server does not exists");var i=n.methods[t];delete n.methods[t],this.methodsCount[t]=this.methodsCount[t]-1,0===this.methodsCount[t]&&this.callbacks.execute("onMethodRemoved",i),this.callbacks.execute("onServerMethodRemoved",n,i)},ClientRepository.prototype.getMethods=function(){var e=this,t={};return Object.keys(this.servers).forEach(function(n){var i=e.servers[n];Object.keys(i.methods).forEach(function(e){var n=i.methods[e];t[n.id]=n})}),Object.keys(t).map(function(e){return t[e]})},ClientRepository.prototype.getServers=function(){var e=this,t=[];return Object.keys(this.servers).forEach(function(n){var i=e.servers[n];t.push(i)}),t},ClientRepository.prototype.getServerMethodsById=function(e){var t=this.servers[e];return Object.keys(t.methods).map(function(e){return t.methods[e]})},ClientRepository.prototype.onServerAdded=function(e){var t=this.callbacks.add("onServerAdded",e);return this.getServers().forEach(function(t){e(t)}),t},ClientRepository.prototype.onMethodAdded=function(e){var t=this.callbacks.add("onMethodAdded",e);return this.getMethods().forEach(function(t){e(t)}),t},ClientRepository.prototype.onServerMethodAdded=function(e){var t=this.callbacks.add("onServerMethodAdded",e);return this.getServers().forEach(function(t){var n=t.methods;Object.keys(n).forEach(function(i){e(t,n[i])})}),t},ClientRepository.prototype.onMethodRemoved=function(e){return this.callbacks.add("onMethodRemoved",e)},ClientRepository.prototype.onServerRemoved=function(e){return this.callbacks.add("onServerRemoved",e)},ClientRepository.prototype.onServerMethodRemoved=function(e){return this.callbacks.add("onServerMethodRemoved",e)},ClientRepository.prototype.getServerById=function(e){return this.servers[e]},ClientRepository.prototype.reset=function(){this.servers={},this.methodsCount={}},ClientRepository.prototype.createUserServerInfo=function(e){return{machine:e.machine,pid:e.pid,user:e.user,application:e.application,environment:e.environment,region:e.region,instance:e.instance,windowId:e.windowId,peerId:e.peerId}},ClientRepository.prototype.createUserMethodInfo=function(e){var t={name:e.name,accepts:e.accepts,returns:e.returns,description:e.description,displayName:e.displayName,objectTypes:e.objectTypes,supportsStreaming:e.supportsStreaming};return t.object_types=e.objectTypes,t.display_name=e.displayName,t.version=e.version,t},ClientRepository.prototype.getServersByMethod=function(e){var t=this,n=[];return Object.keys(this.servers).forEach(function(i){var r=t.servers[i];Object.keys(r.methods).forEach(function(t){t===e&&n.push(r.getInfoForUser())})}),n},ClientRepository}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=function(){function NativeAGM(e,t,n){this.instance=e,this.helpers=t,this.agmFacade=n,this.protocolVersion=this.agmFacade.protocolVersion}return NativeAGM.prototype.register=function(e,t){var n=this.helpers.stringToObject(e,"name");this.helpers.validateMethodInfo(n),this.protocolVersion&&this.protocolVersion>=3?this.agmFacade.register(JSON.stringify(n),t,!0):this.agmFacade.register(JSON.stringify(n),function(e,n){var i=t(JSON.parse(e),n);return JSON.stringify(i)})},NativeAGM.prototype.registerAsync=function(e,t){if(!this.agmFacade.registerAsync)throw new Error("not supported in that version of HtmlContainer");var n=this.helpers.stringToObject(e,"name");this.helpers.validateMethodInfo(n),this.agmFacade.registerAsync(n,function(e,n,i){t(e,n,function(e){i.success(e)},function(e){i.error(e)})})},NativeAGM.prototype.unregister=function(e){this.agmFacade.unregister(JSON.stringify(this.helpers.stringToObject(e,"name")))},NativeAGM.prototype.invoke=function(e,t,n,r,o,a){var s=this,c=new Promise(function(i,o){if(t===undefined&&(t={}),"object"!=typeof t&&o({message:"The method arguments must be an object."}),r===undefined&&(r={}),n=s.helpers.targetArgToObject(n),s.agmFacade.invoke2)s.agmFacade.invoke2(JSON.stringify(s.helpers.stringToObject(e,"name")),t,JSON.stringify(n),JSON.stringify(r),function(e){i(e)},function(e){o(e)});else{var a=void 0,c=void 0;a=function(e){var t=JSON.parse(e);i(t)},c=function(e){var t=JSON.parse(e);o(t)},s.agmFacade.invoke(JSON.stringify(s.helpers.stringToObject(e,"name")),JSON.stringify(t),JSON.stringify(n),JSON.stringify(r),a,c)}});return i["default"](c,o,a)},NativeAGM.prototype.createStream=function(e,t,n,r){var o=this,a=new Promise(function(n,i){"string"==typeof e&&(e={name:e,getServers:function(){return[]}}),t||(t={subscriptionRequestHandler:undefined,subscriptionAddedHandler:undefined,subscriptionRemovedHandler:undefined}),o.agmFacade.createStream2(JSON.stringify(e),t.subscriptionRequestHandler,t.subscriptionAddedHandler,t.subscriptionRemovedHandler,function(e){n(e)},function(e){i(e)})});return i["default"](a,n,r)},NativeAGM.prototype.subscribe=function(e,t,n,r){var o=this,a=new Promise(function(n,i){void 0===e&&i("method definition param is required"),t===undefined&&(t={}),t.args=JSON.stringify(t.arguments||{}),t.target=o.helpers.targetArgToObject(t.target);var r;r="string"==typeof e?e:e.name,o.agmFacade.subscribe2(r,JSON.stringify(t),function(e){n(e)},function(e){i(e)})});return i["default"](a,n,r)},NativeAGM.prototype.servers=function(e){var t=this,n=this.agmFacade.servers(JSON.stringify(this.helpers.stringToObject(e,"name")));return this.helpers.agmParse(n).map(function(e){return t.transformServerObject(e)})},NativeAGM.prototype.methods=function(e){var t=this,n=this.agmFacade.methods(JSON.stringify(this.helpers.stringToObject(e,"name")));return this.helpers.agmParse(n).map(function(e){return t.transformMethodObject(e)})},NativeAGM.prototype.methodAdded=function(e){var t=this,n=!0;return this.agmFacade.methodAdded(function(i){n&&e(t.transformMethodObject(i))}),function(){n=!1}},NativeAGM.prototype.methodRemoved=function(e){var t=this,n=!0;return this.agmFacade.methodRemoved(function(i){n&&e(t.transformMethodObject(i))}),function(){n=!1}},NativeAGM.prototype.serverAdded=function(e){var t=this,n=!0;return this.agmFacade.serverAdded(function(i){n&&e(t.transformServerObject(i))}),function(){n=!1}},NativeAGM.prototype.serverRemoved=function(e){var t=this,n=!0;return this.agmFacade.serverRemoved(function(i){n&&e(t.transformServerObject(i))}),function(){n=!1}},NativeAGM.prototype.serverMethodAdded=function(e){var t=this,n=!0;return this.agmFacade.serverMethodAdded(function(i){n&&e({server:t.transformServerObject(i.server),method:t.transformMethodObject(i.method)})}),function(){n=!1}},NativeAGM.prototype.serverMethodRemoved=function(e){var t=this,n=!0;return this.agmFacade.serverMethodRemoved(function(i){n&&e({server:t.transformServerObject(i.server),method:t.transformMethodObject(i.method)})}),function(){n=!1}},NativeAGM.prototype.methodsForInstance=function(e){var t=this.agmFacade.methodsForInstance(JSON.stringify(e));return this.helpers.agmParse(t).map(this.transformMethodObject)},NativeAGM.prototype.transformMethodObject=function(e){var t=this;return e?(e.displayName||(e.displayName=e.display_name),e.objectTypes||(e.objectTypes=e.object_types),e.getServers=function(){return t.servers(e.name)},e):undefined},NativeAGM.prototype.transformServerObject=function(e){var t=this;return e?(e.getMethods=function(){return t.methodsForInstance(e)},e.getStreams=function(){return t.methodsForInstance(e).filter(function(e){return e.supportsStreaming})},e):undefined},NativeAGM}();t.NativeAGM=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function Helpers(e){this.facade=e,this.dateTimeIdentifier=e.jsonValueDatePrefix,this.lenOfIdentifier=this.dateTimeIdentifier.length}return Helpers.prototype.agmParse=function(e){var t=this;return JSON.parse(e,function(e,n){if("string"!=typeof n)return n;if(n[0]!==t.dateTimeIdentifier[0])return n;if(0!==n.indexOf(t.dateTimeIdentifier))return n;var i=n.substr(t.lenOfIdentifier);return new Date(parseFloat(i))})},Helpers.prototype.targetArgToObject=function(e){var t=this;if("string"==typeof(e=e||"best")){if("all"!==e&&"best"!==e)throw new Error(e+" is not a valid target. Valid targets are 'all' and 'best'");return{target:e}}return Array.isArray(e)||(e=[e]),e=e.map(function(e){return t.convertInstanceToRegex(e)}),{serverFilter:e}},Helpers.prototype.convertInstanceToRegex=function(e){var t={};return Object.keys(e).forEach(function(n){var i=e[n];t[n]=i,void 0!==i&&null!==i&&("string"==typeof i&&""!==i?t[n]="^"+e[n]+"$":e[n].constructor===RegExp?t[n]=e[n].source:t[n]=e[n])}),t},Helpers.prototype.validateMethodInfo=function(e){if(void 0===e)throw Error("methodInfo is required argument");if(!e.name)throw Error("methodInfo object must contain name property");e.objectTypes&&(e.object_types=e.objectTypes),e.displayName&&(e.display_name=e.displayName)},Helpers.prototype.stringToObject=function(e,t){if("string"==typeof e){var n={};return n[t]=e,n}return e},Helpers}();t.Helpers=i},function(e,t,n){"use strict";function default_1(e){var t=window.htmlContainer.jsAgmFacade,n=o(e);return new Promise(function(e,o){var a=function(n){var o=new i.NativeAGM(n,new r.Helpers(t),t);o.create_stream=o.createStream,o.methods_for_instance=o.methodsForInstance,o.method_added=o.methodAdded,o.method_removed=o.methodRemoved,o.server_added=o.serverAdded,o.server_removed=o.serverRemoved,o.server_method_added=o.serverMethodAdded,o.server_method_removed=o.serverMethodRemoved,e(o)};if(t.protocolVersion&&t.protocolVersion>=5&&t.initAsync)t.initAsync(n,a,function(e){o(e)});else{a(t.init(n))}})}Object.defineProperty(t,"__esModule",{value:!0});var i=n(31),r=n(32);t["default"]=default_1;var o=function(e){if(e!==undefined&&e.metrics!==undefined){e.metrics.metricsIdentity=e.metrics.identity;var t={metricsIdentity:e.metrics.metricsIdentity,path:e.metrics.path};e.metrics=t}return delete e.logger,JSON.stringify(e)}},function(e,t,n){"use strict";(function(e){function createOwnInstance(t,n,r){var o=e.document||e.process,a={application:o.title+i["default"](),pid:Math.floor(1e10*Math.random())};return a.peerId=r,"object"==typeof t&&(t.application!==undefined&&(a.application=t.application),a.machine=t.machine,a.user=t.user,a.environment=t.environment,a.region=t.region),void 0!==n&&(a.user=n.user,a.instance=n.instance,a.application=n.application,a.pid=n.process,a.machine=n.machine,a.environment=n.environment,a.region=n.region,a.windowId=n.windowId),a}Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.createOwnInstance=createOwnInstance}).call(t,n(7))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(34),r=n(33),o=n(38),a=n(43),s=n(27),c=n(30),u=n(47);t["default"]=function(e){if(!e.forceGW&&2===e.gdVersion)return r["default"](e);if(void 0===e)throw new Error("configuration is required");if("undefined"==typeof e.connection)throw new Error("configuration.connections is required");var t=e.connection;"number"!=typeof e.methodResponseTimeout&&(e.methodResponseTimeout=3e3),"number"!=typeof e.waitTimeoutMs&&(e.waitTimeoutMs=3e3);var n,d,p=t.resolvedIdentity,f=i.createOwnInstance(e.instance,p,t.peerId),l=new c["default"],h=new u["default"];return n=3===t.protocolVersion?a["default"](f,t,l,h,e,function(){return d}):o["default"](f,t,l,h,e,function(){return d}),new Promise(function(t,i){n.then(function(n){d=new s["default"](n,l,h,f,e),t(d)})["catch"](function(e){i(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(5),o=function(){function ClientStreaming(e,t,n,i){this.configuration=e,this.instance=t,this.sendRequest=n,this.nextResponseSubject=i,this.subscriptionsList={}}return ClientStreaming.prototype.subscribe=function(e,t,n,o,a,s){var c=this;if(0===n.length)return void s({method:e.getInfoForUser(),message:"Subscription failed. No available servers matched the target params.",called_with:t});var u="subscriptionId_"+i["default"](),d=this.registerSubscription(u,e,t,a,s,o.methodResponseTimeout);if("object"!=typeof d)return void s({method:e.getInfoForUser(),message:"Subscription failed. Unable to register the user callbacks.",called_with:t});n.forEach(function(n){var i=c.nextResponseSubject(),a=e.info.requestSubject;d.trackedServers.push({server:undefined,streamId:undefined,streamSubjects:{global:undefined,private:undefined},methodRequestSubject:a,methodResponseSubject:i});var s={EventStreamAction:1,MethodRequestSubject:a,MethodResponseSubject:i,Client:r.convertInstance(c.instance),Context:{ArgumentsJson:t,InvocationId:u,MethodName:e.info.name,ExecutionServer:n.server.info,Timeout:o.methodResponseTimeout}};c.sendRequest(s)})},ClientStreaming.prototype.processPublisherMsg=function(e){e&&e.EventStreamAction&&0!==e.EventStreamAction&&(2===e.EventStreamAction?this.serverIsKickingASubscriber(e):3===e.EventStreamAction?this.serverAcknowledgesGoodSubscription(e):5===e.EventStreamAction&&this.serverHasPushedSomeDataIntoTheStream(e))},ClientStreaming.prototype.registerSubscription=function(e,t,n,i,r,o){var a=this;return this.subscriptionsList[e]={status:"awaitingAccept",method:t,arguments:n,success:i,error:r,trackedServers:[],handlers:{onData:[],onClosed:[]},queued:{data:[],closers:[]},timeoutId:undefined},this.subscriptionsList[e].timeoutId=setTimeout(function(){if(a.subscriptionsList[e]!==undefined){var i=a.subscriptionsList[e];if("awaitingAccept"===i.status)r({method:t,called_with:n,message:"Subscription failed. Subscription attempt timed out after "+o+"ms."}),delete a.subscriptionsList[e];else if("subscribed"===i.status&&i.trackedServers.length>0&&(i.trackedServers=i.trackedServers.filter(function(e){return"string"==typeof e.streamId&&""!==e.streamId}),i.timeoutId=undefined,0===i.trackedServers.length)){var s=i.queued.closers.length,c=s>0?i.queued.closers[s-1]:null;i.handlers.onClosed.forEach(function(e){"function"==typeof e&&e({message:"ServerInitiated",requestArguments:i.arguments,server:c,stream:i.method})}),delete a.subscriptionsList[e]}}},o),this.subscriptionsList[e]},ClientStreaming.prototype.serverIsKickingASubscriber=function(e){var t=this,n=Object.keys(this.subscriptionsList);"string"==typeof e.InvocationId&&""!==e.InvocationId&&(n=n.filter(function(t){return t===e.InvocationId}));var i=[];n.forEach(function(n){"object"==typeof t.subscriptionsList[n]&&(t.subscriptionsList[n].trackedServers=t.subscriptionsList[n].trackedServers.filter(function(t){var n=t.methodRequestSubject===e.MethodRequestSubject&&t.methodResponseSubject===e.MethodResponseSubject,i=t.streamId===e.StreamId&&(t.streamSubjects.global===e.EventStreamSubject||t.streamSubjects["private"]===e.EventStreamSubject);return!(n||i)}),0===t.subscriptionsList[n].trackedServers.length&&i.push(n))}),i.forEach(function(n){if("object"==typeof t.subscriptionsList[n]){if("awaitingAccept"===t.subscriptionsList[n].status&&"number"==typeof t.subscriptionsList[n].timeoutId){var i="string"==typeof e.ResultMessage&&""!==e.ResultMessage?' Publisher said "'+e.ResultMessage+'".':" No reason given.",o="object"==typeof t.subscriptionsList[n].arguments?JSON.stringify(t.subscriptionsList[n].arguments):"{}";t.subscriptionsList[n].error("Subscription rejected."+i+" Called with:"+o),clearTimeout(t.subscriptionsList[n].timeoutId)}else t.subscriptionsList[n].handlers.onClosed.forEach(function(i){"function"==typeof i&&i({message:"ServerInitiated",requestArguments:t.subscriptionsList[n].arguments,server:r.convertInfoToInstance(e.Server),stream:t.subscriptionsList[n].method})});delete t.subscriptionsList[n]}})},ClientStreaming.prototype.serverAcknowledgesGoodSubscription=function(e){var t=this,n=e.InvocationId,i=this.subscriptionsList[n];if("object"==typeof i){var o=i.trackedServers.filter(function(t){return t.methodRequestSubject===e.MethodRequestSubject&&t.methodResponseSubject===e.MethodResponseSubject})[0];if("object"==typeof o){var a="awaitingAccept"===i.status;i.status="subscribed";var s=this.generatePrivateStreamSubject(i.method.name);if("string"!=typeof o.streamId||""===o.streamId){o.server=r.convertInfoToInstance(e.Server),o.streamId=e.StreamId,o.streamSubjects.global=e.EventStreamSubject,o.streamSubjects["private"]=s;var c={EventStreamAction:3,EventStreamSubject:s,StreamId:e.StreamId,MethodRequestSubject:e.MethodRequestSubject,MethodResponseSubject:o.methodResponseSubject,Client:r.convertInstance(this.instance),Context:{ArgumentsJson:i.arguments,MethodName:i.method.name}};this.sendRequest(c),a&&i.success({onData:function(e){if("function"!=typeof e)throw new TypeError("The data callback must be a function.");this.handlers.onData.push(e),1===this.handlers.onData.length&&this.queued.data.length>0&&this.queued.data.forEach(function(t){e(t)})}.bind(i),onClosed:function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");this.handlers.onClosed.push(e)}.bind(i),onFailed:function(){},close:function(){return t.closeSubscription(i,n)},requestArguments:i.arguments,serverInstance:r.convertInfoToInstance(e.Server),stream:i.method})}}}},ClientStreaming.prototype.serverHasPushedSomeDataIntoTheStream=function(e){var t=this;for(var n in this.subscriptionsList)!function(n){if(t.subscriptionsList.hasOwnProperty(n)&&"object"==typeof t.subscriptionsList[n]){var i=void 0,o=t.subscriptionsList[n].trackedServers.filter(function(t){return t.streamId===e.StreamId&&(t.streamSubjects.global===e.EventStreamSubject||t.streamSubjects["private"]===e.EventStreamSubject)});if(0===o.length?i=undefined:o[0].streamSubjects.global===e.EventStreamSubject?i=!1:o[0].streamSubjects["private"]===e.EventStreamSubject&&(i=!0),i!==undefined){var a={data:e.ResultContextJson,server:r.convertInfoToInstance(e.Server),requestArguments:t.subscriptionsList[n].arguments||{},message:e.ResultMessage,private:i},s=t.subscriptionsList[n].handlers.onData,c=t.subscriptionsList[n].queued.data;Array.isArray(s)&&(s.length>0?s.forEach(function(e){"function"==typeof e&&e(a)}):c.push(a))}}}(n)},ClientStreaming.prototype.closeSubscription=function(e,t){var n=this,i=this.nextResponseSubject();e.trackedServers.forEach(function(e){n.sendRequest({EventStreamAction:2,Client:r.convertInstance(n.instance),MethodRequestSubject:e.methodRequestSubject,MethodResponseSubject:i,StreamId:e.streamId,EventStreamSubject:e.streamSubjects["private"]})}),e.handlers.onClosed.forEach(function(t){"function"==typeof t&&t({message:"ClientInitiated",requestArguments:e.arguments||{},server:e.trackedServers[e.trackedServers.length-1].server,stream:e.method})}),delete this.subscriptionsList[t]},ClientStreaming.prototype.generatePrivateStreamSubject=function(e){return"ESSpriv-jsb_"+r.convertInstance(this.instance).ApplicationName+"_on_"+e+"_"+i["default"]()},ClientStreaming}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(1),o=n(36),a=n(5),s=function(){function ClientProtocol(e,t,n,i){var a=this;this.connection=e,this.instance=t,this.configuration=n,this.repository=i,this.respCounter=0,this.callbacks=r["default"](),this.timers={},this.timers={},this.streaming=new o["default"](n,t,function(t){e.send("agm","MethodInvocationRequestMessage",t)},function(){return a.nextResponseSubject()}),this.listenForEvents()}return ClientProtocol.prototype.subscribe=function(e,t,n,i,r,o){this.streaming.subscribe(e,t,n,i,r,o)},ClientProtocol.prototype.onInvocationResult=function(e){this.callbacks.add("onResult",e)},ClientProtocol.prototype.invoke=function(e,t,n,i,r){var o=t.info,s={MethodRequestSubject:o.requestSubject,MethodResponseSubject:this.nextResponseSubject(),Client:a.convertInstance(this.instance),Context:{ArgumentsJson:n,InvocationId:e,MethodName:o.name,ExecutionServer:i.info,Timeout:r.methodResponseTimeoutMs}};this.connection.send("agm","MethodInvocationRequestMessage",s)},ClientProtocol.prototype.nextResponseSubject=function(){return"resp_"+this.respCounter+++"_"+i["default"]()},ClientProtocol.prototype.createServerInfo=function(e){return{machine:e.MachineName,pid:e.ProcessId,user:e.UserName,application:e.ApplicationName,environment:e.Environment,region:e.Region}},ClientProtocol.prototype.createMethod=function(e){var t=e.Method;return{name:t.Name,accepts:t.InputSignature,returns:t.ResultSignature,requestSubject:e.MethodRequestSubject,description:t.Description,displayName:t.DisplayName,version:t.Version,objectTypes:t.ObjectTypeRestrictions,supportsStreaming:a.isStreamingFlagSet(t.Flags)}},ClientProtocol.prototype.createServerId=function(e){return e===undefined?undefined:[e.application,e.user,e.machine,e.started,e.pid].join("/").toLowerCase()},ClientProtocol.prototype.processServerPresence=function(e,t){var n=e.Instance,i=this.createServerInfo(n),r=this.createServerId(i);if(t)r=this.repository.addServer(i,r),e.PublishingInterval&&this.scheduleTimeout(r,e.PublishingInterval);else if(0===e.PublishingInterval){var o=this.repository.getServerById(r);void 0!==o&&this.repository.removeServerById(r)}e.MethodDefinitions!==undefined&&this.updateServerMethods(r,e.MethodDefinitions)},ClientProtocol.prototype.scheduleTimeout=function(e,t){var n=this;if(-1!==t){var i=this.timers[e];i!==undefined&&clearTimeout(i),this.timers[e]=setTimeout(function(){n.repository.removeServerById(e)},4*t)}},ClientProtocol.prototype.updateServerMethods=function(e,t){var n=this,i=this.repository.getServerMethodsById(e),r=t.map(function(e){return n.createMethod(e)}).reduce(function(e,t){return e[n.repository.createMethodId(t)]=t,e},{});i.forEach(function(t){r[t.id]===undefined?n.repository.removeServerMethod(e,t.id):delete r[t.id]}),Object.keys(r).forEach(function(t){var i=r[t];n.repository.addServerMethod(e,i)})},ClientProtocol.prototype.handleInvokeResultMessage=function(e){if(e&&e.EventStreamAction&&0!==e.EventStreamAction)return void this.streaming.processPublisherMsg(e);var t=e.Server?this.createServerInfo(e.Server):undefined,n=e.ResultContextJson;n&&0===Object.keys(n).length&&(n=undefined),this.callbacks.execute("onResult",e.InvocationId,t,e.Status,n,e.ResultMessage)},ClientProtocol.prototype.listenForEvents=function(){var e=this;this.connection.on("agm","ServerPresenceMessage",function(t){e.processServerPresence(t,!0)}),this.connection.on("agm","ServerHeartbeatMessage",function(t){e.processServerPresence(t,!1)}),this.connection.on("agm","MethodInvocationResultMessage",function(t){e.handleInvokeResultMessage(t)})},ClientProtocol}();t["default"]=s},function(e,t,n){"use strict";function default_1(e,t,n,o,a,s){var c=t.on("agm","Instance",function(e){s().updateInstance(e),t.off(c)}),u=new i["default"](t,e,a,o),d=new r["default"](t,e,a,n);return new Promise(function(e){e({server:u,client:d})})}Object.defineProperty(t,"__esModule",{value:!0});var i=n(40),r=n(37);t["default"]=default_1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(5),o=function(){function ServerStreaming(e,t){this.connection=e,this.instance=t}return ServerStreaming.prototype.isStreamMsg=function(e,t){return e&&e.EventStreamAction&&0!==e.EventStreamAction&&"object"==typeof t&&!0===t.definition.supportsStreaming},ServerStreaming.prototype.pushData=function(e,t,n){var i=this;if("object"==typeof e&&Array.isArray(e.protocolState.branchKeyToStreamIdMap)){if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof n?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=null);var o=e.protocolState.branchKeyToStreamIdMap.filter(function(e){return null===n||Boolean(e)&&"string"==typeof e.key&&n.indexOf(e.key)>=0}).map(function(e){return e.streamId}),a=r.convertInstance(this.instance);o.forEach(function(n){i.sendResult({EventStreamAction:5,EventStreamSubject:e.protocolState.globalEventStreamSubject,MethodName:e.protocolState.method.Method.Name,MethodRequestSubject:e.protocolState.method.MethodRequestSubject,ResultContextJson:t,Server:a,StreamId:n})})}},ServerStreaming.prototype.closeAllSubscriptions=function(e,t){var n=this;if("object"==typeof e&&Array.isArray(e.protocolState.branchKeyToStreamIdMap)){var i=e.protocolState.branchKeyToStreamIdMap;"string"==typeof t&&(i=e.protocolState.branchKeyToStreamIdMap.filter(function(e){return"object"==typeof e&&e.key===t})),i.forEach(function(t){var i=t.streamId;n.sendResult({EventStreamAction:2,EventStreamSubject:e.protocolState.globalEventStreamSubject,MethodName:e.protocolState.method.Method.Name,MethodRequestSubject:e.protocolState.method.MethodRequestSubject,Server:r.convertInstance(n.instance),StreamId:i,Status:0})})}},ServerStreaming.prototype.getBranchList=function(e){return"object"!=typeof e?[]:this.getUniqueBranchNames(e)},ServerStreaming.prototype.getSubscriptionList=function(e,t){if("object"!=typeof e)return[];return"string"!=typeof t?e.protocolState.subscriptions:e.protocolState.subscriptions.filter(function(e){return e.branchKey===t})},ServerStreaming.prototype.onSubAdded=function(e){"function"==typeof e&&(this.subAddedHandler=e)},ServerStreaming.prototype.onSubRemoved=function(e){"function"==typeof e&&(this.subRemovedHandler=e)},ServerStreaming.prototype.onSubRequest=function(e){"function"==typeof e&&(this.requestHandler=e)},ServerStreaming.prototype.generateNewStreamId=function(e){return"streamId-jsb_of_"+e+"__by_"+r.convertInstance(this.instance).ApplicationName+"_"+i["default"]()},ServerStreaming.prototype.rejectRequest=function(e,t,n){"string"!=typeof n&&(n="");var i=e.msg;this.sendResult({EventStreamAction:2,EventStreamSubject:t.protocolState.globalEventStreamSubject,MethodName:t.protocolState.method.Method.Name,MethodRequestSubject:t.protocolState.method.MethodRequestSubject,MethodResponseSubject:i.MethodResponseSubject,MethodVersion:t.protocolState.method.Method.Version,ResultMessage:n,Server:r.convertInstance(this.instance),StreamId:"default_rejection_streamId"})},ServerStreaming.prototype.pushDataToSingle=function(e,t,n){if("object"!=typeof n)throw new Error("Invalid arguments. Data must be an object.");this.sendResult({EventStreamAction:5,EventStreamSubject:t.privateEventStreamSubject,MethodName:e.protocolState.method.Method.Name,MethodRequestSubject:e.protocolState.method.MethodRequestSubject,ResultContextJson:n,Server:r.convertInstance(this.instance),StreamId:t.streamId})},ServerStreaming.prototype.closeSingleSubscription=function(e,t){this.closeIndividualSubscription(e,t.streamId,t.privateEventStreamSubject,!0)},ServerStreaming.prototype.acceptRequestOnBranch=function(e,t,n){"string"!=typeof n&&(n="");var i=this.getStreamId(t,n),o=e.msg;this.sendResult({EventStreamAction:3,EventStreamSubject:t.protocolState.globalEventStreamSubject,InvocationId:o.Context.InvocationId,MethodName:t.protocolState.method.Method.Name,MethodRequestSubject:t.protocolState.method.MethodRequestSubject,MethodResponseSubject:o.MethodResponseSubject,MethodVersion:t.protocolState.method.Method.Version,ResultMessage:"Accepted",Server:r.convertInstance(this.instance),StreamId:i})},ServerStreaming.prototype.processSubscriberMsg=function(e,t){e&&e.EventStreamAction&&0!==e.EventStreamAction&&(1===e.EventStreamAction?this.clientWishesToSubscribe(e,t):2===e.EventStreamAction?this.clientWishesToUnsubscribe(e,t):3===e.EventStreamAction?this.clientAcknowledgesItDidSubscribe(e,t):4===e.EventStreamAction&&this.clientPerSubHeartbeat(e))},ServerStreaming.prototype.sendResult=function(e){if("object"!=typeof e)throw new Error("Invalid message.");"number"!=typeof e.Status&&(e.Status=0),this.connection.send("agm","MethodInvocationResultMessage",e)},ServerStreaming.prototype.clientWishesToSubscribe=function(e,t){var n={msg:e,arguments:e.Context.ArgumentsJson||{},instance:r.convertInfoToInstance(e.Client)};"function"==typeof this.requestHandler&&this.requestHandler(n,t)},ServerStreaming.prototype.clientWishesToUnsubscribe=function(e,t){t&&Array.isArray(t.protocolState.subscriptions)&&t.protocolState.subscriptions.length>0&&this.closeIndividualSubscription(t,e.StreamId,e.EventStreamSubject,!1)},ServerStreaming.prototype.clientAcknowledgesItDidSubscribe=function(e,t){if("string"==typeof e.StreamId&&""!==e.StreamId){var n=this.getBranchKey(t,e.StreamId);if("string"==typeof n&&Array.isArray(t.protocolState.subscriptions)){var i={branchKey:n,instance:r.convertInfoToInstance(e.Client),arguments:e.Context.ArgumentsJson,streamId:e.StreamId,privateEventStreamSubject:e.EventStreamSubject,methodResponseSubject:e.MethodResponseSubject};t.protocolState.subscriptions.push(i),"function"==typeof this.subAddedHandler&&this.subAddedHandler(i,t)}}},ServerStreaming.prototype.clientPerSubHeartbeat=function(e){},ServerStreaming.prototype.getBranchKey=function(e,t){if("string"==typeof t&&"object"==typeof e){var n=e.protocolState.branchKeyToStreamIdMap.filter(function(e){return e.streamId===t})[0];if("object"==typeof n&&"string"==typeof n.key)return n.key}},ServerStreaming.prototype.getStreamId=function(e,t){"string"!=typeof t&&(t="");var n=e.protocolState.branchKeyToStreamIdMap.filter(function(e){return e.key===t})[0],i=n?n.streamId:undefined;return"string"==typeof i&&""!==i||(i=this.generateNewStreamId(e.protocolState.method.Method.Name),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:i})),i},ServerStreaming.prototype.closeIndividualSubscription=function(e,t,n,i){var o=e.protocolState.subscriptions.filter(function(e){return e.privateEventStreamSubject===n&&e.streamId===t})[0];if("object"==typeof o){var a=e.protocolState.subscriptions.length;e.protocolState.subscriptions=e.protocolState.subscriptions.filter(function(e){return!(e.privateEventStreamSubject===o.privateEventStreamSubject&&e.streamId===o.streamId)});e.protocolState.subscriptions.length===a-1&&(!0===i&&this.sendResult({EventStreamAction:2,EventStreamSubject:n,MethodName:e.protocolState.method.Method.Name,MethodRequestSubject:e.protocolState.method.MethodRequestSubject,MethodResponseSubject:o.methodResponseSubject,MethodVersion:e.protocolState.method.Method.Version,ResponseContextJson:{},Server:r.convertInstance(this.instance),StreamId:o.streamId,Status:0}),"function"==typeof this.subRemovedHandler&&this.subRemovedHandler(o,e))}},ServerStreaming.prototype.getUniqueBranchNames=function(e){var t=e.protocolState.subscriptions.map(function(e){var t=null;return"object"==typeof e&&"string"==typeof e.branchKey&&(t=e.branchKey),t}),n=[];return t.filter(function(e){return!(null===e||n.indexOf(e)>=0)&&(n.push(e),!0)})},ServerStreaming}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),r=n(39),o=n(1),a=n(5),s=5e3,c=function(){function ServerProtocol(e,t,n,i){var a=this;this.connection=e,this.instance=t,this.serverRepository=i,this.invocationMessagesMap={},this.reqCounter=0,this.callbacks=o["default"](),this.streaming=new r["default"](e,t),e.on("agm","MethodInvocationRequestMessage",function(e){return a.handleMethodInvocationMessage(e)}),e.disconnected(this.stopTimers.bind(this)),this.sendHeartbeat(),this.heartbeatTimer===undefined&&(this.heartbeatTimer=setInterval(function(){return a.sendHeartbeat()},s)),this.getBranchList=this.streaming.getBranchList,this.getSubscriptionList=this.streaming.getSubscriptionList,this.closeAllSubscriptions=this.streaming.closeAllSubscriptions,this.closeSingleSubscription=this.streaming.closeSingleSubscription,this.pushDataToSingle=this.streaming.pushDataToSingle,this.pushData=this.streaming.pushData,this.onSubRequest=this.streaming.onSubRequest,this.acceptRequestOnBranch=this.streaming.acceptRequestOnBranch,this.rejectRequest=this.streaming.rejectRequest,this.onSubAdded=this.streaming.onSubAdded,this.onSubRemoved=this.streaming.onSubRemoved}return ServerProtocol.prototype.stopTimers=function(){clearInterval(this.presenceTimer),clearInterval(this.heartbeatTimer)},ServerProtocol.prototype.unregister=function(e){return this.sendPresence(),Promise.resolve()},ServerProtocol.prototype.register=function(e,t,n){var i=this.nextRequestSubject();return e.protocolState.method=this.createNewMethodMessage(e.definition,i,!1),this.announceNewMethod(),t(),Promise.resolve()},ServerProtocol.prototype.createStream=function(e,t,n){var r=this.nextRequestSubject(),o=this.createNewMethodMessage(e.definition,r,!0);e.protocolState.method=o,e.protocolState.globalEventStreamSubject=e.definition.name+".jsStream."+i["default"](),e.protocolState.subscriptions=[],e.protocolState.branchKeyToStreamIdMap=[],this.announceNewMethod(),t()},ServerProtocol.prototype.onInvoked=function(e){this.callbacks.add("onInvoked",e)},ServerProtocol.prototype.methodInvocationResult=function(e,t,n,i){var r=this.invocationMessagesMap[t];if(r&&"null"!==r.MethodResponseSubject&&e!==undefined){var o={MethodRequestSubject:r.MethodRequestSubject,MethodResponseSubject:r.MethodResponseSubject,MethodName:e.protocolState.method.Method.Name,InvocationId:t,ResultContextJson:i,Server:a.convertInstance(this.instance),ResultMessage:n,Status:n?1:0};this.connection.send("agm","MethodInvocationResultMessage",o),delete this.invocationMessagesMap[t]}},ServerProtocol.prototype.nextRequestSubject=function(){return"req_"+this.reqCounter+++"_"+i["default"]()},ServerProtocol.prototype.sendHeartbeat=function(){this.connection.send("agm","ServerHeartbeatMessage",this.constructHeartbeat())},ServerProtocol.prototype.constructHeartbeat=function(){return{PublishingInterval:s,Instance:a.convertInstance(this.instance)}},ServerProtocol.prototype.constructPresence=function(){var e=this.serverRepository.getList();return{PublishingInterval:1e4,Instance:a.convertInstance(this.instance),MethodDefinitions:e.map(function(e){return e.protocolState.method})}},ServerProtocol.prototype.sendPresence=function(){this.connection.send("agm","ServerPresenceMessage",this.constructPresence())},ServerProtocol.prototype.announceNewMethod=function(){var e=this;this.sendPresence(),this.presenceTimer===undefined&&(this.presenceTimer=setInterval(function(){return e.sendPresence()},1e4))},ServerProtocol.prototype.handleMethodInvocationMessage=function(e){var t=e.MethodRequestSubject,n=this.serverRepository.getList(),i=n.filter(function(e){return e.protocolState.method.MethodRequestSubject===t})[0];if(i!==undefined){if(this.streaming.isStreamMsg(e,i))return void this.streaming.processSubscriberMsg(e,i);var r=e.Context.InvocationId;this.invocationMessagesMap[r]=e;var o={args:e.Context.ArgumentsJson,instance:a.convertInfoToInstance(e.Client)};this.callbacks.execute("onInvoked",i,r,o)}},ServerProtocol.prototype.createNewMethodMessage=function(e,t,n){return"string"==typeof e&&(e={name:e}),"number"!=typeof e.version&&(e.version=0),{Method:{Name:e.name,InputSignature:e.accepts,ResultSignature:e.returns,Description:e.description,DisplayName:e.displayName,Version:e.version,ObjectTypeRestrictions:e.objectTypes,Flags:n?32:undefined},MethodRequestSubject:t}},ServerProtocol}();t["default"]=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="awaitingAccept",r="subscribed",o="Subscription rejected.",a=function(){function ClientStreaming(e,t,n,a){var s=this;this.instance=e,this.session=t,this.repository=n,this.logger=a,this.subscriptionsList={},this.subscriptionIdToLocalKeyMap={},this.nextSubLocalKey=0,this.handleErrorSubscribing=function(e){var t=e._tag,n=t.subLocalKey,a=s.subscriptionsList[n];if("object"==typeof a&&(a.trackedServers=a.trackedServers.filter(function(e){return e.serverId!==t.serverId}),a.trackedServers.length<=0)){if(clearTimeout(a.timeoutId),a.status===i){var c="string"==typeof e.reason&&""!==e.reason?' Publisher said "'+e.reason+'".':" No reason given.",u="object"==typeof a.arguments?JSON.stringify(a.arguments):"{}";a.error({message:o+c+" Called with:"+u,called_with:a.arguments,method:a.method.getInfoForUser()})}else a.status===r&&s.callOnClosedHandlers(a);delete s.subscriptionsList[n]}},this.handleSubscribed=function(e){var t=e._tag.subLocalKey,n=s.subscriptionsList[t];if("object"==typeof n){var o=e._tag.serverId,a=n.trackedServers.filter(function(e){return e.serverId===o})[0];if("object"==typeof a){a.subscriptionId=e.subscription_id,s.subscriptionIdToLocalKeyMap[e.subscription_id]=t;var c=n.status===i;n.status=r;var u=s;c&&n.success({onData:function(e){if("function"!=typeof e)throw new TypeError("The data callback must be a function.");n.handlers.onData.push(e),1===n.handlers.onData.length&&n.queued.data.length>0&&n.queued.data.forEach(function(t){e(t)})},onClosed:function(e){if("function"!=typeof e)throw new TypeError("The callback must be a function.");n.handlers.onClosed.push(e)},onFailed:function(){},close:function(){return u.closeSubscription(t)},requestArguments:n.arguments,serverInstance:u.repository.getServerById(o).getInfoForUser(),stream:n.method.info})}}},this.handleEventData=function(e){var t=s.subscriptionIdToLocalKeyMap[e.subscription_id];if(void 0!==t){var n=s.subscriptionsList[t];if("object"==typeof n){var i=n.trackedServers.filter(function(t){return t.subscriptionId===e.subscription_id});if(1===i.length){var r=e.oob&&e.snapshot,o=i[0].serverId,a=function(){return{data:e.data,server:s.repository.getServerById(o).getInfoForUser(),requestArguments:n.arguments||{},message:null,private:r}},c=n.handlers.onData,u=n.queued.data;c.length>0?c.forEach(function(e){"function"==typeof e&&e(a())}):u.push(a())}}}},this.handleSubscriptionCancelled=function(e){var t=s.subscriptionIdToLocalKeyMap[e.subscription_id];if(void 0!==t){var n=s.subscriptionsList[t];if("object"==typeof n){var i=n.trackedServers.length-1;n.trackedServers=n.trackedServers.filter(function(t){return t.subscriptionId!==e.subscription_id||(n.queued.closers.push(t.serverId),!1)}),n.trackedServers.length===i&&(n.trackedServers.length<=0&&(clearTimeout(n.timeoutId),s.callOnClosedHandlers(n),delete s.subscriptionsList[t]),delete s.subscriptionIdToLocalKeyMap[e.subscription_id])}}},t.on("subscribed",this.handleSubscribed),t.on("event",this.handleEventData),t.on("subscription-cancelled",this.handleSubscriptionCancelled)}return ClientStreaming.prototype.subscribe=function(e,t,n,i,r,o){var a=this;if(0===n.length)return void o({method:e.getInfoForUser(),called_with:t,message:"Subscription failed. No available servers matched the target params."});var s=this.getNextSubscriptionLocalKey(),c=this.registerSubscription(s,e,t,r,o,i.methodResponseTimeout);if("object"!=typeof c)return void o({method:e.getInfoForUser(),called_with:t,message:"Subscription failed. Unable to register the user callbacks."});n.forEach(function(n){var i=n.server.id;c.trackedServers.push({serverId:i,subscriptionId:undefined});var r={type:"subscribe",server_id:i,method_id:e.protocolState.id,arguments_kv:t};a.session.send(r,{serverId:i,subLocalKey:s}).then(function(e){return a.handleSubscribed(e)})["catch"](function(e){return a.handleErrorSubscribing(e)})})},ClientStreaming.prototype.getNextSubscriptionLocalKey=function(){var e=this.nextSubLocalKey;return this.nextSubLocalKey+=1,e},ClientStreaming.prototype.registerSubscription=function(e,t,n,o,a,s){var c=this;return this.subscriptionsList[e]={status:i,method:t,arguments:n,success:o,error:a,trackedServers:[],handlers:{onData:[],onClosed:[]},queued:{data:[],closers:[]},timeoutId:undefined},this.subscriptionsList[e].timeoutId=setTimeout(function(){if(c.subscriptionsList[e]!==undefined){var o=c.subscriptionsList[e];o.status===i?(a({method:t.getInfoForUser(),called_with:n,message:"Subscription failed. Subscription attempt timed out after "+s+" ms."}),delete c.subscriptionsList[e]):o.status===r&&o.trackedServers.length>0&&(o.trackedServers=o.trackedServers.filter(function(e){return"undefined"!=typeof e.subscriptionId}),delete o.timeoutId,o.trackedServers.length<=0&&(c.callOnClosedHandlers(o),delete c.subscriptionsList[e]))}},s),this.subscriptionsList[e]},ClientStreaming.prototype.callOnClosedHandlers=function(e,t){var n=e.queued.closers.length,i=n>0?e.queued.closers[n-1]:null,r=null;"number"==typeof i&&(r=this.repository.getServerById(i).getInfoForUser()),e.handlers.onClosed.forEach(function(n){"function"==typeof n&&n({message:t||"ServerInitiated",requestArguments:e.arguments,server:r,stream:e.method})})},ClientStreaming.prototype.closeSubscription=function(e){var t=this,n=this.subscriptionsList[e];"object"==typeof n&&(n.trackedServers.forEach(function(e){"undefined"!=typeof e.subscriptionId&&(t.session.sendFireAndForget({type:"unsubscribe",subscription_id:e.subscriptionId,reason_uri:"",reason:"ClientInitiated"}),delete t.subscriptionIdToLocalKeyMap[e.subscriptionId])}),n.trackedServers=[],this.callOnClosedHandlers(n,"ClientInitiated"),delete this.subscriptionsList[e])},ClientStreaming}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(41),o=function(){function ClientProtocol(e,t,n,o){var a=this;this.instance=e,this.session=t,this.repository=n,this.logger=o,this.callbacks=i["default"](),t.on("peer-added",function(e){return a.handlePeerAdded(e)}),t.on("peer-removed",function(e){return a.handlePeerRemoved(e)}),t.on("methods-added",function(e){return a.handleMethodsAddedMessage(e)}),t.on("methods-removed",function(e){return a.handleMethodsRemovedMessage(e)}),this.streaming=new r["default"](e,t,n,o)}return ClientProtocol.prototype.subscribe=function(e,t,n,i,r,o){this.streaming.subscribe(e,t,n,i,r,o)},ClientProtocol.prototype.invoke=function(e,t,n,i){var r=this,o=i.id,a=t.protocolState.id,s={type:"call",server_id:o,method_id:a,arguments_kv:n};this.session.send(s,{invocationId:e,serverId:o}).then(function(e){return r.handleResultMessage(e)})["catch"](function(e){return r.handleInvocationError(e)})},ClientProtocol.prototype.onInvocationResult=function(e){this.callbacks.add("onResult",e)},ClientProtocol.prototype.handlePeerAdded=function(e){var t=e.new_peer_id,n=e.identity,i=Number(n.process),r={machine:n.machine,pid:isNaN(i)?n.process:i,instance:n.instance,application:n.application,environment:n.environment,region:n.region,user:n.user,windowId:n.windowId,peerId:t};this.repository.addServer(r,t)},ClientProtocol.prototype.handlePeerRemoved=function(e){var t=e.removed_id,n=e.reason;this.repository.removeServerById(t,n)},ClientProtocol.prototype.handleMethodsAddedMessage=function(e){var t=this,n=e.server_id;e.methods.forEach(function(e){var i={name:e.name,displayName:e.display_name,description:e.description,version:e.version,objectTypes:e.object_types||[],accepts:e.input_signature,returns:e.result_signature,supportsStreaming:"undefined"!=typeof e.flags&&e.flags.streaming};t.repository.addServerMethod(n,i,{id:e.id})})},ClientProtocol.prototype.handleMethodsRemovedMessage=function(e){var t=this,n=e.server_id,i=e.methods,r=this.repository.getServerById(n);Object.keys(r.methods).forEach(function(e){var o=r.methods[e];i.indexOf(o.protocolState.id)>-1&&t.repository.removeServerMethod(n,e)})},ClientProtocol.prototype.handleResultMessage=function(e){var t=e._tag.invocationId,n=e.result,i=e._tag.serverId,r=this.repository.getServerById(i);this.callbacks.execute("onResult",t,r.getInfoForUser(),0,n,"")},ClientProtocol.prototype.handleInvocationError=function(e){this.logger.debug("handle invocation error "+JSON.stringify(e));var t=e._tag.invocationId,n=e._tag.serverId,i=this.repository.getServerById(n),r=e.reason,o=e.context;this.callbacks.execute("onResult",t,i.getInfoForUser(),1,o,r)},ClientProtocol}();t["default"]=o},function(e,t,n){"use strict";function default_1(e,t,n,o,a,s){function handleReconnect(){u.info("reconnected - will replay registered methods and subscriptions"),n.reset(),n.addServer(e,t.peerId);var i=o.getList();o.reset(),i.forEach(function(e){var t=e.definition;e.theFunction.userCallback?s().register(t,e.theFunction.userCallback):e.theFunction.userCallbackAsync&&s().registerAsync(t,e.theFunction.userCallbackAsync)})}function handleInitialJoin(){n.addServer(e,t.peerId),c({client:l,server:f}),c=undefined}var c,u=a.logger.subLogger("gw3-protocol"),d=new Promise(function(e){c=e}),p=t.domain("agm",u.subLogger("domain"),["subscribed"]),f=new i["default"](e,p,n,o,u.subLogger("server")),l=new r["default"](e,p,n,u.subLogger("client"));return p.onJoined(function(e){e?handleReconnect():handleInitialJoin()}),p.join(),d}Object.defineProperty(t,"__esModule",{value:!0});var i=n(45),r=n(42);t["default"]=default_1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function ServerStreaming(e,t,n,r,o){var a=this;this.instance=e,this.session=t,this.repository=n,this.serverRepository=r,this.logger=o,this.ERR_URI_SUBSCRIPTION_FAILED="com.tick42.agm.errors.subscription.failure",this.callbacks=i["default"](),this.nextStreamId=0,t.on("add-interest",function(e){a.handleAddInterest(e)}),t.on("remove-interest",function(e){a.handleRemoveInterest(e)})}return ServerStreaming.prototype.acceptRequestOnBranch=function(e,t,n){if("string"!=typeof n&&(n=""),"object"!=typeof t.protocolState.subscriptionsMap)throw new TypeError("The streaming method is missing its subscriptions.");if(!Array.isArray(t.protocolState.branchKeyToStreamIdMap))throw new TypeError("The streaming method is missing its branches.");var i=this.getStreamId(t,n),r=e.msg.subscription_id,o={id:r,arguments:e.arguments,instance:e.instance,branchKey:n,streamId:i,subscribeMsg:e.msg};t.protocolState.subscriptionsMap[r]=o,this.session.sendFireAndForget({type:"accepted",subscription_id:r,stream_id:i}),this.callbacks.execute("onSubscriptionAdded",o,t)},ServerStreaming.prototype.rejectRequest=function(e,t,n){"string"!=typeof n&&(n=""),this.sendSubscriptionFailed("Subscription rejected by user. "+n,e.msg.subscription_id)},ServerStreaming.prototype.pushData=function(e,t,n){var i=this;if("object"==typeof e&&Array.isArray(e.protocolState.branchKeyToStreamIdMap)){if("object"!=typeof t)throw new Error("Invalid arguments. Data must be an object.");"string"==typeof n?n=[n]:(!Array.isArray(n)||n.length<=0)&&(n=null);e.protocolState.branchKeyToStreamIdMap.filter(function(e){return null===n||Boolean(e)&&"string"==typeof e.key&&n.indexOf(e.key)>=0}).map(function(e){return e.streamId}).forEach(function(e){var n={type:"publish",stream_id:e,data:t};i.session.sendFireAndForget(n)})}},ServerStreaming.prototype.pushDataToSingle=function(e,t,n){if("object"!=typeof n)throw new Error("Invalid arguments. Data must be an object.");var i={type:"post",subscription_id:t.id,data:n};this.session.sendFireAndForget(i)},ServerStreaming.prototype.closeSingleSubscription=function(e,t){delete e.protocolState.subscriptionsMap[t.id];var n={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping a single subscription"};this.session.sendFireAndForget(n);t.instance;this.callbacks.execute("onSubscriptionRemoved",t,e)},ServerStreaming.prototype.closeMultipleSubscriptions=function(e,t){var n=this;if("object"==typeof e&&"object"==typeof e.protocolState.subscriptionsMap){var i=Object.keys(e.protocolState.subscriptionsMap).map(function(t){return e.protocolState.subscriptionsMap[t]});"string"==typeof t&&(i=i.filter(function(e){return e.branchKey===t})),i.forEach(function(t){delete e.protocolState.subscriptionsMap[t.id];var i={type:"drop-subscription",subscription_id:t.id,reason:"Server dropping all subscriptions on stream_id: "+t.streamId};n.session.sendFireAndForget(i)})}},ServerStreaming.prototype.getSubscriptionList=function(e,t){if("object"!=typeof e)return[];var n=Object.keys(e.protocolState.subscriptionsMap).map(function(t){return e.protocolState.subscriptionsMap[t]});return"string"!=typeof t?n:n.filter(function(e){return e.branchKey===t})},ServerStreaming.prototype.getBranchList=function(e){if("object"!=typeof e)return[];var t=Object.keys(e.protocolState.subscriptionsMap).map(function(t){return e.protocolState.subscriptionsMap[t]}),n=t.map(function(e){var t=null;return"object"==typeof e&&"string"==typeof e.branchKey&&(t=e.branchKey),t}),i=[];return n.filter(function(e){return!(null===e||i.indexOf(e)>=0)&&(i.push(e),!0)})},ServerStreaming.prototype.onSubAdded=function(e){this.onSubscriptionLifetimeEvent("onSubscriptionAdded",e)},ServerStreaming.prototype.onSubRequest=function(e){this.onSubscriptionLifetimeEvent("onSubscriptionRequest",e)},ServerStreaming.prototype.onSubRemoved=function(e){this.onSubscriptionLifetimeEvent("onSubscriptionRemoved",e)},ServerStreaming.prototype.handleRemoveInterest=function(e){var t=this.serverRepository.getById(e.method_id);if("string"==typeof e.subscription_id&&"object"==typeof t&&"object"==typeof t.protocolState.subscriptionsMap[e.subscription_id]){var n=t.protocolState.subscriptionsMap[e.subscription_id];delete t.protocolState.subscriptionsMap[e.subscription_id],this.callbacks.execute("onSubscriptionRemoved",n,t)}},ServerStreaming.prototype.onSubscriptionLifetimeEvent=function(e,t){this.callbacks.add(e,t)},ServerStreaming.prototype.getNextStreamId=function(){return this.nextStreamId+++""},ServerStreaming.prototype.handleAddInterest=function(e){var t=this.repository.getServerById(e.caller_id),n="function"==typeof t.getInfoForUser?t.getInfoForUser():null,i={msg:e,arguments:e.arguments_kv||{},instance:n},r=this.serverRepository.getById(e.method_id);if(r===undefined){var o="No method with id "+e.method_id+" on this server.";return void this.sendSubscriptionFailed(o,e.subscription_id)}if(r.protocolState.subscriptionsMap&&r.protocolState.subscriptionsMap[e.subscription_id])return void this.sendSubscriptionFailed("A subscription with id "+e.subscription_id+" already exists.",e.subscription_id);this.callbacks.execute("onSubscriptionRequest",i,r)},ServerStreaming.prototype.sendSubscriptionFailed=function(e,t){var n={type:"error",reason_uri:this.ERR_URI_SUBSCRIPTION_FAILED,reason:e,request_id:t};this.session.sendFireAndForget(n)},ServerStreaming.prototype.getStreamId=function(e,t){"string"!=typeof t&&(t="");var n=e.protocolState.branchKeyToStreamIdMap.filter(function(e){return e.key===t})[0],i=n?n.streamId:undefined;return"string"==typeof i&&""!==i||(i=this.getNextStreamId(),e.protocolState.branchKeyToStreamIdMap.push({key:t,streamId:i})),i},ServerStreaming}();t["default"]=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function fulfilled(e){try{step(i.next(e))}catch(e){o(e)}}function rejected(e){try{step(i["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i["return"]:o[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(44),s=function(){function ServerProtocol(e,t,n,i,r){var s=this;this.session=t,this.clientRepository=n,this.serverRepository=i,this.logger=r,this.callbacks=o["default"](),this.streaming=new a["default"](e,t,n,i,r),this.session.on("invoke",function(e){return s.handleInvokeMessage(e)})}return ServerProtocol.prototype.createStream=function(e,t,n){e.protocolState.subscriptionsMap={},e.protocolState.branchKeyToStreamIdMap=[],this.register(e,t,n,!0)},ServerProtocol.prototype.register=function(e,t,n,o){return i(this,void 0,void 0,function(){var i,a,s,c=this;return r(this,function(r){switch(r.label){case 0:return i=e.definition,e.protocolState.registrationCallbacks={success:t,fail:n},a={streaming:o||!1},this.logger.debug('registering method "'+i.name+'"'),s={type:"register",methods:[{id:e.repoId,name:i.name,display_name:i.displayName,description:i.description,version:i.version,flags:a,object_types:i.objectTypes||i.object_types,input_signature:i.accepts,result_signature:i.returns,restrictions:undefined}]},[4,this.session.send(s,{methodId:e.repoId}).then(function(e){return c.handleRegisteredMessage(e)})["catch"](function(e){return c.handleErrorRegister(e)})];case 1:return r.sent(),[2]}})})},ServerProtocol.prototype.onInvoked=function(e){this.callbacks.add("onInvoked",e)},ServerProtocol.prototype.methodInvocationResult=function(e,t,n,i){var r;r=n?{type:"error",request_id:t,reason_uri:"agm.errors.client_error",reason:n,context:i,peer_id:undefined}:{type:"yield",invocation_id:t,peer_id:this.session.peerId,result:i,request_id:undefined},this.session.sendFireAndForget(r)},ServerProtocol.prototype.unregister=function(e){return i(this,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:return t={type:"unregister",methods:[e.repoId]},[4,this.session.send(t)];case 1:return n.sent(),[2]}})})},ServerProtocol.prototype.getBranchList=function(e){return this.streaming.getBranchList(e)},ServerProtocol.prototype.getSubscriptionList=function(e,t){return this.streaming.getSubscriptionList(e,t)},ServerProtocol.prototype.closeAllSubscriptions=function(e,t){this.streaming.closeMultipleSubscriptions(e,t)},ServerProtocol.prototype.pushData=function(e,t,n){this.streaming.pushData(e,t,n)},ServerProtocol.prototype.pushDataToSingle=function(e,t,n){this.streaming.pushDataToSingle(e,t,n)},ServerProtocol.prototype.closeSingleSubscription=function(e,t){this.streaming.closeSingleSubscription(e,t)},ServerProtocol.prototype.acceptRequestOnBranch=function(e,t,n){this.streaming.acceptRequestOnBranch(e,t,n)},ServerProtocol.prototype.rejectRequest=function(e,t,n){this.streaming.rejectRequest(e,t,n)},ServerProtocol.prototype.onSubRequest=function(e){this.streaming.onSubRequest(e)},ServerProtocol.prototype.onSubAdded=function(e){this.streaming.onSubAdded(e)},ServerProtocol.prototype.onSubRemoved=function(e){this.streaming.onSubRemoved(e)},ServerProtocol.prototype.handleRegisteredMessage=function(e){var t=e._tag.methodId,n=this.serverRepository.getById(t);n&&n.protocolState.registrationCallbacks&&(this.logger.debug("registered method "+n.definition.name+" with id "+t),n.protocolState.registrationCallbacks.success())},ServerProtocol.prototype.handleErrorRegister=function(e){this.logger.warn(JSON.stringify(e));var t=e._tag.methodId,n=this.serverRepository.getById(t);n&&n.protocolState.registrationCallbacks&&(this.logger.debug("failed to register method "+n.definition.name+" with id "+t),n.protocolState.registrationCallbacks.fail())},ServerProtocol.prototype.handleInvokeMessage=function(e){var t=e.invocation_id,n=e.caller_id,i=e.method_id,r=e.arguments_kv;this.logger.debug('received invocation for method id "'+i+'" from peer '+n);var o=this.serverRepository.getList(),a=o.filter(function(e){return e.repoId===i})[0];if(a!==undefined){var s=this.clientRepository.getServerById(n),c={args:r,instance:s.getInfoForUser()};this.callbacks.execute("onInvoked",a,t,c)}},ServerProtocol}();t["default"]=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=function(){function ServerBranch(e,t,n){this.key=e,this.protocol=t,this.repoMethod=n}return ServerBranch.prototype.subscriptions=function(){var e=this;return this.protocol.server.getSubscriptionList(this.repoMethod,this.key).map(function(t){return new i["default"](e.protocol,e.repoMethod,t)})},ServerBranch.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod,this.key)},ServerBranch.prototype.push=function(e){this.protocol.server.pushData(this.repoMethod,e,[this.key])},ServerBranch}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function ServerRepository(){this.nextId=0,this.methods=[]}return ServerRepository.prototype.add=function(e){if("object"==typeof e&&e.repoId===undefined)return e.repoId=String(this.nextId),this.nextId+=1,this.methods.push(e),e},ServerRepository.prototype.remove=function(e){if("string"!=typeof e)return new TypeError("Expecting a string");this.methods=this.methods.filter(function(t){return t.repoId!==e})},ServerRepository.prototype.getById=function(e){return"string"!=typeof e?undefined:this.methods.filter(function(t){return t.repoId===e})[0]},ServerRepository.prototype.getList=function(){return this.methods.map(function(e){return e})},ServerRepository.prototype.length=function(){return this.methods.length},ServerRepository.prototype.reset=function(){this.methods=[]},ServerRepository}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function Request(e,t,n){this.protocol=e,this.repoMethod=t,this.requestContext=n,this.arguments=n.arguments,this.instance=n.instance}return Request.prototype.accept=function(){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,"")},Request.prototype.acceptOnBranch=function(e){this.protocol.server.acceptRequestOnBranch(this.requestContext,this.repoMethod,e)},Request.prototype.reject=function(e){this.protocol.server.rejectRequest(this.requestContext,this.repoMethod,e)},Request}();t["default"]=i},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},i.apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function fulfilled(e){try{step(i.next(e))}catch(e){o(e)}}function rejected(e){try{step(i["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i["return"]:o[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=n(51),c=n(50),u=function(){function Server(e,t,n,i){this.protocol=e,this.serverRepository=t,this.instance=n,this.configuration=i,this.invocations=0,this.streaming=new s["default"](e,this),this.protocol.server.onInvoked(this.onMethodInvoked.bind(this))}return Server.prototype.register=function(e,t){if(e===undefined)return Promise.reject("Please supply either a string of the Unique name or an object with property name");if("function"!=typeof t)return Promise.reject("The second parameter must be the callback function");var n=function(e,n){try{var i=t(e.args,e.instance);n(null,i)}catch(e){n(e,e)}};return n.userCallback=t,this.registerCore(e,n)},Server.prototype.registerAsync=function(e,t){if(e===undefined)return Promise.reject("Please supply either a string of the Unique name or an object with property name");if("function"!=typeof t)return Promise.reject("The second parameter must be the callback function");var n=function(e,n){try{t(e.args,e.instance,function(e){n(null,e)},function(e){n(e,e)})}catch(e){n(e,null)}};return n.userCallbackAsync=t,this.registerCore(e,n)},Server.prototype.registerCore=function(e,t){var n,r=this;if(n="string"==typeof e?{name:""+e}:i({},e),this.serverRepository.getList().some(function(e){return e.definition.name===n.name}))return Promise.reject("Name already exists !");if(n.supportsStreaming)return Promise.reject("supportsStreaming can not be true ! If you want to create a stream please use glue.agm.createStream");var o=this.serverRepository.add({definition:n,theFunction:t,protocolState:{}});return this.protocol.server.register(o,function(){},function(){r.serverRepository.remove(o.repoId)})},Server.prototype.createStream=function(e,t,n,i){var r=this,o=new Promise(function(n,i){"string"==typeof e&&(""===e&&i("Invalid stream name - can not be empty"),e={name:e}),e.supportsStreaming=!0,t||(t={}),"function"!=typeof t.subscriptionRequestHandler&&(t.subscriptionRequestHandler=function(e){e.accept()});var o={definition:e,streamCallbacks:t,protocolState:{}};r.serverRepository.add(o),r.protocol.server.createStream(o,function(){var e=new c["default"](r.protocol,o,r);o.stream=e,n(e)},function(e){r.serverRepository.remove(o.repoId),i(e)})});return a["default"](o,n,i)},Server.prototype.unregister=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,function(){var n,i;return o(this,function(r){switch(r.label){case 0:return e===undefined?[2,Promise.reject("Please supply either a string of the Unique name or an object with property name")]:"function"!=typeof e?[3,2]:[4,this.unregisterWithPredicate(e,t)];case 1:return r.sent(),[2];case 2:return n="string"==typeof e?{name:e}:e,n.name===undefined?[2,Promise.reject("Method with undefined name does not exist !")]:(i=this.serverRepository.getList().find(function(e){return e.definition.name===n.name&&(e.definition.supportsStreaming||!1)===t}),i?[4,this.removeMethodsOrStreams([i])]:[2,Promise.reject("Method does not exist or it is not registered by your application !")]);case 3:return r.sent(),[2]}})})},Server.prototype.unregisterWithPredicate=function(e,t){return r(this,void 0,void 0,function(){var n;return o(this,function(i){switch(i.label){case 0:return n=this.serverRepository.getList().filter(function(t){return e(t.definition)}).filter(function(e){return(e.definition.supportsStreaming||!1)===t}),n&&0!==n.length?[4,this.removeMethodsOrStreams(n)]:[2,Promise.reject("No "+(t?"stream":"method")+" matches the condition !")];case 1:return i.sent(),[2]}})})},Server.prototype.removeMethodsOrStreams=function(e){return r(this,void 0,void 0,function(){var t=this;return o(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(e){return r(t,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.protocol.server.unregister(e)];case 1:return t.sent(),this.serverRepository.remove(e.repoId),[2]}})})}))];case 1:return n.sent(),[2]}})})},Server.prototype.containsProps=function(e,t){var n=Object.keys(e).filter(function(t){return"function"!=typeof e[t]&&"object_types"!==t&&"display_name"!==t}),i=Object.keys(t);return Array.from(new Set(n.concat(i))).reduce(function(n,i){var r=e[i],o=t[i];if("supportsStreaming"===i&&(o=o||!1,r=r||!1),"objectTypes"===i&&r!==undefined&&o!==undefined)if(r.length!==o.length)n=!1;else{var a=r.sort(),s=o.sort(),c=a.some(function(e,t){return e!==s[t]});c&&(n=!1)}else r!==o&&(n=!1);return n},!0)},Server.prototype.onMethodInvoked=function(e,t,n){var i=this;e&&e.theFunction(n,function(n,r){if(n)if("string"==typeof n.message)n=n.message;else if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n="un-stringifyable error in onMethodInvoked ! Top level prop names: "+Object.keys(n)}r&&"object"==typeof r&&r.constructor!==Array||(r={_result:r}),i.protocol.server.methodInvocationResult(e,t,n,r)})},Server}();t["default"]=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(46),o=function(){function ServerStream(e,t,n){this.protocol=e,this.repoMethod=t,this.server=n,this.def=t.definition}return Object.defineProperty(ServerStream.prototype,"name",{get:function(){return this.def.name},enumerable:!0,configurable:!0}),ServerStream.prototype.branches=function(e){var t=this,n=this.protocol.server.getBranchList(this.repoMethod);return e?n.indexOf(e)>-1?new r["default"](e,this.protocol,this.repoMethod):undefined:n.map(function(e){return new r["default"](e,t.protocol,t.repoMethod)})},ServerStream.prototype.subscriptions=function(){var e=this;return this.protocol.server.getSubscriptionList(this.repoMethod).map(function(t){return new i["default"](e.protocol,e.repoMethod,t)})},Object.defineProperty(ServerStream.prototype,"definition",{get:function(){var e=this.def;return{accepts:e.accepts,description:e.description,displayName:e.displayName,name:e.name,objectTypes:e.objectTypes,returns:e.returns,supportsStreaming:e.supportsStreaming}},enumerable:!0,configurable:!0}),ServerStream.prototype.close=function(){this.protocol.server.closeAllSubscriptions(this.repoMethod),this.server.unregister(this.repoMethod.definition,!0)},ServerStream.prototype.push=function(e,t){if("string"!=typeof t&&!Array.isArray(t)&&t!==undefined)throw new Error("invalid branches should be string or string array");if("object"!=typeof e)throw new Error("Invalid arguments. Data must be an object.");this.protocol.server.pushData(this.repoMethod,e,t)},ServerStream}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(48),o=function(){function ServerStreaming(e,t){var n=this;this.protocol=e,this.server=t,e.server.onSubRequest(function(e,t){return n.handleSubRequest(e,t)}),e.server.onSubAdded(function(e,t){return n.handleSubAdded(e,t)}),e.server.onSubRemoved(function(e,t){return n.handleSubRemoved(e,t)})}return ServerStreaming.prototype.handleSubRequest=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionRequestHandler){var n=new r["default"](this.protocol,t,e);t.streamCallbacks.subscriptionRequestHandler(n)}},ServerStreaming.prototype.handleSubAdded=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionAddedHandler){var n=new i["default"](this.protocol,t,e);t.streamCallbacks.subscriptionAddedHandler(n)}},ServerStreaming.prototype.handleSubRemoved=function(e,t){if(t&&t.streamCallbacks&&"function"==typeof t.streamCallbacks.subscriptionRemovedHandler){var n=new i["default"](this.protocol,t,e);t.streamCallbacks.subscriptionRemovedHandler(n)}},ServerStreaming}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(53),r=["subscribed","success"];t["default"]=function(e){var t=e.connection,n=e.logger,o=t.domain("bus",n,r);return new Promise(function(e,r){o.join().then(function(){var r=i["default"](t,n,o);e(r)})["catch"](r)})}},function(e,t,n){"use strict";function default_1(e,t,n){var i=new r(e,t,n);return i.watchOnEvent(),i}Object.defineProperty(t,"__esModule",{value:!0});var i=n(54),r=function(){function Protocol(e,t,n){var r=this;this.publish=function(e,t,n){var o=n||{},a=o.routingKey,s=void 0===a?undefined:a,c=o.target,u=void 0===c?undefined:c,d=i.removeEmptyValues({type:"publish",topic:e,data:t,peer_id:r.peerId,routing_key:s,target_identity:u});r.session.send(d)},this.subscribe=function(e,t,n){return new Promise(function(o,a){var s=n||{},c=s.routingKey,u=void 0===c?undefined:c,d=s.target,p=void 0===d?undefined:d,f=i.removeEmptyValues({type:"subscribe",topic:e,peer_id:r.peerId,routing_key:u,source:p});r.session.send(f).then(function(n){var i=n.subscription_id;r.subscriptions.push({subscription_id:i,topic:e,callback:t,source:p}),o({unsubscribe:function(){return r.session.send({type:"unsubscribe",subscription_id:i,peer_id:r.peerId}),r.subscriptions=r.subscriptions.filter(function(e){return e.subscription_id!==i}),Promise.resolve()}})})["catch"](function(e){return a(e)})})},this.watchOnEvent=function(){r.session.on("event",function(e){var t=e.data,n=e.subscription_id,o=e["publisher-identity"],a=r.subscriptions.find(function(e){return e.subscription_id===n});a&&(a.source?i.keysMatch(a.source,o)&&a.callback(t,a.topic,o):a.callback(t,a.topic,o))})},this.connection=e,this.logger=t,this.session=n,this.peerId=e.peerId,this.subscriptions=[]}return Protocol}();t["default"]=default_1},function(e,t,n){"use strict";function removeEmptyValues(e){var t={};return Object.keys(e).forEach(function(n){e[n]!==undefined&&null!==e[n]&&(t[n]=e[n])}),t}function keysMatch(e,t){var n=Object.keys(e),i=!0;return n.forEach(function(n){e[n]!==t[n]&&(i=!1)}),i}Object.defineProperty(t,"__esModule",{value:!0}),t.removeEmptyValues=removeEmptyValues,t.keysMatch=keysMatch},function(e,t,n){"use strict";(function(e,i){function default_1(t,n,c,u,d){function getApplication(){return getConfigProp("application")}function getConfigProp(e,n){var i=f[e],r=t[e],o=l[e],a=h[e];if(n){if(i&&i[n]!==undefined)return i[n];if(r&&r[n]!==undefined)return r[n];if(o&&o[n]!==undefined)return o[n];if(a&&a[n]!==undefined)return a[n]}else{if(i!==undefined)return i;if(r!==undefined)return r;if(o!==undefined)return o;if(a!==undefined)return a}return undefined}function ifNotFalse(e,t){return"boolean"!=typeof e||e?t:undefined}"undefined"!=typeof window&&(e=e||window),e=e||{};var p=r.generate(),f=e.GLUE_CONFIG||{},l=e.GLUE_DEFAULT_CONFIG||{},h=function(){return{application:function(){return c?c.containerName+"."+c.browserWindowName:u?u.appName:"undefined"!=typeof window&&"undefined"!=typeof document?(window.agm_application||document.title)+p:"NodeJS"+p}(),metrics:function(){var e="undefined"!=typeof document?document.title:"unknown";if(e=e||"none",void 0===c)return{system:"Connect.Browser",service:t.application||e,instance:"~"+p};if("undefined"!=typeof c.metricsFacade.getIdentity){var n=c.metricsFacade.getIdentity();return{system:n.system,service:n.service,instance:n.instance}}return{system:"HtmlContainer."+c.containerName,service:"JS."+c.browserWindowName,instance:"~"+c.machineName}}(),agm:{},gateway:function(){var e=3,t="ws://localhost:8385";return u&&(e=3,t=u.gwURL),{ws:t,http:"http://localhost:8385",protocolVersion:e,reconnectInterval:1e3}}(),logger:function(){return{publish:"off",console:"info",metrics:"off"}}(),bus:!1}}(),y={system:getConfigProp("metrics","system"),service:getConfigProp("metrics","service"),instance:getConfigProp("metrics","instance")},g=function(){var e=getConfigProp("gateway","force");if(c===undefined||e){var t=getConfigProp("gateway"),n=getConfigProp("gateway","protocolVersion"),r=getConfigProp("gateway","reconnectInterval"),s=getConfigProp("gateway","reconnectAttempts"),p=t.ws,f=t.http,l=t.inproc;p||f||l||(o["default"].isNode()||"WebSocket"in window&&2===window.WebSocket.CLOSING?p=getConfigProp("gateway","ws"):f=getConfigProp("gateway","http"));var h=void 0,y=void 0;c?h=c.windowId:void 0!==u?(h=u.windowId,y=u.pid):o["default"].isNode()&&(y=i.pid);var g=getConfigProp("gateway","replaySpecs")||[];return g.push(a.ContextMessageReplaySpec),{identity:{application:getApplication(),windowId:h,process:y},reconnectInterval:r,ws:p,http:f,gw:l,protocolVersion:n,reconnectAttempts:s,force:!0,replaySpecs:g,gdVersion:d}}return{gdVersion:d}}(),v=function(e){if(e.protocolVersion<3)return!1;var t=getConfigProp("contexts");return!("boolean"==typeof t&&!t)}(g),m=function(e){if(!e)return!1;var t=getConfigProp("channels");return!("boolean"==typeof t&&!t)}(v);return{bus:function(e){var t=getConfigProp("bus");return!("boolean"!=typeof t||!t)&&(!(e.protocolVersion&&e.protocolVersion<3)&&2!==d)}(g),identity:y,application:getApplication(),auth:function(){return getConfigProp("auth")}(),logger:function(){return getConfigProp("logger")}(),connection:g,metrics:function(){return ifNotFalse(getConfigProp("metrics"),{identity:y})}(),agm:function(){return ifNotFalse(t.agm,{instance:{application:getApplication()}})}(),contexts:v,channels:m,version:n.version||s.version,libs:n.libs}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),o=n(11),a=n(10),s=n(12);t["default"]=default_1}).call(t,n(7),n(18))},function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function __(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),o=n(58),a=function(e){function GW3ConnectionImpl(t){var n=e.call(this,t)||this;return t.replaySpecs&&t.replaySpecs.length&&(n.replayer=new o.MessageReplayerImpl(t.replaySpecs)),n}return i(GW3ConnectionImpl,e),GW3ConnectionImpl.prototype.init=function(t,n){e.prototype.init.call(this,t,n),this.replayer&&this.replayer.init(this),this.gw3Protocol=n},GW3ConnectionImpl.prototype.toAPI=function(){var t=this,n=e.prototype.toAPI.call(this);return{domain:t.domain.bind(t),get peerId(){return t.peerId},get token(){return t.token},get info(){return t.info},get resolvedIdentity(){return t.resolvedIdentity},get availableDomains(){return t.availableDomains},get gatewayToken(){return t.gatewayToken},get replayer(){return t.replayer},on:n.on,send:n.send,off:n.off,login:n.login,logout:n.logout,loggedIn:n.loggedIn,connected:n.connected,disconnected:n.disconnected,authToken:t.authToken.bind(t),get protocolVersion(){return n.protocolVersion}}},GW3ConnectionImpl.prototype.domain=function(e,t,n,i){return this.gw3Protocol.domain(e,t,n,i)},GW3ConnectionImpl.prototype.authToken=function(){return this.gw3Protocol.authToken()},GW3ConnectionImpl}(r["default"]);t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(13),r=n(60),o=n(62),a=n(65),s=n(56),c=n(59),u=n(63),d=n(64);t["default"]=function(e){e=e||{},e.reconnectAttempts=e.reconnectAttempts||10,e.reconnectInterval=e.reconnectInterval||500;var t=new i["default"](e),n=e.logger;if(!n)throw new Error("please pass a logger object");var p=new o["default"],f=new u["default"];if(2!==e.gdVersion||e.force){if(e.gw&&e.gw.facade&&e.gw.token&&3===e.protocolVersion)f=new d["default"](e.gw.token,e.gw.facade,n.subLogger("inproc"));else{if(e.ws===undefined)throw new Error("No connection information specified");f=new a["default"](e,n.subLogger("ws"))}if(3===e.protocolVersion){var l=new s["default"](e),h=r["default"](l,e,n.subLogger("gw3"));return l.init(f,h),l.toAPI()}p=new c["default"](t,e)}return t.init(f,p),t.toAPI()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function MessageReplayerImpl(e){this.specsNames=[],this.messages={},this.subs={},this.subsRefCount={},this.specs={};for(var t=0,n=e;t<n.length;t++){var i=n[t];this.specs[i.name]=i,this.specsNames.push(i.name)}}return MessageReplayerImpl.prototype.init=function(e){var t=this;this.connection=e;for(var n=0,i=this.specsNames;n<i.length;n++)for(var r=i[n],o=this,a=0,s=this.specs[r].types;a<s.length;a++){var c=s[a];!function(n){var i=o.subsRefCount[n];if(i||(i=0),i+=1,o.subsRefCount[n]=i,i>1)return"continue";var r=e.on("glue-core",n,function(e){return t.processMessage(n,e)});o.subs[n]=r}(c)}},MessageReplayerImpl.prototype.processMessage=function(e,t){if(!this.isDone&&t)for(var n=0,i=this.specsNames;n<i.length;n++){var r=i[n];if(-1!==this.specs[r].types.indexOf(e)){var o=this.messages[r]||[];this.messages[r]=o,o.push(t)}}},MessageReplayerImpl.prototype.drain=function(e,t){t&&(this.messages[e]||[]).forEach(t),delete this.messages[e];for(var n=0,i=this.specs[e].types;n<i.length;n++){var r=i[n];this.subsRefCount[r]-=1,this.subsRefCount[r]<=0&&(this.connection.off(this.subs[r]),delete this.subs[r],delete this.subsRefCount[r])}delete this.specs[e],this.specs.length||(this.isDone=!0)},MessageReplayerImpl}();t.MessageReplayerImpl=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function GW1Protocol(e,t){this._connection=e,this._settings=t}return GW1Protocol.prototype.processStringMessage=function(e){var t=JSON.parse(e);return{msg:t.message,msgType:t.type}},GW1Protocol.prototype.createStringMessage=function(e,t,n,i){return JSON.stringify({type:t,message:n,id:i})},GW1Protocol.prototype.login=function(e){var t=this;return new Promise(function(e,n){var i={retryInterval:t._settings.reconnectInterval,maxRetries:t._settings.reconnectAttempts};t._connection.send("hello","hello",{},null,i).then(function(){return e({application:undefined})})["catch"](n)})},GW1Protocol.prototype.logout=function(){},GW1Protocol.prototype.loggedIn=function(e){return e(),function(){}},GW1Protocol.prototype.processObjectMessage=function(e){throw new Error("not supported")},GW1Protocol.prototype.createObjectMessage=function(e,t,n,i){throw new Error("not supported")},GW1Protocol}();t["default"]=i},function(e,t,n){"use strict";function default_1(e,t,n){function processStringMessage(e){var t=JSON.parse(e,function(e,t){if("string"!=typeof t)return t;if(t.length<d)return t;if(t[0]!==p)return t;if(t.substring(0,u)!==c)return t;try{var n=parseInt(t.substring(u,t.length),10);return isNaN(n)?t:new Date(n)}catch(e){return t}});return{msg:t,msgType:t.type}}function createStringMessage(e,t,n,i){var r=Date.prototype.toJSON;try{Date.prototype.toJSON=function(){return c+this.getTime()};return JSON.stringify(n)}finally{Date.prototype.toJSON=r}}function processObjectMessage(e){if(!e.type)throw new Error("Object should have type property");return{msg:e,msgType:e.type}}function createObjectMessage(e,t,n,i){return n}function login(r){return n.debug("logging in..."),s=r,s||(s={username:"",password:""}),h=!0,new Promise(function(a,s){var c={};if(e.gatewayToken=r.gatewayToken,e.gatewayToken)c.method="gateway-token",c.token=e.gatewayToken;else if(r.token)c.method="access-token",c.token=r.token;else{if(!r.username)throw new Error("invalid auth message"+JSON.stringify(r));c.method="secret",c.login=r.username,c.secret=r.password}var u={type:"hello",identity:t.identity,authentication:c};o=i["default"]("global",e,n,["welcome","token"]);var d={skipPeerId:!0};y&&(d.retryInterval=t.reconnectInterval,d.maxRetries=t.reconnectAttempts),o.send(u,undefined,d).then(function(t){y=!1,n.debug("login successful with PeerId "+t.peer_id),e.peerId=t.peer_id,e.resolvedIdentity=t.resolved_identity,e.availableDomains=t.available_domains,t.options&&(e.token=t.options.access_token,e.info=t.options.info),setLoggedIn(!0),a(t.resolved_identity)})["catch"](function(e){n.error("error sending hello message - "+e),s(e)})})}function logout(){n.debug("logging out..."),h=!1,a&&clearTimeout(a),v.forEach(function(e){e.leave()})}function loggedIn(e){return l&&e(),f.add("onLoggedIn",e)}function domain(t,n,r,o){var a=v.filter(function(e){return e.domain===t})[0];return a||(a=i["default"](t,e,n,r,o),v.push(a)),a}function handleDisconnected(){if(setLoggedIn(!1),h&&y){if(g<=0)return;g--}n.debug("disconnected - will try new login?"+h),h&&e.login(s)["catch"](function(){setTimeout(handleDisconnected,1e3)})}function setLoggedIn(e){(l=e)&&f.execute("onLoggedIn")}function ping(){h&&(l&&e.send("","",{type:"ping"}),a=setTimeout(ping,3e4))}function authToken(){var e={type:"create-token"};return o.send(e).then(function(e){return e.token})}var o,a,s,c="#T42_DATE#",u=c.length,d=u+1,p=c[0],f=r["default"](),l=!1,h=!0,y=!0,g=3,v=[];return e.disconnected(handleDisconnected.bind(this)),ping(),{processStringMessage:processStringMessage,createStringMessage:createStringMessage,createObjectMessage:createObjectMessage,processObjectMessage:processObjectMessage,login:login,logout:logout,loggedIn:loggedIn,domain:domain,authToken:authToken}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(61),r=n(1);t["default"]=default_1},function(e,t,n){"use strict";function default_1(e,t,n,o,a){function join(t){return s=t,new Promise(function(i,r){if(c)return void i();var o;if("global"===e)o=d?Promise.resolve({}):Promise.reject("not connected to gateway");else{n.debug("joining "+e);o=send({type:"join",destination:e,domain:"global",options:t})}o.then(function(){handleJoined(),i()})["catch"](function(t){n.debug("error joining "+e+" domain: "+JSON.stringify(t)),r(t)})})}function leave(){if("global"!==e){n.debug("stopping session "+e+"...");send({type:"leave",destination:e,domain:"global"}).then(function(){c=!1,p.execute("onLeft")})}}function handleJoined(){n.debug("did join "+e),c=!0;var t=u;u=!1,p.execute("onJoined",t)}function handleConnectionDisconnected(){d=!1,n.warn("connection is down"),c=!1,u=!0,p.execute("onLeft",{disconnected:!0})}function handleConnectionLoggedIn(){d=!0,u&&(n.info("connection is now up - trying to reconnect..."),join(s))}function onJoined(e){return c&&e(!1),p.add("onJoined",e)}function onLeft(e){return c||e(),p.add("onLeft",e)}function handleErrorMessage(t){if(e===t.domain){var n=t.request_id,i=f[n];i&&i.error(t)}}function handleSuccessMessage(t){if(t.domain===e){var n=t.request_id,i=f[n];i&&i.success(t)}}function getNextRequestId(){return r.generate()}function send(i,r,o){o=o||{},i.request_id=i.request_id||getNextRequestId(),i.domain=i.domain||e,o.skipPeerId||(i.peer_id=t.peerId);var a=i.request_id;return new Promise(function(s,c){f[a]={success:function(e){delete f[a],e._tag=r,s(e)},error:function(e){n.warn("GW error - "+JSON.stringify(e)+" for request "+JSON.stringify(i)),delete f[a],e._tag=r,c(e)}},t.send(e,e,i,undefined,o)["catch"](function(e){f[a].error({err:e})})})}function sendFireAndForget(n){n.request_id=n.request_id?n.request_id:getNextRequestId(),n.domain=n.domain||e,n.peer_id=t.peerId,t.send(e,e,n)}null==e&&(e="global");var s,c=!1,u=!1,d=!1,p=i();t.disconnected(handleConnectionDisconnected),t.loggedIn(handleConnectionLoggedIn),t.on(e,"success",function(e){return handleSuccessMessage(e)}),t.on(e,"error",function(e){return handleErrorMessage(e)}),t.on(e,"result",function(e){return handleSuccessMessage(e)}),o&&o.forEach(function(n){t.on(e,n,function(e){return handleSuccessMessage(e)})}),a&&a.forEach(function(n){t.on(e,n,function(e){return handleErrorMessage(e)})});var f={};return{join:join,leave:leave,onJoined:onJoined,onLeft:onLeft,send:send,sendFireAndForget:sendFireAndForget,on:function(i,r){t.on(e,i,function(t){if(t.domain===e)try{r(t)}catch(e){n.error("Callback  failed: "+e+" \n msg was: "+JSON.stringify(t))}})},loggedIn:function(e){return t.loggedIn(e)},connected:function(e){return t.connected(e)},disconnected:function(e){return t.disconnected(e)},get peerId(){return t.peerId},get domain(){return e}}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(6);t["default"]=default_1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function HCProtocol(){}return HCProtocol.prototype.processStringMessage=function(e){var t=JSON.parse(e);return{msg:t,msgType:t.type}},HCProtocol.prototype.createStringMessage=function(e,t,n,i){return JSON.stringify(n)},HCProtocol.prototype.login=function(e){return Promise.resolve({application:undefined})},HCProtocol.prototype.logout=function(){},HCProtocol.prototype.loggedIn=function(e){return e(),function(){}},HCProtocol.prototype.processObjectMessage=function(e){throw new Error("not supported")},HCProtocol.prototype.createObjectMessage=function(e,t,n,i){throw new Error("not supported")},HCProtocol}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function HCTransport(){this.connectionId=Math.floor(1e10*Math.random()).toString()}return HCTransport.prototype.send=function(e,t,n){return"metrics"===t?window.htmlContainer.metricsFacade.send(n,e):"log"===t&&window.htmlContainer.loggingFacade.send(n,e),Promise.resolve(undefined)},HCTransport.prototype.onConnectedChanged=function(e){e(!0)},HCTransport.prototype.onMessage=function(e){},HCTransport.prototype.close=function(){},HCTransport.prototype.open=function(){},HCTransport}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function Inproc(e,t,n){this.registry=i["default"](),this.gw=t,this.gwToken=e,this.logger=n,this.connectToken=this.gw.connect(this.gwToken,this.messageHandler.bind(this))}return Object.defineProperty(Inproc.prototype,"isObjectBasedTransport",{get:function(){return!0},enumerable:!0,configurable:!0}),Inproc.prototype.sendObject=function(e){return this.logger.debug(JSON.stringify(e)),this.gw.send(this.connectToken,e),Promise.resolve(undefined)},Inproc.prototype.send=function(e,t,n){return Promise.reject("not supported")},Inproc.prototype.onMessage=function(e){return this.registry.add("onMessage",e)},Inproc.prototype.onConnectedChanged=function(e){e(!0)},Inproc.prototype.close=function(){},Inproc.prototype.open=function(){},Inproc.prototype.messageHandler=function(e){"trace"===this.logger.consoleLevel()&&this.logger.debug(JSON.stringify(e)),this.registry.execute("onMessage",e)},Inproc}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=n(11),o=r["default"].isNode()?n(26):window.WebSocket,a=function(){function WS(e,t){this._running=!0,this._initied=!1,this._registry=i["default"](),this._settings=e,this._logger=t}return WS.prototype.onMessage=function(e){return this._registry.add("onMessage",e)},WS.prototype.send=function(e,t,n,i){var r=this;return new Promise(function(t,n){i=i||{},r.waitForSocketConnection(function(){try{r._ws.send(e),t()}catch(e){n(e)}},n,i.maxRetries,i.retryInterval)})},WS.prototype.open=function(){this._running=!0},WS.prototype.close=function(){this._running=!1,this._ws.close()},WS.prototype.onConnectedChanged=function(e){return this._registry.add("onConnectedChanged",e)},WS.prototype.initiateSocket=function(){var e=this;this._logger.debug("initiating _ws to "+this._settings.ws+"..."),this._ws=new o(this._settings.ws),this._ws.onerror=function(t){e.notifyStatusChanged(!1,t)},this._ws.onclose=function(){e._logger.debug("_ws closed"),e.notifyStatusChanged(!1)},this._ws.onopen=function(){e._logger.debug("_ws opened"),e.notifyStatusChanged(!0)},this._ws.onmessage=function(t){e._registry.execute("onMessage",t.data)}},WS.prototype.waitForSocketConnection=function(e,t,n,i){var r=this;if(e||(e=function(){}),t||(t=function(){}),i===undefined&&(i=this._settings.reconnectInterval),n!==undefined){if(0===n)return void t("wait for socket on "+this._settings.ws+" failed - no more retries left");this._logger.debug("will retry "+n+" more times (every "+i+" ms)")}if(!this._running)return void t("wait for socket on "+this._settings.ws+" failed - socket closed by user");if(!this._ws||this._ws.readyState>1)this.initiateSocket();else if(1===this._ws.readyState)return e();setTimeout(function(){var o=n===undefined?undefined:n-1;r.waitForSocketConnection(e,t,o,i)},i)},WS.prototype.notifyStatusChanged=function(e,t){this._registry.execute("onConnectedChanged",e,t)},WS}();t["default"]=a},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function fulfilled(e){try{step(i.next(e))}catch(e){o(e)}}function rejected(e){try{step(i["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i["return"]:o[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};Object.defineProperty(t,"__esModule",{value:!0});var o=n(67),a=n(70),s=n(14),c=n(10),u=function(){function GW3Bridge(e){var t=this;this._contextNameToData={},this._gw3Subscriptions=[],this._nextCallbackSubscriptionNumber=0,this._contextNameToId={},this._contextIdToName={},this._connection=e.connection,this._logger=e.logger,this._gw3Session=this._connection.domain("global",this._logger,[s.GW_MESSAGE_CONTEXT_CREATED,s.GW_MESSAGE_SUBSCRIBED_CONTEXT,s.GW_MESSAGE_CONTEXT_DESTROYED,s.GW_MESSAGE_CONTEXT_UPDATED]),this.subscribeToContextCreatedMessages(),this.subscribeToContextUpdatedMessages(),this.subscribeToContextDestroyedMessages(),this._connection.replayer.drain(c.ContextMessageReplaySpec.name,function(e){var n=e.type;n&&(n===s.GW_MESSAGE_CONTEXT_CREATED||n===s.GW_MESSAGE_CONTEXT_ADDED||n===s.GW_MESSAGE_ACTIVITY_CREATED?t.handleContextCreatedMessage(e):n===s.GW_MESSAGE_SUBSCRIBED_CONTEXT||n===s.GW_MESSAGE_CONTEXT_UPDATED||n===s.GW_MESSAGE_JOINED_ACTIVITY?t.handleContextUpdatedMessage(e):n!==s.GW_MESSAGE_CONTEXT_DESTROYED&&n!==s.GW_MESSAGE_ACTIVITY_DESTROYED||t.handleContextDestroyedMessage(e))})}return GW3Bridge.prototype.dispose=function(){for(var e=0,t=this._gw3Subscriptions;e<t.length;e++){var n=t[e];this._connection.off(n)}this._gw3Subscriptions.length=0;for(var i in this._contextNameToData)this._contextNameToId.hasOwnProperty(i)&&delete this._contextNameToData[i]},GW3Bridge.prototype.createContext=function(e,t){var n=this;return this._gw3Session.send({type:s.GW_MESSAGE_CREATE_CONTEXT,domain:"global",name:e,data:t,lifetime:"retained"}).then(function(i){if(n._contextNameToId[e]=i.context_id,!n._contextIdToName[i.context_id]){n._contextIdToName[i.context_id]=e;var r=n._contextNameToData[e]||new o.GW3ContextData(i.context_id,e,!0,null);return r.isAnnounced=!0,r.name=e,r.contextId=i.context_id,n._contextNameToData[e]=r,r.context=i.data,r.sentExplicitSubscription=!0,r.context&&n.invokeUpdateCallbacks(r,r.context,null),n.update(e,t).then(function(){return i.context_id})}return i.context_id})},GW3Bridge.prototype.all=function(){var e=this;return Object.keys(this._contextNameToData).filter(function(t){return e._contextNameToData[t].isAnnounced})},GW3Bridge.prototype.update=function(e,t){var n=this,i=this._contextNameToData[e];if(!i||!i.isAnnounced)return this.createContext(e,t);var r=this.calculateContextDelta(i.context,t);return Object.keys(r.added).length||Object.keys(r.updated).length||r.removed.length?this._gw3Session.send({type:s.GW_MESSAGE_UPDATE_CONTEXT,domain:"global",context_id:i.contextId,delta:r},{},{skipPeerId:!1}).then(function(e){n.handleUpdated(i,r,{updaterId:e.peer_id})}):Promise.resolve()},GW3Bridge.prototype.set=function(e,t){var n=this,i=this._contextNameToData[e];return i&&i.isAnnounced?this._gw3Session.send({type:s.GW_MESSAGE_UPDATE_CONTEXT,domain:"global",context_id:i.contextId,delta:{reset:t}},{},{skipPeerId:!1}).then(function(e){n.handleUpdated(i,{reset:t,added:{},removed:[],updated:{}},{updaterId:e.peer_id})}):this.createContext(e,t)},GW3Bridge.prototype.get=function(e){var t=this,n=this._contextNameToData[e];return n&&n.isAnnounced?Promise.resolve(n.context):new Promise(function(n,o){return i(t,void 0,void 0,function(){var t=this;return r(this,function(i){return this.subscribe(e,function(e,i,r,o){t.unsubscribe(o),n(e)}),[2]})})})},GW3Bridge.prototype.subscribe=function(e,t){var n=this._nextCallbackSubscriptionNumber;this._nextCallbackSubscriptionNumber+=1;var i=this._contextNameToData[e];if(!i||!i.isAnnounced)return i=i||new o.GW3ContextData(undefined,e,!1,undefined),this._contextNameToData[e]=i,i.updateCallbacks[n]=t,Promise.resolve(n);var r=i.hasCallbacks();return i.updateCallbacks[n]=t,r?(t(i.context,i.context,[],n),Promise.resolve(n)):i.joinedActivity?(t(i.context,i.context,[],n),Promise.resolve(n)):i.context&&i.sentExplicitSubscription?(t(i.context,i.context,[],n),Promise.resolve(n)):this.sendSubscribe(i).then(function(){return n})},GW3Bridge.prototype.unsubscribe=function(e){for(var t=0,n=Object.keys(this._contextNameToData);t<n.length;t++){var i=n[t],r=(this._contextNameToId[i],this._contextNameToData[i]);if(!r)return;var o=r.hasCallbacks();delete r.updateCallbacks[e],r.isAnnounced&&o&&!r.hasCallbacks()&&r.sentExplicitSubscription&&this.sendUnsubscribe(r),r.isAnnounced||r.hasCallbacks()||delete this._contextNameToData[i]}},GW3Bridge.prototype.handleUpdated=function(e,t,n){var i=e.context;e.context=a.applyContextDelta(e.context,t),this._contextNameToData[e.name]!==e||a.deepEqual(i,e.context)||this.invokeUpdateCallbacks(e,e.context,t,n)},GW3Bridge.prototype.subscribeToContextCreatedMessages=function(){for(var e=[s.GW_MESSAGE_CONTEXT_ADDED,s.GW_MESSAGE_CONTEXT_CREATED,s.GW_MESSAGE_ACTIVITY_CREATED],t=0,n=e;t<n.length;t++){var i=n[t],r=this._connection.on("js-contexts",i,this.handleContextCreatedMessage.bind(this));this._gw3Subscriptions.push(r)}},GW3Bridge.prototype.handleContextCreatedMessage=function(e){var t=e.type;t===s.GW_MESSAGE_ACTIVITY_CREATED?(this._contextNameToId[e.activity_id]=e.context_id,this._contextIdToName[e.context_id]=e.activity_id):t===s.GW_MESSAGE_CONTEXT_ADDED?(this._contextNameToId[e.name]=e.context_id,this._contextIdToName[e.context_id]=e.name):s.GW_MESSAGE_CONTEXT_CREATED;var n=this._contextIdToName[e.context_id];if(!n)throw new Error("Received created event for context with unknown name: "+e.context_id);if(!this._contextNameToId[n])throw new Error("Received created event for context with unknown id: "+e.context_id);var i=this._contextNameToData[n];if(i){if(i.isAnnounced)return;if(!i.hasCallbacks())throw new Error("Assertion failure: contextData.hasCallbacks()");i.isAnnounced=!0,i.contextId=e.context_id,i.activityId=e.activity_id,i.sentExplicitSubscription||this.sendSubscribe(i)}else this._contextNameToData[n]=i=new o.GW3ContextData(e.context_id,n,!0,e.activity_id)},GW3Bridge.prototype.subscribeToContextUpdatedMessages=function(){for(var e=[s.GW_MESSAGE_CONTEXT_UPDATED,s.GW_MESSAGE_SUBSCRIBED_CONTEXT,s.GW_MESSAGE_JOINED_ACTIVITY],t=0,n=e;t<n.length;t++){var i=n[t],r=this._connection.on("js-contexts",i,this.handleContextUpdatedMessage.bind(this));this._gw3Subscriptions.push(r)}},GW3Bridge.prototype.handleContextUpdatedMessage=function(e){var t=e.type,n=e.context_id,i=this._contextNameToData[this._contextIdToName[n]],r=!i||!i.isAnnounced;if(t===s.GW_MESSAGE_JOINED_ACTIVITY)i?(i.contextId=n,i.isAnnounced=!0,i.activityId=e.activity_id):(i=new o.GW3ContextData(n,e.activity_id,!0,e.activity_id),this._contextNameToData[e.activity_id]=i,this._contextIdToName[n]=e.activity_id,this._contextNameToId[e.activity_id]=n),i.joinedActivity=!0;else if(!i||!i.isAnnounced)return void(t===s.GW_MESSAGE_SUBSCRIBED_CONTEXT?(i=i||new o.GW3ContextData(n,e.name,!0,null),i.sentExplicitSubscription=!0,this._contextNameToData[e.name]=i,this._contextIdToName[n]=e.name,this._contextNameToId[e.name]=n):this._logger.error("Received 'update' for unknown context: "+n));var c=i.context;if(t===s.GW_MESSAGE_SUBSCRIBED_CONTEXT)i.context=e.data||{};else if(t===s.GW_MESSAGE_JOINED_ACTIVITY)i.context=e.context_snapshot||{};else{if(t!==s.GW_MESSAGE_CONTEXT_UPDATED)throw new Error("Unrecognized context update message "+t);i.context=a.applyContextDelta(i.context,e.delta)}!r&&a.deepEqual(i.context,c)&&t!==s.GW_MESSAGE_SUBSCRIBED_CONTEXT||this.invokeUpdateCallbacks(i,i.context,null,{updaterId:e.updater_id})},GW3Bridge.prototype.invokeUpdateCallbacks=function(e,t,n,i){n=n||{added:{},updated:{},reset:{},removed:[]};for(var r in e.updateCallbacks)if(e.updateCallbacks.hasOwnProperty(r))try{var o=e.updateCallbacks[r];o(a.deepClone(t),Object.assign({},n.added||{},n.updated||{},n.reset||{}),n.removed,parseInt(r),i)}catch(e){this._logger.debug("Callback error: "+JSON.stringify(e))}},GW3Bridge.prototype.subscribeToContextDestroyedMessages=function(){for(var e=[s.GW_MESSAGE_CONTEXT_DESTROYED,s.GW_MESSAGE_ACTIVITY_DESTROYED],t=0,n=e;t<n.length;t++){var i=n[t],r=this._connection.on("js-contexts",i,this.handleContextDestroyedMessage.bind(this));this._gw3Subscriptions.push(r)}},GW3Bridge.prototype.handleContextDestroyedMessage=function(e){var t,n,i=e.type;if(i===s.GW_MESSAGE_ACTIVITY_DESTROYED){if(n=e.activity_id,!(t=this._contextNameToId[n]))return void this._logger.error("Received 'destroyed' for unknown activity: "+e.activity_id)}else if(t=e.context_id,!(n=this._contextIdToName[t]))return void this._logger.error("Received 'destroyed' for unknown context: "+e.context_id);delete this._contextIdToName[t],delete this._contextNameToId[n];var r=this._contextNameToData[n];if(delete this._contextNameToData[n],!r||!r.isAnnounced)return void this._logger.error("Received 'destroyed' for unknown context: "+t)},GW3Bridge.prototype.sendSubscribe=function(e){return e.sentExplicitSubscription=!0,this._gw3Session.send({type:s.GW_MESSAGE_SUBSCRIBE_CONTEXT,domain:"global",context_id:e.contextId}).then(function(e){return undefined})},GW3Bridge.prototype.sendUnsubscribe=function(e){return e.sentExplicitSubscription=!1,this._gw3Session.send({type:s.GW_MESSAGE_UNSUBSCRIBE_CONTEXT,domain:"global",context_id:e.contextId}).then(function(e){return undefined})},GW3Bridge.prototype.calculateContextDelta=function(e,t){var n={added:{},updated:{},removed:[],reset:null};if(e)for(var i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];-1===Object.keys(t).indexOf(o)||null===t[o]||a.deepEqual(e[o],t[o])||(n.updated[o]=t[o])}for(var s=0,c=Object.keys(t);s<c.length;s++){var o=c[s];e&&-1!==Object.keys(e).indexOf(o)?null===t[o]&&n.removed.push(o):null!==t[o]&&(n.added[o]=t[o])}return n},GW3Bridge}();t.GW3Bridge=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function GW3ContextData(e,t,n,i){this.updateCallbacks={},this.contextId=e,this.name=t,this.isAnnounced=n,this.activityId=i,this.context={}}return GW3ContextData.prototype.hasCallbacks=function(){return Object.keys(this.updateCallbacks).length>0},GW3ContextData.prototype.getState=function(){return this.isAnnounced&&this.hasCallbacks()?3:this.isAnnounced?2:this.hasCallbacks()?1:0},GW3ContextData}();t.GW3ContextData=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function fulfilled(e){try{step(i.next(e))}catch(e){o(e)}}function rejected(e){try{step(i["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i["return"]:o[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function HCBridge(e){this._facade=window.htmlContainer.sharedContextFacade}return HCBridge.prototype.all=function(){var e=this._facade.all();return e&&e.keys?e.keys:[]},HCBridge.prototype.update=function(e,t){return this._facade.update(e,t),Promise.resolve()},HCBridge.prototype.set=function(e,t){return this._facade.set(e,t),Promise.resolve()},HCBridge.prototype.subscribe=function(e,t){var n=null,i=this._facade.subscribe(e,function(e,r,o){if(!i&&0!==i)return void(n=e);t(e,r,o,i)});return n&&(t(n,n,[],i),n=null),Promise.resolve(i)},HCBridge.prototype.get=function(e){var t=this;return new Promise(function(n,o){return i(t,void 0,void 0,function(){var t=this;return r(this,function(i){return this.subscribe(e,function(e,i){t.unsubscribe(i),n(e)}),[2]})})})},HCBridge.prototype.unsubscribe=function(e){this._facade.unsubscribe(e)},HCBridge}();t.HCBridge=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(66),r=n(68),o=function(){function ContextsModule(e){this.config=e;try{if(2===e.gdMajorVersion){if(!window.htmlContainer.sharedContextFacade)throw new Error("Your version of HtmlContainer does not support contexts. Get version 1.46.0.0 or later to have that feature.");this._bridge=new r.HCBridge(e)}else{if(3!==e.connection.protocolVersion)throw new Error("To use the Contexts library you must run in the HTML Container or using a connection to Gateway v3.");this._bridge=new i.GW3Bridge(e)}}catch(e){throw e}}return ContextsModule.prototype.all=function(){return this._bridge.all()},ContextsModule.prototype.update=function(e,t){return this.checkName(e),this._bridge.update(e,t)},ContextsModule.prototype.set=function(e,t){return this.checkName(e),this._bridge.set(e,t)},ContextsModule.prototype.subscribe=function(e,t){var n=this;return this.checkName(e),this._bridge.subscribe(e,function(e,i,r,o,a){return t(e,i,r,function(){return n._bridge.unsubscribe(o)},a)}).then(function(e){return function(){n._bridge.unsubscribe(e)}})},ContextsModule.prototype.get=function(e){return this._bridge.get(e)},ContextsModule.prototype.ready=function(){return Promise.resolve(this)},ContextsModule.prototype.checkName=function(e){if("string"!=typeof e||""==e)throw new Error("'name' must be non-empty string, got '"+e+"'")},ContextsModule}();t.ContextsModule=o},function(e,t,n){"use strict";function applyContextDelta(e,t){if(t){if(t.reset)return e=i({},t.reset);e=deepClone(e,null);var n=t.added,o=t.updated,a=t.removed;n&&Object.keys(n).forEach(function(t){e[t]=n[t]}),o&&Object.keys(o).forEach(function(t){r(t,e,o)}),a&&a.forEach(function(t){delete e[t]})}return e}function deepClone(e,t){if(t=t||new WeakMap,Object(e)!==e)return e;if(e instanceof Set)return new Set(e);if(t.has(e))return t.get(e);var n=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e.constructor?new e.constructor:Object.create(null);return t.set(e,n),e instanceof Map&&Array.from(e,function(e){var i=e[0],r=e[1];return n.set(i,deepClone(r,t))}),Object.assign.apply(Object,[n].concat(Object.keys(e).map(function(n){var i;return i={},i[n]=deepClone(e[n],t),i})))}function deepEqual(e,t){if(e===t)return!0;if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]!==t[n]){if("object"!=typeof e[n])return!1;if(!deepEqual(e[n],t[n]))return!1}}for(var n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.applyContextDelta=applyContextDelta,t.deepClone=deepClone;var r=function(e,t,n){var i=n[e];if(i===undefined)return t;var r=t[e];return r&&i?"string"==typeof r||"number"==typeof r||"boolean"==typeof r||"string"==typeof i||"number"==typeof i||"boolean"==typeof i||Array.isArray(r)||Array.isArray(i)?(t[e]=i,t):(t[e]=Object.assign({},r,i),t):(t[e]=i,t)};t.deepEqual=deepEqual},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(69);t.ContextsModule=i.ContextsModule},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function LogLevel(){}return LogLevel.canPublish=function(e,t){return LogLevel.order.indexOf(e)>=LogLevel.order.indexOf(t)},LogLevel.off="off",LogLevel.trace="trace",LogLevel.debug="debug",LogLevel.info="info",LogLevel.warn="warn",LogLevel.error="error",LogLevel.order=[LogLevel.trace,LogLevel.debug,LogLevel.info,LogLevel.warn,LogLevel.error,LogLevel.off],LogLevel}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(72),r=function(){function LoggerImpl(e,t,n){this._subloggers=[],this._name=e,this._parent=t,this._path=t?t.path+"."+e:e,this._loggerFullName="["+this._path+"]",void 0!==n&&this.metricsLevel("warn",n.subSystem(e))}return Object.defineProperty(LoggerImpl.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(LoggerImpl.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),LoggerImpl.prototype.subLogger=function(e){var t=this._subloggers.filter(function(t){return t.name===e})[0];if(t!==undefined)return t;Object.keys(this).forEach(function(t){if(t===e)throw new Error("This sub logger name is not allowed.")});var n=new LoggerImpl(e,this);return this._subloggers.push(n),n},LoggerImpl.prototype.publishLevel=function(e){return null!==e&&e!==undefined&&(this._publishLevel=e),this._publishLevel||this._parent.publishLevel()},LoggerImpl.prototype.consoleLevel=function(e){return null!==e&&e!==undefined&&(this._consoleLevel=e),this._consoleLevel||this._parent.consoleLevel()},LoggerImpl.prototype.metricsLevel=function(e,t){if(null!==e&&e!==undefined&&(this._metricLevel=e),t!==undefined){if("object"!=typeof t||"function"!=typeof t.objectMetric)throw new Error("Please specify metric system");this._metricSystem=t}return this._metricLevel||this._parent.metricsLevel()},LoggerImpl.prototype.log=function(e,t){this.publishMessage(t||i["default"].info,e)},LoggerImpl.prototype.trace=function(e){this.log(e,i["default"].trace)},LoggerImpl.prototype.debug=function(e){this.log(e,i["default"].debug)},LoggerImpl.prototype.info=function(e){this.log(e,i["default"].info)},LoggerImpl.prototype.warn=function(e){this.log(e,i["default"].warn)},LoggerImpl.prototype.error=function(e){this.log(e,i["default"].error)},LoggerImpl.prototype.toAPIObject=function(){var e=this;return{name:this.name,subLogger:this.subLogger.bind(e),publishLevel:this.publishLevel.bind(e),consoleLevel:this.consoleLevel.bind(e),metricsLevel:this.metricsLevel.bind(e),log:this.log.bind(e),trace:this.trace.bind(e),debug:this.debug.bind(e),info:this.info.bind(e),warn:this.warn.bind(e),error:this.error.bind(e)}},LoggerImpl.prototype.publishMessage=function(e,t){var n=this._loggerFullName;if(e===i["default"].error){var r=new Error;r.stack&&(t=t+"\n"+r.stack.split("\n").slice(3).join("\n"))}if(i["default"].canPublish(e,this.consoleLevel())){var o=n+": "+t;switch(e){case i["default"].trace:console.trace(o);break;case i["default"].debug:console.debug?console.debug(o):console.log(o);break;case i["default"].info:console.info(o);break;case i["default"].warn:console.warn(o);break;case i["default"].error:console.error(o)}}i["default"].canPublish(e,this.publishLevel())&&LoggerImpl.GetConnection().send("log","LogMessage",{instance:LoggerImpl.Instance,level:i["default"].order.indexOf(e),logger:n,message:t}),i["default"].canPublish(e,this.metricsLevel())&&this._metricSystem!==undefined&&(this._metricSystem.objectMetric("LogMessage",{Level:e,Logger:n,Message:t,Time:new Date}),e===i["default"].error&&this._metricSystem.setState(100,t))},LoggerImpl}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(73);t["default"]=function(e){var t=e.identity;if(!t)throw new Error("identity is missing");var n=t.system+"\\"+t.service+"\\"+t.instance;i["default"].Instance=n,i["default"].GetConnection=e.getConnection;var r=new i["default"]("main");return r.publishLevel(e.publish||"off"),r.consoleLevel(e.console||"info"),r.metricsLevel(e.metrics||"off"),r.toAPIObject()}},function(e,t,n){"use strict";var i=n(16),r=n(12);"undefined"!=typeof window&&(window.GlueCore=i["default"]),i["default"]["default"]=i["default"],i["default"].version=r.version,e.exports=i["default"]},function(e,t,n){"use strict";function addressMetric(e,t,n,o){function update(e){s=e,a.updateMetric(m)}function getValueType(){return undefined}i["default"].validate(e,t,n);var a=n,s=o||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,p=e.period,f=e.resolution,l=t,h=t.repo,y=e.conflation,g=t.path+"/"+u,v=r["default"].ADDRESS,m={name:u,description:d,period:p,resolution:f,system:l,repo:h,id:g,type:v,conflation:y,get value(){return s},get path(){return c},update:update,getValueType:getValueType};return a.createMetric(m),m}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0);t["default"]=addressMetric},function(e,t,n){"use strict";function countMetric(e,t,n,o){function update(e){s=e,a.updateMetric(m)}function getValueType(){return undefined}function incrementBy(e){update(s+e)}function increment(){incrementBy(1)}function decrement(){incrementBy(-1)}function decrementBy(e){incrementBy(-1*e)}i["default"].validate(e,t,n);var a=n,s=o||0,c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,p=e.period,f=e.resolution,l=e.conflation,h=t,y=t.repo,g=t.path+"/"+u,v=r["default"].COUNT,m={name:u,description:d,period:p,resolution:f,system:h,repo:y,id:g,type:v,conflation:l,get path(){return c},get value(){return s},update:update,getValueType:getValueType,incrementBy:incrementBy,increment:increment,decrement:decrement,decrementBy:decrementBy};return a.createMetric(m),m}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0);t["default"]=countMetric},function(e,t,n){"use strict";function numberMetric(e,t,n,o){function update(e){c=e,a.updateMetric(m)}function getValueType(){return undefined}function incrementBy(e){update(c+e)}function increment(){incrementBy(1)}function decrement(){incrementBy(-1)}function decrementBy(e){incrementBy(-1*e)}i["default"].validate(e,t,n);var a=n,s=t.path.slice(0),c=o||0,u=e.name,d=e.description,p=e.period,f=e.resolution,l=e.conflation,h=t,y=t.repo,g=t.path+"/"+u,v=r["default"].NUMBER;s.push(t.name);var m={name:u,description:d,period:p,resolution:f,system:h,repo:y,id:g,conflation:l,get value(){return c},type:v,get path(){return s},update:update,getValueType:getValueType,incrementBy:incrementBy,increment:increment,decrement:decrement,decrementBy:decrementBy};return a.createMetric(m),m}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0);t["default"]=numberMetric},function(e,t,n){"use strict";function objectMetric(e,t,n,o){function update(e){mergeValues(e),a.updateMetric(m)}function getValueType(){return undefined}function mergeValues(e){return Object.keys(s).forEach(function(t){"undefined"!=typeof e[t]&&(s[t]=e[t])})}r["default"].validate(e,t,n);var a=n,s=o||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,p=e.period,f=e.resolution,l=e.conflation,h=t,y=t.repo,g=t.path+"/"+u,v=i["default"].OBJECT,m={name:u,description:d,period:p,resolution:f,system:h,repo:y,id:g,type:v,conflation:l,get value(){return s},get path(){return c},update:update,getValueType:getValueType};return a.createMetric(m),m}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(2);t["default"]=objectMetric},function(e,t,n){"use strict";function rateMetric(e,t,n,o){function update(e){s=e,a.updateMetric(m)}function getValueType(){return undefined}i["default"].validate(e,t,n);var a=n,s=o||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,p=e.period,f=e.resolution,l=e.conflation,h=t,y=t.repo,g=t.path+"/"+u,v=r["default"].RATE,m={name:u,description:d,period:p,resolution:f,system:h,repo:y,id:g,type:v,conflation:l,get value(){return s},get path(){return c},update:update,getValueType:getValueType};return a.createMetric(m),m}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0);t["default"]=rateMetric},function(e,t,n){"use strict";function statisticsMetric(e,t,n,o){function update(e){s=e,a.updateMetric(m)}function getValueType(){return undefined}i["default"].validate(e,t,n);var a=n,s=o||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,p=e.period,f=e.resolution,l=e.conflation,h=t,y=t.repo,g=t.path+"/"+u,v=r["default"].STATISTICS,m={name:u,description:d,period:p,resolution:f,system:h,repo:y,id:g,type:v,conflation:l,get value(){return s},get path(){return c},update:update,getValueType:getValueType};return a.createMetric(m),m}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0);t["default"]=statisticsMetric},function(e,t,n){"use strict";function stringMetric(e,t,n,o){function update(e){s=e,a.updateMetric(m)}function getValueType(){return undefined}i["default"].validate(e,t,n);var a=n,s=o||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,p=e.period,f=e.resolution,l=e.conflation,h=t,y=t.repo,g=t.path+"/"+u,v=r["default"].STRING,m={name:u,description:d,period:p,resolution:f,system:h,repo:y,id:g,conflation:l,get value(){return s},get path(){return c},type:v,update:update,getValueType:getValueType};return a.createMetric(m),m}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0);t["default"]=stringMetric},function(e,t,n){"use strict";function timespanMetric(e,t,n,o){function update(e){s=e,a.updateMetric(m)}function start(){update(!0)}function stop(){update(!1)}function getValueType(){return undefined}i["default"].validate(e,t,n);var a=n,s=o||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,p=e.period,f=e.resolution,l=e.conflation,h=t,y=t.repo,g=t.path+"/"+u,v=r["default"].TIMESPAN,m={name:u,description:d,period:p,resolution:f,system:h,repo:y,id:g,type:v,conflation:l,get value(){return s},get path(){return c},update:update,start:start,stop:stop,getValueType:getValueType};return a.createMetric(m),m}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0);t["default"]=timespanMetric},function(e,t,n){"use strict";function timestampMetric(e,t,n,o){function update(e){s=e,a.updateMetric(m)}function now(){update(new Date)}function getValueType(){return undefined}i["default"].validate(e,t,n);var a=n,s=o||"",c=t.path.slice(0);c.push(t.name);var u=e.name,d=e.description,p=e.period,f=e.resolution,l=e.conflation,h=t,y=t.repo,g=t.path+"/"+u,v=r["default"].TIMESTAMP,m={name:u,description:d,period:p,resolution:f,system:h,repo:y,id:g,type:v,conflation:l,get value(){return s},get path(){return c},update:update,now:now,getValueType:getValueType};return a.createMetric(m),m}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(0);t["default"]=timestampMetric},function(e,t,n){"use strict";function default_1(e,t){function sendFull(e){e.root&&0!==e.root.subSystems.length&&sendFullSystem(e.root)}function sendFullSystem(e){createSystem(e),e.subSystems.forEach(function(e){sendFullSystem(e)}),e.metrics.forEach(function(e){createMetric(e)})}function heartbeat(e){a("HeartbeatMetrics",{publishingInterval:o,instance:e.instance})}function createSystem(e){e.parent!==undefined&&a("CreateMetricSystem",{id:e.id,instance:e.repo.instance,definition:{name:e.name,description:e.description,path:e.path}})}function updateSystem(e,t){a("UpdateMetricSystem",{id:e.id,instance:e.repo.instance,state:t})}function createMetric(e){a("CreateMetric",i["default"](e))}function updateMetric(e){a("UpdateMetric",i["default"](e))}function init(e){heartbeat(e),r.on("metrics","MetricsSnapshotRequest",function(t){t.Instance===e.instance&&sendFull(e)}),r.disconnected(function(){return clearInterval(n)}),"undefined"!=typeof window&&"undefined"==typeof window.htmlContainer&&(n=setInterval(function(){heartbeat(e)},o))}var n;if(!e||"object"!=typeof e)throw new Error("Connection is required parameter");var r=e,o=t.heartbeatInterval||3e3,a=function(e,t){r.send("metrics",e,t)};return{createSystem:createSystem,updateSystem:updateSystem,createMetric:createMetric,updateMetric:updateMetric,init:init}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(86);t["default"]=default_1},function(e,t,n){"use strict";function metricToMessage(e){function getMetricDefinition(e,t,n,r,o,a,s,c){var u={name:e,description:o,type:r||getTypeFromValue(t),path:n,resolution:s,period:a,conflation:c};return u.type===i["default"].OBJECT&&(u.Composite=Object.keys(t).reduce(function(e,i){var r=t[i];return e.push(getMetricDefinition(i,r,n)),e},[])),u}function serializeValue(e,t){if(e&&e.constructor===Date)return{value:{type:n.indexOf("date"),value:e.valueOf(),isArray:!1}};if("object"==typeof e)return{CompositeValue:Object.keys(e).reduce(function(t,n){var i=serializeValue(e[n]);return i.InnerMetricName=n,t.push(i),t},[])};var i=t?t.getValueType():undefined;return i=i||n.indexOf(typeof e),{value:{type:i,value:e,isArray:!1}}}function getTypeFromValue(e){switch(e.constructor===Date?"timestamp":typeof e){case"string":return i["default"].STRING;case"number":return i["default"].NUMBER;case"timestamp":return i["default"].TIMESTAMP;case"object":return i["default"].OBJECT}return 0}var t=getMetricDefinition(e.name,e.value,e.path,e.type,e.description,e.period,e.resolution,e.conflation),n=["boolean","int","number","long","string","date","object"];return{id:e.id,instance:e.repo.instance,definition:t,value:serializeValue(e.value,e)}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t["default"]=metricToMessage},function(e,t,n){"use strict";function default_1(e,t){if(!e||"object"!=typeof e)throw new Error("Connection is required parameter");var n,r,o=function(i){var o;n=new Promise(function(e){o=e}),r=e.domain("metrics",t.logger),r.onJoined(function(e){e||(o(),o=undefined);var t={name:"/State",type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},n={type:"define",metrics:[t]};r.send(n),e&&a(i)}),r.join(t.identity)},a=function(e){s(e.root)},s=function(e){c(e),e.metrics.forEach(function(e){d(e)}),e.subSystems.forEach(function(e){s(e)})},c=function(e){e.parent!==undefined&&n.then(function(){var t={name:i.normalizeMetricName(e.path.join("/")+"/"+e.name+"/State"),type:"object",composite:{Description:{type:"string",description:""},Value:{type:"number",description:""}},description:"System state",context:{}},n={type:"define",metrics:[t]};r.send(n)})},u=function(t,o){n.then(function(){var n={type:"publish",values:[{name:i.normalizeMetricName(t.path.join("/")+"/"+t.name+"/State"),value:{Description:o.description,Value:o.state},timestamp:Date.now()}]};r.send(n);var a=i.composeMsgForRootStateMetric(t),s={type:"publish",peer_id:e.peerId,values:[{name:"/State",value:{Description:a.description,Value:a.value},timestamp:Date.now()}]};r.send(s)})},d=function(e){n.then(function(){var t=i.serializeMetric(e),n={type:"define",metrics:[t]};r.send(n),"undefined"!=typeof e.value&&p(e)})},p=function(e){n.then(function(){var t=i.getMetricValueByType(e),n={type:"publish",values:[{name:i.normalizeMetricName(e.path.join("/")+"/"+e.name),value:t,timestamp:Date.now()}]};r.send(n)})};return{init:o,createSystem:c,updateSystem:u,createMetric:d,updateMetric:p}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(88);t["default"]=default_1},function(e,t,n){"use strict";function getMetricTypeByValue(e){return e.value&&e.value.constructor===Date||e.type===i["default"].TIMESPAN||e.type===i["default"].TIMESTAMP?"timestamp":"number"==typeof e.value?"number":"string"==typeof e.value||e.type===i["default"].STRING||e.type===i["default"].RATE?"string":"object"==typeof e.value?"object":void 0}function getTypeByValue(e){return e.constructor===Date?"timestamp":"number"==typeof e?"number":"string"==typeof e?"string":"object"==typeof e?"object":"string"}function serializeMetric(e){var t={},n=getMetricTypeByValue(e);if("object"===n){var i=Object.keys(e.value).reduce(function(t,n){var i=getTypeByValue(e.value[n]);if("object"===i){var r=defineNestedComposite(e.value[n]);t[n]={type:"object",description:"",context:{},composite:r}}else t[n]={type:i,description:"",context:{}};return t},{});t.composite=i}return t.name=normalizeMetricName(e.path.join("/")+"/"+e.name),t.type=n,t.description=e.description,t.context={},t}function defineNestedComposite(e){return Object.keys(e).reduce(function(t,n){var i=getTypeByValue(e[n]);return t[n]="object"===i?{type:"object",description:"",context:{},composite:defineNestedComposite(e[n])}:{type:i,description:"",context:{}},t},{})}function normalizeMetricName(e){return void 0!==e&&e.length>0&&"/"!==e[0]?"/"+e:e}function getMetricValueByType(e){return"timestamp"===getMetricTypeByValue(e)?Date.now():publishNestedComposite(e.value)}function publishNestedComposite(e){return"object"!=typeof e?e:Object.keys(e).reduce(function(t,n){var i=e[n];return"object"==typeof i&&i.constructor!==Date?t[n]=publishNestedComposite(i):i.constructor===Date?t[n]=new Date(i).getTime():i.constructor===Boolean?t[n]=i.toString():t[n]=i,t},{})}function flatten(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?flatten(t):t)},[])}function getHighestState(e){return e.sort(function(e,t){return t.state-e.state})[0]}function aggregateDescription(e){var t="";return e.forEach(function(e,n,i){var r=e.path.join(".");n===i.length-1?t+=r+"."+e.name+": "+e.description:t+=r+"."+e.name+": "+e.description+","}),t.length>100?t.slice(0,100)+"...":t}function composeMsgForRootStateMetric(e){var t=e.root.getAggregateState(),n=flatten(t),i=getHighestState(n);return{description:aggregateDescription(n),value:i.state}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.serializeMetric=serializeMetric,t.normalizeMetricName=normalizeMetricName,t.getMetricValueByType=getMetricValueByType,t.composeMsgForRootStateMetric=composeMsgForRootStateMetric},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(87),r=n(85),o=n(90);t["default"]=function(e){var t={connection:e.connection,identity:e.identity,logger:e.logger,heartbeatInterval:e.heartbeatInterval,settings:{},clickStream:e.clickStream};if(!t.connection||"object"!=typeof t.connection)throw new Error("Connection is required parameter");var n;return n=3===t.connection.protocolVersion?i["default"](t.connection,e):r["default"](t.connection,e),o["default"](t,n).root}},function(e,t,n){"use strict";function repository(e,t){if(!e.identity)throw new Error("Identity missing from metrics configuration");if(!e.identity.service||"string"!=typeof e.identity.service)throw new Error("Service missing or invalid in metrics identity configuration");if(!e.identity.system||"string"!=typeof e.identity.system)throw new Error("System missing or invalid in metrics identity configuration");if(!e.identity.instance||"string"!=typeof e.identity.instance)throw new Error("Instance missing or invalid in metrics identity configuration");var n=e.identity,r=e.identity.system+"/"+e.identity.service+"/"+e.identity.instance,o={identity:n,instance:r,get root(){return a}};t.init(o);var a=i["default"]("",o,t);return function(e,t){if("undefined"!=typeof navigator&&e.stringMetric("UserAgent",navigator.userAgent),t&&"undefined"!=typeof document){var n=e.subSystem("ClickStream"),i=function(e){if(e.target){var t=e.target;n.objectMetric("LastBrowserEvent",{type:"click",timestamp:new Date,target:{className:e.target?t.className:"",id:t.id,type:"<"+t.tagName.toLowerCase()+">",href:t.href||""}})}};n.objectMetric("Page",{title:document.title,page:window.location.href}),document.addEventListener?document.addEventListener("click",i):document.attachEvent("onclick",i)}var r=(e.stringMetric("StartTime",(new Date).toString()),e.stringMetric("StartURL","")),o=e.stringMetric("AppName","");if("undefined"!=typeof window){if("undefined"!=typeof window.location){var a=window.location.href;r.update(a)}"undefined"!=typeof window.glue42gd&&o.update(window.glue42gd.appName)}}(a,e.clickStream||e.clickStream===undefined),o}Object.defineProperty(t,"__esModule",{value:!0});var i=n(91);t["default"]=repository},function(e,t,n){"use strict";function system(e,t,n,l,h){function subSystem(e,t){if(!e||0===e.length)throw new Error("name is required");var n=I.filter(function(t){return t.name===e});if(n.length>0)return n[0];var i=system(e,m,y,T,t);return I.push(i),i}function setState(e,t){_={state:e,description:t},y.updateSystem(T,_)}function stringMetric(e,t){return _getOrCreateMetric.call(T,e,f["default"].STRING,t,function(e){return u["default"](e,T,y,t)})}function numberMetric(e,t){return _getOrCreateMetric.call(T,e,f["default"].NUMBER,t,function(e){return o["default"](e,T,y,t)})}function countMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].COUNT,t,function(e){return r["default"](e,T,y,t)})}function addressMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].ADDRESS,t,function(e){return i["default"](e,T,y,t)})}function objectMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].OBJECT,t,function(e){return a["default"](e,T,y,t)})}function timespanMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].TIMESPAN,t,function(e){return d["default"](e,T,y,t)})}function timestampMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].TIMESTAMP,t,function(e){return p["default"](e,T,y,t)})}function rateMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].RATE,t,function(e){return s["default"](e,T,y,t)})}function statisticsMetric(e,t){return _getOrCreateMetric.call(this,e,f["default"].STATISTICS,t,function(e){return c["default"](e,T,y,t)})}function _unionToMetricDef(e){var t={};if("string"==typeof e?t.name=e:t=e,t.name===undefined)throw new Error("Metric name is required");return t}function _getOrCreateMetric(e,t,n,i){var r=_unionToMetricDef(e),o=M.filter(function(e){return e.name===r.name});if(o.length>0){var a=o[0];if(a.type!==t)throw new Error("A metric named "+r.name+" is already defined with different type.");return void 0!==n&&a.update(n),a}var s=i(r);return M.push(s),s}function _buildPath(e){if(!e||!e.parent)return[];var t=_buildPath(e.parent);return t.push(e.name),t}function getAggregateState(){var e=[];return Object.keys(_).length>0&&e.push({name:g,path:w,state:_.state,description:_.description}),I.forEach(function(t){var n=t.getAggregateState();n.length>0&&e.push.apply(e,n)}),e}if(!t)throw new Error("Repository is required");if(!n)throw new Error("Transport is required");var y=n,g=e,v=h||"",m=t,b=l,w=_buildPath(l),_={},S=function(e,t){return e&&e.length>0?e.join(t):""}(w,"/")+e,A=t.identity,C=t.root,I=[],M=[],T={get name(){return g},get description(){return v},get repo(){return m},get parent(){return b},path:w,id:S,identity:A,root:C,get subSystems(){return I},get metrics(){return M},subSystem:subSystem,getState:function(){return _},setState:setState,stringMetric:stringMetric,statisticsMetric:statisticsMetric,rateMetric:rateMetric,timestampMetric:timestampMetric,timespanMetric:timespanMetric,objectMetric:objectMetric,addressMetric:addressMetric,countMetric:countMetric,numberMetric:numberMetric,getAggregateState:getAggregateState};return y.createSystem(T),T}Object.defineProperty(t,"__esModule",{value:!0});var i=n(76),r=n(77),o=n(78),a=n(79),s=n(80),c=n(81),u=n(82),d=n(83),p=n(84),f=n(0);t["default"]=system},function(e,t,n){"use strict";function default_1(){function now(){return(new Date).getTime()}function stop(){return e=now(),t=now()-n}var e,t,n=now();return{get startTime(){return n},get endTime(){return e},get period(){return t},stop:stop}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=default_1}])})},function(e,t){var n=function(e){return!!(e&&e.constructor&&e.call&&e.apply)};e.exports=function(e,t,i){"use strict";if(!n(t)&&!n(i))return e;n(t)?n(i)||(i=function(){}):t=function(){},e.then(t,i)}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),r=n(40),o=n(9),a=function(){function ActivityAPI(e,t){this._mgr=e,this._my=t,this.all=new r.ActivityManagementAPI(e,t)}return ActivityAPI.prototype.ready=function(e){var t=this,n=new Promise(function(e,n){t._mgr.ready().then(function(){e(t)})["catch"](function(e){n(e)})});return i.nodeify(n,e)},Object.defineProperty(ActivityAPI.prototype,"my",{get:function(){return this._my},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityAPI.prototype,"aware",{get:function(){return this._my.window!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityAPI.prototype,"inActivity",{get:function(){return this.aware&&this._my.activity!==undefined},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityAPI.prototype,"agm",{get:function(){return this.aware?this.inActivity?this._my.activity.agm:new o.ActivityAGM(null):undefined},enumerable:!0,configurable:!0}),ActivityAPI.prototype.getAvailableFrameColors=function(){var e,t=window.htmlContainer;return t&&(e=t.getFrameColors()),e=e||[]},ActivityAPI}();t.ActivityAPI=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),r=function(){function ActivityManagementAPI(e,t){this._m=e,this._my=t,this.activityTypes={get:this._getActivityTypesWrapper.bind(this),register:this._m.registerActivityType.bind(this._m),unregister:this._m.unregisterActivityType.bind(this._m),subscribe:this._m.subscribeActivityTypeEvents.bind(this._m),unsubscribe:undefined,initiate:this._m.initiate.bind(this._m)},this.windowTypes={get:this._getWindowTypesWrapper.bind(this),registerFactory:this._m.registerWindowFactory.bind(this._m),unregisterFactory:this._m.unregisterWindowFactory.bind(this._m),subscribe:this._m.subscribeWindowTypeEvents.bind(this._m),unsubscribe:undefined},this.windows={get:this._m.getWindows.bind(this._m),subscribe:this._m.subscribeWindowEvents.bind(this._m),announce:this._m.announceWindow.bind(this._m),unsubscribe:undefined,create:this._m.createWindow.bind(this._m)},this.instances={get:this._m.getActivities.bind(this._m),subscribe:this._m.subscribeActivityEvents.bind(this._m),unsubscribe:undefined}}return ActivityManagementAPI.prototype.onAttached=function(e){this._m.subscribeActivitiesAttached(e)},ActivityManagementAPI.prototype.onDetached=function(e){this._m.subscribeActivitiesDetached(e)},ActivityManagementAPI.prototype.onActivityFrameColorChanged=function(e){this._m.subscribeActivityFrameColorChanged(e)},ActivityManagementAPI.prototype._getActivityTypesWrapper=function(e){return i.isUndefined(e)?this._m.getActivityTypes():this._m.getActivityType(e)},ActivityManagementAPI.prototype._getWindowTypesWrapper=function(e){return i.isUndefined(e)?this._m.getWindowTypes():this._m.getWindowType(e)},ActivityManagementAPI}();t.ActivityManagementAPI=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(4),o=n(1),a=function(){function ActivityMy(e,t){var n=this;this._myAttached=[],this._myDetached=[],this._myAttachedTo=[],this._myDetachedFrom=[],this._myActivityFrameColorChanged=[],this._myActivityJoinedCallbacks=[],this._myActivityRemovedCallbacks=[],this._myContextUpdateCallbacks=[],this._logger=r.Logger.Get(this),this._m=e,e.ready().then(function(e){e.subscribeActivityContextChanged(n._subscribeMyContextChanged.bind(n)),e.subscribeWindowEvents(n._subscribeMyWindowEvent.bind(n)),e.subscribeActivitiesAttached(n._subscribeActivitiesAttached.bind(n)),e.subscribeActivitiesDetached(n._subscribeActivitiesDetached.bind(n)),t&&t.onWindowFrameColorChanged(n._subscribeWindowFrameColorChanged.bind(n))})}return Object.defineProperty(ActivityMy.prototype,"window",{get:function(){if(o.isUndefinedOrNull(this._w)){var e=this._m.announcedWindows;e.length>0&&(this._w=e[0])}return this._w},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityMy.prototype,"activity",{get:function(){var e=this.window;return o.isUndefinedOrNull(e)?undefined:e.activity},enumerable:!0,configurable:!0}),ActivityMy.prototype.createWindow=function(e){return this._m.createWindow(this.activity,e)},ActivityMy.prototype.createStackedWindows=function(e,t){return this._m.createStackedWindows(this.activity,e,t)},Object.defineProperty(ActivityMy.prototype,"context",{get:function(){var e=this.activity;return o.isUndefined(e)?{}:e.context},enumerable:!0,configurable:!0}),ActivityMy.prototype.updateContext=function(e,t){var n=this.activity;return o.isUndefined(n)?new Promise(function(e,t){t("Not in activity")}):n.updateContext(e,t)},ActivityMy.prototype.setContext=function(e,t){var n=this.activity;return o.isUndefined(n)?new Promise(function(e,t){t("Not in activity")}):n.setContext(e,t)},ActivityMy.prototype.onActivityJoined=function(e){this._myActivityJoinedCallbacks.push(e);var t=this.window;o.isUndefinedOrNull(t)||o.isUndefinedOrNull(t.activity)||e(t.activity)},ActivityMy.prototype.onActivityLeft=function(e){this._myActivityRemovedCallbacks.push(e)},ActivityMy.prototype.onContextChanged=function(e){this._myContextUpdateCallbacks.push(e);var t=this.window;if(!o.isUndefinedOrNull(t)){var n=t.activity;o.isUndefinedOrNull(n)||e(n.context,n.context,[],n)}},ActivityMy.prototype.clone=function(e,t){var n=this.activity;return this._m.clone(n,e,t)},ActivityMy.prototype.attach=function(e,t){var n;return n="string"==typeof e?e:e.id,this._m.attachActivities(n,this.activity.id,t)},ActivityMy.prototype.onActivityAttached=function(e){this._myAttached.push(e)},ActivityMy.prototype.onActivityDetached=function(e){this._myDetached.push(e)},ActivityMy.prototype.onAttachedToActivity=function(e){this._myAttachedTo.push(e)},ActivityMy.prototype.onDetachedFromActivity=function(e){this._myDetachedFrom.push(e)},Object.defineProperty(ActivityMy.prototype,"attached",{get:function(){return this.activity?this.activity.attached:[]},enumerable:!0,configurable:!0}),ActivityMy.prototype.setFrameColor=function(e,t){return this.activity?this.activity.setFrameColor(e,t):Promise.resolve(null)},ActivityMy.prototype.getFrameColor=function(){return this.activity?this.activity.getFrameColor():""},ActivityMy.prototype.onFrameColorChanged=function(e){this._myActivityFrameColorChanged.push(e)},ActivityMy.prototype._subscribeMyContextChanged=function(e,t,n,i){var r=this.window;if(!o.isUndefinedOrNull(r)){var a=r.activity;o.isUndefinedOrNull(a)||e.id===a.id&&this._notifyMyContextChanged(e,t,n,i)}},ActivityMy.prototype._subscribeMyWindowEvent=function(e,t,n){o.isUndefinedOrNull(this.window)||this.window.id===t.id&&(n===i.EntityEventType.ActivityWindowJoinedActivity?(this._notifyMyWindowEvent(e,this._myActivityJoinedCallbacks),this._notifyMyContextChanged(e,e.context,null,null)):n===i.EntityEventType.ActivityWindowLeftActivity&&this._notifyMyWindowEvent(e,this._myActivityRemovedCallbacks))},ActivityMy.prototype._notifyMyWindowEvent=function(e,t){var n=this;t.forEach(function(t){try{t(e,event)}catch(e){n._logger.warn("error in user callback "+e)}})},ActivityMy.prototype._notifyMyContextChanged=function(e,t,n,i){var r=this;n=n||{},i=i||[],this._myContextUpdateCallbacks.forEach(function(o){try{o(t,n,i,e)}catch(e){r._logger.warn("error in user callback "+e)}})},ActivityMy.prototype._notifyAttached=function(e){var t=this;this._myAttached.forEach(function(n){try{n(e)}catch(e){t._logger.warn("error in user callback "+e)}})},ActivityMy.prototype._notifyDetached=function(e){var t=this;this._myDetached.forEach(function(n){try{n(e)}catch(e){t._logger.warn("error in user callback "+e)}})},ActivityMy.prototype._notifyAttachedTo=function(e){var t=this;this._myAttachedTo.forEach(function(n){try{n(t.activity,e)}catch(e){t._logger.warn("error in user callback "+e)}})},ActivityMy.prototype._notifyDetachedFrom=function(e,t,n){var i=this;this._myDetachedFrom.forEach(function(r){try{r(e,t,n)}catch(e){i._logger.warn("error in user callback "+e)}})},ActivityMy.prototype._subscribeActivitiesAttached=function(e,t){var n=this.window;if(!o.isUndefinedOrNull(n)){var i=n.activity;if(!o.isUndefinedOrNull(i)&&e.id===i.id)return t.windowIds.indexOf(n.id)>=0?void this._notifyAttachedTo(t):void this._notifyAttached(t)}},ActivityMy.prototype._subscribeActivitiesDetached=function(e,t,n){var i=this.window;if(!o.isUndefinedOrNull(i)){var r=i.activity;o.isUndefinedOrNull(r)||(t.id===r.id&&this._notifyDetached(n),e.id===r.id&&this._notifyDetachedFrom(e,t,n))}},ActivityMy.prototype._subscribeWindowFrameColorChanged=function(e){var t=this.activity;t&&t.owner&&t.owner.underlyingWindow.id===e.id&&this._myActivityFrameColorChanged.forEach(function(t){t(e.frameColor)})},ActivityMy}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(43),r=n(12),o=n(41),a=n(44),s=n(39),c=n(9),u=n(4),d=n(1),p=n(8),f=function(){function ActivityModule(e){var t=this;if(!e)throw new Error("config can not be null");d.isUndefined(e.logLevel)||(u.Logger.Level=e.logLevel),d.isUndefinedOrNull(e.logger)||(u.Logger.GlueLogger=e.logger);var n;if(this._isUsingHCImplementation=2===e.gdMajorVersion,this._isUsingGW3Implementation=ActivityModule.checkIsUsingGW3Implementation(e.connection),this._isUsingHCImplementation)n=new r["default"](undefined,e.windows,e.appManagerGetter,e.mode,e.typesToTrack);else{if(!this._isUsingGW3Implementation)throw new Error("Unable to instantiate activity bridge implementation");n=new i["default"](e.connection,e.logger,e.contexts,e)}if(!n)throw new Error("A bridge to native activity is needed to create activity lib.");c.ActivityAGM.AGM=e.agm;var p=new a["default"](n,!e.disableAutoAnnounce,e.windows),f=new o["default"](p,e.windows);this._api=new s.ActivityAPI(p,f),this._readyPromise=p.ready().then(function(e){return t})}return ActivityModule.checkIsUsingGW3Implementation=function(e){return 3===e.protocolVersion},Object.defineProperty(ActivityModule.prototype,"api",{get:function(){return this._api},set:function(e){this._api=e},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityModule.prototype,"isUsingHCImplementation",{get:function(){return this._isUsingHCImplementation},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityModule.prototype,"isUsingGW3Implementation",{get:function(){return this._isUsingGW3Implementation},enumerable:!0,configurable:!0}),ActivityModule.prototype.ready=function(e){return p.nodeify(this._readyPromise,e)},ActivityModule}();t.ActivityModule=f},function(e,t,n){"use strict";(function(e){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function fulfilled(e){try{step(i.next(e))}catch(e){o(e)}}function rejected(e){try{step(i["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i["return"]:o[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),a=n(16),s=n(2),c=n(14),u=n(15),d=n(13),p=function(){function GW3Bridge(e,t,n,i){var r=this;this._activityChangeCallbacks=[],this._activityTypeStatusChangeCallbacks=[],this._activityWindowChangeCallbacks=[],this._windowTypeStatusChangeCallbacks=[],this._peerIdAndFactoryIdToPeerType={},this._peerFactoriesRegisteredByUs={},this._gw3Subscriptions=[],this._contextSubscriptions={},this._activityTypesInitiatedFromMe={},this._config=i,this._connection=e,this._logger=t,this._contexts=n,this._sessionJoinedPromise=new Promise(function(e){r._sessionJoinedPromiseResolve=e}),this._activityJoinedPromise=new Promise(function(e){r._activityJoinedPromiseResolve=e}),this._config.activityId||this._activityJoinedPromiseResolve({}),this._gw3Session=e.domain("activity",t.subLogger("session:com.tick42.activity"),["joined","initiated","peer-created"])}return GW3Bridge.activityTypeGwMessageEntityToActivityType=function(e,t){var n=function(e){return new a["default"](e,undefined)};return new o["default"](e.name,e.owner_type&&n(e.owner_type),e.helper_types&&e.helper_types.map(n),t)},GW3Bridge.peerFactoryGwMessageEntityToWindowType=function(e){return new a["default"](e.peer_type,function(e){return undefined})},GW3Bridge.activityGwMessageToActivity=function(e,t){var n=e.owner!==undefined?e.owner.peer_id:undefined;return new c["default"](e.activity_id,e.activity_type,t,e.context_snapshot,n)},GW3Bridge.activityToActivityStatusChangeEvent=function(e){return new s.EntityEvent(e,new s.ActivityStatusChangeEventContext(e.status,undefined))},Object.defineProperty(GW3Bridge.prototype,"bridgeType",{get:function(){return"GW3"},enumerable:!0,configurable:!0}),GW3Bridge.prototype.init=function(){var t=this;this.forwardActivityTypeMessagesToStatusEventHandlers(),this.subscribe("created",this.handleActivityCreatedMessage),this.subscribe("destroyed",this.handleActivityDestroyedMessage),this.forwardActivityMessagesToStatusEventHandlers(),this.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers(),this.forwardPeerFactoryMessagesToStatusEventHandlers(),this.forwardPeerFactoryMessagesToPeerFactoryRequests(),this.subscribe("peer-factories-added",this.handlePeerFactoriesAdded),this.subscribe("peer-factories-removed",this.handlePeerFactoriesRemoved),this.forwardActivityWindowMessagesToEventHandlers(),this.subscribe("dispose-peer",function(){if("dispose"===t._config.disposeRequestHandling)return void t.dispose();if("exit"===t._config.disposeRequestHandling){if("undefined"!=typeof window&&"function"==typeof window.close)return void window.close();if(void 0!==e&&"function"==typeof e.exit)return void e.exit()}}),this._gw3Session.onJoined(function(){"trackMyOnly"===t._config.mode||"trackMyTypeAndInitiatedFromMe"===t._config.mode?t._sessionJoinedPromiseResolve(t):t._gw3Session.send({type:"subscribe",activity_types:"trackAll"===t._config.mode?[]:"trackTypes"===t._config.mode?t._config.typesToTrack:[]}).then(function(){t._sessionJoinedPromiseResolve(t)})}),this._gw3Session.join()},GW3Bridge.prototype.dispose=function(){var e=this;this._gw3Subscriptions.forEach(function(t){return t&&e._connection.off(t)}),this._gw3Subscriptions.length=0},GW3Bridge.prototype.ready=function(){return Promise.all([this._sessionJoinedPromise,this._activityJoinedPromise])},GW3Bridge.prototype.initReady=function(){return this._sessionJoinedPromise},GW3Bridge.prototype.onActivityTypeStatusChange=function(e){this._activityTypeStatusChangeCallbacks.push(e)},GW3Bridge.prototype.registerActivityType=function(e,t,n,i,r){var o=this,a={};a.name=e;var c=function(e){return{type:e.type,name:e.name,configuration:e}};return a.owner_type=c(t),a.helper_types=n.map(c),this._gw3Session.send({type:"add-types",types:[a]}).then(function(){var e=GW3Bridge.activityTypeGwMessageEntityToActivityType(a,r);return o.invokeCallbacks(o._activityTypeStatusChangeCallbacks,new s.EntityEvent(e,new s.EntityEventContext(s.EntityEventType.Added)),"add-types"),e})},GW3Bridge.prototype.unregisterActivityType=function(e){var t=this;return this._gw3Session.send({type:"remove-types",types:[e]}).then(function(){var n=new o["default"](e,undefined,undefined,undefined);t.invokeCallbacks(t._activityTypeStatusChangeCallbacks,new s.EntityEvent(n,new s.EntityEventContext(s.EntityEventType.Removed)),"add-types")})},GW3Bridge.prototype.onWindowTypeStatusChange=function(e){this._windowTypeStatusChangeCallbacks.push(e)},GW3Bridge.prototype.registerWindowFactory=function(e,t,n){var i=this;if(this._peerFactoriesRegisteredByUs[e])return Promise.reject(new Error("Factory for windowType "+e+" already registered."));this._peerFactoriesRegisteredByUs[e]=t;var r={id:e,peer_type:e,configuration:n};return this._gw3Session.send({type:"add-peer-factories",factories:[r]}).then(function(){i.invokeCallbacks(i._windowTypeStatusChangeCallbacks,new s.EntityEvent(GW3Bridge.peerFactoryGwMessageEntityToWindowType(r),new s.EntityEventContext(s.EntityEventType.Added)),"add-peer-factories")})["catch"](function(){delete i._peerFactoriesRegisteredByUs[e]})},GW3Bridge.prototype.unregisterWindowFactory=function(e){var t=this;return this._peerFactoriesRegisteredByUs[e]?(delete this._peerFactoriesRegisteredByUs[e],this._gw3Session.send({type:"remove-peer-factories",factory_ids:[e]}).then(function(){t.invokeCallbacks(t._windowTypeStatusChangeCallbacks,new s.EntityEvent(new a["default"](e,undefined),new s.EntityEventContext(s.EntityEventType.Removed)),"add-peer-factories")})):Promise.reject(new Error("Factory for windowType "+e+" not registered."))},GW3Bridge.prototype.onActivityStatusChange=function(e){this._activityChangeCallbacks.push(e)},GW3Bridge.prototype.initiateActivity=function(e,t,n){var i=this,r={type:"create",activity_type:e,initial_context:t};return this.isOverrideTypeDefinition(n)?r.types_override={owner_type:{type:n.owner.type,name:n.owner.name,configuration:n.owner},helper_types:n.helpers&&n.helpers.map(function(e){return{type:e.type,name:e.name,configuration:e}})}:r.configuration=n&&n.map(function(e){return{type:e.type,name:e.name,configuration:e}}),this.sendCreateAndMapResultingMessagesToPromise(r,"initiated",function(e,t){return e.request_id===t},"created",function(e,t,n){return e.activity_id===n.activity_id},"destroyed",function(e,t,n){return e.activity_id===n.activity_id},function(e){return e.activity_id}).then(function(t){return"trackMyTypeAndInitiatedFromMe"!==i._config.mode||i._activityTypesInitiatedFromMe[e]?t:(i._activityTypesInitiatedFromMe[e]=!0,i._gw3Session.send({type:"subscribe",activity_types:[e]}).then(function(){return t}))})},GW3Bridge.prototype.stopActivity=function(e){return this._gw3Session.send({type:"destroy",activity_id:e.id,reason_uri:"com.tick42.glue.activity.constants.destroyReason.general",reason:"Destroying activity"}).then(function(e){return!0})},GW3Bridge.prototype.updateActivityContext=function(e,t,n,i){if(n)return this._contexts.set(e.id,t);i=i||[];for(var r=0,o=i;r<o.length;r++){t[o[r]]=null}return this._contexts.update(e.id,t)},GW3Bridge.prototype.announceWindow=function(e,t){throw new Error("Invalid operation 'announceWindow' for GW3 protocol")},GW3Bridge.prototype.registerWindow=function(e,t,n){var i=this._connection.gatewayToken,r=this._connection.peerId;if("undefined"!=typeof window){var o=window.glue42gd;o&&(i=o.activityInfo!==undefined)}return i&&this._gw3Session.send({type:"ready"}),this.invokeCallbacks(this._activityWindowChangeCallbacks,new s.EntityEvent(new u["default"](r,t,e,undefined,undefined,n,this.generateWindowGetter(r),undefined),new s.EntityEventContext(s.EntityEventType.Added)),"register window"),Promise.resolve(r)},GW3Bridge.prototype.onActivityWindowChange=function(e){this._activityWindowChangeCallbacks.push(e)},GW3Bridge.prototype.createWindow=function(e,t){var n=this;return t.layout||(t.left||t.width||t.height||t.top)&&(t.layout={mode:"pixels",cellSize:1}),this.sendCreateAndMapResultingMessagesToPromise({type:"create-peer",peer_type:t.type,configuration:t,activity_id:e},undefined,undefined,"peer-created",function(e,t){return e.request_id===t},undefined,undefined,function(e){return e.created_id}).then(function(t){return n.joinActivity(e,t).then(function(){return t})})},GW3Bridge.prototype.closeWindow=function(e){return this._gw3Session.send({destroy_peer_id:e}).then(function(e){return undefined})},GW3Bridge.prototype.getAnnouncementInfo=function(){var e=this._config.activityId||this._config.announcementInfo&&this._config.announcementInfo.activityId,t=this._config.announcementInfo&&this._config.announcementInfo.activityWindowType,n=this._config.announcementInfo&&this._config.announcementInfo.activityWindowIndependent,i=this._config.announcementInfo&&this._config.announcementInfo.activityWindowName;if("undefined"!=typeof window&&"undefined"!=typeof window.location&&window.location.search&&"function"==typeof URLSearchParams){var r=new URLSearchParams(location.search.slice(1));t=t||r.get("t42PeerType"),t=t||r.get("t42ActivityWindowType"),void 0===n&&(n=r.get("t42ActivityWindowIndependent")),i=i||r.get("t42ActivityWindowName"),e=e||r.get("t42ActivityId")}return t=t||"unknown",n=n||!1,i=i||this._connection.peerId,{activityWindowId:undefined,activityId:e,activityWindowType:t,activityWindowIndependent:n,activityWindowName:i}},GW3Bridge.prototype.joinActivity=function(e,t){var n=this;return this._gw3Session.send({type:"join-activity",target_id:t,activity_id:e}).then(function(){n.invokeCallbacks(n._activityWindowChangeCallbacks,new s.EntityEvent(new u["default"](t,undefined,undefined,e,undefined,undefined,n.generateWindowGetter(t),undefined),new s.EntityEventContext(s.EntityEventType.ActivityWindowJoinedActivity)),"activity joined - ActivityWindow"),n.invokeCallbacks(n._activityChangeCallbacks,new s.EntityEvent(new c["default"](e,undefined,new d.ActivityStatus("created",undefined,undefined),undefined,undefined),new s.EntityEventContext(s.EntityEventType.Updated)),"activity joined - Activity")})},GW3Bridge.prototype.leaveActivity=function(e,t){var n=this;return this._gw3Session.send({type:"leave-activity",target_id:t,activity_id:e}).then(function(){n.invokeCallbacks(n._activityWindowChangeCallbacks,new s.EntityEvent(new u["default"](t,undefined,undefined,null,undefined,undefined,n.generateWindowGetter(t),undefined),new s.EntityEventContext(s.EntityEventType.ActivityWindowLeftActivity)),"activity left - ActivityWindow"),n.invokeCallbacks(n._activityChangeCallbacks,new s.EntityEvent(new c["default"](e,undefined,new d.ActivityStatus("created",undefined,undefined),undefined,undefined),new s.EntityEventContext(s.EntityEventType.Updated)),"activity left - Activity")})},GW3Bridge.prototype.getActivityTypes=function(){return Promise.resolve([])},GW3Bridge.prototype.getWindowTypes=function(){return Promise.resolve([])},GW3Bridge.prototype.getActivities=function(){return Promise.resolve([])},GW3Bridge.prototype.getActivityWindows=function(){return Promise.resolve([])},GW3Bridge.prototype.createStackedWindows=function(e,t,n){return undefined},GW3Bridge.prototype.getWindowBounds=function(e){return undefined},GW3Bridge.prototype.setWindowBounds=function(e,t){return undefined},GW3Bridge.prototype.activateWindow=function(e,t){return undefined},GW3Bridge.prototype.setWindowVisibility=function(e,t){return undefined},GW3Bridge.prototype.cloneActivity=function(e,t){return undefined},GW3Bridge.prototype.attachActivities=function(e,t,n){return this._gw3Session.send({type:"merge",into:t,merge:e})},GW3Bridge.prototype.detachActivities=function(e,t){return this._gw3Session.send({type:"split",from:e}).then(function(){return""})},GW3Bridge.prototype.onActivitiesAttached=function(e){},GW3Bridge.prototype.onActivitiesDetached=function(e){},GW3Bridge.prototype.onActivityAttachedDescriptorsRefreshed=function(e){},GW3Bridge.prototype.getAttachedDescriptors=function(){return Promise.resolve([])},GW3Bridge.prototype.getRandomRequestId=function(){return this._connection.peerId+":"+Math.floor(1e9*Math.random())},GW3Bridge.prototype.forwardAddedAndRemovedMessagesToEventHandler=function(e,t,n,i){var r,o,a=function(e){return function(t){return new s.EntityEvent(t,new s.EntityEventContext(e?s.EntityEventType.Added:s.EntityEventType.Removed))}};return r=e&&this.forwardMessageToEventHandler(e,function(e){return n(e,!0)},a(!0),i),o=t&&this.forwardMessageToEventHandler(t,function(e){return n(e,!1)},a(!1),i),[r,o].filter(function(e){return e})},GW3Bridge.prototype.forwardMessageToEventHandler=function(e,t,n,i){return this.subscribe(e,function(e){t(e).forEach(function(t){return i.forEach(function(i){return i(n(t,e))})})})},GW3Bridge.prototype.sendCreateAndMapResultingMessagesToPromise=function(e,t,n,i,r,o,a,s){var c,u,d,p,f,l,h=this,y=this.getRandomRequestId(),g=new Promise(function(e,t){c=e,u=t}),v=null,m=function(){h.dropSubscription(d),h.dropSubscription(p),h.dropSubscription(f),h.dropSubscription(l)};d=t&&this.subscribe(t,function(e){n(e,y)&&(v=e,h.dropSubscription(d))}),p=this.subscribe(i,function(e){r(e,y,v)&&c(s(e))}),f=o&&this.subscribe(o,function(e){a(e,y,v)&&u(e)}),l=o&&this.subscribe("error",function(e){e.request_id===y&&u(e)}),e.request_id=y;var b=this._gw3Session.send(e).then(function(){return g});return b.then(m,m),b},GW3Bridge.prototype.peerFactoryIdAndOwnerIdToWindowType=function(e,t){var n=this._peerIdAndFactoryIdToPeerType[t+":"+e];return n?new a["default"](n,undefined):null},GW3Bridge.prototype.subscribe=function(e,t){var n=this,i=this._connection.on("js-activity",e,function(e){return t.bind(n)(e)});return this._gw3Subscriptions.push(i),i},GW3Bridge.prototype.dropSubscription=function(e){e&&(this._connection.off(e),delete this._gw3Subscriptions[this._gw3Subscriptions.indexOf(e)])},GW3Bridge.prototype.invokeCallbacks=function(e,t,n){var i=this;e.forEach(function(e){try{e(t)}catch(e){i._logger.error("Error in "+(n||t.context.type)+" callback: "+JSON.stringify(e))}})},GW3Bridge.prototype.handleActivityCreatedMessage=function(e){e.context_id?this._contextSubscriptions[e.activity_id]||this.subscribeToContext(e):this._logger.error("Activity created with unknown context_id: "+e.activity_id)},GW3Bridge.prototype.subscribeToContext=function(e){return i(this,void 0,void 0,function(){var t,n,i,o=this;return r(this,function(r){switch(r.label){case 0:return t=e.activity_id,n=this._contextSubscriptions,i=t,[4,this._contexts.subscribe(t,function(e,n,i){var r=new s.EntityEvent(new c["default"](t,undefined,undefined,e,undefined),new s.ActivityContextChangedEventContext(e,n,i));o.invokeCallbacks(o._activityChangeCallbacks,r,"context updated")})];case 1:return n[i]=r.sent(),[2]}})})},GW3Bridge.prototype.handleActivityDestroyedMessage=function(e){var t=this._contextSubscriptions[e.activity_id];"function"==typeof t&&t(),delete this._contextSubscriptions[e.activity_id]},GW3Bridge.prototype.handlePeerFactoriesAdded=function(e){var t=this;e.factories.forEach(function(n){t._peerIdAndFactoryIdToPeerType[e.owner_id+":"+n.id]=n.peer_type})},GW3Bridge.prototype.handlePeerFactoriesRemoved=function(e){var t=this;e.factory_ids.forEach(function(n){delete t._peerIdAndFactoryIdToPeerType[e.owner_id+":"+n]})},GW3Bridge.prototype.forwardActivityTypeMessagesToStatusEventHandlers=function(){this.forwardAddedAndRemovedMessagesToEventHandler("types-added","types-removed",function(e,t){return t?e.types.map(function(e){return GW3Bridge.activityTypeGwMessageEntityToActivityType(e,undefined)}):e.types.map(function(e){return new o["default"](e.name,undefined,undefined,undefined)})},this._activityTypeStatusChangeCallbacks)},GW3Bridge.prototype.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers=function(){for(var e=this,t=0,n=["created","joined"];t<n.length;t++){var i=n[t];this.forwardMessageToEventHandler(i,function(t){return[t.owner].concat(t.participants||[]).map(function(n){return new u["default"](n.peer_id,n.name,n.type,t.activity_id,undefined,undefined,e.generateWindowGetter(n.peer_id),undefined)})},function(e,t){return new s.EntityEvent(e,new s.EntityEventContext(s.EntityEventType.ActivityWindowJoinedActivity))},this._activityWindowChangeCallbacks)}},GW3Bridge.prototype.forwardActivityMessagesToStatusEventHandlers=function(){for(var e=0,t=["created","joined"];e<t.length;e++){var n=t[e];this.forwardMessageToEventHandler(n,function(e){return[GW3Bridge.activityGwMessageToActivity(e,new d.ActivityStatus("started","",new Date))]},function(e,t){return GW3Bridge.activityToActivityStatusChangeEvent(e)},this._activityChangeCallbacks)}this.forwardMessageToEventHandler("destroyed",function(e){return[GW3Bridge.activityGwMessageToActivity(e,new d.ActivityStatus("destroyed",e.reason,new Date))]},function(e,t){return GW3Bridge.activityToActivityStatusChangeEvent(e)},this._activityChangeCallbacks),this.forwardMessageToEventHandler("initiated",function(e){return[GW3Bridge.activityGwMessageToActivity(e,new d.ActivityStatus("created","",new Date))]},function(e,t){return GW3Bridge.activityToActivityStatusChangeEvent(e)},this._activityChangeCallbacks)},GW3Bridge.prototype.forwardPeerFactoryMessagesToStatusEventHandlers=function(){var e=this;this.forwardAddedAndRemovedMessagesToEventHandler("peer-factories-added","peer-factories-removed",function(t,n){return n?t.factories.map(GW3Bridge.peerFactoryGwMessageEntityToWindowType):t.factory_ids.map(function(n){return e.peerFactoryIdAndOwnerIdToWindowType(n,t.owner_id)}).filter(function(e){return null!=e})},this._windowTypeStatusChangeCallbacks)},GW3Bridge.prototype.forwardPeerFactoryMessagesToPeerFactoryRequests=function(){var e=this;this.subscribe("peer-requested",function(t){var n=e._peerFactoriesRegisteredByUs[t.peer_factory];if(!n)return void e._gw3Session.send({type:"error",request_id:t.request_id,reason:"Unknown peer factory "+t.peer_factory});try{var i=t.configuration||{};i.gateway_token=i.gateway_token||t.gateway_token,i.peer_factory=i.peer_factory||t.peer_factory;var r=n.create({activityId:t.activity.id,type:t.activity.type,gwToken:i.gateway_token,configuration:i});r&&r.then&&r["catch"]&&r["catch"](function(n){return e._gw3Session.send({type:"error",request_id:t.request_id,reason:n&&(n.message||JSON.stringify(n))})})}catch(n){e._gw3Session.send({type:"error",request_id:t.request_id,reason:n&&(n.message||JSON.stringify(n))})}})},GW3Bridge.prototype.forwardActivityWindowMessagesToEventHandlers=function(){for(var e=this,t=this,n=0,i=["activity-joined","joined"];n<i.length;n++){var r=i[n];!function(n){t.subscribe(n,function(t){var i="activity-joined"===n?t.joined_id:t.peer_id,r="activity-joined"===n?t.joined_type:t.peer_type,o="activity-joined"===n?t.joined_name:t.peer_name,a=new u["default"](i,o,r,t.activity_id,undefined,undefined,e.generateWindowGetter(i),undefined);e._contextSubscriptions[t.activity_id]?"joined"===n&&e._activityJoinedPromiseResolve({}):e.subscribeToContext(t).then(function(){"joined"===n&&e._activityJoinedPromiseResolve({})}),e.invokeCallbacks(e._activityWindowChangeCallbacks,new s.EntityEvent(a,new s.EntityEventContext(s.EntityEventType.ActivityWindowJoinedActivity)),n)})}(r)}this.subscribe("left",function(t){var n=new u["default"](t.left_id,undefined,undefined,null,undefined,undefined,e.generateWindowGetter(t.left_id),undefined);e.invokeCallbacks(e._activityWindowChangeCallbacks,new s.EntityEvent(n,new s.EntityEventContext(s.EntityEventType.ActivityWindowLeftActivity)),"left")}),this.forwardAddedAndRemovedMessagesToEventHandler("peer-created",undefined,function(t){return[new u["default"](t.created_id,undefined,undefined,undefined,undefined,undefined,e.generateWindowGetter(t.created_id),undefined)]},this._activityWindowChangeCallbacks)},GW3Bridge.prototype.generateWindowGetter=function(e){var t=this;return function(){var n=t._config.agm.servers().filter(function(t){return t.peerId===e})[0];if(n){var i=n.windowId;return t._config.windows.list().filter(function(e){return e.id===i})[0]}}},GW3Bridge.prototype.isOverrideTypeDefinition=function(e){return void 0!==e&&!!e.owner},GW3Bridge}();t["default"]=p}).call(t,n(27))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(10),o=n(8),a=n(17),s=n(47),c=n(4),u=n(1),d=n(45),p=n(2),f=n(12),l=function(){function ActivityManager(e,t,n){var i=this;this._logger=c.Logger.Get("activityManager"),this._announcedWindows=[],this._attachedCallbacks=[],this._detachedCallbacks=[],this._frameColorChangesCallbacks=[],this._windowHandlers=[],this._bridge=e,this._activityTypes=new s.EntityObservableCollection(function(e){return i._grabEntity(e)}),this._windowTypes=new s.EntityObservableCollection(function(e){return i._grabEntity(e)}),this._activities=new s.EntityObservableCollection(function(e){return i._grabEntity(e)}),this._windows=new s.EntityObservableCollection(function(e){return i._grabEntity(e)}),this._dataReadyMarker=new a.ReadyMarker("Activity Manager Data",["GetActivityTypes","GetWindowTypes","GetActivities","GetWindows"].length),this._descriptorsMarker=new a.ReadyMarker("Attached Activities Descriptors",["GetDescriptors"].length),t?(this._readyMarker=new a.ReadyMarker("Activity Manager Announce",["Announcement"].length),this._dataReadyMarker.setCallback(function(e){e&&i._readyMarker.error(e),i._descriptorsMarker.setCallback(function(e){e&&i._readyMarker.error(e),i._logger.debug("Auto announcing window"),i.announceWindow().then(function(e){i._announcedWindows.push(e),i._readyMarker.signal("Successfully announced window with id '"+e.id+"'")})["catch"](function(e){i._logger.debug("Will not announce window - "+e),i._readyMarker.signal()})}),i.refreshDescriptors()})):this._readyMarker=this._dataReadyMarker,this._bridge.onActivitiesAttached(function(e){i._handleActivitiesAttached(e)}),this._bridge.onActivitiesDetached(function(e){i._handleActivitiesDetached(e)}),this._bridge.onActivityAttachedDescriptorsRefreshed(function(e){i._handleActivityDescriptorsRefreshed(e)}),n&&n.onWindowFrameColorChanged(this._handleWindowFrameColorChanged.bind(this)),this._bridge.init(),this._subscribeForData(),this._bridge.initReady().then(function(e){i._getInitialData()})["catch"](function(e){console.log(e)})}return Object.defineProperty(ActivityManager.prototype,"usingHc",{get:function(){return"HC"===this._bridge.bridgeType},enumerable:!0,configurable:!0}),Object.defineProperty(ActivityManager.prototype,"announcedWindows",{get:function(){return this._announcedWindows},set:function(e){throw new Error("not allowed")},enumerable:!0,configurable:!0}),ActivityManager.prototype.ready=function(e){var t=this,n=new Promise(function(e,n){t._readyMarker.setCallback(function(i){i?n(t._readyMarker.getError()):e(t)})});return o.nodeify(Promise.all([this._bridge.ready(),n]).then(function(){return t}),e)},ActivityManager.prototype.getActivityTypes=function(){return this._activityTypes.get()},ActivityManager.prototype.getActivityType=function(e){return this._activityTypes.getByName(e)},ActivityManager.prototype.registerActivityType=function(e,t,n,i,r,a){var s=this,c=new Promise(function(o,a){if(u.isUndefinedOrNull(e))return void a("activityTypeName argument can not be undefined");if(!u.isString(e))return void a("activityTypeName should be string");var c=s.getActivityType(e);if(!u.isUndefinedOrNull(c))return void a("Activity type '"+e+"' already exists");var d;if(u.isUndefined(t))return void a("Owner window type can not be undefined");d=u.isString(t)?{type:t,name:"",isIndependent:!1,arguments:{}}:t;var p=[];if(!u.isUndefined(n)&&u.isArray(n))for(var f in n){var l=n[f];if(u.isString(l)){var h={type:l,name:"",isIndependent:!1,arguments:{},relativeTo:"",relativeDirection:"",windowStyleAttributes:{}};p.push(h)}else p.push(l)}s._bridge.registerActivityType(e,d,p,i,r).then(function(e){s._grabEntity(e),o(e)})["catch"](function(e){a(e)})});return o.nodeify(c,a)},ActivityManager.prototype.unregisterActivityType=function(e,t){var n=this,i=new Promise(function(t,i){var r=n.getActivityType(e);if(u.isUndefined(r))return void i("Activity type '"+e+"' does not exists");n._bridge.unregisterActivityType(e).then(function(){return t(r)},i)});return o.nodeify(i,t)},ActivityManager.prototype.initiate=function(e,t,n,i){var r=this,a=new Promise(function(n,o){var a=r.getActivityType(e);if(u.isUndefined(a))return void o("Activity type '"+e+"' does not exists");r._bridge.initiateActivity(e,t,i).then(function(e){r._activities.getOrWait(e).then(function(e){n(e)})["catch"](function(e){return o(e)})})["catch"](function(e){o(e)})});return o.nodeify(a,n)},ActivityManager.prototype.subscribeActivityTypeEvents=function(e){this._activityTypes.subscribe(function(t,n){e(t,n.type)})},ActivityManager.prototype.getWindowTypes=function(){return this._windowTypes.get()},ActivityManager.prototype.getWindowType=function(e){return this._windowTypes.getByName(e)},ActivityManager.prototype.registerWindowFactory=function(e,t,n){var i=this,r=new Promise(function(n,r){if(u.isUndefinedOrNull(e))return void r("no windowType specified");if(u.isObject(e))e=e.getName();else if(!u.isString(e))return void r("windowType should be string or object that has getName method");var o=new d.LocalWindowFactory(t);i._bridge.registerWindowFactory(e,o).then(function(e){n(e)})["catch"](function(e){r(e)})});return o.nodeify(r,n)},ActivityManager.prototype.unregisterWindowFactory=function(e,t){var n=this,i=new Promise(function(t,i){return u.isUndefinedOrNull(e)?void i("no windowType specified"):u.isString(e)?void n._bridge.unregisterWindowFactory(e).then(function(e){t(e)})["catch"](function(e){i(e)}):void i("windowType should be a string")});return o.nodeify(i,t)},ActivityManager.prototype.getActivities=function(e){var t=this._activities.get();if(!e)return t;var n=e;if(u.isString(e))n=[e];else if(e instanceof r["default"])n=[e.name];else if(!(e instanceof Array))throw new Error("Invalid input argument 'activityType' = "+e);return t.filter(function(e){var t=e.type;return u.some(n,function(e){return t.id===e.id})})},ActivityManager.prototype.getActivityById=function(e){return this._activities.getByName(e)},ActivityManager.prototype.announceWindow=function(e,t){var n=this;return new Promise(function(r,o){var a=n._bridge.getAnnouncementInfo();if(u.isUndefined(e)&&(e=a.activityWindowId),u.isUndefined(t)&&(t=a.activityWindowType),u.isUndefinedOrNull(t))throw new Error("Can not announce - unknown windowType");var s=a&&a.activityId;if(u.isUndefinedOrNull(e))n._logger.debug("Registering window with type:'"+t+"', name:'"+a.activityWindowName+"', ind.:'"+a.activityWindowIndependent+"'"),n._bridge.registerWindow(t,a.activityWindowName,a.activityWindowIndependent).then(n._windows.getOrWait.bind(n._windows)).then(function(e){return s?n._activities.getOrWait(s).then(function(t){return e}):e}).then(function(e){r(e)})["catch"](function(e){n._logger.error(e)});else{n._logger.debug("Announcing window with id '"+e+"' and type '"+t+"'");var c=n._windows.getByName(e);if(!u.isUndefinedOrNull(c))return n._logger.debug("Window with id '"+e+"' already announced - reusing the window"),void r(c);var d=function(t,a,s){if(e===a.id&&s===i.EntityEventType.ActivityWindowJoinedActivity){var c=a.activity;u.isUndefined(c)&&o("UNDEFINED ACTIVITY"),n._logger.trace("Got joined event for id '"+e+"'"),r(a),n.unsubscribeWindowEvents(d)}};n.subscribeWindowEvents(d),n._logger.trace("Waiting for joined event for id '"+e+"'"),n._bridge.announceWindow(t,e)}})},ActivityManager.prototype.subscribeWindowTypeEvents=function(e){this._windowTypes.subscribe(function(t,n){e(t,n.type)})},ActivityManager.prototype.subscribeActivityEvents=function(e){var t=this;return this._activities.subscribe(function(n,r){if(r.type===i.EntityEventType.StatusChange){var o=r;e(n,o.newStatus,o.oldStatus)}if(r.type===i.EntityEventType.Removed||r.type===i.EntityEventType.StatusChange&&r.newStatus.getState()===p.ActivityState.Destroyed)for(var a=0,s=t._windows.get();a<s.length;a++){var c=s[a];c.activity&&c.activity.id===n.id&&t._windows.process(new i.EntityEvent(c,new i.EntityEventContext(i.EntityEventType.ActivityWindowLeftActivity)))}})},ActivityManager.prototype.subscribeWindowEvents=function(e){var t=function(t,n){var r=n.type;r===i.EntityEventType.Added&&(r="opened"),e(t.activity,t,r)};return this._windowHandlers.push([e,t]),this._windows.subscribe(t)},ActivityManager.prototype.unsubscribeWindowEvents=function(e){var t=this._windowHandlers.find(function(t){return t[0]===e});t&&(this._windowHandlers.splice(this._windowHandlers.indexOf(t),1),this._windows.unsubscribe(t[1]))},ActivityManager.prototype.createWindow=function(e,t,n){var i=this,r=new Promise(function(n,r){u.isUndefinedOrNull(t)&&r("windowType is undefined");var o;o=u.isString(t)?{type:t,name:"",isIndependent:!1,arguments:{}}:t;var a;if(!u.isUndefinedOrNull(o.relativeTo))if("string"==typeof(a=o.relativeTo)){var s=i.getWindows({type:a});!u.isUndefinedOrNull(s)&&s.length>0&&(o.relativeTo=s[0].id)}else if(u.isUndefinedOrNull(a.type))u.isUndefinedOrNull(a.windowId)||(o.relativeTo=a.windowId);else{var s=i.getWindows({type:a.type});!u.isUndefinedOrNull(s)&&s.length>0&&(o.relativeTo=s[0].id)}i._bridge.createWindow(e&&e.id,o).then(function(t){i._logger.debug("Window created, waiting for window entity with id "+t);var r=function(o,a){o.id!==t||e&&!o.activity||(i._logger.debug("Got entity window with id "+t),n(o),i._windows.unsubscribe(r))};i._windows.subscribe(r)})["catch"](function(e){r(e)})});return o.nodeify(r,n)},ActivityManager.prototype.createStackedWindows=function(e,t,n,i){var r=this,a=new Promise(function(i,o){u.isUndefinedOrNull(e)&&o("activity is undefined"),u.isUndefinedOrNull(t)&&o("relativeWindowTypes is undefined"),Array.isArray(t)||o("relativeWindowTypes has to be array"),u.isUndefinedOrNull(n)&&(n=2e4);var a=[];t.forEach(function(e){var t;t=u.isString(e)?{type:e,name:"",isIndependent:!1,arguments:{}}:e;var n;if(!u.isUndefinedOrNull(t.relativeTo))if(n=t.relativeTo,u.isUndefinedOrNull(n.type)){if(!u.isUndefinedOrNull(n.windowId)){var i=r.getWindows({id:n.windowId});!u.isUndefinedOrNull(i)&&i.length>0&&(t.relativeTo=i[0].type.name,t.useExisting=!0)}}else t.relativeTo=n.type;a.push(t)}),r._bridge.createStackedWindows(e.id,a,n).then(function(e){var t=[],n=[],o=function(r,a){e.indexOf(r.id)>=0&&n.indexOf(r.id)<0&&r.activity&&(this._logger.debug("Got entity window with id "+e),t.push(r),n.push(r.id),t.length===e.length&&(i(t),this._windows.unsubscribe(o)))}.bind(r);r._windows.subscribe(o)})["catch"](function(e){o(e)})});return o.nodeify(a,i)},ActivityManager.prototype.addWindowToActivity=function(e,t,n){var i=this._bridge.joinActivity(e.id,t.id).then(function(){return t});return o.nodeify(i,n),i},ActivityManager.prototype.leaveWindowFromActivity=function(e,t,n){var i=this._bridge.leaveActivity(e.id,t.id).then(function(){return t});return o.nodeify(i,n),i},ActivityManager.prototype.setActivityContext=function(e,t,n){var i=this,r=new Promise(function(n,r){u.isUndefinedOrNull(e)&&r("activity can not be null"),i._bridge.updateActivityContext(e,t,!0).then(function(t){n(e)})["catch"](function(e){r(e)})});return o.nodeify(r,n)},ActivityManager.prototype.updateActivityContext=function(e,t,n){var i=this,r=new Promise(function(n,r){u.isUndefinedOrNull(e)&&r("activity can not be null");var o=[];for(var a in t)t.hasOwnProperty(a)&&null===t[a]&&o.push(a);for(var s=0,c=o;s<c.length;s++){var d=c[s];delete t[d]}i._bridge.updateActivityContext(e,t,!1,o).then(function(t){n(e)})["catch"](function(e){r(e)})});return o.nodeify(r,n)},ActivityManager.prototype.subscribeActivityContextChanged=function(e){this._activities.subscribe(function(t,n){if(n.type===i.EntityEventType.ActivityContextChange){var r=n;e(t,r.context,r.updated,r.removed)}})},ActivityManager.prototype.stopActivity=function(e,t){var n=this._bridge.stopActivity(e);return o.nodeify(n,t)},ActivityManager.prototype.getWindows=function(e){return u.isUndefined(e)?this._windows.get():u.isUndefined(e.id)?this._windows.get().filter(function(t){if(!u.isUndefined(e.type)&&t.type.id!==e.type)return!1;if(!u.isUndefined(e.name)&&t.name!==e.name)return!1;if(!u.isUndefined(e.activityId)){if(u.isUndefinedOrNull(t.activity))return!1;if(t.activity.id!==e.activityId)return!1}return!0}):[this._windows.getByName(e.id)]},ActivityManager.prototype.getWindowBounds=function(e){return this._bridge.getWindowBounds(e)},ActivityManager.prototype.setWindowBounds=function(e,t,n){var i=this,r=new Promise(function(n,r){i._bridge.setWindowBounds(e,t).then(function(){return n()})["catch"](function(e){return r(e)})});return o.nodeify(r,n)},ActivityManager.prototype.closeWindow=function(e){return this._bridge.closeWindow(e)},ActivityManager.prototype.activateWindow=function(e,t){return this._bridge.activateWindow(e,t)},ActivityManager.prototype.setWindowVisibility=function(e,t){return this._bridge.setWindowVisibility(e,t)},ActivityManager.prototype.clone=function(e,t,n){var i=this,r=new Promise(function(n,r){e||r("activity can not be null"),i._bridge.cloneActivity(e.id,t).then(function(e){i._activities.getOrWait(e).then(function(e){n(e)})["catch"](function(e){return r(e)})})["catch"](function(e){return r(e)})});return o.nodeify(r,n)},ActivityManager.prototype.attachActivities=function(e,t,n,i){var r=this;n=n||{};var a=new Promise(function(i,o){return r._activities.getByName(e)?r._activities.getByName(t)?r._bridge.attachActivities(e,t,n).then(function(e){var t=e.to,n=e.descriptor,o=e.descriptors;r._activities.getOrWait(t).then(function(e){e._updateDescriptors(o);var t=e.attached.filter(function(e){return e.ownerId===n.ownerId})[0];i(t)})})["catch"](function(e){o(e)}):void o("can not find activity with id "+t):void o("can not find activity with id "+e)});return o.nodeify(a,i)},ActivityManager.prototype.detachActivities=function(e,t,n){var i=this,r=new Promise(function(n,r){return i._bridge.detachActivities(e,t).then(function(){var e=undefined,t=undefined,o=undefined;i._activities.getOrWait(e).then(function(e){e._updateDescriptors(o),i._activities.getOrWait(t).then(function(e){n(e)})})["catch"](function(e){return r(e)})})["catch"](function(e){r(e)})});return o.nodeify(r,n)},ActivityManager.prototype.subscribeActivitiesAttached=function(e){this._attachedCallbacks.push(e)},ActivityManager.prototype.subscribeActivitiesDetached=function(e){this._detachedCallbacks.push(e)},ActivityManager.prototype.subscribeActivityFrameColorChanged=function(e){this._frameColorChangesCallbacks.push(e)},ActivityManager.prototype._grabEntity=function(e){e._manager=this},ActivityManager.prototype._getInitialData=function(){var e=this;this._logger.debug("Request initial data..."),this._bridge.getActivityTypes().then(function(t){e._activityTypes.add(t),e._dataReadyMarker.signal("Got act types")})["catch"](function(t){e._logger.error(t),e._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity types -"+t)}),this._bridge.getWindowTypes().then(function(t){e._windowTypes.add(t),e._dataReadyMarker.signal("Got window types")})["catch"](function(t){e._logger.error(t),e._dataReadyMarker.error("Can not initialize ActivityManager - error getting window types  "+t)}),this._bridge.getActivities().then(function(t){e._activities.add(t),e._dataReadyMarker.signal("Got activities")})["catch"](function(t){e._logger.error(t),e._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity instances -"+t)}),this._bridge.getActivityWindows().then(function(t){e._windows.add(t),e._dataReadyMarker.signal("Got windows")})["catch"](function(t){e._logger.error(t),e._dataReadyMarker.error("Can not initialize ActivityManager - error getting activity windows -"+t)})},ActivityManager.prototype._subscribeForData=function(){var e=this;this._logger.debug("Subscribe for data..."),this._bridge.onActivityTypeStatusChange(function(t){e._activityTypes.process(t)}),this._bridge.onWindowTypeStatusChange(function(t){e._windowTypes.process(t)}),this._bridge.onActivityStatusChange(function(t){var n=e._activities.process(t);t.context.type===i.EntityEventType.ActivityWindowJoinedActivity&&n&&n.context&&e._bridge instanceof f["default"]&&e._activities.process(new i.EntityEvent(n,new i.ActivityContextChangedEventContext(n.context,n.context,[])))}),this._bridge.onActivityWindowChange(function(t){e._windows.process(t)})},ActivityManager.prototype._handleActivitiesAttached=function(e){var t=this,n=e.to,i=e.descriptor,r=e.descriptors;this._activities.getOrWait(n).then(function(e){e._updateDescriptors(r);var n=e.attached.filter(function(e){return e.ownerId===i.ownerId})[0];t._attachedCallbacks.forEach(function(t){try{t(e,n)}catch(e){return}})})},ActivityManager.prototype._handleActivitiesDetached=function(e){var t=this,n=e.oldActivityId,i=e.newActivityId,r=e.descriptors,o=e.descriptor;this._activities.getOrWait(n).then(function(e){e._updateDescriptors(r),t._activities.getOrWait(i).then(function(n){t._detachedCallbacks.forEach(function(t){try{t(n,e,o)}catch(e){return}})})})},ActivityManager.prototype._handleActivityDescriptorsRefreshed=function(e){var t=e.id,n=e.descriptors,i=this._activities.getByName(t);i&&i._updateDescriptors(n)},ActivityManager.prototype.refreshDescriptors=function(){var e=this;this._bridge.getAttachedDescriptors().then(function(t){t&&Object.keys(t).forEach(function(n){var i=n,r=t[n],o=e._activities.getByName(i);o&&o._updateDescriptors(r)}),e._descriptorsMarker.signal("Successfully got descriptors")})["catch"](function(t){e._descriptorsMarker.error("failed to get descriptors - "+t)})},ActivityManager.prototype._handleWindowFrameColorChanged=function(e){if(e.activityId){var t=this._activities.getByName(e.activityId);t&&t.owner&&t.owner.underlyingWindow.id===e.id&&this._frameColorChangesCallbacks.forEach(function(n){try{n(t,e.frameColor)}catch(e){return}})}},ActivityManager}();t["default"]=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function LocalWindowFactory(e){this.createFunction=e,this.createFunction=e}return LocalWindowFactory.prototype.create=function(e){return this.createFunction(e)},LocalWindowFactory}();t.LocalWindowFactory=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function AttachedActivityDescriptor(e,t,n){this._manager=e,this._ownerActivityId=t,this._state=n}return Object.defineProperty(AttachedActivityDescriptor.prototype,"ownerId",{get:function(){return this._state.ownerId},enumerable:!0,configurable:!0}),Object.defineProperty(AttachedActivityDescriptor.prototype,"windowIds",{get:function(){return this._state.windowIds},enumerable:!0,configurable:!0}),Object.defineProperty(AttachedActivityDescriptor.prototype,"frameColor",{get:function(){return this._state.frameColor},enumerable:!0,configurable:!0}),Object.defineProperty(AttachedActivityDescriptor.prototype,"context",{get:function(){return this._state.context},enumerable:!0,configurable:!0}),Object.defineProperty(AttachedActivityDescriptor.prototype,"tag",{get:function(){return this._state.tag},enumerable:!0,configurable:!0}),AttachedActivityDescriptor.prototype.detach=function(e){var t=this;e=e||{};var n={};return Object.keys(this._state).forEach(function(e){n[e]=t._state[e]}),n.context=e.context||n.context,n.frameColor=e.frameColor||n.frameColor,this._manager.detachActivities(this._ownerActivityId,n)},AttachedActivityDescriptor}();t.AttachedActivityDescriptor=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=n(2),o=function(){function EntityObservableCollection(e){this._items={},this._listeners=[],this._processNew=e}return EntityObservableCollection.prototype.addOne=function(e){this.add([e])},EntityObservableCollection.prototype.add=function(e){var t=this;e.forEach(function(e){t.process(new i.EntityEvent(e,new i.EntityEventContext(i.EntityEventType.Added)))})},EntityObservableCollection.prototype.process=function(e){var t=e.context,n=t.type,r=e.entity;if(n===i.EntityEventType.StatusChange&&!t.oldStatus){var o=this._items[r.id];o&&(t.oldStatus=o.status)}n===i.EntityEventType.StatusChange&&t.oldStatus&&t.newStatus&&t.oldStatus.state===t.newStatus.state&&(t.type=i.EntityEventType.Updated),"undefined"==typeof htmlContainer&&(n===i.EntityEventType.ActivityWindowJoinedActivity&&this._items[r.id]&&this._items[r.id].activity&&(t.type=i.EntityEventType.Updated),n===i.EntityEventType.ActivityWindowLeftActivity&&this._items[r.id]&&!this._items[r.id].activity&&(t.type=i.EntityEventType.Updated));var a=this._updateInternalCollections(r,n,t);return this._notifyListeners(a,t),a},EntityObservableCollection.prototype.get=function(){var e=[];for(var t in this._items)if(this._items.hasOwnProperty(t)){var n=this._items[t];e.push(n)}return e},EntityObservableCollection.prototype.getByName=function(e){for(var t in this._items)if(t===e)return this._items[t];return undefined},EntityObservableCollection.prototype.getOrWait=function(e){var t=this;return new Promise(function(n){var i=function(r){r.id===e&&(n(r),t.unsubscribe(i))};t.subscribe(i);var r=t.getByName(e);if(r)return t.unsubscribe(i),void n(r)})},EntityObservableCollection.prototype.subscribe=function(e){var t=this;return this._listeners.push(e),Object.keys(this._items).forEach(function(n){var r=t._items[n];e(r,new i.EntityEventContext(i.EntityEventType.Added.toString()))}),function(){t.unsubscribe(e)}},EntityObservableCollection.prototype.unsubscribe=function(e){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)},EntityObservableCollection.prototype._notifyListeners=function(e,t){this._listeners.forEach(function(n){try{n(e,t)}catch(e){return}})},EntityObservableCollection.prototype._updateInternalCollections=function(e,t,n){var o=e,a=t===i.EntityEventType.StatusChange&&o.status&&o.status.state===r.ActivityState.Destroyed||t===i.EntityEventType.StatusChange&&n&&n.newStatus&&n.newStatus.state===r.ActivityState.Destroyed,s=t===i.EntityEventType.Closed;if(t===i.EntityEventType.Removed&&"undefined"==typeof o.isIndependent||s||a){var c=this._items[e.id];return delete this._items[e.id],this._processNew(e),c&&e._beforeDelete(c),e}var u=e.id;return this._items.hasOwnProperty(u)?this._items[e.id]._update(e):(this._processNew(e),this._items[e.id]=e),this._items[e.id]},EntityObservableCollection}();t.EntityObservableCollection=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(42);t.ActivityModule=i.ActivityModule},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(50),r=n(0),o=n(54),a=function(){function AppManagerImpl(e,t,n,a,s){var c=this;this._agm=e,this._activities=t,this._windows=n,this._logger=a,this._gdMajorVersion=s,this._apps={},this._instances=[],this._registry=r["default"](),this.application=function(e){return c._apps[e]},this.applications=function(){return Object.keys(c._apps).map(function(e){return c._apps[e]})},this.instances=function(){return c._instances},this.getMyInstance=function(){if(c._gdMajorVersion>=3){var e=window.glue42gd.appInstanceId;return c._instances.filter(function(t){return t.id===e})[0]}if(2===c._gdMajorVersion){var t=window.htmlContainer.windowId,n=c._instances.filter(function(e){return e.id===t});return n.length<2?n[0]:n.filter(function(e){return!e.isActivityInstance})[0]}return undefined},this.handleAppAdded=function(e){var t=c._getAppId(e);c._logger.trace("adding app "+t),c._apps[t]=new i["default"](c,t,c._agm);var n=c._updateAppFromProps(e);c._registry.execute("appAdded",n)},this.handleAppUpdated=function(e){var t=c._updateAppFromProps(e);c._registry.execute("appChanged",t)},this.handleAppRemoved=function(e){var t=c._getAppId(e);c._logger.trace("removing app "+t);var n=c.application(t);c._instances=c._instances.filter(function(e){return e.application.name!==n.name}),delete c._apps[t],c._registry.execute("appRemoved",n)},this.handleAppReady=function(e){var t=c._getAppId(e),n=c._getAppOrThrow(t);n.updateFromProps(e),n.available?c._registry.execute("appAvailable",n):c._registry.execute("appUnavailable",n)},this.handleInstanceStarted=function(e){c._logger.trace("started app "+e.Name+" "+e.Id);var t=c._getInstanceId(e),n=c.application(c._getInstanceAppName(e)),i=new o["default"](t,n,c,c._agm,c._activities,c._windows);c._updateInstanceFromProps(i,e),c._instances.push(i),c._registry.execute("instanceStarted",i)},this.handleInstanceStopped=function(e){c._logger.trace("failed to start app "+e.Name+" "+e.Id);var t=c._getInstanceId(e),n=c._getInstanceAppName(e),i=c._getInstanceOrThrow(t,n);c._instances=c._instances.filter(function(e){return!c._matchInstance(e,t,n)}),c._registry.execute("instanceStopped",i),i.done()},this.handleInstanceAgmServerReady=function(e){var t=c._getInstanceId(e),n=c._getInstanceAppName(e),i=c._getInstanceOrThrow(t,n);i.updateAgmInstanceFromProps(e),c._registry.execute("instanceAgmServerReady",i)},this.handleInstanceStartFailed=function(e){var t=c._getInstanceId(e),n=c.application(c._getInstanceAppName(e)),i=new o["default"](t,n,undefined,undefined,undefined,undefined,!0);c._updateInstanceFromProps(i,e),c._registry.execute("instanceStartFailed",i)},this.handleInstanceUpdated=function(e){var t=c._getInstanceId(e),n=c._getInstanceAppName(e),i=c._getInstanceOrThrow(t,n);c._updateInstanceFromProps(i,e)},this.onInstanceStarted=function(e){return c._replay(c._instances,e),c._registry.add("instanceStarted",e)},this.onInstanceStartFailed=function(e){return c._registry.add("instanceStartFailed",e)},this.onInstanceStopped=function(e){return c._registry.add("instanceStopped",e)},this.onInstanceUpdated=function(e){return c._registry.add("instanceChanged",e)},this.onInstanceAgmServerReady=function(e){return c._registry.add("instanceAgmServerReady",e)},this.onAppAdded=function(e){return c._replay(c._apps,e),c._registry.add("appAdded",e)},this.onAppRemoved=function(e){return c._registry.add("appRemoved",e)},this.onAppAvailable=function(e){return c._registry.add("appAvailable",e)},this.onAppUnavailable=function(e){return c._registry.add("appUnavailable",e)},this.onAppChanged=function(e){return c._registry.add("appChanged",e)}}return AppManagerImpl.prototype._getAppOrThrow=function(e){var t=this.application(e);if(!t)throw Error("app with id "+e+" not found");return t},AppManagerImpl.prototype._getAppId=function(e){return e.Name},AppManagerImpl.prototype._matchInstance=function(e,t,n){return e.id===t&&e.application.name===n},AppManagerImpl.prototype._getInstanceByIdAndName=function(e,t){var n=this;return this._instances.filter(function(i){return n._matchInstance(i,e,t)})[0]},AppManagerImpl.prototype._getInstanceOrThrow=function(e,t){var n=this._getInstanceByIdAndName(e,t);if(!n)throw Error("instance with id "+e+" not found");return n},AppManagerImpl.prototype._getInstanceId=function(e){return e.Id},AppManagerImpl.prototype._getInstanceAppName=function(e){return e.Name},AppManagerImpl.prototype._updateAppFromProps=function(e){var t=this._getAppId(e);this._logger.trace("updating app with  + "+t+", "+e);var n=this._getAppOrThrow(t);return n.updateFromProps(e),n},AppManagerImpl.prototype._updateInstanceFromProps=function(e,t){this._logger.trace("updating instance with "+this._getInstanceId(t)+" for app "+this._getInstanceAppName(t)),e.updateFromProps(t)},AppManagerImpl.prototype._replay=function(e,t){if(e)if(Array.isArray(e))e.forEach(function(e){return t(e)});else{var n=Object.keys(e).map(function(t){return e[t]});n.forEach(function(e){return t(e)})}},AppManagerImpl}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(0),o=n(11),a=function(){function ApplicationImpl(e,t,n){var i=this;this._appManager=e,this._name=t,this._agm=n,this._registry=r["default"](),e.onInstanceStarted(function(e){e.application.name===i._name&&i._registry.execute("instanceStarted",e)}),e.onInstanceStopped(function(e){e.application.name===i._name&&i._registry.execute("instanceStopped",e)}),e.onAppRemoved(function(e){e.name===i._name&&i._registry.execute("appRemoved",e)}),e.onAppChanged(function(e){e.name===i._name&&i._registry.execute("appChanged",e)}),e.onAppAvailable(function(e){e.name===i._name&&i._registry.execute("appAvailable",e)}),e.onAppUnavailable(function(e){e.name===i._name&&i._registry.execute("appUnavailable",e)})}return Object.defineProperty(ApplicationImpl.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"title",{get:function(){return this._props.Title},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"version",{get:function(){return this._props.Version},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"autoStart",{get:function(){return this._props.AutoStart},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"isShell",{get:function(){return this._props.IsShell},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"caption",{get:function(){return this._props.Caption},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"hidden",{get:function(){return this._props.IsHidden},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"container",{get:function(){return this._props.ApplicationName},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"activityType",{get:function(){return this._props.ActivityType},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"activityWindowType",{get:function(){return this._props.ActivityWindowType},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"windowSettings",{get:function(){return this._props.Arguments?o.objectClone(this._props.Arguments):{}},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"allowMultiple",{get:function(){return this._props.AllowMultiple},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"available",{get:function(){return this._props.IsReady||!1},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"icon",{get:function(){return this._props.Icon},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"iconURL",{get:function(){return this._props.IconUrl},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"sortOrder",{get:function(){return this._props.SortOrder},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"userProperties",{get:function(){return this._props.UserProperties?o.objectClone(this._props.UserProperties):{}},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"isActivity",{get:function(){return this._props.ActivityType!==undefined&&""!==this._props.ActivityType},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"configuration",{get:function(){return{autoStart:this._props.AutoStart,caption:this._props.Caption,hidden:this._props.IsHidden,container:this._props.ApplicationName,activityType:this._props.ActivityType,allowMultiple:this._props.AllowMultiple}},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"instances",{get:function(){var e=this;return this._appManager.instances().filter(function(t){return t.application.name===e._name})},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"type",{get:function(){return this._props.Type},enumerable:!0,configurable:!0}),Object.defineProperty(ApplicationImpl.prototype,"mode",{get:function(){if(!this._props)return"unknown";if(this._props.Mode&&"string"==typeof this._props.Mode)return this._props.Mode.toLowerCase();if(this.isActivity)return"unknown";if(this._props.Arguments&&this._props.Arguments.mode&&"string"==typeof this._props.Arguments.mode)return this._props.Arguments.mode.toLowerCase();var e=this._props.WindowStyleAttributes;if(e){e=e.split(" ").join("");var t=e.indexOf('mode:"');if(-1!==t){var n=t+'mode:"'.length,i=e.indexOf('"',n),r=e.substr(n,i-n);if(r&&"string"==typeof r)return r.toLowerCase()}}return"flat"},enumerable:!0,configurable:!0}),ApplicationImpl.prototype.updateFromProps=function(e){var t=this;this._props||(this._props={Name:e.Name}),Object.keys(e).forEach(function(n){t._props[n]=e[n]})},ApplicationImpl.prototype.start=function(e,t){var n=this,r=this._name;return new Promise(function(o,a){t=t||{},e=e||{},e._t42={createWindowArgs:t},"undefined"==typeof t.waitForAGMReady&&(t.waitForAGMReady=!0);var s=t.waitForAGMReady,c=!t.waitForAGMReady,u=function(e){var t,i=function(){var t,i=n._appManager.instances().filter(function(t){return t.id===e});return 2===i.length&&(t=i[0].isActivityInstance?i[0]:i[1]),t=i[0],t&&s?t.agm?t:undefined:t};setTimeout(function(){t&&(t(),a("timeout"))},1e4);var r=function(n){n.id===e&&(t&&(t(),t=undefined),setTimeout(function(){o(i())},1))};t=s?n._appManager.onInstanceAgmServerReady(r):n._appManager.onInstanceStarted(r);var c=i();c&&(t=undefined,o(c))};n._agm.invoke(i.StartApplicationMethodName,{Name:r,Context:e,WaitForAgmInstance:s,WaitForInstance:c},"best",{methodResponseTimeoutMs:1e4},function(e){var t=e.returned.Instance_0||e.returned;t&&t.Id?u(t.Id):o(undefined)},function(e){a(e)})})},ApplicationImpl.prototype.onInstanceStarted=function(e){this._registry.add("instanceStarted",e)},ApplicationImpl.prototype.onInstanceStopped=function(e){this._registry.add("instanceStopped",e)},ApplicationImpl.prototype.onAvailable=function(e){this._registry.add("appAvailable",e)},ApplicationImpl.prototype.onUnavailable=function(e){this._registry.add("appUnavailable",e)},ApplicationImpl.prototype.onChanged=function(e){this._registry.add("appChanged",e)},ApplicationImpl.prototype.onRemoved=function(e){this._registry.add("appRemoved",e)},ApplicationImpl}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OnNotificationEvent="OnNotification",t.OnBranchChangedEvent="OnBranchChanged",t.OnBranchesModifiedEvent="OnBranchesModified",t.OnApplicationAddedEvent="OnApplicationAdded",t.OnApplicationRemovedEvent="OnApplicationRemoved",t.OnApplicationChangedEvent="OnApplicationChanged",t.OnApplicationReadyEvent="OnApplicationReady",t.OnApplicationStartedEvent="OnApplicationStarted",t.OnApplicationRegisteredEvent="OnApplicationRegistered",t.OnApplicationAgmServerReadyEvent="OnApplicationAgmServerReady",t.OnApplicationUpdatedEvent="OnApplicationUpdated",t.OnApplicationStoppedEvent="OnApplicationStopped",t.OnApplicationStartFailedEvent="OnApplicationStartFailed"},function(e,t,n){"use strict";function createDataSubscription(e,t,n,a){var s;return{start:function(){var c,u,d=new Promise(function(e,t){c=e,u=t});return e.subscribe(i.OnEventMethodName,{arguments:{skipIcon:a},waitTimeoutMs:1e4}).then(function(e){s=e,s.onData(function(e){var i=e.data;o.objectValues(i[r.OnApplicationAddedEvent]).map(function(e){return t.handleAppAdded(e)}),o.objectValues(i[r.OnApplicationChangedEvent]).map(function(e){return t.handleAppUpdated(e)}),o.objectValues(i[r.OnApplicationRemovedEvent]).map(function(e){return t.handleAppRemoved(e)}),o.objectValues(i[r.OnApplicationReadyEvent]).map(function(e){return t.handleAppReady(e)}),o.objectValues(i[r.OnApplicationStartedEvent]).map(function(e){return t.handleInstanceStarted(e)}),o.objectValues(i[r.OnApplicationStartFailedEvent]).map(function(e){return t.handleInstanceStartFailed(e)}),o.objectValues(i[r.OnApplicationStoppedEvent]).map(function(e){return t.handleInstanceStopped(e)}),o.objectValues(i[r.OnApplicationUpdatedEvent]).map(function(e){return t.handleInstanceUpdated(e)}),o.objectValues(i[r.OnApplicationAgmServerReadyEvent]).map(function(e){return t.handleInstanceAgmServerReady(e)}),o.objectValues(i[r.OnBranchChangedEvent]).map(function(e){return n.handleBranchModified(e)}),o.objectValues(i[r.OnBranchesModifiedEvent]).map(function(e){return n.handleBranchesModified(e)}),c()}),s.onFailed(function(e){return u(e)})})["catch"](function(e){return u("Error subscribing for "+i.OnEventMethodName+" stream. Err: "+e)}),d},stop:function(){s&&s.close()}}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(51),o=n(11);t["default"]=createDataSubscription},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(0),o=n(37),a=function(){function EntitlementsImpl(e){var t=this;this._agm=e,this._registry=r["default"](),this.handleBranchModified=function(e){t._registry.execute("branchChanged",e)},this.handleBranchesModified=function(e){t._registry.execute("branchesChanged",e)},this.getRegion=function(e,n){return o(t._agmInvoke(i.GetConfigurationRegionMethodName,function(e){return e.returned.Region}),e,n)},this.getBranches=function(e,n){var r=t._agmInvoke(i.GetBranchesMethodName,function(e){var t=e.returned.Branches;return Object.keys(t).map(function(e){return t[e]})});return o(r,e,n)},this.getCurrentBranch=function(e,n){var r=t._agmInvoke(i.GetCurrentBranchMethodName,function(e){return e.returned.Branch},undefined);return o(r,e,n)},this.setRegion=function(e,n,r){var a=t._agmInvoke(i.SetConfigurationRegionMethodName,function(e){return e.returned.ResultMessage},{Region:e});return o(a,n,r)},this.setCurrentBranch=function(e,n,r){var a=t._agmInvoke(i.SetCurrentBranchMethodName,function(e){return e.returned.ResultMessage},{Branch:e});return o(a,n,r)},this.currentUser=function(e,n){var r=t._agmInvoke(i.GetUserMethodName);return o(r,e,n)},this.getFunctionalEntitlement=function(e,n,r){var a=t._agmInvoke(i.GetFunctionalEntitlementMethodName,function(e){return e.returned.Entitlement},{Function:e});return o(a,n,r)},this.getFunctionalEntitlementBranch=function(e,n,r,a){var s=t._agmInvoke(i.GetFunctionalEntitlementMethodName,function(e){return e.returned.Entitlement},{Function:e,Branch:n});return o(s,r,a)},this.canI=function(e,n,r){var a=t._agmInvoke(i.CanIMethodName,function(e){return e.returned.Result},{Function:e});return o(a,n,r)},this.canIBranch=function(e,n,r,a){var s=t._agmInvoke(i.CanIMethodName,function(e){return e.returned.Result},{Function:e,Branch:n});return o(s,r,a)},this.onBranchesChanged=function(e){t._registry.add("branchesChanged",e)},this.onBranchChanged=function(e){t._registry.add("branchChanged",e)},this.exit=function(e){return t._agmInvoke(i.ShutdownMethodName,null,e)},this._agmInvoke=function(e,n,i){return i=i||{},new Promise(function(r,o){var a=function(e){return o(e)};t._agm.invoke(e,i).then(function(e){n||(n=function(e){return e.returned}),r(n(e))})["catch"](a)})}}return EntitlementsImpl}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(0),o=function(){function InstanceImpl(e,t,n,i,o,a,s){var c=this;this._id=e,this._app=t,this._appManager=n,this._agm=i,this._activities=o,this._windows=a,this.onAgmReady=this._addToRegistry("agmReady"),this.onStopped=this._addToRegistry("stopped"),this._registry=r["default"](),s||(this._unsubscribeInstanceStopped=this._appManager.onInstanceStopped(function(e){e.id===c._id&&c._registry.execute("stopped",e)}),this._unsubscribeInstanceAgmServerReady=this._appManager.onInstanceAgmServerReady(function(e){e.id===c._id&&c._registry.execute("agmReady",e)}))}return Object.defineProperty(InstanceImpl.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"application",{get:function(){return this._app},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"activity",{get:function(){var e=this;if(!this._activities)throw new Error("This method requires glue.activities library to be enabled.");return this._activities.all.instances.get().filter(function(t){return t.id===e._activityId})[0]},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"activityInstances",{get:function(){var e=this;return this._appManager.instances().filter(function(t){return t.context&&t.context.activityId===e._activityId})},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"activityOwnerInstance",{get:function(){return this._appManager.instances().filter(function(e){if(e.window&&e.window.context){var t=e.window.context;if(t._t42&&t._t42.activityIsOwner)return!0}return!1})[0]},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"window",{get:function(){var e=this;if(!this._windows)throw new Error("This method requires glue.windows library to be enabled.");var t=this._windows.list().filter(function(t){return t.id===e._id})[0];return!t&&this.activity&&this.activityOwnerInstance&&(t=this.activityOwnerInstance.window),t},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"context",{get:function(){return this._startUpContext},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"title",{get:function(){return this._title},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"isActivityInstance",{get:function(){return this._isActivityInstance},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"activityId",{get:function(){return this._activityId},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"inActivity",{get:function(){return this._inActivity},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"isSingleWindowApp",{get:function(){return!this._inActivity},enumerable:!0,configurable:!0}),Object.defineProperty(InstanceImpl.prototype,"agm",{get:function(){return this._agmInstance},enumerable:!0,configurable:!0}),InstanceImpl.prototype.updateFromProps=function(e){this._startUpContext=e.Context,this._title=e.Title,this._isActivityInstance=!1,e.ActivityId&&""!==e.ActivityId&&(this._activityId=e.ActivityId,this._isActivityInstance=!0),!this._activityId&&this._startUpContext&&this._startUpContext.activityId&&(this._activityId=this._startUpContext.activityId),this._inActivity=Boolean(this._activityId),this.updateAgmInstanceFromProps(e)},InstanceImpl.prototype.updateAgmInstanceFromProps=function(e){if(e.AgmServers)if(e.GD3){var t=e.AgmServers;t&&(this._agmInstance=t[0])}else{var n=e.AgmServers,i=Object.keys(n)[0];if(!i)return;var r=n[i];this._agmInstance={machine:r.machineName,user:r.userName,environment:r.environment,application:r.applicationName}}},InstanceImpl.prototype.stop=function(){var e=this;return new Promise(function(t,n){var r=e._appManager.onInstanceStopped(function(n){n.id===e._id&&(r(),t())});e._agm.invoke(i.StopApplicationMethodName,{Name:e._app.name,Id:e._id})["catch"](function(e){return n(e)})})},InstanceImpl.prototype.activate=function(){return this._agm.invoke(i.ActivateApplicationMethodName,{Name:this._app.name,Id:this._id})},InstanceImpl.prototype.done=function(){this._registry.clear(),this._unsubscribeInstanceAgmServerReady(),this._unsubscribeInstanceStopped()},InstanceImpl.prototype._addToRegistry=function(e){var t=this;return function(n){t._registry.add(e,n)}},InstanceImpl}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(49),r=n(53),o=n(56),a=n(52);t["default"]=function(e){if(!e)throw Error("config not set");if(!e.agm)throw Error("config.agm is missing");var t=e.mode||"startOnly";if("startOnly"!==t&&"skipIcons"!==t&&"full"!==t)throw new Error("Invalid mode for appManager lib - "+t+" is not supported");var n,s=e.activities,c=e.agm,u=e.logger,d=e.windows,p=new i["default"](c,s,d,u.subLogger("applications"),e.gdMajorVersion),f=new r["default"](c);if("startOnly"===t)n=o["default"](c,p);else{var l=a["default"](c,p,f,"skipIcons"===t);n=l.start()}return{ready:function(){return n},applications:p.applications,application:p.application,onAppAdded:p.onAppAdded,onAppRemoved:p.onAppRemoved,onAppChanged:p.onAppChanged,onAppAvailable:p.onAppAvailable,onAppUnavailable:p.onAppUnavailable,instances:p.instances,get myInstance(){return p.getMyInstance()},onInstanceStarted:p.onInstanceStarted,onInstanceStopped:p.onInstanceStopped,onInstanceUpdated:p.onInstanceUpdated,onInstanceStartFailed:p.onInstanceStartFailed,getRegion:f.getRegion,getBranches:f.getBranches,getCurrentBranch:f.getCurrentBranch,getFunctionalEntitlement:f.getFunctionalEntitlement,getFunctionalEntitlementBranch:f.getFunctionalEntitlementBranch,setCurrentBranch:f.setCurrentBranch,setRegion:f.setRegion,currentUser:f.currentUser,canI:f.canI,canIBranch:f.canIBranch,onBranchesChanged:f.onBranchesChanged,exit:f.exit}}},function(e,t,n){"use strict";function snapshot(e,t){return new Promise(function(n,o){e.invoke(i.GetApplicationsMethodName,{skipIcon:!0}).then(function(e){var i=e.returned;i||n();var o=i.applications;o||n(),r.objectValues(o).map(function(e){return t.handleAppAdded(e)}),n()})["catch"](function(e){return o("Error getting application snapshot: "+e.message)})})}Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),r=n(11);t["default"]=snapshot},function(e,t,n){"use strict";function setupAGM(e,t){var n;"undefined"!=typeof window&&(window.htmlContainer?n=window.htmlContainer.windowId:window.glue42gd&&(n=window.glue42gd.windowId)),n&&(e.invoke("T42.Channels.Announce",{swId:n,instance:e.instance.instance}),e.register("T42.Channels.Command",function(e){var n=e.command;if(!n)throw new Error("missing command argument");if("join"===n){var i=e.channel;if(!i)throw new Error("missing argument id");return void t.join(i)}if("leave"===n)return void t.leave();if("get"===n){var i=t.current();return{id:i}}throw new Error("unknown command "+n)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.setupAGM=setupAGM},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function fulfilled(e){try{step(i.next(e))}catch(e){o(e)}}function rejected(e){try{step(i["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i["return"]:o[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(){function ChannelsImpl(e){this.shared=e,this.subsKey="subs",this.changedKey="changed",this.registry=o["default"](),this.shared.subscribe(this.handler.bind(this))}return ChannelsImpl.prototype.current=function(){return this.currentContext},ChannelsImpl.prototype.subscribe=function(e){return this.registry.add(this.subsKey,e)},ChannelsImpl.prototype.publish=function(e){if(!this.currentContext)throw new Error("not joined to any channel");return this.shared.update(this.currentContext,{data:e})},ChannelsImpl.prototype.join=function(e){return this.currentContext=e,this.registry.execute(this.changedKey,e),this.shared.switchChannel(e)},ChannelsImpl.prototype.leave=function(){return this.currentContext=undefined,this.registry.execute(this.changedKey,undefined),this.shared.unsubscribe()},ChannelsImpl.prototype.all=function(){return this.shared.all()},ChannelsImpl.prototype.changed=function(e){this.registry.add(this.changedKey,e)},ChannelsImpl.prototype.meta=function(e,t){throw new Error("Method not implemented.")},ChannelsImpl.prototype.add=function(e){return i(this,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:if(!e)throw new Error("info argument can not be undefined");if(!e.name)throw new Error("info.name is missing");return t={name:e.name,meta:e.meta||{},data:e.data||{}},[4,this.shared.add(e.name,t)];case 1:return n.sent(),[2,t]}})})},ChannelsImpl.prototype.remove=function(e){throw new Error("Method not implemented.")},ChannelsImpl.prototype.onChannelAdded=function(e){throw new Error("Method not implemented.")},ChannelsImpl.prototype.onChannelRemoved=function(e){throw new Error("Method not implemented.")},ChannelsImpl.prototype.apps=function(e){throw new Error("Method not implemented.")},ChannelsImpl.prototype.handler=function(e){this.registry.execute(this.subsKey,e.data,e)},ChannelsImpl}();t.ChannelsImpl=a},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function fulfilled(e){try{step(i.next(e))}catch(e){o(e)}}function rejected(e){try{step(i["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i["return"]:o[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function SharedContextSubscriber(e){this.contexts=e,this.unsubscribeFunc=undefined,this.current=undefined}return SharedContextSubscriber.prototype.subscribe=function(e){this.callback=e},SharedContextSubscriber.prototype.switchChannel=function(e){return i(this,void 0,void 0,function(){var t,n,i=this;return r(this,function(r){switch(r.label){case 0:return this.unsubscribe(),this.current=e,t=this.createContextName(e),n=this,[4,this.contexts.subscribe(t,function(e){i.callback&&i.callback(e)})];case 1:return n.unsubscribeFunc=r.sent(),[2]}})})},SharedContextSubscriber.prototype.unsubscribe=function(){return this.unsubscribeFunc&&this.unsubscribeFunc(),Promise.resolve()},SharedContextSubscriber.prototype.add=function(e,t){return i(this,void 0,void 0,function(){var n;return r(this,function(i){return n=this.createContextName(e),[2,this.contexts.set(n,t)]})})},SharedContextSubscriber.prototype.all=function(){var e=this.contexts.all(),t=e.filter(function(e){return e.startsWith("___channel___")}),n=t.map(function(e){return e.substr("___channel___".length)});return Promise.resolve(n)},SharedContextSubscriber.prototype.update=function(e,t){var n=this.createContextName(e);return this.contexts.update(n,t)},SharedContextSubscriber.prototype.createContextName=function(e){return"___channel___"+e},SharedContextSubscriber}();t.SharedContextSubscriber=o},function(e,t,n){"use strict";function factory(e,t){var n=new r.SharedContextSubscriber(e),a=new o.ChannelsImpl(n);return i.setupAGM(t,a),{subscribe:a.subscribe.bind(a),publish:a.publish.bind(a),all:a.all.bind(a),current:a.current.bind(a),join:a.join.bind(a),leave:a.leave.bind(a),add:a.add.bind(a),changed:a.changed.bind(a),ready:function(){return e.ready()}}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(57),r=n(59),o=n(58);t.factory=factory},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){function getLibConfig(e,t,n){if("boolean"==typeof e&&!e)return undefined;var i=getModeAsString(e,t,n);return"object"==typeof e?(e.mode=i,e):{mode:i}}function getModeAsString(e,t,n){return"object"==typeof e?getModeAsString(e.mode,t,n)+"":void 0===e?"boolean"!=typeof t||t?t+"":undefined:"boolean"==typeof e?e?(n===undefined?t:n)+"":undefined:e+""}return{layouts:getLibConfig(e.layouts,"slim"),activities:getLibConfig(e.activities,"trackMyTypeAndInitiatedFromMe"),appManager:getLibConfig(e.appManager,!1,"startOnly"),windows:getLibConfig(e.windows,!0),channels:getLibConfig(e.channels||!1,!1)}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function fulfilled(e){try{step(i.next(e))}catch(e){o(e)}}function rejected(e){try{step(i["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function verb(e){return function(t){return step([e,t])}}function step(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i["return"]:o[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(){function HotkeysImpl(e){this.agm=e,this.registry=o["default"](),this.firstHotkey=!0,this.hotkeys=new Map}return HotkeysImpl.prototype.register=function(e,t){return i(this,void 0,void 0,function(){var n;return r(this,function(i){switch(i.label){case 0:if(void 0===e)throw new Error("Hotkey parameter missing");if("string"==typeof e)e={hotkey:e};else{if(!e.hotkey)throw new Error("Info's hotkey parameter missing");e={hotkey:e.hotkey,description:e.description}}if(n=this.formatHotkey(e.hotkey),this.hotkeys.has(n))throw new Error("Shortcut for "+n+" already registered");return this.firstHotkey?(this.firstHotkey=!1,[4,this.registerInvokeAGMMethod()]):[3,2];case 1:i.sent(),i.label=2;case 2:return this.registry.add(n,t),[4,this.agm.invoke("T42.Hotkeys.Command",{command:"register",hotkey:n,description:e.description})];case 3:return i.sent(),this.hotkeys.set(n,e),[2]}})})},HotkeysImpl.prototype.unregister=function(e){return i(this,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:if(void 0===e)throw new Error("hotkey parameter missing");if("string"!=typeof e)throw new Error("hotkey parameter must be string");return t=this.formatHotkey(e),[4,this.agm.invoke("T42.Hotkeys.Command",{command:"unregister",hotkey:t})];case 1:return n.sent(),this.hotkeys["delete"](t),this.registry.clearKey(t),[2]}})})},HotkeysImpl.prototype.unregisterAll=function(){return i(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.agm.invoke("T42.Hotkeys.Command",{command:"unregisterAll"})];case 1:return e.sent(),this.hotkeys.clear(),this.registry.clear(),[2]}})})},HotkeysImpl.prototype.isRegistered=function(e){var t=this.formatHotkey(e);return this.hotkeys.has(t)},HotkeysImpl.prototype.registerInvokeAGMMethod=function(){var e=this;this.agm.register("T42.Hotkeys.Invoke",function(t){var n=t.key.toLowerCase(),i=e.hotkeys.get(n);e.registry.execute(n,i)})},HotkeysImpl.prototype.formatHotkey=function(e){if(e)return e.replace(/\s/g,"").toLowerCase()},HotkeysImpl}();t.HotkeysImpl=a},function(e,t,n){"use strict";function factory(e){var t=new i.HotkeysImpl(e);return{register:t.register.bind(t),unregister:t.unregister.bind(t),unregisterAll:t.unregisterAll.bind(t),isRegistered:t.isRegistered.bind(t),ready:function(){return Promise.resolve()}}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(62);t.factory=factory},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function ContextProvider(e,t,n){this.agm=e,this.activitiesGetter=t,this.callbacks=n,this.registeredRequestsMethods=!1}return ContextProvider.prototype.onSaveRequested=function(e){return this.registeredRequestsMethods||(this.registerRequestMethods(),this.registeredRequestsMethods=!0),this.callbacks.add("saveRequested",e)},ContextProvider.prototype.isActivityOwner=function(){if("undefined"!=typeof htmlContainer){var e=htmlContainer.getContext();return e&&e._t42&&e._t42.activityIsOwner}var t=this.activitiesGetter();if(!t)return!1;if(!t.inActivity)return!1;var n=t.my.window,i=t.my.activity;return!(!i&&!n)&&i.owner.id===n.id},ContextProvider.prototype.registerRequestMethods=function(){var e=this;this.agm.register("T42.HC.GetSaveContext",function(t){var n=e.callbacks.execute("saveRequested",t)[0];if(!n)return{};n.activityContext=n.activityContext||{},n.windowContext=n.windowContext||{};var i={windowContext:n.windowContext,activityContext:undefined};return e.isActivityOwner()&&(i.activityContext=n.activityContext),i})},ContextProvider}();t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),r=n(28),o=n(64),a=n(20),s=n(18),c=function(){function LayoutsAPIImpl(e,t,n){this.config=e,this.stream=t,this.callbacks=n,this.appManager=e.appManager,this.onEvent=t.onEvent,this.provider=new o["default"](e.agm,e.activityGetter,n),t.subscribe()}return LayoutsAPIImpl.prototype.ready=function(){return"fullWaitSnapshot"===this.config.mode?this.stream.gotSnapshot:this.stream.ready},LayoutsAPIImpl.prototype.save=function(e){var t=this;return new Promise(function(n,i){if(t.verifyNotSlimMode(),!e.name)throw Error("layout.name argument is required");e.type||(e.type="Global"),e.activityId&&(e.type="Activity"),"undefined"==typeof e.ignoreHidden&&(e.ignoreHidden=!0);var r={name:e.name,actIds:[],appIds:[],type:e.type,context:e.context,metadata:e.metadata||{},options:{ignoreLayoutRestrictions:!1}};if("Activity"===e.type){var o=e.activityId;if(!o){if(!t.appManager.myInstance.inActivity)throw new Error("Current application is not in activity. Can not save activity layout for it");o=t.appManager.myInstance.activityId}r.actIds.push(o),r.options={ignoreLayoutRestrictions:!0}}else{if("Global"!==e.type)throw new Error("layout type "+e.type+" not supported");var a=t.appManager.instances();e.ignoreHidden&&(a=a.filter(function(e){return t.isVisibleWindow(e)})),e.ignoreMyInstance&&t.appManager.myInstance&&(a=a.filter(function(e){return e.id!==t.appManager.myInstance.id})),a.reduce(function(e,t){if(!t.id)return e;if(t.inActivity){var n=t.activityId;-1===e.actIds.indexOf(n)&&e.actIds.push(n)}else e.appIds.push(t.id);return e},r)}t.invokeMethodAndTrack("T42.ACS.SaveLayout",r,n,i)})},LayoutsAPIImpl.prototype.restore=function(e){var t=this;return new Promise(function(n,i){if(t.verifyNotSlimMode(),void 0===e)throw Error("options argument is required");if(!e.name)throw Error("options.name argument is required");e.type||(e.type="Global"),e.activityIdToJoin&&(e.type="Activity"),"undefined"==typeof e.restoreActivityOwner&&(e.restoreActivityOwner=!1),"undefined"==typeof e.ignoreActivityWindowTypes&&(e.ignoreActivityWindowTypes=[]),"undefined"==typeof e.setActivityContext&&(e.setActivityContext=!0),"undefined"==typeof e.closeRunningInstance&&("Global"===e.type?e.closeRunningInstance=!0:"Activity"===e.type&&(e.closeRunningInstance=!1)),"undefined"==typeof e.reuseWindows&&(e.reuseWindows=!0),e.context=e.context||{};var r={restoreOptions:{activityToJoin:e.activityIdToJoin,setActivityContext:e.setActivityContext,ignoreActivityWindowTypes:e.ignoreActivityWindowTypes,restoreActivityOwner:e.restoreActivityOwner,closeOldWindows:!0,reuseExistingWindows:e.reuseWindows}},o={type:e.type,name:e.name,context:e.context,toClose:[],splash:e.splash};e.closeRunningInstance&&(o.toClose=t.getInstancesToClose(e)),e.timeout&&(o.timeout=e.timeout),o.context._t42=r,t.invokeMethodAndTrack("T42.ACS.RestoreLayout",o,n,i,!0)})},LayoutsAPIImpl.prototype.remove=function(e,t){var n=this;return new Promise(function(i,r){if(n.verifyNotSlimMode(),!t)throw Error("name argument is required");if(!e)throw Error("type argument is required");var o={type:e,name:t};n.invokeMethodAndTrack("T42.ACS.RemoveLayout",o,i,r)})},LayoutsAPIImpl.prototype.list=function(){return this.verifyNotSlimMode(),i["default"].all},LayoutsAPIImpl.prototype["import"]=function(e,t){var n=this;return new Promise(function(i,r){n.verifyNotSlimMode();var o={mode:t||"replace",layouts:e};n.invokeMethodAndTrack("T42.ACS.ImportLayouts",o,i,r)})},LayoutsAPIImpl.prototype["export"]=function(){var e=this;return new Promise(function(t,n){var i=function(n){var i=e.getObjectValues(n.Layouts).map(function(e){return new s["default"](a["default"](e))});t(i)};e.invokeMethodAndTrack("T42.ACS.ExportLayouts",{},i,n,!0)})},LayoutsAPIImpl.prototype.rename=function(e,t){var n=this;return new Promise(function(i,r){if(n.verifyNotSlimMode(),!e)throw Error("layout argument is required");if(!e.name)throw Error("name argument is required");if(!e.type)throw Error("type argument is required");var o={type:e.type,oldName:e.name,newName:t};n.invokeMethodAndTrack("T42.ACS.RenameLayout",o,i,r)})},LayoutsAPIImpl.prototype.updateMetadata=function(e){var t=this;return new Promise(function(n,i){if(!e)throw Error("layout argument is required");if(!e.name)throw Error("name argument is required");if(!e.type)throw Error("type argument is required");if(!e.metadata)throw Error("metadata argument is required");var r={name:name,type:e.type,metadata:e.metadata};t.invokeMethodAndTrack("T42.ACS.UpdateMetadata",r,n,i,!0)})},LayoutsAPIImpl.prototype.onAdded=function(e){var t=this.callbacks.add("added",e);return i["default"].all.length>0&&i["default"].all.forEach(function(t){try{e(t)}catch(e){}}),t},LayoutsAPIImpl.prototype.onRemoved=function(e){return this.callbacks.add("removed",e)},LayoutsAPIImpl.prototype.onChanged=function(e){return this.callbacks.add("changed",e)},LayoutsAPIImpl.prototype.onRenamed=function(e){return this.callbacks.add("renamed",e)},LayoutsAPIImpl.prototype.onEvent=function(e){return this.stream.onEvent(e)},LayoutsAPIImpl.prototype.onSaveRequested=function(e){return this.provider.onSaveRequested(e)},LayoutsAPIImpl.prototype.filterInstance=function(e,t){var n=this,i=this.appManager.instances();return e&&(i=i.filter(function(e){return n.isVisibleWindow(e)})),t&&this.appManager.myInstance&&(i=i.filter(function(e){return e.id!==n.appManager.myInstance.id})),i.reduce(function(e,t){if(!t.id)return e;if(t.inActivity){var n=t.activityId;-1===e.actIds.indexOf(n)&&e.actIds.push(n)}else e.appIds.push(t.id);return e},{actIds:[],appIds:[]})},LayoutsAPIImpl.prototype.verifyNotSlimMode=function(){if("slim"===this.config.mode)throw Error("Operation not allowed in slim mode. Run in full mode.")},LayoutsAPIImpl.prototype.isVisibleWindow=function(e){return"exe"===e.application.type||"node"===e.application.type||("activity"===e.application.type||!(!e||!e.window)&&e.window.isVisible)},LayoutsAPIImpl.prototype.invokeMethodAndTrack=function(e,t,n,i,o){var a,s=o,c=r.generate();t.token=c;var u=function(){s&&a&&n(a)};o||this.stream.waitFor(c).then(function(){s=!0,u()})["catch"](function(e){i(e)});var d=function(t){t.returned||i("No result from method "+e),t.returned.status&&"Success"!==t.returned.status&&"PartialSuccess"!==t.returned.status&&i(t.returned),a=t.returned,u()};this.config.agm.invoke(e,t,"best",{methodResponseTimeoutMs:12e4}).then(d)["catch"](function(e){return i(e)})},LayoutsAPIImpl.prototype.getInstancesToClose=function(e){var t=this,n=[],i=this.appManager.applications().filter(function(e){return e.isShell})[0],r=i?i.name:"AppManager";return this.appManager.instances().forEach(function(i){t.appManager.myInstance&&i.id===t.appManager.myInstance.id||i.application.name!==r&&t.isVisibleWindow(i)&&("Activity"===e.type&&i.activityId!==e.activityIdToJoin||n.push({application:i.application.name,instance:i.id}))}),n},LayoutsAPIImpl.prototype.getObjectValues=function(e){return e?Object.keys(e).map(function(t){return e[t]}):[]},LayoutsAPIImpl}();t["default"]=c},function(e,t,n){"use strict";function default_1(e){if(!e.agm)throw Error("config.agm is required");if(!e.logger)throw Error("config.logger is required");e.mode=e.mode||"slim";var t,n=(e.logger,o["default"]());return e.mode,t=new r["default"](e.agm,n),new i["default"](e,t,n)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(65),r=n(67),o=(n(68),n(0));t["default"]=default_1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),r=n(18),o=n(20),a=function(){function ACSStream(e,t){var n=this;this.agm=e,this.callbacks=t,this.ready=new Promise(function(e,t){n.resolveReady=e,n.rejectReady=t}),this.gotSnapshot=new Promise(function(e,t){n.resolveGotSnapshot=e,n.rejectGotSnapshot=t})}return ACSStream.prototype.subscribe=function(e){var t=this,n=function(e){return t.getObjectValues(e).map(function(e){return o["default"](e)})};this.checkForLayoutEventMethod()?this.agm.subscribe("T42.ACS.OnLayoutEvent",{waitTimeoutMs:1e4}).then(function(e){e.onData(function(e){var i=e.data;i.IsSnapshot&&t.resolveGotSnapshot(),t.addLayouts(n(i.OnLayoutAdded)),t.removeLayouts(n(i.OnLayoutRemoved)),t.changeLayouts(n(i.OnLayoutChanged)),t.renameLayouts(n(i.OnLayoutRenamed)),t.callbacks.execute("streamEvent",i)}),e.onFailed(function(e){var n="can not subscribe to T42.ACS.OnLayoutEvent "+e;t.rejectReady(n),t.rejectGotSnapshot(n)}),t.resolveReady()})["catch"](function(e){var n="Error subscribing for T42.ACS.OnLayoutEvent stream. Err: "+e;t.rejectReady(n),t.rejectGotSnapshot(n)}):(e&&this.resolveReady(),setTimeout(function(){t.subscribe(!0)},500))},ACSStream.prototype.onEvent=function(e){return this.callbacks.add("streamEvent",e)},ACSStream.prototype.waitFor=function(e,t){var n=this;return t||(t=1e4),new Promise(function(i,r){var o=!1,a=n.onEvent(function(t){t.Token===e&&(o=!0,a(),i())});setTimeout(function(){o||r("timed out")},t)})},ACSStream.prototype.checkForLayoutEventMethod=function(){try{return-1!==this.agm.methods().map(function(e){return e.name}).indexOf("T42.ACS.OnLayoutEvent")}catch(e){return!1}},ACSStream.prototype.addLayouts=function(e){var t=this;e&&e.forEach(function(e){var n=new r["default"](e);i["default"].add(n),t.callbacks.execute("added",n)})},ACSStream.prototype.removeLayouts=function(e){var t=this;e&&e.forEach(function(e){i["default"].removeWhere(function(n){return!t.compareLayouts(n,e)}),t.callbacks.execute("removed",e)})},ACSStream.prototype.changeLayouts=function(e){var t=this;e&&e.forEach(function(e){i["default"].removeWhere(function(n){return!t.compareLayouts(n,e)}),i["default"].add(new r["default"](e)),t.callbacks.execute("changed",e)})},ACSStream.prototype.renameLayouts=function(e){var t=this;e&&e.forEach(function(e){var n=i["default"].first(function(n){return t.compareLayouts(n,{type:e.type,name:e.oldName})});if(!n)throw Error("received rename event for unknown layout with type "+e.type+" and name "+e.oldName);n.name=e.newName,t.callbacks.execute("renamed",n)})},ACSStream.prototype.compareLayouts=function(e,t){return e.name===t.name&&e.type===t.type},ACSStream.prototype.getObjectValues=function(e){return e?Object.keys(e).map(function(t){return e[t]}):[]},ACSStream}();t["default"]=a},function(e,t,n){"use strict";function default_1(){return{ready:Promise.resolve(undefined),subscribe:function(){},onEvent:function(e){return function(){}},waitFor:function(e,t){return Promise.resolve(undefined)},gotSnapshot:Promise.resolve(undefined)}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=default_1},function(e,t,n){"use strict";var i=n(23);"undefined"!=typeof window&&(window.Glue=i["default"]),i["default"]["default"]=i["default"],e.exports=i["default"]},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function Utils(){}return Utils.getGDMajorVersion=function(){if("undefined"==typeof window)return-1;if(!window.glueDesktop)return-1;if(!window.glueDesktop.version)return-1;var e=Number(window.glueDesktop.version.substr(0,1));return isNaN(e)?-1:e},Utils.isNode=function(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(e){return!1}},Utils}();t["default"]=n}).call(t,n(38))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(73),r=n(75);t["default"]=function(e,t,n,o){var a=t;return new Promise(function(t,s){if(2===o)a.trace("running in HC"),r["default"](e,a,n,window.htmlContainer.containerName,window.htmlContainer.windowId).then(t)["catch"](s);else if(o>=3){a.trace("running in GD");var c=new i["default"](e,a,n,undefined,window.glue42gd.windowId);c.init().then(t)["catch"](s)}else{var u=r["default"](e,a,n),d=new i["default"](e,a,n).init();Promise.race([u,d,function(e){return new Promise(function(t,n){return setTimeout(function(){n("timeout waiting for streams")},e)})}(1e4)]).then(t)["catch"](s)}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(26),r=function(){function GDExecutor(){}return Object.defineProperty(GDExecutor.prototype,"hostInstance",{get:function(){return this.agmTarget},enumerable:!0,configurable:!0}),GDExecutor.prototype.init=function(e,t){this.agm=e,this.agmTarget=t},GDExecutor.prototype.close=function(e){var t=this;return new Promise(function(n,i){t.execute("close",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.navigate=function(e,t){var n=this;return new Promise(function(i,r){n.execute("navigate",{windowId:e.id,options:{url:t}}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.setStyle=function(e,t){return new Promise(function(e,t){Promise.resolve()})},GDExecutor.prototype.setTitle=function(e,t){var n=this;return new Promise(function(i,r){var o={windowId:e.id,options:{title:t}};n.execute("setTitle",o).then(function(){i(e)})["catch"](function(e){r(e)}),Promise.resolve()})},GDExecutor.prototype.moveResize=function(e,t){var n=this;return new Promise(function(i,r){n.execute("moveResize",{windowId:e.id,options:{bounds:t}}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.addFrameButton=function(e,t){var n=this;return new Promise(function(i,r){n.execute("addButton",{windowId:e.id,options:t}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.removeFrameButton=function(e,t){var n=this;return new Promise(function(i,r){n.execute("removeButton",{windowId:e.id,options:t}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.activate=function(e){var t=this;return new Promise(function(n,i){t.execute("activate",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.focus=function(e){var t=this;return new Promise(function(n,i){t.execute("focus",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.maximizeRestore=function(e){var t=this;return new Promise(function(n,i){t.execute("maximizeRestore",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.maximize=function(e){var t=this;return new Promise(function(n,i){t.execute("maximize",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.restore=function(e){var t=this;return new Promise(function(n,i){t.execute("restore",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.minimize=function(e){var t=this;return new Promise(function(n,i){t.execute("minimize",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.collapse=function(e){var t=this;return new Promise(function(n,i){t.execute("collapse",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.expand=function(e){var t=this;return new Promise(function(n,i){t.execute("expand",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.toggleCollapse=function(e){var t=this;return new Promise(function(n,i){t.execute("toggleCollapse",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.snap=function(e,t,n){var i=this;return new Promise(function(r,o){var a,s=(e.id,"Invalid target parameter - should be an object with property id or a string. Invoked for source window id:"+e.id);if(!t)return void o(s);if("string"==typeof t)a=t;else{if("undefined"==typeof t.id)return void o(s);a=t.id}var c={targetWindowId:a};n&&(c.snappingEdge=n),i.execute("snap",{windowId:e.id,options:c}).then(function(){r(e)})["catch"](function(e){o(e)})})},GDExecutor.prototype.attachTab=function(e,t){var n=this;return new Promise(function(i,r){n.execute("attachTab",{windowId:e.id,options:t}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.detachTab=function(e,t){var n=this;return new Promise(function(i,r){n.execute("detachTab",{windowId:e.id,options:t}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.setVisible=function(e,t){var n=this;return void 0===t&&(t=!0),new Promise(function(i,r){var o;o=t?"show":"hide",n.execute(o,{windowId:e.id}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.showLoader=function(e,t){var n=this;return new Promise(function(i,r){n.execute("showLoadingAnimation",{windowId:e.id,options:t}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.hideLoader=function(e){var t=this;return new Promise(function(n,i){t.execute("hideLoadingAnimation",{windowId:e.id}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.updateContext=function(e,t){var n=this;return new Promise(function(i,r){n.execute("updateContext",{windowId:e.id,context:t,replace:!(Object.keys(e.context).length>0)}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.lock=function(e){var t=this;return new Promise(function(n,i){t.execute("lockUnlock",{windowId:e.id,options:{isLocked:!0}}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.unlock=function(e){var t=this;return new Promise(function(n,i){t.execute("lockUnlock",{windowId:e.id,options:{isLocked:!1}}).then(function(){n(e)})["catch"](function(e){i(e)})})},GDExecutor.prototype.getIcon=function(e){var t=this;return new Promise(function(n,i){t.execute("getIcon",{windowId:e.id,options:{}}).then(function(e){n(e.icon)})["catch"](function(e){i(e)})})},GDExecutor.prototype.setIcon=function(e,t){var n=this;return new Promise(function(i,r){n.execute("setIcon",{windowId:e.id,options:{dataURL:t}}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.setFrameColor=function(e,t){var n=this;return new Promise(function(i,r){n.execute("setFrameColor",{windowId:e.id,options:{frameColor:t}}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.setTabHeaderVisible=function(e,t){var n=this;return new Promise(function(i,r){n.execute("setTabHeaderVisible",{windowId:e.id,options:{toShow:t}}).then(function(){i(e)})["catch"](function(e){r(e)})})},GDExecutor.prototype.execute=function(e,t){var n=this;return new Promise(function(r,o){var a={};i(a,t),a.command=e,n.agm.invoke("T42.Wnd.Execute",a,n.agmTarget).then(function(e){e.returned&&e.returned.errorMsg?o(e):r(e.returned)})["catch"](function(e){o(e)})})},GDExecutor.prototype.setGroupHeaderVisible=function(e,t){return this.execute("setGroupHeaderVisibility",{windowId:e,options:{toShow:t}})},GDExecutor}();t.GDExecutor=r,t["default"]=new r},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(3),a=n(22),s=n(72),c=n(21),u=function(){function GDEnvironment(e,t,n,i,o){this._registry=r(),this._waitTimeout=1e4,this._agm=e,this._logger=t.subLogger("gd-env"),this._agmInstance=this.normalizeInstance(i),this._windowId=o,this._appManagerGetter=n}return GDEnvironment.prototype.init=function(){var e=this;return new Promise(function(t,n){"undefined"==typeof e._agmInstance&&(e._agmInstance="best");new Promise(function(i,r){e._agm.subscribe("T42.Wnd.OnEvent",{waitTimeoutMs:e._waitTimeout,target:e._agmInstance}).then(function(i){i.onData(function(t){e.updateWindow(t.data)}),i.onFailed(function(e){n(e)}),e._agmInstance=e.normalizeInstance(i.serverInstance),s["default"].init(e._agm,e._agmInstance),t(e)})["catch"](function(e){n("Can not subscribe for stream T42.Wnd.OnEvent. Err: "+e)})})})},Object.defineProperty(GDEnvironment.prototype,"executor",{get:function(){return s["default"]},enumerable:!0,configurable:!0}),GDEnvironment.prototype.open=function(e,t,n,i,r){n=n||{};var o=Object.assign({},n);if(void 0===e)return void(r&&r({message:"The name is undefined"}));"undefined"!=typeof o.relativeTo&&"string"!=typeof o.relativeTo&&(o.relativeTo=o.relativeTo.id||""),o.name=e,o.url=t,o.windowState=n.windowState||n.state,delete o.state,this._agm.invoke("T42.Wnd.Create",o,this._agmInstance).then(function(e){if(e.returned!==undefined){var t=e.returned.id;i(t)}else r({message:"failed to execute T42.Wnd.Create - unknown reason"})})["catch"](function(e){"function"==typeof r&&r(e)})},GDEnvironment.prototype.tabAttached=function(e){return this._registry.add("tab-attached",e)},GDEnvironment.prototype.tabDetached=function(e){return this._registry.add("tab-detached",e)},GDEnvironment.prototype.onWindowFrameColorChanged=function(e){return this._registry.add("frame-color-changed",e)},GDEnvironment.prototype.onEvent=function(e){return this._registry.add("window-event",e)},GDEnvironment.prototype.my=function(){return this._windowId},GDEnvironment.prototype.execute=function(e,t){return this._agm.invoke("T42.Wnd.Execute",{command:e,options:t})},GDEnvironment.prototype.setGroupHeaderVisible=function(e,t){return this._agm.invoke("T42.Wnd.SetGroupHeaderVisible",{windowId:e,toShow:t},this._agmInstance)},GDEnvironment.prototype.onCompositionChanged=function(e){return this._registry.add("composition-changed",e)},GDEnvironment.prototype.onGroupHeaderVisibilityChanged=function(e){return this._registry.add("group-header-changed",e)},GDEnvironment.prototype.onWindowGotFocus=function(e){return this._registry.add("got-focus",e)},GDEnvironment.prototype.onWindowLostFocus=function(e){return this._registry.add("lost-focus",e)},GDEnvironment.prototype.normalizeInstance=function(e){return e?{application:e.application,machine:e.machine,user:e.user}:undefined},GDEnvironment.prototype.updateWindow=function(e){var t=this,n=this.getExtendedStreamEvent(e);if("Snapshot"===e.type){return void e.windows.forEach(function(e){var i=t.createWindow(e.id,e);o["default"].markReadyToShow(i.API.id),t._registry.execute("window-event",n)})}if("Created"===e.type){var i=e,r=this.createWindow(i.windowId,i.data||{});return o["default"].setReadyState(r.API.id),void this._registry.execute("window-event",n)}var a=o["default"].get(e.windowId);if(!a)return void this._logger.error("received update for unknown window. Stream:', "+JSON.stringify(e,null,4));var s=a.API,u=a.Events;if("BoundsChanged"===e.type){var d=e;u.handleBoundsChanged(d.data)}if("UrlChanged"===e.type){var p=e;o["default"].setUrlChangedState(p.windowId),u.handleUrlChanged(p.data)}if("TitleChanged"===e.type){var f=e;u.handleTitleChanged(f.data)}if("VisibilityChanged"===e.type&&u.handleVisibilityChanged(e.data),"ContextChanged"===e.type&&u.handleContextUpdated(e.data),"StateChanged"===e.type&&u.handleWindowChangeState(e.data),"FrameColorChanged"===e.type&&(u.handleFrameColorChanged(e.data),this._registry.execute("frame-color-changed",s)),"CompositionChanged"===e.type){var l=e;u.handleCompositionChanged(l.data.neighbors,l.data.groupId),this._registry.execute("composition-changed",l.data)}if("GroupHeaderVisibilityChanged"===e.type){var h=e;u.handleGroupHeaderVisibilityChanged(h.data.groupHeaderVisible),this._registry.execute("group-header-changed",h.data)}if("FocusChanged"===e.type){var y=e;this.focusChanged(u,s,y.data)}if("WindowFrameChanged"===e.type&&(u.handleFrameAttached(e.data.frameId,e.data.isTabHeaderVisible),this._registry.execute("frame-changed")),"WindowFrameAdded"===e.type){u.handleAttached(e.data.frameId,e.data.isTabHeaderVisible);var g=c.getWindowsByTabGroupId(s.id,e.data.frameId);Object.keys(g).forEach(function(e){g[e].Events.handleWindowAttached(s)}),this._registry.execute("tab-attached",s,e.data.frameId,e.data.isTabHeaderVisible)}if("WindowFrameRemoved"===e.type){var v=s.tabGroupId;u.handleDetached(e.data.frameId);var m=c.getWindowsByTabGroupId(s.id,v);Object.keys(m).forEach(function(e){m[e].Events.handleWindowDetached(s)});var b=this._registry.add("frame-changed",function(){b(),t._registry.execute("tab-detached",s,e.data.frameId,s.tabGroupId)})}"TabHeaderVisibilityChanged"===e.type&&u.handleTabHeaderVisibilityChanged(e.data.isTabHeaderVisible),"FrameSelectionChanged"===e.type&&u.handleFrameSelectionChanged(e.data.newWindowId,e.data.prevWindowId),"ButtonClicked"===e.type&&u.handleFrameButtonClicked(e.data),"ButtonAdded"===e.type&&u.handleFrameButtonAdded(e.data),"ButtonRemoved"===e.type&&u.handleFrameButtonRemoved(e.data),"Closed"===e.type&&(o["default"].remove(a),u.handleWindowClose()),this._registry.execute("window-event",n)},GDEnvironment.prototype.createWindow=function(e,t){var n=a["default"](e,this.mapToWindowConstructorOptions(t),s["default"],this._logger,this._appManagerGetter);return o["default"].add(n),n},GDEnvironment.prototype.focusChanged=function(e,t,n){e.handleFocusChanged(n),n?this._registry.execute("got-focus",t):this._registry.execute("lost-focus",t)},GDEnvironment.prototype.mapToWindowConstructorOptions=function(e){return{name:e.name,context:e.context,bounds:e.bounds,url:e.url,title:e.title,isVisible:e.isVisible,focus:e.isFocused,state:e.state,frameColor:e.frameColor,groupId:e.groupId,neighbours:e.neighbors,isFocused:e.isFocused,isGroupHeaderVisible:e.groupHeaderVisible,isCollapsed:e.isCollapsed,tabGroupId:e.frameId,mode:e.mode,isTabHeaderVisible:e.isTabHeaderVisible,isTabSelected:e.isActiveTab,settings:e.settings,windowType:e.windowType}},GDEnvironment.prototype.getExtendedStreamEvent=function(e){try{var t=i({state:e.type,windowName:o["default"].get(e.windowId).API.name},e);return"WindowFrameAdded"===t.state&&(t.state="TabAttached"),"StateChanged"===t.state&&(t.state=t.data.charAt(0).toUpperCase()+t.data.slice(1)),"ButtonAdded"===t.state&&(t.state="FrameButtonAdded"),"ButtonRemoved"===t.state&&(t.state="FrameButtonRemoved"),t}catch(t){return e}},GDEnvironment}();t["default"]=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function HcExecutor(){}return Object.defineProperty(HcExecutor.prototype,"hostInstance",{get:function(){return this.agmTarget},enumerable:!0,configurable:!0}),HcExecutor.prototype.init=function(e,t){this.agm=e,this.agmTarget=t},HcExecutor.prototype.close=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return e.url===undefined};return t.agmAction(e,"T42.Wnd.Close",successHandler,errorHandler,{},r,e.onClose)})},HcExecutor.prototype.navigate=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}var o=function(){return e.url===t};return n.agmAction(e,"T42.Html.OpenUrl",successHandler,errorHandler,{url:t},o,e.onUrlChanged,!0)})},HcExecutor.prototype.setStyle=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}return n.agmAction(e,"T42.Wnd.SetWindowStyle",successHandler,errorHandler,{windowStyleAttributes:JSON.stringify(t)})})},HcExecutor.prototype.setTitle=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}var o=function(){return e.title===t};return n.agmAction(e,"T42.Wnd.SetWindowTitle",successHandler,errorHandler,{title:t},o,e.onTitleChanged)})},HcExecutor.prototype.moveResize=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}var o=function(){var n=e.bounds,i=!0;return Object.keys(t).forEach(function(e){if(t[e]!==n[e])return void(i=!1)}),i};return n.agmAction(e,"T42.Wnd.ResizeAndMove",successHandler,errorHandler,t,o,e.onBoundsChanged)})},HcExecutor.prototype.addFrameButton=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}var o=function(){return!1};return n.agmAction(e,"T42.Wnd.AddFrameButton",successHandler,errorHandler,{buttonInfo:t},o,e.onFrameButtonAdded)})},HcExecutor.prototype.removeFrameButton=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}var o=function(){return!1};return n.agmAction(e,"T42.Wnd.RemoveFrameButton",successHandler,errorHandler,{buttonId:t},o,e.onFrameButtonRemoved)})},HcExecutor.prototype.activate=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return e.isFocused};return t.agmAction(e,"T42.Wnd.Activate",successHandler,errorHandler,{},r,e.onFocusChanged)})},HcExecutor.prototype.focus=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return e.isFocused};return t.agmAction(e,"T42.Wnd.Activate",successHandler,errorHandler,{focus:!0},r,e.onFocusChanged)})},HcExecutor.prototype.maximizeRestore=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r="maximized"!==e.state?e.onNormal:e.onMaximized,o=function(){return!1};return t.agmAction(e,"T42.Wnd.MaximizeOrRestoreDown",successHandler,errorHandler,{},o,r)})},HcExecutor.prototype.maximize=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return"maximized"===e.state};return t.agmAction(e,"T42.Wnd.Maximize",successHandler,errorHandler,{},r,e.onMaximized)})},HcExecutor.prototype.restore=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return"normal"===e.state};return t.agmAction(e,"T42.Wnd.Restore",successHandler,errorHandler,{},r,e.onNormal)})},HcExecutor.prototype.minimize=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return"minimized"===e.state};return t.agmAction(e,"T42.Wnd.Minimize",successHandler,errorHandler,{},r,e.onMinimized)})},HcExecutor.prototype.collapse=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return e.isCollapsed};return t.agmAction(e,"T42.Wnd.SetCollapsed",successHandler,errorHandler,{collapsed:!0},r,e.onCollapsed)})},HcExecutor.prototype.expand=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return!e.isCollapsed};return t.agmAction(e,"T42.Wnd.SetCollapsed",successHandler,errorHandler,{collapsed:!1},r,e.onExpanded)})},HcExecutor.prototype.toggleCollapse=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return!1},o=e.isCollapsed?e.onExpanded:e.onCollapsed;return t.agmAction(e,"T42.Wnd.SetCollapsed",successHandler,errorHandler,{title:""},r,o)})},HcExecutor.prototype.snap=function(e,t,n){var i=this;return new Promise(function(r,o){function successHandler(e){r(e)}function errorHandler(e){o(e)}var a,s=e.id,c="Invalid target parameter - should be an object with property id or a string. Invoked for source window id:"+e.id;if(!t)return void o(c);if("string"==typeof t)a=t;else{if("undefined"==typeof t.id)return void o(c);a=t.id}var u={sourceWindowId:s,targetWindowId:a};return n&&(u.snappingEdge=n),i.agmAction(e,"T42.Wnd.Snap",successHandler,errorHandler,u)})},HcExecutor.prototype.attachTab=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}return n.agmAction(e,"T42.Wnd.AttachTab",successHandler,errorHandler,t)})},HcExecutor.prototype.detachTab=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}return n.agmAction(e,"T42.Wnd.DettachTab",successHandler,errorHandler,t)})},HcExecutor.prototype.setVisible=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}void 0===t&&(t=!0);var o=function(){return e.isVisible===t},a={Hidden:!t};return n.agmAction(e,"T42.Wnd.SetWindowStyle",successHandler,errorHandler,{windowStyleAttributes:JSON.stringify(a)},o,e.onVisibilityChanged)})},HcExecutor.prototype.showLoader=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}var o=t||{};o.enabled=!0,o.timeout=o.timeout||-1;var a={loader:o};return n.agmAction(e,"T42.Wnd.UpdateLoader",successHandler,errorHandler,a)})},HcExecutor.prototype.hideLoader=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}return t.agmAction(e,"T42.Wnd.UpdateLoader",successHandler,errorHandler,{loader:{enabled:!1}})})},HcExecutor.prototype.updateContext=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}if(!t)return void r("Invalid context parameter - should be an object. Invoked for source window id:"+e.id);var o=function(){return!1};return n.agmAction(e,"T42.Wnd.UpdateContext",successHandler,errorHandler,{context:t},o,e.onContextUpdated)})},HcExecutor.prototype.lock=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return!1};return t.agmAction(e,"T42.Wnd.Lock",successHandler,errorHandler,{},r,e.onLockingChanged)})},HcExecutor.prototype.unlock=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}var r=function(){return!1};return t.agmAction(e,"T42.Wnd.Unlock",successHandler,errorHandler,{},r,e.onLockingChanged)})},HcExecutor.prototype.getIcon=function(e){var t=this;return new Promise(function(n,i){function successHandler(e){n(e)}function errorHandler(e){i(e)}return t.agmAction(e,"T42.Wnd.GetIcon",successHandler,errorHandler)})},HcExecutor.prototype.setIcon=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}return t?n.agmAction(e,"T42.Wnd.SetIcon",successHandler,errorHandler,{base64ImageSource:t}):void r("Invalid base64Image parameter. Invoked for source window id:"+e.id)})},HcExecutor.prototype.setFrameColor=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}if(!t)return void r("Invalid frameColor parameter. Invoked for source window id:"+e.id);var o=function(){return!1};return n.agmAction(e,"T42.Wnd.SetWindowStyle",successHandler,errorHandler,{windowStyleAttributes:JSON.stringify({stickyFrameColor:t})},o,e.onFrameColorChanged)})},HcExecutor.prototype.setTabHeaderVisible=function(e,t){var n=this;return new Promise(function(i,r){function successHandler(e){i(e)}function errorHandler(e){r(e)}void 0===t&&(t=!0);var o=function(){return e.isTabHeaderVisible===t};return n.agmAction(e,"T42.Wnd.SetTabHeaderVisible",successHandler,errorHandler,{toShow:t},o,e.onTabHeaderVisibilityChanged)})},HcExecutor.prototype.execute=function(e,t){return this.agm.invoke("T42.Wnd.Execute",{command:e,options:t})},HcExecutor.prototype.setGroupHeaderVisible=function(e,t){return this.agm.invoke("T42.Wnd.SetGroupHeaderVisible",{windowId:e,toShow:t},this.agmTarget)},HcExecutor.prototype.agmAction=function(e,t,n,i,r,o,a,s){if(s=s||!1,e.url===undefined)return void("function"==typeof i&&i("Cannot execute a command on a closed window."));if(void 0===o||o())this.agmInvoke(e,t,r,n,i);else{var c=function(){},u=!1;c=a(function(){u=!0,c(),"function"==typeof n&&n(e)}),s||setTimeout(function(){u||"function"==typeof i&&i("Agm invoke timeout! action: "+t)},2e3),this.agmInvoke(e,t,r,function(){},i)}},HcExecutor.prototype.agmInvoke=function(e,t,n,i,r){function successHandler(){"function"==typeof i&&i(e)}function errorHandler(e){"function"==typeof r&&r(e.all_return_values&&e.all_return_values.length>0?e.all_return_values[0].message:e)}n=n||{},n.windowId=e.id,this.agm.invoke(t,n,this.agmTarget,{},successHandler,errorHandler)},HcExecutor}();t.HcExecutor=i,t["default"]=new i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(3),o=n(22),a=n(74),s=n(21);t["default"]=function(e,t,n,c,u){return new Promise(function(d,p){function updateWindow(e,t){if("Created"===e){var n=createWindow(t.windowId,t);return h.execute("window-event",t),void(t.focus&&focusChanged(n.Events,n.API,!0))}var i=r["default"].get(t.windowId);if(!i)return void y.error("received update for unknown window. Stream:', "+JSON.stringify(t,null,4));var o=i.API,a=i.Events,c=o.frameColor;if("Ready"===e&&r["default"].setReadyState(i.API.id),"TitleChanged"===e&&a.handleTitleChanged(t.windowTitle),"UrlChanged"===e&&(r["default"].setUrlChangedState(i.API.id),a.handleUrlChanged(t.url)),"WindowStyleChanged"===e){var u=parseWindowStyleAttributes(t.windowStyleAttributes);a.handleWindowSettingsChanged(u),a.handleVisibilityChanged(!u.hidden)}if("Normal"===e||"Maximized"===e||"Minimized"===e||"Collapsed"===e||"Expanded"===e){var d=e.toLowerCase();a.handleWindowChangeState(d)}if("ContextUpdated"===e&&a.handleContextUpdated(t.context),"FrameButtonAdded"===e&&a.handleFrameButtonAdded(t),"FrameButtonRemoved"===e&&a.handleFrameButtonRemoved(t.buttonId),"FrameButtonClicked"===e&&a.handleFrameButtonClicked(t),"FrameSelectionChanged"===e&&a.handleFrameSelectionChanged(t.newWindow,t.prevWindow),"FrameIsLockedChanged"===e&&a.handleFrameIsLockedChanged(t.isLocked),"TabHeaderVisibilityChanged"===e&&a.handleTabHeaderVisibilityChanged(t.tabHeaderVisible),"BoundsChanged"===e){var p={height:t.height,left:t.left,top:t.top,width:t.width};a.handleBoundsChanged(p)}if("FocusChanged"===e&&focusChanged(a,o,t.focus),"FrameColorChanged"===e&&c!==t.frameColor&&(a.handleFrameColorChanged(t.frameColor),h.execute("frame-color-changed",o)),"FrameAttached"===e&&a.handleFrameAttached(t.tabGroupId,t.tabHeaderVisible),"TabAttached"===e){a.handleAttached(t.tabGroupId,t.tabHeaderVisible);var f=s.getWindowsByTabGroupId(o.id,t.tabGroupId);Object.keys(f).forEach(function(e){f[e].Events.handleWindowAttached(o)}),h.execute("tab-attached",o,t.tabGroupId,t.tabHeaderVisible)}if("TabDettached"===e){var l=o.tabGroupId;a.handleDetached(t.tabGroupId);var g=s.getWindowsByTabGroupId(o.id,l);Object.keys(g).forEach(function(e){g[e].Events.handleWindowDetached(o)}),h.execute("tab-detached",o,t.tabGroupId,o.tabGroupId)}"CompositionChanged"===e&&(a.handleCompositionChanged(t.neighbours,t.groupId),h.execute("composition-changed",t)),"GroupHeaderVisibilityChanged"===e&&(a.handleGroupHeaderVisibilityChanged(t.groupHeaderVisible),h.execute("group-header-changed",t)),"Closed"===e&&(t.focus&&focusChanged(a,o,!1),r["default"].remove(i),a.handleWindowClose()),h.execute("window-event",t)}function focusChanged(e,t,n){e.handleFocusChanged(n),n?h.execute("got-focus",t):h.execute("lost-focus",t)}function createWindow(e,t){var i=o["default"](e,mapToWindowConstructorOptions(t),a["default"],y,n);return r["default"].add(i),i}function open(t,n,i,r,o){i=i||{},"undefined"!=typeof i.relativeTo&&"string"!=typeof i.relativeTo&&(i.relativeTo=i.relativeTo.id||""),i.windowName=t,i.url=n,e.invoke("T42.Html.CreateWindow",i).then(function(e){if(e.returned!==undefined){var t=e.returned.id;r(t)}else o("failed to execute T42.Html.CreateWindow - unknown reason")})["catch"](function(e){"function"==typeof o&&o(e)})}function tabAttached(e){return h.add("tab-attached",e)}function tabDetached(e){return h.add("tab-detached",e)}function onWindowFrameColorChanged(e){return h.add("frame-color-changed",e)}function onWindowGotFocus(e){return h.add("got-focus",e)}function onWindowLostFocus(e){return h.add("lost-focus",e)}function onEvent(e){return h.add("window-event",e)}function my(){return g}function onCompositionChanged(e){return h.add("composition-changed",e)}function onGroupHeaderVisibilityChanged(e){return h.add("group-header-changed",e)}function mapToWindowConstructorOptions(e){var t="undefined"!=typeof e.WindowState?e.WindowState.toLowerCase():"normal",n=parseWindowStyleAttributes(e.windowStyleAttributes);return{name:e.windowName,url:e.url,title:e.windowTitle,context:e.context,bounds:{height:e.height,left:e.left,top:e.top,width:e.width},focus:e.focus,frameColor:e.frameColor,groupId:e.groupId,isCollapsed:e.isCollapsed,isGroupHeaderVisible:e.isGroupHeaderVisible,isLocked:e.isLocked,isTabHeaderVisible:e.isTabHeaderVisible,isTabSelected:e.isTabSelected,isVisible:!n.hidden,isFocused:n.focus,mode:n.mode,settings:n,state:t,tabGroupId:e.tabGroupId,neighbours:e.neighbours}}function parseWindowStyleAttributes(e){return e===undefined?{}:"object"!=typeof e?JSON.parse(e):e}var f,l,h=i(),y=t.subLogger("hc-env"),g=u;l=void 0!==c?{application:"HtmlContainer."+c}:"best";var v=new Promise(function(t,n){e.subscribe("T42.Wnd.WindowStateChanged",{waitTimeoutMs:1e4,target:l}).then(function(e){e.onData(function(e){l=e.server,updateWindow(e.data.state,e.data)}),e.onFailed(function(e){n(e)}),t()})["catch"](function(e){n("Can not subscribe for stream T42.Wnd.WindowStateChanged. Err: "+e)})}),m=new Promise(function(t,n){e.invoke("T42.Wnd.ListWindows",{},l,{waitTimeoutMs:1e4}).then(function(e){l=e.executed_by,Object.keys(e.returned).forEach(function(t){var n=e.returned[t],i=createWindow(n.windowId,n);r["default"].markReadyToShow(i.API.id)}),t()})["catch"](function(e){n("Can not invoke T42.Wnd.ListWindows method. Err: "+e)})});Promise.all([v,m]).then(function(){a["default"].init(e,l),d(f)})["catch"](function(e){p("can not subscribe for stream T42.Wnd.WindowStateChanged or can not invoke T42.Wnd.ListWindows ")}),f={my:my,onEvent:onEvent,open:open,tabAttached:tabAttached,tabDetached:tabDetached,onWindowFrameColorChanged:onWindowFrameColorChanged,executor:a["default"],onCompositionChanged:onCompositionChanged,onGroupHeaderVisibilityChanged:onGroupHeaderVisibilityChanged,onWindowGotFocus:onWindowGotFocus,onWindowLostFocus:onWindowLostFocus}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(3);t["default"]=function(e,t){function addWindow(e){if(-1===a.indexOf(e)){a.push(e);var t=r["default"].get(e);t.Events.handleGroupAssociation(s),o.execute("window-added",s,t.API)}}function removeWindow(e){var t=a.indexOf(e);if(-1!==t){a.splice(t,1);var n=_mapToWindowObject(e);o.execute("window-removed",s,n)}}function find(e,t){var n;n="string"==typeof e?e:e.id;var i=a.indexOf(n);if(-1!==i){var r=_mapToWindowObject(a[i]);return"function"==typeof t&&t(r),r}}function windows(e){var t=_mapToWindowObjects();return"function"==typeof e&&e(t),t}function showHeader(e,n){return new Promise(function(n,i){t.setGroupHeaderVisible(a[0],!0).then(function(t){"function"==typeof e&&e(s),n(s)})["catch"](function(e){i(e)})})}function hideHeader(e,n){return new Promise(function(n,i){t.setGroupHeaderVisible(a[0],!1).then(function(t){"function"==typeof e&&e(s),n(s)})["catch"](function(e){})})}function execute(e,n,i,r){return new Promise(function(r,o){t.execute(e,n).then(function(e){"function"==typeof i&&i(s),r(s)})["catch"](function(e){o(e)})})}function handleGroupHeaderVisibilityChanged(e){n!==e.groupHeaderVisible&&(n=e.groupHeaderVisible,o.execute("header-visibility-changed",s))}function _mapToWindowObjects(){var e=[];return a.forEach(function(t){var n=_mapToWindowObject(t);void 0!==n&&e.push(n)}),e}function _mapToWindowObject(e){return r["default"].get(e)?r["default"].get(e).API:undefined}function _getGroupHeaderVisibility(){return 0===_mapToWindowObjects().filter(function(e){return!e.isGroupHeaderVisible}).length}function onHeaderVisibilityChanged(e){return o.add("header-visibility-changed",e)}function onWindowAdded(e){return o.add("window-added",e)}function onWindowRemoved(e){return o.add("window-removed",e)}var n,o=i(),a=[],s={id:e,get windows(){return windows()},find:find,get isHeaderVisible(){return _getGroupHeaderVisibility()},showHeader:showHeader,hideHeader:hideHeader,maximize:function(t,n){return execute("maximize",{groupId:e},t,n)},restore:function(t,n){return execute("restore",{groupId:e},t,n)},onHeaderVisibilityChanged:onHeaderVisibilityChanged,onWindowAdded:onWindowAdded,onWindowRemoved:onWindowRemoved};return{groupAPI:s,groupInternal:{addWindow:addWindow,removeWindow:removeWindow,handleGroupHeaderVisibilityChanged:handleGroupHeaderVisibilityChanged}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(76),o=n(3);t["default"]=function(e,t){function my(){return findGroupByWindow(e.my())}function list(e){var t=Object.keys(s).map(function(e){if(s[e])return s[e].groupAPI});return"function"==typeof e&&e(t),t}function findGroupByWindow(e,n){var i;if(void 0===e)return void t.debug("trying to find a group by a window, but winId is undefined");i="string"==typeof e?e:e.id;var r;return Object.keys(s).forEach(function(e){var t=s[e].groupAPI;if(t.find(i)!==undefined)return void(r=t)}),"function"==typeof n&&n(r),r}function onWindowMoved(e){return a.add("window-moved",e)}function createOrGetGroup(t){if(s.hasOwnProperty(t))return s[t];var n=r["default"](t,e.executor);return s[t]=n,n}function deleteGroup(e){s.hasOwnProperty(e)&&"undefined"!=typeof s[e]&&0===s[e].groupAPI.windows.length&&delete s[e]}function addNewWindow(e){n.trace("Adding new window "+e.API.id+" to win.API.groupId "+e.API.groupId);var t=addWindow(e);t&&(n.trace("handleGroupAssociation "+e.API.id+" to group.groupAPI.id "+t.groupAPI.id),e.Events.handleGroupAssociation(t.groupAPI))}function addWindow(e,t){var i=t||e.API.groupId,r=e.API.id;if(void 0===i||void 0===r)return void n.debug("trying to add a window without group - winId: "+r);var o=createOrGetGroup(i);return o.groupInternal.addWindow(r),o}function removeWindow(e,t){var n=e.API.id,i=t||e.API.groupId;if(void 0!==i){s[i].groupInternal.removeWindow(n),e.Events.handleGroupAssociation(undefined),deleteGroup(i)}}function handleCompositionChanged(e){var t=e.groupId,i=e.windowId,r=findGroupByWindow(i),s=r?r.id:undefined;if(n.trace("handleCompositionChanged newGroupId: "+t+" windowId: "+i+" oldGroup: "+s),s===t)return void n.trace("handleCompositionChanged newGroupId: "+t+" windowId: "+i+" oldGroup: "+s+" are the same - returning...");var c=o["default"].get(i)||o["default"].get(i),u=addWindow(c,t);r&&(removeWindow(c,s),a.execute("window-moved",i,r,t)),c.Events.handleGroupChanged(u.groupAPI,r)}var n=t.subLogger("groups"),a=i(),s={},c=o["default"].list;return Object.keys(c).forEach(function(e){addNewWindow(c[e])}),e.onCompositionChanged(function(e){handleCompositionChanged(e)}),e.onGroupHeaderVisibilityChanged(function(e){var t=e.windowId,n=findGroupByWindow(t);if(void 0!==n){s[n.id].groupInternal.handleGroupHeaderVisibilityChanged(e)}}),o["default"].onAdded(function(e){addNewWindow(e)}),o["default"].onRemoved(function(e){removeWindow(e)}),{groupsAPI:{get my(){return my()},list:list,findGroupByWindow:findGroupByWindow},groupsEvents:{onWindowMoved:onWindowMoved}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=n(71),o=n(77),a=n(3);t["default"]=function(e,t,n,s){function ready(){return f}function my(){var e=a["default"].getIfReady(u.my());return e?e.API:undefined}function open(e,t,n,i,r){return new Promise(function(o,s){var c=function(e){"function"==typeof r&&r(e),s(e)},d=function(e){a["default"].waitFor(e).then(function(e){"function"==typeof i&&i(e),o(e)})["catch"](c)};u.open(e,t,n,d,c)})}function find(e,t,n){var i=a["default"].list,r=Object.keys(i).reduce(function(t,n){var r=i[n];return r&&r.API.name===e&&t.push(r.API),t},[]);if("function"!=typeof t)return r[0];r.length>0?t(r[0]):"function"==typeof n&&n("There is no window with name:"+e)}function findById(e,t,n){var i=a["default"].list,r=Object.keys(i).reduce(function(t,n){var r=i[n];return void 0!==r&&r.API.id===e&&t.push(r.API),t},[]);if("function"!=typeof t)return r[0];r.length>0?t(r[0]):"function"==typeof n&&n("There is no window with such id:"+e)}function list(e){var t=a["default"].list,n=Object.keys(t).map(function(e){return t[e].API});if("function"!=typeof e)return n;e(n)}function windowAdded(e){return d.add("window-added",e)}function windowRemoved(e){return d.add("window-removed",e)}function tabAttached(e){return f.then(function(){u.tabAttached(e)})}function tabDetached(e){return f.then(function(){u.tabDetached(e)})}function onWindowFrameColorChanged(e){return f.then(function(){return u.onWindowFrameColorChanged(e)})}function onWindowGotFocus(e){var t;return f.then(function(){t=u.onWindowGotFocus(e)}),function(){t&&t()}}function onWindowLostFocus(e){var t;return f.then(function(){t=u.onWindowLostFocus(e)}),function(){t&&t()}}function onEvent(e){var t,n=!1;return f.then(function(){n||(t=u.onEvent(e))}),function(){n=!0,t&&t()}}function handleWindowAdded(e){d.execute("window-added",e.API)}function handleWindowRemoved(e){d.execute("window-removed",e.API)}var c,u,d=i(),p=t;a["default"].init(p);var f=new Promise(function(t,i){r["default"](e,p,n,s).then(function(e){u=e,c=o["default"](e,p),t()})["catch"](function(e){var t="Environment detector fails with: "+e;p.error(t),i(t)})});return a["default"].onReadyWindow(handleWindowAdded),a["default"].onRemoved(handleWindowRemoved),{my:my,open:open,find:find,findById:findById,list:list,ready:ready,onWindowAdded:windowAdded,windowAdded:windowAdded,onWindowRemoved:windowRemoved,windowRemoved:windowRemoved,onTabAttached:tabAttached,onTabDetached:tabDetached,onWindowFrameColorChanged:onWindowFrameColorChanged,get groups(){return c.groupsAPI},onWindowGotFocus:onWindowGotFocus,onWindowLostFocus:onWindowLostFocus,onEvent:onEvent}}}])});
//# sourceMappingURL=tick42-glue.min.js.map