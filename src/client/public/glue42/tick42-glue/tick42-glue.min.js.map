{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///tick42-glue.min.js","webpack:///webpack/bootstrap 7dd767f6dfa5f38960ac","webpack:///./~/callback-registry/lib/index.js","webpack:///./src_js/activity/helpers/util.js","webpack:///./src_js/activity/contracts/entityEvent.js","webpack:///./src_js/windows/store.js","webpack:///./src_js/activity/helpers/logger.js","webpack:///./src_js/app-manager/const/agm-names.js","webpack:///./~/shortid/lib/alphabet.js","webpack:///./src_js/activity/entities/activityEntity.js","webpack:///./src_js/activity/helpers/promiseExtensions.js","webpack:///./src_js/activity/core/activityAGM.js","webpack:///./src_js/activity/entities/activityType.js","webpack:///./src_js/app-manager/helper.js","webpack:///./src_js/activity/bridges/hcBridge.js","webpack:///./src_js/activity/contracts/activityStatus.js","webpack:///./src_js/activity/entities/activity.js","webpack:///./src_js/activity/entities/activityWindow.js","webpack:///./src_js/activity/entities/windowType.js","webpack:///./src_js/activity/helpers/readyMarker.js","webpack:///./src_js/layouts/layout.js","webpack:///./src_js/layouts/store.js","webpack:///./src_js/layouts/transform.js","webpack:///./src_js/windows/environment/helpers.js","webpack:///./src_js/windows/window.js","webpack:///./src_js/glue.js","webpack:///./package.json","webpack:///./~/nanoid/format.js","webpack:///./~/object-assign/index.js","webpack:///./~/process/browser.js","webpack:///./~/shortid/index.js","webpack:///./~/shortid/lib/build.js","webpack:///./~/shortid/lib/generate.js","webpack:///./~/shortid/lib/index.js","webpack:///./~/shortid/lib/is-valid.js","webpack:///./~/shortid/lib/random/random-byte-browser.js","webpack:///./~/shortid/lib/random/random-from-seed.js","webpack:///./~/shortid/lib/util/cluster-worker-id-browser.js","webpack:///./~/tick42-glue-core/dist/web/tick42-glue-core.js","webpack:///./~/tick42-promisify/main.js","webpack:///(webpack)/buildin/global.js","webpack:///./src_js/activity/API/activityAPI.js","webpack:///./src_js/activity/API/activityManagementAPI.js","webpack:///./src_js/activity/API/activityMyAPI.js","webpack:///./src_js/activity/activityModule.js","webpack:///./src_js/activity/bridges/gw3Bridge.js","webpack:///./src_js/activity/core/activityManager.js","webpack:///./src_js/activity/core/localWindowFactory.js","webpack:///./src_js/activity/entities/attachedActivityDescriptor.js","webpack:///./src_js/activity/helpers/entityObservableCollection.js","webpack:///./src_js/activity/main.js","webpack:///./src_js/app-manager/app-manager.js","webpack:///./src_js/app-manager/application.js","webpack:///./src_js/app-manager/const/event-names.js","webpack:///./src_js/app-manager/data-subscription.js","webpack:///./src_js/app-manager/entitlements.js","webpack:///./src_js/app-manager/instance.js","webpack:///./src_js/app-manager/main.js","webpack:///./src_js/app-manager/snapshot.js","webpack:///./src_js/channels/agm.js","webpack:///./src_js/channels/channels.js","webpack:///./src_js/channels/contexts.js","webpack:///./src_js/channels/main.js","webpack:///./src_js/config.js","webpack:///./src_js/hotkeys/hotkeys.js","webpack:///./src_js/hotkeys/main.js","webpack:///./src_js/layouts/contextProvider.js","webpack:///./src_js/layouts/layouts.js","webpack:///./src_js/layouts/main.js","webpack:///./src_js/layouts/stream/acsStream.js","webpack:///./src_js/layouts/stream/nullStream.js","webpack:///./src_js/main.js","webpack:///./src_js/utils.js","webpack:///./src_js/windows/environment/detector.js","webpack:///./src_js/windows/environment/gd/executor.js","webpack:///./src_js/windows/environment/gd/gd.js","webpack:///./src_js/windows/environment/hc/executor.js","webpack:///./src_js/windows/environment/hc/hc.js","webpack:///./src_js/windows/group.js","webpack:///./src_js/windows/groups.js","webpack:///./src_js/windows/main.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","createRegistry","options","add","key","callback","callbacksForKey","callbacks","push","allForKey","reduce","acc","element","index","length","execute","argumentsArr","_i","arguments","results","forEach","result","apply","undefined","err","_handleError","exceptionArtifact","errParam","Error","_userErrorHandler","msg","stack","errorHandling","console","error","clear","clearKey","isNumber","arg","isString","isObject","isArray","Array","toString","isUndefined","isUndefinedOrNull","isEmpty","prop","isFunction","constructor","some","array","predicate","first","ifNotUndefined","what","doWithIt","promisify","promise","successCallback","errorCallback","then","__extends","extendStatics","b","setPrototypeOf","__proto__","__","create","EntityEvent","entitiy","context","entity","EntityEventContext","eventType","type","ActivityStatusChangeEventContext","_super","newStatus","oldStatus","_this","EntityEventType","StatusChange","ActivityContextChangedEventContext","updated","removed","ActivityContextChange","JSON","parse","Added","Removed","Updated","Closed","ActivityWindowEvent","ActivityWindowJoinedActivity","ActivityWindowLeftActivity","ActivityState","Created","Started","Destroyed","CallbackFactory","WindowStore","waitForTimeoutInMilliseconds","_windows","_pendingWindows","_pendingWindowsStates","_registry","init","logger","_logger","id","getIfReady","window","API","remote","windowType","ready","urlChanged","remove","setReadyState","windowId","targetWindowState","markReadyToShow","setUrlChangedState","waitFor","Promise","resolve","reject","un","timeout","setTimeout","win","clearTimeout","onReadyWindow","w","onAdded","onRemoved","util","LogLevel","Trace","Debug","Info","Warn","Logger","_name","GlueLogger","_glueLogger","subLogger","GetNamed","Get","owner","GetTypeName","trace","message","Level","info","_getMessage","debug","warn","level","funcNameRegex","exec","ShutdownMethodName","FeedackMethodName","GetConfigurationRegionMethodName","SetConfigurationRegionMethodName","GetUserMethodName","GetBranchesMethodName","GetCurrentBranchMethodName","SetCurrentBranchMethodName","GetFunctionalEntitlementMethodName","CanIMethodName","StartApplicationMethodName","StopApplicationMethodName","ActivateApplicationMethodName","RunApplicationMethodName","OnEventMethodName","GetApplicationsMethodName","reset","shuffled","setCharacters","_alphabet_","alphabet","ORIGINAL","unique","split","filter","item","ind","arr","lastIndexOf","join","characters","setSeed","seed","randomFromSeed","previousSeed","shuffle","characterIndex","sourceArray","targetArray","r","nextValue","Math","floor","splice","getShuffled","lookup","ActivityEntity","_id","_update","other","_updateCore","_beforeDelete","nodeify","resp","nextTick","cb","util_1","ActivityAGM","activity","_activity","register","definition","handler","_ensureHasAgm","AGM","servers","windows","map","instance","methods","methodNames","methodsForWindow","currentWindowMethod","indexOf","methodsForInstance","invoke","methodName","target","success","activityServers","potentialTargets","server","firstElem","_isInstance","_isActivityWindow","unregister","createStream","methodDefinition","subscriptionAddedHandler","subscriptionRemovedHandler","subscriptionRequestHandler","subscribe","parameters","obj","application","activityEntity_1","ActivityType","ownerWindow","helperWindows","description","_description","_ownerWindow","_helperWindows","initiate","configuration","_manager","x","objectValues","source","keys","objectClone","stringify","entityEvent_1","activityStatus_1","activityType_1","windowType_1","activity_1","activityWindow_1","logger_1","readyMarker_1","HCBridge","agm","appManagerGetter","mode","typesToTrack","_activityTypeEntityName","_windowTypeEntityName","_activityEntityName","_windowEntityName","_lastSeq","_eventQueue","_activityTypeCallbacks","_windowTypeCallbacks","_activityCallbacks","_windowCallbacks","_agm","_appManagerGetter","_mode","_typesToTrack","_hcToJsActivityType","hcActType","ownerWindowType","helperWindowTypes","_getURLParameter","decodeURIComponent","RegExp","location","search","replace","joinActivity","activityId","leaveActivity","_readyMarker","ReadyMarker","_htmlContainer","htmlContainer","activityFacade","subscribeForJoinBreakEvents","e","_handleGenericEvents","initFunc","init2","jsAgmInstance","glueVersion","_hcEventHandler","bind","signal","initReady","setCallback","getError","event","_processEventBySeq","eventJson","seq","sequence","_processEvent","nextEvent","genericEvent","_processGenericEvent","entityType","eventContext","_convertContext","contextUpdateRaceFixed","getActivities","activities","activityInEvent","_hcToJsActivity","contextAsString","hackEventContext","_publishActivityStatusChange","_publishActivityTypeStatusChange","_hcToJsWindowType","_publishWindowTypeStatusChange","_hcToJsWindow","_publishActivityWindowEvent","data","_activitiesAttachedHandler","_activitiesDetached","_activityAttachedDescriptorsRefreshed","hcContext","ActivityStatus","state","statusMessage","statusTime","newContext","hcAct","status","hcWinType","factories","_appByWindowTypeGetter","wt","applications","app","activityWindowType","getActivityTypes","infos","registerActivityType","activityTypeName","layoutConfig","config","newActivityType","unregisterActivityType","getWindowTypes","registerWindowFactory","windowTypeName","initiateActivity","activityType","getAnnouncementInfo","hc","getContext","activityWindowId","activityWindowIndependent","activityWindowName","announceWindow","activitiesStr","act","updateActivityContext","fullReplace","removedKeys","setActivityContext","newContextString","getActivityWindows","getWindows","wind","stopActivity","unregisterWindowFactory","createWindow","windowDefinition","objToSend","functionToUse","createWindow2","newId","createStackedWindows","windowDefinitions","createStackedWindows2","onActivityTypeStatusChange","onWindowTypeStatusChange","onActivityStatusChange","onActivityWindowChange","getWindowBounds","bounds","setWindowBounds","registerWindow","independent","closeWindow","activateWindow","focus","setWindowVisibility","visible","cloneActivity","_publishStatusChange","entityEvent","at","attachActivities","from","to","tag","detachActivities","newActivityInfo","newActivityId","onActivitiesAttached","onActivitiesDetached","onActivityAttachedDescriptorsRefreshed","getAttachedDescriptors","hcWindow","windowGetter","hcWindowId","list","isIndependent","time","getState","getMessage","getTime","activityAGM_1","attachedActivityDescriptor_1","promiseExtensions_1","Activity","actType","ownerId","_actType","_status","_context","_ownerId","getActivityType","addWindow","addWindowToActivity","windowTypes","leave","leaveWindowFromActivity","getWindowsByType","setContext","updateContext","onStatusChange","subscribeActivityEvents","a","ns","os","onWindowEvent","subscribeWindowEvents","onContextChanged","subscribeActivityContextChanged","stop","clone","attach","onActivityAttached","subscribeActivitiesAttached","newActId","oldActId","descriptor","onDetached","subscribeActivitiesDetached","newAct","originalActivity","_updateDescriptors","allStates","_attached","AttachedActivityDescriptor","setFrameColor","color","callbacksToWait","underlyingWindow","getFrameColor","frameColor","ActivityWindow","_type","_activityId","_instance","_isIndependent","_windowGetter","_hcWindowId","getBounds","getWindowType","getActivityById","setVisible","isVisible","activate","setBounds","close","onActivityJoined","_subscribeForActivityWindowEvent","onActivityRemoved","eventName","WindowType","appByWindowTypeGetter","assign","signalsToWait","_signals","_callbacks","isSet","isError","_error","LayoutImpl","components","metadata","LayoutStore","layouts","removeWhere","condition","where","transformACSLayout","something","initial","accumulator","current","convertedValue","toLowerCase","substr","getWindowsByTabGroupId","tabGroupId","store_1","memo","callback_registry_1","executor","resultWindow","navigate","newUrl","_url","onUrlChanged","url","setStyle","style","setTitle","newTitle","moveResize","dimensions","areHeightsEqual","height","_bounds","areWidthsEqual","width","areLeftsEqual","left","areTopsEqual","top","onBoundsChanged","addFrameButton","buttonInfo","buttonId","imageBase64","removeFrameButton","maximizeRestore","currEvent","_windowState","onMaximized","onNormal","maximize","restore","minimize","onMinimized","collapse","isCollapsed","onCollapsed","expand","onExpanded","toggleCollapse","snap","direction","attachTab","tab","sourceWindowId","targetWindowId","errorMessage","argsForSend","sourceWin","onAttached","detachTab","opt","_options","relativeTo","relativeDirection","hideTabHeader","visibilityChangeHeard","detachedHeard","unVisibility","isVisibilityCorrect","isTabHeaderVisible","unDetached","toBeVisible","_isVisible","onVisibilityChanged","showLoader","loader","hideLoader","lock","unlock","getIcon","icon","setIcon","base64Image","setTabHeaderVisible","toBeTabHeaderVisible","_isTabHeaderVisible","onTabHeaderVisibilityChanged","onTitleChanged","title","onClose","onFrameButtonAdded","onFrameButtonRemoved","onFrameButtonClicked","onContextUpdated","onLockingChanged","onFocusChanged","onFrameColorChanged","onWindowAttached","onWindowDetached","onGroupChanged","onTabSelectionChanged","handleTitleChanged","_title","handleUrlChanged","handleVisibilityChanged","handleWindowSettingsChanged","settings","_settings","handleContextUpdated","handleWindowClose","handleFrameButtonAdded","frameButton","buttonObj","k","_frameButtons","btn","handleFrameButtonRemoved","frameButtonId","button","handleFrameButtonClicked","handleWindowChangeState","handleFrameIsLockedChanged","isLocked","_isLocked","handleBoundsChanged","handleFocusChanged","isFocused","_focus","handleFrameColorChanged","_frameColor","handleFrameAttached","_tabGroupId","handleCompositionChanged","neighbours","groupId","_neighbours","_groupId","handleGroupHeaderVisibilityChanged","isGroupHeaderVisible","_isGroupHeaderVisible","handleTabHeaderVisibilityChanged","handleFrameSelectionChanged","newWindow","prevWindow","selectedWindow","_isTabSelected","previousWindow","un_1","newWin","prevWin","handleAttached","newTabGroupId","tabHeaderVisible","handleWindowAttached","handleDetached","handleWindowDetached","handleGroupChanged","newGroup","oldGroup","_group","handleGroupAssociation","group","getAllTabs","allWindows","mapWindowIdsToWindowObjects","windowIdArr","winId","getNeighboursByDirection","windowIds","getApplicationName","_APPLICATION_NAME","_t42","getWindowInfo","applicationName","glue42gd","isTabSelected","appManager","hostInstance","agmInstance","appName","windowStyleAttributes","frameButtons","opened","topNeighbours","leftNeighbours","rightNeighbours","bottomNeighbours","tabs","Events","tick42_glue_core_1","main_1","main_2","main_3","main_4","main_5","main_6","pjson","config_1","utils_1","createWindows","core","glueConfig","windowsLogger","getLibLogger","_appManager","gdMajorVersion","debugLog","createActivities","ActivityModule","checkIsUsingGW3Implementation","connection","activityLogger","contexts","logLevel","disableAutoAnnounce","disposeRequestHandling","announcementInfo","activityInfo","api","createAppManager","createLayouts","lay","activityGetter","createChannels","channels","channelsAPI","createHotkeys","hotkeysAPI","loggerName","newLogger","loggerConfig","consoleLevel","publish","publishLevel","metrics","metricsLevel","entry","currentLog","getGDMajorVersion","gateway","ext","libs","version","enrichGlue","glue","glueFactoryLog","main","browser","types","docName","scripts","init-dev-mode","remove-installed-dependencies","clean","file-versionify","pre:build","tslint","tslint:fix","watch","build:dev","prepublish","build:prod","test","test:only","generate-docs","repository","author","license","dependencies","callback-registry","es6-promise","object-assign","shortid","tick42-glue-core","tick42-promisify","devDependencies","@types/node","@types/object-assign","@types/shortid","chai","glue-js-documentation-builder","mocha","onchange","pre-commit","readline-sync","shelljs","tick42-gateway","tick42-webpack-config","typescript","webpack","bundleDependencies","random","size","mask","log","LN2","step","ceil","bytes","byte","toObject","val","TypeError","getOwnPropertySymbols","propIsEnumerable","propertyIsEnumerable","test1","String","getOwnPropertyNames","test2","fromCharCode","test3","letter","symbols","defaultSetTimout","defaultClearTimeout","runTimeout","fun","cachedSetTimeout","runClearTimeout","marker","cachedClearTimeout","cleanUpNextTick","draining","currentQueue","queue","concat","queueIndex","drainQueue","len","run","Item","noop","process","args","env","argv","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","build","clusterWorkerId","str","seconds","Date","now","REDUCE_TIME","previousSeconds","counter","generate","number","done","loopCounter","format","pow","seedValue","worker","workerId","newCharacters","isValid","isShortId","randomByte","crypto","msCrypto","getRandomValues","Uint8Array","getNextValue","_seed_","DEFAULT","STRING","NUMBER","COUNT","RATE","STATISTICS","TIMESTAMP","ADDRESS","TIMESPAN","OBJECT","validate","parent","transport","convertInfoToInstance","ApplicationName","environment","Environment","machine","MachineName","pid","ProcessId","region","Region","service","ServiceName","user","UserName","started","ProcessStartTime","isStreamingFlagSet","flags","isNaN","convertInstance","g","Function","eval","default_1","ServerSubscription","protocol","repoMethod","subscription","stream","branchKey","closeSingleSubscription","pushDataToSingle","ContextMessageReplaySpec","GW_MESSAGE_CREATE_CONTEXT","GW_MESSAGE_ACTIVITY_CREATED","GW_MESSAGE_ACTIVITY_DESTROYED","GW_MESSAGE_CONTEXT_CREATED","GW_MESSAGE_CONTEXT_ADDED","GW_MESSAGE_SUBSCRIBE_CONTEXT","GW_MESSAGE_SUBSCRIBED_CONTEXT","GW_MESSAGE_UNSUBSCRIBE_CONTEXT","GW_MESSAGE_DESTROY_CONTEXT","GW_MESSAGE_CONTEXT_DESTROYED","GW_MESSAGE_UPDATE_CONTEXT","GW_MESSAGE_CONTEXT_UPDATED","GW_MESSAGE_JOINED_ACTIVITY","global","Utils","glueDesktop","ver","Number","isNode","docs","test:core","test:agm","test:bus","util-deprecate","ws","archiver","babel-core","babel-loader","babel-plugin-add-module-exports","babel-preset-es2015","babel-preset-stage-2","deep-equal","ConnectionImpl","messageHandlers","ids","registry","_connected","_protocol","_transport","onConnectedChanged","handleConnectionChanged","onMessage","handleTransportMessage","send","product","isObjectBasedTransport","createObjectMessage","sendObject","strMessage","createStringMessage","messageHandler","connected","http","disconnected","login","authRequest","open","logout","loggedIn","protocolVersion","toAPI","that","distributeMessage","handlers","handlerId","msgObj","processStringMessage","processObjectMessage","msgType","dummyConnection_1","timer_1","dummyConnection_2","contextMessageReplaySpec_1","GlueCore","userConfig","registerLib","inner","t","initStartTime","startTime","initTime","initEndTime","endTime","setupConnection","initTimer","internalConfig","_connection","authPromise","auth","getGWToken","token","gatewayToken","authConfig","identity","setupMetrics","_rootMetrics","_metrics","subSystem","_featureMetric_1","reportingSystem_1","def_1","conflation","featureMetric","action","payload","update","objectMetric","setupAGM","agmConfig","forceGW","force","gdVersion","agmLib","setupContexts","hasActivities","_contexts","ContextsModule","replayer","drain","setupExternalLibs","externalLibs","lib","setupExternalLib","createCallback","waitForLibs","libsReadyPromises","all","constructGlueObject","feedbackFunc","glueInitTimer","feedback","performance","timing","toJSON","memory","initTimes","period","perfDataNeeded","updatePerfData","delay","perfDataDelay","extOptions","setupBus","bus","busSettings","busLib","_bus","getConnection","setupLogger","uri","protocols","opts","WebSocket","MozWebSocket","client_1","server_1","AGMImpl","clientRepository","serverRepository","client","serverRemoved","serverAdded","serverMethodRemoved","serverMethodAdded","methodRemoved","methodAdded","methodFilter","method","streamDef","registerAsync","argumentObj","additionalOptions","updateInstance","newInstance","invoke_1","promisify_1","Client","repo","clientInvocations","callProtocolSubscribe","targetServers","successProxy","errorProxy","methodResponseTimeout","waitTimeoutMs","methodDef","sub","method_response_timeout","wait_for_method_timeout","delayTillNow","currentServers","getServerMethodsByFilterAndTarget","retry_1","streamInfo","def","getInfoForUser","protocolState","getServers","serverMethodMap","getMethods","getMethodsForInstance","onMethodAdded","onMethodRemoved","onServerAdded","onServerRemoved","reason","onServerMethodAdded","onServerMethodRemoved","methodResponseTimeoutMs","serversMethodMap","invokeUnExisting","serverMethodPair","invokeOnAll","callError","called_with","executed_by","returned","delayTillNow_1","retry_2","serverMethodsMap","successes","errors","sendResponse","result_1","invResult","all_return_values","all_errors","currentError","serverMethodsPair","filterByTarget","targetServerMethod","matchingMachine","matches","myMatches","instanceMatch","instanceFilter","instanceDefinition","containsProps","methodMatch","match","allServers","matchingServers","resultMethodsObject","methodKey","prev","methodsForServer","getServerMethodsById","matchingMethods","random_1","ClientInvocations","_pendingCallbacks","onInvocationResult","invocationId","executedBy","resultMessage","processInvocationResult","argumentsObj","stuff","registerInvocation","calledWith","invocationInfo","ClientRepository","methodsCount","addServer","serverId","serverEntry","serverInfo","createUserServerInfo","getStreams","supportsStreaming","removeServerById","methodId","removeServerMethod","addServerMethod","createMethodId","methodEntity","createUserMethodInfo","getServersByMethod","methodInfo","accepts","returns","allMethods","unsubscribeFunc","getServerById","peerId","displayName","objectTypes","object_types","display_name","NativeAGM","helpers","agmFacade","methodInfoAsObject","stringToObject","validateMethodInfo","caller","methodResult","tracker","successArgs","targetArgToObject","invoke2","parsed","createStream2","subscribe2","jsonResult","agmParse","transformServerObject","transformMethodObject","subscribed","Helpers","facade","dateTimeIdentifier","jsonValueDatePrefix","lenOfIdentifier","v","unixTimestampMs","parseFloat","convertInstanceToRegex","serverFilter","instanceConverted","propValue","param","stringPropName","jsAgmFacade","cfgAsString","createConfig","successInit","nativeAGM","agm_1","helpers_1","create_stream","methods_for_instance","method_added","method_removed","server_added","server_removed","server_method_added","server_method_removed","initAsync","metricsIdentity","metricsConfig","path","createOwnInstance","userSubmittedProperties","resolvedIdentity","document","instance_1","native_1","factory_1","factory_2","repository_1","repository_2","protocolPromise","agmImpl","myIdentity","myInstance","ClientStreaming","sendRequest","nextResponseSubject","subscriptionsList","ERR_MSG_SUB_FAILED","subscriptionId","pendingSub","registerSubscription","responseSubject","requestSubject","trackedServers","streamId","streamSubjects","private","methodRequestSubject","methodResponseSubject","EventStreamAction","MethodRequestSubject","MethodResponseSubject","Context","ArgumentsJson","InvocationId","MethodName","ExecutionServer","Timeout","processPublisherMsg","serverIsKickingASubscriber","serverAcknowledgesGoodSubscription","serverHasPushedSomeDataIntoTheStream","onData","onClosed","queued","closers","timeoutId","closersCount","closingServer_1","requestArguments","deletionsList","isRejecting","isKicking","StreamId","EventStreamSubject","ResultMessage","callArgs","Server","acceptingServer","isFirstResponse","privateStreamSubject","generatePrivateStreamSubject","confirmatoryRequest","dataCallback","dataItem","closedCallback","onFailed","closeSubscription","serverInstance","this_1","isPrivateData","trackedServersFound","ls","receivedStreamData_1","ResultContextJson","onDataHandlers","queuedData","subId","client_streaming_1","ClientProtocol","respCounter","timers","streaming","listenForEvents","createServerInfo","createMethod","Method","Name","InputSignature","ResultSignature","Description","DisplayName","Version","ObjectTypeRestrictions","Flags","createServerId","processServerPresence","presence","isPresence","Instance","PublishingInterval","scheduleTimeout","MethodDefinitions","updateServerMethods","duration","timer","newMethods","oldMethods","newMethodsReduced","nm","handleInvokeResultMessage","Status","getAGM","unsubscribe","ServerStreaming","isStreamMsg","pushData","streamingMethod","branches","branchKeyToStreamIdMap","streamIdList","br","Boolean","sendResult","globalEventStreamSubject","closeAllSubscriptions","streamList","getBranchList","getUniqueBranchNames","getSubscriptionList","subscriptions","onSubAdded","handlerFunc","subAddedHandler","onSubRemoved","subRemovedHandler","onSubRequest","requestHandler","generateNewStreamId","streamingMethodName","rejectRequest","requestContext","MethodVersion","privateEventStreamSubject","closeIndividualSubscription","acceptRequestOnBranch","branch","getStreamId","processSubscriberMsg","clientWishesToSubscribe","clientWishesToUnsubscribe","clientAcknowledgesItDidSubscribe","clientPerSubHeartbeat","getBranchKey","needle","needleBranch","sendKickMessage","subItem","initialLength","ResponseContextJson","keysWithDuplicates","seen","bKey","server_streaming_1","HeartbeatInterval","ServerProtocol","invocationMessagesMap","reqCounter","handleMethodInvocationMessage","stopTimers","sendHeartbeat","heartbeatTimer","setInterval","clearInterval","presenceTimer","sendPresence","reqSubj","nextRequestSubject","createNewMethodMessage","announceNewMethod","streamConverted","onInvoked","methodInvocationResult","executedMethod","constructHeartbeat","constructPresence","getList","subject","methodList","invocationArgs","methodIdentifier","STATUS_AWAITING_ACCEPT","STATUS_SUBSCRIBED","ERR_MSG_SUB_REJECTED","session","subscriptionIdToLocalKeyMap","nextSubLocalKey","handleErrorSubscribing","errorResponse","_tag","subLocalKey","callOnClosedHandlers","handleSubscribed","subscription_id","handleEventData","oob","snapshot","sendingServerId","receivedStreamData","handleSubscriptionCancelled","expectedNewLength","getNextSubscriptionLocalKey","server_id","method_id","arguments_kv","closingServerId","closingServer","sendFireAndForget","reason_uri","handlePeerAdded","handlePeerRemoved","handleMethodsAddedMessage","handleMethodsRemovedMessage","handleResultMessage","handleInvocationError","newPeerId","new_peer_id","remoteId","removedPeerId","removed_id","input_signature","result_signature","methodIdList","libConfig","handleReconnect","registeredMethods","theFunction","userCallback","userCallbackAsync","handleInitialJoin","resolveReadyPromise","readyPromise","domain","onJoined","reconnect","ERR_URI_SUBSCRIPTION_FAILED","nextStreamId","handleAddInterest","handleRemoveInterest","subscriptionsMap","subscribeMsg","stream_id","sendSubscriptionFailed","publishMessage","postMessage","dropSubscriptionMessage","closeMultipleSubscriptions","subscriptionsToClose","drop","allSubscriptions","onSubscriptionLifetimeEvent","getById","getNextStreamId","caller_id","errorMsg","request_id","__awaiter","thisArg","_arguments","P","generator","fulfilled","next","rejected","__generator","body","verb","op","f","_","y","label","ops","pop","trys","sent","throw","return","Symbol","iterator","handleInvokeMessage","isStreaming","registerMsg","_a","registrationCallbacks","fail","repoId","restrictions","handleRegisteredMessage","handleErrorRegister","peer_id","invocation_id","callerId","subscription_1","ServerBranch","ServerRepository","nextId","Request","accept","acceptOnBranch","__assign","streaming_1","stream_1","invocations","onMethodInvoked","wrappedCallbackFunction","resultCallback","registerCore","wrappedCallback","serverMethod","request","streamCallbacks","streamFrontObject","forStream","methodToBeRemoved","unregisterWithPredicate","find","removeMethodsOrStreams","filterPredicate","methodsOrStreamsToRemove","sm","methodsToRemove","filterProps","methodDefProps","Set","isMatch","filterValue","methodDefValue","firstObjType","sort","secondObjTypes_1","hasADifference","objType","methodToExecute","unStrException","_result","branch_1","ServerStream","bList","def2","request_1","rc","rm","handleSubRequest","handleSubAdded","handleSubRemoved","protocol_1","successMessages","Protocol","watchOnEvent","topic","_b","routingKey","_c","removeEmptyValues","routing_key","target_identity","response","keysMatch","cleaned","obj1","obj2","keysObj1","allMatch","getApplication","getConfigProp","prop1","prop2","masterConfigProp1","masterConfig","userProp1","dynamicDefaultsProp1","dynamicDefaults","hardDefaultsProp1","hardDefaults","ifNotFalse","uid","shortid_1","GLUE_CONFIG","GLUE_DEFAULT_CONFIG","containerName","browserWindowName","agm_application","documentTitle","system","metricsFacade","getIdentity","machineName","defaultProtocol","defaultWs","gwURL","reconnectInterval","gwConfig","reconnectAttempts","inproc","CLOSING","replaySpecs","gw","connectionConfig","contextConfig","contextsEnabled","channelsConfig","connection_1","messageReplayer_1","GW3ConnectionImpl","MessageReplayerImpl","gw3Protocol","superAPI","availableDomains","authToken","errorMessages","gw3_1","hc_1","ws_1","gw3Connection_1","gw1_1","hc_2","inproc_1","gw3Connection","gw3Port","specs","specsNames","messages","subs","subsRefCount","specs_1","spec","name_1","refCount","processMessage","isDone","name_2","GW1Protocol","messageObj","sendOptions","retryInterval","maxRetries","dateMinLen","datePrefixFirstChar","substring","datePrefixLen","datePrefix","milliseconds","parseInt","ex","oldToJson","loginConfig","username","password","shouldTryLogin","authentication","secret","helloMsg","globalDomain","gw3Domain_1","skipPeerId","initialLogin","resolved_identity","available_domains","access_token","setLoggedIn","pingTimer","sessions","isLoggedIn","domainName","domainLogger","handleDisconnected","initialLoginAttempts","ping","createTokenReq","res","_latestOptions","isJoined","joinPromise","_connectionOn","destination","handleJoined","wasReconnect","tryReconnecting","handleConnectionDisconnected","handleConnectionLoggedIn","onLeft","handleErrorMessage","requestId","requestsMap","handleSuccessMessage","getNextRequestId","successMsg","callbackRegistry","HCProtocol","HCTransport","connectionId","loggingFacade","Inproc","gwToken","connectToken","connect","WS","_running","_initied","waitForSocketConnection","_ws","initiateSocket","onerror","notifyStatusChanged","onclose","onopen","onmessage","failed","retriesLeft","readyState","retries","gw3ContextData_1","GW3Bridge","_contextNameToData","_gw3Subscriptions","_nextCallbackSubscriptionNumber","_contextNameToId","_contextIdToName","_gw3Session","subscribeToContextCreatedMessages","subscribeToContextUpdatedMessages","subscribeToContextDestroyedMessages","handleContextCreatedMessage","handleContextUpdatedMessage","handleContextDestroyedMessage","dispose","contextName","createContext","lifetime","createContextMsg","context_id","contextData","GW3ContextData","isAnnounced","contextId","sentExplicitSubscription","invokeUpdateCallbacks","delta","calculatedDelta","calculateContextDelta","added","gwResponse","handleUpdated","updaterId","set","thisCallbackSubscriptionNumber","updateCallbacks","hadCallbacks","hasCallbacks","joinedActivity","sendSubscribe","subscriptionKey","sendUnsubscribe","extraData","oldContext","applyContextDelta","deepEqual","createdMessageTypes","createdMessageTypes_1","createdMessageType","contextCreatedMsg","activity_id","updatedMessageTypes","updatedMessageTypes_1","updatedMessageType","contextUpdatedMsg","justSeen","context_snapshot","updater_id","updateCallbackIndex","updateCallback","deepClone","destroyedMessageTypes","destroyedMessageTypes_1","destroyedMessageType","destroyedMsg","_facade","sharedContextFacade","allObj","gw3Bridge_1","hcBridge_1","_bridge","checkName","added_1","updated_1","mergeObjectsProperties","hash","WeakMap","has","Map","withWhat","right","contextsModule_1","canPublish","restriction","order","levels_1","LoggerImpl","metricSystem","_subloggers","_parent","_path","_loggerFullName","existingSub","_publishLevel","_consoleLevel","metricsSystem","_metricLevel","_metricSystem","toAPIObject","slice","toPrint","GetConnection","Message","Time","setState","identityStr","mainLogger","glue_1","addressMetric","newValue","_value","updateMetric","me","getValueType","resolution","metric_types_1","createMetric","countMetric","incrementBy","num","increment","decrement","decrementBy","numberMetric","mergeValues","values","rateMetric","statisticsMetric","stringMetric","timespanMetric","start","timestampMetric","sendFull","subSystems","sendFullSystem","createSystem","metric","heartbeat","publishingInterval","heartbeatInterval","updateSystem","serializer_1","instanceInfo","metricToMessage","getMetricDefinition","_definition","getTypeFromValue","Composite","serializeValue","_metric","_valueTypes","valueOf","CompositeValue","InnerMetricName","valueType","rootStateMetric","composite","Value","defineRootMetricsMsg","replayRepo","replaySystem","ss","normalizeMetricName","createMetricsMsg","shadowedUpdateMetric","timestamp","stateObj","composeMsgForRootStateMetric","rootMetric","serializeMetric","getMetricValueByType","publishMetricsMsg","getMetricTypeByValue","getTypeByValue","serializedMetrics","innerType","defineNestedComposite","publishNestedComposite","flatten","flat","toFlatten","getHighestState","aggregateDescription","idx","aggregatedState","getAggregateState","merged","highestState","clickStream","_root","system_1","rootSystem","useClickStream","navigator","userAgent","clickStream_1","documentClickHandler","className","tagName","href","page","addEventListener","attachEvent","urlMetric","appNameMetric","startUrl","nameSystem","descriptionSystem","_subSystems","_system","_repo","stateDescription","_state","_getOrCreateMetric","metricDef","string_1","number_1","count_1","address_1","object_1","timespan_1","timestamp_1","rate_1","statistics_1","_unionToMetricDef","metricDefinition","expectedType","matching","shadowedMetric","existing","_buildPath","shadowedSystem","aggState","shadowedSubSystem","separator","activityManagementAPI_1","ActivityAPI","manager","my","_mgr","_my","ActivityManagementAPI","aware","inActivity","getAvailableFrameColors","frameColors","getFrameColors","_m","activityTypes","_getActivityTypesWrapper","subscribeActivityTypeEvents","_getWindowTypesWrapper","registerFactory","unregisterFactory","subscribeWindowTypeEvents","announce","instances","onActivityFrameColorChanged","subscribeActivityFrameColorChanged","ActivityMy","_myAttached","_myDetached","_myAttachedTo","_myDetachedFrom","_myActivityFrameColorChanged","_myActivityJoinedCallbacks","_myActivityRemovedCallbacks","_myContextUpdateCallbacks","am","_subscribeMyContextChanged","_subscribeMyWindowEvent","_subscribeActivitiesAttached","_subscribeActivitiesDetached","onWindowFrameColorChanged","_subscribeWindowFrameColorChanged","_w","announcedWindows","myWin","onActivityLeft","onActivityDetached","onAttachedToActivity","onDetachedFromActivity","attached","myActivity","_notifyMyContextChanged","_notifyMyWindowEvent","callbackStore","_notifyAttached","_notifyDetached","_notifyAttachedTo","_notifyDetachedFrom","detached","oldAct","activityMyAPI_1","activityManager_1","activityAPI_1","bridge","_isUsingHCImplementation","_isUsingGW3Implementation","activityManager","_api","_readyPromise","_activityChangeCallbacks","_activityTypeStatusChangeCallbacks","_activityWindowChangeCallbacks","_windowTypeStatusChangeCallbacks","_peerIdAndFactoryIdToPeerType","_peerFactoriesRegisteredByUs","_contextSubscriptions","_activityTypesInitiatedFromMe","_config","_sessionJoinedPromise","_sessionJoinedPromiseResolve","_activityJoinedPromise","_activityJoinedPromiseResolve","activityTypeGwMessageEntityToActivityType","nameToWindowType","windowName","owner_type","helper_types","peerFactoryGwMessageEntityToWindowType","peer_type","activityGwMessageToActivity","activity_type","activityToActivityStatusChangeEvent","forwardActivityTypeMessagesToStatusEventHandlers","handleActivityCreatedMessage","handleActivityDestroyedMessage","forwardActivityMessagesToStatusEventHandlers","forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers","forwardPeerFactoryMessagesToStatusEventHandlers","forwardPeerFactoryMessagesToPeerFactoryRequests","handlePeerFactoriesAdded","handlePeerFactoriesRemoved","forwardActivityWindowMessagesToEventHandlers","exit","activity_types","toActivityPeerConfig","invokeCallbacks","factory_ids","initiateMsg","initial_context","isOverrideTypeDefinition","types_override","wd","sendCreateAndMapResultingMessagesToPromise","initMsg","removedKeys_1","shouldSendReady","generateWindowGetter","layout","cellSize","created_id","destroy_peer_id","URLSearchParams","searchParams","target_id","cloneOptions","into","merge","getRandomRequestId","forwardAddedAndRemovedMessagesToEventHandler","addedMessageType","removedMessageType","mapper","sub1","sub2","getGetEntityEvent","isAdded","forwardMessageToEventHandler","messageType","getEntityEvent","ent","h","initiatedMessageType","initiatedMessageFilter","createdMessageFilter","cancelledMessageType","cancelledMessageFilter","createdMessageToPromiseResolution","resolveCreatedPromise","rejectCreatedPromise","initiatedSubscription","createdSubscription","cancelledSubscription","errorSubscription","reqId","createdPromise","initiatedMessageAck","dropSubscriptions","dropSubscription","msg4","msg1","msg2","msg3","toReturn","peerFactoryIdAndOwnerIdToWindowType","factoryId","peerType","subscribeToContext","unsubscribeContext","owner_id","activityCreatedMessage","participants","createdMessage","peer_factory","gateway_token","joinedMessage","joinedId","joined_id","joinedType","joined_type","joinedName","joined_name","peer_name","left_id","entityObservableCollection_1","localWindowFactory_1","entityEvent_2","ActivityManager","autoAnnounce","_announcedWindows","_attachedCallbacks","_detachedCallbacks","_frameColorChangesCallbacks","_windowHandlers","_activityTypes","EntityObservableCollection","_grabEntity","_windowTypes","_activities","_dataReadyMarker","_descriptorsMarker","dataErr","errCatch","refreshDescriptors","_handleActivitiesAttached","_handleActivitiesDetached","_handleActivityDescriptorsRefreshed","_handleWindowFrameColorChanged","_subscribeForData","aw","_getInitialData","bridgeType","getByName","ownerDefinition","helperDefinitions","actId","getOrWait","factoryMethod","getName","LocalWindowFactory","currentWindow","windowEventHandler_1","unsubscribeWindowEvents","window_1","wrappingHandler","found","pair","windowTypeOrConfiguration","relativeToWindow","wid","relativeWindowTypes","relativeWindows","useExisting","activityWindows","alreadyCreated","removedKey","descriptors","stateWrapped","u","ac","descriptorAsObjectFromAPI","oldActivityId","createFunction","ownerActivityId","_ownerActivityId","detach","processNew","_items","_listeners","_processNew","addOne","items","internalEntity","_updateInternalCollections","_notifyListeners","entityAddedHandler","listener","entityAsAny","isActivityDestroy","isWindowClose","oldEntity","activityModule_1","application_1","AppManagerImpl","_gdMajorVersion","_apps","_instances","getMyInstance","instanceId_1","appInstanceId","myWindowId_1","matchingInstances","isActivityInstance","handleAppAdded","props","_getAppId","_updateAppFromProps","handleAppUpdated","handleAppRemoved","handleAppReady","_getAppOrThrow","updateFromProps","available","handleInstanceStarted","Id","_getInstanceId","_getInstanceAppName","_updateInstanceFromProps","handleInstanceStopped","_getInstanceOrThrow","_matchInstance","handleInstanceAgmServerReady","updateAgmInstanceFromProps","handleInstanceStartFailed","handleInstanceUpdated","onInstanceStarted","_replay","onInstanceStartFailed","onInstanceStopped","onInstanceUpdated","onInstanceAgmServerReady","onAppAdded","onAppRemoved","onAppAvailable","onAppUnavailable","onAppChanged","_getInstanceByIdAndName","itemsToReplay","itemsToReplayArr","AgmNames","helper_1","ApplicationImpl","_props","Title","AutoStart","IsShell","Caption","IsHidden","ActivityWindowType","Arguments","AllowMultiple","IsReady","Icon","IconUrl","SortOrder","UserProperties","autoStart","caption","hidden","container","allowMultiple","Type","Mode","isActivity","styleAttributes","WindowStyleAttributes","modeIndex","startModeIndex","stopModeIndex","createWindowArgs","waitForAGMReady","waitForAGMInstance","waitForInstance","waitForApplicationInstance","unsub","check","filtered","waitFunc","WaitForAgmInstance","WaitForInstance","acsResult","Instance_0","onAvailable","onUnavailable","onChanged","OnNotificationEvent","OnBranchChangedEvent","OnBranchesModifiedEvent","OnApplicationAddedEvent","OnApplicationRemovedEvent","OnApplicationChangedEvent","OnApplicationReadyEvent","OnApplicationStartedEvent","OnApplicationRegisteredEvent","OnApplicationAgmServerReadyEvent","OnApplicationUpdatedEvent","OnApplicationStoppedEvent","OnApplicationStartFailedEvent","createDataSubscription","entitlements","skipIcons","resolveFunc","rejectFunc","resultPromise","skipIcon","streamData","events","EventNames","handleBranchModified","handleBranchesModified","EntitlementsImpl","getRegion","_agmInvoke","getBranches","Branches","getCurrentBranch","Branch","setRegion","setCurrentBranch","currentUser","getFunctionalEntitlement","funct","Entitlement","getFunctionalEntitlementBranch","canI","func","Result","canIBranch","onBranchesChanged","onBranchChanged","transformFunction","errHandler","InstanceImpl","_app","startFailed","onAgmReady","_addToRegistry","onStopped","_unsubscribeInstanceStopped","_unsubscribeInstanceAgmServerReady","activityInstance","instWinCntx","activityIsOwner","activityOwnerInstance","_startUpContext","_isActivityInstance","_inActivity","_agmInstance","ActivityId","AgmServers","GD3","agmInstances","gdAgmServers","propsAgmServer","propsAgm","userName","app_manager_1","entitlements_1","snapshot_1","data_subscription_1","swId","command","channel","ChannelsImpl","shared","subsKey","changedKey","currentContext","switchChannel","changed","meta","onChannelAdded","onChannelRemoved","apps","channelId","SharedContextSubscriber","sharedContextName","createContextName","allContexts","startsWith","sharedContexts","contexts_1","channels_1","getLibConfig","defaultMode","trueMode","getModeAsString","HotkeysImpl","firstHotkey","hotkeys","hkToLower","hotkey","formatHotkey","registerInvokeAGMMethod","unregisterAll","isRegistered","hotkeys_1","ContextProvider","activitiesGetter","registeredRequestsMethods","onSaveRequested","registerRequestMethods","isActivityOwner","myWindow","requestResult","activityContext","windowContext","contextProvider_1","transform_1","layout_1","LayoutsAPIImpl","onEvent","provider","gotSnapshot","save","verifyNotSlimMode","ignoreHidden","layoutObject","actIds","appIds","ignoreLayoutRestrictions","isVisibleWindow","ignoreMyInstance","invokeMethodAndTrack","activityIdToJoin","restoreActivityOwner","ignoreActivityWindowTypes","closeRunningInstance","reuseWindows","t42","restoreOptions","activityToJoin","closeOldWindows","reuseExistingWindows","toClose","splash","getInstancesToClose","handleResult","getObjectValues","Layouts","rename","newName","oldName","updateMetadata","onRenamed","filterInstance","skipStreamEvent","agmResult","streamEventReceived","responseHandler","shellApp","isShell","shellApplicationName","acsStream","acsStream_1","layouts_1","ACSStream","resolveReady","rejectReady","resolveGotSnapshot","rejectGotSnapshot","noRetry","transform","checkForLayoutEventMethod","IsSnapshot","addLayouts","OnLayoutAdded","removeLayouts","OnLayoutRemoved","changeLayouts","OnLayoutChanged","renameLayouts","OnLayoutRenamed","streamEvent","Token","layoutsData","layoutData","removedLayouts","removedLayout","existingLayout","compareLayouts","changedLayouts","changedLayout","renamedLayouts","renamedLayout","layout1","layout2","Glue","gd_1","gd","hcPromise","gdPromise","race","ms","rej","objectAssign","GDExecutor","agmTarget","snappingEdge","dataURL","toShow","setGroupHeaderVisible","executor_1","GDEnvironment","wndId","_waitTimeout","normalizeInstance","_windowId","streamResolve","streamReject","updateWindow","copyOptions","windowState","tabAttached","tabDetached","onCompositionChanged","onGroupHeaderVisibilityChanged","onWindowGotFocus","onWindowLostFocus","windowInfo","extendedStreamEvent","getExtendedStreamEvent","windowInfoCreatedEvent","windowObjectAndEvents","theWindow","theWindowEvents","windowInfoBoundsChangedEvent","windowInfoUrlChangedEvent","windowInfoTitleChanged","windowInfoCompositionChanged","neighbors","groupHeaderVisible","windowInfoFocusChanged","focusChanged","frameId","winsToBeNotified_1","oldTabGroupId","winsToBeNotified_2","newWindowId","prevWindowId","windowObjAndEvents","mapToWindowConstructorOptions","isActiveTab","charAt","toUpperCase","HcExecutor","successHandler","errorHandler","conditionFunc","agmAction","isSame","eventToSubscribe","collapsed","subscribeFunc","styles","Hidden","enabled","base64ImageSource","stickyFrameColor","ignoreTimeout","agmInvoke","removeCallback_1","isResolved_1","cntName","oldFrameColor","windowTitle","parsedWsa","parseWindowStyleAttributes","WindowState","windowStyles","hcEnv","streamPromise","listWindowsPromise","listWndResolve","listWndReject","existingWindow","_windowsId","groupObject","removeWindow","window_2","_mapToWindowObject","mappedWindow","mappedWindows","_mapToWindowObjects","showHeader","hideHeader","isGroupHeaderVisibleCalled","winObjects","windowObject","_getGroupHeaderVisibility","onHeaderVisibilityChanged","onWindowAdded","onWindowRemoved","isHeaderVisible","groupAPI","groupInternal","group_1","findGroupByWindow","_groups","groupFound","onWindowMoved","createOrGetGroup","createdGroup","deleteGroup","addNewWindow","windowGroupId","newGroupId","oldGroupId","groupsAPI","groupsEvents","detector_1","groups_1","isReady","windowsForListing","findById","windowAdded","windowRemoved","unsubFunc","unsubscribed","handleWindowAdded","handleWindowRemoved","groups","onTabAttached","onTabDetached"],"mappings":"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","file":"tick42-glue.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"tick42-glue\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"tick42-glue\"] = factory();\n\telse\n\t\troot[\"tick42-glue\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"tick42-glue\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"tick42-glue\"] = factory();\n\telse\n\t\troot[\"tick42-glue\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 69);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\n;\r\ncreateRegistry.default = createRegistry;\r\nmodule.exports = createRegistry;\r\n//# sourceMappingURL=index.js.map\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\n// some small useful functions (so we don't reference underscore or lodash)\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction isNumber(arg) {\r\n    return typeof arg === \"number\";\r\n}\r\nexports.isNumber = isNumber;\r\nfunction isString(arg) {\r\n    return typeof arg === \"string\";\r\n}\r\nexports.isString = isString;\r\nfunction isObject(arg) {\r\n    return typeof arg === \"object\" && arg !== null;\r\n}\r\nexports.isObject = isObject;\r\nfunction isArray(arg) {\r\n    // TODO optimize\r\n    if (Array.isArray) {\r\n        return Array.isArray(arg);\r\n    }\r\n    return toString.call(arg) === \"[object Array]\";\r\n}\r\nexports.isArray = isArray;\r\nfunction isUndefined(arg) {\r\n    return typeof arg === \"undefined\";\r\n}\r\nexports.isUndefined = isUndefined;\r\nfunction isUndefinedOrNull(arg) {\r\n    return !arg || typeof arg === \"undefined\";\r\n}\r\nexports.isUndefinedOrNull = isUndefinedOrNull;\r\n/**\r\n *  Checks if an object is empty (has no properties)\r\n * @private\r\n */\r\nfunction isEmpty(arg) {\r\n    for (var prop in arg) {\r\n        if (arg.hasOwnProperty(prop)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nexports.isEmpty = isEmpty;\r\nfunction isFunction(arg) {\r\n    return !!(arg && arg.constructor && arg.call && arg.apply);\r\n}\r\nexports.isFunction = isFunction;\r\nfunction some(array, predicate) {\r\n    for (var index = 0; index < array.length; index++) {\r\n        if (predicate(array[index], index)) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nexports.some = some;\r\nfunction first(array, predicate) {\r\n    for (var index = 0; index < array.length; index++) {\r\n        if (predicate(array[index], index)) {\r\n            return array[index];\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\nexports.first = first;\r\nfunction ifNotUndefined(what, doWithIt) {\r\n    if (typeof what !== \"undefined\") {\r\n        doWithIt(what);\r\n    }\r\n}\r\nexports.ifNotUndefined = ifNotUndefined;\r\nfunction promisify(promise, successCallback, errorCallback) {\r\n    \"use strict\";\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { return; };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { return; };\r\n    }\r\n    promise.then(successCallback, errorCallback);\r\n}\r\nexports.promisify = promisify;\r\n//# sourceMappingURL=util.js.map\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar EntityEvent = /** @class */ (function () {\r\n    function EntityEvent(entitiy, context) {\r\n        this.entity = entitiy;\r\n        this.context = context;\r\n    }\r\n    return EntityEvent;\r\n}());\r\nexports.EntityEvent = EntityEvent;\r\nvar EntityEventContext = /** @class */ (function () {\r\n    function EntityEventContext(eventType) {\r\n        this.type = eventType;\r\n    }\r\n    return EntityEventContext;\r\n}());\r\nexports.EntityEventContext = EntityEventContext;\r\nvar ActivityStatusChangeEventContext = /** @class */ (function (_super) {\r\n    __extends(ActivityStatusChangeEventContext, _super);\r\n    function ActivityStatusChangeEventContext(newStatus, oldStatus) {\r\n        var _this = _super.call(this, EntityEventType.StatusChange) || this;\r\n        _this.newStatus = newStatus;\r\n        _this.oldStatus = oldStatus;\r\n        return _this;\r\n    }\r\n    return ActivityStatusChangeEventContext;\r\n}(EntityEventContext));\r\nexports.ActivityStatusChangeEventContext = ActivityStatusChangeEventContext;\r\nvar ActivityContextChangedEventContext = /** @class */ (function (_super) {\r\n    __extends(ActivityContextChangedEventContext, _super);\r\n    function ActivityContextChangedEventContext(context, updated, removed) {\r\n        var _this = _super.call(this, EntityEventType.ActivityContextChange) || this;\r\n        _this.context = typeof context === \"string\" ? JSON.parse(context) : context;\r\n        _this.updated = updated;\r\n        _this.removed = removed;\r\n        return _this;\r\n    }\r\n    return ActivityContextChangedEventContext;\r\n}(EntityEventContext));\r\nexports.ActivityContextChangedEventContext = ActivityContextChangedEventContext;\r\nvar EntityEventType = /** @class */ (function () {\r\n    function EntityEventType() {\r\n    }\r\n    EntityEventType.Added = \"added\";\r\n    EntityEventType.Removed = \"removed\";\r\n    EntityEventType.Updated = \"updated\";\r\n    EntityEventType.Closed = \"closed\";\r\n    EntityEventType.StatusChange = \"statusChange\";\r\n    EntityEventType.ActivityContextChange = \"activityContextUpdate\";\r\n    EntityEventType.ActivityWindowEvent = \"activityWindowEvent\";\r\n    // #deleteme TODO: these are not implemented in HC\r\n    EntityEventType.ActivityWindowJoinedActivity = \"joined\";\r\n    EntityEventType.ActivityWindowLeftActivity = \"left\";\r\n    return EntityEventType;\r\n}());\r\nexports.EntityEventType = EntityEventType;\r\nvar ActivityState = /** @class */ (function () {\r\n    function ActivityState() {\r\n    }\r\n    ActivityState.Created = \"created\";\r\n    ActivityState.Started = \"started\";\r\n    ActivityState.Destroyed = \"destroyed\";\r\n    return ActivityState;\r\n}());\r\nexports.ActivityState = ActivityState;\r\n//# sourceMappingURL=entityEvent.js.map\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = __webpack_require__(0);\r\nvar WindowStore = /** @class */ (function () {\r\n    function WindowStore() {\r\n        this.waitForTimeoutInMilliseconds = 60000;\r\n        this._windows = {};\r\n        this._pendingWindows = {};\r\n        this._pendingWindowsStates = {};\r\n        this._registry = CallbackFactory();\r\n    }\r\n    WindowStore.prototype.init = function (logger) {\r\n        this._logger = logger;\r\n    };\r\n    // Returns a window which either in Ready OR NOT 'ready' state (when the window is NOT marked with readyToShow)\r\n    WindowStore.prototype.get = function (id) {\r\n        return this._windows[id] || this._pendingWindows[id];\r\n    };\r\n    // Returns a window which is in 'ready' state (when the window is marked with readyToShow)\r\n    WindowStore.prototype.getIfReady = function (id) {\r\n        return this._windows[id];\r\n    };\r\n    Object.defineProperty(WindowStore.prototype, \"list\", {\r\n        get: function () {\r\n            return this._windows;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowStore.prototype.add = function (window) {\r\n        var isExist = this._pendingWindows[window.API.id] ? true : false;\r\n        if (isExist) {\r\n            this._logger.error(\"trying to add window with id \" + window.API.id + \" from windowStore, which already exists\");\r\n            return;\r\n        }\r\n        var remote = window.API.windowType === \"remote\";\r\n        this._pendingWindows[window.API.id] = window;\r\n        this._pendingWindowsStates[window.API.id] = {\r\n            ready: false,\r\n            urlChanged: remote,\r\n        };\r\n        this._registry.execute(\"on-added\", window);\r\n    };\r\n    WindowStore.prototype.remove = function (window) {\r\n        delete this._windows[window.API.id];\r\n        delete this._pendingWindows[window.API.id];\r\n        delete this._pendingWindowsStates[window.API.id];\r\n        this._registry.execute(\"on-removed\", window);\r\n    };\r\n    WindowStore.prototype.setReadyState = function (windowId) {\r\n        var targetWindowState = this._pendingWindowsStates[windowId];\r\n        if (typeof targetWindowState === \"undefined\") {\r\n            return;\r\n        }\r\n        targetWindowState.ready = true;\r\n        if (targetWindowState.urlChanged) {\r\n            this.markReadyToShow(windowId);\r\n        }\r\n    };\r\n    WindowStore.prototype.setUrlChangedState = function (windowId) {\r\n        var targetWindowState = this._pendingWindowsStates[windowId];\r\n        if (typeof targetWindowState === \"undefined\") {\r\n            return;\r\n        }\r\n        targetWindowState.urlChanged = true;\r\n        if (targetWindowState.ready) {\r\n            this.markReadyToShow(windowId);\r\n        }\r\n    };\r\n    WindowStore.prototype.waitFor = function (id) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var un;\r\n            var timeout = setTimeout(function () {\r\n                un();\r\n                reject(\"waitFor timed out.\");\r\n            }, _this.waitForTimeoutInMilliseconds);\r\n            var win = _this._windows[id];\r\n            if (win) {\r\n                clearTimeout(timeout);\r\n                resolve(win.API);\r\n            }\r\n            else {\r\n                un = _this.onReadyWindow(function (w) {\r\n                    if (w.API.id !== id) {\r\n                        return;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    un();\r\n                    resolve(w.API);\r\n                });\r\n            }\r\n        });\r\n    };\r\n    WindowStore.prototype.onReadyWindow = function (callback) {\r\n        return this._registry.add(\"on-ready\", callback);\r\n    };\r\n    WindowStore.prototype.onAdded = function (callback) {\r\n        return this._registry.add(\"on-added\", callback);\r\n    };\r\n    WindowStore.prototype.onRemoved = function (callback) {\r\n        return this._registry.add(\"on-removed\", callback);\r\n    };\r\n    // newly created windows now need to hear both \"ready\" and \"urlChanged\" events in otder to be markedReadyToShow\r\n    WindowStore.prototype.markReadyToShow = function (windowId) {\r\n        if (this._pendingWindows[windowId]) {\r\n            this._windows[windowId] = this._pendingWindows[windowId];\r\n            delete this._pendingWindows[windowId];\r\n            delete this._pendingWindowsStates[windowId];\r\n        }\r\n        this._registry.execute(\"on-ready\", this._windows[windowId]);\r\n    };\r\n    return WindowStore;\r\n}());\r\nexports.WindowStore = WindowStore;\r\nexports.default = new WindowStore();\r\n//# sourceMappingURL=store.js.map\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\n/* tslint:disable */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar util = __webpack_require__(1);\r\nvar LogLevel = /** @class */ (function () {\r\n    function LogLevel() {\r\n    }\r\n    LogLevel.Trace = \"trace\";\r\n    LogLevel.Debug = \"debug\";\r\n    LogLevel.Info = \"info\";\r\n    LogLevel.Warn = \"warn\";\r\n    LogLevel.Error = \"error\";\r\n    return LogLevel;\r\n}());\r\nexports.LogLevel = LogLevel;\r\nvar Logger = /** @class */ (function () {\r\n    function Logger(name) {\r\n        this._name = name;\r\n        // we have a glue logger let's create a new logger for it\r\n        if (!util.isUndefinedOrNull(Logger.GlueLogger)) {\r\n            this._glueLogger = Logger.GlueLogger.subLogger(name);\r\n        }\r\n    }\r\n    Logger.GetNamed = function (name) {\r\n        return new Logger(name);\r\n    };\r\n    Logger.Get = function (owner) {\r\n        return new Logger(Logger.GetTypeName(owner));\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        if (!util.isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.trace(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Trace) {\r\n                console.info(this._getMessage(message, LogLevel.Trace));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        if (!util.isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.debug(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace) {\r\n                console.info(this._getMessage(message, LogLevel.Debug));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        if (!util.isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.info(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace ||\r\n                Logger.Level === LogLevel.Info) {\r\n                console.info(this._getMessage(message, LogLevel.Info));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        if (!util.isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.warn(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace ||\r\n                Logger.Level === LogLevel.Info ||\r\n                Logger.Level === LogLevel.Warn) {\r\n                console.info(this._getMessage(message, LogLevel.Info));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.error = function (message) {\r\n        if (!util.isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.error(message);\r\n        }\r\n        else {\r\n            console.error(this._getMessage(message, LogLevel.Error));\r\n            console.trace();\r\n        }\r\n    };\r\n    Logger.prototype._getMessage = function (message, level) {\r\n        return \"[\" + level + \"] \" + this._name + \" - \" + message;\r\n    };\r\n    /**\r\n     * Returns the function name for a given object (same as constructor.name but cross-browser)\r\n     */\r\n    Logger.GetTypeName = function (object) {\r\n        var funcNameRegex = /function (.{1,})\\(/;\r\n        var results = (funcNameRegex).exec(object.constructor.toString());\r\n        return (results && results.length > 1) ? results[1] : \"\";\r\n    };\r\n    Logger.Level = LogLevel.Info;\r\n    return Logger;\r\n}());\r\nexports.Logger = Logger;\r\n//# sourceMappingURL=logger.js.map\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ShutdownMethodName = \"T42.ACS.Shutdown\";\r\nexports.FeedackMethodName = \"T42.ACS.Feedback\";\r\nexports.GetConfigurationRegionMethodName = \"T42.ACS.GetConfigurationRegion\";\r\nexports.SetConfigurationRegionMethodName = \"T42.ACS.SetConfigurationRegion\";\r\nexports.GetUserMethodName = \"T42.ACS.GetUser\";\r\nexports.GetBranchesMethodName = \"T42.ACS.GetBranches\";\r\nexports.GetCurrentBranchMethodName = \"T42.ACS.GetCurrentBranch\";\r\nexports.SetCurrentBranchMethodName = \"T42.ACS.SetCurrentBranch\";\r\nexports.GetFunctionalEntitlementMethodName = \"T42.ACS.GetFunctionalEntitlement\";\r\nexports.CanIMethodName = \"T42.ACS.CanI\";\r\nexports.StartApplicationMethodName = \"T42.ACS.StartApplication\";\r\nexports.StopApplicationMethodName = \"T42.ACS.StopApplication\";\r\nexports.ActivateApplicationMethodName = \"T42.ACS.ActivateApplication\";\r\nexports.RunApplicationMethodName = \"T42.ACS.RunApplication\";\r\nexports.OnEventMethodName = \"T42.ACS.OnEvent\";\r\nexports.GetApplicationsMethodName = \"T42.ACS.GetApplications\";\r\n//# sourceMappingURL=agm-names.js.map\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar randomFromSeed = __webpack_require__(34);\n\nvar ORIGINAL = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet;\nvar previousSeed;\n\nvar shuffled;\n\nfunction reset() {\n    shuffled = false;\n}\n\nfunction setCharacters(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet !== ORIGINAL) {\n            alphabet = ORIGINAL;\n            reset();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet = _alphabet_;\n    reset();\n}\n\nfunction characters(_alphabet_) {\n    setCharacters(_alphabet_);\n    return alphabet;\n}\n\nfunction setSeed(seed) {\n    randomFromSeed.seed(seed);\n    if (previousSeed !== seed) {\n        reset();\n        previousSeed = seed;\n    }\n}\n\nfunction shuffle() {\n    if (!alphabet) {\n        setCharacters(ORIGINAL);\n    }\n\n    var sourceArray = alphabet.split('');\n    var targetArray = [];\n    var r = randomFromSeed.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled() {\n    if (shuffled) {\n        return shuffled;\n    }\n    shuffled = shuffle();\n    return shuffled;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup(index) {\n    var alphabetShuffled = getShuffled();\n    return alphabetShuffled[index];\n}\n\nfunction get () {\n  return alphabet || ORIGINAL;\n}\n\nmodule.exports = {\n    get: get,\n    characters: characters,\n    seed: setSeed,\n    lookup: lookup,\n    shuffled: getShuffled\n};\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * Base class for activity entities with reference to the activity manager\r\n * @private\r\n */\r\nvar ActivityEntity = /** @class */ (function () {\r\n    function ActivityEntity(id) {\r\n        this._id = id;\r\n    }\r\n    Object.defineProperty(ActivityEntity.prototype, \"id\", {\r\n        get: function () {\r\n            return this._id;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Updates the properties of the current object using the properties of another object\r\n     * These two should have the same id.\r\n     */\r\n    ActivityEntity.prototype._update = function (other) {\r\n        if (other._id !== this._id) {\r\n            throw Error(\"Can not update from entity with different id.\");\r\n        }\r\n        this._updateCore(other);\r\n    };\r\n    ActivityEntity.prototype._updateCore = function (other) {\r\n        return;\r\n    };\r\n    ActivityEntity.prototype._beforeDelete = function (other) {\r\n        return;\r\n    };\r\n    return ActivityEntity;\r\n}());\r\nexports.default = ActivityEntity;\r\n//# sourceMappingURL=activityEntity.js.map\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar util = __webpack_require__(1);\r\nvar nextTick = function (cb) {\r\n    setTimeout(cb, 0);\r\n};\r\n/**\r\n * Convert a Promise to node style callback\r\n * @private\r\n */\r\nfunction nodeify(promise, callback) {\r\n    if (!util.isFunction(callback)) {\r\n        return promise;\r\n    }\r\n    promise.then(function (resp) {\r\n        nextTick(function () {\r\n            callback(null, resp);\r\n        });\r\n    }, function (err) {\r\n        nextTick(function () {\r\n            callback(err, null);\r\n        });\r\n    });\r\n}\r\nexports.nodeify = nodeify;\r\n//# sourceMappingURL=promiseExtensions.js.map\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar util = __webpack_require__(1);\r\nvar util_1 = __webpack_require__(1);\r\n// A helper class that provides lame activity AGM implementation\r\n// Can be initialized with or without activity - in case no activity (independent windows outside activity) only\r\n// subset of the methods work\r\nvar ActivityAGM = /** @class */ (function () {\r\n    function ActivityAGM(activity) {\r\n        this._activity = activity;\r\n    }\r\n    ActivityAGM.prototype.register = function (definition, handler) {\r\n        this._ensureHasAgm();\r\n        ActivityAGM.AGM.register(definition, handler);\r\n    };\r\n    ActivityAGM.prototype.servers = function () {\r\n        this._ensureHasAgm();\r\n        if (util.isUndefinedOrNull(this._activity)) {\r\n            // or return ActivityAGM.AGM.servers()\r\n            return [];\r\n        }\r\n        return this._activity.windows.map(function (w) {\r\n            return w.instance;\r\n        });\r\n    };\r\n    ActivityAGM.prototype.methods = function () {\r\n        var _this = this;\r\n        this._ensureHasAgm();\r\n        if (util.isUndefinedOrNull(this._activity)) {\r\n            // or return ActivityAGM.AGM.methods()\r\n            return [];\r\n        }\r\n        var windows = this._activity.windows;\r\n        var methodNames = [];\r\n        var methods = [];\r\n        // get all windows and their methods, then assemble distinct methods\r\n        windows.forEach(function (window) {\r\n            var windowMethods = _this.methodsForWindow(window);\r\n            windowMethods.forEach(function (currentWindowMethod) {\r\n                if (methodNames.indexOf(currentWindowMethod.name) === -1) {\r\n                    methodNames.push(currentWindowMethod.name);\r\n                    methods.push(currentWindowMethod);\r\n                }\r\n            });\r\n        });\r\n        return methods;\r\n    };\r\n    ActivityAGM.prototype.methodsForWindow = function (window) {\r\n        this._ensureHasAgm();\r\n        // get instance and use agm to get methods for instance\r\n        if (!window.instance) {\r\n            return [];\r\n        }\r\n        return ActivityAGM.AGM.methodsForInstance(window.instance);\r\n    };\r\n    /** Possible invoke targets\r\n     *\r\n     * \"activity.all\" - [default]\r\n     * \"activity.best\"\r\n     * ActivityWindow\r\n     * [ActivityWindow] -\r\n     *\r\n     * classic AGM\r\n     * \"all\" - agm all\r\n     * \"best\" - agm best\r\n     * instance - agm\r\n     * [ instances ]\r\n     *\r\n     */\r\n    ActivityAGM.prototype.invoke = function (methodName, arg, target, options, success, error) {\r\n        this._ensureHasAgm();\r\n        var activityServers = this.servers();\r\n        var serversToInvokeAgainst = [];\r\n        if (util.isUndefinedOrNull(target)) {\r\n            target = \"activity.all\";\r\n        }\r\n        if (util.isString(target)) {\r\n            if (target === \"activity.all\") {\r\n                serversToInvokeAgainst = activityServers;\r\n            }\r\n            else if (target === \"activity.best\") {\r\n                var potentialTargets = activityServers.filter(function (server) {\r\n                    var methods = ActivityAGM.AGM.methodsForInstance(server);\r\n                    return methods.filter(function (m) {\r\n                        return m.name === methodName;\r\n                    }).length > 0;\r\n                });\r\n                if (potentialTargets.length > 0) {\r\n                    serversToInvokeAgainst = [potentialTargets[0]];\r\n                }\r\n            }\r\n            else if (target === \"all\" || target === \"best\") {\r\n                return util_1.promisify(ActivityAGM.AGM.invoke(methodName, arg, target, options), success, error);\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid invoke target \" + target);\r\n            }\r\n        }\r\n        else if (util.isArray(target)) {\r\n            // if the array is not empty\r\n            if (target.length >= 0) {\r\n                var firstElem = target[0];\r\n                // check argument type\r\n                if (this._isInstance(firstElem)) {\r\n                    serversToInvokeAgainst = target.map(function (instance) { return instance; });\r\n                }\r\n                else if (this._isActivityWindow(firstElem)) {\r\n                    serversToInvokeAgainst = target.map(function (win) { return win.instance; });\r\n                }\r\n                else {\r\n                    throw new Error(\"Unknown target object\");\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (this._isInstance(target)) {\r\n                serversToInvokeAgainst = [target];\r\n            }\r\n            else if (this._isActivityWindow(target)) {\r\n                serversToInvokeAgainst = [target.instance];\r\n            }\r\n            else {\r\n                throw new Error(\"Unknown target object\");\r\n            }\r\n        }\r\n        throw new Error(\"Not implemented\");\r\n        // return promisify(ActivityAGM.AGM.invoke(methodName, arg, serversToInvokeAgainst, options), success, error);\r\n    };\r\n    ActivityAGM.prototype.unregister = function (definition) {\r\n        this._ensureHasAgm();\r\n        return ActivityAGM.AGM.unregister(definition);\r\n    };\r\n    ActivityAGM.prototype.createStream = function (methodDefinition, subscriptionAddedHandler, subscriptionRemovedHandler) {\r\n        this._ensureHasAgm();\r\n        ActivityAGM.AGM.createStream(methodDefinition, {\r\n            subscriptionAddedHandler: subscriptionAddedHandler,\r\n            subscriptionRemovedHandler: subscriptionRemovedHandler,\r\n            subscriptionRequestHandler: undefined\r\n        });\r\n    };\r\n    ActivityAGM.prototype.subscribe = function (methodDefinition, parameters, target) {\r\n        this._ensureHasAgm();\r\n        // #deleteme TODO: check servers needed?\r\n        // const servers = this.servers();\r\n        return ActivityAGM.AGM.subscribe(methodDefinition, parameters);\r\n    };\r\n    ActivityAGM.prototype._ensureHasAgm = function () {\r\n        if (util.isUndefinedOrNull(ActivityAGM.AGM)) {\r\n            throw new Error(\"Agm should be configured to be used in activity\");\r\n        }\r\n    };\r\n    ActivityAGM.prototype._isInstance = function (obj) {\r\n        // lame check\r\n        return obj.application !== undefined;\r\n    };\r\n    ActivityAGM.prototype._isActivityWindow = function (obj) {\r\n        return obj.instance !== undefined;\r\n    };\r\n    return ActivityAGM;\r\n}());\r\nexports.ActivityAGM = ActivityAGM;\r\n//# sourceMappingURL=activityAGM.js.map\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityEntity_1 = __webpack_require__(7);\r\nvar util_1 = __webpack_require__(1);\r\n/**\r\n * An activity type is a definition template for an activity, consisting of a collection of window types,\r\n * their layout and an initial activity context.\r\n *\r\n * @module activityType\r\n */\r\nvar ActivityType = /** @class */ (function (_super) {\r\n    __extends(ActivityType, _super);\r\n    function ActivityType(name, ownerWindow, helperWindows, description) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this._name = name;\r\n        _this._description = description;\r\n        _this._ownerWindow = ownerWindow;\r\n        _this._helperWindows = helperWindows || [];\r\n        return _this;\r\n    }\r\n    Object.defineProperty(ActivityType.prototype, \"name\", {\r\n        /**\r\n         * @var {string} name Name of the activity type\r\n         */\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"description\", {\r\n        /**\r\n         * @var {string} description description for the activity type\r\n         */\r\n        get: function () {\r\n            return this._description;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"helperWindows\", {\r\n        /**\r\n         * A list of window types that should be created when initiating a new instance of that activity type\r\n         * @var {windowDefinition[]} helperWindows\r\n         */\r\n        get: function () {\r\n            return this._helperWindows;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"ownerWindow\", {\r\n        /**\r\n         * @var {windowDefinition} ownerWindow Returns the definition of the owner window for that activity type\r\n         */\r\n        get: function () {\r\n            return this._ownerWindow;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Initiates a new activity of this type\r\n     *\r\n     * @function initiate\r\n     * @param {object} context The initial context to be used for the new activity\r\n     * @param callback\r\n     * @param configuration\r\n     * @returns {Promise<activity>}\r\n     */\r\n    ActivityType.prototype.initiate = function (context, callback, configuration) {\r\n        return this._manager.initiate(this._name, context, callback, configuration);\r\n    };\r\n    ActivityType.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        _super.prototype._updateCore.call(this, other);\r\n        util_1.ifNotUndefined(other._description, function (x) { return _this._description = x; });\r\n        util_1.ifNotUndefined(other._ownerWindow, function (x) { return _this._ownerWindow = x; });\r\n        util_1.ifNotUndefined(other._helperWindows, function (x) { return _this._helperWindows = x; });\r\n    };\r\n    return ActivityType;\r\n}(activityEntity_1.default));\r\nexports.default = ActivityType;\r\n//# sourceMappingURL=activityType.js.map\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction objectValues(source) {\r\n    if (!source) {\r\n        return [];\r\n    }\r\n    return Object.keys(source).map(function (key) { return source[key]; });\r\n}\r\nexports.objectValues = objectValues;\r\nfunction objectClone(obj) {\r\n    var result;\r\n    try {\r\n        result = JSON.parse(JSON.stringify(obj || {}));\r\n    }\r\n    catch (error) {\r\n        result = {};\r\n    }\r\n    return result;\r\n}\r\nexports.objectClone = objectClone;\r\n//# sourceMappingURL=helper.js.map\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar entityEvent_1 = __webpack_require__(2);\r\nvar activityStatus_1 = __webpack_require__(13);\r\nvar activityType_1 = __webpack_require__(10);\r\nvar windowType_1 = __webpack_require__(16);\r\nvar activity_1 = __webpack_require__(14);\r\nvar activityWindow_1 = __webpack_require__(15);\r\nvar logger_1 = __webpack_require__(4);\r\nvar readyMarker_1 = __webpack_require__(17);\r\nvar util = __webpack_require__(1);\r\n/**\r\n * HtmlContainer (HC) bridge\r\n * @private\r\n * @module hcBridge\r\n */\r\nvar HCBridge = /** @class */ (function () {\r\n    function HCBridge(agm, windows, appManagerGetter, mode, typesToTrack) {\r\n        // HC constants\r\n        this._activityTypeEntityName = \"activityType\";\r\n        this._windowTypeEntityName = \"windowType\";\r\n        this._activityEntityName = \"activity\";\r\n        this._windowEntityName = \"activityWindow\";\r\n        this._logger = logger_1.Logger.Get(\"hcBridge\");\r\n        // event sequences\r\n        this._lastSeq = 0;\r\n        this._eventQueue = [];\r\n        this._activityTypeCallbacks = [];\r\n        this._windowTypeCallbacks = [];\r\n        this._activityCallbacks = [];\r\n        this._windowCallbacks = [];\r\n        this._agm = agm;\r\n        this._windows = windows;\r\n        this._appManagerGetter = appManagerGetter;\r\n        this._mode = mode;\r\n        this._typesToTrack = typesToTrack;\r\n    }\r\n    /**\r\n     *  Convert an ActivityType entity coming from HC to ActivityType\r\n     */\r\n    HCBridge._hcToJsActivityType = function (hcActType) {\r\n        return new activityType_1.default(hcActType.name, hcActType.ownerWindowType, hcActType.helperWindowTypes, hcActType.description);\r\n    };\r\n    HCBridge._getURLParameter = function (name) {\r\n        return decodeURIComponent((new RegExp(\"[?|&]\" + name + \"=\" + \"([^&;]+?)(&|#|;|$)\").exec(location.search) || [, \"\"])[1].replace(/\\+/g, \"%20\")) || null;\r\n    };\r\n    Object.defineProperty(HCBridge.prototype, \"bridgeType\", {\r\n        get: function () {\r\n            return \"HC\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    HCBridge.prototype.joinActivity = function (activityId, windowId) {\r\n        throw new Error(\"Not implemented\");\r\n    };\r\n    HCBridge.prototype.leaveActivity = function (activityId, windowId) {\r\n        throw new Error(\"Not implemented\");\r\n    };\r\n    HCBridge.prototype.init = function () {\r\n        var _this = this;\r\n        this._readyMarker = new readyMarker_1.ReadyMarker(\"HC Bridge\", 1);\r\n        this._htmlContainer = window.htmlContainer.activityFacade;\r\n        if (this._htmlContainer.subscribeForJoinBreakEvents) {\r\n            this._htmlContainer.subscribeForJoinBreakEvents(function (e) {\r\n                _this._handleGenericEvents(e);\r\n            });\r\n        }\r\n        var options = this._agm ? this._agm.instance : undefined;\r\n        var initFunc = this._htmlContainer.init;\r\n        if (this._htmlContainer.init2) {\r\n            initFunc = this._htmlContainer.init2;\r\n            options = {\r\n                jsAgmInstance: options,\r\n                glueVersion: 3,\r\n                mode: this._mode,\r\n                typesToTrack: this._typesToTrack\r\n            };\r\n        }\r\n        initFunc(options, this._hcEventHandler.bind(this), // event listener\r\n        function () {\r\n            _this._readyMarker.signal(\"Init done from HC\");\r\n        }, function (error) {\r\n            _this._readyMarker.error(error);\r\n        });\r\n    };\r\n    HCBridge.prototype.initReady = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._readyMarker.setCallback(function (err) {\r\n                if (!err) {\r\n                    resolve(_this);\r\n                }\r\n                else {\r\n                    _this._logger.error(\"Error initializing HC bridge - \" + err);\r\n                    reject(_this._readyMarker.getError());\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.ready = function () {\r\n        return this.initReady();\r\n    };\r\n    HCBridge.prototype._handleGenericEvents = function (event) {\r\n        this._processEventBySeq(event);\r\n    };\r\n    HCBridge.prototype._hcEventHandler = function (eventJson) {\r\n        this._logger.trace(eventJson);\r\n        var event = JSON.parse(eventJson);\r\n        this._processEventBySeq(event);\r\n    };\r\n    HCBridge.prototype._processEventBySeq = function (event) {\r\n        var seq = event.sequence;\r\n        if (seq === this._lastSeq + 1) {\r\n            // if this is the event we expect process it\r\n            this._processEvent(event);\r\n            this._lastSeq++;\r\n            // empty the next items in the queue - if any\r\n            var nextEvent = this._eventQueue[seq + 1];\r\n            if (!util.isUndefined(nextEvent)) {\r\n                this._logger.debug(\"replaying message number \" + seq);\r\n                this._processEventBySeq(nextEvent);\r\n                delete this._eventQueue[seq + 1];\r\n            }\r\n        }\r\n        else {\r\n            // save in the queue\r\n            this._eventQueue[seq] = event;\r\n            this._logger.debug(\"Got out of order event with number \" + seq + \". Will wait for previous event(s) before replaying.\");\r\n        }\r\n    };\r\n    HCBridge.prototype._processEvent = function (event) {\r\n        var _this = this;\r\n        if (event.genericEvent) {\r\n            this._processGenericEvent(event);\r\n            return;\r\n        }\r\n        var entityType = event.entityType;\r\n        var eventContext = this._convertContext(event.context);\r\n        var entity;\r\n        // Hack for Activities .NET api not delivering right context\r\n        if (event.context.type === entityEvent_1.EntityEventType.ActivityContextChange &&\r\n            (!this._htmlContainer.contextUpdateRaceFixed)) {\r\n            // When there is a context update, we will ask the container for all activities\r\n            // and use the context of the returned activity instead of the one we received from the update\r\n            // we should remove this hack once a fix in HC is deployed\r\n            this.getActivities()\r\n                .then(function (activities) {\r\n                var updated = event.context.updated;\r\n                var removed = event.context.removed;\r\n                var activityInEvent = _this._hcToJsActivity(event.entity);\r\n                var contextAsString = event.entity.context;\r\n                activities.forEach(function (activity) {\r\n                    if (activity.id !== activityInEvent.id) {\r\n                        return;\r\n                    }\r\n                    var hackEventContext = new entityEvent_1.ActivityContextChangedEventContext(contextAsString, updated, removed);\r\n                    _this._publishActivityStatusChange(activityInEvent, hackEventContext);\r\n                });\r\n            });\r\n            return;\r\n        }\r\n        switch (entityType) {\r\n            case this._activityTypeEntityName:\r\n                entity = HCBridge._hcToJsActivityType(event.entity);\r\n                this._publishActivityTypeStatusChange(entity, eventContext);\r\n                break;\r\n            case this._windowTypeEntityName:\r\n                entity = this._hcToJsWindowType(event.entity);\r\n                this._publishWindowTypeStatusChange(entity, eventContext);\r\n                break;\r\n            case this._activityEntityName:\r\n                entity = this._hcToJsActivity(event.entity);\r\n                this._publishActivityStatusChange(entity, eventContext);\r\n                break;\r\n            case this._windowEntityName:\r\n                entity = this._hcToJsWindow(event.entity);\r\n                this._publishActivityWindowEvent(entity, eventContext);\r\n                break;\r\n        }\r\n    };\r\n    HCBridge.prototype._processGenericEvent = function (event) {\r\n        var info = event.data;\r\n        if (event.type === \"ActivitiesAttached\") {\r\n            if (this._activitiesAttachedHandler) {\r\n                this._activitiesAttachedHandler(info);\r\n            }\r\n        }\r\n        else if (event.type === \"ActivitiesDetached\") {\r\n            if (this._activitiesDetached) {\r\n                this._activitiesDetached(info);\r\n            }\r\n        }\r\n        else if (event.type === \"ActivityAttachedDescriptorsRefreshed\") {\r\n            if (this._activityAttachedDescriptorsRefreshed) {\r\n                this._activityAttachedDescriptorsRefreshed(info);\r\n            }\r\n        }\r\n    };\r\n    HCBridge.prototype._convertContext = function (hcContext) {\r\n        if (hcContext.type === entityEvent_1.EntityEventType.StatusChange) {\r\n            var oldStatus = new activityStatus_1.ActivityStatus(hcContext.oldStatus.state, hcContext.oldStatus.statusMessage, hcContext.oldStatus.statusTime);\r\n            var newStatus = new activityStatus_1.ActivityStatus(hcContext.newStatus.state, hcContext.newStatus.statusMessage, hcContext.newStatus.statusTime);\r\n            return new entityEvent_1.ActivityStatusChangeEventContext(newStatus, oldStatus);\r\n        }\r\n        else if (hcContext.type === entityEvent_1.EntityEventType.ActivityWindowEvent) {\r\n            return new entityEvent_1.EntityEventContext(hcContext.event);\r\n        }\r\n        else if (hcContext.type === entityEvent_1.EntityEventType.ActivityContextChange) {\r\n            return new entityEvent_1.ActivityContextChangedEventContext(hcContext.newContext, hcContext.updated, hcContext.removed);\r\n        }\r\n        return new entityEvent_1.EntityEventContext(hcContext.type);\r\n    };\r\n    /**\r\n     *  Convert an Activity entity from HC to Activity\r\n     */\r\n    HCBridge.prototype._hcToJsActivity = function (hcAct) {\r\n        var window = hcAct.owner ? this._hcToJsWindow(hcAct.owner) : null;\r\n        var windowId = window ? window.id : null;\r\n        var status = new activityStatus_1.ActivityStatus(hcAct.status.state, hcAct.status.statusMessage, hcAct.status.statusTime);\r\n        var context = JSON.parse(hcAct.context);\r\n        return new activity_1.default(hcAct.id, hcAct.type.name, status, context, windowId);\r\n    };\r\n    /**\r\n     *  Convert a WindowType entity coming from HC to WindowType\r\n     */\r\n    HCBridge.prototype._hcToJsWindowType = function (hcWinType) {\r\n        var _this = this;\r\n        if (util.isUndefined(hcWinType.factories)) {\r\n            hcWinType.factories = [];\r\n        }\r\n        // lazy init\r\n        if (!this._appByWindowTypeGetter) {\r\n            if (!this._appManagerGetter) {\r\n                this._appByWindowTypeGetter = function () { return undefined; };\r\n            }\r\n            this._appByWindowTypeGetter = function (wt) {\r\n                var appMgr = _this._appManagerGetter();\r\n                return appMgr.applications().filter(function (app) { return app.activityWindowType === wt; })[0];\r\n            };\r\n        }\r\n        return new windowType_1.default(hcWinType.name, this._appByWindowTypeGetter);\r\n    };\r\n    // /** Convert a WindowFactory entity coming from HC to WindowFactory */\r\n    // static _hcToJsWindowTypeFactory(hcWinTypeFactory: any): WindowFactory {\r\n    //   return new ProxyWindowFactory(hcWinTypeFactory.description);\r\n    // }\r\n    HCBridge.prototype.getActivityTypes = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // get all from HC\r\n            _this._htmlContainer.getActivityTypes(function (infos) {\r\n                // transform to Activity Js Entities\r\n                var result = infos.map(function (info) { return HCBridge._hcToJsActivityType(info); });\r\n                resolve(result);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.registerActivityType = function (activityTypeName, ownerWindow, helperWindows, layoutConfig, description) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (helperWindows === undefined) {\r\n                helperWindows = [];\r\n            }\r\n            var config = {\r\n                name: activityTypeName,\r\n                ownerWindowType: ownerWindow,\r\n                helperWindowTypes: helperWindows,\r\n                description: description,\r\n                layoutConfig: JSON.stringify(layoutConfig)\r\n            };\r\n            // pass create request to HC\r\n            _this._htmlContainer.registerActivityType(JSON.stringify(config), function (info) {\r\n                // transform to Activity Js Entity\r\n                var newActivityType = HCBridge._hcToJsActivityType(info);\r\n                resolve(newActivityType);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.unregisterActivityType = function (activityTypeName) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // pass create request to HC\r\n            _this._htmlContainer.unregisterActivityType(activityTypeName, \r\n            /*( info )*/ function () {\r\n                resolve();\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.getWindowTypes = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // get all from HC\r\n            _this._htmlContainer.getWindowTypes(function (infos) {\r\n                // transform to Activity Js Entities\r\n                var result = infos.map(function (info) { return _this._hcToJsWindowType(info); });\r\n                resolve(result);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.registerWindowFactory = function (windowTypeName, factory, parameters) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(windowTypeName)) {\r\n                reject(\"windowTypeName should be provided\");\r\n                return;\r\n            }\r\n            // pass create request to HC\r\n            _this._htmlContainer.registerWindowFactory(windowTypeName, factory.create.bind(factory), \r\n            /*(info)*/ function () {\r\n                resolve();\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.initiateActivity = function (activityType, context, configuration) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(activityType)) {\r\n                reject(\"windowTypeName should be provided\");\r\n                return;\r\n            }\r\n            if (util.isUndefinedOrNull(context)) {\r\n                context = {};\r\n            }\r\n            // pass create request to HC\r\n            _this._htmlContainer.initiate(activityType, JSON.stringify(context), function (activityId) {\r\n                resolve(activityId);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.getAnnouncementInfo = function () {\r\n        var hc = window.htmlContainer;\r\n        var context = hc.getContext();\r\n        var result = { activityWindowId: \"\", activityWindowType: \"\", activityWindowIndependent: false, activityWindowName: \"\" };\r\n        if (!context.activityId) {\r\n            // in case we're not in activity just return. this will\r\n            // lead to window not registering itself\r\n            return result;\r\n        }\r\n        result.activityWindowType = context.activityWindowType;\r\n        if (util.isUndefined(result.activityWindowType)) {\r\n            result.activityWindowType = HCBridge._getURLParameter(\"activityWindowType\");\r\n        }\r\n        result.activityWindowId = context.activityWindowId;\r\n        if (util.isUndefined(result.activityWindowId)) {\r\n            result.activityWindowId = HCBridge._getURLParameter(\"activityWindowId\");\r\n        }\r\n        result.activityWindowIndependent = context.activityWindowIndependent;\r\n        if (util.isUndefined(result.activityWindowIndependent)) {\r\n            // TODO parse\r\n            // result.activityWindowIndependent = this._getURLParameter(\"activityWindowIndependent\");\r\n        }\r\n        result.activityWindowName = context.activityWindowName;\r\n        if (util.isUndefined(result.activityWindowName)) {\r\n            result.activityWindowName = HCBridge._getURLParameter(\"activityWindowName\");\r\n        }\r\n        return result;\r\n    };\r\n    HCBridge.prototype.announceWindow = function (windowType, activityWindowId) {\r\n        var _this = this;\r\n        if (util.isUndefined(windowType)) {\r\n            throw new Error(\"can not determine window type\");\r\n        }\r\n        if (util.isUndefined(windowType)) {\r\n            throw new Error(\"can not determine window activityWindowId\");\r\n        }\r\n        this._htmlContainer.announceWindow(windowType, activityWindowId, function (error) {\r\n            _this._logger.error(\"Error announcing activity window with id '\" + activityWindowId + \"'. \" + error);\r\n        });\r\n    };\r\n    HCBridge.prototype.getActivities = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // get all from HC\r\n            _this._logger.trace(\"Executing getActivities()\");\r\n            _this._htmlContainer.getActivities(function (activitiesStr) {\r\n                // transform to Activity Js Entities\r\n                _this._logger.trace(\"Got getActivities() :\" + activitiesStr);\r\n                var activities = JSON.parse(activitiesStr);\r\n                var result = activities.map(function (act) { return _this._hcToJsActivity(act); });\r\n                resolve(result);\r\n            }, function (error) {\r\n                _this._logger.trace(\"Error in getActivities() :\" + error);\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.updateActivityContext = function (activity, context, fullReplace, removedKeys) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (util.isUndefined(removedKeys)) {\r\n                removedKeys = [];\r\n            }\r\n            var options = {\r\n                fullReplace: fullReplace,\r\n                removedKeys: removedKeys\r\n            };\r\n            _this._htmlContainer.setActivityContext(activity.id, JSON.stringify(context), JSON.stringify(options), function (newContextString) {\r\n                // receives the new context as string\r\n                var newContext = JSON.parse(newContextString);\r\n                resolve(newContext);\r\n            }, function (error) { return reject(error); });\r\n        });\r\n    };\r\n    HCBridge.prototype.getActivityWindows = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // get all from HC\r\n            _this._htmlContainer.getWindows(function (windows) {\r\n                // transform to Activity Js Entities\r\n                var result = windows.map(function (wind) { return _this._hcToJsWindow(wind); });\r\n                resolve(result);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.stopActivity = function (activity) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.stopActivity(activity.id, function (result) {\r\n                resolve(result);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.unregisterWindowFactory = function (windowTypeName) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.registerWindowFactory(windowTypeName, \r\n            /*(info)*/ function () {\r\n                resolve();\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.createWindow = function (id, windowDefinition) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var objToSend = windowDefinition;\r\n            var functionToUse = _this._htmlContainer.createWindow2;\r\n            if (!functionToUse) {\r\n                functionToUse = _this._htmlContainer.createWindow;\r\n                objToSend = JSON.stringify(windowDefinition);\r\n            }\r\n            functionToUse(id, objToSend, function (newId) {\r\n                resolve(newId);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.createStackedWindows = function (id, windowDefinitions, timeout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var objToSend = windowDefinitions;\r\n            var functionToUse = _this._htmlContainer.createStackedWindows2;\r\n            if (!functionToUse) {\r\n                functionToUse = _this._htmlContainer.createStackedWindows;\r\n                objToSend = JSON.stringify(windowDefinitions);\r\n            }\r\n            functionToUse(id, objToSend, timeout, function (newId) {\r\n                resolve(newId);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.onActivityTypeStatusChange = function (callback) {\r\n        this._activityTypeCallbacks.push(callback);\r\n    };\r\n    HCBridge.prototype.onWindowTypeStatusChange = function (callback) {\r\n        this._windowTypeCallbacks.push(callback);\r\n    };\r\n    HCBridge.prototype.onActivityStatusChange = function (callback) {\r\n        this._activityCallbacks.push(callback);\r\n    };\r\n    HCBridge.prototype.onActivityWindowChange = function (callback) {\r\n        this._windowCallbacks.push(callback);\r\n    };\r\n    HCBridge.prototype.getWindowBounds = function (id) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.getWindowBounds(id, function (bounds) {\r\n                resolve(bounds);\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.setWindowBounds = function (id, bounds) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.setWindowBounds(id, JSON.stringify(bounds), function () {\r\n                resolve();\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.registerWindow = function (type, name, independent) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.registerWindow(type, name, independent, function (id) {\r\n                resolve(id);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.closeWindow = function (id) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.closeWindow(id, function () {\r\n                resolve();\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.activateWindow = function (id, focus) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.activateWindow(id, focus, function () {\r\n                resolve();\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.setWindowVisibility = function (id, visible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.setWindowVisibility(id, visible, function () {\r\n                resolve();\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.cloneActivity = function (id, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.cloneActivity(id, options, function (activityId) {\r\n                resolve(activityId);\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype._publishStatusChange = function (entity, context, callbacks) {\r\n        var entityEvent = new entityEvent_1.EntityEvent(entity, context);\r\n        callbacks.forEach(function (callback) {\r\n            callback(entityEvent);\r\n        });\r\n    };\r\n    HCBridge.prototype._publishActivityTypeStatusChange = function (at, context) {\r\n        this._publishStatusChange(at, context, this._activityTypeCallbacks);\r\n    };\r\n    HCBridge.prototype._publishWindowTypeStatusChange = function (wt, context) {\r\n        this._publishStatusChange(wt, context, this._windowTypeCallbacks);\r\n    };\r\n    HCBridge.prototype._publishActivityStatusChange = function (act, context) {\r\n        this._publishStatusChange(act, context, this._activityCallbacks);\r\n    };\r\n    HCBridge.prototype._publishActivityWindowEvent = function (w, context) {\r\n        this._publishStatusChange(w, context, this._windowCallbacks);\r\n    };\r\n    HCBridge.prototype.attachActivities = function (from, to, tag) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.attachActivities(from, to, tag, function (state) {\r\n                resolve(state);\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.detachActivities = function (activityId, newActivityInfo) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.detachActivities(activityId, newActivityInfo, function (newActivityId) {\r\n                resolve(newActivityId);\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.onActivitiesAttached = function (callback) {\r\n        this._activitiesAttachedHandler = callback;\r\n    };\r\n    HCBridge.prototype.onActivitiesDetached = function (callback) {\r\n        this._activitiesDetached = callback;\r\n    };\r\n    HCBridge.prototype.onActivityAttachedDescriptorsRefreshed = function (callback) {\r\n        this._activityAttachedDescriptorsRefreshed = callback;\r\n    };\r\n    HCBridge.prototype.getAttachedDescriptors = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!_this._htmlContainer.getAttachedDescriptors) {\r\n                // support for container that does not have descriptors\r\n                resolve([]);\r\n                return;\r\n            }\r\n            _this._htmlContainer.getAttachedDescriptors(function (result) {\r\n                resolve(result);\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     *  Convert a ActivityWindow entity coming from HC to ActivityWindow\r\n     */\r\n    HCBridge.prototype._hcToJsWindow = function (hcWindow) {\r\n        var _this = this;\r\n        var windowGetter = function () { return undefined; };\r\n        if (this._windows) {\r\n            if (hcWindow.hcWindowId) {\r\n                windowGetter = function () { return _this._windows.list().filter(function (w) { return w.id === hcWindow.hcWindowId; })[0]; };\r\n            }\r\n            else {\r\n                // backward compatibility for HC < 1.58\r\n                windowGetter = function () { return _this._windows.list().filter(function (w) { return w.application === hcWindow.instance.application; })[0]; };\r\n            }\r\n        }\r\n        return new activityWindow_1.default(hcWindow.id, hcWindow.name, hcWindow.type, hcWindow.activityId, hcWindow.instance, hcWindow.isIndependent, windowGetter, hcWindow.hcWindowId);\r\n    };\r\n    return HCBridge;\r\n}());\r\nexports.default = HCBridge;\r\n//# sourceMappingURL=hcBridge.js.map\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * @typedef {Object} activityStatus Defines activity instance status\r\n * @property {string} state Current state\r\n * @property {string} message Message\r\n * @property {Date} time Time of the last status update\r\n */\r\nvar ActivityStatus = /** @class */ (function () {\r\n    function ActivityStatus(state, message, time) {\r\n        this.state = state;\r\n        this.message = message;\r\n        this.time = time;\r\n    }\r\n    ActivityStatus.prototype.getState = function () {\r\n        return this.state;\r\n    };\r\n    ActivityStatus.prototype.getMessage = function () {\r\n        return this.message;\r\n    };\r\n    ActivityStatus.prototype.getTime = function () {\r\n        return this.time;\r\n    };\r\n    return ActivityStatus;\r\n}());\r\nexports.ActivityStatus = ActivityStatus;\r\n//# sourceMappingURL=activityStatus.js.map\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityEntity_1 = __webpack_require__(7);\r\nvar activityAGM_1 = __webpack_require__(9);\r\nvar attachedActivityDescriptor_1 = __webpack_require__(46);\r\nvar promiseExtensions_1 = __webpack_require__(8);\r\nvar util_1 = __webpack_require__(1);\r\n/**\r\n * Activity is an instance of an activity type just like an object is an instance of a class\r\n * in class-based languages (and just like John is an instance of a 'Person).\r\n *\r\n * Activity is often used as a synonym for activity instance.\r\n *\r\n * Each activity instance has a single owner window and can optionally have one or more helper windows.\r\n *\r\n * @module activity\r\n */\r\nvar Activity = /** @class */ (function (_super) {\r\n    __extends(Activity, _super);\r\n    function Activity(id, actType, status, context, ownerId) {\r\n        var _this = _super.call(this, id) || this;\r\n        _this._id = id;\r\n        _this._actType = actType;\r\n        _this._status = status;\r\n        _this._context = context;\r\n        _this._ownerId = ownerId;\r\n        _this._agm = new activityAGM_1.ActivityAGM(_this);\r\n        return _this;\r\n    }\r\n    Object.defineProperty(Activity.prototype, \"type\", {\r\n        /**\r\n         * Activity type\r\n         * @var {module:activityType} type\r\n         */\r\n        get: function () {\r\n            if (this._manager) {\r\n                return this._manager.getActivityType(this._actType);\r\n            }\r\n            return undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"context\", {\r\n        /**\r\n         * Get current activity context. To update use updateContext , to replace setContext\r\n         * @var {object} context\r\n         */\r\n        get: function () {\r\n            return this._context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"status\", {\r\n        /**\r\n         * Get activity status\r\n         * @var {activityStatus} status\r\n         */\r\n        get: function () {\r\n            return this._status;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"owner\", {\r\n        /**\r\n         * The owner window\r\n         * @var {module:activityWindow} owner\r\n         */\r\n        get: function () {\r\n            if (!this._ownerId) {\r\n                return null;\r\n            }\r\n            return this._manager.getWindows({ id: this._ownerId })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"windows\", {\r\n        /**\r\n         * All windows participating in the activity\r\n         * @var {module:activityWindow[]} windows\r\n         */\r\n        get: function () {\r\n            return this._manager.getWindows({ activityId: this._id });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"agm\", {\r\n        /**\r\n         * @var {module:activityAGM} agm\r\n         */\r\n        get: function () {\r\n            return this._agm;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Joins a specific window to the activity\r\n     *\r\n     * @private\r\n     * @function join\r\n     * @param window    The window to join\r\n     * @param callback  (Optional) Result callback\r\n     * @returns         Promise for ActivityWindow\r\n     */\r\n    Activity.prototype.addWindow = function (window, callback) {\r\n        return this._manager.addWindowToActivity(this, window, callback);\r\n    };\r\n    /**\r\n     * Creates a new window and joins it to the activity\r\n     *\r\n     * @function createWindow\r\n     * @param {string|windowDefinition} windowType The type of the window to be created\r\n     * @param callback\r\n     * @returns {Promise<module:activityWindow>}\r\n     */\r\n    Activity.prototype.createWindow = function (windowType, callback) {\r\n        return this._manager.createWindow(this, windowType, callback);\r\n    };\r\n    /**\r\n     * Creates a stacked set of windows and joins them to the\r\n     *\r\n     * @function createStackedWindows\r\n     * @param {string[] | windowDefinition[]} windowTypes The types of the windows to be created\r\n     * @param {number} timeout\r\n     * @param callback\r\n     * @returns {Promise<module:activityWindow[]>}\r\n     */\r\n    Activity.prototype.createStackedWindows = function (windowTypes, timeout, callback) {\r\n        return this._manager.createStackedWindows(this, windowTypes, timeout, callback);\r\n    };\r\n    /**\r\n     * Removes a window from the activity\r\n     *\r\n     * @private\r\n     * @param window\r\n     * @param callback\r\n     * @returns     Promise for ActivityWindow\r\n     */\r\n    Activity.prototype.leave = function (window, callback) {\r\n        return this._manager.leaveWindowFromActivity(this, window, callback);\r\n    };\r\n    /**\r\n     * Get all windows participating in the activity from a given type\r\n     *\r\n     * @param {string} windowType\r\n     * @returns {module:activityWindow[]}\r\n     */\r\n    Activity.prototype.getWindowsByType = function (windowType) {\r\n        var filter = { activityId: this._id, type: windowType };\r\n        return this._manager.getWindows(filter);\r\n    };\r\n    /**\r\n     * Replaces the activity context with a new one.\r\n     *\r\n     * @function setContext\r\n     * @param {object} context   The new context\r\n     * @param callback\r\n     * @returns {Promise<Object>}\r\n     */\r\n    Activity.prototype.setContext = function (context, callback) {\r\n        return this._manager.setActivityContext(this, context, callback);\r\n    };\r\n    /**\r\n     * Updates activity context using the properties from the context argument.\r\n     * If old context is {a:1, b:2, c:3} and invoking updateContext({b:3, c:null}) will result a context\r\n     * be {a:1, b:3}\r\n     *\r\n     * @function updateContext\r\n     * @param {object} context\r\n     * @param callback\r\n     * @return {Promise<object>}\r\n     */\r\n    Activity.prototype.updateContext = function (context, callback) {\r\n        return this._manager.updateActivityContext(this, context, callback);\r\n    };\r\n    /**\r\n     * Subscribe for status change events\r\n     *\r\n     * @function onStatusChange\r\n     *\r\n     * @param {activityStatusChangeHandler} handler Handler function that will receive status notifications\r\n     */\r\n    Activity.prototype.onStatusChange = function (handler) {\r\n        var _this = this;\r\n        return this._manager.subscribeActivityEvents(function (a, ns, os) {\r\n            if (a.id === _this.id) {\r\n                handler(a, ns, os);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Subscribe for window related events, like joined, removed from activity\r\n     *\r\n     * @function onWindowEvent\r\n     * @param {windowEventHandler} handler Handler function that will receive windows events\r\n     */\r\n    Activity.prototype.onWindowEvent = function (handler) {\r\n        var _this = this;\r\n        return this._manager.subscribeWindowEvents(function (a, w, e) {\r\n            if (a.id === _this.id) {\r\n                handler(a, w, e);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Subscribe for context updates\r\n     *\r\n     * @function onContextChanged\r\n     * @param {contextChangedHandler} handler Handler function that will receive context related events\r\n     */\r\n    Activity.prototype.onContextChanged = function (handler) {\r\n        var _this = this;\r\n        this._manager.subscribeActivityContextChanged(function (act, context, updated, removed) {\r\n            if (act.id === _this.id) {\r\n                handler(context, updated, removed, act);\r\n            }\r\n        });\r\n        try {\r\n            // replay the context at the time of subscribing, swallow user exceptions\r\n            handler(this.context, this.context, [], this);\r\n        }\r\n        catch (e) {\r\n            return;\r\n        }\r\n    };\r\n    /**\r\n     * Stops the activity\r\n     * @function stop\r\n     */\r\n    Activity.prototype.stop = function () {\r\n        this._manager.stopActivity(this);\r\n    };\r\n    /**\r\n     * Clones the activity into a new one\r\n     * @function clone\r\n     * @param {CloneOptions} options\r\n     */\r\n    Activity.prototype.clone = function (options) {\r\n        return this._manager.clone(this, options);\r\n    };\r\n    Activity.prototype.attach = function (activity, tag) {\r\n        var activityId;\r\n        if (typeof activity === \"string\") {\r\n            activityId = activity;\r\n        }\r\n        else {\r\n            activityId = activity.id;\r\n        }\r\n        return this._manager.attachActivities(activityId, this.id, tag);\r\n    };\r\n    Activity.prototype.onActivityAttached = function (callback) {\r\n        var _this = this;\r\n        this._manager.subscribeActivitiesAttached(function (newActId, oldActId, descriptor) {\r\n            if (newActId !== _this._id) {\r\n                return;\r\n            }\r\n            callback(descriptor);\r\n        });\r\n    };\r\n    Activity.prototype.onDetached = function (callback) {\r\n        var _this = this;\r\n        this._manager.subscribeActivitiesDetached(function (newAct, originalActivity, state) {\r\n            if (originalActivity.id !== _this._id) {\r\n                return;\r\n            }\r\n            callback(newAct, state);\r\n        });\r\n    };\r\n    Activity.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        _super.prototype._updateCore.call(this, other);\r\n        util_1.ifNotUndefined(other._actType, function (x) { return _this._actType = x; });\r\n        util_1.ifNotUndefined(other._context, function (x) { return _this._context = x; });\r\n        util_1.ifNotUndefined(other._ownerId, function (x) { return _this._ownerId = x; });\r\n        if (other._status && (!this._status || (this._status.state !== other._status.state))) {\r\n            this._status = other._status;\r\n        }\r\n    };\r\n    Activity.prototype._updateDescriptors = function (allStates) {\r\n        var _this = this;\r\n        this._attached = allStates.map(function (s) {\r\n            return new attachedActivityDescriptor_1.AttachedActivityDescriptor(_this._manager, _this._id, s);\r\n        });\r\n    };\r\n    Object.defineProperty(Activity.prototype, \"attached\", {\r\n        get: function () {\r\n            return this._attached;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Activity.prototype.setFrameColor = function (color, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var callbacksToWait = _this.windows.length;\r\n            if (callbacksToWait === 0) {\r\n                resolve(_this);\r\n            }\r\n            _this.windows.forEach(function (w) {\r\n                w.underlyingWindow.setFrameColor(color, function () {\r\n                    callbacksToWait--;\r\n                    if (callbacksToWait <= 0) {\r\n                        resolve(_this);\r\n                    }\r\n                });\r\n            });\r\n            setTimeout(function () {\r\n                if (callbacksToWait > 0) {\r\n                    reject(_this.id + \" - timed out waiting for setFrameColor with\" + color);\r\n                }\r\n            }, 5000);\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    Activity.prototype.getFrameColor = function () {\r\n        if (!this.windows || this.windows.length === 0) {\r\n            return \"\";\r\n        }\r\n        return this.windows[0].underlyingWindow.frameColor;\r\n    };\r\n    return Activity;\r\n}(activityEntity_1.default));\r\nexports.default = Activity;\r\n//# sourceMappingURL=activity.js.map\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityEntity_1 = __webpack_require__(7);\r\nvar logger_1 = __webpack_require__(4);\r\nvar util = __webpack_require__(1);\r\nvar util_1 = __webpack_require__(1);\r\nvar entityEvent_1 = __webpack_require__(2);\r\n/**\r\n * A window participating in an activity\r\n *\r\n * @module activityWindow\r\n */\r\nvar ActivityWindow = /** @class */ (function (_super) {\r\n    __extends(ActivityWindow, _super);\r\n    function ActivityWindow(id, name, type, activityId, instance, isIndependent, windowGetter, hcWindowId) {\r\n        var _this = _super.call(this, id) || this;\r\n        _this._logger = logger_1.Logger.Get(\"window\");\r\n        _this._type = type;\r\n        _this._activityId = activityId;\r\n        _this._name = name;\r\n        _this._instance = instance;\r\n        _this._isIndependent = isIndependent;\r\n        _this._windowGetter = windowGetter;\r\n        _this._hcWindowId = hcWindowId;\r\n        return _this;\r\n    }\r\n    /**\r\n     * Return window's title\r\n     * @function getBounds\r\n     * @return {Promise<WindowBounds>}\r\n     */\r\n    ActivityWindow.prototype.getBounds = function () {\r\n        return this._manager.getWindowBounds(this.id);\r\n    };\r\n    Object.defineProperty(ActivityWindow.prototype, \"name\", {\r\n        /**\r\n         * @var {string} name The window name\r\n         */\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"isIndependent\", {\r\n        /**\r\n         * @var {bool} isIndependent True if this is an independent window\r\n         */\r\n        get: function () {\r\n            return this._isIndependent;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"type\", {\r\n        /**\r\n         * @var {module:windowType} type The window type\r\n         */\r\n        get: function () {\r\n            if (this._manager) {\r\n                return this._manager.getWindowType(this._type);\r\n            }\r\n            return undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"activity\", {\r\n        /**\r\n         * @var {module:activity} activity The activity that the window is part of\r\n         */\r\n        get: function () {\r\n            if (util.isUndefined(this._activityId)) {\r\n                return undefined;\r\n            }\r\n            return this._manager.getActivityById(this._activityId);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"isOwner\", {\r\n        /**\r\n         * @var {bool} isOwner True if the window is the owner of the activity.\r\n         */\r\n        get: function () {\r\n            var act = this.activity;\r\n            if (util.isUndefined(act)) {\r\n                return false;\r\n            }\r\n            return act.owner.id === this.id;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Sets window's visibility\r\n     *\r\n     * @function setVisible\r\n     * @param {boolean} isVisible\r\n     * @returns {Promise<module:activityWindow>}\r\n     */\r\n    ActivityWindow.prototype.setVisible = function (isVisible, callback) {\r\n        return this._manager.setWindowVisibility(this.id, isVisible);\r\n    };\r\n    /**\r\n     * Activate window\r\n     * @function activate\r\n     * @param {boolean} focus If true then activate window with focus otherwise activate window without focus\r\n     */\r\n    ActivityWindow.prototype.activate = function (focus) {\r\n        return this._manager.activateWindow(this.id, focus);\r\n    };\r\n    /**\r\n     * Sets window's bounds\r\n     * @function setBounds\r\n     *\r\n     * @param {bounds} bounds The new bounds to be applied\r\n     * @returns  {Promise<module:activityWindow>}\r\n     */\r\n    ActivityWindow.prototype.setBounds = function (bounds, callback) {\r\n        return this._manager.setWindowBounds(this.id, bounds, callback);\r\n    };\r\n    /**\r\n     * Closes the window\r\n     *\r\n     * @function close\r\n     * @returns {Promise}\r\n     */\r\n    ActivityWindow.prototype.close = function () {\r\n        return this._manager.closeWindow(this.id);\r\n    };\r\n    Object.defineProperty(ActivityWindow.prototype, \"instance\", {\r\n        /**\r\n         * @var {agmInstance} instance The agm instance of that window. You can use this to invoke AGM methods against that window\r\n         */\r\n        get: function () {\r\n            return this._instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"underlyingWindow\", {\r\n        /**\r\n         * Returns the window as object from Windows API (glue.windows).\r\n         *\r\n         * @var {window} underlyingWindow\r\n         */\r\n        get: function () {\r\n            var window = this._windowGetter();\r\n            if (!window) {\r\n                // we don't have the window object any more, let's return as much as we can\r\n                return {\r\n                    id: this._hcWindowId\r\n                };\r\n            }\r\n            return window;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityWindow.prototype.onActivityJoined = function (callback) {\r\n        this._subscribeForActivityWindowEvent(entityEvent_1.EntityEventType.ActivityWindowJoinedActivity, callback);\r\n    };\r\n    ActivityWindow.prototype.onActivityRemoved = function (callback) {\r\n        this._subscribeForActivityWindowEvent(entityEvent_1.EntityEventType.ActivityWindowLeftActivity, callback);\r\n    };\r\n    ActivityWindow.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        util_1.ifNotUndefined(other._activityId, function (x) { return _this._activityId = x; });\r\n        util_1.ifNotUndefined(other._isIndependent, function (x) { return _this._isIndependent = x; });\r\n        util_1.ifNotUndefined(other._hcWindowId, function (x) { return _this._hcWindowId = x; });\r\n        util_1.ifNotUndefined(other._type, function (x) { return _this._type = x; });\r\n        util_1.ifNotUndefined(other._name, function (x) { return _this._name = x; });\r\n        if (!util.isUndefinedOrNull(other._instance)) {\r\n            this._instance = other._instance;\r\n        }\r\n    };\r\n    ActivityWindow.prototype._subscribeForActivityWindowEvent = function (eventName, callback) {\r\n        var _this = this;\r\n        this._manager.subscribeWindowEvents(function (activity, window, event) {\r\n            // ignore events not related to this window\r\n            if (window.id !== _this.id) {\r\n                return;\r\n            }\r\n            if (event === eventName) {\r\n                callback(activity);\r\n            }\r\n        });\r\n    };\r\n    ActivityWindow.prototype._beforeDelete = function (other) {\r\n        this._hcWindowId = other._hcWindowId;\r\n    };\r\n    return ActivityWindow;\r\n}(activityEntity_1.default));\r\nexports.default = ActivityWindow;\r\n//# sourceMappingURL=activityWindow.js.map\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityEntity_1 = __webpack_require__(7);\r\n/**\r\n * A window type is a definition of a window, typically configured in ACS.\r\n *\r\n * @module windowType\r\n */\r\nvar WindowType = /** @class */ (function (_super) {\r\n    __extends(WindowType, _super);\r\n    function WindowType(name, appByWindowTypeGetter) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this._name = name;\r\n        _this._appByWindowTypeGetter = appByWindowTypeGetter;\r\n        return _this;\r\n    }\r\n    Object.defineProperty(WindowType.prototype, \"name\", {\r\n        /**\r\n         * Name of the window type\r\n         * @var {string} name\r\n         */\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(WindowType.prototype, \"config\", {\r\n        /**\r\n         * Returns the ACS configuration related to this window type (as application object from AppManager API)\r\n         * @returns {any}\r\n         */\r\n        get: function () {\r\n            return this._appByWindowTypeGetter(this._name);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(WindowType.prototype, \"windows\", {\r\n        /**\r\n         * @var {activityWindow[]} windows All windows from that type\r\n         */\r\n        get: function () {\r\n            return this._manager.getWindows({ type: this._name });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowType.prototype.create = function (activity, configuration) {\r\n        var definition = Object.assign({ type: this.name, name: this.name, isIndependent: false }, configuration);\r\n        return this._manager.createWindow(activity, definition);\r\n    };\r\n    return WindowType;\r\n}(activityEntity_1.default));\r\nexports.default = WindowType;\r\n//# sourceMappingURL=windowType.js.map\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar logger_1 = __webpack_require__(4);\r\nvar util = __webpack_require__(1);\r\n/**\r\n * Class that can be used as a marker for successful completion of a set of events\r\n * @private\r\n * @module readyMarker\r\n */\r\nvar ReadyMarker = /** @class */ (function () {\r\n    /**\r\n     * Creates new marker\r\n     * @param name Name of the marker, useful in logging\r\n     * @param signalsToWait Number of signals(events) that needs to be signaled (completed) before the marker is set as completed\r\n     */\r\n    function ReadyMarker(name, signalsToWait) {\r\n        this._logger = logger_1.Logger.Get(\"ReadyMarker [\" + name + \"]\");\r\n        this._logger.debug(\"Initializing ready marker for '\" + name + \"' with \" + signalsToWait + \" signals to wait\");\r\n        if (signalsToWait <= 0) {\r\n            throw new Error(\"Invalid signal number. Should be > 0\");\r\n        }\r\n        this._signals = signalsToWait;\r\n        this._callbacks = [];\r\n        this._name = name;\r\n    }\r\n    /**\r\n     * Adds a new callback that will be notified when the events are completed (success) or some error happened\r\n     */\r\n    ReadyMarker.prototype.setCallback = function (callback) {\r\n        if (this.isSet()) {\r\n            callback(undefined);\r\n            return;\r\n        }\r\n        else if (this.isError()) {\r\n            callback(this._error);\r\n            return;\r\n        }\r\n        this._callbacks.push(callback);\r\n    };\r\n    /**\r\n     * Signals for a completion of an event. If this is the last event success callbacks will be called\r\n     */\r\n    ReadyMarker.prototype.signal = function (message) {\r\n        this._logger.debug(\"Signaled - \" + message + \" - signals left \" + (this._signals - 1));\r\n        this._signals--;\r\n        if (this._signals < 0) {\r\n            throw new Error(\"Error in ready marker '\" + this._name + \" - signals are \" + this._signals);\r\n        }\r\n        if (this.isSet()) {\r\n            this._callbacks.forEach(function (callback) {\r\n                callback(undefined);\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Signals for an error in some of the events. This will notify all callbacks that the marker has failed\r\n     */\r\n    ReadyMarker.prototype.error = function (error) {\r\n        this._error = error;\r\n        this._callbacks.forEach(function (errorCallback) {\r\n            errorCallback(error);\r\n        });\r\n    };\r\n    /**\r\n     * Checks if the marker is set (completed)\r\n     */\r\n    ReadyMarker.prototype.isSet = function () {\r\n        if (this.isError()) {\r\n            return false;\r\n        }\r\n        return this._signals === 0;\r\n    };\r\n    /**\r\n     * Checks if the marker has failed (some of the events has failed)\r\n     */\r\n    ReadyMarker.prototype.isError = function () {\r\n        return !util.isUndefined(this._error);\r\n    };\r\n    /**\r\n     * Returns the last reported error (undefined if no error)\r\n     */\r\n    ReadyMarker.prototype.getError = function () {\r\n        return this._error;\r\n    };\r\n    return ReadyMarker;\r\n}());\r\nexports.ReadyMarker = ReadyMarker;\r\n//# sourceMappingURL=readyMarker.js.map\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar LayoutImpl = /** @class */ (function () {\r\n    function LayoutImpl(data) {\r\n        this.name = data.name;\r\n        this.type = data.type;\r\n        this.components = data.components;\r\n        this.context = data.context;\r\n        this.metadata = data.metadata;\r\n    }\r\n    return LayoutImpl;\r\n}());\r\nexports.default = LayoutImpl;\r\n//# sourceMappingURL=layout.js.map\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n// provides a unified way to access layouts array\r\nvar LayoutStore = /** @class */ (function () {\r\n    function LayoutStore() {\r\n        this.layouts = [];\r\n    }\r\n    LayoutStore.prototype.removeWhere = function (condition) {\r\n        this.layouts = this.layouts.filter(condition);\r\n    };\r\n    LayoutStore.prototype.add = function (item) {\r\n        this.layouts.push(item);\r\n    };\r\n    Object.defineProperty(LayoutStore.prototype, \"all\", {\r\n        get: function () {\r\n            return this.layouts;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LayoutStore.prototype.where = function (condition) {\r\n        return this.layouts.filter(condition);\r\n    };\r\n    LayoutStore.prototype.first = function (condition) {\r\n        return this.where(condition)[0];\r\n    };\r\n    return LayoutStore;\r\n}());\r\nexports.LayoutStore = LayoutStore;\r\nexports.default = new LayoutStore();\r\n//# sourceMappingURL=store.js.map\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n// A simple transformation that makes object to start with lowercase\r\n// Note that this is not full implementation as it supports only:\r\n// undefined, null, arrays, number, string, bool. Anything out of this\r\n// list is considered Object\r\nfunction transformACSLayout(something) {\r\n    if (!something) {\r\n        return something;\r\n    }\r\n    if (Array.isArray(something)) {\r\n        return something.map(function (item) {\r\n            return transformACSLayout(item);\r\n        });\r\n    }\r\n    if (typeof something === \"string\" || typeof something === \"number\" || typeof something === \"boolean\") {\r\n        return something;\r\n    }\r\n    var initial = {};\r\n    return Object.keys(something).reduce(function (accumulator, current) {\r\n        var value = something[current];\r\n        var convertedValue = transformACSLayout(value);\r\n        var key = current;\r\n        if (current[0].toLowerCase() !== current[0]) {\r\n            key = current[0].toLowerCase() + current.substr(1);\r\n        }\r\n        accumulator[key] = convertedValue;\r\n        return accumulator;\r\n    }, initial);\r\n}\r\nexports.default = transformACSLayout;\r\n//# sourceMappingURL=transform.js.map\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar store_1 = __webpack_require__(3);\r\nfunction getWindowsByTabGroupId(windowId, tabGroupId) {\r\n    var windows = store_1.default.list;\r\n    return Object.keys(windows).reduce(function (memo, id) {\r\n        var win = windows[id];\r\n        if (win.API.tabGroupId === tabGroupId && win.API.id !== windowId) {\r\n            memo[id] = win;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nexports.getWindowsByTabGroupId = getWindowsByTabGroupId;\r\n//# sourceMappingURL=helpers.js.map\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(0);\r\nvar store_1 = __webpack_require__(3);\r\nexports.default = (function (id, options, executor, logger, appManagerGetter) {\r\n    var _registry = callback_registry_1.default();\r\n    var _logger = logger.subLogger(\"window \" + id);\r\n    var _name = options.name;\r\n    var _mode = options.mode;\r\n    var _url = options.url;\r\n    var _title = options.title;\r\n    var _context = options.context || {};\r\n    var _bounds = options.bounds;\r\n    var _frameColor = options.frameColor;\r\n    var _focus = options.focus;\r\n    var _neighbours = options.neighbours || {};\r\n    var _groupId = options.groupId;\r\n    var _isGroupHeaderVisible = options.isGroupHeaderVisible;\r\n    var _isTabHeaderVisible = options.isTabHeaderVisible;\r\n    var _isTabSelected = options.isTabSelected;\r\n    var _settings = options.settings;\r\n    // is Window visible\r\n    var _isVisible = options.isVisible;\r\n    // Window state Collapsed | Expanded\r\n    var isCollapsed = options.isCollapsed;\r\n    // Window state normal | maximized | minimized\r\n    var _windowState = options.state;\r\n    // tabGroupId only for window with 'Tab' mode\r\n    var _tabGroupId = options.tabGroupId;\r\n    // window is locked or unlocked;\r\n    var _isLocked = options.isLocked;\r\n    var _group;\r\n    var resultWindow;\r\n    // Holding all frame buttons\r\n    var _frameButtons = [];\r\n    //#region \"AGM methods\"\r\n    function close(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.close(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function navigate(newUrl, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.navigate(resultWindow, newUrl)\r\n                .then(function () {\r\n                if (newUrl === _url) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onUrlChanged(function (url, win) {\r\n                    if (win.id === id && url === win.url) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setStyle(style, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setStyle(resultWindow, style)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setTitle(newTitle, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setTitle(resultWindow, newTitle)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n        // OPTION 2\r\n        // const promise = executor.setTitle(resultWindow, newTitle)\r\n        // return promisify\r\n    }\r\n    function moveResize(dimensions, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.moveResize(resultWindow, dimensions)\r\n                .then(function () {\r\n                var areHeightsEqual = dimensions.height ? _bounds.height === dimensions.height : true;\r\n                var areWidthsEqual = dimensions.width ? _bounds.width === dimensions.width : true;\r\n                var areLeftsEqual = dimensions.left ? _bounds.left === dimensions.left : true;\r\n                var areTopsEqual = dimensions.top ? _bounds.top === dimensions.top : true;\r\n                if (areHeightsEqual &&\r\n                    areWidthsEqual &&\r\n                    areLeftsEqual &&\r\n                    areTopsEqual) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onBoundsChanged(function (win) {\r\n                    areHeightsEqual = dimensions.height ? win.bounds.height === dimensions.height : true;\r\n                    areWidthsEqual = dimensions.width ? win.bounds.width === dimensions.width : true;\r\n                    areLeftsEqual = dimensions.left ? win.bounds.left === dimensions.left : true;\r\n                    areTopsEqual = dimensions.top ? win.bounds.top === dimensions.top : true;\r\n                    if (win.id === resultWindow.id &&\r\n                        areHeightsEqual &&\r\n                        areWidthsEqual &&\r\n                        areLeftsEqual &&\r\n                        areTopsEqual) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function addFrameButton(buttonInfo, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof buttonInfo === \"undefined\") {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No button info\");\r\n                    return;\r\n                }\r\n                reject(\"No button info\");\r\n                return;\r\n            }\r\n            if (buttonInfo.buttonId === undefined) {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No buttonId\");\r\n                    return;\r\n                }\r\n                reject(\"No buttonId\");\r\n                return;\r\n            }\r\n            if (buttonInfo.imageBase64 === undefined) {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No imageBase64\");\r\n                    return;\r\n                }\r\n                reject(\"No imageBase64\");\r\n                return;\r\n            }\r\n            executor.addFrameButton(resultWindow, buttonInfo)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function removeFrameButton(buttonId, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (buttonId === undefined || buttonId === \"\") {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No buttonId\");\r\n                    return;\r\n                }\r\n                reject(\"No buttonId\");\r\n                return;\r\n            }\r\n            executor.removeFrameButton(resultWindow, buttonId)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function activate(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.activate(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function focus(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.focus(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function maximizeRestore(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var currEvent = _windowState === \"normal\" ? onMaximized : onNormal;\r\n            executor.maximizeRestore(resultWindow)\r\n                .then(function () {\r\n                var un = currEvent(function () {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    if (un) {\r\n                        un();\r\n                    }\r\n                    resolve(resultWindow);\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function maximize(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.maximize(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"maximized\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onMaximized(function (win) {\r\n                    if (win.id === id && win.state === \"maximized\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function restore(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.restore(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"normal\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onNormal(function (win) {\r\n                    if (id === win.id && win.state === \"normal\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function minimize(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.minimize(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"minimized\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onMinimized(function (win) {\r\n                    if (id === win.id && win.state === \"minimized\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        return resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function collapse(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (isCollapsed) {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                return resolve(resultWindow);\r\n            }\r\n            executor.collapse(resultWindow)\r\n                .then(function () {\r\n                if (isCollapsed) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onCollapsed(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function expand(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (!isCollapsed) {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                return resolve(resultWindow);\r\n            }\r\n            executor.expand(resultWindow)\r\n                .then(function () {\r\n                if (!isCollapsed) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onExpanded(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function toggleCollapse(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var currEvent = isCollapsed ? onExpanded : onCollapsed;\r\n            executor.toggleCollapse(resultWindow)\r\n                .then(function () {\r\n                currEvent(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function snap(target, direction, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.snap(resultWindow, target, direction)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function attachTab(tab, index, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId;\r\n            var targetWindowId = resultWindow.id;\r\n            var errorMessage = \"Invalid tab parameter - should be an object with property id or a string. Invoked for source window id:\" + resultWindow.id;\r\n            if (!tab) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof tab === \"string\") {\r\n                sourceWindowId = tab;\r\n            }\r\n            else if (typeof tab.id !== \"undefined\") {\r\n                sourceWindowId = tab.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var argsForSend = {\r\n                sourceWindowId: sourceWindowId,\r\n                targetWindowId: targetWindowId,\r\n            };\r\n            if (index) {\r\n                argsForSend.index = index;\r\n            }\r\n            var sourceWin = store_1.default.get(argsForSend.sourceWindowId).API;\r\n            var un = sourceWin.onAttached(function (win) {\r\n                if (win.id === sourceWin.id) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    un();\r\n                    resolve(resultWindow);\r\n                }\r\n            });\r\n            executor.attachTab(resultWindow, argsForSend)\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                un();\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function detachTab(opt, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var argsForSend = { windowId: resultWindow.id };\r\n            var _options = opt || {};\r\n            if (typeof _options.relativeTo !== \"undefined\") {\r\n                if (typeof _options.relativeTo === \"string\") {\r\n                    argsForSend.relativeTo = _options.relativeTo;\r\n                }\r\n                else if (typeof _options.relativeTo.id !== \"undefined\") {\r\n                    argsForSend.relativeTo = _options.relativeTo.id;\r\n                }\r\n                if (typeof _options.relativeDirection !== \"undefined\") {\r\n                    argsForSend.relativeDirection = _options.relativeDirection;\r\n                }\r\n                if (typeof _options.width !== \"undefined\") {\r\n                    argsForSend.width = _options.width;\r\n                }\r\n                if (typeof _options.height !== \"undefined\") {\r\n                    argsForSend.height = _options.height;\r\n                }\r\n            }\r\n            if (typeof _options.bounds !== \"undefined\") {\r\n                argsForSend.bounds = _options.bounds;\r\n            }\r\n            if (typeof _options.hideTabHeader !== \"undefined\") {\r\n                argsForSend.hideTabHeader = _options.hideTabHeader;\r\n            }\r\n            var visibilityChangeHeard = false;\r\n            var detachedHeard = false;\r\n            var unVisibility = _registry.add(\"frame-attached\", (function (win) {\r\n                var isVisibilityCorrect = _options.hideTabHeader === undefined || _options.hideTabHeader !== win.isTabHeaderVisible;\r\n                if (id === win.id && isVisibilityCorrect) {\r\n                    visibilityChangeHeard = true;\r\n                    unVisibility();\r\n                    if (detachedHeard) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                        if (typeof unDetached === \"function\") {\r\n                            unDetached();\r\n                        }\r\n                    }\r\n                }\r\n            }));\r\n            var unDetached = onDetached(function (win) {\r\n                if (id === win.id) {\r\n                    detachedHeard = true;\r\n                    unDetached();\r\n                    if (visibilityChangeHeard) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                        if (typeof unVisibility === \"function\") {\r\n                            unVisibility();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            executor.detachTab(resultWindow, argsForSend)\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                unDetached();\r\n                unVisibility();\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setVisible(toBeVisible, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setVisible(resultWindow, toBeVisible)\r\n                .then(function () {\r\n                var isVisibilityCorrect = toBeVisible === undefined ? _isVisible === true : _isVisible === toBeVisible;\r\n                if (isVisibilityCorrect) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onVisibilityChanged(function (win) {\r\n                    isVisibilityCorrect = toBeVisible === undefined ? win.isVisible === true : win.isVisible === toBeVisible;\r\n                    if (win.id === id && isVisibilityCorrect) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function showLoader(loader) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.showLoader(resultWindow, loader)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function hideLoader() {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.hideLoader(resultWindow)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function updateContext(context, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.updateContext(resultWindow, context)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function lock(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.lock(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function unlock(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.unlock(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function getIcon(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            // agm.invoke(\"T42.Wnd.GetIcon\", { windowId: resultWindow.id }, \"best\", {}, successHandler, error);\r\n            executor.getIcon(resultWindow)\r\n                .then(function (icon) {\r\n                if (typeof success === \"function\") {\r\n                    success(icon);\r\n                }\r\n                resolve(icon);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setIcon(base64Image, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setIcon(resultWindow, base64Image)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setFrameColor(frameColor, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setFrameColor(resultWindow, frameColor)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setTabHeaderVisible(toBeTabHeaderVisible, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setTabHeaderVisible(resultWindow, toBeTabHeaderVisible)\r\n                .then(function () {\r\n                if (_isTabHeaderVisible === toBeTabHeaderVisible) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onTabHeaderVisibilityChanged(function (win) {\r\n                    if (win.id === id && win.isTabHeaderVisible === toBeTabHeaderVisible) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    //#endregion \"AGM methods\"\r\n    //#region \"Events\"\r\n    function onTitleChanged(callback) {\r\n        callback(resultWindow.title, resultWindow);\r\n        return _registry.add(\"onTitleChanged\", callback);\r\n    }\r\n    function onClose(callback) {\r\n        return _registry.add(\"onClose\", callback);\r\n    }\r\n    function onUrlChanged(callback) {\r\n        return _registry.add(\"onUrlChanged\", callback);\r\n    }\r\n    function onFrameButtonAdded(callback) {\r\n        return _registry.add(\"onFrameButtonAdded\", callback);\r\n    }\r\n    function onFrameButtonRemoved(callback) {\r\n        return _registry.add(\"onFrameButtonRemoved\", callback);\r\n    }\r\n    function onFrameButtonClicked(callback) {\r\n        return _registry.add(\"onFrameButtonClicked\", callback);\r\n    }\r\n    function onCollapsed(callback) {\r\n        if (isCollapsed) {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"collapsed\", callback);\r\n    }\r\n    function onExpanded(callback) {\r\n        if (!isCollapsed) {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"expanded\", callback);\r\n    }\r\n    function onMaximized(callback) {\r\n        if (_windowState === \"maximized\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"maximized\", callback);\r\n    }\r\n    function onMinimized(callback) {\r\n        if (_windowState === \"minimized\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"minimized\", callback);\r\n    }\r\n    function onNormal(callback) {\r\n        if (_windowState === \"normal\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"normal\", callback);\r\n    }\r\n    function onAttached(callback) {\r\n        return _registry.add(\"attached\", callback);\r\n    }\r\n    function onDetached(callback) {\r\n        return _registry.add(\"detached\", callback);\r\n    }\r\n    function onVisibilityChanged(callback) {\r\n        return _registry.add(\"visibility-changed\", callback);\r\n    }\r\n    function onContextUpdated(callback) {\r\n        return _registry.add(\"context-updated\", callback);\r\n    }\r\n    function onLockingChanged(callback) {\r\n        return _registry.add(\"lock-changed\", callback);\r\n    }\r\n    function onBoundsChanged(callback) {\r\n        return _registry.add(\"bounds-changed\", callback);\r\n    }\r\n    function onFocusChanged(callback) {\r\n        return _registry.add(\"focus-changed\", callback);\r\n    }\r\n    function onFrameColorChanged(callback) {\r\n        return _registry.add(\"frame-color-changed\", callback);\r\n    }\r\n    function onTabHeaderVisibilityChanged(callback) {\r\n        return _registry.add(\"tab-header-visibility-changed\", callback);\r\n    }\r\n    function onWindowAttached(callback) {\r\n        return _registry.add(\"window-attached\", callback);\r\n    }\r\n    function onWindowDetached(callback) {\r\n        return _registry.add(\"window-detached\", callback);\r\n    }\r\n    function onGroupChanged(callback) {\r\n        return _registry.add(\"group-changed\", callback);\r\n    }\r\n    function onTabSelectionChanged(callback) {\r\n        return _registry.add(\"tab-selection-changed\", callback);\r\n    }\r\n    //#endregion \"Events\"\r\n    //#region \"Stream function\"\r\n    function handleTitleChanged(newTitle) {\r\n        _title = newTitle;\r\n        _registry.execute(\"onTitleChanged\", newTitle, resultWindow);\r\n    }\r\n    function handleUrlChanged(newUrl) {\r\n        _url = newUrl;\r\n        _registry.execute(\"onUrlChanged\", newUrl, resultWindow);\r\n    }\r\n    function handleVisibilityChanged(isVisible) {\r\n        if (isVisible === _isVisible) {\r\n            return;\r\n        }\r\n        _isVisible = isVisible;\r\n        _registry.execute(\"visibility-changed\", resultWindow);\r\n    }\r\n    function handleWindowSettingsChanged(settings) {\r\n        _settings = settings;\r\n        _registry.execute(\"settings-changed\", resultWindow);\r\n    }\r\n    function handleContextUpdated(context) {\r\n        _context = context;\r\n        _registry.execute(\"context-updated\", _context, resultWindow);\r\n    }\r\n    function handleWindowClose() {\r\n        if (resultWindow.id === undefined) {\r\n            return;\r\n        }\r\n        resultWindow.id = undefined;\r\n        _registry.execute(\"onClose\", resultWindow);\r\n    }\r\n    function handleFrameButtonAdded(frameButton) {\r\n        var buttonObj = [\"buttonId\", \"imageBase64\", \"order\", \"tooltip\"].reduce(function (memo, k) {\r\n            memo[k] = frameButton[k];\r\n            return memo;\r\n        }, {});\r\n        var frameButtonsIds = _frameButtons.map(function (btn) {\r\n            return btn.buttonId;\r\n        });\r\n        if (frameButtonsIds.indexOf(frameButton.buttonId) === -1) {\r\n            _frameButtons.push(buttonObj);\r\n        }\r\n        _registry.execute(\"onFrameButtonAdded\", buttonObj, resultWindow);\r\n    }\r\n    function handleFrameButtonRemoved(frameButtonId) {\r\n        var button;\r\n        _frameButtons = _frameButtons.reduce(function (memo, btn) {\r\n            if (btn.buttonId === frameButtonId) {\r\n                button = btn;\r\n            }\r\n            else {\r\n                memo.push(btn);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (button !== undefined) {\r\n            _registry.execute(\"onFrameButtonRemoved\", button, resultWindow);\r\n        }\r\n    }\r\n    function handleFrameButtonClicked(frameButton) {\r\n        var button = _frameButtons.filter(function (btn) {\r\n            return btn.buttonId === frameButton.buttonId;\r\n        });\r\n        if (button.length > 0) {\r\n            _registry.execute(\"onFrameButtonClicked\", button[0], resultWindow);\r\n        }\r\n    }\r\n    function handleWindowChangeState(state) {\r\n        if (state === \"collapsed\") {\r\n            isCollapsed = true;\r\n        }\r\n        else if (state === \"expanded\") {\r\n            isCollapsed = false;\r\n        }\r\n        else {\r\n            _windowState = state;\r\n        }\r\n        _registry.execute(state, resultWindow);\r\n    }\r\n    function handleFrameIsLockedChanged(isLocked) {\r\n        _isLocked = isLocked;\r\n        _registry.execute(\"lock-changed\", resultWindow);\r\n    }\r\n    function handleBoundsChanged(bounds) {\r\n        if (_bounds.top === bounds.top && _bounds.left === bounds.left && _bounds.width === bounds.width && _bounds.height === bounds.height) {\r\n            return;\r\n        }\r\n        _bounds.top = bounds.top;\r\n        _bounds.left = bounds.left;\r\n        _bounds.width = bounds.width;\r\n        _bounds.height = bounds.height;\r\n        _registry.execute(\"bounds-changed\", resultWindow);\r\n    }\r\n    function handleFocusChanged(isFocused) {\r\n        _focus = isFocused;\r\n        _registry.execute(\"focus-changed\", resultWindow);\r\n    }\r\n    function handleFrameColorChanged(frameColor) {\r\n        _frameColor = frameColor;\r\n        _registry.execute(\"frame-color-changed\", resultWindow);\r\n    }\r\n    function handleFrameAttached(tabGroupId, isTabHeaderVisible) {\r\n        _tabGroupId = tabGroupId;\r\n        _isTabHeaderVisible = isTabHeaderVisible;\r\n        _registry.execute(\"frame-attached\", resultWindow);\r\n    }\r\n    function handleCompositionChanged(neighbours, groupId) {\r\n        _neighbours = neighbours || {};\r\n        _groupId = groupId;\r\n    }\r\n    function handleGroupHeaderVisibilityChanged(isGroupHeaderVisible) {\r\n        _isGroupHeaderVisible = isGroupHeaderVisible;\r\n    }\r\n    function handleTabHeaderVisibilityChanged(isTabHeaderVisible) {\r\n        if (_isTabHeaderVisible !== isTabHeaderVisible) {\r\n            _isTabHeaderVisible = isTabHeaderVisible;\r\n            _registry.execute(\"tab-header-visibility-changed\", resultWindow);\r\n        }\r\n    }\r\n    function handleFrameSelectionChanged(newWindow, prevWindow) {\r\n        var selectedWindow;\r\n        if (typeof newWindow !== \"undefined\" && newWindow === id) {\r\n            _isTabSelected = true;\r\n            selectedWindow = resultWindow;\r\n        }\r\n        else {\r\n            _isTabSelected = false;\r\n            selectedWindow = store_1.default.get(newWindow) ? store_1.default.get(newWindow).API : undefined;\r\n        }\r\n        var previousWindow = store_1.default.get(prevWindow) ? store_1.default.get(prevWindow).API : undefined;\r\n        if (_isTabSelected && previousWindow) {\r\n            var un_1 = previousWindow.onTabSelectionChanged(function (newWin, prevWin) {\r\n                if ((prevWin && prevWin.id) === previousWindow.id) {\r\n                    un_1();\r\n                    _registry.execute(\"tab-selection-changed\", selectedWindow, previousWindow, resultWindow);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            _registry.execute(\"tab-selection-changed\", selectedWindow, previousWindow, resultWindow);\r\n        }\r\n    }\r\n    function handleAttached(newTabGroupId, tabHeaderVisible) {\r\n        _tabGroupId = newTabGroupId;\r\n        _isTabHeaderVisible = tabHeaderVisible;\r\n        _registry.execute(\"attached\", resultWindow);\r\n    }\r\n    function handleWindowAttached(win) {\r\n        _registry.execute(\"window-attached\", win);\r\n    }\r\n    function handleDetached(tabGroupId) {\r\n        _tabGroupId = tabGroupId;\r\n        // this tabGroupId is always the same as the current one\r\n        // the tabGroupId is actually changed in the frame-attached event\r\n        var un = _registry.add(\"frame-attached\", function (win) {\r\n            if (win.id === id) {\r\n                un();\r\n                _registry.execute(\"detached\", resultWindow);\r\n            }\r\n        });\r\n    }\r\n    function handleWindowDetached(win) {\r\n        _registry.execute(\"window-detached\", win);\r\n    }\r\n    //#endregion \"Stream function\"\r\n    //#region \"Group Events\"\r\n    function handleGroupChanged(newGroup, oldGroup) {\r\n        logger.trace(\"handle group changed to win: \" + id + \" with group id: \" + newGroup.id);\r\n        _group = newGroup;\r\n        _groupId = newGroup.id;\r\n        _registry.execute(\"group-changed\", resultWindow, newGroup, oldGroup);\r\n    }\r\n    // This is used to set the relation from window to corespondent group API, it could be undefined, if the window is removed from group\r\n    function handleGroupAssociation(group) {\r\n        if (group) {\r\n            _logger.trace(\"setting group to win: \" + id + \" with group id: \" + group.id);\r\n        }\r\n        _group = group;\r\n    }\r\n    //#region \"Internal function\"\r\n    function getAllTabs() {\r\n        var allWindows = store_1.default.list;\r\n        if (_mode.toLowerCase() !== \"tab\") {\r\n            return [];\r\n        }\r\n        return Object.keys(allWindows).reduce(function (memo, win) {\r\n            var window = allWindows[win];\r\n            if (window\r\n                && window.API.tabGroupId\r\n                && typeof window.API.tabGroupId !== \"undefined\"\r\n                && typeof resultWindow.tabGroupId !== \"undefined\"\r\n                && window.API.tabGroupId === resultWindow.tabGroupId) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    }\r\n    function mapWindowIdsToWindowObjects(windowIdArr) {\r\n        return windowIdArr.reduce(function (memo, winId) {\r\n            var window = store_1.default.get(winId);\r\n            if (window) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    }\r\n    function getNeighboursByDirection(direction) {\r\n        var windowIds = _neighbours[direction];\r\n        if (typeof windowIds !== \"undefined\") {\r\n            return mapWindowIdsToWindowObjects(windowIds);\r\n        }\r\n    }\r\n    function getApplicationName() {\r\n        if (_context._APPLICATION_NAME) {\r\n            return _context._APPLICATION_NAME;\r\n        }\r\n        if (_context && _context._t42 && _context._t42.application) {\r\n            return _context._t42.application;\r\n        }\r\n        var info = getWindowInfo();\r\n        if (!info) {\r\n            return undefined;\r\n        }\r\n        return info.applicationName;\r\n    }\r\n    function getWindowInfo() {\r\n        if (typeof window.glue42gd !== \"undefined\" && window.glue42gd.getWindowInfo) {\r\n            var info = window.glue42gd.getWindowInfo(id);\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            else {\r\n                return info;\r\n            }\r\n        }\r\n    }\r\n    //#endregion \"Internal function\"\r\n    //#region \"API\"\r\n    resultWindow = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get application() {\r\n            var appManager = appManagerGetter();\r\n            return appManager ? appManager.application(getApplicationName()) : undefined;\r\n        },\r\n        get hostInstance() {\r\n            return executor.hostInstance;\r\n        },\r\n        get agmInstance() {\r\n            var appName = getApplicationName();\r\n            return appName ? { application: appName } : undefined;\r\n        },\r\n        get url() {\r\n            return _url;\r\n        },\r\n        id: id,\r\n        get title() {\r\n            return _title;\r\n        },\r\n        get windowStyleAttributes() {\r\n            return _settings;\r\n        },\r\n        get settings() {\r\n            return _settings;\r\n        },\r\n        get tabGroupId() {\r\n            return _mode.toLowerCase() === \"tab\" ? _tabGroupId : undefined;\r\n        },\r\n        get frameButtons() {\r\n            return _frameButtons;\r\n        },\r\n        get mode() {\r\n            return _mode;\r\n        },\r\n        get state() {\r\n            return _windowState;\r\n        },\r\n        get isCollapsed() {\r\n            return isCollapsed;\r\n        },\r\n        get isVisible() {\r\n            return _isVisible;\r\n        },\r\n        get isLocked() {\r\n            return _isLocked;\r\n        },\r\n        get context() {\r\n            return _context;\r\n        },\r\n        get bounds() {\r\n            return _bounds;\r\n        },\r\n        get isFocused() {\r\n            return _focus;\r\n        },\r\n        get frameColor() {\r\n            return _frameColor;\r\n        },\r\n        get opened() {\r\n            return resultWindow.id !== undefined;\r\n        },\r\n        get group() {\r\n            return _group;\r\n        },\r\n        get groupId() {\r\n            return _groupId;\r\n        },\r\n        get topNeighbours() {\r\n            return getNeighboursByDirection(\"top\");\r\n        },\r\n        get leftNeighbours() {\r\n            return getNeighboursByDirection(\"left\");\r\n        },\r\n        get rightNeighbours() {\r\n            return getNeighboursByDirection(\"right\");\r\n        },\r\n        get bottomNeighbours() {\r\n            return getNeighboursByDirection(\"bottom\");\r\n        },\r\n        get isGroupHeaderVisible() {\r\n            return _isGroupHeaderVisible;\r\n        },\r\n        get activityId() {\r\n            if (_context._t42) {\r\n                return _context._t42.activityId;\r\n            }\r\n            var info = getWindowInfo();\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            return info.activityId;\r\n        },\r\n        get activityWindowId() {\r\n            if (_context._t42) {\r\n                return _context._t42.activityWindowId;\r\n            }\r\n            var info = getWindowInfo();\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            return info.activityWindowId;\r\n        },\r\n        get windowType() {\r\n            return options.windowType || \"electron\";\r\n        },\r\n        maximize: maximize,\r\n        restore: restore,\r\n        minimize: minimize,\r\n        maximizeRestore: maximizeRestore,\r\n        collapse: collapse,\r\n        expand: expand,\r\n        toggleCollapse: toggleCollapse,\r\n        focus: focus,\r\n        activate: activate,\r\n        moveResize: moveResize,\r\n        setTitle: setTitle,\r\n        setStyle: setStyle,\r\n        navigate: navigate,\r\n        addFrameButton: addFrameButton,\r\n        removeFrameButton: removeFrameButton,\r\n        setVisible: setVisible,\r\n        close: close,\r\n        snap: snap,\r\n        showLoader: showLoader,\r\n        hideLoader: hideLoader,\r\n        updateContext: updateContext,\r\n        lock: lock,\r\n        unlock: unlock,\r\n        getIcon: getIcon,\r\n        setIcon: setIcon,\r\n        setFrameColor: setFrameColor,\r\n        attachTab: attachTab,\r\n        detachTab: detachTab,\r\n        setTabHeaderVisible: setTabHeaderVisible,\r\n        onClose: onClose,\r\n        onUrlChanged: onUrlChanged,\r\n        onTitleChanged: onTitleChanged,\r\n        onFrameButtonAdded: onFrameButtonAdded,\r\n        onFrameButtonRemoved: onFrameButtonRemoved,\r\n        onFrameButtonClicked: onFrameButtonClicked,\r\n        onCollapsed: onCollapsed,\r\n        onExpanded: onExpanded,\r\n        onMinimized: onMinimized,\r\n        onMaximized: onMaximized,\r\n        onNormal: onNormal,\r\n        onAttached: onAttached,\r\n        onDetached: onDetached,\r\n        onVisibilityChanged: onVisibilityChanged,\r\n        onContextUpdated: onContextUpdated,\r\n        onLockingChanged: onLockingChanged,\r\n        onBoundsChanged: onBoundsChanged,\r\n        onFrameColorChanged: onFrameColorChanged,\r\n        onFocusChanged: onFocusChanged,\r\n        onGroupChanged: onGroupChanged,\r\n        onWindowAttached: onWindowAttached,\r\n        onWindowDetached: onWindowDetached,\r\n        onTabSelectionChanged: onTabSelectionChanged,\r\n        onTabHeaderVisibilityChanged: onTabHeaderVisibilityChanged,\r\n        get tabs() {\r\n            return getAllTabs();\r\n        },\r\n        get isTabHeaderVisible() {\r\n            return _isTabHeaderVisible;\r\n        },\r\n        get isTabSelected() {\r\n            return _isTabSelected;\r\n        },\r\n    };\r\n    //#endregion \"API\"\r\n    //#endregion \"Group Events\"\r\n    var events = {\r\n        handleWindowClose: handleWindowClose,\r\n        handleWindowChangeState: handleWindowChangeState,\r\n        handleTitleChanged: handleTitleChanged,\r\n        handleVisibilityChanged: handleVisibilityChanged,\r\n        handleUrlChanged: handleUrlChanged,\r\n        handleWindowSettingsChanged: handleWindowSettingsChanged,\r\n        handleContextUpdated: handleContextUpdated,\r\n        handleFrameIsLockedChanged: handleFrameIsLockedChanged,\r\n        handleBoundsChanged: handleBoundsChanged,\r\n        handleFocusChanged: handleFocusChanged,\r\n        handleFrameButtonAdded: handleFrameButtonAdded,\r\n        handleFrameButtonRemoved: handleFrameButtonRemoved,\r\n        handleFrameButtonClicked: handleFrameButtonClicked,\r\n        handleFrameColorChanged: handleFrameColorChanged,\r\n        handleFrameAttached: handleFrameAttached,\r\n        handleFrameSelectionChanged: handleFrameSelectionChanged,\r\n        handleCompositionChanged: handleCompositionChanged,\r\n        handleGroupHeaderVisibilityChanged: handleGroupHeaderVisibilityChanged,\r\n        handleTabHeaderVisibilityChanged: handleTabHeaderVisibilityChanged,\r\n        handleGroupChanged: handleGroupChanged,\r\n        handleGroupAssociation: handleGroupAssociation,\r\n        handleAttached: handleAttached,\r\n        handleDetached: handleDetached,\r\n        handleWindowAttached: handleWindowAttached,\r\n        handleWindowDetached: handleWindowDetached,\r\n    };\r\n    return {\r\n        API: resultWindow,\r\n        Events: events,\r\n    };\r\n});\r\n//# sourceMappingURL=window.js.map\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tick42_glue_core_1 = __webpack_require__(36);\r\nvar main_1 = __webpack_require__(48);\r\nvar main_2 = __webpack_require__(55);\r\nvar main_3 = __webpack_require__(78);\r\nvar main_4 = __webpack_require__(66);\r\nvar main_5 = __webpack_require__(60);\r\nvar main_6 = __webpack_require__(63);\r\nvar pjson = __webpack_require__(24);\r\nvar config_1 = __webpack_require__(61);\r\nvar utils_1 = __webpack_require__(70);\r\nexports.default = (function (options) {\r\n    var gdMajorVersion = utils_1.default.getGDMajorVersion();\r\n    // get config object\r\n    // basically selecting some properties (and defaulting them)\r\n    // it's used to extract things like layouts, appManager, activities etc things\r\n    // that glueCore itself doesn't know about\r\n    options = options || {};\r\n    var glueConfig = config_1.default(options);\r\n    options.gateway = options.gateway || {};\r\n    // Init the GLUE namespace\r\n    var hc = typeof window !== \"undefined\" && window.htmlContainer;\r\n    var _appManager;\r\n    var _activity;\r\n    var _windows;\r\n    // dependency graph:\r\n    //   windows: agm, appManager (via getter)\r\n    //   activities: contexts, agm, logger, windows, appManager (via getter)\r\n    //   appManager: agm, windows, logger, activities\r\n    //   layouts: agm, appManager, logger\r\n    function createWindows(core) {\r\n        if (glueConfig.windows) {\r\n            var windowsLogger = getLibLogger(\"windows\", core.logger, glueConfig.windows);\r\n            _windows = main_3.default(core.agm, windowsLogger, function () {\r\n                return _appManager;\r\n            }, gdMajorVersion);\r\n            debugLog(_windows);\r\n            return _windows;\r\n        }\r\n    }\r\n    function createActivities(core) {\r\n        if (glueConfig.activities) {\r\n            if ((gdMajorVersion === 2) ||\r\n                (main_1.ActivityModule.checkIsUsingGW3Implementation &&\r\n                    main_1.ActivityModule.checkIsUsingGW3Implementation(core.connection))) {\r\n                var activityLogger = getLibLogger(\"activity\", core.logger, glueConfig.activities);\r\n                _activity = new main_1.ActivityModule({\r\n                    connection: core.connection,\r\n                    contexts: core.contexts,\r\n                    agm: core.agm,\r\n                    logger: activityLogger,\r\n                    logLevel: \"info\",\r\n                    disableAutoAnnounce: false,\r\n                    disposeRequestHandling: \"ignore\",\r\n                    announcementInfo: null,\r\n                    windows: _windows,\r\n                    appManagerGetter: function () {\r\n                        return _appManager;\r\n                    },\r\n                    mode: glueConfig.activities.mode,\r\n                    typesToTrack: glueConfig.activities.typesToTrack,\r\n                    activityId: typeof window !== \"undefined\" && window.glue42gd && window.glue42gd.activityInfo && window.glue42gd.activityInfo.activityId,\r\n                    gdMajorVersion: gdMajorVersion\r\n                }).api;\r\n                debugLog(_activity);\r\n                return _activity;\r\n            }\r\n        }\r\n    }\r\n    function createAppManager(core) {\r\n        if (!glueConfig.appManager) {\r\n            return;\r\n        }\r\n        var logger = getLibLogger(\"appManager\", core.logger, glueConfig.appManager);\r\n        // AppManager v3\r\n        _appManager = main_2.default({\r\n            agm: core.agm,\r\n            windows: _windows,\r\n            logger: logger,\r\n            activities: _activity,\r\n            mode: glueConfig.appManager.mode,\r\n            gdMajorVersion: gdMajorVersion\r\n        });\r\n        debugLog(_appManager);\r\n        return _appManager;\r\n    }\r\n    function createLayouts(core) {\r\n        if (!glueConfig.layouts) {\r\n            return;\r\n        }\r\n        var logger = getLibLogger(\"layouts\", core.logger, glueConfig.layouts);\r\n        var lay = main_4.default({\r\n            agm: core.agm,\r\n            appManager: _appManager,\r\n            activityGetter: function () { return _activity; },\r\n            logger: logger,\r\n            mode: glueConfig.layouts.mode,\r\n        });\r\n        debugLog(lay);\r\n        return lay;\r\n    }\r\n    function createChannels(core) {\r\n        if (!glueConfig.channels) {\r\n            return;\r\n        }\r\n        if (!core.contexts) {\r\n            // TODO log - notify the user that he can not use channels without context\r\n            return;\r\n        }\r\n        // Logger\r\n        var channelsAPI = main_5.factory(core.contexts, core.agm);\r\n        debugLog(channelsAPI);\r\n        return channelsAPI;\r\n    }\r\n    function createHotkeys(core) {\r\n        var hotkeysAPI = main_6.factory(core.agm);\r\n        debugLog(hotkeysAPI);\r\n        return hotkeysAPI;\r\n    }\r\n    function getLibLogger(loggerName, logger, config) {\r\n        var newLogger = logger.subLogger(loggerName);\r\n        if (config && config.logger) {\r\n            var loggerConfig = config.logger;\r\n            if (loggerConfig.console) {\r\n                newLogger.consoleLevel(loggerConfig.console);\r\n            }\r\n            if (loggerConfig.publish) {\r\n                newLogger.publishLevel(loggerConfig.publish);\r\n            }\r\n            if (loggerConfig.metrics) {\r\n                newLogger.metricsLevel(loggerConfig.metrics);\r\n            }\r\n        }\r\n        return newLogger;\r\n    }\r\n    var ext = {\r\n        // define extra libraries for glue-core to raise\r\n        libs: [\r\n            { name: \"windows\", create: createWindows },\r\n            { name: \"activities\", create: createActivities },\r\n            { name: \"appManager\", create: createAppManager },\r\n            { name: \"layouts\", create: createLayouts },\r\n            { name: \"channels\", create: createChannels },\r\n            { name: \"hotkeys\", create: createHotkeys },\r\n        ],\r\n        version: pjson.version,\r\n        enrichGlue: function (glue) {\r\n            // put some data to config\r\n            glue.config.activities = glueConfig.activities;\r\n            glue.config.windows = glueConfig.windows;\r\n            glue.config.appManager = glueConfig.appManager;\r\n            glue.config.layouts = glueConfig.layouts;\r\n            glue.config.channels = glueConfig.channels;\r\n        },\r\n    };\r\n    var currentLog = [];\r\n    if (typeof window !== \"undefined\") {\r\n        if (!window.glueFactoryLog) {\r\n            window.glueFactoryLog = [];\r\n        }\r\n        window.glueFactoryLog.push(currentLog);\r\n    }\r\n    function debugLog(entry) {\r\n        currentLog.push(entry);\r\n    }\r\n    return tick42_glue_core_1.default(options, ext);\r\n});\r\n//# sourceMappingURL=glue.js.map\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports) {\n\nmodule.exports = {\"name\":\"tick42-glue\",\"description\":\"Tick42 GLUE\",\"version\":\"4.4.1\",\"main\":\"./dist/node/tick42-glue.js\",\"browser\":\"./dist/web/tick42-glue.js\",\"types\":\"./glue.d.ts\",\"docName\":\"Glue\",\"scripts\":{\"init-dev-mode\":\"node ./build/scripts/init-dev-mode.js\",\"remove-installed-dependencies\":\"node ./build/scripts/remove-installed-dependencies.js\",\"clean\":\"node ./build/scripts/clean.js\",\"file-versionify\":\"node ./build/scripts/file-versionify.js\",\"pre:build\":\"npm run tslint && tsc && set NODE_ENV=development && npm run clean\",\"tslint\":\"tslint -t codeFrame ./src/**/*.ts\",\"tslint:fix\":\"tslint -t codeFrame --fix ./src/**/*.ts\",\"watch\":\"onchange ./src/**/*.ts -- npm run build:dev\",\"build:dev\":\"npm run tslint && npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify\",\"prepublish\":\"npm run build:prod && npm run test:only\",\"build:prod\":\"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify\",\"test\":\"npm run build:dev && mocha ./tests\",\"test:only\":\"mocha ./tests\",\"generate-docs\":\"glue-js-documentation-builder build-reference --project g4e -q reference --modules ./glue.d.ts,./node_modules/tick42-glue-core/glue.d.ts\"},\"repository\":{\"type\":\"git\",\"url\":\"https://stash.tick42.com:8443/scm/ofgw/js-glue.git\"},\"author\":{\"name\":\"Tick42\",\"url\":\"http://www.glue42.com\"},\"license\":\"ISC\",\"dependencies\":{\"callback-registry\":\"2.5.1\",\"es6-promise\":\"^4.1.1\",\"object-assign\":\"^4.1.1\",\"shortid\":\"^2.2.8\",\"tick42-glue-core\":\"^4.3.7\",\"tick42-promisify\":\"1.0.3\"},\"devDependencies\":{\"@types/node\":\"^10.7.1\",\"@types/object-assign\":\"^4.0.30\",\"@types/shortid\":\"0.0.29\",\"chai\":\"^4.1.0\",\"glue-js-documentation-builder\":\"*\",\"mocha\":\"^2.4.5\",\"onchange\":\"3.*\",\"pre-commit\":\"^1.1.3\",\"readline-sync\":\"^1.4.5\",\"shelljs\":\"^0.6.0\",\"tick42-gateway\":\"0.2.7\",\"tick42-webpack-config\":\"4.1.6\",\"tslint\":\"^5.5.0\",\"typescript\":\"^3.0.1\",\"webpack\":\"2.3.3\"},\"bundleDependencies\":[\"tick42-glue-core\",\"tick42-promisify\",\"callback-registry\"]}\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports) {\n\n/**\n * Secure random string generator with custom alphabet.\n *\n * Alphabet must contain 256 symbols or less. Otherwise, the generator\n * will not be secure.\n *\n * @param {generator} random The random bytes generator.\n * @param {string} alphabet Symbols to be used in new random string.\n * @param {size} size The number of symbols in new random string.\n *\n * @return {string} Random string.\n *\n * @example\n * const format = require('nanoid/format')\n *\n * function random (size) {\n *   const result = []\n *   for (let i = 0; i < size; i++) {\n *     result.push(randomByte())\n *   }\n *   return result\n * }\n *\n * format(random, \"abcdef\", 5) //=> \"fbaef\"\n *\n * @name format\n * @function\n */\nmodule.exports = function (random, alphabet, size) {\n  var mask = (2 << Math.log(alphabet.length - 1) / Math.LN2) - 1\n  var step = Math.ceil(1.6 * mask * size / alphabet.length)\n\n  var id = ''\n  while (true) {\n    var bytes = random(step)\n    for (var i = 0; i < step; i++) {\n      var byte = bytes[i] & mask\n      if (alphabet[byte]) {\n        id += alphabet[byte]\n        if (id.length === size) return id\n      }\n    }\n  }\n}\n\n/**\n * @callback generator\n * @param {number} bytes The number of bytes to generate.\n * @return {number[]} Random bytes.\n */\n\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports) {\n\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nmodule.exports = __webpack_require__(31);\n\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar generate = __webpack_require__(30);\nvar alphabet = __webpack_require__(6);\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version = 6;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction build(clusterWorkerId) {\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + generate(version);\n    str = str + generate(clusterWorkerId);\n    if (counter > 0) {\n        str = str + generate(counter);\n    }\n    str = str + generate(seconds);\n    return str;\n}\n\nmodule.exports = build;\n\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar alphabet = __webpack_require__(6);\nvar random = __webpack_require__(33);\nvar format = __webpack_require__(25);\n\nfunction generate(number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + format(random, alphabet.get(), 1);\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nmodule.exports = generate;\n\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar alphabet = __webpack_require__(6);\nvar build = __webpack_require__(29);\nvar isValid = __webpack_require__(32);\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId = __webpack_require__(35) || 0;\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet.characters(newCharacters);\n    }\n\n    return alphabet.shuffled();\n}\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n  return build(clusterWorkerId);\n}\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.isValid = isValid;\n\n\n/***/ }),\n/* 32 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar alphabet = __webpack_require__(6);\n\nfunction isShortId(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var nonAlphabetic = new RegExp('[^' +\n      alphabet.get().replace(/[|\\\\{}()[\\]^$+*?.-]/g, '\\\\$&') +\n    ']');\n    return !nonAlphabetic.test(id);\n}\n\nmodule.exports = isShortId;\n\n\n/***/ }),\n/* 33 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar crypto = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nvar randomByte;\n\nif (!crypto || !crypto.getRandomValues) {\n    randomByte = function(size) {\n        var bytes = [];\n        for (var i = 0; i < size; i++) {\n            bytes.push(Math.floor(Math.random() * 256));\n        }\n        return bytes;\n    };\n} else {\n    randomByte = function(size) {\n        return crypto.getRandomValues(new Uint8Array(size));\n    };\n}\n\nmodule.exports = randomByte;\n\n\n/***/ }),\n/* 34 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue() {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed/(233280.0);\n}\n\nfunction setSeed(_seed_) {\n    seed = _seed_;\n}\n\nmodule.exports = {\n    nextValue: getNextValue,\n    seed: setSeed\n};\n\n\n/***/ }),\n/* 35 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = 0;\n\n\n/***/ }),\n/* 36 */\n/***/ (function(module, exports, __webpack_require__) {\n\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(true)\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"tick42-glue-core\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"tick42-glue-core\"] = factory();\n\telse\n\t\troot[\"tick42-glue-core\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 75);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = {\r\n    DEFAULT: 0,\r\n    STRING: 1,\r\n    NUMBER: 2,\r\n    COUNT: 3,\r\n    RATE: 4,\r\n    STATISTICS: 6,\r\n    TIMESTAMP: 7,\r\n    ADDRESS: 8,\r\n    TIMESPAN: 10,\r\n    OBJECT: 11\r\n};\r\n//# sourceMappingURL=metric-types.js.map\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear\r\n    };\r\n}\r\n;\r\ncreateRegistry.default = createRegistry;\r\nmodule.exports = createRegistry;\r\n//# sourceMappingURL=index.js.map\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = {\r\n    validate: function (definition, parent, transport) {\r\n        if (definition === null || typeof definition !== \"object\") {\r\n            throw new Error(\"Missing definition\");\r\n        }\r\n        if (parent === null || typeof parent !== \"object\") {\r\n            throw new Error(\"Missing parent\");\r\n        }\r\n        if (transport === null || typeof transport !== \"object\") {\r\n            throw new Error(\"Missing transport\");\r\n        }\r\n    },\r\n};\r\n//# sourceMappingURL=helpers.js.map\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar shortid = __webpack_require__(6);\r\nexports.default = shortid;\r\n//# sourceMappingURL=random.js.map\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar randomFromSeed = __webpack_require__(24);\n\nvar ORIGINAL = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet;\nvar previousSeed;\n\nvar shuffled;\n\nfunction reset() {\n    shuffled = false;\n}\n\nfunction setCharacters(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet !== ORIGINAL) {\n            alphabet = ORIGINAL;\n            reset();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet = _alphabet_;\n    reset();\n}\n\nfunction characters(_alphabet_) {\n    setCharacters(_alphabet_);\n    return alphabet;\n}\n\nfunction setSeed(seed) {\n    randomFromSeed.seed(seed);\n    if (previousSeed !== seed) {\n        reset();\n        previousSeed = seed;\n    }\n}\n\nfunction shuffle() {\n    if (!alphabet) {\n        setCharacters(ORIGINAL);\n    }\n\n    var sourceArray = alphabet.split('');\n    var targetArray = [];\n    var r = randomFromSeed.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled() {\n    if (shuffled) {\n        return shuffled;\n    }\n    shuffled = shuffle();\n    return shuffled;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup(index) {\n    var alphabetShuffled = getShuffled();\n    return alphabetShuffled[index];\n}\n\nfunction get () {\n  return alphabet || ORIGINAL;\n}\n\nmodule.exports = {\n    get: get,\n    characters: characters,\n    seed: setSeed,\n    lookup: lookup,\n    shuffled: getShuffled\n};\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction convertInfoToInstance(info) {\r\n    if (typeof info !== \"object\") {\r\n        info = {};\r\n    }\r\n    return {\r\n        application: info.ApplicationName,\r\n        environment: info.Environment,\r\n        machine: info.MachineName,\r\n        pid: info.ProcessId,\r\n        region: info.Region,\r\n        service: info.ServiceName,\r\n        user: info.UserName,\r\n        started: info.ProcessStartTime,\r\n    };\r\n}\r\nexports.convertInfoToInstance = convertInfoToInstance;\r\nfunction isStreamingFlagSet(flags) {\r\n    if (typeof flags !== \"number\" || isNaN(flags)) {\r\n        return false;\r\n    }\r\n    var mask = 32;\r\n    var result = flags & mask;\r\n    return result === mask;\r\n}\r\nexports.isStreamingFlagSet = isStreamingFlagSet;\r\nfunction convertInstance(instance) {\r\n    return {\r\n        ApplicationName: instance.application,\r\n        ProcessId: instance.pid,\r\n        MachineName: instance.machine,\r\n        UserName: instance.user,\r\n        Environment: instance.environment,\r\n        Region: instance.region,\r\n    };\r\n}\r\nexports.convertInstance = convertInstance;\r\n//# sourceMappingURL=helpers.js.map\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nmodule.exports = __webpack_require__(21);\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports) {\n\nvar g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction default_1(promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { };\r\n    }\r\n    promise.then(successCallback, errorCallback);\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=promisify.js.map\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ServerSubscription = (function () {\r\n    function ServerSubscription(protocol, repoMethod, subscription) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.subscription = subscription;\r\n    }\r\n    Object.defineProperty(ServerSubscription.prototype, \"stream\", {\r\n        get: function () { return this.repoMethod.stream; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"arguments\", {\r\n        get: function () { return this.subscription.arguments || {}; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"branchKey\", {\r\n        get: function () { return this.subscription.branchKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"instance\", {\r\n        get: function () { return this.subscription.instance; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerSubscription.prototype.close = function () {\r\n        this.protocol.server.closeSingleSubscription(this.repoMethod, this.subscription);\r\n    };\r\n    ServerSubscription.prototype.push = function (data) {\r\n        this.protocol.server.pushDataToSingle(this.repoMethod, this.subscription, data);\r\n    };\r\n    return ServerSubscription;\r\n}());\r\nexports.default = ServerSubscription;\r\n//# sourceMappingURL=subscription.js.map\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar msg = __webpack_require__(14);\r\nexports.ContextMessageReplaySpec = {\r\n    get name() {\r\n        return \"context\";\r\n    },\r\n    get types() {\r\n        return [\r\n            msg.GW_MESSAGE_CREATE_CONTEXT,\r\n            msg.GW_MESSAGE_ACTIVITY_CREATED,\r\n            msg.GW_MESSAGE_ACTIVITY_DESTROYED,\r\n            msg.GW_MESSAGE_CONTEXT_CREATED,\r\n            msg.GW_MESSAGE_CONTEXT_ADDED,\r\n            msg.GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            msg.GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            msg.GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            msg.GW_MESSAGE_DESTROY_CONTEXT,\r\n            msg.GW_MESSAGE_CONTEXT_DESTROYED,\r\n            msg.GW_MESSAGE_UPDATE_CONTEXT,\r\n            msg.GW_MESSAGE_CONTEXT_UPDATED,\r\n            msg.GW_MESSAGE_JOINED_ACTIVITY\r\n        ];\r\n    }\r\n};\r\n//# sourceMappingURL=contextMessageReplaySpec.js.map\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Utils = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return -1;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? -1 : ver;\r\n    };\r\n    Utils.isNode = function () {\r\n        try {\r\n            return Object.prototype.toString.call(global.process) === \"[object process]\";\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n    return Utils;\r\n}());\r\nexports.default = Utils;\r\n//# sourceMappingURL=utils.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(7)))\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports) {\n\nmodule.exports = {\"name\":\"tick42-glue-core\",\"version\":\"4.3.7\",\"description\":\"Glue42 core library including logger, connection, agm and metrics\",\"main\":\"./dist/node/tick42-glue-core.js\",\"types\":\"./glue.d.ts\",\"browser\":\"./dist/web/tick42-glue-core.js\",\"scripts\":{\"init-dev-mode\":\"node ./build/scripts/init-dev-mode.js\",\"remove-installed-dependencies\":\"node ./build/scripts/remove-installed-dependencies.js\",\"clean\":\"node ./build/scripts/clean.js\",\"pre:build\":\"npm run clean && npm run tslint && tsc && set NODE_ENV=development\",\"file-versionify\":\"node ./build/scripts/file-versionify.js\",\"tslint\":\"tslint -t codeFrame ./src/**.ts\",\"tslint:fix\":\"tslint -t codeFrame --fix ./src/**.ts\",\"watch\":\"onchange ./src/**/*.ts -- npm run build:dev\",\"build:dev\":\"npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify\",\"build:prod\":\"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify\",\"docs\":\"typedoc --options typedoc.json ./src\",\"prepublish\":\"npm run build:prod && npm run test:only\",\"test\":\"npm run build:dev && npm run test:only\",\"test:only\":\"mocha ./tests/ --recursive\",\"test:core\":\"mocha ./tests/core\",\"test:agm\":\"mocha ./tests/agm\",\"test:bus\":\"mocha ./tests/bus\"},\"repository\":{\"type\":\"git\",\"url\":\"https://stash.tick42.com/scm/tg/js-glue-core.git\"},\"author\":{\"name\":\"Tick42\",\"url\":\"http://www.glue42.com\"},\"license\":\"ISC\",\"dependencies\":{\"callback-registry\":\"^2.4.0\",\"es6-promise\":\"^4.1.0\",\"shortid\":\"^2.2.6\",\"util-deprecate\":\"^1.0.2\",\"ws\":\"^0.7.2\"},\"devDependencies\":{\"@types/node\":\"^10.7.0\",\"@types/shortid\":\"0.0.29\",\"archiver\":\"^1.3.0\",\"babel-core\":\"^6.25.0\",\"babel-loader\":\"^6.4.1\",\"babel-plugin-add-module-exports\":\"^0.2.1\",\"babel-preset-es2015\":\"^6.16.0\",\"babel-preset-stage-2\":\"^6.22.0\",\"chai\":\"^4.0.2\",\"deep-equal\":\"^1.0.1\",\"mocha\":\"^2.5.3\",\"onchange\":\"3.*\",\"pre-commit\":\"^1.1.3\",\"readline-sync\":\"^1.4.5\",\"shelljs\":\"^0.6.0\",\"tick42-gateway\":\"0.2.7\",\"tick42-webpack-config\":\"4.1.6\",\"tslint\":\"^5.11.0\",\"typescript\":\"^3.0.1\",\"webpack\":\"2.3.3\"}}\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar ConnectionImpl = (function () {\r\n    function ConnectionImpl(settings) {\r\n        this.messageHandlers = {};\r\n        this.ids = 1;\r\n        this.registry = callback_registry_1.default();\r\n        this._connected = false;\r\n        this._settings = settings;\r\n        this._logger = settings.logger;\r\n    }\r\n    ConnectionImpl.prototype.init = function (transport, protocol) {\r\n        this._protocol = protocol;\r\n        this._transport = transport;\r\n        this._transport.onConnectedChanged(this.handleConnectionChanged.bind(this));\r\n        this._transport.onMessage(this.handleTransportMessage.bind(this));\r\n    };\r\n    ConnectionImpl.prototype.send = function (product, type, message, id, options) {\r\n        if (this._transport.isObjectBasedTransport) {\r\n            var msg = this._protocol.createObjectMessage(product, type, message, id);\r\n            return this._transport.sendObject(msg, product, type, options);\r\n        }\r\n        else {\r\n            var strMessage = this._protocol.createStringMessage(product, type, message, id);\r\n            return this._transport.send(strMessage, product, type, options);\r\n        }\r\n    };\r\n    ConnectionImpl.prototype.on = function (product, type, messageHandler) {\r\n        type = type.toLowerCase();\r\n        if (this.messageHandlers[type] === undefined) {\r\n            this.messageHandlers[type] = {};\r\n        }\r\n        var id = this.ids++;\r\n        this.messageHandlers[type][id] = messageHandler;\r\n        return {\r\n            type: type,\r\n            id: id,\r\n        };\r\n    };\r\n    ConnectionImpl.prototype.off = function (info) {\r\n        delete this.messageHandlers[info.type.toLowerCase()][info.id];\r\n    };\r\n    Object.defineProperty(ConnectionImpl.prototype, \"isConnected\", {\r\n        get: function () {\r\n            return this._connected;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ConnectionImpl.prototype.connected = function (callback) {\r\n        if (this._connected) {\r\n            callback(this._settings.ws || this._settings.http);\r\n        }\r\n        return this.registry.add(\"connected\", callback);\r\n    };\r\n    ConnectionImpl.prototype.disconnected = function (callback) {\r\n        return this.registry.add(\"disconnected\", callback);\r\n    };\r\n    ConnectionImpl.prototype.login = function (authRequest) {\r\n        this._transport.open();\r\n        return this._protocol.login(authRequest);\r\n    };\r\n    ConnectionImpl.prototype.logout = function () {\r\n        this._protocol.logout();\r\n        this._transport.close();\r\n    };\r\n    ConnectionImpl.prototype.loggedIn = function (callback) {\r\n        return this._protocol.loggedIn(callback);\r\n    };\r\n    Object.defineProperty(ConnectionImpl.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            return this._settings.protocolVersion || 1;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ConnectionImpl.prototype.toAPI = function () {\r\n        var that = this;\r\n        return {\r\n            send: that.send.bind(that),\r\n            on: that.on.bind(that),\r\n            off: that.off.bind(that),\r\n            login: that.login.bind(that),\r\n            logout: that.logout.bind(that),\r\n            loggedIn: that.loggedIn.bind(that),\r\n            connected: that.connected.bind(that),\r\n            disconnected: that.disconnected.bind(that),\r\n            get protocolVersion() {\r\n                return that.protocolVersion;\r\n            }\r\n        };\r\n    };\r\n    ConnectionImpl.prototype.distributeMessage = function (message, type) {\r\n        var _this = this;\r\n        var handlers = this.messageHandlers[type.toLowerCase()];\r\n        if (handlers !== undefined) {\r\n            Object.keys(handlers).forEach(function (handlerId) {\r\n                var handler = handlers[handlerId];\r\n                if (handler !== undefined) {\r\n                    try {\r\n                        handler(message);\r\n                    }\r\n                    catch (error) {\r\n                        _this._logger.error(\"Message handler failed with \" + error.stack);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    ConnectionImpl.prototype.handleConnectionChanged = function (connected) {\r\n        if (this._connected === connected) {\r\n            return;\r\n        }\r\n        this._connected = connected;\r\n        if (connected) {\r\n            this.registry.execute(\"connected\");\r\n        }\r\n        else {\r\n            this.registry.execute(\"disconnected\");\r\n        }\r\n    };\r\n    ConnectionImpl.prototype.handleTransportMessage = function (msg) {\r\n        var msgObj;\r\n        if (typeof msg === \"string\") {\r\n            msgObj = this._protocol.processStringMessage(msg);\r\n        }\r\n        else {\r\n            msgObj = this._protocol.processObjectMessage(msg);\r\n        }\r\n        this.distributeMessage(msgObj.msg, msgObj.msgType);\r\n    };\r\n    return ConnectionImpl;\r\n}());\r\nexports.default = ConnectionImpl;\r\n//# sourceMappingURL=connection.js.map\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.GW_MESSAGE_CREATE_CONTEXT = \"create-context\";\r\nexports.GW_MESSAGE_ACTIVITY_CREATED = \"created\";\r\nexports.GW_MESSAGE_ACTIVITY_DESTROYED = \"destroyed\";\r\nexports.GW_MESSAGE_CONTEXT_CREATED = \"context-created\";\r\nexports.GW_MESSAGE_CONTEXT_ADDED = \"context-added\";\r\nexports.GW_MESSAGE_SUBSCRIBE_CONTEXT = \"subscribe-context\";\r\nexports.GW_MESSAGE_SUBSCRIBED_CONTEXT = \"subscribed-context\";\r\nexports.GW_MESSAGE_UNSUBSCRIBE_CONTEXT = \"unsubscribe-context\";\r\nexports.GW_MESSAGE_DESTROY_CONTEXT = \"destroy-context\";\r\nexports.GW_MESSAGE_CONTEXT_DESTROYED = \"context-destroyed\";\r\nexports.GW_MESSAGE_UPDATE_CONTEXT = \"update-context\";\r\nexports.GW_MESSAGE_CONTEXT_UPDATED = \"context-updated\";\r\nexports.GW_MESSAGE_JOINED_ACTIVITY = \"joined\";\r\n//# sourceMappingURL=gw3Messages.js.map\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar connection = {\r\n    protocolVersion: -1,\r\n    send: function (product, type, message, id, options) {\r\n        return Promise.resolve(undefined);\r\n    },\r\n    on: function (product, type, messageHandler) {\r\n        return { type: \"1\", id: 1 };\r\n    },\r\n    off: function (info) {\r\n    },\r\n    login: function (message) {\r\n        return undefined;\r\n    },\r\n    logout: function () {\r\n    },\r\n    loggedIn: function (callback) {\r\n        return undefined;\r\n    },\r\n    connected: function (callback) {\r\n        return undefined;\r\n    },\r\n    disconnected: function (callback) {\r\n        return undefined;\r\n    },\r\n};\r\nexports.default = connection;\r\n//# sourceMappingURL=dummyConnection.js.map\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar main_1 = __webpack_require__(89);\r\nvar main_2 = __webpack_require__(57);\r\nvar main_3 = __webpack_require__(74);\r\nvar main_4 = __webpack_require__(35);\r\nvar main_5 = __webpack_require__(52);\r\nvar config_1 = __webpack_require__(55);\r\nvar dummyConnection_1 = __webpack_require__(15);\r\nvar timer_1 = __webpack_require__(92);\r\nvar utils_1 = __webpack_require__(11);\r\nvar dummyConnection_2 = __webpack_require__(15);\r\nvar main_6 = __webpack_require__(71);\r\nvar contextMessageReplaySpec_1 = __webpack_require__(10);\r\nvar GlueCore = function (userConfig, ext) {\r\n    var gdVersion = -1;\r\n    var hc;\r\n    var glue42gd;\r\n    if (typeof window !== \"undefined\") {\r\n        gdVersion = utils_1.default.getGDMajorVersion();\r\n        if (gdVersion === 2) {\r\n            hc = window.htmlContainer;\r\n        }\r\n        else if (gdVersion >= 3) {\r\n            glue42gd = window.glue42gd;\r\n        }\r\n    }\r\n    var glueInitTimer = timer_1.default();\r\n    userConfig = userConfig || {};\r\n    ext = ext || {};\r\n    var internalConfig = config_1.default(userConfig, ext, hc, glue42gd, gdVersion);\r\n    var _connection;\r\n    var _agm;\r\n    var _logger;\r\n    var _rootMetrics;\r\n    var _metrics;\r\n    var _contexts;\r\n    var _bus;\r\n    var libs = {};\r\n    function registerLib(name, inner, t) {\r\n        inner.initStartTime = t.startTime;\r\n        if (inner.ready) {\r\n            inner.ready().then(function () {\r\n                inner.initTime = t.stop();\r\n                inner.initEndTime = t.endTime;\r\n            });\r\n        }\r\n        else {\r\n            inner.initTime = t.stop();\r\n            inner.initEndTime = t.endTime;\r\n        }\r\n        libs[name] = inner;\r\n        GlueCore[name] = inner;\r\n    }\r\n    function setupConnection() {\r\n        var initTimer = timer_1.default();\r\n        internalConfig.connection.logger = _logger.subLogger(\"connection\");\r\n        _connection = main_2.default(internalConfig.connection);\r\n        var authPromise = Promise.resolve(internalConfig.auth);\r\n        if (internalConfig.connection && !internalConfig.auth) {\r\n            var protocolVersion = internalConfig.connection.protocolVersion;\r\n            if (!protocolVersion || protocolVersion === 1) {\r\n                registerLib(\"connection\", _connection, initTimer);\r\n                return Promise.resolve({});\r\n            }\r\n            if (protocolVersion === 2) {\r\n                return Promise.reject(\"You need to provide auth information\");\r\n            }\r\n            if (protocolVersion === 3) {\r\n                if (glue42gd) {\r\n                    authPromise = glue42gd.getGWToken().then(function (token) {\r\n                        return {\r\n                            gatewayToken: token\r\n                        };\r\n                    });\r\n                }\r\n                else {\r\n                    authPromise = Promise.reject(\"You need to provide auth information\");\r\n                }\r\n            }\r\n        }\r\n        return authPromise\r\n            .then(function (authConfig) {\r\n            var authRequest;\r\n            if (typeof authConfig === \"string\" || typeof authConfig === \"number\") {\r\n                authRequest = {\r\n                    token: authConfig\r\n                };\r\n            }\r\n            else if (Object.prototype.toString.call(authConfig) === \"[object Object]\") {\r\n                authRequest = authConfig;\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid auth object - \" + JSON.stringify(authConfig));\r\n            }\r\n            return authRequest;\r\n        })\r\n            .then(function (authRequest) {\r\n            return _connection.login(authRequest);\r\n        })\r\n            .then(function (identity) {\r\n            if (identity) {\r\n                if (identity.machine) {\r\n                    internalConfig.agm.instance.machine = identity.machine;\r\n                }\r\n                if (identity.user) {\r\n                    internalConfig.agm.instance.user = identity.user;\r\n                }\r\n            }\r\n            registerLib(\"connection\", _connection, initTimer);\r\n            return internalConfig;\r\n        })\r\n            .catch(function (e) {\r\n            if (_connection) {\r\n                _connection.logout();\r\n            }\r\n            throw e;\r\n        });\r\n    }\r\n    function setupLogger() {\r\n        var initTimer = timer_1.default();\r\n        var loggerConfig = {\r\n            identity: internalConfig.identity,\r\n            getConnection: function () {\r\n                return _connection || dummyConnection_1.default;\r\n            },\r\n            publish: internalConfig.logger.publish || \"off\",\r\n            console: internalConfig.logger.console || \"info\",\r\n            metrics: (internalConfig.metrics && internalConfig.logger.metrics) || \"off\"\r\n        };\r\n        _logger = main_3.default(loggerConfig);\r\n        registerLib(\"logger\", _logger, initTimer);\r\n        return Promise.resolve(undefined);\r\n    }\r\n    function setupMetrics() {\r\n        if (internalConfig.metrics) {\r\n            var initTimer = timer_1.default();\r\n            _rootMetrics = main_1.default({\r\n                identity: internalConfig.metrics.identity,\r\n                connection: internalConfig.metrics ? _connection : dummyConnection_1.default,\r\n                logger: _logger.subLogger(\"metrics\")\r\n            });\r\n            _metrics = _rootMetrics.subSystem(\"App\");\r\n            var reportingSystem_1 = _metrics.subSystem(\"reporting\");\r\n            var def_1 = {\r\n                name: \"features\",\r\n                conflation: 1,\r\n            };\r\n            var _featureMetric_1;\r\n            _metrics.featureMetric = function (name, action, payload) {\r\n                if (typeof name === \"undefined\" || name === \"\") {\r\n                    throw new Error(\"name is mandatory\");\r\n                }\r\n                else if (typeof action === \"undefined\" || action === \"\") {\r\n                    throw new Error(\"action is mandatory\");\r\n                }\r\n                else if (typeof payload === \"undefined\" || payload === \"\") {\r\n                    throw new Error(\"payload is mandatory\");\r\n                }\r\n                if (!_featureMetric_1) {\r\n                    _featureMetric_1 = reportingSystem_1.objectMetric(def_1, { name: name, action: action, payload: payload });\r\n                }\r\n                else {\r\n                    _featureMetric_1.update({\r\n                        name: name,\r\n                        action: action,\r\n                        payload: payload\r\n                    });\r\n                }\r\n            };\r\n            _logger.metricsLevel(\"warn\", _metrics.parent.subSystem(\"LogEvents\"));\r\n            registerLib(\"metrics\", _metrics, initTimer);\r\n        }\r\n        return Promise.resolve(undefined);\r\n    }\r\n    function setupAGM() {\r\n        var initTimer = timer_1.default();\r\n        var agmConfig = {\r\n            instance: internalConfig.agm.instance,\r\n            connection: _connection,\r\n            logger: _logger.subLogger(\"agm\"),\r\n            forceGW: internalConfig.connection && internalConfig.connection.force,\r\n            gdVersion: gdVersion,\r\n        };\r\n        return new Promise(function (resolve, reject) {\r\n            main_4.default(agmConfig)\r\n                .then(function (agmLib) {\r\n                _agm = agmLib;\r\n                registerLib(\"agm\", _agm, initTimer);\r\n                resolve(internalConfig);\r\n            })\r\n                .catch(function (err) {\r\n                return reject(err);\r\n            });\r\n        });\r\n    }\r\n    function setupContexts() {\r\n        var hasActivities = (internalConfig.activities && dummyConnection_2.default.protocolVersion === 3);\r\n        var needsContexts = internalConfig.contexts || hasActivities;\r\n        if (needsContexts) {\r\n            var initTimer = timer_1.default();\r\n            _contexts = new main_6.ContextsModule({\r\n                connection: _connection,\r\n                logger: _logger.subLogger(\"contexts\"),\r\n                gdMajorVersion: gdVersion\r\n            });\r\n            registerLib(\"contexts\", _contexts, initTimer);\r\n            return _contexts;\r\n        }\r\n        else {\r\n            var replayer = dummyConnection_2.default.replayer;\r\n            if (replayer) {\r\n                replayer.drain(contextMessageReplaySpec_1.ContextMessageReplaySpec.name, null);\r\n            }\r\n        }\r\n    }\r\n    function setupExternalLibs(externalLibs) {\r\n        try {\r\n            externalLibs.forEach(function (lib) {\r\n                setupExternalLib(lib.name, lib.create);\r\n            });\r\n            return Promise.resolve();\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    function setupExternalLib(name, createCallback) {\r\n        var initTimer = timer_1.default();\r\n        var lib = createCallback(libs);\r\n        if (lib) {\r\n            registerLib(name, lib, initTimer);\r\n        }\r\n    }\r\n    function waitForLibs() {\r\n        var libsReadyPromises = Object.keys(libs).map(function (key) {\r\n            var lib = libs[key];\r\n            return lib.ready ?\r\n                lib.ready() : Promise.resolve();\r\n        });\r\n        return Promise.all(libsReadyPromises);\r\n    }\r\n    function constructGlueObject() {\r\n        var feedbackFunc = function () {\r\n            if (!_agm) {\r\n                return;\r\n            }\r\n            _agm.invoke(\"T42.ACS.Feedback\", {}, \"best\");\r\n        };\r\n        var info = { glueVersion: internalConfig.version };\r\n        glueInitTimer.stop();\r\n        var glue = {\r\n            feedback: feedbackFunc,\r\n            info: info,\r\n            version: internalConfig.version,\r\n            userConfig: userConfig,\r\n            done: function () {\r\n                _connection.logout();\r\n                return Promise.resolve();\r\n            }\r\n        };\r\n        glue.performance = {\r\n            get browser() {\r\n                return window.performance.timing.toJSON();\r\n            },\r\n            get memory() {\r\n                return window.performance.memory;\r\n            },\r\n            get initTimes() {\r\n                var result = Object.keys(glue)\r\n                    .filter(function (key) {\r\n                    if (key === \"initTimes\") {\r\n                        return false;\r\n                    }\r\n                    return glue[key].initTime;\r\n                })\r\n                    .map(function (key) {\r\n                    return {\r\n                        name: key,\r\n                        time: glue[key].initTime,\r\n                        startTime: glue[key].initStartTime,\r\n                        endTime: glue[key].initEndTime\r\n                    };\r\n                });\r\n                result.push({\r\n                    name: \"glue\",\r\n                    startTime: glueInitTimer.startTime,\r\n                    endTime: glueInitTimer.endTime,\r\n                    time: glueInitTimer.period\r\n                });\r\n                return result;\r\n            }\r\n        };\r\n        Object.keys(libs).forEach(function (key) {\r\n            var lib = libs[key];\r\n            glue[key] = lib;\r\n            info[key] = lib.version;\r\n        });\r\n        if (hc && hc.perfDataNeeded && hc.updatePerfData) {\r\n            var delay = hc.perfDataDelay || 100;\r\n            setTimeout(function () {\r\n                hc.updatePerfData(glue.performance);\r\n            }, delay);\r\n        }\r\n        if (glue42gd && glue42gd.updatePerfData) {\r\n            glue42gd.updatePerfData(glue.performance);\r\n        }\r\n        glue.config = {};\r\n        if (ext.enrichGlue) {\r\n            ext.enrichGlue(glue);\r\n        }\r\n        Object.keys(internalConfig).forEach(function (k) {\r\n            glue.config[k] = internalConfig[k];\r\n        });\r\n        if (ext.extOptions) {\r\n            Object.keys(ext.extOptions).forEach(function (k) {\r\n                glue.config[k] = ext.extOptions[k];\r\n            });\r\n        }\r\n        return glue;\r\n    }\r\n    function setupBus() {\r\n        if (!internalConfig.bus) {\r\n            return Promise.resolve(undefined);\r\n        }\r\n        var initTimer = timer_1.default();\r\n        var busSettings = {\r\n            connection: _connection,\r\n            logger: _logger.subLogger(\"bus\")\r\n        };\r\n        return new Promise(function (resolve, reject) {\r\n            main_5.default(busSettings)\r\n                .then(function (busLib) {\r\n                _bus = busLib;\r\n                registerLib(\"bus\", _bus, initTimer);\r\n                resolve();\r\n            })\r\n                .catch(function (err) {\r\n                return reject(err);\r\n            });\r\n        });\r\n    }\r\n    return setupLogger()\r\n        .then(setupConnection)\r\n        .then(function () { return Promise.all([setupMetrics(), setupAGM(), setupContexts(), setupBus()]); })\r\n        .then(function () {\r\n        return setupExternalLibs(internalConfig.libs || []);\r\n    })\r\n        .then(waitForLibs)\r\n        .then(constructGlueObject)\r\n        .catch(function (err) {\r\n        return Promise.reject({\r\n            err: err,\r\n            libs: libs\r\n        });\r\n    });\r\n};\r\nexports.default = GlueCore;\r\n//# sourceMappingURL=glue.js.map\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports) {\n\n/**\n * Secure random string generator with custom alphabet.\n *\n * Alphabet must contain 256 symbols or less. Otherwise, the generator\n * will not be secure.\n *\n * @param {generator} random The random bytes generator.\n * @param {string} alphabet Symbols to be used in new random string.\n * @param {size} size The number of symbols in new random string.\n *\n * @return {string} Random string.\n *\n * @example\n * const format = require('nanoid/format')\n *\n * function random (size) {\n *   const result = []\n *   for (let i = 0; i < size; i++) {\n *     result.push(randomByte())\n *   }\n *   return result\n * }\n *\n * format(random, \"abcdef\", 5) //=> \"fbaef\"\n *\n * @name format\n * @function\n */\nmodule.exports = function (random, alphabet, size) {\n  var mask = (2 << Math.log(alphabet.length - 1) / Math.LN2) - 1\n  var step = Math.ceil(1.6 * mask * size / alphabet.length)\n\n  var id = ''\n  while (true) {\n    var bytes = random(step)\n    for (var i = 0; i < step; i++) {\n      var byte = bytes[i] & mask\n      if (alphabet[byte]) {\n        id += alphabet[byte]\n        if (id.length === size) return id\n      }\n    }\n  }\n}\n\n/**\n * @callback generator\n * @param {number} bytes The number of bytes to generate.\n * @return {number[]} Random bytes.\n */\n\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports) {\n\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar generate = __webpack_require__(20);\nvar alphabet = __webpack_require__(4);\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version = 6;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction build(clusterWorkerId) {\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + generate(version);\n    str = str + generate(clusterWorkerId);\n    if (counter > 0) {\n        str = str + generate(counter);\n    }\n    str = str + generate(seconds);\n    return str;\n}\n\nmodule.exports = build;\n\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar alphabet = __webpack_require__(4);\nvar random = __webpack_require__(23);\nvar format = __webpack_require__(17);\n\nfunction generate(number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + format(random, alphabet.get(), 1);\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nmodule.exports = generate;\n\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar alphabet = __webpack_require__(4);\nvar build = __webpack_require__(19);\nvar isValid = __webpack_require__(22);\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId = __webpack_require__(25) || 0;\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet.characters(newCharacters);\n    }\n\n    return alphabet.shuffled();\n}\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n  return build(clusterWorkerId);\n}\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.isValid = isValid;\n\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar alphabet = __webpack_require__(4);\n\nfunction isShortId(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var nonAlphabetic = new RegExp('[^' +\n      alphabet.get().replace(/[|\\\\{}()[\\]^$+*?.-]/g, '\\\\$&') +\n    ']');\n    return !nonAlphabetic.test(id);\n}\n\nmodule.exports = isShortId;\n\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar crypto = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nvar randomByte;\n\nif (!crypto || !crypto.getRandomValues) {\n    randomByte = function(size) {\n        var bytes = [];\n        for (var i = 0; i < size; i++) {\n            bytes.push(Math.floor(Math.random() * 256));\n        }\n        return bytes;\n    };\n} else {\n    randomByte = function(size) {\n        return crypto.getRandomValues(new Uint8Array(size));\n    };\n}\n\nmodule.exports = randomByte;\n\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue() {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed/(233280.0);\n}\n\nfunction setSeed(_seed_) {\n    seed = _seed_;\n}\n\nmodule.exports = {\n    nextValue: getNextValue,\n    seed: setSeed\n};\n\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = 0;\n\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports) {\n\n\n/**\n * Module dependencies.\n */\n\nvar global = (function() { return this; })();\n\n/**\n * WebSocket constructor.\n */\n\nvar WebSocket = global.WebSocket || global.MozWebSocket;\n\n/**\n * Module exports.\n */\n\nmodule.exports = WebSocket ? ws : null;\n\n/**\n * WebSocket constructor.\n *\n * The third `opts` options object gets ignored in web browsers, since it's\n * non-standard, and throws a TypeError if passed to the constructor.\n * See: https://github.com/einaros/ws/issues/227\n *\n * @param {String} uri\n * @param {Array} protocols (optional)\n * @param {Object) opts (optional)\n * @api public\n */\n\nfunction ws(uri, protocols, opts) {\n  var instance;\n  if (protocols) {\n    instance = new WebSocket(uri, protocols);\n  } else {\n    instance = new WebSocket(uri);\n  }\n  return instance;\n}\n\nif (WebSocket) ws.prototype = WebSocket.prototype;\n\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_1 = __webpack_require__(28);\r\nvar server_1 = __webpack_require__(49);\r\nvar AGMImpl = (function () {\r\n    function AGMImpl(protocol, clientRepository, serverRepository, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.clientRepository = clientRepository;\r\n        this.serverRepository = serverRepository;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n        this.client = new client_1.default(protocol, clientRepository, instance, configuration);\r\n        this.server = new server_1.default(protocol, serverRepository, instance, configuration);\r\n    }\r\n    AGMImpl.prototype.serverRemoved = function (callback) {\r\n        return this.client.serverRemoved(callback);\r\n    };\r\n    AGMImpl.prototype.serverAdded = function (callback) {\r\n        return this.client.serverAdded(callback);\r\n    };\r\n    AGMImpl.prototype.serverMethodRemoved = function (callback) {\r\n        return this.client.serverMethodRemoved(callback);\r\n    };\r\n    AGMImpl.prototype.serverMethodAdded = function (callback) {\r\n        return this.client.serverMethodAdded(callback);\r\n    };\r\n    AGMImpl.prototype.methodRemoved = function (callback) {\r\n        return this.client.methodRemoved(callback);\r\n    };\r\n    AGMImpl.prototype.methodAdded = function (callback) {\r\n        return this.client.methodAdded(callback);\r\n    };\r\n    AGMImpl.prototype.methodsForInstance = function (instance) {\r\n        return this.client.methodsForInstance(instance);\r\n    };\r\n    AGMImpl.prototype.methods = function (methodFilter) {\r\n        return this.client.methods(methodFilter);\r\n    };\r\n    AGMImpl.prototype.servers = function (methodFilter) {\r\n        return this.client.servers(methodFilter);\r\n    };\r\n    AGMImpl.prototype.subscribe = function (method, options, successCallback, errorCallback) {\r\n        return this.client.subscribe(method, options, successCallback, errorCallback);\r\n    };\r\n    AGMImpl.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback) {\r\n        return this.server.createStream(streamDef, callbacks, successCallback, errorCallback);\r\n    };\r\n    AGMImpl.prototype.unregister = function (methodFilter) {\r\n        return this.server.unregister(methodFilter);\r\n    };\r\n    AGMImpl.prototype.registerAsync = function (methodDefinition, callback) {\r\n        return this.server.registerAsync(methodDefinition, callback);\r\n    };\r\n    AGMImpl.prototype.register = function (methodDefinition, callback) {\r\n        return this.server.register(methodDefinition, callback);\r\n    };\r\n    AGMImpl.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return this.client.invoke(methodFilter, argumentObj, target, additionalOptions, success, error);\r\n    };\r\n    AGMImpl.prototype.updateInstance = function (newInstance) {\r\n        if (this.instance.machine === undefined) {\r\n            this.instance.machine = newInstance.MachineName || newInstance.machine;\r\n        }\r\n        if (this.instance.user === undefined) {\r\n            this.instance.user = newInstance.UserName || newInstance.user;\r\n        }\r\n        if (this.instance.environment === undefined) {\r\n            this.instance.environment = newInstance.Environment || newInstance.environment;\r\n        }\r\n        if (this.instance.region === undefined) {\r\n            this.instance.region = newInstance.Region || newInstance.region;\r\n        }\r\n    };\r\n    return AGMImpl;\r\n}());\r\nexports.default = AGMImpl;\r\n//# sourceMappingURL=agm.js.map\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar invoke_1 = __webpack_require__(29);\r\nvar promisify_1 = __webpack_require__(8);\r\nvar Client = (function () {\r\n    function Client(protocol, repo, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.repo = repo;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n        this.clientInvocations = new invoke_1.default(protocol);\r\n    }\r\n    Client.prototype.subscribe = function (method, options, successCallback, errorCallback) {\r\n        var _this = this;\r\n        var callProtocolSubscribe = function (targetServers, stream, successProxy, errorProxy) {\r\n            _this.protocol.client.subscribe(stream, options.arguments, targetServers, { methodResponseTimeout: options.waitTimeoutMs }, successProxy, errorProxy);\r\n        };\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var successProxy = function (sub) {\r\n                resolve(sub);\r\n            };\r\n            var errorProxy = function (err) {\r\n                reject(err);\r\n            };\r\n            var methodDef;\r\n            if (typeof method === \"string\") {\r\n                methodDef = { name: method };\r\n            }\r\n            else {\r\n                methodDef = method;\r\n            }\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            var target = options.target;\r\n            if (target === undefined) {\r\n                target = \"best\";\r\n            }\r\n            if (typeof target === \"string\" && target !== \"all\" && target !== \"best\") {\r\n                reject({ message: '\"' + target + '\" is not a valid target. Valid targets are \"all\", \"best\", or an instance.' });\r\n            }\r\n            if (options.methodResponseTimeout === undefined) {\r\n                options.methodResponseTimeout = options.method_response_timeout;\r\n                if (options.methodResponseTimeout === undefined) {\r\n                    options.methodResponseTimeout = _this.configuration.methodResponseTimeout;\r\n                }\r\n            }\r\n            if (options.waitTimeoutMs === undefined) {\r\n                options.waitTimeoutMs = options.wait_for_method_timeout;\r\n                if (options.waitTimeoutMs === undefined) {\r\n                    options.waitTimeoutMs = _this.configuration.waitTimeoutMs;\r\n                }\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n            if (currentServers.length > 0) {\r\n                callProtocolSubscribe(currentServers, currentServers[0].methods[0], successProxy, errorProxy);\r\n            }\r\n            else {\r\n                var retry_1 = function () {\r\n                    delayTillNow += delayStep;\r\n                    currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n                    if (currentServers.length > 0) {\r\n                        var streamInfo = currentServers[0].methods[0];\r\n                        callProtocolSubscribe(currentServers, streamInfo, successProxy, errorProxy);\r\n                    }\r\n                    else if (delayTillNow >= options.waitTimeoutMs) {\r\n                        var def = typeof method === \"string\" ? { name: method } : method;\r\n                        var info = {\r\n                            id: undefined,\r\n                            info: def,\r\n                            getInfoForUser: function () {\r\n                                return methodDef;\r\n                            },\r\n                            protocolState: undefined,\r\n                        };\r\n                        callProtocolSubscribe(currentServers, info, successProxy, errorProxy);\r\n                    }\r\n                    else {\r\n                        setTimeout(retry_1, delayStep);\r\n                    }\r\n                };\r\n                setTimeout(retry_1, delayStep);\r\n            }\r\n        });\r\n        return promisify_1.default(promise, successCallback, errorCallback);\r\n    };\r\n    Client.prototype.servers = function (methodFilter) {\r\n        return this.getServers(methodFilter).map(function (serverMethodMap) {\r\n            return serverMethodMap.server.getInfoForUser();\r\n        });\r\n    };\r\n    Client.prototype.methods = function (methodFilter) {\r\n        return this.getMethods(methodFilter).map(function (m) {\r\n            return m.getInfoForUser();\r\n        });\r\n    };\r\n    Client.prototype.methodsForInstance = function (instance) {\r\n        return this.getMethodsForInstance(instance).map(function (m) {\r\n            return m.getInfoForUser();\r\n        });\r\n    };\r\n    Client.prototype.methodAdded = function (callback) {\r\n        return this.repo.onMethodAdded(function (method) {\r\n            callback(method.getInfoForUser());\r\n        });\r\n    };\r\n    Client.prototype.methodRemoved = function (callback) {\r\n        return this.repo.onMethodRemoved(function (method) {\r\n            callback(method.getInfoForUser());\r\n        });\r\n    };\r\n    Client.prototype.serverAdded = function (callback) {\r\n        return this.repo.onServerAdded(function (server) {\r\n            callback(server.getInfoForUser());\r\n        });\r\n    };\r\n    Client.prototype.serverRemoved = function (callback) {\r\n        return this.repo.onServerRemoved(function (server, reason) {\r\n            callback(server.getInfoForUser(), reason);\r\n        });\r\n    };\r\n    Client.prototype.serverMethodAdded = function (callback) {\r\n        return this.repo.onServerMethodAdded(function (server, method) {\r\n            callback({ server: server.getInfoForUser(), method: method.getInfoForUser() });\r\n        });\r\n    };\r\n    Client.prototype.serverMethodRemoved = function (callback) {\r\n        return this.repo.onServerMethodRemoved(function (server, method) {\r\n            callback({ server: server.getInfoForUser(), method: method.getInfoForUser() });\r\n        });\r\n    };\r\n    Client.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var successProxy = function (args) {\r\n                resolve(args);\r\n            };\r\n            var errorProxy = function (err) {\r\n                reject(err);\r\n            };\r\n            if (!argumentObj) {\r\n                argumentObj = {};\r\n            }\r\n            if (!target) {\r\n                target = \"best\";\r\n            }\r\n            if (typeof target === \"string\" && target !== \"all\" && target !== \"best\") {\r\n                reject({ message: '\"' + target + '\" is not a valid target. Valid targets are \"all\" and \"best\".' });\r\n            }\r\n            if (!additionalOptions) {\r\n                additionalOptions = {};\r\n            }\r\n            if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                additionalOptions.methodResponseTimeoutMs = additionalOptions.method_response_timeout;\r\n                if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                    additionalOptions.methodResponseTimeoutMs = _this.configuration.methodResponseTimeout;\r\n                }\r\n            }\r\n            if (additionalOptions.waitTimeoutMs === undefined) {\r\n                additionalOptions.waitTimeoutMs = additionalOptions.wait_for_method_timeout;\r\n                if (additionalOptions.waitTimeoutMs === undefined) {\r\n                    additionalOptions.waitTimeoutMs = _this.configuration.waitTimeoutMs;\r\n                }\r\n            }\r\n            if (additionalOptions.waitTimeoutMs !== undefined && typeof additionalOptions.waitTimeoutMs !== \"number\") {\r\n                reject({ message: '\"' + additionalOptions.waitTimeoutMs + '\" is not a valid number for \\'waitTimeoutMs\\'' });\r\n                return;\r\n            }\r\n            if (typeof argumentObj !== \"object\") {\r\n                reject({ message: \"The method arguments must be an object.\" });\r\n                return;\r\n            }\r\n            if (typeof methodFilter === \"string\") {\r\n                methodFilter = { name: methodFilter };\r\n            }\r\n            var serversMethodMap = _this.getServerMethodsByFilterAndTarget(methodFilter, target);\r\n            if (serversMethodMap.length === 0) {\r\n                _this.invokeUnExisting(methodFilter, argumentObj, target, additionalOptions, successProxy, errorProxy);\r\n            }\r\n            else if (serversMethodMap.length === 1) {\r\n                var serverMethodPair = serversMethodMap[0];\r\n                _this.clientInvocations.invoke(serverMethodPair.methods[0], argumentObj, serverMethodPair.server, additionalOptions, successProxy, errorProxy);\r\n            }\r\n            else {\r\n                _this.invokeOnAll(serversMethodMap, argumentObj, additionalOptions, successProxy, errorProxy);\r\n            }\r\n        });\r\n        return promisify_1.default(promise, success, error);\r\n    };\r\n    Client.prototype.invokeUnExisting = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        var _this = this;\r\n        var callError = function () {\r\n            error({\r\n                method: methodFilter,\r\n                called_with: argumentObj,\r\n                message: \"Can not find a method matching \" + JSON.stringify(methodFilter) + \" with server filter \" + JSON.stringify(target),\r\n                executed_by: undefined,\r\n                returned: undefined,\r\n                status: undefined,\r\n            });\r\n        };\r\n        if (additionalOptions.waitTimeoutMs === 0) {\r\n            callError();\r\n        }\r\n        else {\r\n            var delayStep_1 = 500;\r\n            var delayTillNow_1 = 0;\r\n            var retry_2 = function () {\r\n                delayTillNow_1 += delayStep_1;\r\n                var serversMethodMap = _this.getServerMethodsByFilterAndTarget(methodFilter, target);\r\n                if (serversMethodMap.length > 0) {\r\n                    _this.invoke(methodFilter, argumentObj, target, additionalOptions, success, error);\r\n                }\r\n                else if (delayTillNow_1 >= additionalOptions.waitTimeoutMs) {\r\n                    callError();\r\n                }\r\n                else {\r\n                    setTimeout(retry_2, delayStep_1);\r\n                }\r\n            };\r\n            setTimeout(retry_2, delayStep_1);\r\n        }\r\n    };\r\n    Client.prototype.invokeOnAll = function (serverMethodsMap, argumentObj, additionalOptions, success, error) {\r\n        var _this = this;\r\n        var successes = [];\r\n        var errors = [];\r\n        var successCallback = function (result) {\r\n            successes.push(result);\r\n            sendResponse();\r\n        };\r\n        var errorCallback = function (err) {\r\n            errors.push(err);\r\n            sendResponse();\r\n        };\r\n        var sendResponse = function () {\r\n            if (successes.length + errors.length < serverMethodsMap.length) {\r\n                return;\r\n            }\r\n            if (successes.length !== 0) {\r\n                var result_1 = successes.reduce(function (obj, invResult) {\r\n                    obj.method = invResult.method;\r\n                    obj.called_with = invResult.called_with;\r\n                    obj.returned = invResult.returned;\r\n                    obj.all_return_values.push({\r\n                        executed_by: invResult.executed_by,\r\n                        returned: invResult.returned,\r\n                        called_with: invResult.called_with,\r\n                        method: invResult.method,\r\n                        message: undefined,\r\n                        status: undefined,\r\n                    });\r\n                    obj.executed_by = invResult.executed_by;\r\n                    return obj;\r\n                }, { all_return_values: [] });\r\n                if (errors.length !== 0) {\r\n                    result_1.all_errors = [];\r\n                    errors.forEach(function (obj) {\r\n                        result_1.all_errors.push({\r\n                            executed_by: obj.executed_by,\r\n                            called_with: obj.called_with,\r\n                            name: obj.method.name,\r\n                            message: obj.message,\r\n                        });\r\n                    });\r\n                }\r\n                success(result_1);\r\n            }\r\n            else if (errors.length !== 0) {\r\n                error(errors.reduce(function (obj, currentError) {\r\n                    obj.method = currentError.method;\r\n                    obj.called_with = currentError.called_with;\r\n                    obj.message = currentError.message;\r\n                    obj.all_errors.push({\r\n                        executed_by: currentError.executed_by,\r\n                        message: currentError.message,\r\n                    });\r\n                    return obj;\r\n                }, { all_errors: [] }));\r\n            }\r\n        };\r\n        serverMethodsMap.forEach(function (serverMethodsPair) {\r\n            _this.clientInvocations.invoke(serverMethodsPair.methods[0], argumentObj, serverMethodsPair.server, additionalOptions, successCallback, errorCallback);\r\n        });\r\n    };\r\n    Client.prototype.filterByTarget = function (target, serverMethodMap) {\r\n        var _this = this;\r\n        var targetServerMethod = [];\r\n        if (typeof target === \"string\") {\r\n            if (target === \"all\") {\r\n                targetServerMethod = serverMethodMap;\r\n            }\r\n            else if (target === \"best\") {\r\n                var matchingMachine = serverMethodMap.filter(function (serverMethodPair) {\r\n                    var serverInfo = serverMethodPair.server.info;\r\n                    return serverInfo.machine === _this.instance.machine;\r\n                })[0];\r\n                if (matchingMachine) {\r\n                    return [matchingMachine];\r\n                }\r\n                targetServerMethod = serverMethodMap[0] !== undefined ? [serverMethodMap[0]] : [];\r\n            }\r\n        }\r\n        else {\r\n            if (!Array.isArray(target)) {\r\n                target = [target];\r\n            }\r\n            if (Array.isArray(target)) {\r\n                targetServerMethod = target.reduce(function (matches, filter) {\r\n                    var myMatches = serverMethodMap.filter(function (serverMethodPair) {\r\n                        return _this.instanceMatch(filter, serverMethodPair.server.info);\r\n                    });\r\n                    return matches.concat(myMatches);\r\n                }, []);\r\n            }\r\n        }\r\n        return targetServerMethod;\r\n    };\r\n    Client.prototype.instanceMatch = function (instanceFilter, instanceDefinition) {\r\n        return this.containsProps(instanceFilter, instanceDefinition);\r\n    };\r\n    Client.prototype.methodMatch = function (methodFilter, methodDefinition) {\r\n        return this.containsProps(methodFilter, methodDefinition);\r\n    };\r\n    Client.prototype.containsProps = function (filter, object) {\r\n        return Object.keys(filter).reduce(function (match, prop) {\r\n            if (!filter[prop] || typeof filter[prop] === \"function\") {\r\n                return match;\r\n            }\r\n            if (filter[prop].constructor === RegExp) {\r\n                if (!filter[prop].test(object[prop])) {\r\n                    return false;\r\n                }\r\n                else {\r\n                    return match;\r\n                }\r\n            }\r\n            else {\r\n                if (String(filter[prop]).toLowerCase() !== String(object[prop]).toLowerCase()) {\r\n                    return false;\r\n                }\r\n                else {\r\n                    return match;\r\n                }\r\n            }\r\n        }, true);\r\n    };\r\n    Client.prototype.getMethods = function (methodFilter) {\r\n        var _this = this;\r\n        if (methodFilter === undefined) {\r\n            return this.repo.getMethods();\r\n        }\r\n        if (typeof methodFilter === \"string\") {\r\n            methodFilter = { name: methodFilter };\r\n        }\r\n        return this.repo.getMethods().filter(function (method) {\r\n            return _this.methodMatch(methodFilter, method.info);\r\n        });\r\n    };\r\n    Client.prototype.getMethodsForInstance = function (instanceFilter) {\r\n        var _this = this;\r\n        var allServers = this.repo.getServers();\r\n        var matchingServers = allServers.filter(function (server) {\r\n            return _this.instanceMatch(instanceFilter, server.info);\r\n        });\r\n        if (matchingServers.length === 0) {\r\n            return [];\r\n        }\r\n        var resultMethodsObject = {};\r\n        if (matchingServers.length === 1) {\r\n            resultMethodsObject = matchingServers[0].methods;\r\n        }\r\n        else {\r\n            matchingServers.forEach(function (server) {\r\n                Object.keys(server.methods).forEach(function (methodKey) {\r\n                    var method = server.methods[methodKey];\r\n                    resultMethodsObject[method.id] = method;\r\n                });\r\n            });\r\n        }\r\n        return Object.keys(resultMethodsObject)\r\n            .map(function (key) {\r\n            return resultMethodsObject[key];\r\n        });\r\n    };\r\n    Client.prototype.getServers = function (methodFilter) {\r\n        var _this = this;\r\n        var servers = this.repo.getServers();\r\n        if (methodFilter === undefined) {\r\n            return servers.map(function (server) {\r\n                return { server: server };\r\n            });\r\n        }\r\n        var methods = this.getMethods(methodFilter);\r\n        if (methods === undefined) {\r\n            return [];\r\n        }\r\n        return servers.reduce(function (prev, current) {\r\n            var methodsForServer = _this.repo.getServerMethodsById(current.id);\r\n            var matchingMethods = methodsForServer.filter(function (method) {\r\n                return _this.methodMatch(methodFilter, method.info);\r\n            });\r\n            if (matchingMethods.length > 0) {\r\n                prev.push({ server: current, methods: matchingMethods });\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Client.prototype.getServerMethodsByFilterAndTarget = function (methodFilter, target) {\r\n        var serversMethodMap = this.getServers(methodFilter);\r\n        return this.filterByTarget(target, serversMethodMap);\r\n    };\r\n    return Client;\r\n}());\r\nexports.default = Client;\r\n//# sourceMappingURL=client.js.map\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nvar ClientInvocations = (function () {\r\n    function ClientInvocations(_protocol) {\r\n        var _this = this;\r\n        this._protocol = _protocol;\r\n        this._pendingCallbacks = {};\r\n        _protocol.client.onInvocationResult(function (invocationId, executedBy, status, result, resultMessage) {\r\n            return _this.processInvocationResult(invocationId, executedBy, status, result, resultMessage);\r\n        });\r\n    }\r\n    ClientInvocations.prototype.invoke = function (method, argumentsObj, target, stuff, success, error) {\r\n        var invocationId = random_1.default();\r\n        this.registerInvocation(invocationId, {\r\n            method: method,\r\n            calledWith: argumentsObj,\r\n        }, success, error, stuff.methodResponseTimeoutMs);\r\n        this._protocol.client.invoke(invocationId, method, argumentsObj, target, stuff);\r\n    };\r\n    ClientInvocations.prototype.registerInvocation = function (invocationId, invocationInfo, success, error, timeout) {\r\n        var _this = this;\r\n        this._pendingCallbacks[invocationId] = { invocationInfo: invocationInfo, success: success, error: error };\r\n        setTimeout(function () {\r\n            if (_this._pendingCallbacks[invocationId] === undefined) {\r\n                return;\r\n            }\r\n            error({\r\n                method: invocationInfo.method.getInfoForUser(),\r\n                called_with: invocationInfo.calledWith,\r\n                executed_by: undefined,\r\n                status: undefined,\r\n                returned: undefined,\r\n                message: \"Invocation timeout (\" + timeout + \" ms) reached\",\r\n            });\r\n            delete _this._pendingCallbacks[invocationId];\r\n        }, timeout);\r\n    };\r\n    ClientInvocations.prototype.processInvocationResult = function (invocationId, executedBy, status, result, resultMessage) {\r\n        var callback = this._pendingCallbacks[invocationId];\r\n        if (callback === undefined) {\r\n            return;\r\n        }\r\n        if (status === 0 && typeof callback.success === \"function\") {\r\n            callback.success({\r\n                method: callback.invocationInfo.method.getInfoForUser(),\r\n                called_with: callback.invocationInfo.calledWith,\r\n                executed_by: executedBy,\r\n                returned: result,\r\n                message: resultMessage,\r\n                status: status,\r\n            });\r\n        }\r\n        else if (typeof callback.error === \"function\") {\r\n            callback.error({\r\n                method: callback.invocationInfo.method.getInfoForUser(),\r\n                called_with: callback.invocationInfo.calledWith,\r\n                executed_by: executedBy,\r\n                message: resultMessage,\r\n                status: status,\r\n                returned: result,\r\n            });\r\n        }\r\n        delete this._pendingCallbacks[invocationId];\r\n    };\r\n    return ClientInvocations;\r\n}());\r\nexports.default = ClientInvocations;\r\n//# sourceMappingURL=invoke.js.map\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar ClientRepository = (function () {\r\n    function ClientRepository() {\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n        this.callbacks = callback_registry_1.default();\r\n    }\r\n    ClientRepository.prototype.addServer = function (info, serverId) {\r\n        var _this = this;\r\n        var current = this.servers[serverId];\r\n        if (current) {\r\n            return current.id;\r\n        }\r\n        var serverEntry = {\r\n            id: serverId,\r\n            info: info,\r\n            methods: {},\r\n            getInfoForUser: function () {\r\n                var serverInfo = _this.createUserServerInfo(serverEntry.info);\r\n                serverInfo.getMethods = function () {\r\n                    return _this.getServerMethodsById(serverEntry.id).map(function (m) {\r\n                        return m.getInfoForUser();\r\n                    });\r\n                };\r\n                serverInfo.getStreams = function () {\r\n                    return _this.getServerMethodsById(serverEntry.id)\r\n                        .filter(function (method) {\r\n                        return method.info.supportsStreaming;\r\n                    })\r\n                        .map(function (m) {\r\n                        return m.getInfoForUser();\r\n                    });\r\n                };\r\n                return serverInfo;\r\n            },\r\n        };\r\n        this.servers[serverId] = serverEntry;\r\n        this.callbacks.execute(\"onServerAdded\", serverEntry);\r\n        return serverId;\r\n    };\r\n    ClientRepository.prototype.removeServerById = function (id, reason) {\r\n        var _this = this;\r\n        var server = this.servers[id];\r\n        Object.keys(server.methods).forEach(function (methodId) {\r\n            _this.removeServerMethod(id, methodId);\r\n        });\r\n        delete this.servers[id];\r\n        this.callbacks.execute(\"onServerRemoved\", server, reason);\r\n    };\r\n    ClientRepository.prototype.addServerMethod = function (serverId, method, protocolState) {\r\n        if (!protocolState) {\r\n            protocolState = {};\r\n        }\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        var methodId = this.createMethodId(method);\r\n        if (server.methods[methodId]) {\r\n            return;\r\n        }\r\n        var that = this;\r\n        var methodEntity = {\r\n            id: methodId,\r\n            info: method,\r\n            getInfoForUser: function () {\r\n                var result = that.createUserMethodInfo(methodEntity.info);\r\n                result.getServers = function () {\r\n                    return that.getServersByMethod(methodId);\r\n                };\r\n                return result;\r\n            },\r\n            protocolState: protocolState,\r\n        };\r\n        server.methods[methodId] = methodEntity;\r\n        if (!this.methodsCount[methodId]) {\r\n            this.methodsCount[methodId] = 0;\r\n            this.callbacks.execute(\"onMethodAdded\", methodEntity);\r\n        }\r\n        this.methodsCount[methodId] = this.methodsCount[methodId] + 1;\r\n        this.callbacks.execute(\"onServerMethodAdded\", server, methodEntity);\r\n    };\r\n    ClientRepository.prototype.createMethodId = function (methodInfo) {\r\n        var accepts = methodInfo.accepts !== undefined ? methodInfo.accepts : \"\";\r\n        var returns = methodInfo.returns !== undefined ? methodInfo.returns : \"\";\r\n        return (methodInfo.name + accepts + returns).toLowerCase();\r\n    };\r\n    ClientRepository.prototype.removeServerMethod = function (serverId, methodId) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        var method = server.methods[methodId];\r\n        delete server.methods[methodId];\r\n        this.methodsCount[methodId] = this.methodsCount[methodId] - 1;\r\n        if (this.methodsCount[methodId] === 0) {\r\n            this.callbacks.execute(\"onMethodRemoved\", method);\r\n        }\r\n        this.callbacks.execute(\"onServerMethodRemoved\", server, method);\r\n    };\r\n    ClientRepository.prototype.getMethods = function () {\r\n        var _this = this;\r\n        var allMethods = {};\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var method = server.methods[methodId];\r\n                allMethods[method.id] = method;\r\n            });\r\n        });\r\n        var methodsAsArray = Object.keys(allMethods).map(function (id) {\r\n            return allMethods[id];\r\n        });\r\n        return methodsAsArray;\r\n    };\r\n    ClientRepository.prototype.getServers = function () {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            allServers.push(server);\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.getServerMethodsById = function (serverId) {\r\n        var server = this.servers[serverId];\r\n        return Object.keys(server.methods).map(function (id) {\r\n            return server.methods[id];\r\n        });\r\n    };\r\n    ClientRepository.prototype.onServerAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerAdded\", callback);\r\n        this.getServers().forEach(function (server) {\r\n            callback(server);\r\n        });\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodAdded\", callback);\r\n        this.getMethods().forEach(function (method) {\r\n            callback(method);\r\n        });\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodAdded\", callback);\r\n        this.getServers().forEach(function (server) {\r\n            var methods = server.methods;\r\n            Object.keys(methods).forEach(function (methodId) {\r\n                callback(server, methods[methodId]);\r\n            });\r\n        });\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.getServerById = function (id) {\r\n        return this.servers[id];\r\n    };\r\n    ClientRepository.prototype.reset = function () {\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n    };\r\n    ClientRepository.prototype.createUserServerInfo = function (serverInfo) {\r\n        return {\r\n            machine: serverInfo.machine,\r\n            pid: serverInfo.pid,\r\n            user: serverInfo.user,\r\n            application: serverInfo.application,\r\n            environment: serverInfo.environment,\r\n            region: serverInfo.region,\r\n            instance: serverInfo.instance,\r\n            windowId: serverInfo.windowId,\r\n            peerId: serverInfo.peerId,\r\n        };\r\n    };\r\n    ClientRepository.prototype.createUserMethodInfo = function (methodInfo) {\r\n        var result = {\r\n            name: methodInfo.name,\r\n            accepts: methodInfo.accepts,\r\n            returns: methodInfo.returns,\r\n            description: methodInfo.description,\r\n            displayName: methodInfo.displayName,\r\n            objectTypes: methodInfo.objectTypes,\r\n            supportsStreaming: methodInfo.supportsStreaming,\r\n        };\r\n        result.object_types = methodInfo.objectTypes;\r\n        result.display_name = methodInfo.displayName;\r\n        result.version = methodInfo.version;\r\n        return result;\r\n    };\r\n    ClientRepository.prototype.getServersByMethod = function (id) {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                if (methodId === id) {\r\n                    allServers.push(server.getInfoForUser());\r\n                }\r\n            });\r\n        });\r\n        return allServers;\r\n    };\r\n    return ClientRepository;\r\n}());\r\nexports.default = ClientRepository;\r\n//# sourceMappingURL=repository.js.map\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar promisify_1 = __webpack_require__(8);\r\nvar NativeAGM = (function () {\r\n    function NativeAGM(instance, helpers, agmFacade) {\r\n        this.instance = instance;\r\n        this.helpers = helpers;\r\n        this.agmFacade = agmFacade;\r\n        this.protocolVersion = this.agmFacade.protocolVersion;\r\n    }\r\n    NativeAGM.prototype.register = function (name, handler) {\r\n        var methodInfoAsObject = this.helpers.stringToObject(name, \"name\");\r\n        this.helpers.validateMethodInfo(methodInfoAsObject);\r\n        if (this.protocolVersion && this.protocolVersion >= 3) {\r\n            this.agmFacade.register(JSON.stringify(methodInfoAsObject), handler, true);\r\n        }\r\n        else {\r\n            this.agmFacade.register(JSON.stringify(methodInfoAsObject), function (arg, caller) {\r\n                var methodResult = handler(JSON.parse(arg), caller);\r\n                return JSON.stringify(methodResult);\r\n            });\r\n        }\r\n    };\r\n    NativeAGM.prototype.registerAsync = function (name, handler) {\r\n        if (!this.agmFacade.registerAsync) {\r\n            throw new Error(\"not supported in that version of HtmlContainer\");\r\n        }\r\n        var methodInfoAsObject = this.helpers.stringToObject(name, \"name\");\r\n        this.helpers.validateMethodInfo(methodInfoAsObject);\r\n        this.agmFacade.registerAsync(methodInfoAsObject, function (args, instance, tracker) {\r\n            handler(args, instance, function (successArgs) {\r\n                tracker.success(successArgs);\r\n            }, function (error) {\r\n                tracker.error(error);\r\n            });\r\n        });\r\n    };\r\n    NativeAGM.prototype.unregister = function (definition) {\r\n        this.agmFacade.unregister(JSON.stringify(this.helpers.stringToObject(definition, \"name\")));\r\n    };\r\n    NativeAGM.prototype.invoke = function (method, argumentObj, target, options, success, error) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (argumentObj === undefined) {\r\n                argumentObj = {};\r\n            }\r\n            if (typeof argumentObj !== \"object\") {\r\n                reject({ message: \"The method arguments must be an object.\" });\r\n            }\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            target = _this.helpers.targetArgToObject(target);\r\n            if (_this.agmFacade.invoke2) {\r\n                _this.agmFacade.invoke2(JSON.stringify(_this.helpers.stringToObject(method, \"name\")), argumentObj, JSON.stringify(target), JSON.stringify(options), function (a) {\r\n                    resolve(a);\r\n                }, function (err) {\r\n                    reject(err);\r\n                });\r\n            }\r\n            else {\r\n                var successProxy = void 0;\r\n                var errorProxy = void 0;\r\n                successProxy = function (args) {\r\n                    var parsed = JSON.parse(args);\r\n                    resolve(parsed);\r\n                };\r\n                errorProxy = function (args) {\r\n                    var parsed = JSON.parse(args);\r\n                    reject(parsed);\r\n                };\r\n                _this.agmFacade.invoke(JSON.stringify(_this.helpers.stringToObject(method, \"name\")), JSON.stringify(argumentObj), JSON.stringify(target), JSON.stringify(options), successProxy, errorProxy);\r\n            }\r\n        });\r\n        return promisify_1.default(promise, success, error);\r\n    };\r\n    NativeAGM.prototype.createStream = function (methodDefinition, options, successCallback, errorCallback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (typeof methodDefinition === \"string\") {\r\n                methodDefinition = {\r\n                    name: methodDefinition,\r\n                    getServers: function () { return []; },\r\n                };\r\n            }\r\n            if (!options) {\r\n                options = {\r\n                    subscriptionRequestHandler: undefined,\r\n                    subscriptionAddedHandler: undefined,\r\n                    subscriptionRemovedHandler: undefined,\r\n                };\r\n            }\r\n            _this.agmFacade.createStream2(JSON.stringify(methodDefinition), options.subscriptionRequestHandler, options.subscriptionAddedHandler, options.subscriptionRemovedHandler, function (stream) {\r\n                resolve(stream);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n        return promisify_1.default(promise, successCallback, errorCallback);\r\n    };\r\n    NativeAGM.prototype.subscribe = function (methodDefinition, parameters, successCallback, errorCallback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (typeof methodDefinition === \"undefined\") {\r\n                reject(\"method definition param is required\");\r\n            }\r\n            if (parameters === undefined) {\r\n                parameters = {};\r\n            }\r\n            parameters.args = JSON.stringify(parameters.arguments || {});\r\n            parameters.target = _this.helpers.targetArgToObject(parameters.target);\r\n            var name;\r\n            if (typeof methodDefinition === \"string\") {\r\n                name = methodDefinition;\r\n            }\r\n            else {\r\n                name = methodDefinition.name;\r\n            }\r\n            _this.agmFacade.subscribe2(name, JSON.stringify(parameters), function (sub) {\r\n                resolve(sub);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n        return promisify_1.default(promise, successCallback, errorCallback);\r\n    };\r\n    NativeAGM.prototype.servers = function (filter) {\r\n        var _this = this;\r\n        var jsonResult = this.agmFacade.servers(JSON.stringify(this.helpers.stringToObject(filter, \"name\")));\r\n        var parsedResult = this.helpers.agmParse(jsonResult);\r\n        return parsedResult.map(function (server) {\r\n            return _this.transformServerObject(server);\r\n        });\r\n    };\r\n    NativeAGM.prototype.methods = function (filter) {\r\n        var _this = this;\r\n        var jsonResult = this.agmFacade.methods(JSON.stringify(this.helpers.stringToObject(filter, \"name\")));\r\n        var parsedResult = this.helpers.agmParse(jsonResult);\r\n        return parsedResult.map(function (method) {\r\n            return _this.transformMethodObject(method);\r\n        });\r\n    };\r\n    NativeAGM.prototype.methodAdded = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.methodAdded(function (method) {\r\n            if (subscribed) {\r\n                callback(_this.transformMethodObject(method));\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.methodRemoved = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.methodRemoved(function (method) {\r\n            if (subscribed) {\r\n                callback(_this.transformMethodObject(method));\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.serverAdded = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.serverAdded(function (server) {\r\n            if (subscribed) {\r\n                callback(_this.transformServerObject(server));\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.serverRemoved = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.serverRemoved(function (server) {\r\n            if (subscribed) {\r\n                callback(_this.transformServerObject(server));\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.serverMethodAdded = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.serverMethodAdded(function (info) {\r\n            if (subscribed) {\r\n                callback({\r\n                    server: _this.transformServerObject(info.server),\r\n                    method: _this.transformMethodObject(info.method),\r\n                });\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.serverMethodRemoved = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.serverMethodRemoved(function (info) {\r\n            if (subscribed) {\r\n                callback({\r\n                    server: _this.transformServerObject(info.server),\r\n                    method: _this.transformMethodObject(info.method),\r\n                });\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.methodsForInstance = function (server) {\r\n        var jsonResult = this.agmFacade.methodsForInstance(JSON.stringify(server));\r\n        var methods = this.helpers.agmParse(jsonResult);\r\n        return methods.map(this.transformMethodObject);\r\n    };\r\n    NativeAGM.prototype.transformMethodObject = function (method) {\r\n        var _this = this;\r\n        if (!method) {\r\n            return undefined;\r\n        }\r\n        if (!method.displayName) {\r\n            method.displayName = method.display_name;\r\n        }\r\n        if (!method.objectTypes) {\r\n            method.objectTypes = method.object_types;\r\n        }\r\n        method.getServers = function () {\r\n            return _this.servers(method.name);\r\n        };\r\n        return method;\r\n    };\r\n    NativeAGM.prototype.transformServerObject = function (server) {\r\n        var _this = this;\r\n        if (!server) {\r\n            return undefined;\r\n        }\r\n        server.getMethods = function () {\r\n            return _this.methodsForInstance(server);\r\n        };\r\n        server.getStreams = function () {\r\n            return _this.methodsForInstance(server).filter(function (method) {\r\n                return method.supportsStreaming;\r\n            });\r\n        };\r\n        return server;\r\n    };\r\n    return NativeAGM;\r\n}());\r\nexports.NativeAGM = NativeAGM;\r\n//# sourceMappingURL=agm.js.map\n\n/***/ }),\n/* 32 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Helpers = (function () {\r\n    function Helpers(facade) {\r\n        this.facade = facade;\r\n        this.dateTimeIdentifier = facade.jsonValueDatePrefix;\r\n        this.lenOfIdentifier = this.dateTimeIdentifier.length;\r\n    }\r\n    Helpers.prototype.agmParse = function (str) {\r\n        var _this = this;\r\n        return JSON.parse(str, function (k, v) {\r\n            if (typeof v !== \"string\") {\r\n                return v;\r\n            }\r\n            if (v[0] !== _this.dateTimeIdentifier[0]) {\r\n                return v;\r\n            }\r\n            if (v.indexOf(_this.dateTimeIdentifier) !== 0) {\r\n                return v;\r\n            }\r\n            var unixTimestampMs = v.substr(_this.lenOfIdentifier);\r\n            return new Date(parseFloat(unixTimestampMs));\r\n        });\r\n    };\r\n    Helpers.prototype.targetArgToObject = function (target) {\r\n        var _this = this;\r\n        target = target || \"best\";\r\n        if (typeof target === \"string\") {\r\n            if (target !== \"all\" && target !== \"best\") {\r\n                throw new Error(target + \" is not a valid target. Valid targets are 'all' and 'best'\");\r\n            }\r\n            return { target: target };\r\n        }\r\n        else {\r\n            if (!Array.isArray(target)) {\r\n                target = [target];\r\n            }\r\n            target = target.map(function (e) {\r\n                return _this.convertInstanceToRegex(e);\r\n            });\r\n            return { serverFilter: target };\r\n        }\r\n    };\r\n    Helpers.prototype.convertInstanceToRegex = function (instance) {\r\n        var instanceConverted = {};\r\n        Object.keys(instance).forEach(function (key) {\r\n            var propValue = instance[key];\r\n            instanceConverted[key] = propValue;\r\n            if (typeof propValue === \"undefined\" || propValue === null) {\r\n                return;\r\n            }\r\n            if (typeof propValue === \"string\" && propValue !== \"\") {\r\n                instanceConverted[key] = \"^\" + instance[key] + \"$\";\r\n            }\r\n            else if (instance[key].constructor === RegExp) {\r\n                instanceConverted[key] = instance[key].source;\r\n            }\r\n            else {\r\n                instanceConverted[key] = instance[key];\r\n            }\r\n        });\r\n        return instanceConverted;\r\n    };\r\n    Helpers.prototype.validateMethodInfo = function (methodInfo) {\r\n        if (typeof methodInfo === \"undefined\") {\r\n            throw Error(\"methodInfo is required argument\");\r\n        }\r\n        if (!methodInfo.name) {\r\n            throw Error(\"methodInfo object must contain name property\");\r\n        }\r\n        if (methodInfo.objectTypes) {\r\n            methodInfo.object_types = methodInfo.objectTypes;\r\n        }\r\n        if (methodInfo.displayName) {\r\n            methodInfo.display_name = methodInfo.displayName;\r\n        }\r\n    };\r\n    Helpers.prototype.stringToObject = function (param, stringPropName) {\r\n        if (typeof param === \"string\") {\r\n            var obj = {};\r\n            obj[stringPropName] = param;\r\n            return obj;\r\n        }\r\n        return param;\r\n    };\r\n    return Helpers;\r\n}());\r\nexports.Helpers = Helpers;\r\n//# sourceMappingURL=helpers.js.map\n\n/***/ }),\n/* 33 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar agm_1 = __webpack_require__(31);\r\nvar helpers_1 = __webpack_require__(32);\r\nfunction default_1(configuration) {\r\n    var facade = window.htmlContainer.jsAgmFacade;\r\n    var cfgAsString = createConfig(configuration);\r\n    return new Promise(function (resolve, reject) {\r\n        var successInit = function (instance) {\r\n            var nativeAGM = new agm_1.NativeAGM(instance, new helpers_1.Helpers(facade), facade);\r\n            nativeAGM.create_stream = nativeAGM.createStream;\r\n            nativeAGM.methods_for_instance = nativeAGM.methodsForInstance;\r\n            nativeAGM.method_added = nativeAGM.methodAdded;\r\n            nativeAGM.method_removed = nativeAGM.methodRemoved;\r\n            nativeAGM.server_added = nativeAGM.serverAdded;\r\n            nativeAGM.server_removed = nativeAGM.serverRemoved;\r\n            nativeAGM.server_method_added = nativeAGM.serverMethodAdded;\r\n            nativeAGM.server_method_removed = nativeAGM.serverMethodRemoved;\r\n            resolve(nativeAGM);\r\n        };\r\n        if (facade.protocolVersion && facade.protocolVersion >= 5 && facade.initAsync) {\r\n            facade.initAsync(cfgAsString, successInit, function (err) {\r\n                reject(err);\r\n            });\r\n        }\r\n        else {\r\n            var instance = facade.init(cfgAsString);\r\n            successInit(instance);\r\n        }\r\n    });\r\n}\r\nexports.default = default_1;\r\nvar createConfig = function (configuration) {\r\n    if (configuration !== undefined && configuration.metrics !== undefined) {\r\n        configuration.metrics.metricsIdentity = configuration.metrics.identity;\r\n        var metricsConfig = {\r\n            metricsIdentity: configuration.metrics.metricsIdentity,\r\n            path: configuration.metrics.path,\r\n        };\r\n        configuration.metrics = metricsConfig;\r\n    }\r\n    delete configuration.logger;\r\n    return JSON.stringify(configuration);\r\n};\r\n//# sourceMappingURL=native.js.map\n\n/***/ }),\n/* 34 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nfunction createOwnInstance(userSubmittedProperties, resolvedIdentity, peerId) {\r\n    var document = global.document || global.process;\r\n    var instance = {\r\n        application: document.title + random_1.default(),\r\n        pid: Math.floor(Math.random() * 10000000000),\r\n    };\r\n    instance.peerId = peerId;\r\n    if (typeof userSubmittedProperties === \"object\") {\r\n        if (userSubmittedProperties.application !== undefined) {\r\n            instance.application = userSubmittedProperties.application;\r\n        }\r\n        instance.machine = userSubmittedProperties.machine;\r\n        instance.user = userSubmittedProperties.user;\r\n        instance.environment = userSubmittedProperties.environment;\r\n        instance.region = userSubmittedProperties.region;\r\n    }\r\n    if (typeof resolvedIdentity !== \"undefined\") {\r\n        instance.user = resolvedIdentity.user;\r\n        instance.instance = resolvedIdentity.instance;\r\n        instance.application = resolvedIdentity.application;\r\n        instance.pid = resolvedIdentity.process;\r\n        instance.machine = resolvedIdentity.machine;\r\n        instance.environment = resolvedIdentity.environment;\r\n        instance.region = resolvedIdentity.region;\r\n        instance.windowId = resolvedIdentity.windowId;\r\n    }\r\n    return instance;\r\n}\r\nexports.createOwnInstance = createOwnInstance;\r\n//# sourceMappingURL=instance.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(7)))\n\n/***/ }),\n/* 35 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar instance_1 = __webpack_require__(34);\r\nvar native_1 = __webpack_require__(33);\r\nvar factory_1 = __webpack_require__(38);\r\nvar factory_2 = __webpack_require__(43);\r\nvar agm_1 = __webpack_require__(27);\r\nvar repository_1 = __webpack_require__(30);\r\nvar repository_2 = __webpack_require__(47);\r\nexports.default = (function (configuration) {\r\n    if (!configuration.forceGW && configuration.gdVersion === 2) {\r\n        return native_1.default(configuration);\r\n    }\r\n    if (typeof configuration === \"undefined\") {\r\n        throw new Error(\"configuration is required\");\r\n    }\r\n    if (typeof configuration.connection === \"undefined\") {\r\n        throw new Error(\"configuration.connections is required\");\r\n    }\r\n    var connection = configuration.connection;\r\n    if (typeof configuration.methodResponseTimeout !== \"number\") {\r\n        configuration.methodResponseTimeout = 3000;\r\n    }\r\n    if (typeof configuration.waitTimeoutMs !== \"number\") {\r\n        configuration.waitTimeoutMs = 3000;\r\n    }\r\n    var myIdentity = connection.resolvedIdentity;\r\n    var myInstance = instance_1.createOwnInstance(configuration.instance, myIdentity, connection.peerId);\r\n    var clientRepository = new repository_1.default();\r\n    var serverRepository = new repository_2.default();\r\n    var protocolPromise;\r\n    var agmImpl;\r\n    if (connection.protocolVersion === 3) {\r\n        protocolPromise = factory_2.default(myInstance, connection, clientRepository, serverRepository, configuration, function () { return agmImpl; });\r\n    }\r\n    else {\r\n        protocolPromise = factory_1.default(myInstance, connection, clientRepository, serverRepository, configuration, function () { return agmImpl; });\r\n    }\r\n    return new Promise(function (resolve, reject) {\r\n        protocolPromise.then(function (protocol) {\r\n            agmImpl = new agm_1.default(protocol, clientRepository, serverRepository, myInstance, configuration);\r\n            resolve(agmImpl);\r\n        }).catch(function (err) {\r\n            reject(err);\r\n        });\r\n    });\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 36 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nvar helpers_1 = __webpack_require__(5);\r\nvar STATUS_AWAITING_ACCEPT = \"awaitingAccept\";\r\nvar STATUS_SUBSCRIBED = \"subscribed\";\r\nvar ERR_MSG_SUB_FAILED = \"Subscription failed.\";\r\nvar ERR_MSG_SUB_REJECTED = \"Subscription rejected.\";\r\nvar ON_CLOSE_MSG_SERVER_INIT = \"ServerInitiated\";\r\nvar ON_CLOSE_MSG_CLIENT_INIT = \"ClientInitiated\";\r\nvar ClientStreaming = (function () {\r\n    function ClientStreaming(configuration, instance, sendRequest, nextResponseSubject) {\r\n        this.configuration = configuration;\r\n        this.instance = instance;\r\n        this.sendRequest = sendRequest;\r\n        this.nextResponseSubject = nextResponseSubject;\r\n        this.subscriptionsList = {};\r\n    }\r\n    ClientStreaming.prototype.subscribe = function (stream, args, targetServers, options, success, error) {\r\n        var _this = this;\r\n        if (targetServers.length === 0) {\r\n            error({\r\n                method: stream.getInfoForUser(),\r\n                message: ERR_MSG_SUB_FAILED + \" No available servers matched the target params.\",\r\n                called_with: args,\r\n            });\r\n            return;\r\n        }\r\n        var subscriptionId = \"subscriptionId_\" + random_1.default();\r\n        var pendingSub = this.registerSubscription(subscriptionId, stream, args, success, error, options.methodResponseTimeout);\r\n        if (typeof pendingSub !== \"object\") {\r\n            error({\r\n                method: stream.getInfoForUser(),\r\n                message: ERR_MSG_SUB_FAILED + \" Unable to register the user callbacks.\",\r\n                called_with: args,\r\n            });\r\n            return;\r\n        }\r\n        targetServers.forEach(function (target) {\r\n            var responseSubject = _this.nextResponseSubject();\r\n            var requestSubject = stream.info.requestSubject;\r\n            pendingSub.trackedServers.push({\r\n                server: undefined,\r\n                streamId: undefined,\r\n                streamSubjects: {\r\n                    global: undefined,\r\n                    private: undefined,\r\n                },\r\n                methodRequestSubject: requestSubject,\r\n                methodResponseSubject: responseSubject,\r\n            });\r\n            var message = {\r\n                EventStreamAction: 1,\r\n                MethodRequestSubject: requestSubject,\r\n                MethodResponseSubject: responseSubject,\r\n                Client: helpers_1.convertInstance(_this.instance),\r\n                Context: {\r\n                    ArgumentsJson: args,\r\n                    InvocationId: subscriptionId,\r\n                    MethodName: stream.info.name,\r\n                    ExecutionServer: target.server.info,\r\n                    Timeout: options.methodResponseTimeout,\r\n                },\r\n            };\r\n            _this.sendRequest(message);\r\n        });\r\n    };\r\n    ClientStreaming.prototype.processPublisherMsg = function (msg) {\r\n        if (!(msg && msg.EventStreamAction && msg.EventStreamAction !== 0)) {\r\n            return;\r\n        }\r\n        if (msg.EventStreamAction === 2) {\r\n            this.serverIsKickingASubscriber(msg);\r\n        }\r\n        else if (msg.EventStreamAction === 3) {\r\n            this.serverAcknowledgesGoodSubscription(msg);\r\n        }\r\n        else if (msg.EventStreamAction === 5) {\r\n            this.serverHasPushedSomeDataIntoTheStream(msg);\r\n        }\r\n    };\r\n    ClientStreaming.prototype.registerSubscription = function (subscriptionId, method, args, success, error, timeout) {\r\n        var _this = this;\r\n        this.subscriptionsList[subscriptionId] = {\r\n            status: STATUS_AWAITING_ACCEPT,\r\n            method: method,\r\n            arguments: args,\r\n            success: success,\r\n            error: error,\r\n            trackedServers: [],\r\n            handlers: {\r\n                onData: [],\r\n                onClosed: [],\r\n            },\r\n            queued: {\r\n                data: [],\r\n                closers: [],\r\n            },\r\n            timeoutId: undefined,\r\n        };\r\n        this.subscriptionsList[subscriptionId].timeoutId = setTimeout(function () {\r\n            if (_this.subscriptionsList[subscriptionId] === undefined) {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subscriptionId];\r\n            if (subscription.status === STATUS_AWAITING_ACCEPT) {\r\n                error({\r\n                    method: method,\r\n                    called_with: args,\r\n                    message: ERR_MSG_SUB_FAILED + \" Subscription attempt timed out after \" + timeout + \"ms.\",\r\n                });\r\n                delete _this.subscriptionsList[subscriptionId];\r\n            }\r\n            else if (subscription.status === STATUS_SUBSCRIBED &&\r\n                subscription.trackedServers.length > 0) {\r\n                subscription.trackedServers = subscription.trackedServers.filter(function (server) {\r\n                    return (typeof server.streamId === \"string\" && server.streamId !== \"\");\r\n                });\r\n                subscription.timeoutId = undefined;\r\n                if (subscription.trackedServers.length === 0) {\r\n                    var closersCount = subscription.queued.closers.length;\r\n                    var closingServer_1 = (closersCount > 0) ? subscription.queued.closers[closersCount - 1] : null;\r\n                    subscription.handlers.onClosed.forEach(function (callback) {\r\n                        if (typeof callback === \"function\") {\r\n                            callback({\r\n                                message: ON_CLOSE_MSG_SERVER_INIT,\r\n                                requestArguments: subscription.arguments,\r\n                                server: closingServer_1,\r\n                                stream: subscription.method,\r\n                            });\r\n                        }\r\n                    });\r\n                    delete _this.subscriptionsList[subscriptionId];\r\n                }\r\n            }\r\n        }, timeout);\r\n        return this.subscriptionsList[subscriptionId];\r\n    };\r\n    ClientStreaming.prototype.serverIsKickingASubscriber = function (msg) {\r\n        var _this = this;\r\n        var keys = Object.keys(this.subscriptionsList);\r\n        if (typeof msg.InvocationId === \"string\" && msg.InvocationId !== \"\") {\r\n            keys = keys.filter(function (k) { return k === msg.InvocationId; });\r\n        }\r\n        var deletionsList = [];\r\n        keys.forEach(function (key) {\r\n            if (typeof _this.subscriptionsList[key] !== \"object\") {\r\n                return;\r\n            }\r\n            _this.subscriptionsList[key].trackedServers = _this.subscriptionsList[key].trackedServers.filter(function (server) {\r\n                var isRejecting = (server.methodRequestSubject === msg.MethodRequestSubject && server.methodResponseSubject === msg.MethodResponseSubject);\r\n                var isKicking = (server.streamId === msg.StreamId &&\r\n                    (server.streamSubjects.global === msg.EventStreamSubject || server.streamSubjects.private === msg.EventStreamSubject));\r\n                var isRejectingOrKicking = isRejecting || isKicking;\r\n                return !isRejectingOrKicking;\r\n            });\r\n            if (_this.subscriptionsList[key].trackedServers.length === 0) {\r\n                deletionsList.push(key);\r\n            }\r\n        });\r\n        deletionsList.forEach(function (key) {\r\n            if (typeof _this.subscriptionsList[key] !== \"object\") {\r\n                return;\r\n            }\r\n            if (_this.subscriptionsList[key].status === STATUS_AWAITING_ACCEPT &&\r\n                typeof _this.subscriptionsList[key].timeoutId === \"number\") {\r\n                var reason = (typeof msg.ResultMessage === \"string\" && msg.ResultMessage !== \"\") ?\r\n                    ' Publisher said \"' + msg.ResultMessage + '\".' :\r\n                    \" No reason given.\";\r\n                var callArgs = typeof _this.subscriptionsList[key].arguments === \"object\" ?\r\n                    JSON.stringify(_this.subscriptionsList[key].arguments) :\r\n                    \"{}\";\r\n                _this.subscriptionsList[key].error(ERR_MSG_SUB_REJECTED + reason + \" Called with:\" + callArgs);\r\n                clearTimeout(_this.subscriptionsList[key].timeoutId);\r\n            }\r\n            else {\r\n                _this.subscriptionsList[key].handlers.onClosed.forEach(function (callback) {\r\n                    if (typeof callback !== \"function\") {\r\n                        return;\r\n                    }\r\n                    callback({\r\n                        message: ON_CLOSE_MSG_SERVER_INIT,\r\n                        requestArguments: _this.subscriptionsList[key].arguments,\r\n                        server: helpers_1.convertInfoToInstance(msg.Server),\r\n                        stream: _this.subscriptionsList[key].method,\r\n                    });\r\n                });\r\n            }\r\n            delete _this.subscriptionsList[key];\r\n        });\r\n    };\r\n    ClientStreaming.prototype.serverAcknowledgesGoodSubscription = function (msg) {\r\n        var _this = this;\r\n        var subscriptionId = msg.InvocationId;\r\n        var subscription = this.subscriptionsList[subscriptionId];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        var acceptingServer = subscription.trackedServers.filter(function (server) {\r\n            return (server.methodRequestSubject === msg.MethodRequestSubject &&\r\n                server.methodResponseSubject === msg.MethodResponseSubject);\r\n        })[0];\r\n        if (typeof acceptingServer !== \"object\") {\r\n            return;\r\n        }\r\n        var isFirstResponse = (subscription.status === STATUS_AWAITING_ACCEPT);\r\n        subscription.status = STATUS_SUBSCRIBED;\r\n        var privateStreamSubject = this.generatePrivateStreamSubject(subscription.method.name);\r\n        if (typeof acceptingServer.streamId === \"string\" && acceptingServer.streamId !== \"\") {\r\n            return;\r\n        }\r\n        acceptingServer.server = helpers_1.convertInfoToInstance(msg.Server);\r\n        acceptingServer.streamId = msg.StreamId;\r\n        acceptingServer.streamSubjects.global = msg.EventStreamSubject;\r\n        acceptingServer.streamSubjects.private = privateStreamSubject;\r\n        var confirmatoryRequest = {\r\n            EventStreamAction: 3,\r\n            EventStreamSubject: privateStreamSubject,\r\n            StreamId: msg.StreamId,\r\n            MethodRequestSubject: msg.MethodRequestSubject,\r\n            MethodResponseSubject: acceptingServer.methodResponseSubject,\r\n            Client: helpers_1.convertInstance(this.instance),\r\n            Context: {\r\n                ArgumentsJson: subscription.arguments,\r\n                MethodName: subscription.method.name,\r\n            },\r\n        };\r\n        this.sendRequest(confirmatoryRequest);\r\n        if (isFirstResponse) {\r\n            subscription.success({\r\n                onData: function (dataCallback) {\r\n                    if (typeof dataCallback !== \"function\") {\r\n                        throw new TypeError(\"The data callback must be a function.\");\r\n                    }\r\n                    this.handlers.onData.push(dataCallback);\r\n                    if (this.handlers.onData.length === 1 && this.queued.data.length > 0) {\r\n                        this.queued.data.forEach(function (dataItem) {\r\n                            dataCallback(dataItem);\r\n                        });\r\n                    }\r\n                }.bind(subscription),\r\n                onClosed: function (closedCallback) {\r\n                    if (typeof closedCallback !== \"function\") {\r\n                        throw new TypeError(\"The callback must be a function.\");\r\n                    }\r\n                    this.handlers.onClosed.push(closedCallback);\r\n                }.bind(subscription),\r\n                onFailed: function () { },\r\n                close: function () { return _this.closeSubscription(subscription, subscriptionId); },\r\n                requestArguments: subscription.arguments,\r\n                serverInstance: helpers_1.convertInfoToInstance(msg.Server),\r\n                stream: subscription.method,\r\n            });\r\n        }\r\n    };\r\n    ClientStreaming.prototype.serverHasPushedSomeDataIntoTheStream = function (msg) {\r\n        var _loop_1 = function (key) {\r\n            if (this_1.subscriptionsList.hasOwnProperty(key) && typeof this_1.subscriptionsList[key] === \"object\") {\r\n                var isPrivateData = void 0;\r\n                var trackedServersFound = this_1.subscriptionsList[key].trackedServers.filter(function (ls) {\r\n                    return (ls.streamId === msg.StreamId &&\r\n                        (ls.streamSubjects.global === msg.EventStreamSubject ||\r\n                            ls.streamSubjects.private === msg.EventStreamSubject));\r\n                });\r\n                if (trackedServersFound.length === 0) {\r\n                    isPrivateData = undefined;\r\n                }\r\n                else if (trackedServersFound[0].streamSubjects.global === msg.EventStreamSubject) {\r\n                    isPrivateData = false;\r\n                }\r\n                else if (trackedServersFound[0].streamSubjects.private === msg.EventStreamSubject) {\r\n                    isPrivateData = true;\r\n                }\r\n                if (isPrivateData !== undefined) {\r\n                    var receivedStreamData_1 = {\r\n                        data: msg.ResultContextJson,\r\n                        server: helpers_1.convertInfoToInstance(msg.Server),\r\n                        requestArguments: this_1.subscriptionsList[key].arguments || {},\r\n                        message: msg.ResultMessage,\r\n                        private: isPrivateData,\r\n                    };\r\n                    var onDataHandlers = this_1.subscriptionsList[key].handlers.onData;\r\n                    var queuedData = this_1.subscriptionsList[key].queued.data;\r\n                    if (Array.isArray(onDataHandlers)) {\r\n                        if (onDataHandlers.length > 0) {\r\n                            onDataHandlers.forEach(function (callback) {\r\n                                if (typeof callback === \"function\") {\r\n                                    callback(receivedStreamData_1);\r\n                                }\r\n                            });\r\n                        }\r\n                        else {\r\n                            queuedData.push(receivedStreamData_1);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        var this_1 = this;\r\n        for (var key in this.subscriptionsList) {\r\n            _loop_1(key);\r\n        }\r\n    };\r\n    ClientStreaming.prototype.closeSubscription = function (sub, subId) {\r\n        var _this = this;\r\n        var responseSubject = this.nextResponseSubject();\r\n        sub.trackedServers.forEach(function (server) {\r\n            _this.sendRequest({\r\n                EventStreamAction: 2,\r\n                Client: helpers_1.convertInstance(_this.instance),\r\n                MethodRequestSubject: server.methodRequestSubject,\r\n                MethodResponseSubject: responseSubject,\r\n                StreamId: server.streamId,\r\n                EventStreamSubject: server.streamSubjects.private,\r\n            });\r\n        });\r\n        sub.handlers.onClosed.forEach(function (callback) {\r\n            if (typeof callback === \"function\") {\r\n                callback({\r\n                    message: ON_CLOSE_MSG_CLIENT_INIT,\r\n                    requestArguments: sub.arguments || {},\r\n                    server: sub.trackedServers[sub.trackedServers.length - 1].server,\r\n                    stream: sub.method,\r\n                });\r\n            }\r\n        });\r\n        delete this.subscriptionsList[subId];\r\n    };\r\n    ClientStreaming.prototype.generatePrivateStreamSubject = function (methodName) {\r\n        var appInfo = helpers_1.convertInstance(this.instance);\r\n        return \"ESSpriv-jsb_\" +\r\n            appInfo.ApplicationName +\r\n            \"_on_\" +\r\n            methodName +\r\n            \"_\" +\r\n            random_1.default();\r\n    };\r\n    return ClientStreaming;\r\n}());\r\nexports.default = ClientStreaming;\r\n//# sourceMappingURL=client-streaming.js.map\n\n/***/ }),\n/* 37 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar client_streaming_1 = __webpack_require__(36);\r\nvar helpers_1 = __webpack_require__(5);\r\nvar numberMissingHeartbeatsToRemove = 3;\r\nvar ClientProtocol = (function () {\r\n    function ClientProtocol(connection, instance, configuration, repository) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n        this.repository = repository;\r\n        this.respCounter = 0;\r\n        this.callbacks = callback_registry_1.default();\r\n        this.timers = {};\r\n        this.timers = {};\r\n        this.streaming = new client_streaming_1.default(configuration, instance, function (msg) {\r\n            connection.send(\"agm\", \"MethodInvocationRequestMessage\", msg);\r\n        }, function () { return _this.nextResponseSubject(); });\r\n        this.listenForEvents();\r\n    }\r\n    ClientProtocol.prototype.subscribe = function (stream, args, targetServers, options, success, error) {\r\n        this.streaming.subscribe(stream, args, targetServers, options, success, error);\r\n    };\r\n    ClientProtocol.prototype.onInvocationResult = function (callback) {\r\n        this.callbacks.add(\"onResult\", callback);\r\n    };\r\n    ClientProtocol.prototype.invoke = function (id, method, args, target, stuff) {\r\n        var methodInfo = method.info;\r\n        var message = {\r\n            MethodRequestSubject: methodInfo.requestSubject,\r\n            MethodResponseSubject: this.nextResponseSubject(),\r\n            Client: helpers_1.convertInstance(this.instance),\r\n            Context: {\r\n                ArgumentsJson: args,\r\n                InvocationId: id,\r\n                MethodName: methodInfo.name,\r\n                ExecutionServer: target.info,\r\n                Timeout: stuff.methodResponseTimeoutMs,\r\n            },\r\n        };\r\n        this.connection.send(\"agm\", \"MethodInvocationRequestMessage\", message);\r\n    };\r\n    ClientProtocol.prototype.nextResponseSubject = function () {\r\n        return \"resp_\" + (this.respCounter++) + \"_\" + random_1.default();\r\n    };\r\n    ClientProtocol.prototype.createServerInfo = function (instance) {\r\n        return {\r\n            machine: instance.MachineName,\r\n            pid: instance.ProcessId,\r\n            user: instance.UserName,\r\n            application: instance.ApplicationName,\r\n            environment: instance.Environment,\r\n            region: instance.Region,\r\n        };\r\n    };\r\n    ClientProtocol.prototype.createMethod = function (methodInfo) {\r\n        var method = methodInfo.Method;\r\n        return {\r\n            name: method.Name,\r\n            accepts: method.InputSignature,\r\n            returns: method.ResultSignature,\r\n            requestSubject: methodInfo.MethodRequestSubject,\r\n            description: method.Description,\r\n            displayName: method.DisplayName,\r\n            version: method.Version,\r\n            objectTypes: method.ObjectTypeRestrictions,\r\n            supportsStreaming: helpers_1.isStreamingFlagSet(method.Flags),\r\n        };\r\n    };\r\n    ClientProtocol.prototype.createServerId = function (serverInfo) {\r\n        if (serverInfo === undefined) {\r\n            return undefined;\r\n        }\r\n        return [serverInfo.application,\r\n            serverInfo.user,\r\n            serverInfo.machine,\r\n            serverInfo.started,\r\n            serverInfo.pid].join(\"/\").toLowerCase();\r\n    };\r\n    ClientProtocol.prototype.processServerPresence = function (presence, isPresence) {\r\n        var instance = presence.Instance;\r\n        var serverInfo = this.createServerInfo(instance);\r\n        var serverId = this.createServerId(serverInfo);\r\n        if (isPresence) {\r\n            serverId = this.repository.addServer(serverInfo, serverId);\r\n            if (presence.PublishingInterval) {\r\n                this.scheduleTimeout(serverId, presence.PublishingInterval);\r\n            }\r\n        }\r\n        else if (presence.PublishingInterval === 0) {\r\n            var server = this.repository.getServerById(serverId);\r\n            if (typeof server !== \"undefined\") {\r\n                this.repository.removeServerById(serverId);\r\n            }\r\n        }\r\n        if (presence.MethodDefinitions !== undefined) {\r\n            this.updateServerMethods(serverId, presence.MethodDefinitions);\r\n        }\r\n    };\r\n    ClientProtocol.prototype.scheduleTimeout = function (serverId, duration) {\r\n        var _this = this;\r\n        if (duration === -1) {\r\n            return;\r\n        }\r\n        var timer = this.timers[serverId];\r\n        if (timer !== undefined) {\r\n            clearTimeout(timer);\r\n        }\r\n        this.timers[serverId] = setTimeout(function () {\r\n            _this.repository.removeServerById(serverId);\r\n        }, duration * (numberMissingHeartbeatsToRemove + 1));\r\n    };\r\n    ClientProtocol.prototype.updateServerMethods = function (serverId, newMethods) {\r\n        var _this = this;\r\n        var oldMethods = this.repository.getServerMethodsById(serverId);\r\n        var newMethodsReduced = newMethods\r\n            .map(function (nm) { return _this.createMethod(nm); })\r\n            .reduce(function (obj, method) {\r\n            var methodId = _this.repository.createMethodId(method);\r\n            obj[methodId] = method;\r\n            return obj;\r\n        }, {});\r\n        oldMethods.forEach(function (method) {\r\n            if (newMethodsReduced[method.id] === undefined) {\r\n                _this.repository.removeServerMethod(serverId, method.id);\r\n            }\r\n            else {\r\n                delete newMethodsReduced[method.id];\r\n            }\r\n        });\r\n        Object.keys(newMethodsReduced).forEach(function (key) {\r\n            var method = newMethodsReduced[key];\r\n            _this.repository.addServerMethod(serverId, method);\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleInvokeResultMessage = function (message) {\r\n        if (message && message.EventStreamAction && message.EventStreamAction !== 0) {\r\n            this.streaming.processPublisherMsg(message);\r\n            return;\r\n        }\r\n        var server = message.Server ? this.createServerInfo(message.Server) : undefined;\r\n        var result = message.ResultContextJson;\r\n        if (result && Object.keys(result).length === 0) {\r\n            result = undefined;\r\n        }\r\n        this.callbacks.execute(\"onResult\", message.InvocationId, server, message.Status, result, message.ResultMessage);\r\n    };\r\n    ClientProtocol.prototype.listenForEvents = function () {\r\n        var _this = this;\r\n        this.connection.on(\"agm\", \"ServerPresenceMessage\", function (msg) {\r\n            _this.processServerPresence(msg, true);\r\n        });\r\n        this.connection.on(\"agm\", \"ServerHeartbeatMessage\", function (msg) {\r\n            _this.processServerPresence(msg, false);\r\n        });\r\n        this.connection.on(\"agm\", \"MethodInvocationResultMessage\", function (msg) {\r\n            _this.handleInvokeResultMessage(msg);\r\n        });\r\n    };\r\n    return ClientProtocol;\r\n}());\r\nexports.default = ClientProtocol;\r\n//# sourceMappingURL=client.js.map\n\n/***/ }),\n/* 38 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar server_1 = __webpack_require__(40);\r\nvar client_1 = __webpack_require__(37);\r\nfunction default_1(instance, connection, clientRepository, serverRepository, configuration, getAGM) {\r\n    var unsubscribe = connection.on(\"agm\", \"Instance\", function (newInstance) {\r\n        getAGM().updateInstance(newInstance);\r\n        connection.off(unsubscribe);\r\n    });\r\n    var server = new server_1.default(connection, instance, configuration, serverRepository);\r\n    var client = new client_1.default(connection, instance, configuration, clientRepository);\r\n    return new Promise(function (resolve) {\r\n        resolve({\r\n            server: server,\r\n            client: client,\r\n        });\r\n    });\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=factory.js.map\n\n/***/ }),\n/* 39 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nvar helpers_1 = __webpack_require__(5);\r\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(connection, instance) {\r\n        this.connection = connection;\r\n        this.instance = instance;\r\n    }\r\n    ServerStreaming.prototype.isStreamMsg = function (msg, method) {\r\n        return (msg &&\r\n            msg.EventStreamAction &&\r\n            msg.EventStreamAction !== 0 &&\r\n            typeof method === \"object\" &&\r\n            method.definition.supportsStreaming === true);\r\n    };\r\n    ServerStreaming.prototype.pushData = function (streamingMethod, data, branches) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        if (typeof branches === \"string\") {\r\n            branches = [branches];\r\n        }\r\n        else if (!Array.isArray(branches) || branches.length <= 0) {\r\n            branches = null;\r\n        }\r\n        var streamIdList = streamingMethod.protocolState.branchKeyToStreamIdMap\r\n            .filter(function (br) {\r\n            return (branches === null || (Boolean(br) && typeof br.key === \"string\" && branches.indexOf(br.key) >= 0));\r\n        }).map(function (br) {\r\n            return br.streamId;\r\n        });\r\n        var server = helpers_1.convertInstance(this.instance);\r\n        streamIdList.forEach(function (streamId) {\r\n            _this.sendResult({\r\n                EventStreamAction: 5,\r\n                EventStreamSubject: streamingMethod.protocolState.globalEventStreamSubject,\r\n                MethodName: streamingMethod.protocolState.method.Method.Name,\r\n                MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n                ResultContextJson: data,\r\n                Server: server,\r\n                StreamId: streamId,\r\n            });\r\n        });\r\n    };\r\n    ServerStreaming.prototype.closeAllSubscriptions = function (streamingMethod, branchKey) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        var streamList = streamingMethod.protocolState.branchKeyToStreamIdMap;\r\n        if (typeof branchKey === \"string\") {\r\n            streamList = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (br) {\r\n                return (typeof br === \"object\" && br.key === branchKey);\r\n            });\r\n        }\r\n        streamList.forEach(function (br) {\r\n            var streamId = br.streamId;\r\n            _this.sendResult({\r\n                EventStreamAction: 2,\r\n                EventStreamSubject: streamingMethod.protocolState.globalEventStreamSubject,\r\n                MethodName: streamingMethod.protocolState.method.Method.Name,\r\n                MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n                Server: helpers_1.convertInstance(_this.instance),\r\n                StreamId: streamId,\r\n                Status: 0,\r\n            });\r\n        });\r\n    };\r\n    ServerStreaming.prototype.getBranchList = function (streamingMethod) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        return this.getUniqueBranchNames(streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.getSubscriptionList = function (streamingMethod, branchKey) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var subscriptions = [];\r\n        if (typeof branchKey !== \"string\") {\r\n            subscriptions = streamingMethod.protocolState.subscriptions;\r\n        }\r\n        else {\r\n            subscriptions = streamingMethod.protocolState.subscriptions.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        return subscriptions;\r\n    };\r\n    ServerStreaming.prototype.onSubAdded = function (handlerFunc) {\r\n        if (typeof handlerFunc !== \"function\") {\r\n            return;\r\n        }\r\n        this.subAddedHandler = handlerFunc;\r\n    };\r\n    ServerStreaming.prototype.onSubRemoved = function (handlerFunc) {\r\n        if (typeof handlerFunc !== \"function\") {\r\n            return;\r\n        }\r\n        this.subRemovedHandler = handlerFunc;\r\n    };\r\n    ServerStreaming.prototype.onSubRequest = function (handlerFunc) {\r\n        if (typeof handlerFunc !== \"function\") {\r\n            return;\r\n        }\r\n        this.requestHandler = handlerFunc;\r\n    };\r\n    ServerStreaming.prototype.generateNewStreamId = function (streamingMethodName) {\r\n        var appInfo = helpers_1.convertInstance(this.instance);\r\n        return \"streamId-jsb_of_\" +\r\n            streamingMethodName +\r\n            \"__by_\" +\r\n            appInfo.ApplicationName +\r\n            \"_\" +\r\n            random_1.default();\r\n    };\r\n    ServerStreaming.prototype.rejectRequest = function (requestContext, streamingMethod, reason) {\r\n        if (typeof reason !== \"string\") {\r\n            reason = \"\";\r\n        }\r\n        var msg = requestContext.msg;\r\n        this.sendResult({\r\n            EventStreamAction: 2,\r\n            EventStreamSubject: streamingMethod.protocolState.globalEventStreamSubject,\r\n            MethodName: streamingMethod.protocolState.method.Method.Name,\r\n            MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n            MethodResponseSubject: msg.MethodResponseSubject,\r\n            MethodVersion: streamingMethod.protocolState.method.Method.Version,\r\n            ResultMessage: reason,\r\n            Server: helpers_1.convertInstance(this.instance),\r\n            StreamId: \"default_rejection_streamId\",\r\n        });\r\n    };\r\n    ServerStreaming.prototype.pushDataToSingle = function (streamingMethod, subscription, data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        this.sendResult({\r\n            EventStreamAction: 5,\r\n            EventStreamSubject: subscription.privateEventStreamSubject,\r\n            MethodName: streamingMethod.protocolState.method.Method.Name,\r\n            MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n            ResultContextJson: data,\r\n            Server: helpers_1.convertInstance(this.instance),\r\n            StreamId: subscription.streamId,\r\n        });\r\n    };\r\n    ServerStreaming.prototype.closeSingleSubscription = function (streamingMethod, subscription) {\r\n        this.closeIndividualSubscription(streamingMethod, subscription.streamId, subscription.privateEventStreamSubject, true);\r\n    };\r\n    ServerStreaming.prototype.acceptRequestOnBranch = function (requestContext, streamingMethod, branch) {\r\n        if (typeof branch !== \"string\") {\r\n            branch = \"\";\r\n        }\r\n        var streamId = this.getStreamId(streamingMethod, branch);\r\n        var msg = requestContext.msg;\r\n        this.sendResult({\r\n            EventStreamAction: 3,\r\n            EventStreamSubject: streamingMethod.protocolState.globalEventStreamSubject,\r\n            InvocationId: msg.Context.InvocationId,\r\n            MethodName: streamingMethod.protocolState.method.Method.Name,\r\n            MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n            MethodResponseSubject: msg.MethodResponseSubject,\r\n            MethodVersion: streamingMethod.protocolState.method.Method.Version,\r\n            ResultMessage: \"Accepted\",\r\n            Server: helpers_1.convertInstance(this.instance),\r\n            StreamId: streamId,\r\n        });\r\n    };\r\n    ServerStreaming.prototype.processSubscriberMsg = function (msg, streamingMethod) {\r\n        if (!(msg && msg.EventStreamAction && msg.EventStreamAction !== 0)) {\r\n            return;\r\n        }\r\n        if (msg.EventStreamAction === 1) {\r\n            this.clientWishesToSubscribe(msg, streamingMethod);\r\n        }\r\n        else if (msg.EventStreamAction === 2) {\r\n            this.clientWishesToUnsubscribe(msg, streamingMethod);\r\n        }\r\n        else if (msg.EventStreamAction === 3) {\r\n            this.clientAcknowledgesItDidSubscribe(msg, streamingMethod);\r\n        }\r\n        else if (msg.EventStreamAction === 4) {\r\n            this.clientPerSubHeartbeat(msg);\r\n        }\r\n    };\r\n    ServerStreaming.prototype.sendResult = function (message) {\r\n        if (typeof message !== \"object\") {\r\n            throw new Error(\"Invalid message.\");\r\n        }\r\n        if (typeof message.Status !== \"number\") {\r\n            message.Status = 0;\r\n        }\r\n        this.connection.send(\"agm\", \"MethodInvocationResultMessage\", message);\r\n    };\r\n    ServerStreaming.prototype.clientWishesToSubscribe = function (msg, streamingMethod) {\r\n        var requestContext = {\r\n            msg: msg,\r\n            arguments: msg.Context.ArgumentsJson || {},\r\n            instance: helpers_1.convertInfoToInstance(msg.Client),\r\n        };\r\n        if (typeof this.requestHandler === \"function\") {\r\n            this.requestHandler(requestContext, streamingMethod);\r\n        }\r\n    };\r\n    ServerStreaming.prototype.clientWishesToUnsubscribe = function (msg, streamingMethod) {\r\n        if (!(streamingMethod &&\r\n            Array.isArray(streamingMethod.protocolState.subscriptions) &&\r\n            streamingMethod.protocolState.subscriptions.length > 0)) {\r\n            return;\r\n        }\r\n        this.closeIndividualSubscription(streamingMethod, msg.StreamId, msg.EventStreamSubject, false);\r\n    };\r\n    ServerStreaming.prototype.clientAcknowledgesItDidSubscribe = function (msg, streamingMethod) {\r\n        if (typeof msg.StreamId !== \"string\" || msg.StreamId === \"\") {\r\n            return;\r\n        }\r\n        var branchKey = this.getBranchKey(streamingMethod, msg.StreamId);\r\n        if (typeof branchKey !== \"string\") {\r\n            return;\r\n        }\r\n        if (!Array.isArray(streamingMethod.protocolState.subscriptions)) {\r\n            return;\r\n        }\r\n        var subscription = {\r\n            branchKey: branchKey,\r\n            instance: helpers_1.convertInfoToInstance(msg.Client),\r\n            arguments: msg.Context.ArgumentsJson,\r\n            streamId: msg.StreamId,\r\n            privateEventStreamSubject: msg.EventStreamSubject,\r\n            methodResponseSubject: msg.MethodResponseSubject,\r\n        };\r\n        streamingMethod.protocolState.subscriptions.push(subscription);\r\n        if (typeof this.subAddedHandler === \"function\") {\r\n            this.subAddedHandler(subscription, streamingMethod);\r\n        }\r\n    };\r\n    ServerStreaming.prototype.clientPerSubHeartbeat = function (msg) {\r\n    };\r\n    ServerStreaming.prototype.getBranchKey = function (streamingMethod, streamId) {\r\n        if (typeof streamId !== \"string\" || typeof streamingMethod !== \"object\") {\r\n            return;\r\n        }\r\n        var needle = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.streamId === streamId;\r\n        })[0];\r\n        if (typeof needle !== \"object\" || typeof needle.key !== \"string\") {\r\n            return;\r\n        }\r\n        return needle.key;\r\n    };\r\n    ServerStreaming.prototype.getStreamId = function (streamingMethod, branchKey) {\r\n        if (typeof branchKey !== \"string\") {\r\n            branchKey = \"\";\r\n        }\r\n        var needleBranch = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.key === branchKey;\r\n        })[0];\r\n        var streamId = (needleBranch ? needleBranch.streamId : undefined);\r\n        if (typeof streamId !== \"string\" || streamId === \"\") {\r\n            streamId = this.generateNewStreamId(streamingMethod.protocolState.method.Method.Name);\r\n            streamingMethod.protocolState.branchKeyToStreamIdMap.push({ key: branchKey, streamId: streamId });\r\n        }\r\n        return streamId;\r\n    };\r\n    ServerStreaming.prototype.closeIndividualSubscription = function (streamingMethod, streamId, privateEventStreamSubject, sendKickMessage) {\r\n        var subscription = streamingMethod.protocolState.subscriptions.filter(function (subItem) {\r\n            return (subItem.privateEventStreamSubject === privateEventStreamSubject &&\r\n                subItem.streamId === streamId);\r\n        })[0];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        var initialLength = streamingMethod.protocolState.subscriptions.length;\r\n        streamingMethod.protocolState.subscriptions = streamingMethod.protocolState.subscriptions.filter(function (subItem) {\r\n            return !(subItem.privateEventStreamSubject === subscription.privateEventStreamSubject &&\r\n                subItem.streamId === subscription.streamId);\r\n        });\r\n        var filteredLength = streamingMethod.protocolState.subscriptions.length;\r\n        if (filteredLength !== (initialLength - 1)) {\r\n            return;\r\n        }\r\n        if (sendKickMessage === true) {\r\n            this.sendResult({\r\n                EventStreamAction: 2,\r\n                EventStreamSubject: privateEventStreamSubject,\r\n                MethodName: streamingMethod.protocolState.method.Method.Name,\r\n                MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n                MethodResponseSubject: subscription.methodResponseSubject,\r\n                MethodVersion: streamingMethod.protocolState.method.Method.Version,\r\n                ResponseContextJson: {},\r\n                Server: helpers_1.convertInstance(this.instance),\r\n                StreamId: subscription.streamId,\r\n                Status: 0,\r\n            });\r\n        }\r\n        if (typeof this.subRemovedHandler === \"function\") {\r\n            this.subRemovedHandler(subscription, streamingMethod);\r\n        }\r\n    };\r\n    ServerStreaming.prototype.getUniqueBranchNames = function (streamingMethod) {\r\n        var keysWithDuplicates = streamingMethod.protocolState.subscriptions.map(function (sub) {\r\n            var result = null;\r\n            if (typeof sub === \"object\" && typeof sub.branchKey === \"string\") {\r\n                result = sub.branchKey;\r\n            }\r\n            return result;\r\n        });\r\n        var seen = [];\r\n        var branchArray = keysWithDuplicates.filter(function (bKey) {\r\n            if (bKey === null || seen.indexOf(bKey) >= 0) {\r\n                return false;\r\n            }\r\n            seen.push(bKey);\r\n            return true;\r\n        });\r\n        return branchArray;\r\n    };\r\n    return ServerStreaming;\r\n}());\r\nexports.default = ServerStreaming;\r\n//# sourceMappingURL=server-streaming.js.map\n\n/***/ }),\n/* 40 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nvar server_streaming_1 = __webpack_require__(39);\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar helpers_1 = __webpack_require__(5);\r\nvar HeartbeatInterval = 5000;\r\nvar PresenceInterval = 10000;\r\nvar ServerProtocol = (function () {\r\n    function ServerProtocol(connection, instance, configuration, serverRepository) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        this.instance = instance;\r\n        this.serverRepository = serverRepository;\r\n        this.invocationMessagesMap = {};\r\n        this.reqCounter = 0;\r\n        this.callbacks = callback_registry_1.default();\r\n        this.streaming = new server_streaming_1.default(connection, instance);\r\n        connection.on(\"agm\", \"MethodInvocationRequestMessage\", function (msg) { return _this.handleMethodInvocationMessage(msg); });\r\n        connection.disconnected(this.stopTimers.bind(this));\r\n        this.sendHeartbeat();\r\n        if (this.heartbeatTimer === undefined) {\r\n            this.heartbeatTimer = setInterval(function () { return _this.sendHeartbeat(); }, HeartbeatInterval);\r\n        }\r\n        this.getBranchList = this.streaming.getBranchList;\r\n        this.getSubscriptionList = this.streaming.getSubscriptionList;\r\n        this.closeAllSubscriptions = this.streaming.closeAllSubscriptions;\r\n        this.closeSingleSubscription = this.streaming.closeSingleSubscription;\r\n        this.pushDataToSingle = this.streaming.pushDataToSingle;\r\n        this.pushData = this.streaming.pushData;\r\n        this.onSubRequest = this.streaming.onSubRequest;\r\n        this.acceptRequestOnBranch = this.streaming.acceptRequestOnBranch;\r\n        this.rejectRequest = this.streaming.rejectRequest;\r\n        this.onSubAdded = this.streaming.onSubAdded;\r\n        this.onSubRemoved = this.streaming.onSubRemoved;\r\n    }\r\n    ServerProtocol.prototype.stopTimers = function () {\r\n        clearInterval(this.presenceTimer);\r\n        clearInterval(this.heartbeatTimer);\r\n    };\r\n    ServerProtocol.prototype.unregister = function (info) {\r\n        this.sendPresence();\r\n        return Promise.resolve();\r\n    };\r\n    ServerProtocol.prototype.register = function (repoMethod, success, error) {\r\n        var reqSubj = this.nextRequestSubject();\r\n        repoMethod.protocolState.method = this.createNewMethodMessage(repoMethod.definition, reqSubj, false);\r\n        this.announceNewMethod();\r\n        success();\r\n        return Promise.resolve();\r\n    };\r\n    ServerProtocol.prototype.createStream = function (repoMethod, success, error) {\r\n        var reqSubj = this.nextRequestSubject();\r\n        var streamConverted = this.createNewMethodMessage(repoMethod.definition, reqSubj, true);\r\n        repoMethod.protocolState.method = streamConverted;\r\n        repoMethod.protocolState.globalEventStreamSubject = repoMethod.definition.name + \".jsStream.\" + random_1.default();\r\n        repoMethod.protocolState.subscriptions = [];\r\n        repoMethod.protocolState.branchKeyToStreamIdMap = [];\r\n        this.announceNewMethod();\r\n        success();\r\n    };\r\n    ServerProtocol.prototype.onInvoked = function (callback) {\r\n        this.callbacks.add(\"onInvoked\", callback);\r\n    };\r\n    ServerProtocol.prototype.methodInvocationResult = function (executedMethod, invocationId, err, result) {\r\n        var message = this.invocationMessagesMap[invocationId];\r\n        if (!message) {\r\n            return;\r\n        }\r\n        if (message.MethodResponseSubject === \"null\") {\r\n            return;\r\n        }\r\n        if (executedMethod === undefined) {\r\n            return;\r\n        }\r\n        var resultMessage = {\r\n            MethodRequestSubject: message.MethodRequestSubject,\r\n            MethodResponseSubject: message.MethodResponseSubject,\r\n            MethodName: executedMethod.protocolState.method.Method.Name,\r\n            InvocationId: invocationId,\r\n            ResultContextJson: result,\r\n            Server: helpers_1.convertInstance(this.instance),\r\n            ResultMessage: err,\r\n            Status: err ? 1 : 0,\r\n        };\r\n        this.connection.send(\"agm\", \"MethodInvocationResultMessage\", resultMessage);\r\n        delete this.invocationMessagesMap[invocationId];\r\n    };\r\n    ServerProtocol.prototype.nextRequestSubject = function () {\r\n        return \"req_\" + (this.reqCounter++) + \"_\" + random_1.default();\r\n    };\r\n    ServerProtocol.prototype.sendHeartbeat = function () {\r\n        this.connection.send(\"agm\", \"ServerHeartbeatMessage\", this.constructHeartbeat());\r\n    };\r\n    ServerProtocol.prototype.constructHeartbeat = function () {\r\n        return {\r\n            PublishingInterval: HeartbeatInterval,\r\n            Instance: helpers_1.convertInstance(this.instance),\r\n        };\r\n    };\r\n    ServerProtocol.prototype.constructPresence = function () {\r\n        var methods = this.serverRepository.getList();\r\n        return {\r\n            PublishingInterval: PresenceInterval,\r\n            Instance: helpers_1.convertInstance(this.instance),\r\n            MethodDefinitions: methods.map(function (m) { return m.protocolState.method; }),\r\n        };\r\n    };\r\n    ServerProtocol.prototype.sendPresence = function () {\r\n        this.connection.send(\"agm\", \"ServerPresenceMessage\", this.constructPresence());\r\n    };\r\n    ServerProtocol.prototype.announceNewMethod = function () {\r\n        var _this = this;\r\n        this.sendPresence();\r\n        if (this.presenceTimer === undefined) {\r\n            this.presenceTimer = setInterval(function () { return _this.sendPresence(); }, PresenceInterval);\r\n        }\r\n    };\r\n    ServerProtocol.prototype.handleMethodInvocationMessage = function (message) {\r\n        var subject = message.MethodRequestSubject;\r\n        var methodList = this.serverRepository.getList();\r\n        var method = methodList.filter(function (m) {\r\n            return m.protocolState.method.MethodRequestSubject === subject;\r\n        })[0];\r\n        if (method === undefined) {\r\n            return;\r\n        }\r\n        if (this.streaming.isStreamMsg(message, method)) {\r\n            this.streaming.processSubscriberMsg(message, method);\r\n            return;\r\n        }\r\n        var invocationId = message.Context.InvocationId;\r\n        this.invocationMessagesMap[invocationId] = message;\r\n        var invocationArgs = {\r\n            args: message.Context.ArgumentsJson,\r\n            instance: helpers_1.convertInfoToInstance(message.Client),\r\n        };\r\n        this.callbacks.execute(\"onInvoked\", method, invocationId, invocationArgs);\r\n    };\r\n    ServerProtocol.prototype.createNewMethodMessage = function (methodIdentifier, subject, stream) {\r\n        if (typeof methodIdentifier === \"string\") {\r\n            methodIdentifier = { name: methodIdentifier };\r\n        }\r\n        if (typeof methodIdentifier.version !== \"number\") {\r\n            methodIdentifier.version = 0;\r\n        }\r\n        return {\r\n            Method: {\r\n                Name: methodIdentifier.name,\r\n                InputSignature: methodIdentifier.accepts,\r\n                ResultSignature: methodIdentifier.returns,\r\n                Description: methodIdentifier.description,\r\n                DisplayName: methodIdentifier.displayName,\r\n                Version: methodIdentifier.version,\r\n                ObjectTypeRestrictions: methodIdentifier.objectTypes,\r\n                Flags: stream ? 32 : undefined,\r\n            },\r\n            MethodRequestSubject: subject,\r\n        };\r\n    };\r\n    return ServerProtocol;\r\n}());\r\nexports.default = ServerProtocol;\r\n//# sourceMappingURL=server.js.map\n\n/***/ }),\n/* 41 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar STATUS_AWAITING_ACCEPT = \"awaitingAccept\";\r\nvar STATUS_SUBSCRIBED = \"subscribed\";\r\nvar ERR_MSG_SUB_FAILED = \"Subscription failed.\";\r\nvar ERR_MSG_SUB_REJECTED = \"Subscription rejected.\";\r\nvar ON_CLOSE_MSG_SERVER_INIT = \"ServerInitiated\";\r\nvar ON_CLOSE_MSG_CLIENT_INIT = \"ClientInitiated\";\r\nvar ClientStreaming = (function () {\r\n    function ClientStreaming(instance, session, repository, logger) {\r\n        var _this = this;\r\n        this.instance = instance;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        this.nextSubLocalKey = 0;\r\n        this.handleErrorSubscribing = function (errorResponse) {\r\n            var tag = errorResponse._tag;\r\n            var subLocalKey = tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                return server.serverId !== tag.serverId;\r\n            });\r\n            if (pendingSub.trackedServers.length <= 0) {\r\n                clearTimeout(pendingSub.timeoutId);\r\n                if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                    var reason = (typeof errorResponse.reason === \"string\" && errorResponse.reason !== \"\") ?\r\n                        ' Publisher said \"' + errorResponse.reason + '\".' :\r\n                        \" No reason given.\";\r\n                    var callArgs = typeof pendingSub.arguments === \"object\" ?\r\n                        JSON.stringify(pendingSub.arguments) :\r\n                        \"{}\";\r\n                    pendingSub.error({\r\n                        message: ERR_MSG_SUB_REJECTED + reason + \" Called with:\" + callArgs,\r\n                        called_with: pendingSub.arguments,\r\n                        method: pendingSub.method.getInfoForUser(),\r\n                    });\r\n                }\r\n                else if (pendingSub.status === STATUS_SUBSCRIBED) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                }\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n        };\r\n        this.handleSubscribed = function (msg) {\r\n            var subLocalKey = msg._tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            var serverId = msg._tag.serverId;\r\n            var acceptingServer = pendingSub.trackedServers\r\n                .filter(function (server) {\r\n                return server.serverId === serverId;\r\n            })[0];\r\n            if (typeof acceptingServer !== \"object\") {\r\n                return;\r\n            }\r\n            acceptingServer.subscriptionId = msg.subscription_id;\r\n            _this.subscriptionIdToLocalKeyMap[msg.subscription_id] = subLocalKey;\r\n            var isFirstResponse = (pendingSub.status === STATUS_AWAITING_ACCEPT);\r\n            pendingSub.status = STATUS_SUBSCRIBED;\r\n            var that = _this;\r\n            if (isFirstResponse) {\r\n                pendingSub.success({\r\n                    onData: function (dataCallback) {\r\n                        if (typeof dataCallback !== \"function\") {\r\n                            throw new TypeError(\"The data callback must be a function.\");\r\n                        }\r\n                        pendingSub.handlers.onData.push(dataCallback);\r\n                        if (pendingSub.handlers.onData.length === 1 && pendingSub.queued.data.length > 0) {\r\n                            pendingSub.queued.data.forEach(function (dataItem) {\r\n                                dataCallback(dataItem);\r\n                            });\r\n                        }\r\n                    },\r\n                    onClosed: function (closedCallback) {\r\n                        if (typeof closedCallback !== \"function\") {\r\n                            throw new TypeError(\"The callback must be a function.\");\r\n                        }\r\n                        pendingSub.handlers.onClosed.push(closedCallback);\r\n                    },\r\n                    onFailed: function () {\r\n                    },\r\n                    close: function () { return that.closeSubscription(subLocalKey); },\r\n                    requestArguments: pendingSub.arguments,\r\n                    serverInstance: that.repository.getServerById(serverId).getInfoForUser(),\r\n                    stream: pendingSub.method.info,\r\n                });\r\n            }\r\n        };\r\n        this.handleEventData = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var trackedServersFound = subscription.trackedServers.filter(function (server) {\r\n                return server.subscriptionId === msg.subscription_id;\r\n            });\r\n            if (trackedServersFound.length !== 1) {\r\n                return;\r\n            }\r\n            var isPrivateData = msg.oob && msg.snapshot;\r\n            var sendingServerId = trackedServersFound[0].serverId;\r\n            var receivedStreamData = function () {\r\n                return {\r\n                    data: msg.data,\r\n                    server: _this.repository.getServerById(sendingServerId).getInfoForUser(),\r\n                    requestArguments: subscription.arguments || {},\r\n                    message: null,\r\n                    private: isPrivateData,\r\n                };\r\n            };\r\n            var onDataHandlers = subscription.handlers.onData;\r\n            var queuedData = subscription.queued.data;\r\n            if (onDataHandlers.length > 0) {\r\n                onDataHandlers.forEach(function (callback) {\r\n                    if (typeof callback === \"function\") {\r\n                        callback(receivedStreamData());\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                queuedData.push(receivedStreamData());\r\n            }\r\n        };\r\n        this.handleSubscriptionCancelled = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var expectedNewLength = subscription.trackedServers.length - 1;\r\n            subscription.trackedServers = subscription.trackedServers.filter(function (server) {\r\n                if (server.subscriptionId === msg.subscription_id) {\r\n                    subscription.queued.closers.push(server.serverId);\r\n                    return false;\r\n                }\r\n                else {\r\n                    return true;\r\n                }\r\n            });\r\n            if (subscription.trackedServers.length !== expectedNewLength) {\r\n                return;\r\n            }\r\n            if (subscription.trackedServers.length <= 0) {\r\n                clearTimeout(subscription.timeoutId);\r\n                _this.callOnClosedHandlers(subscription);\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            delete _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n        };\r\n        session.on(\"subscribed\", this.handleSubscribed);\r\n        session.on(\"event\", this.handleEventData);\r\n        session.on(\"subscription-cancelled\", this.handleSubscriptionCancelled);\r\n    }\r\n    ClientStreaming.prototype.subscribe = function (streamingMethod, argumentObj, targetServers, stuff, success, error) {\r\n        var _this = this;\r\n        if (targetServers.length === 0) {\r\n            error({\r\n                method: streamingMethod.getInfoForUser(),\r\n                called_with: argumentObj,\r\n                message: ERR_MSG_SUB_FAILED + \" No available servers matched the target params.\",\r\n            });\r\n            return;\r\n        }\r\n        var subLocalKey = this.getNextSubscriptionLocalKey();\r\n        var pendingSub = this.registerSubscription(subLocalKey, streamingMethod, argumentObj, success, error, stuff.methodResponseTimeout);\r\n        if (typeof pendingSub !== \"object\") {\r\n            error({\r\n                method: streamingMethod.getInfoForUser(),\r\n                called_with: argumentObj,\r\n                message: ERR_MSG_SUB_FAILED + \" Unable to register the user callbacks.\",\r\n            });\r\n            return;\r\n        }\r\n        targetServers.forEach(function (target) {\r\n            var serverId = target.server.id;\r\n            pendingSub.trackedServers.push({\r\n                serverId: serverId,\r\n                subscriptionId: undefined,\r\n            });\r\n            var msg = {\r\n                type: \"subscribe\",\r\n                server_id: serverId,\r\n                method_id: streamingMethod.protocolState.id,\r\n                arguments_kv: argumentObj,\r\n            };\r\n            _this.session.send(msg, { serverId: serverId, subLocalKey: subLocalKey })\r\n                .then(function (m) { return _this.handleSubscribed(m); })\r\n                .catch(function (err) { return _this.handleErrorSubscribing(err); });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.getNextSubscriptionLocalKey = function () {\r\n        var current = this.nextSubLocalKey;\r\n        this.nextSubLocalKey += 1;\r\n        return current;\r\n    };\r\n    ClientStreaming.prototype.registerSubscription = function (subLocalKey, method, args, success, error, timeout) {\r\n        var _this = this;\r\n        this.subscriptionsList[subLocalKey] = {\r\n            status: STATUS_AWAITING_ACCEPT,\r\n            method: method,\r\n            arguments: args,\r\n            success: success,\r\n            error: error,\r\n            trackedServers: [],\r\n            handlers: {\r\n                onData: [],\r\n                onClosed: [],\r\n            },\r\n            queued: {\r\n                data: [],\r\n                closers: [],\r\n            },\r\n            timeoutId: undefined,\r\n        };\r\n        this.subscriptionsList[subLocalKey].timeoutId = setTimeout(function () {\r\n            if (_this.subscriptionsList[subLocalKey] === undefined) {\r\n                return;\r\n            }\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                error({\r\n                    method: method.getInfoForUser(),\r\n                    called_with: args,\r\n                    message: ERR_MSG_SUB_FAILED + \" Subscription attempt timed out after \" + timeout + \" ms.\",\r\n                });\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            else if (pendingSub.status === STATUS_SUBSCRIBED && pendingSub.trackedServers.length > 0) {\r\n                pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                    return (typeof server.subscriptionId !== \"undefined\");\r\n                });\r\n                delete pendingSub.timeoutId;\r\n                if (pendingSub.trackedServers.length <= 0) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                    delete _this.subscriptionsList[subLocalKey];\r\n                }\r\n            }\r\n        }, timeout);\r\n        return this.subscriptionsList[subLocalKey];\r\n    };\r\n    ClientStreaming.prototype.callOnClosedHandlers = function (subscription, reason) {\r\n        var closersCount = subscription.queued.closers.length;\r\n        var closingServerId = (closersCount > 0) ? subscription.queued.closers[closersCount - 1] : null;\r\n        var closingServer = null;\r\n        if (typeof closingServerId === \"number\") {\r\n            closingServer = this.repository.getServerById(closingServerId).getInfoForUser();\r\n        }\r\n        subscription.handlers.onClosed.forEach(function (callback) {\r\n            if (typeof callback !== \"function\") {\r\n                return;\r\n            }\r\n            callback({\r\n                message: reason || ON_CLOSE_MSG_SERVER_INIT,\r\n                requestArguments: subscription.arguments,\r\n                server: closingServer,\r\n                stream: subscription.method,\r\n            });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.closeSubscription = function (subLocalKey) {\r\n        var _this = this;\r\n        var subscription = this.subscriptionsList[subLocalKey];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        subscription.trackedServers.forEach(function (server) {\r\n            if (typeof server.subscriptionId === \"undefined\") {\r\n                return;\r\n            }\r\n            _this.session.sendFireAndForget({\r\n                type: \"unsubscribe\",\r\n                subscription_id: server.subscriptionId,\r\n                reason_uri: \"\",\r\n                reason: ON_CLOSE_MSG_CLIENT_INIT,\r\n            });\r\n            delete _this.subscriptionIdToLocalKeyMap[server.subscriptionId];\r\n        });\r\n        subscription.trackedServers = [];\r\n        this.callOnClosedHandlers(subscription, ON_CLOSE_MSG_CLIENT_INIT);\r\n        delete this.subscriptionsList[subLocalKey];\r\n    };\r\n    return ClientStreaming;\r\n}());\r\nexports.default = ClientStreaming;\r\n//# sourceMappingURL=client-streaming.js.map\n\n/***/ }),\n/* 42 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar client_streaming_1 = __webpack_require__(41);\r\nvar ClientProtocol = (function () {\r\n    function ClientProtocol(instance, session, repository, logger) {\r\n        var _this = this;\r\n        this.instance = instance;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        this.callbacks = callback_registry_1.default();\r\n        session.on(\"peer-added\", function (msg) { return _this.handlePeerAdded(msg); });\r\n        session.on(\"peer-removed\", function (msg) { return _this.handlePeerRemoved(msg); });\r\n        session.on(\"methods-added\", function (msg) { return _this.handleMethodsAddedMessage(msg); });\r\n        session.on(\"methods-removed\", function (msg) { return _this.handleMethodsRemovedMessage(msg); });\r\n        this.streaming = new client_streaming_1.default(instance, session, repository, logger);\r\n    }\r\n    ClientProtocol.prototype.subscribe = function (stream, args, targetServers, options, success, error) {\r\n        this.streaming.subscribe(stream, args, targetServers, options, success, error);\r\n    };\r\n    ClientProtocol.prototype.invoke = function (id, method, args, target) {\r\n        var _this = this;\r\n        var serverId = target.id;\r\n        var methodId = method.protocolState.id;\r\n        var msg = {\r\n            type: \"call\",\r\n            server_id: serverId,\r\n            method_id: methodId,\r\n            arguments_kv: args,\r\n        };\r\n        this.session.send(msg, { invocationId: id, serverId: serverId })\r\n            .then(function (m) { return _this.handleResultMessage(m); })\r\n            .catch(function (err) { return _this.handleInvocationError(err); });\r\n    };\r\n    ClientProtocol.prototype.onInvocationResult = function (callback) {\r\n        this.callbacks.add(\"onResult\", callback);\r\n    };\r\n    ClientProtocol.prototype.handlePeerAdded = function (msg) {\r\n        var newPeerId = msg.new_peer_id;\r\n        var remoteId = msg.identity;\r\n        var pid = Number(remoteId.process);\r\n        var serverInfo = {\r\n            machine: remoteId.machine,\r\n            pid: isNaN(pid) ? remoteId.process : pid,\r\n            instance: remoteId.instance,\r\n            application: remoteId.application,\r\n            environment: remoteId.environment,\r\n            region: remoteId.region,\r\n            user: remoteId.user,\r\n            windowId: remoteId.windowId,\r\n            peerId: newPeerId,\r\n        };\r\n        this.repository.addServer(serverInfo, newPeerId);\r\n    };\r\n    ClientProtocol.prototype.handlePeerRemoved = function (msg) {\r\n        var removedPeerId = msg.removed_id;\r\n        var reason = msg.reason;\r\n        this.repository.removeServerById(removedPeerId, reason);\r\n    };\r\n    ClientProtocol.prototype.handleMethodsAddedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methods = msg.methods;\r\n        methods.forEach(function (method) {\r\n            var methodInfo = {\r\n                name: method.name,\r\n                displayName: method.display_name,\r\n                description: method.description,\r\n                version: method.version,\r\n                objectTypes: method.object_types || [],\r\n                accepts: method.input_signature,\r\n                returns: method.result_signature,\r\n                supportsStreaming: typeof method.flags !== \"undefined\" ? method.flags.streaming : false,\r\n            };\r\n            _this.repository.addServerMethod(serverId, methodInfo, { id: method.id });\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleMethodsRemovedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methodIdList = msg.methods;\r\n        var server = this.repository.getServerById(serverId);\r\n        var serverMethodKeys = Object.keys(server.methods);\r\n        serverMethodKeys.forEach(function (methodKey) {\r\n            var method = server.methods[methodKey];\r\n            if (methodIdList.indexOf(method.protocolState.id) > -1) {\r\n                _this.repository.removeServerMethod(serverId, methodKey);\r\n            }\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleResultMessage = function (msg) {\r\n        var invocationId = msg._tag.invocationId;\r\n        var result = msg.result;\r\n        var serverId = msg._tag.serverId;\r\n        var server = this.repository.getServerById(serverId);\r\n        this.callbacks.execute(\"onResult\", invocationId, server.getInfoForUser(), 0, result, \"\");\r\n    };\r\n    ClientProtocol.prototype.handleInvocationError = function (msg) {\r\n        this.logger.debug(\"handle invocation error \" + JSON.stringify(msg));\r\n        var invocationId = msg._tag.invocationId;\r\n        var serverId = msg._tag.serverId;\r\n        var server = this.repository.getServerById(serverId);\r\n        var message = msg.reason;\r\n        var context = msg.context;\r\n        this.callbacks.execute(\"onResult\", invocationId, server.getInfoForUser(), 1, context, message);\r\n    };\r\n    return ClientProtocol;\r\n}());\r\nexports.default = ClientProtocol;\r\n//# sourceMappingURL=client.js.map\n\n/***/ }),\n/* 43 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar server_1 = __webpack_require__(45);\r\nvar client_1 = __webpack_require__(42);\r\nfunction default_1(instance, connection, clientRepository, serverRepository, libConfig, getAGM) {\r\n    var logger = libConfig.logger.subLogger(\"gw3-protocol\");\r\n    var resolveReadyPromise;\r\n    var readyPromise = new Promise(function (resolve) {\r\n        resolveReadyPromise = resolve;\r\n    });\r\n    var session = connection.domain(\"agm\", logger.subLogger(\"domain\"), [\"subscribed\"]);\r\n    var server = new server_1.default(instance, session, clientRepository, serverRepository, logger.subLogger(\"server\"));\r\n    var client = new client_1.default(instance, session, clientRepository, logger.subLogger(\"client\"));\r\n    function handleReconnect() {\r\n        logger.info(\"reconnected - will replay registered methods and subscriptions\");\r\n        clientRepository.reset();\r\n        clientRepository.addServer(instance, connection.peerId);\r\n        var registeredMethods = serverRepository.getList();\r\n        serverRepository.reset();\r\n        registeredMethods.forEach(function (method) {\r\n            var def = method.definition;\r\n            if (method.theFunction.userCallback) {\r\n                getAGM().register(def, method.theFunction.userCallback);\r\n            }\r\n            else if (method.theFunction.userCallbackAsync) {\r\n                getAGM().registerAsync(def, method.theFunction.userCallbackAsync);\r\n            }\r\n        });\r\n    }\r\n    function handleInitialJoin() {\r\n        clientRepository.addServer(instance, connection.peerId);\r\n        resolveReadyPromise({\r\n            client: client,\r\n            server: server,\r\n        });\r\n        resolveReadyPromise = undefined;\r\n    }\r\n    session.onJoined(function (reconnect) {\r\n        if (reconnect) {\r\n            handleReconnect();\r\n        }\r\n        else {\r\n            handleInitialJoin();\r\n        }\r\n    });\r\n    session.join();\r\n    return readyPromise;\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=factory.js.map\n\n/***/ }),\n/* 44 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar SUBSCRIPTION_REQUEST = \"onSubscriptionRequest\";\r\nvar SUBSCRIPTION_ADDED = \"onSubscriptionAdded\";\r\nvar SUBSCRIPTION_REMOVED = \"onSubscriptionRemoved\";\r\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(instance, session, repository, serverRepository, logger) {\r\n        var _this = this;\r\n        this.instance = instance;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.serverRepository = serverRepository;\r\n        this.logger = logger;\r\n        this.ERR_URI_SUBSCRIPTION_FAILED = \"com.tick42.agm.errors.subscription.failure\";\r\n        this.callbacks = callback_registry_1.default();\r\n        this.nextStreamId = 0;\r\n        session.on(\"add-interest\", function (msg) { _this.handleAddInterest(msg); });\r\n        session.on(\"remove-interest\", function (msg) { _this.handleRemoveInterest(msg); });\r\n    }\r\n    ServerStreaming.prototype.acceptRequestOnBranch = function (requestContext, streamingMethod, branch) {\r\n        if (typeof branch !== \"string\") {\r\n            branch = \"\";\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            throw new TypeError(\"The streaming method is missing its subscriptions.\");\r\n        }\r\n        if (!Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            throw new TypeError(\"The streaming method is missing its branches.\");\r\n        }\r\n        var streamId = this.getStreamId(streamingMethod, branch);\r\n        var key = requestContext.msg.subscription_id;\r\n        var subscription = {\r\n            id: key,\r\n            arguments: requestContext.arguments,\r\n            instance: requestContext.instance,\r\n            branchKey: branch,\r\n            streamId: streamId,\r\n            subscribeMsg: requestContext.msg,\r\n        };\r\n        streamingMethod.protocolState.subscriptionsMap[key] = subscription;\r\n        this.session.sendFireAndForget({\r\n            type: \"accepted\",\r\n            subscription_id: key,\r\n            stream_id: streamId,\r\n        });\r\n        this.callbacks.execute(SUBSCRIPTION_ADDED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.rejectRequest = function (requestContext, streamingMethod, reason) {\r\n        if (typeof reason !== \"string\") {\r\n            reason = \"\";\r\n        }\r\n        this.sendSubscriptionFailed(\"Subscription rejected by user. \" + reason, requestContext.msg.subscription_id);\r\n    };\r\n    ServerStreaming.prototype.pushData = function (streamingMethod, data, branches) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        if (typeof branches === \"string\") {\r\n            branches = [branches];\r\n        }\r\n        else if (!Array.isArray(branches) || branches.length <= 0) {\r\n            branches = null;\r\n        }\r\n        var streamIdList = streamingMethod.protocolState.branchKeyToStreamIdMap\r\n            .filter(function (br) {\r\n            return (branches === null || (Boolean(br) && typeof br.key === \"string\" && branches.indexOf(br.key) >= 0));\r\n        }).map(function (br) {\r\n            return br.streamId;\r\n        });\r\n        streamIdList.forEach(function (streamId) {\r\n            var publishMessage = {\r\n                type: \"publish\",\r\n                stream_id: streamId,\r\n                data: data,\r\n            };\r\n            _this.session.sendFireAndForget(publishMessage);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        var postMessage = {\r\n            type: \"post\",\r\n            subscription_id: subscription.id,\r\n            data: data,\r\n        };\r\n        this.session.sendFireAndForget(postMessage);\r\n    };\r\n    ServerStreaming.prototype.closeSingleSubscription = function (streamingMethod, subscription) {\r\n        delete streamingMethod.protocolState.subscriptionsMap[subscription.id];\r\n        var dropSubscriptionMessage = {\r\n            type: \"drop-subscription\",\r\n            subscription_id: subscription.id,\r\n            reason: \"Server dropping a single subscription\",\r\n        };\r\n        this.session.sendFireAndForget(dropSubscriptionMessage);\r\n        var subscriber = subscription.instance;\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.closeMultipleSubscriptions = function (streamingMethod, branchKey) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            return;\r\n        }\r\n        var subscriptionsToClose = Object.keys(streamingMethod.protocolState.subscriptionsMap)\r\n            .map(function (key) {\r\n            return streamingMethod.protocolState.subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey === \"string\") {\r\n            subscriptionsToClose = subscriptionsToClose.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        subscriptionsToClose.forEach(function (subscription) {\r\n            delete streamingMethod.protocolState.subscriptionsMap[subscription.id];\r\n            var drop = {\r\n                type: \"drop-subscription\",\r\n                subscription_id: subscription.id,\r\n                reason: \"Server dropping all subscriptions on stream_id: \" + subscription.streamId,\r\n            };\r\n            _this.session.sendFireAndForget(drop);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.getSubscriptionList = function (streamingMethod, branchKey) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var subscriptions = [];\r\n        var allSubscriptions = Object.keys(streamingMethod.protocolState.subscriptionsMap)\r\n            .map(function (key) {\r\n            return streamingMethod.protocolState.subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey !== \"string\") {\r\n            subscriptions = allSubscriptions;\r\n        }\r\n        else {\r\n            subscriptions = allSubscriptions.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        return subscriptions;\r\n    };\r\n    ServerStreaming.prototype.getBranchList = function (streamingMethod) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var allSubscriptions = Object.keys(streamingMethod.protocolState.subscriptionsMap)\r\n            .map(function (key) {\r\n            return streamingMethod.protocolState.subscriptionsMap[key];\r\n        });\r\n        var keysWithDuplicates = allSubscriptions.map(function (sub) {\r\n            var result = null;\r\n            if (typeof sub === \"object\" && typeof sub.branchKey === \"string\") {\r\n                result = sub.branchKey;\r\n            }\r\n            return result;\r\n        });\r\n        var seen = [];\r\n        var branchArray = keysWithDuplicates.filter(function (bKey) {\r\n            if (bKey === null || seen.indexOf(bKey) >= 0) {\r\n                return false;\r\n            }\r\n            seen.push(bKey);\r\n            return true;\r\n        });\r\n        return branchArray;\r\n    };\r\n    ServerStreaming.prototype.onSubAdded = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRequest = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRemoved = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED, callback);\r\n    };\r\n    ServerStreaming.prototype.handleRemoveInterest = function (msg) {\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (typeof msg.subscription_id !== \"string\" ||\r\n            typeof streamingMethod !== \"object\" ||\r\n            typeof streamingMethod.protocolState.subscriptionsMap[msg.subscription_id] !== \"object\") {\r\n            return;\r\n        }\r\n        var subscription = streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        delete streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.onSubscriptionLifetimeEvent = function (eventName, handlerFunc) {\r\n        this.callbacks.add(eventName, handlerFunc);\r\n    };\r\n    ServerStreaming.prototype.getNextStreamId = function () {\r\n        return this.nextStreamId++ + \"\";\r\n    };\r\n    ServerStreaming.prototype.handleAddInterest = function (msg) {\r\n        var caller = this.repository.getServerById(msg.caller_id);\r\n        var instance = (typeof caller.getInfoForUser === \"function\") ? caller.getInfoForUser() : null;\r\n        var requestContext = {\r\n            msg: msg,\r\n            arguments: msg.arguments_kv || {},\r\n            instance: instance,\r\n        };\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (streamingMethod === undefined) {\r\n            var errorMsg = \"No method with id \" + msg.method_id + \" on this server.\";\r\n            this.sendSubscriptionFailed(errorMsg, msg.subscription_id);\r\n            return;\r\n        }\r\n        if (streamingMethod.protocolState.subscriptionsMap &&\r\n            streamingMethod.protocolState.subscriptionsMap[msg.subscription_id]) {\r\n            this.sendSubscriptionFailed(\"A subscription with id \" + msg.subscription_id + \" already exists.\", msg.subscription_id);\r\n            return;\r\n        }\r\n        this.callbacks.execute(SUBSCRIPTION_REQUEST, requestContext, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.sendSubscriptionFailed = function (reason, subscriptionId) {\r\n        var errorMessage = {\r\n            type: \"error\",\r\n            reason_uri: this.ERR_URI_SUBSCRIPTION_FAILED,\r\n            reason: reason,\r\n            request_id: subscriptionId,\r\n        };\r\n        this.session.sendFireAndForget(errorMessage);\r\n    };\r\n    ServerStreaming.prototype.getStreamId = function (streamingMethod, branchKey) {\r\n        if (typeof branchKey !== \"string\") {\r\n            branchKey = \"\";\r\n        }\r\n        var needleBranch = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.key === branchKey;\r\n        })[0];\r\n        var streamId = (needleBranch ? needleBranch.streamId : undefined);\r\n        if (typeof streamId !== \"string\" || streamId === \"\") {\r\n            streamId = this.getNextStreamId();\r\n            streamingMethod.protocolState.branchKeyToStreamIdMap.push({ key: branchKey, streamId: streamId });\r\n        }\r\n        return streamId;\r\n    };\r\n    return ServerStreaming;\r\n}());\r\nexports.default = ServerStreaming;\r\n//# sourceMappingURL=server-streaming.js.map\n\n/***/ }),\n/* 45 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar server_streaming_1 = __webpack_require__(44);\r\nvar ServerProtocol = (function () {\r\n    function ServerProtocol(instance, session, clientRepository, serverRepository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.clientRepository = clientRepository;\r\n        this.serverRepository = serverRepository;\r\n        this.logger = logger;\r\n        this.callbacks = callback_registry_1.default();\r\n        this.streaming = new server_streaming_1.default(instance, session, clientRepository, serverRepository, logger);\r\n        this.session.on(\"invoke\", function (msg) { return _this.handleInvokeMessage(msg); });\r\n    }\r\n    ServerProtocol.prototype.createStream = function (repoMethod, success, error) {\r\n        var isStreaming = true;\r\n        repoMethod.protocolState.subscriptionsMap = {};\r\n        repoMethod.protocolState.branchKeyToStreamIdMap = [];\r\n        this.register(repoMethod, success, error, isStreaming);\r\n    };\r\n    ServerProtocol.prototype.register = function (repoMethod, success, error, isStreaming) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodDef, flags, registerMsg;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodDef = repoMethod.definition;\r\n                        repoMethod.protocolState.registrationCallbacks = {\r\n                            success: success,\r\n                            fail: error,\r\n                        };\r\n                        flags = { streaming: isStreaming || false };\r\n                        this.logger.debug('registering method \"' + methodDef.name + '\"');\r\n                        registerMsg = {\r\n                            type: \"register\",\r\n                            methods: [{\r\n                                    id: repoMethod.repoId,\r\n                                    name: methodDef.name,\r\n                                    display_name: methodDef.displayName,\r\n                                    description: methodDef.description,\r\n                                    version: methodDef.version,\r\n                                    flags: flags,\r\n                                    object_types: methodDef.objectTypes || methodDef.object_types,\r\n                                    input_signature: methodDef.accepts,\r\n                                    result_signature: methodDef.returns,\r\n                                    restrictions: undefined,\r\n                                }],\r\n                        };\r\n                        return [4, this.session.send(registerMsg, { methodId: repoMethod.repoId })\r\n                                .then(function (msg) { return _this.handleRegisteredMessage(msg); })\r\n                                .catch(function (err) { return _this.handleErrorRegister(err); })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerProtocol.prototype.onInvoked = function (callback) {\r\n        this.callbacks.add(\"onInvoked\", callback);\r\n    };\r\n    ServerProtocol.prototype.methodInvocationResult = function (method, invocationId, err, result) {\r\n        var msg;\r\n        if (err) {\r\n            msg = {\r\n                type: \"error\",\r\n                request_id: invocationId,\r\n                reason_uri: \"agm.errors.client_error\",\r\n                reason: err,\r\n                context: result,\r\n                peer_id: undefined,\r\n            };\r\n        }\r\n        else {\r\n            msg = {\r\n                type: \"yield\",\r\n                invocation_id: invocationId,\r\n                peer_id: this.session.peerId,\r\n                result: result,\r\n                request_id: undefined,\r\n            };\r\n        }\r\n        this.session.sendFireAndForget(msg);\r\n    };\r\n    ServerProtocol.prototype.unregister = function (method) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var msg;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        msg = {\r\n                            type: \"unregister\",\r\n                            methods: [method.repoId],\r\n                        };\r\n                        return [4, this.session.send(msg)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerProtocol.prototype.getBranchList = function (method) {\r\n        return this.streaming.getBranchList(method);\r\n    };\r\n    ServerProtocol.prototype.getSubscriptionList = function (method, branchKey) {\r\n        return this.streaming.getSubscriptionList(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.closeAllSubscriptions = function (method, branchKey) {\r\n        this.streaming.closeMultipleSubscriptions(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.pushData = function (method, data, branches) {\r\n        this.streaming.pushData(method, data, branches);\r\n    };\r\n    ServerProtocol.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        this.streaming.pushDataToSingle(method, subscription, data);\r\n    };\r\n    ServerProtocol.prototype.closeSingleSubscription = function (method, subscription) {\r\n        this.streaming.closeSingleSubscription(method, subscription);\r\n    };\r\n    ServerProtocol.prototype.acceptRequestOnBranch = function (requestContext, method, branch) {\r\n        this.streaming.acceptRequestOnBranch(requestContext, method, branch);\r\n    };\r\n    ServerProtocol.prototype.rejectRequest = function (requestContext, method, reason) {\r\n        this.streaming.rejectRequest(requestContext, method, reason);\r\n    };\r\n    ServerProtocol.prototype.onSubRequest = function (callback) {\r\n        this.streaming.onSubRequest(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubAdded = function (callback) {\r\n        this.streaming.onSubAdded(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubRemoved = function (callback) {\r\n        this.streaming.onSubRemoved(callback);\r\n    };\r\n    ServerProtocol.prototype.handleRegisteredMessage = function (msg) {\r\n        var methodId = msg._tag.methodId;\r\n        var repoMethod = this.serverRepository.getById(methodId);\r\n        if (repoMethod && repoMethod.protocolState.registrationCallbacks) {\r\n            this.logger.debug(\"registered method \" + repoMethod.definition.name + \" with id \" + methodId);\r\n            repoMethod.protocolState.registrationCallbacks.success();\r\n        }\r\n    };\r\n    ServerProtocol.prototype.handleErrorRegister = function (msg) {\r\n        this.logger.warn(JSON.stringify(msg));\r\n        var methodId = msg._tag.methodId;\r\n        var repoMethod = this.serverRepository.getById(methodId);\r\n        if (repoMethod && repoMethod.protocolState.registrationCallbacks) {\r\n            this.logger.debug(\"failed to register method \" + repoMethod.definition.name + \" with id \" + methodId);\r\n            repoMethod.protocolState.registrationCallbacks.fail();\r\n        }\r\n    };\r\n    ServerProtocol.prototype.handleInvokeMessage = function (msg) {\r\n        var invocationId = msg.invocation_id;\r\n        var callerId = msg.caller_id;\r\n        var methodId = msg.method_id;\r\n        var args = msg.arguments_kv;\r\n        this.logger.debug('received invocation for method id \"' + methodId + '\" from peer ' + callerId);\r\n        var methodList = this.serverRepository.getList();\r\n        var method = methodList.filter(function (m) {\r\n            return m.repoId === methodId;\r\n        })[0];\r\n        if (method === undefined) {\r\n            return;\r\n        }\r\n        var client = this.clientRepository.getServerById(callerId);\r\n        var invocationArgs = { args: args, instance: client.getInfoForUser() };\r\n        this.callbacks.execute(\"onInvoked\", method, invocationId, invocationArgs);\r\n    };\r\n    return ServerProtocol;\r\n}());\r\nexports.default = ServerProtocol;\r\n//# sourceMappingURL=server.js.map\n\n/***/ }),\n/* 46 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar subscription_1 = __webpack_require__(9);\r\nvar ServerBranch = (function () {\r\n    function ServerBranch(key, protocol, repoMethod) {\r\n        this.key = key;\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n    }\r\n    ServerBranch.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this.protocol.server.getSubscriptionList(this.repoMethod, this.key);\r\n        return subList.map(function (sub) {\r\n            return new subscription_1.default(_this.protocol, _this.repoMethod, sub);\r\n        });\r\n    };\r\n    ServerBranch.prototype.close = function () {\r\n        this.protocol.server.closeAllSubscriptions(this.repoMethod, this.key);\r\n    };\r\n    ServerBranch.prototype.push = function (data) {\r\n        this.protocol.server.pushData(this.repoMethod, data, [this.key]);\r\n    };\r\n    return ServerBranch;\r\n}());\r\nexports.default = ServerBranch;\r\n//# sourceMappingURL=branch.js.map\n\n/***/ }),\n/* 47 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ServerRepository = (function () {\r\n    function ServerRepository() {\r\n        this.nextId = 0;\r\n        this.methods = [];\r\n    }\r\n    ServerRepository.prototype.add = function (method) {\r\n        if (typeof method !== \"object\") {\r\n            return;\r\n        }\r\n        if (method.repoId !== undefined) {\r\n            return;\r\n        }\r\n        method.repoId = String(this.nextId);\r\n        this.nextId += 1;\r\n        this.methods.push(method);\r\n        return method;\r\n    };\r\n    ServerRepository.prototype.remove = function (repoId) {\r\n        if (typeof repoId !== \"string\") {\r\n            return new TypeError(\"Expecting a string\");\r\n        }\r\n        this.methods = this.methods.filter(function (m) {\r\n            return m.repoId !== repoId;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getById = function (id) {\r\n        if (typeof id !== \"string\") {\r\n            return undefined;\r\n        }\r\n        return this.methods.filter(function (m) {\r\n            return m.repoId === id;\r\n        })[0];\r\n    };\r\n    ServerRepository.prototype.getList = function () {\r\n        return this.methods.map(function (m) { return m; });\r\n    };\r\n    ServerRepository.prototype.length = function () {\r\n        return this.methods.length;\r\n    };\r\n    ServerRepository.prototype.reset = function () {\r\n        this.methods = [];\r\n    };\r\n    return ServerRepository;\r\n}());\r\nexports.default = ServerRepository;\r\n//# sourceMappingURL=repository.js.map\n\n/***/ }),\n/* 48 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Request = (function () {\r\n    function Request(protocol, repoMethod, requestContext) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.requestContext = requestContext;\r\n        this.arguments = requestContext.arguments;\r\n        this.instance = requestContext.instance;\r\n    }\r\n    Request.prototype.accept = function () {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, \"\");\r\n    };\r\n    Request.prototype.acceptOnBranch = function (branch) {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, branch);\r\n    };\r\n    Request.prototype.reject = function (reason) {\r\n        this.protocol.server.rejectRequest(this.requestContext, this.repoMethod, reason);\r\n    };\r\n    return Request;\r\n}());\r\nexports.default = Request;\r\n//# sourceMappingURL=request.js.map\n\n/***/ }),\n/* 49 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar promisify_1 = __webpack_require__(8);\r\nvar streaming_1 = __webpack_require__(51);\r\nvar stream_1 = __webpack_require__(50);\r\nvar Server = (function () {\r\n    function Server(protocol, serverRepository, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.serverRepository = serverRepository;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n        this.invocations = 0;\r\n        this.streaming = new streaming_1.default(protocol, this);\r\n        this.protocol.server.onInvoked(this.onMethodInvoked.bind(this));\r\n    }\r\n    Server.prototype.register = function (methodDefinition, callback) {\r\n        if (methodDefinition === undefined) {\r\n            return Promise.reject(\"Please supply either a string of the Unique name or an object with property name\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be the callback function\");\r\n        }\r\n        var wrappedCallbackFunction = function (context, resultCallback) {\r\n            try {\r\n                var result = callback(context.args, context.instance);\r\n                resultCallback(null, result);\r\n            }\r\n            catch (e) {\r\n                resultCallback(e, e);\r\n            }\r\n        };\r\n        wrappedCallbackFunction.userCallback = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallbackFunction);\r\n    };\r\n    Server.prototype.registerAsync = function (methodDefinition, callback) {\r\n        if (methodDefinition === undefined) {\r\n            return Promise.reject(\"Please supply either a string of the Unique name or an object with property name\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be the callback function\");\r\n        }\r\n        var wrappedCallback = function (context, resultCallback) {\r\n            try {\r\n                callback(context.args, context.instance, function (result) {\r\n                    resultCallback(null, result);\r\n                }, function (e) {\r\n                    resultCallback(e, e);\r\n                });\r\n            }\r\n            catch (e) {\r\n                resultCallback(e, null);\r\n            }\r\n        };\r\n        wrappedCallback.userCallbackAsync = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallback);\r\n    };\r\n    Server.prototype.registerCore = function (method, theFunction) {\r\n        var _this = this;\r\n        var methodDefinition;\r\n        if (typeof method === \"string\") {\r\n            methodDefinition = { name: \"\" + method };\r\n        }\r\n        else {\r\n            methodDefinition = __assign({}, method);\r\n        }\r\n        var nameAlreadyExists = this.serverRepository.getList()\r\n            .some(function (serverMethod) { return serverMethod.definition.name === methodDefinition.name; });\r\n        if (nameAlreadyExists) {\r\n            return Promise.reject(\"Name already exists !\");\r\n        }\r\n        if (methodDefinition.supportsStreaming) {\r\n            return Promise.reject(\"supportsStreaming can not be true ! If you want to create a stream please use glue.agm.createStream\");\r\n        }\r\n        var repoMethod = this.serverRepository.add({\r\n            definition: methodDefinition,\r\n            theFunction: theFunction,\r\n            protocolState: {},\r\n        });\r\n        return this.protocol.server.register(repoMethod, function () {\r\n        }, function () {\r\n            _this.serverRepository.remove(repoMethod.repoId);\r\n        });\r\n    };\r\n    Server.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (typeof streamDef === \"string\") {\r\n                if (streamDef === \"\") {\r\n                    reject(\"Invalid stream name - can not be empty\");\r\n                }\r\n                streamDef = { name: streamDef };\r\n            }\r\n            streamDef.supportsStreaming = true;\r\n            if (!callbacks) {\r\n                callbacks = {};\r\n            }\r\n            if (typeof callbacks.subscriptionRequestHandler !== \"function\") {\r\n                callbacks.subscriptionRequestHandler = function (request) {\r\n                    request.accept();\r\n                };\r\n            }\r\n            var repoMethod = {\r\n                definition: streamDef,\r\n                streamCallbacks: callbacks,\r\n                protocolState: {},\r\n            };\r\n            _this.serverRepository.add(repoMethod);\r\n            _this.protocol.server.createStream(repoMethod, function () {\r\n                var streamFrontObject = new stream_1.default(_this.protocol, repoMethod, _this);\r\n                repoMethod.stream = streamFrontObject;\r\n                resolve(streamFrontObject);\r\n            }, function (err) {\r\n                _this.serverRepository.remove(repoMethod.repoId);\r\n                reject(err);\r\n            });\r\n        });\r\n        return promisify_1.default(promise, successCallback, errorCallback);\r\n    };\r\n    Server.prototype.unregister = function (methodFilter, forStream) {\r\n        if (forStream === void 0) { forStream = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodDefinition, methodToBeRemoved;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (methodFilter === undefined) {\r\n                            return [2, Promise.reject(\"Please supply either a string of the Unique name or an object with property name\")];\r\n                        }\r\n                        if (!(typeof methodFilter === \"function\")) return [3, 2];\r\n                        return [4, this.unregisterWithPredicate(methodFilter, forStream)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                    case 2:\r\n                        if (typeof methodFilter === \"string\") {\r\n                            methodDefinition = { name: methodFilter };\r\n                        }\r\n                        else {\r\n                            methodDefinition = methodFilter;\r\n                        }\r\n                        if (methodDefinition.name === undefined) {\r\n                            return [2, Promise.reject(\"Method with undefined name does not exist !\")];\r\n                        }\r\n                        methodToBeRemoved = this.serverRepository.getList().find(function (serverMethod) {\r\n                            return serverMethod.definition.name === methodDefinition.name\r\n                                && (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodToBeRemoved) {\r\n                            return [2, Promise.reject(\"Method does not exist or it is not registered by your application !\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams([methodToBeRemoved])];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.unregisterWithPredicate = function (filterPredicate, forStream) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodsOrStreamsToRemove;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodsOrStreamsToRemove = this.serverRepository.getList()\r\n                            .filter(function (sm) { return filterPredicate(sm.definition); })\r\n                            .filter(function (serverMethod) {\r\n                            return (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodsOrStreamsToRemove || methodsOrStreamsToRemove.length === 0) {\r\n                            return [2, Promise.reject(\"No \" + (forStream ? \"stream\" : \"method\") + \" matches the condition !\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams(methodsOrStreamsToRemove)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.removeMethodsOrStreams = function (methodsToRemove) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, Promise.all(methodsToRemove.map(function (method) { return __awaiter(_this, void 0, void 0, function () {\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4, this.protocol.server.unregister(method)];\r\n                                    case 1:\r\n                                        _a.sent();\r\n                                        this.serverRepository.remove(method.repoId);\r\n                                        return [2];\r\n                                }\r\n                            });\r\n                        }); }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.containsProps = function (filter, methodDefinition) {\r\n        var filterProps = Object.keys(filter)\r\n            .filter(function (prop) {\r\n            return typeof filter[prop] !== \"function\"\r\n                && prop !== \"object_types\"\r\n                && prop !== \"display_name\";\r\n        });\r\n        var methodDefProps = Object.keys(methodDefinition);\r\n        var uniqProps = Array.from(new Set(filterProps.concat(methodDefProps)));\r\n        return uniqProps.reduce(function (isMatch, prop) {\r\n            var filterValue = filter[prop];\r\n            var methodDefValue = methodDefinition[prop];\r\n            if (prop === \"supportsStreaming\") {\r\n                methodDefValue = methodDefValue || false;\r\n                filterValue = filterValue || false;\r\n            }\r\n            if (prop === \"objectTypes\" && filterValue !== undefined && methodDefValue !== undefined) {\r\n                if (filterValue.length !== methodDefValue.length) {\r\n                    isMatch = false;\r\n                }\r\n                else {\r\n                    var firstObjType = filterValue.sort();\r\n                    var secondObjTypes_1 = methodDefValue.sort();\r\n                    var hasADifference = firstObjType.some(function (objType, index) { return objType !== secondObjTypes_1[index]; });\r\n                    if (hasADifference) {\r\n                        isMatch = false;\r\n                    }\r\n                }\r\n            }\r\n            else if (filterValue !== methodDefValue) {\r\n                isMatch = false;\r\n            }\r\n            return isMatch;\r\n        }, true);\r\n    };\r\n    Server.prototype.onMethodInvoked = function (methodToExecute, invocationId, invocationArgs) {\r\n        var _this = this;\r\n        if (!methodToExecute) {\r\n            return;\r\n        }\r\n        methodToExecute.theFunction(invocationArgs, function (err, result) {\r\n            if (err) {\r\n                if (typeof err.message === \"string\") {\r\n                    err = err.message;\r\n                }\r\n                else if (typeof err !== \"string\") {\r\n                    try {\r\n                        err = JSON.stringify(err);\r\n                    }\r\n                    catch (unStrException) {\r\n                        err = \"un-stringifyable error in onMethodInvoked ! Top level prop names: \" + Object.keys(err);\r\n                    }\r\n                }\r\n            }\r\n            if (!result || typeof result !== \"object\" || result.constructor === Array) {\r\n                result = { _result: result };\r\n            }\r\n            _this.protocol.server.methodInvocationResult(methodToExecute, invocationId, err, result);\r\n        });\r\n    };\r\n    return Server;\r\n}());\r\nexports.default = Server;\r\n//# sourceMappingURL=server.js.map\n\n/***/ }),\n/* 50 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar subscription_1 = __webpack_require__(9);\r\nvar branch_1 = __webpack_require__(46);\r\nvar ServerStream = (function () {\r\n    function ServerStream(protocol, repoMethod, server) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.server = server;\r\n        this.def = repoMethod.definition;\r\n    }\r\n    Object.defineProperty(ServerStream.prototype, \"name\", {\r\n        get: function () { return this.def.name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerStream.prototype.branches = function (key) {\r\n        var _this = this;\r\n        var bList = this.protocol.server.getBranchList(this.repoMethod);\r\n        if (key) {\r\n            if (bList.indexOf(key) > -1) {\r\n                return new branch_1.default(key, this.protocol, this.repoMethod);\r\n            }\r\n            return undefined;\r\n        }\r\n        else {\r\n            return bList.map(function (branchKey) {\r\n                return new branch_1.default(branchKey, _this.protocol, _this.repoMethod);\r\n            });\r\n        }\r\n    };\r\n    ServerStream.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this.protocol.server.getSubscriptionList(this.repoMethod);\r\n        return subList.map(function (sub) {\r\n            return new subscription_1.default(_this.protocol, _this.repoMethod, sub);\r\n        });\r\n    };\r\n    Object.defineProperty(ServerStream.prototype, \"definition\", {\r\n        get: function () {\r\n            var def2 = this.def;\r\n            return {\r\n                accepts: def2.accepts,\r\n                description: def2.description,\r\n                displayName: def2.displayName,\r\n                name: def2.name,\r\n                objectTypes: def2.objectTypes,\r\n                returns: def2.returns,\r\n                supportsStreaming: def2.supportsStreaming,\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerStream.prototype.close = function () {\r\n        this.protocol.server.closeAllSubscriptions(this.repoMethod);\r\n        this.server.unregister(this.repoMethod.definition, true);\r\n    };\r\n    ServerStream.prototype.push = function (data, branches) {\r\n        if (typeof branches !== \"string\" && !Array.isArray(branches) && branches !== undefined) {\r\n            throw new Error(\"invalid branches should be string or string array\");\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        this.protocol.server.pushData(this.repoMethod, data, branches);\r\n    };\r\n    return ServerStream;\r\n}());\r\nexports.default = ServerStream;\r\n//# sourceMappingURL=stream.js.map\n\n/***/ }),\n/* 51 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar subscription_1 = __webpack_require__(9);\r\nvar request_1 = __webpack_require__(48);\r\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(protocol, server) {\r\n        var _this = this;\r\n        this.protocol = protocol;\r\n        this.server = server;\r\n        protocol.server.onSubRequest(function (rc, rm) { return _this.handleSubRequest(rc, rm); });\r\n        protocol.server.onSubAdded(function (sub, rm) { return _this.handleSubAdded(sub, rm); });\r\n        protocol.server.onSubRemoved(function (sub, rm) { return _this.handleSubRemoved(sub, rm); });\r\n    }\r\n    ServerStreaming.prototype.handleSubRequest = function (requestContext, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRequestHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var request = new request_1.default(this.protocol, repoMethod, requestContext);\r\n        repoMethod.streamCallbacks.subscriptionRequestHandler(request);\r\n    };\r\n    ServerStreaming.prototype.handleSubAdded = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionAddedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new subscription_1.default(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionAddedHandler(sub);\r\n    };\r\n    ServerStreaming.prototype.handleSubRemoved = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRemovedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new subscription_1.default(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionRemovedHandler(sub);\r\n    };\r\n    return ServerStreaming;\r\n}());\r\nexports.default = ServerStreaming;\r\n//# sourceMappingURL=streaming.js.map\n\n/***/ }),\n/* 52 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar protocol_1 = __webpack_require__(53);\r\nvar successMessages = ['subscribed', 'success'];\r\nexports.default = (function (configuration) {\r\n    var connection = configuration.connection, logger = configuration.logger;\r\n    var session = connection.domain('bus', logger, successMessages);\r\n    return new Promise(function (resolve, reject) {\r\n        session.join()\r\n            .then(function () {\r\n            var protocol = protocol_1.default(connection, logger, session);\r\n            resolve(protocol);\r\n        })\r\n            .catch(reject);\r\n    });\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 53 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar utils_1 = __webpack_require__(54);\r\n;\r\nvar Protocol = (function () {\r\n    function Protocol(connection, logger, session) {\r\n        var _this = this;\r\n        this.publish = function (topic, data, options) {\r\n            var _a = options || {}, _b = _a.routingKey, routingKey = _b === void 0 ? undefined : _b, _c = _a.target, target = _c === void 0 ? undefined : _c;\r\n            var args = utils_1.removeEmptyValues({\r\n                type: 'publish',\r\n                topic: topic,\r\n                data: data,\r\n                peer_id: _this.peerId,\r\n                routing_key: routingKey,\r\n                target_identity: target\r\n            });\r\n            _this.session.send(args);\r\n        };\r\n        this.subscribe = function (topic, callback, options) {\r\n            return new Promise(function (resolve, reject) {\r\n                var _a = options || {}, _b = _a.routingKey, routingKey = _b === void 0 ? undefined : _b, _c = _a.target, target = _c === void 0 ? undefined : _c;\r\n                var args = utils_1.removeEmptyValues({\r\n                    type: 'subscribe',\r\n                    topic: topic,\r\n                    peer_id: _this.peerId,\r\n                    routing_key: routingKey,\r\n                    source: target\r\n                });\r\n                _this.session.send(args)\r\n                    .then(function (response) {\r\n                    var subscription_id = response.subscription_id;\r\n                    _this.subscriptions.push({ subscription_id: subscription_id, topic: topic, callback: callback, source: target });\r\n                    resolve({\r\n                        unsubscribe: function () {\r\n                            _this.session.send({ type: 'unsubscribe', subscription_id: subscription_id, peer_id: _this.peerId });\r\n                            _this.subscriptions = _this.subscriptions.filter(function (s) { return s.subscription_id !== subscription_id; });\r\n                            return Promise.resolve();\r\n                        }\r\n                    });\r\n                })\r\n                    .catch(function (error) { return reject(error); });\r\n            });\r\n        };\r\n        this.watchOnEvent = function () {\r\n            _this.session.on('event', function (args) {\r\n                var data = args.data, subscription_id = args.subscription_id;\r\n                var source = args['publisher-identity'];\r\n                var subscription = _this.subscriptions.find(function (s) { return s.subscription_id === subscription_id; });\r\n                if (subscription) {\r\n                    if (!subscription.source) {\r\n                        subscription.callback(data, subscription.topic, source);\r\n                    }\r\n                    else {\r\n                        if (utils_1.keysMatch(subscription.source, source)) {\r\n                            subscription.callback(data, subscription.topic, source);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        this.connection = connection;\r\n        this.logger = logger;\r\n        this.session = session;\r\n        this.peerId = connection.peerId;\r\n        this.subscriptions = [];\r\n    }\r\n    return Protocol;\r\n}());\r\nfunction default_1(connection, logger, session) {\r\n    var protocol = new Protocol(connection, logger, session);\r\n    protocol.watchOnEvent();\r\n    return protocol;\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=protocol.js.map\n\n/***/ }),\n/* 54 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction removeEmptyValues(obj) {\r\n    var cleaned = {};\r\n    Object.keys(obj).forEach(function (key) {\r\n        if (obj[key] !== undefined && obj[key] !== null) {\r\n            cleaned[key] = obj[key];\r\n        }\r\n    });\r\n    return cleaned;\r\n}\r\nexports.removeEmptyValues = removeEmptyValues;\r\nfunction keysMatch(obj1, obj2) {\r\n    var keysObj1 = Object.keys(obj1);\r\n    var allMatch = true;\r\n    keysObj1.forEach(function (key) {\r\n        if (obj1[key] !== obj2[key]) {\r\n            allMatch = false;\r\n        }\r\n    });\r\n    return allMatch;\r\n}\r\nexports.keysMatch = keysMatch;\r\n//# sourceMappingURL=utils.js.map\n\n/***/ }),\n/* 55 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global, process) {\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar shortid_1 = __webpack_require__(6);\r\nvar utils_1 = __webpack_require__(11);\r\nvar contextMessageReplaySpec_1 = __webpack_require__(10);\r\nvar pjson = __webpack_require__(12);\r\nfunction default_1(configuration, ext, hc, glue42gd, gdVersion) {\r\n    if (typeof window !== \"undefined\") {\r\n        global = global || window;\r\n    }\r\n    global = global || {};\r\n    var uid = shortid_1.generate();\r\n    var masterConfig = global.GLUE_CONFIG || {};\r\n    var dynamicDefaults = global.GLUE_DEFAULT_CONFIG || {};\r\n    var hardDefaults = getHardDefaults();\r\n    var metricsIdentity = {\r\n        system: getConfigProp(\"metrics\", \"system\"),\r\n        service: getConfigProp(\"metrics\", \"service\"),\r\n        instance: getConfigProp(\"metrics\", \"instance\")\r\n    };\r\n    function getMetrics() {\r\n        return ifNotFalse(getConfigProp(\"metrics\"), {\r\n            identity: metricsIdentity\r\n        });\r\n    }\r\n    function getGateway() {\r\n        var force = getConfigProp(\"gateway\", \"force\");\r\n        var gw = hc === undefined || force;\r\n        if (gw) {\r\n            var gwConfig = getConfigProp(\"gateway\");\r\n            var protocolVersion = getConfigProp(\"gateway\", \"protocolVersion\");\r\n            var reconnectInterval = getConfigProp(\"gateway\", \"reconnectInterval\");\r\n            var reconnectAttempts = getConfigProp(\"gateway\", \"reconnectAttempts\");\r\n            var ws = gwConfig.ws;\r\n            var http = gwConfig.http;\r\n            var inproc = gwConfig.inproc;\r\n            if (!ws && !http && !inproc) {\r\n                if (utils_1.default.isNode() || (\"WebSocket\" in window && window.WebSocket.CLOSING === 2)) {\r\n                    ws = getConfigProp(\"gateway\", \"ws\");\r\n                }\r\n                else {\r\n                    http = getConfigProp(\"gateway\", \"http\");\r\n                }\r\n            }\r\n            var windowId = void 0;\r\n            var pid = void 0;\r\n            if (hc) {\r\n                windowId = hc.windowId;\r\n            }\r\n            else if (typeof glue42gd !== \"undefined\") {\r\n                windowId = glue42gd.windowId;\r\n                pid = glue42gd.pid;\r\n            }\r\n            else if (utils_1.default.isNode()) {\r\n                pid = process.pid;\r\n            }\r\n            var replaySpecs = getConfigProp(\"gateway\", \"replaySpecs\") || [];\r\n            replaySpecs.push(contextMessageReplaySpec_1.ContextMessageReplaySpec);\r\n            return {\r\n                identity: {\r\n                    application: getApplication(),\r\n                    windowId: windowId,\r\n                    process: pid,\r\n                },\r\n                reconnectInterval: reconnectInterval,\r\n                ws: ws,\r\n                http: http,\r\n                gw: inproc,\r\n                protocolVersion: protocolVersion,\r\n                reconnectAttempts: reconnectAttempts,\r\n                force: true,\r\n                replaySpecs: replaySpecs,\r\n                gdVersion: gdVersion,\r\n            };\r\n        }\r\n        return { gdVersion: gdVersion };\r\n    }\r\n    function getLogger() {\r\n        return getConfigProp(\"logger\");\r\n    }\r\n    function getAgm() {\r\n        return ifNotFalse(configuration.agm, {\r\n            instance: {\r\n                application: getApplication()\r\n            }\r\n        });\r\n    }\r\n    function getContexts(connectionConfig) {\r\n        if (connectionConfig.protocolVersion < 3) {\r\n            return false;\r\n        }\r\n        var contextConfig = getConfigProp(\"contexts\");\r\n        if (typeof contextConfig === \"boolean\" && !contextConfig) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    function getChannels(contextsEnabled) {\r\n        if (!contextsEnabled) {\r\n            return false;\r\n        }\r\n        var channelsConfig = getConfigProp(\"channels\");\r\n        if (typeof channelsConfig === \"boolean\" && !channelsConfig) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    function getBus(connectionConfig) {\r\n        var contextConfig = getConfigProp(\"bus\");\r\n        if (typeof contextConfig === \"boolean\" && contextConfig) {\r\n            if (connectionConfig.protocolVersion && connectionConfig.protocolVersion < 3) {\r\n                return false;\r\n            }\r\n            if (gdVersion === 2) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    function getApplication() {\r\n        return getConfigProp(\"application\");\r\n    }\r\n    function getAuth() {\r\n        return getConfigProp(\"auth\");\r\n    }\r\n    function getHardDefaults() {\r\n        function getMetricsDefaults() {\r\n            var documentTitle = typeof document !== \"undefined\" ? document.title : \"unknown\";\r\n            documentTitle = documentTitle || \"none\";\r\n            if (typeof hc === \"undefined\") {\r\n                return {\r\n                    system: \"Connect.Browser\",\r\n                    service: configuration.application || documentTitle,\r\n                    instance: \"~\" + uid\r\n                };\r\n            }\r\n            if (typeof hc.metricsFacade.getIdentity !== \"undefined\") {\r\n                var identity = hc.metricsFacade.getIdentity();\r\n                return {\r\n                    system: identity.system,\r\n                    service: identity.service,\r\n                    instance: identity.instance\r\n                };\r\n            }\r\n            return {\r\n                system: \"HtmlContainer.\" + hc.containerName,\r\n                service: \"JS.\" + hc.browserWindowName,\r\n                instance: \"~\" + hc.machineName\r\n            };\r\n        }\r\n        function getGatewayDefaults() {\r\n            var defaultProtocol = 3;\r\n            var gatewayURL = \"localhost:8385\";\r\n            var defaultWs = \"ws://\" + gatewayURL;\r\n            var defaultHttp = \"http://\" + gatewayURL;\r\n            if (glue42gd) {\r\n                defaultProtocol = 3;\r\n                defaultWs = glue42gd.gwURL;\r\n            }\r\n            return {\r\n                ws: defaultWs,\r\n                http: defaultHttp,\r\n                protocolVersion: defaultProtocol,\r\n                reconnectInterval: 1000\r\n            };\r\n        }\r\n        function getDefaultApplicationName() {\r\n            if (hc) {\r\n                return hc.containerName + \".\" + hc.browserWindowName;\r\n            }\r\n            if (glue42gd) {\r\n                return glue42gd.appName;\r\n            }\r\n            if (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\r\n                return (window.agm_application || document.title) + uid;\r\n            }\r\n            else {\r\n                return \"NodeJS\" + uid;\r\n            }\r\n        }\r\n        function getDefaultLogger() {\r\n            return {\r\n                publish: \"off\",\r\n                console: \"info\",\r\n                metrics: \"off\",\r\n            };\r\n        }\r\n        return {\r\n            application: getDefaultApplicationName(),\r\n            metrics: getMetricsDefaults(),\r\n            agm: {},\r\n            gateway: getGatewayDefaults(),\r\n            logger: getDefaultLogger(),\r\n            bus: false\r\n        };\r\n    }\r\n    function getConfigProp(prop1, prop2) {\r\n        var masterConfigProp1 = masterConfig[prop1];\r\n        var userProp1 = configuration[prop1];\r\n        var dynamicDefaultsProp1 = dynamicDefaults[prop1];\r\n        var hardDefaultsProp1 = hardDefaults[prop1];\r\n        if (prop2) {\r\n            if (masterConfigProp1 && masterConfigProp1[prop2] !== undefined) {\r\n                return masterConfigProp1[prop2];\r\n            }\r\n            if (userProp1 && userProp1[prop2] !== undefined) {\r\n                return userProp1[prop2];\r\n            }\r\n            if (dynamicDefaultsProp1 && dynamicDefaultsProp1[prop2] !== undefined) {\r\n                return dynamicDefaultsProp1[prop2];\r\n            }\r\n            if (hardDefaultsProp1 && hardDefaultsProp1[prop2] !== undefined) {\r\n                return hardDefaultsProp1[prop2];\r\n            }\r\n        }\r\n        else {\r\n            if (masterConfigProp1 !== undefined) {\r\n                return masterConfigProp1;\r\n            }\r\n            if (userProp1 !== undefined) {\r\n                return userProp1;\r\n            }\r\n            if (dynamicDefaultsProp1 !== undefined) {\r\n                return dynamicDefaultsProp1;\r\n            }\r\n            if (hardDefaultsProp1 !== undefined) {\r\n                return hardDefaultsProp1;\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n    function ifNotFalse(what, then) {\r\n        if (typeof what === \"boolean\" && !what) {\r\n            return undefined;\r\n        }\r\n        else {\r\n            return then;\r\n        }\r\n    }\r\n    var connection = getGateway();\r\n    var contexts = getContexts(connection);\r\n    var channels = getChannels(contexts);\r\n    var bus = getBus(connection);\r\n    return {\r\n        bus: bus,\r\n        identity: metricsIdentity,\r\n        application: getApplication(),\r\n        auth: getAuth(),\r\n        logger: getLogger(),\r\n        connection: connection,\r\n        metrics: getMetrics(),\r\n        agm: getAgm(),\r\n        contexts: contexts,\r\n        channels: channels,\r\n        version: ext.version || pjson.version,\r\n        libs: ext.libs\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=config.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(7), __webpack_require__(18)))\n\n/***/ }),\n/* 56 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar connection_1 = __webpack_require__(13);\r\nvar messageReplayer_1 = __webpack_require__(58);\r\nvar GW3ConnectionImpl = (function (_super) {\r\n    __extends(GW3ConnectionImpl, _super);\r\n    function GW3ConnectionImpl(settings) {\r\n        var _this = _super.call(this, settings) || this;\r\n        if (settings.replaySpecs &&\r\n            settings.replaySpecs.length) {\r\n            _this.replayer = new messageReplayer_1.MessageReplayerImpl(settings.replaySpecs);\r\n        }\r\n        return _this;\r\n    }\r\n    GW3ConnectionImpl.prototype.init = function (transport, protocol) {\r\n        _super.prototype.init.call(this, transport, protocol);\r\n        if (this.replayer) {\r\n            this.replayer.init(this);\r\n        }\r\n        this.gw3Protocol = protocol;\r\n    };\r\n    GW3ConnectionImpl.prototype.toAPI = function () {\r\n        var that = this;\r\n        var superAPI = _super.prototype.toAPI.call(this);\r\n        return {\r\n            domain: that.domain.bind(that),\r\n            get peerId() { return that.peerId; },\r\n            get token() { return that.token; },\r\n            get info() { return that.info; },\r\n            get resolvedIdentity() { return that.resolvedIdentity; },\r\n            get availableDomains() { return that.availableDomains; },\r\n            get gatewayToken() { return that.gatewayToken; },\r\n            get replayer() { return that.replayer; },\r\n            on: superAPI.on,\r\n            send: superAPI.send,\r\n            off: superAPI.off,\r\n            login: superAPI.login,\r\n            logout: superAPI.logout,\r\n            loggedIn: superAPI.loggedIn,\r\n            connected: superAPI.connected,\r\n            disconnected: superAPI.disconnected,\r\n            authToken: that.authToken.bind(that),\r\n            get protocolVersion() { return superAPI.protocolVersion; },\r\n        };\r\n    };\r\n    GW3ConnectionImpl.prototype.domain = function (domain, logger, successMessages, errorMessages) {\r\n        return this.gw3Protocol.domain(domain, logger, successMessages, errorMessages);\r\n    };\r\n    GW3ConnectionImpl.prototype.authToken = function () {\r\n        return this.gw3Protocol.authToken();\r\n    };\r\n    return GW3ConnectionImpl;\r\n}(connection_1.default));\r\nexports.default = GW3ConnectionImpl;\r\n//# sourceMappingURL=gw3Connection.js.map\n\n/***/ }),\n/* 57 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar connection_1 = __webpack_require__(13);\r\nvar gw3_1 = __webpack_require__(60);\r\nvar hc_1 = __webpack_require__(62);\r\nvar ws_1 = __webpack_require__(65);\r\nvar gw3Connection_1 = __webpack_require__(56);\r\nvar gw1_1 = __webpack_require__(59);\r\nvar hc_2 = __webpack_require__(63);\r\nvar inproc_1 = __webpack_require__(64);\r\nexports.default = (function (settings) {\r\n    settings = settings || {};\r\n    settings.reconnectAttempts = settings.reconnectAttempts || 10;\r\n    settings.reconnectInterval = settings.reconnectInterval || 500;\r\n    var connection = new connection_1.default(settings);\r\n    var logger = settings.logger;\r\n    if (!logger) {\r\n        throw new Error(\"please pass a logger object\");\r\n    }\r\n    var protocol = new hc_1.default();\r\n    var transport = new hc_2.default();\r\n    var outsideHC = settings.gdVersion !== 2 || settings.force;\r\n    if (outsideHC) {\r\n        if (settings.gw && settings.gw.facade && settings.gw.token && settings.protocolVersion === 3) {\r\n            transport = new inproc_1.default(settings.gw.token, settings.gw.facade, logger.subLogger(\"inproc\"));\r\n        }\r\n        else if (settings.ws !== undefined) {\r\n            transport = new ws_1.default(settings, logger.subLogger(\"ws\"));\r\n        }\r\n        else {\r\n            throw new Error(\"No connection information specified\");\r\n        }\r\n        if (settings.protocolVersion === 3) {\r\n            var gw3Connection = new gw3Connection_1.default(settings);\r\n            var gw3Port = gw3_1.default(gw3Connection, settings, logger.subLogger(\"gw3\"));\r\n            gw3Connection.init(transport, gw3Port);\r\n            return gw3Connection.toAPI();\r\n        }\r\n        else {\r\n            protocol = new gw1_1.default(connection, settings);\r\n        }\r\n    }\r\n    connection.init(transport, protocol);\r\n    return connection.toAPI();\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 58 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar MessageReplayerImpl = (function () {\r\n    function MessageReplayerImpl(specs) {\r\n        this.specsNames = [];\r\n        this.messages = {};\r\n        this.subs = {};\r\n        this.subsRefCount = {};\r\n        this.specs = {};\r\n        for (var _i = 0, specs_1 = specs; _i < specs_1.length; _i++) {\r\n            var spec = specs_1[_i];\r\n            this.specs[spec.name] = spec;\r\n            this.specsNames.push(spec.name);\r\n        }\r\n    }\r\n    MessageReplayerImpl.prototype.init = function (connection) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var _loop_1 = function (type) {\r\n                var refCount = this_1.subsRefCount[type];\r\n                if (!refCount) {\r\n                    refCount = 0;\r\n                }\r\n                refCount += 1;\r\n                this_1.subsRefCount[type] = refCount;\r\n                if (refCount > 1) {\r\n                    return \"continue\";\r\n                }\r\n                var sub = connection.on(\"glue-core\", type, function (msg) { return _this.processMessage(type, msg); });\r\n                this_1.subs[type] = sub;\r\n            };\r\n            var this_1 = this;\r\n            for (var _b = 0, _c = this.specs[name_1].types; _b < _c.length; _b++) {\r\n                var type = _c[_b];\r\n                _loop_1(type);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.processMessage = function (type, msg) {\r\n        if (this.isDone || !msg) {\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_2 = _a[_i];\r\n            if (this.specs[name_2].types.indexOf(type) !== -1) {\r\n                var messages = this.messages[name_2] || [];\r\n                this.messages[name_2] = messages;\r\n                messages.push(msg);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.drain = function (name, callback) {\r\n        if (callback) {\r\n            (this.messages[name] || []).forEach(callback);\r\n        }\r\n        delete this.messages[name];\r\n        for (var _i = 0, _a = this.specs[name].types; _i < _a.length; _i++) {\r\n            var type = _a[_i];\r\n            this.subsRefCount[type] -= 1;\r\n            if (this.subsRefCount[type] <= 0) {\r\n                this.connection.off(this.subs[type]);\r\n                delete this.subs[type];\r\n                delete this.subsRefCount[type];\r\n            }\r\n        }\r\n        delete this.specs[name];\r\n        if (!this.specs.length) {\r\n            this.isDone = true;\r\n        }\r\n    };\r\n    return MessageReplayerImpl;\r\n}());\r\nexports.MessageReplayerImpl = MessageReplayerImpl;\r\n//# sourceMappingURL=messageReplayer.js.map\n\n/***/ }),\n/* 59 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar GW1Protocol = (function () {\r\n    function GW1Protocol(connection, settings) {\r\n        this._connection = connection;\r\n        this._settings = settings;\r\n    }\r\n    GW1Protocol.prototype.processStringMessage = function (message) {\r\n        var messageObj = JSON.parse(message);\r\n        return {\r\n            msg: messageObj.message,\r\n            msgType: messageObj.type,\r\n        };\r\n    };\r\n    GW1Protocol.prototype.createStringMessage = function (product, type, message, id) {\r\n        return JSON.stringify({\r\n            type: type,\r\n            message: message,\r\n            id: id,\r\n        });\r\n    };\r\n    GW1Protocol.prototype.login = function (message) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var sendOptions = {\r\n                retryInterval: _this._settings.reconnectInterval,\r\n                maxRetries: _this._settings.reconnectAttempts\r\n            };\r\n            _this._connection.send(\"hello\", \"hello\", {}, null, sendOptions)\r\n                .then(function () { return resolve({ application: undefined }); })\r\n                .catch(reject);\r\n        });\r\n    };\r\n    GW1Protocol.prototype.logout = function () {\r\n    };\r\n    GW1Protocol.prototype.loggedIn = function (callback) {\r\n        callback();\r\n        return function () {\r\n        };\r\n    };\r\n    GW1Protocol.prototype.processObjectMessage = function (message) {\r\n        throw new Error(\"not supported\");\r\n    };\r\n    GW1Protocol.prototype.createObjectMessage = function (product, type, message, id) {\r\n        throw new Error(\"not supported\");\r\n    };\r\n    return GW1Protocol;\r\n}());\r\nexports.default = GW1Protocol;\r\n//# sourceMappingURL=gw1.js.map\n\n/***/ }),\n/* 60 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gw3Domain_1 = __webpack_require__(61);\r\nvar callback_registry_1 = __webpack_require__(1);\r\nfunction default_1(connection, settings, logger) {\r\n    var datePrefix = \"#T42_DATE#\";\r\n    var datePrefixLen = datePrefix.length;\r\n    var dateMinLen = datePrefixLen + 1;\r\n    var datePrefixFirstChar = datePrefix[0];\r\n    var registry = callback_registry_1.default();\r\n    var globalDomain;\r\n    var isLoggedIn = false;\r\n    var shouldTryLogin = true;\r\n    var initialLogin = true;\r\n    var initialLoginAttempts = 3;\r\n    var initialLoginAttemptsInterval = 500;\r\n    var pingTimer;\r\n    var sessions = [];\r\n    var loginConfig;\r\n    connection.disconnected(handleDisconnected.bind(this));\r\n    ping();\r\n    function processStringMessage(message) {\r\n        var msg = JSON.parse(message, function (key, value) {\r\n            if (typeof value !== \"string\") {\r\n                return value;\r\n            }\r\n            if (value.length < dateMinLen) {\r\n                return value;\r\n            }\r\n            if (value[0] !== datePrefixFirstChar) {\r\n                return value;\r\n            }\r\n            if (value.substring(0, datePrefixLen) !== datePrefix) {\r\n                return value;\r\n            }\r\n            try {\r\n                var milliseconds = parseInt(value.substring(datePrefixLen, value.length), 10);\r\n                if (isNaN(milliseconds)) {\r\n                    return value;\r\n                }\r\n                return new Date(milliseconds);\r\n            }\r\n            catch (ex) {\r\n                return value;\r\n            }\r\n        });\r\n        return {\r\n            msg: msg,\r\n            msgType: msg.type,\r\n        };\r\n    }\r\n    function createStringMessage(product, type, message, id) {\r\n        var oldToJson = Date.prototype.toJSON;\r\n        try {\r\n            Date.prototype.toJSON = function () {\r\n                return datePrefix + this.getTime();\r\n            };\r\n            var result = JSON.stringify(message);\r\n            return result;\r\n        }\r\n        finally {\r\n            Date.prototype.toJSON = oldToJson;\r\n        }\r\n    }\r\n    function processObjectMessage(message) {\r\n        if (!message.type) {\r\n            throw new Error(\"Object should have type property\");\r\n        }\r\n        return {\r\n            msg: message,\r\n            msgType: message.type,\r\n        };\r\n    }\r\n    function createObjectMessage(product, type, message, id) {\r\n        return message;\r\n    }\r\n    function login(config) {\r\n        logger.debug(\"logging in...\");\r\n        loginConfig = config;\r\n        if (!loginConfig) {\r\n            loginConfig = { username: \"\", password: \"\" };\r\n        }\r\n        shouldTryLogin = true;\r\n        return new Promise(function (resolve, reject) {\r\n            var authentication = {};\r\n            connection.gatewayToken = config.gatewayToken;\r\n            if (connection.gatewayToken) {\r\n                authentication.method = \"gateway-token\";\r\n                authentication.token = connection.gatewayToken;\r\n            }\r\n            else if (config.token) {\r\n                authentication.method = \"access-token\";\r\n                authentication.token = config.token;\r\n            }\r\n            else if (config.username) {\r\n                authentication.method = \"secret\";\r\n                authentication.login = config.username;\r\n                authentication.secret = config.password;\r\n            }\r\n            else {\r\n                throw new Error(\"invalid auth message\" + JSON.stringify(config));\r\n            }\r\n            var helloMsg = {\r\n                type: \"hello\",\r\n                identity: settings.identity,\r\n                authentication: authentication,\r\n            };\r\n            globalDomain = gw3Domain_1.default(\"global\", connection, logger, [\r\n                \"welcome\",\r\n                \"token\"\r\n            ]);\r\n            var sendOptions = { skipPeerId: true };\r\n            if (initialLogin) {\r\n                sendOptions.retryInterval = settings.reconnectInterval;\r\n                sendOptions.maxRetries = settings.reconnectAttempts;\r\n            }\r\n            globalDomain.send(helloMsg, undefined, sendOptions)\r\n                .then(function (msg) {\r\n                initialLogin = false;\r\n                logger.debug(\"login successful with PeerId \" + msg.peer_id);\r\n                connection.peerId = msg.peer_id;\r\n                connection.resolvedIdentity = msg.resolved_identity;\r\n                connection.availableDomains = msg.available_domains;\r\n                if (msg.options) {\r\n                    connection.token = msg.options.access_token;\r\n                    connection.info = msg.options.info;\r\n                }\r\n                setLoggedIn(true);\r\n                resolve(msg.resolved_identity);\r\n            })\r\n                .catch(function (err) {\r\n                logger.error(\"error sending hello message - \" + err);\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n    function logout() {\r\n        logger.debug(\"logging out...\");\r\n        shouldTryLogin = false;\r\n        if (pingTimer) {\r\n            clearTimeout(pingTimer);\r\n        }\r\n        sessions.forEach(function (session) {\r\n            session.leave();\r\n        });\r\n    }\r\n    function loggedIn(callback) {\r\n        if (isLoggedIn) {\r\n            callback();\r\n        }\r\n        return registry.add(\"onLoggedIn\", callback);\r\n    }\r\n    function domain(domainName, domainLogger, successMessages, errorMessages) {\r\n        var session = sessions.filter(function (s) { return s.domain === domainName; })[0];\r\n        if (!session) {\r\n            session = gw3Domain_1.default(domainName, connection, domainLogger, successMessages, errorMessages);\r\n            sessions.push(session);\r\n        }\r\n        return session;\r\n    }\r\n    function handleDisconnected() {\r\n        setLoggedIn(false);\r\n        var tryToLogin = shouldTryLogin;\r\n        if (tryToLogin && initialLogin) {\r\n            if (initialLoginAttempts <= 0) {\r\n                return;\r\n            }\r\n            initialLoginAttempts--;\r\n        }\r\n        logger.debug(\"disconnected - will try new login?\" + shouldTryLogin);\r\n        if (shouldTryLogin) {\r\n            connection.login(loginConfig)\r\n                .catch(function () {\r\n                setTimeout(handleDisconnected, 1000);\r\n            });\r\n        }\r\n    }\r\n    function setLoggedIn(value) {\r\n        isLoggedIn = value;\r\n        if (isLoggedIn) {\r\n            registry.execute(\"onLoggedIn\");\r\n        }\r\n    }\r\n    function ping() {\r\n        if (!shouldTryLogin) {\r\n            return;\r\n        }\r\n        if (isLoggedIn) {\r\n            connection.send(\"\", \"\", { type: \"ping\" });\r\n        }\r\n        pingTimer = setTimeout(ping, 30 * 1000);\r\n    }\r\n    function authToken() {\r\n        var createTokenReq = {\r\n            type: \"create-token\"\r\n        };\r\n        return globalDomain.send(createTokenReq)\r\n            .then(function (res) {\r\n            return res.token;\r\n        });\r\n    }\r\n    return {\r\n        processStringMessage: processStringMessage,\r\n        createStringMessage: createStringMessage,\r\n        createObjectMessage: createObjectMessage,\r\n        processObjectMessage: processObjectMessage,\r\n        login: login,\r\n        logout: logout,\r\n        loggedIn: loggedIn,\r\n        domain: domain,\r\n        authToken: authToken,\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=gw3.js.map\n\n/***/ }),\n/* 61 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callbackRegistry = __webpack_require__(1);\r\nvar shortid_1 = __webpack_require__(6);\r\nfunction default_1(domain, connection, logger, successMessages, errorMessages) {\r\n    if (domain == null) {\r\n        domain = \"global\";\r\n    }\r\n    var isJoined = false;\r\n    var tryReconnecting = false;\r\n    var _latestOptions;\r\n    var _connectionOn = false;\r\n    var callbacks = callbackRegistry();\r\n    connection.disconnected(handleConnectionDisconnected);\r\n    connection.loggedIn(handleConnectionLoggedIn);\r\n    connection.on(domain, \"success\", function (msg) { return handleSuccessMessage(msg); });\r\n    connection.on(domain, \"error\", function (msg) { return handleErrorMessage(msg); });\r\n    connection.on(domain, \"result\", function (msg) { return handleSuccessMessage(msg); });\r\n    if (successMessages) {\r\n        successMessages.forEach(function (sm) {\r\n            connection.on(domain, sm, function (msg) { return handleSuccessMessage(msg); });\r\n        });\r\n    }\r\n    if (errorMessages) {\r\n        errorMessages.forEach(function (sm) {\r\n            connection.on(domain, sm, function (msg) { return handleErrorMessage(msg); });\r\n        });\r\n    }\r\n    var requestsMap = {};\r\n    function join(options) {\r\n        _latestOptions = options;\r\n        return new Promise(function (resolve, reject) {\r\n            if (isJoined) {\r\n                resolve();\r\n                return;\r\n            }\r\n            var joinPromise;\r\n            if (domain === \"global\") {\r\n                joinPromise = _connectionOn ? Promise.resolve({}) : Promise.reject(\"not connected to gateway\");\r\n            }\r\n            else {\r\n                logger.debug(\"joining \" + domain);\r\n                var joinMsg = {\r\n                    type: \"join\",\r\n                    destination: domain,\r\n                    domain: \"global\",\r\n                    options: options,\r\n                };\r\n                joinPromise = send(joinMsg);\r\n            }\r\n            joinPromise\r\n                .then(function () {\r\n                handleJoined();\r\n                resolve();\r\n            })\r\n                .catch(function (err) {\r\n                logger.debug(\"error joining \" + domain + \" domain: \" + JSON.stringify(err));\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n    function leave() {\r\n        if (domain === \"global\") {\r\n            return;\r\n        }\r\n        logger.debug(\"stopping session \" + domain + \"...\");\r\n        var leaveMsg = {\r\n            type: \"leave\",\r\n            destination: domain,\r\n            domain: \"global\",\r\n        };\r\n        send(leaveMsg).then(function () {\r\n            isJoined = false;\r\n            callbacks.execute(\"onLeft\");\r\n        });\r\n    }\r\n    function handleJoined() {\r\n        logger.debug(\"did join \" + domain);\r\n        isJoined = true;\r\n        var wasReconnect = tryReconnecting;\r\n        tryReconnecting = false;\r\n        callbacks.execute(\"onJoined\", wasReconnect);\r\n    }\r\n    function handleConnectionDisconnected() {\r\n        _connectionOn = false;\r\n        logger.warn(\"connection is down\");\r\n        isJoined = false;\r\n        tryReconnecting = true;\r\n        callbacks.execute(\"onLeft\", { disconnected: true });\r\n    }\r\n    function handleConnectionLoggedIn() {\r\n        _connectionOn = true;\r\n        if (tryReconnecting) {\r\n            logger.info(\"connection is now up - trying to reconnect...\");\r\n            join(_latestOptions);\r\n        }\r\n    }\r\n    function onJoined(callback) {\r\n        if (isJoined) {\r\n            callback(false);\r\n        }\r\n        return callbacks.add(\"onJoined\", callback);\r\n    }\r\n    function onLeft(callback) {\r\n        if (!isJoined) {\r\n            callback();\r\n        }\r\n        return callbacks.add(\"onLeft\", callback);\r\n    }\r\n    function handleErrorMessage(msg) {\r\n        if (domain !== msg.domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.error(msg);\r\n    }\r\n    function handleSuccessMessage(msg) {\r\n        if (msg.domain !== domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.success(msg);\r\n    }\r\n    function getNextRequestId() {\r\n        return shortid_1.generate();\r\n    }\r\n    function send(msg, tag, options) {\r\n        options = options || {};\r\n        msg.request_id = msg.request_id || getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        if (!options.skipPeerId) {\r\n            msg.peer_id = connection.peerId;\r\n        }\r\n        var requestId = msg.request_id;\r\n        return new Promise(function (resolve, reject) {\r\n            requestsMap[requestId] = {\r\n                success: function (successMsg) {\r\n                    delete requestsMap[requestId];\r\n                    successMsg._tag = tag;\r\n                    resolve(successMsg);\r\n                },\r\n                error: function (errorMsg) {\r\n                    logger.warn(\"GW error - \" + JSON.stringify(errorMsg) + \" for request \" + JSON.stringify(msg));\r\n                    delete requestsMap[requestId];\r\n                    errorMsg._tag = tag;\r\n                    reject(errorMsg);\r\n                },\r\n            };\r\n            connection\r\n                .send(domain, domain, msg, undefined, options)\r\n                .catch(function (err) {\r\n                requestsMap[requestId].error({ err: err });\r\n            });\r\n        });\r\n    }\r\n    function sendFireAndForget(msg) {\r\n        msg.request_id = msg.request_id ? msg.request_id : getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        msg.peer_id = connection.peerId;\r\n        connection.send(domain, domain, msg);\r\n    }\r\n    return {\r\n        join: join,\r\n        leave: leave,\r\n        onJoined: onJoined,\r\n        onLeft: onLeft,\r\n        send: send,\r\n        sendFireAndForget: sendFireAndForget,\r\n        on: function (type, callback) {\r\n            connection.on(domain, type, function (msg) {\r\n                if (msg.domain !== domain) {\r\n                    return;\r\n                }\r\n                try {\r\n                    callback(msg);\r\n                }\r\n                catch (e) {\r\n                    logger.error(\"Callback  failed: \" + e + \" \\n msg was: \" + JSON.stringify(msg));\r\n                }\r\n            });\r\n        },\r\n        loggedIn: function (callback) { return connection.loggedIn(callback); },\r\n        connected: function (callback) { return connection.connected(callback); },\r\n        disconnected: function (callback) { return connection.disconnected(callback); },\r\n        get peerId() {\r\n            return connection.peerId;\r\n        },\r\n        get domain() {\r\n            return domain;\r\n        },\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=gw3Domain.js.map\n\n/***/ }),\n/* 62 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar HCProtocol = (function () {\r\n    function HCProtocol() {\r\n    }\r\n    HCProtocol.prototype.processStringMessage = function (message) {\r\n        var messageObj = JSON.parse(message);\r\n        return {\r\n            msg: messageObj,\r\n            msgType: messageObj.type,\r\n        };\r\n    };\r\n    HCProtocol.prototype.createStringMessage = function (product, type, message, id) {\r\n        return JSON.stringify(message);\r\n    };\r\n    HCProtocol.prototype.login = function (message) {\r\n        return Promise.resolve({ application: undefined });\r\n    };\r\n    HCProtocol.prototype.logout = function () {\r\n    };\r\n    HCProtocol.prototype.loggedIn = function (callback) {\r\n        callback();\r\n        return function () {\r\n        };\r\n    };\r\n    HCProtocol.prototype.processObjectMessage = function (message) {\r\n        throw new Error(\"not supported\");\r\n    };\r\n    HCProtocol.prototype.createObjectMessage = function (product, type, message, id) {\r\n        throw new Error(\"not supported\");\r\n    };\r\n    return HCProtocol;\r\n}());\r\nexports.default = HCProtocol;\r\n//# sourceMappingURL=hc.js.map\n\n/***/ }),\n/* 63 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar HCTransport = (function () {\r\n    function HCTransport() {\r\n        this.connectionId = Math.floor(1e10 * Math.random()).toString();\r\n    }\r\n    HCTransport.prototype.send = function (message, product, type) {\r\n        if (product === \"metrics\") {\r\n            window.htmlContainer.metricsFacade.send(type, message);\r\n        }\r\n        else if (product === \"log\") {\r\n            window.htmlContainer.loggingFacade.send(type, message);\r\n        }\r\n        return Promise.resolve(undefined);\r\n    };\r\n    HCTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    HCTransport.prototype.onMessage = function (callback) {\r\n    };\r\n    HCTransport.prototype.close = function () {\r\n    };\r\n    HCTransport.prototype.open = function () {\r\n    };\r\n    return HCTransport;\r\n}());\r\nexports.default = HCTransport;\r\n//# sourceMappingURL=hc.js.map\n\n/***/ }),\n/* 64 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar Inproc = (function () {\r\n    function Inproc(token, gw, logger) {\r\n        this.registry = callback_registry_1.default();\r\n        this.gw = gw;\r\n        this.gwToken = token;\r\n        this.logger = logger;\r\n        this.connectToken = this.gw.connect(this.gwToken, this.messageHandler.bind(this));\r\n    }\r\n    Object.defineProperty(Inproc.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Inproc.prototype.sendObject = function (msg) {\r\n        this.logger.debug(JSON.stringify(msg));\r\n        this.gw.send(this.connectToken, msg);\r\n        return Promise.resolve(undefined);\r\n    };\r\n    Inproc.prototype.send = function (msg, product, type) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    Inproc.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    Inproc.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    Inproc.prototype.close = function () {\r\n    };\r\n    Inproc.prototype.open = function () {\r\n    };\r\n    Inproc.prototype.messageHandler = function (msg) {\r\n        if (this.logger.consoleLevel() === \"trace\") {\r\n            this.logger.debug(JSON.stringify(msg));\r\n        }\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return Inproc;\r\n}());\r\nexports.default = Inproc;\r\n//# sourceMappingURL=inproc.js.map\n\n/***/ }),\n/* 65 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar utils_1 = __webpack_require__(11);\r\nvar WebSocket = utils_1.default.isNode() ? __webpack_require__(26) : window.WebSocket;\r\nvar WS = (function () {\r\n    function WS(settings, logger) {\r\n        this._running = true;\r\n        this._initied = false;\r\n        this._registry = callback_registry_1.default();\r\n        this._settings = settings;\r\n        this._logger = logger;\r\n    }\r\n    WS.prototype.onMessage = function (callback) {\r\n        return this._registry.add(\"onMessage\", callback);\r\n    };\r\n    WS.prototype.send = function (msg, product, type, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            options = options || {};\r\n            _this.waitForSocketConnection(function () {\r\n                try {\r\n                    _this._ws.send(msg);\r\n                    resolve();\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }, reject, options.maxRetries, options.retryInterval);\r\n        });\r\n    };\r\n    WS.prototype.open = function () {\r\n        this._running = true;\r\n    };\r\n    WS.prototype.close = function () {\r\n        this._running = false;\r\n        this._ws.close();\r\n    };\r\n    WS.prototype.onConnectedChanged = function (callback) {\r\n        return this._registry.add(\"onConnectedChanged\", callback);\r\n    };\r\n    WS.prototype.initiateSocket = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"initiating _ws to \" + this._settings.ws + \"...\");\r\n        this._ws = new WebSocket(this._settings.ws);\r\n        this._ws.onerror = function (err) {\r\n            _this.notifyStatusChanged(false, err);\r\n        };\r\n        this._ws.onclose = function () {\r\n            _this._logger.debug(\"_ws closed\");\r\n            _this.notifyStatusChanged(false);\r\n        };\r\n        this._ws.onopen = function () {\r\n            _this._logger.debug(\"_ws opened\");\r\n            _this.notifyStatusChanged(true);\r\n        };\r\n        this._ws.onmessage = function (message) {\r\n            _this._registry.execute(\"onMessage\", message.data);\r\n        };\r\n    };\r\n    WS.prototype.waitForSocketConnection = function (callback, failed, retriesLeft, retryInterval) {\r\n        var _this = this;\r\n        if (!callback) {\r\n            callback = function () { };\r\n        }\r\n        if (!failed) {\r\n            failed = function () { };\r\n        }\r\n        if (retryInterval === undefined) {\r\n            retryInterval = this._settings.reconnectInterval;\r\n        }\r\n        if (retriesLeft !== undefined) {\r\n            if (retriesLeft === 0) {\r\n                failed(\"wait for socket on \" + this._settings.ws + \" failed - no more retries left\");\r\n                return;\r\n            }\r\n            this._logger.debug(\"will retry \" + retriesLeft + \" more times (every \" + retryInterval + \" ms)\");\r\n        }\r\n        if (!this._running) {\r\n            failed(\"wait for socket on \" + this._settings.ws + \" failed - socket closed by user\");\r\n            return;\r\n        }\r\n        if (!this._ws || this._ws.readyState > 1) {\r\n            this.initiateSocket();\r\n        }\r\n        else if (this._ws.readyState === 1) {\r\n            return callback();\r\n        }\r\n        setTimeout(function () {\r\n            var retries = retriesLeft === undefined ? undefined : retriesLeft - 1;\r\n            _this.waitForSocketConnection(callback, failed, retries, retryInterval);\r\n        }, retryInterval);\r\n    };\r\n    WS.prototype.notifyStatusChanged = function (status, reason) {\r\n        this._registry.execute(\"onConnectedChanged\", status, reason);\r\n    };\r\n    return WS;\r\n}());\r\nexports.default = WS;\r\n//# sourceMappingURL=ws.js.map\n\n/***/ }),\n/* 66 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gw3ContextData_1 = __webpack_require__(67);\r\nvar helpers_1 = __webpack_require__(70);\r\nvar msg = __webpack_require__(14);\r\nvar contextMessageReplaySpec_1 = __webpack_require__(10);\r\nvar GW3Bridge = (function () {\r\n    function GW3Bridge(config) {\r\n        var _this = this;\r\n        this._contextNameToData = {};\r\n        this._gw3Subscriptions = [];\r\n        this._nextCallbackSubscriptionNumber = 0;\r\n        this._contextNameToId = {};\r\n        this._contextIdToName = {};\r\n        this._connection = config.connection;\r\n        this._logger = config.logger;\r\n        this._gw3Session = this._connection.domain(\"global\", this._logger, [\r\n            msg.GW_MESSAGE_CONTEXT_CREATED,\r\n            msg.GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            msg.GW_MESSAGE_CONTEXT_DESTROYED,\r\n            msg.GW_MESSAGE_CONTEXT_UPDATED,\r\n        ]);\r\n        this.subscribeToContextCreatedMessages();\r\n        this.subscribeToContextUpdatedMessages();\r\n        this.subscribeToContextDestroyedMessages();\r\n        this._connection.replayer.drain(contextMessageReplaySpec_1.ContextMessageReplaySpec.name, function (message) {\r\n            var type = message.type;\r\n            if (!type) {\r\n                return;\r\n            }\r\n            if (type === msg.GW_MESSAGE_CONTEXT_CREATED ||\r\n                type === msg.GW_MESSAGE_CONTEXT_ADDED ||\r\n                type === msg.GW_MESSAGE_ACTIVITY_CREATED) {\r\n                _this.handleContextCreatedMessage(message);\r\n            }\r\n            else if (type === msg.GW_MESSAGE_SUBSCRIBED_CONTEXT ||\r\n                type === msg.GW_MESSAGE_CONTEXT_UPDATED ||\r\n                type === msg.GW_MESSAGE_JOINED_ACTIVITY) {\r\n                _this.handleContextUpdatedMessage(message);\r\n            }\r\n            else if (type === msg.GW_MESSAGE_CONTEXT_DESTROYED ||\r\n                type === msg.GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n                _this.handleContextDestroyedMessage(message);\r\n            }\r\n        });\r\n    }\r\n    GW3Bridge.prototype.dispose = function () {\r\n        for (var _i = 0, _a = this._gw3Subscriptions; _i < _a.length; _i++) {\r\n            var sub = _a[_i];\r\n            this._connection.off(sub);\r\n        }\r\n        this._gw3Subscriptions.length = 0;\r\n        for (var contextName in this._contextNameToData) {\r\n            if (this._contextNameToId.hasOwnProperty(contextName)) {\r\n                delete this._contextNameToData[contextName];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.createContext = function (name, data) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: msg.GW_MESSAGE_CREATE_CONTEXT,\r\n            domain: \"global\",\r\n            name: name,\r\n            data: data,\r\n            lifetime: \"retained\",\r\n        })\r\n            .then(function (createContextMsg) {\r\n            _this._contextNameToId[name] = createContextMsg.context_id;\r\n            if (!_this._contextIdToName[createContextMsg.context_id]) {\r\n                _this._contextIdToName[createContextMsg.context_id] = name;\r\n                var contextData = _this._contextNameToData[name] || new gw3ContextData_1.GW3ContextData(createContextMsg.context_id, name, true, null);\r\n                contextData.isAnnounced = true;\r\n                contextData.name = name;\r\n                contextData.contextId = createContextMsg.context_id;\r\n                _this._contextNameToData[name] = contextData;\r\n                contextData.context = createContextMsg.data;\r\n                contextData.sentExplicitSubscription = true;\r\n                if (contextData.context) {\r\n                    _this.invokeUpdateCallbacks(contextData, contextData.context, null);\r\n                }\r\n                return _this.update(name, data).then(function () { return createContextMsg.context_id; });\r\n            }\r\n            return createContextMsg.context_id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.all = function () {\r\n        var _this = this;\r\n        return Object.keys(this._contextNameToData)\r\n            .filter(function (name) { return _this._contextNameToData[name].isAnnounced; });\r\n    };\r\n    GW3Bridge.prototype.update = function (name, delta) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return this.createContext(name, delta);\r\n        }\r\n        var calculatedDelta = this.calculateContextDelta(contextData.context, delta);\r\n        if (!Object.keys(calculatedDelta.added).length\r\n            && !Object.keys(calculatedDelta.updated).length\r\n            && !calculatedDelta.removed.length) {\r\n            return Promise.resolve();\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: msg.GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: calculatedDelta,\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, calculatedDelta, {\r\n                updaterId: gwResponse.peer_id\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.set = function (name, data) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return this.createContext(name, data);\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: msg.GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { reset: data },\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { reset: data, added: {}, removed: [], updated: {} }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.get = function (name) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\r\n                var _this = this;\r\n                return __generator(this, function (_a) {\r\n                    this.subscribe(name, function (data, delta, removed, un) {\r\n                        _this.unsubscribe(un);\r\n                        resolve(data);\r\n                    });\r\n                    return [2];\r\n                });\r\n            }); });\r\n        }\r\n        else {\r\n            return Promise.resolve(contextData.context);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (name, callback) {\r\n        var thisCallbackSubscriptionNumber = this._nextCallbackSubscriptionNumber;\r\n        this._nextCallbackSubscriptionNumber += 1;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData ||\r\n            !contextData.isAnnounced) {\r\n            contextData = contextData || new gw3ContextData_1.GW3ContextData(undefined, name, false, undefined);\r\n            this._contextNameToData[name] = contextData;\r\n            contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n        var hadCallbacks = contextData.hasCallbacks();\r\n        contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n        if (!hadCallbacks) {\r\n            if (!contextData.joinedActivity) {\r\n                if (contextData.context &&\r\n                    contextData.sentExplicitSubscription) {\r\n                    callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n                    return Promise.resolve(thisCallbackSubscriptionNumber);\r\n                }\r\n                return this.sendSubscribe(contextData)\r\n                    .then(function () { return thisCallbackSubscriptionNumber; });\r\n            }\r\n            else {\r\n                callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n                return Promise.resolve(thisCallbackSubscriptionNumber);\r\n            }\r\n        }\r\n        else {\r\n            callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.unsubscribe = function (subscriptionKey) {\r\n        for (var _i = 0, _a = Object.keys(this._contextNameToData); _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var contextId = this._contextNameToId[name_1];\r\n            var contextData = this._contextNameToData[name_1];\r\n            if (!contextData) {\r\n                return;\r\n            }\r\n            var hadCallbacks = contextData.hasCallbacks();\r\n            delete contextData.updateCallbacks[subscriptionKey];\r\n            if (contextData.isAnnounced &&\r\n                hadCallbacks &&\r\n                !contextData.hasCallbacks() &&\r\n                contextData.sentExplicitSubscription) {\r\n                this.sendUnsubscribe(contextData);\r\n            }\r\n            if (!contextData.isAnnounced &&\r\n                !contextData.hasCallbacks()) {\r\n                delete this._contextNameToData[name_1];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleUpdated = function (contextData, delta, extraData) {\r\n        var oldContext = contextData.context;\r\n        contextData.context = helpers_1.applyContextDelta(contextData.context, delta);\r\n        if (this._contextNameToData[contextData.name] === contextData &&\r\n            !helpers_1.deepEqual(oldContext, contextData.context)) {\r\n            this.invokeUpdateCallbacks(contextData, contextData.context, delta, extraData);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextCreatedMessages = function () {\r\n        var createdMessageTypes = [\r\n            msg.GW_MESSAGE_CONTEXT_ADDED,\r\n            msg.GW_MESSAGE_CONTEXT_CREATED,\r\n            msg.GW_MESSAGE_ACTIVITY_CREATED,\r\n        ];\r\n        for (var _i = 0, createdMessageTypes_1 = createdMessageTypes; _i < createdMessageTypes_1.length; _i++) {\r\n            var createdMessageType = createdMessageTypes_1[_i];\r\n            var sub = this._connection.on(\"js-contexts\", createdMessageType, this.handleContextCreatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextCreatedMessage = function (contextCreatedMsg) {\r\n        var createdMessageType = contextCreatedMsg.type;\r\n        if (createdMessageType === msg.GW_MESSAGE_ACTIVITY_CREATED) {\r\n            this._contextNameToId[contextCreatedMsg.activity_id] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.activity_id;\r\n        }\r\n        else if (createdMessageType === msg.GW_MESSAGE_CONTEXT_ADDED) {\r\n            this._contextNameToId[contextCreatedMsg.name] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.name;\r\n        }\r\n        else if (createdMessageType === msg.GW_MESSAGE_CONTEXT_CREATED) {\r\n        }\r\n        var name = this._contextIdToName[contextCreatedMsg.context_id];\r\n        if (!name) {\r\n            throw new Error(\"Received created event for context with unknown name: \" + contextCreatedMsg.context_id);\r\n        }\r\n        if (!this._contextNameToId[name]) {\r\n            throw new Error(\"Received created event for context with unknown id: \" + contextCreatedMsg.context_id);\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (contextData) {\r\n            if (contextData.isAnnounced) {\r\n                return;\r\n            }\r\n            else {\r\n                if (!contextData.hasCallbacks()) {\r\n                    throw new Error(\"Assertion failure: contextData.hasCallbacks()\");\r\n                }\r\n                contextData.isAnnounced = true;\r\n                contextData.contextId = contextCreatedMsg.context_id;\r\n                contextData.activityId = contextCreatedMsg.activity_id;\r\n                if (!contextData.sentExplicitSubscription) {\r\n                    this.sendSubscribe(contextData);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._contextNameToData[name] = contextData =\r\n                new gw3ContextData_1.GW3ContextData(contextCreatedMsg.context_id, name, true, contextCreatedMsg.activity_id);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextUpdatedMessages = function () {\r\n        var updatedMessageTypes = [\r\n            msg.GW_MESSAGE_CONTEXT_UPDATED,\r\n            msg.GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            msg.GW_MESSAGE_JOINED_ACTIVITY,\r\n        ];\r\n        for (var _i = 0, updatedMessageTypes_1 = updatedMessageTypes; _i < updatedMessageTypes_1.length; _i++) {\r\n            var updatedMessageType = updatedMessageTypes_1[_i];\r\n            var sub = this._connection.on(\"js-contexts\", updatedMessageType, this.handleContextUpdatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextUpdatedMessage = function (contextUpdatedMsg) {\r\n        var updatedMessageType = contextUpdatedMsg.type;\r\n        var contextId = contextUpdatedMsg.context_id;\r\n        var contextData = this._contextNameToData[this._contextIdToName[contextId]];\r\n        var justSeen = !contextData || !contextData.isAnnounced;\r\n        if (updatedMessageType === msg.GW_MESSAGE_JOINED_ACTIVITY) {\r\n            if (!contextData) {\r\n                contextData = new gw3ContextData_1.GW3ContextData(contextId, contextUpdatedMsg.activity_id, true, contextUpdatedMsg.activity_id);\r\n                this._contextNameToData[contextUpdatedMsg.activity_id] = contextData;\r\n                this._contextIdToName[contextId] = contextUpdatedMsg.activity_id;\r\n                this._contextNameToId[contextUpdatedMsg.activity_id] = contextId;\r\n            }\r\n            else {\r\n                contextData.contextId = contextId;\r\n                contextData.isAnnounced = true;\r\n                contextData.activityId = contextUpdatedMsg.activity_id;\r\n            }\r\n            contextData.joinedActivity = true;\r\n        }\r\n        else {\r\n            if (!contextData || !contextData.isAnnounced) {\r\n                if (updatedMessageType === msg.GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n                    contextData = contextData || new gw3ContextData_1.GW3ContextData(contextId, contextUpdatedMsg.name, true, null);\r\n                    contextData.sentExplicitSubscription = true;\r\n                    this._contextNameToData[contextUpdatedMsg.name] = contextData;\r\n                    this._contextIdToName[contextId] = contextUpdatedMsg.name;\r\n                    this._contextNameToId[contextUpdatedMsg.name] = contextId;\r\n                }\r\n                else {\r\n                    this._logger.error(\"Received 'update' for unknown context: \" + contextId);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        var oldContext = contextData.context;\r\n        if (updatedMessageType === msg.GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            contextData.context = contextUpdatedMsg.data || {};\r\n        }\r\n        else if (updatedMessageType === msg.GW_MESSAGE_JOINED_ACTIVITY) {\r\n            contextData.context = contextUpdatedMsg.context_snapshot || {};\r\n        }\r\n        else if (updatedMessageType === msg.GW_MESSAGE_CONTEXT_UPDATED) {\r\n            contextData.context = helpers_1.applyContextDelta(contextData.context, contextUpdatedMsg.delta);\r\n        }\r\n        else {\r\n            throw new Error(\"Unrecognized context update message \" + updatedMessageType);\r\n        }\r\n        if (justSeen ||\r\n            !helpers_1.deepEqual(contextData.context, oldContext) ||\r\n            updatedMessageType === msg.GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            this.invokeUpdateCallbacks(contextData, contextData.context, null, { updaterId: contextUpdatedMsg.updater_id });\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeUpdateCallbacks = function (contextData, data, delta, extraData) {\r\n        delta = delta || { added: {}, updated: {}, reset: {}, removed: [] };\r\n        for (var updateCallbackIndex in contextData.updateCallbacks) {\r\n            if (contextData.updateCallbacks.hasOwnProperty(updateCallbackIndex)) {\r\n                try {\r\n                    var updateCallback = contextData.updateCallbacks[updateCallbackIndex];\r\n                    updateCallback(helpers_1.deepClone(data), Object.assign({}, delta.added || {}, delta.updated || {}, delta.reset || {}), delta.removed, parseInt(updateCallbackIndex), extraData);\r\n                }\r\n                catch (err) {\r\n                    this._logger.debug(\"Callback error: \" + JSON.stringify(err));\r\n                }\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextDestroyedMessages = function () {\r\n        var destroyedMessageTypes = [\r\n            msg.GW_MESSAGE_CONTEXT_DESTROYED,\r\n            msg.GW_MESSAGE_ACTIVITY_DESTROYED,\r\n        ];\r\n        for (var _i = 0, destroyedMessageTypes_1 = destroyedMessageTypes; _i < destroyedMessageTypes_1.length; _i++) {\r\n            var destroyedMessageType = destroyedMessageTypes_1[_i];\r\n            var sub = this._connection.on(\"js-contexts\", destroyedMessageType, this.handleContextDestroyedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextDestroyedMessage = function (destroyedMsg) {\r\n        var destroyedMessageType = destroyedMsg.type;\r\n        var contextId;\r\n        var name;\r\n        if (destroyedMessageType === msg.GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n            name = destroyedMsg.activity_id;\r\n            contextId = this._contextNameToId[name];\r\n            if (!contextId) {\r\n                this._logger.error(\"Received 'destroyed' for unknown activity: \" + destroyedMsg.activity_id);\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            contextId = destroyedMsg.context_id;\r\n            name = this._contextIdToName[contextId];\r\n            if (!name) {\r\n                this._logger.error(\"Received 'destroyed' for unknown context: \" + destroyedMsg.context_id);\r\n                return;\r\n            }\r\n        }\r\n        delete this._contextIdToName[contextId];\r\n        delete this._contextNameToId[name];\r\n        var contextData = this._contextNameToData[name];\r\n        delete this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            this._logger.error(\"Received 'destroyed' for unknown context: \" + contextId);\r\n            return;\r\n        }\r\n    };\r\n    GW3Bridge.prototype.sendSubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = true;\r\n        return this._gw3Session\r\n            .send({\r\n            type: msg.GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.sendUnsubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = false;\r\n        return this._gw3Session\r\n            .send({\r\n            type: msg.GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.calculateContextDelta = function (from, to) {\r\n        var delta = { added: {}, updated: {}, removed: [], reset: null };\r\n        if (from) {\r\n            for (var _i = 0, _a = Object.keys(from); _i < _a.length; _i++) {\r\n                var x = _a[_i];\r\n                if (Object.keys(to).indexOf(x) !== -1\r\n                    && to[x] !== null\r\n                    && !helpers_1.deepEqual(from[x], to[x])) {\r\n                    delta.updated[x] = to[x];\r\n                }\r\n            }\r\n        }\r\n        for (var _b = 0, _c = Object.keys(to); _b < _c.length; _b++) {\r\n            var x = _c[_b];\r\n            if (!from || (Object.keys(from).indexOf(x) === -1)) {\r\n                if (to[x] !== null) {\r\n                    delta.added[x] = to[x];\r\n                }\r\n            }\r\n            else if (to[x] === null) {\r\n                delta.removed.push(x);\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    return GW3Bridge;\r\n}());\r\nexports.GW3Bridge = GW3Bridge;\r\n//# sourceMappingURL=gw3Bridge.js.map\n\n/***/ }),\n/* 67 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar GW3ContextData = (function () {\r\n    function GW3ContextData(contextId, name, isAnnounced, activityId) {\r\n        this.updateCallbacks = {};\r\n        this.contextId = contextId;\r\n        this.name = name;\r\n        this.isAnnounced = isAnnounced;\r\n        this.activityId = activityId;\r\n        this.context = {};\r\n    }\r\n    GW3ContextData.prototype.hasCallbacks = function () {\r\n        return Object.keys(this.updateCallbacks).length > 0;\r\n    };\r\n    GW3ContextData.prototype.getState = function () {\r\n        if (this.isAnnounced && this.hasCallbacks()) {\r\n            return 3;\r\n        }\r\n        if (this.isAnnounced) {\r\n            return 2;\r\n        }\r\n        if (this.hasCallbacks()) {\r\n            return 1;\r\n        }\r\n        return 0;\r\n    };\r\n    return GW3ContextData;\r\n}());\r\nexports.GW3ContextData = GW3ContextData;\r\n//# sourceMappingURL=gw3ContextData.js.map\n\n/***/ }),\n/* 68 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar HCBridge = (function () {\r\n    function HCBridge(config) {\r\n        this._facade = window.htmlContainer.sharedContextFacade;\r\n    }\r\n    HCBridge.prototype.all = function () {\r\n        var allObj = this._facade.all();\r\n        if (!allObj || !allObj.keys) {\r\n            return [];\r\n        }\r\n        return allObj.keys;\r\n    };\r\n    HCBridge.prototype.update = function (name, delta) {\r\n        this._facade.update(name, delta);\r\n        return Promise.resolve();\r\n    };\r\n    HCBridge.prototype.set = function (name, data) {\r\n        this._facade.set(name, data);\r\n        return Promise.resolve();\r\n    };\r\n    HCBridge.prototype.subscribe = function (name, callback) {\r\n        var snapshot = null;\r\n        var key = this._facade.subscribe(name, function (data, delta, removed) {\r\n            if (!key && key !== 0) {\r\n                snapshot = data;\r\n                return;\r\n            }\r\n            callback(data, delta, removed, key);\r\n        });\r\n        if (snapshot) {\r\n            callback(snapshot, snapshot, [], key);\r\n            snapshot = null;\r\n        }\r\n        return Promise.resolve(key);\r\n    };\r\n    HCBridge.prototype.get = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                this.subscribe(name, function (data, un) {\r\n                    _this.unsubscribe(un);\r\n                    resolve(data);\r\n                });\r\n                return [2];\r\n            });\r\n        }); });\r\n    };\r\n    HCBridge.prototype.unsubscribe = function (key) {\r\n        this._facade.unsubscribe(key);\r\n    };\r\n    return HCBridge;\r\n}());\r\nexports.HCBridge = HCBridge;\r\n//# sourceMappingURL=hcBridge.js.map\n\n/***/ }),\n/* 69 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gw3Bridge_1 = __webpack_require__(66);\r\nvar hcBridge_1 = __webpack_require__(68);\r\nvar ContextsModule = (function () {\r\n    function ContextsModule(config) {\r\n        this.config = config;\r\n        try {\r\n            if (config.gdMajorVersion === 2) {\r\n                var hc = window.htmlContainer;\r\n                if (!hc.sharedContextFacade) {\r\n                    throw new Error(\"Your version of HtmlContainer does not support contexts.\"\r\n                        + \" Get version 1.46.0.0 or later to have that feature.\");\r\n                }\r\n                this._bridge = new hcBridge_1.HCBridge(config);\r\n            }\r\n            else if (config.connection.protocolVersion === 3) {\r\n                this._bridge = new gw3Bridge_1.GW3Bridge(config);\r\n            }\r\n            else {\r\n                throw new Error(\"To use the Contexts library you must run in the\"\r\n                    + \" HTML Container or using a connection to Gateway v3.\");\r\n            }\r\n        }\r\n        catch (err) {\r\n            throw err;\r\n        }\r\n    }\r\n    ContextsModule.prototype.all = function () {\r\n        return this._bridge.all();\r\n    };\r\n    ContextsModule.prototype.update = function (name, delta) {\r\n        this.checkName(name);\r\n        return this._bridge.update(name, delta);\r\n    };\r\n    ContextsModule.prototype.set = function (name, data) {\r\n        this.checkName(name);\r\n        return this._bridge.set(name, data);\r\n    };\r\n    ContextsModule.prototype.subscribe = function (name, callback) {\r\n        var _this = this;\r\n        this.checkName(name);\r\n        return this._bridge\r\n            .subscribe(name, function (data, delta, removed, key, extraData) { return callback(data, delta, removed, function () { return _this._bridge.unsubscribe(key); }, extraData); })\r\n            .then(function (key) {\r\n            return function () {\r\n                _this._bridge.unsubscribe(key);\r\n            };\r\n        });\r\n    };\r\n    ContextsModule.prototype.get = function (name) {\r\n        return this._bridge.get(name);\r\n    };\r\n    ContextsModule.prototype.ready = function () {\r\n        return Promise.resolve(this);\r\n    };\r\n    ContextsModule.prototype.checkName = function (name) {\r\n        if (typeof name !== \"string\" ||\r\n            name == \"\") {\r\n            throw new Error(\"'name' must be non-empty string, got '\" + name + \"'\");\r\n        }\r\n    };\r\n    return ContextsModule;\r\n}());\r\nexports.ContextsModule = ContextsModule;\r\n//# sourceMappingURL=contextsModule.js.map\n\n/***/ }),\n/* 70 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction applyContextDelta(context, delta) {\r\n    if (delta) {\r\n        if (delta.reset) {\r\n            context = __assign({}, delta.reset);\r\n            return context;\r\n        }\r\n        context = deepClone(context, null);\r\n        var added_1 = delta.added;\r\n        var updated_1 = delta.updated;\r\n        var removed = delta.removed;\r\n        if (added_1) {\r\n            Object.keys(added_1).forEach(function (key) {\r\n                context[key] = added_1[key];\r\n            });\r\n        }\r\n        if (updated_1) {\r\n            Object.keys(updated_1).forEach(function (key) {\r\n                mergeObjectsProperties(key, context, updated_1);\r\n            });\r\n        }\r\n        if (removed) {\r\n            removed.forEach(function (key) {\r\n                delete context[key];\r\n            });\r\n        }\r\n    }\r\n    return context;\r\n}\r\nexports.applyContextDelta = applyContextDelta;\r\nfunction deepClone(obj, hash) {\r\n    hash = hash || new WeakMap();\r\n    if (Object(obj) !== obj) {\r\n        return obj;\r\n    }\r\n    if (obj instanceof Set) {\r\n        return new Set(obj);\r\n    }\r\n    if (hash.has(obj)) {\r\n        return hash.get(obj);\r\n    }\r\n    var result = obj instanceof Date ? new Date(obj)\r\n        : obj instanceof RegExp ? new RegExp(obj.source, obj.flags)\r\n            : obj.constructor ? new obj.constructor()\r\n                : Object.create(null);\r\n    hash.set(obj, result);\r\n    if (obj instanceof Map) {\r\n        Array.from(obj, function (_a) {\r\n            var key = _a[0], val = _a[1];\r\n            return result.set(key, deepClone(val, hash));\r\n        });\r\n    }\r\n    return Object.assign.apply(Object, [result].concat(Object.keys(obj).map(function (key) {\r\n        var _a;\r\n        return (_a = {}, _a[key] = deepClone(obj[key], hash), _a);\r\n    })));\r\n}\r\nexports.deepClone = deepClone;\r\nvar mergeObjectsProperties = function (key, what, withWhat) {\r\n    var right = withWhat[key];\r\n    if (right === undefined) {\r\n        return what;\r\n    }\r\n    var left = what[key];\r\n    if (!left || !right) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    if (typeof left === \"string\" ||\r\n        typeof left === \"number\" ||\r\n        typeof left === \"boolean\" ||\r\n        typeof right === \"string\" ||\r\n        typeof right === \"number\" ||\r\n        typeof right === \"boolean\" ||\r\n        Array.isArray(left) ||\r\n        Array.isArray(right)) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    what[key] = Object.assign({}, left, right);\r\n    return what;\r\n};\r\nfunction deepEqual(x, y) {\r\n    if (x === y) {\r\n        return true;\r\n    }\r\n    if (!(x instanceof Object) || !(y instanceof Object)) {\r\n        return false;\r\n    }\r\n    if (x.constructor !== y.constructor) {\r\n        return false;\r\n    }\r\n    for (var p in x) {\r\n        if (!x.hasOwnProperty(p)) {\r\n            continue;\r\n        }\r\n        if (!y.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n        if (x[p] === y[p]) {\r\n            continue;\r\n        }\r\n        if (typeof (x[p]) !== \"object\") {\r\n            return false;\r\n        }\r\n        if (!deepEqual(x[p], y[p])) {\r\n            return false;\r\n        }\r\n    }\r\n    for (var p in y) {\r\n        if (y.hasOwnProperty(p) && !x.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nexports.deepEqual = deepEqual;\r\n//# sourceMappingURL=helpers.js.map\n\n/***/ }),\n/* 71 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar contextsModule_1 = __webpack_require__(69);\r\nexports.ContextsModule = contextsModule_1.ContextsModule;\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 72 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar LogLevel = (function () {\r\n    function LogLevel() {\r\n    }\r\n    LogLevel.canPublish = function (level, restriction) {\r\n        var levelIdx = LogLevel.order.indexOf(level);\r\n        var restrictionIdx = LogLevel.order.indexOf(restriction);\r\n        return levelIdx >= restrictionIdx;\r\n    };\r\n    LogLevel.off = \"off\";\r\n    LogLevel.trace = \"trace\";\r\n    LogLevel.debug = \"debug\";\r\n    LogLevel.info = \"info\";\r\n    LogLevel.warn = \"warn\";\r\n    LogLevel.error = \"error\";\r\n    LogLevel.order = [LogLevel.trace, LogLevel.debug, LogLevel.info, LogLevel.warn, LogLevel.error, LogLevel.off];\r\n    return LogLevel;\r\n}());\r\nexports.default = LogLevel;\r\n//# sourceMappingURL=levels.js.map\n\n/***/ }),\n/* 73 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar levels_1 = __webpack_require__(72);\r\nvar LoggerImpl = (function () {\r\n    function LoggerImpl(name, parent, metricSystem) {\r\n        this._subloggers = [];\r\n        this._name = name;\r\n        this._parent = parent;\r\n        if (parent) {\r\n            this._path = parent.path + \".\" + name;\r\n        }\r\n        else {\r\n            this._path = name;\r\n        }\r\n        this._loggerFullName = \"[\" + this._path + \"]\";\r\n        if (typeof metricSystem !== \"undefined\") {\r\n            this.metricsLevel(\"warn\", metricSystem.subSystem(name));\r\n        }\r\n    }\r\n    Object.defineProperty(LoggerImpl.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(LoggerImpl.prototype, \"path\", {\r\n        get: function () {\r\n            return this._path;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LoggerImpl.prototype.subLogger = function (name) {\r\n        var existingSub = this._subloggers.filter(function (subLogger) {\r\n            return subLogger.name === name;\r\n        })[0];\r\n        if (existingSub !== undefined) {\r\n            return existingSub;\r\n        }\r\n        Object.keys(this).forEach(function (key) {\r\n            if (key === name) {\r\n                throw new Error(\"This sub logger name is not allowed.\");\r\n            }\r\n        });\r\n        var sub = new LoggerImpl(name, this);\r\n        this._subloggers.push(sub);\r\n        return sub;\r\n    };\r\n    LoggerImpl.prototype.publishLevel = function (level) {\r\n        if (level !== null && level !== undefined) {\r\n            this._publishLevel = level;\r\n        }\r\n        return this._publishLevel || this._parent.publishLevel();\r\n    };\r\n    LoggerImpl.prototype.consoleLevel = function (level) {\r\n        if (level !== null && level !== undefined) {\r\n            this._consoleLevel = level;\r\n        }\r\n        return this._consoleLevel || this._parent.consoleLevel();\r\n    };\r\n    LoggerImpl.prototype.metricsLevel = function (level, metricsSystem) {\r\n        if (level !== null && level !== undefined) {\r\n            this._metricLevel = level;\r\n        }\r\n        if (metricsSystem !== undefined) {\r\n            if (typeof metricsSystem === \"object\" && typeof metricsSystem.objectMetric === \"function\") {\r\n                this._metricSystem = metricsSystem;\r\n            }\r\n            else {\r\n                throw new Error(\"Please specify metric system\");\r\n            }\r\n        }\r\n        return this._metricLevel || this._parent.metricsLevel();\r\n    };\r\n    LoggerImpl.prototype.log = function (message, level) {\r\n        this.publishMessage(level || levels_1.default.info, message);\r\n    };\r\n    LoggerImpl.prototype.trace = function (message) {\r\n        this.log(message, levels_1.default.trace);\r\n    };\r\n    LoggerImpl.prototype.debug = function (message) {\r\n        this.log(message, levels_1.default.debug);\r\n    };\r\n    LoggerImpl.prototype.info = function (message) {\r\n        this.log(message, levels_1.default.info);\r\n    };\r\n    LoggerImpl.prototype.warn = function (message) {\r\n        this.log(message, levels_1.default.warn);\r\n    };\r\n    LoggerImpl.prototype.error = function (message) {\r\n        this.log(message, levels_1.default.error);\r\n    };\r\n    LoggerImpl.prototype.toAPIObject = function () {\r\n        var that = this;\r\n        return {\r\n            name: this.name,\r\n            subLogger: this.subLogger.bind(that),\r\n            publishLevel: this.publishLevel.bind(that),\r\n            consoleLevel: this.consoleLevel.bind(that),\r\n            metricsLevel: this.metricsLevel.bind(that),\r\n            log: this.log.bind(that),\r\n            trace: this.trace.bind(that),\r\n            debug: this.debug.bind(that),\r\n            info: this.info.bind(that),\r\n            warn: this.warn.bind(that),\r\n            error: this.error.bind(that),\r\n        };\r\n    };\r\n    LoggerImpl.prototype.publishMessage = function (level, message) {\r\n        var loggerName = this._loggerFullName;\r\n        if (level === levels_1.default.error) {\r\n            var e = new Error();\r\n            if (e.stack) {\r\n                message = message + \"\\n\" +\r\n                    (e.stack.split(\"\\n\").slice(3).join(\"\\n\"));\r\n            }\r\n        }\r\n        if (levels_1.default.canPublish(level, this.consoleLevel())) {\r\n            var toPrint = loggerName + \": \" + message;\r\n            switch (level) {\r\n                case levels_1.default.trace:\r\n                    console.trace(toPrint);\r\n                    break;\r\n                case levels_1.default.debug:\r\n                    if (console.debug) {\r\n                        console.debug(toPrint);\r\n                    }\r\n                    else {\r\n                        console.log(toPrint);\r\n                    }\r\n                    break;\r\n                case levels_1.default.info:\r\n                    console.info(toPrint);\r\n                    break;\r\n                case levels_1.default.warn:\r\n                    console.warn(toPrint);\r\n                    break;\r\n                case levels_1.default.error:\r\n                    console.error(toPrint);\r\n                    break;\r\n            }\r\n        }\r\n        if (levels_1.default.canPublish(level, this.publishLevel())) {\r\n            LoggerImpl.GetConnection().send(\"log\", \"LogMessage\", {\r\n                instance: LoggerImpl.Instance,\r\n                level: levels_1.default.order.indexOf(level),\r\n                logger: loggerName,\r\n                message: message,\r\n            });\r\n        }\r\n        if (levels_1.default.canPublish(level, this.metricsLevel())) {\r\n            if (this._metricSystem !== undefined) {\r\n                this._metricSystem.objectMetric(\"LogMessage\", {\r\n                    Level: level,\r\n                    Logger: loggerName,\r\n                    Message: message,\r\n                    Time: new Date(),\r\n                });\r\n                if (level === levels_1.default.error) {\r\n                    this._metricSystem.setState(100, message);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return LoggerImpl;\r\n}());\r\nexports.default = LoggerImpl;\r\n//# sourceMappingURL=logger.js.map\n\n/***/ }),\n/* 74 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar logger_1 = __webpack_require__(73);\r\nexports.default = (function (settings) {\r\n    var identity = settings.identity;\r\n    if (!identity) {\r\n        throw new Error(\"identity is missing\");\r\n    }\r\n    var identityStr = identity.system + \"\\\\\" + identity.service + \"\\\\\" + identity.instance;\r\n    logger_1.default.Instance = identityStr;\r\n    logger_1.default.GetConnection = settings.getConnection;\r\n    var mainLogger = new logger_1.default(\"main\");\r\n    mainLogger.publishLevel(settings.publish || \"off\");\r\n    mainLogger.consoleLevel(settings.console || \"info\");\r\n    mainLogger.metricsLevel(settings.metrics || \"off\");\r\n    var apiLogger = mainLogger.toAPIObject();\r\n    return apiLogger;\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 75 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar glue_1 = __webpack_require__(16);\r\nvar pjson = __webpack_require__(12);\r\nif (typeof window !== \"undefined\") {\r\n    window.GlueCore = glue_1.default;\r\n}\r\nglue_1.default.default = glue_1.default;\r\nglue_1.default.version = pjson.version;\r\nmodule.exports = glue_1.default;\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 76 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction addressMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var conflation = definition.conflation;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.ADDRESS;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = addressMetric;\r\n//# sourceMappingURL=address.js.map\n\n/***/ }),\n/* 77 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction countMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || 0;\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.COUNT;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    function incrementBy(num) {\r\n        update(_value + num);\r\n    }\r\n    function increment() {\r\n        incrementBy(1);\r\n    }\r\n    function decrement() {\r\n        incrementBy(-1);\r\n    }\r\n    function decrementBy(num) {\r\n        incrementBy(num * -1);\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get path() {\r\n            return _path;\r\n        },\r\n        get value() {\r\n            return _value;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n        incrementBy: incrementBy,\r\n        increment: increment,\r\n        decrement: decrement,\r\n        decrementBy: decrementBy,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = countMetric;\r\n//# sourceMappingURL=count.js.map\n\n/***/ }),\n/* 78 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction numberMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _path = parent.path.slice(0);\r\n    var _value = value || 0;\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.NUMBER;\r\n    _path.push(parent.name);\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    function incrementBy(num) {\r\n        update(_value + num);\r\n    }\r\n    function increment() {\r\n        incrementBy(1);\r\n    }\r\n    function decrement() {\r\n        incrementBy(-1);\r\n    }\r\n    function decrementBy(num) {\r\n        incrementBy(num * -1);\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        type: type,\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n        incrementBy: incrementBy,\r\n        increment: increment,\r\n        decrement: decrement,\r\n        decrementBy: decrementBy,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = numberMetric;\r\n//# sourceMappingURL=number.js.map\n\n/***/ }),\n/* 79 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar metric_types_1 = __webpack_require__(0);\r\nvar helpers_1 = __webpack_require__(2);\r\nfunction objectMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.OBJECT;\r\n    function update(newValue) {\r\n        mergeValues(newValue);\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    function mergeValues(values) {\r\n        return Object.keys(_value).forEach(function (k) {\r\n            if (typeof values[k] !== \"undefined\") {\r\n                _value[k] = values[k];\r\n            }\r\n        });\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = objectMetric;\r\n//# sourceMappingURL=object.js.map\n\n/***/ }),\n/* 80 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction rateMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.RATE;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = rateMetric;\r\n//# sourceMappingURL=rate.js.map\n\n/***/ }),\n/* 81 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction statisticsMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.STATISTICS;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = statisticsMetric;\r\n//# sourceMappingURL=statistics.js.map\n\n/***/ }),\n/* 82 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction stringMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.STRING;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        type: type,\r\n        update: update,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = stringMetric;\r\n//# sourceMappingURL=string.js.map\n\n/***/ }),\n/* 83 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction timespanMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.TIMESPAN;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function start() {\r\n        update(true);\r\n    }\r\n    function stop() {\r\n        update(false);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        start: start,\r\n        stop: stop,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = timespanMetric;\r\n//# sourceMappingURL=timespan.js.map\n\n/***/ }),\n/* 84 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction timestampMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.TIMESTAMP;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function now() {\r\n        update(new Date());\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        now: now,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = timestampMetric;\r\n//# sourceMappingURL=timestamp.js.map\n\n/***/ }),\n/* 85 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar serializer_1 = __webpack_require__(86);\r\nfunction default_1(connection, config) {\r\n    var DEFAULT_HEARTBEAT_INTERVAL = 3000;\r\n    var heartbeatTimer;\r\n    if (!connection || typeof connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var _connection = connection;\r\n    var heartbeatInterval = config.heartbeatInterval || DEFAULT_HEARTBEAT_INTERVAL;\r\n    var send = function (type, message) {\r\n        _connection.send(\"metrics\", type, message);\r\n    };\r\n    function sendFull(repo) {\r\n        if (!repo.root) {\r\n            return;\r\n        }\r\n        if (repo.root.subSystems.length === 0) {\r\n            return;\r\n        }\r\n        sendFullSystem(repo.root);\r\n    }\r\n    function sendFullSystem(system) {\r\n        createSystem(system);\r\n        system.subSystems.forEach(function (sub) {\r\n            sendFullSystem(sub);\r\n        });\r\n        system.metrics.forEach(function (metric) {\r\n            createMetric(metric);\r\n        });\r\n    }\r\n    function heartbeat(repo) {\r\n        send(\"HeartbeatMetrics\", {\r\n            publishingInterval: heartbeatInterval,\r\n            instance: repo.instance,\r\n        });\r\n    }\r\n    function createSystem(system) {\r\n        if (system.parent !== undefined) {\r\n            send(\"CreateMetricSystem\", {\r\n                id: system.id,\r\n                instance: system.repo.instance,\r\n                definition: {\r\n                    name: system.name,\r\n                    description: system.description,\r\n                    path: system.path,\r\n                },\r\n            });\r\n        }\r\n    }\r\n    function updateSystem(system, state) {\r\n        send(\"UpdateMetricSystem\", {\r\n            id: system.id,\r\n            instance: system.repo.instance,\r\n            state: state,\r\n        });\r\n    }\r\n    function createMetric(metric) {\r\n        send(\"CreateMetric\", serializer_1.default(metric));\r\n    }\r\n    function updateMetric(metric) {\r\n        send(\"UpdateMetric\", serializer_1.default(metric));\r\n    }\r\n    function init(repo) {\r\n        heartbeat(repo);\r\n        _connection.on(\"metrics\", \"MetricsSnapshotRequest\", function (instanceInfo) {\r\n            if (instanceInfo.Instance !== repo.instance) {\r\n                return;\r\n            }\r\n            sendFull(repo);\r\n        });\r\n        _connection.disconnected(function () { return clearInterval(heartbeatTimer); });\r\n        if (typeof window !== \"undefined\" && typeof window.htmlContainer === \"undefined\") {\r\n            heartbeatTimer = setInterval(function () {\r\n                heartbeat(repo);\r\n            }, heartbeatInterval);\r\n        }\r\n    }\r\n    var me = {\r\n        createSystem: createSystem,\r\n        updateSystem: updateSystem,\r\n        createMetric: createMetric,\r\n        updateMetric: updateMetric,\r\n        init: init,\r\n    };\r\n    return me;\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=gw1.js.map\n\n/***/ }),\n/* 86 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction metricToMessage(metric) {\r\n    var definition = getMetricDefinition(metric.name, metric.value, metric.path, metric.type, metric.description, metric.period, metric.resolution, metric.conflation);\r\n    function getMetricDefinition(name, value, path, type, description, period, resolution, conflation) {\r\n        var _definition = {\r\n            name: name,\r\n            description: description,\r\n            type: type ? type : getTypeFromValue(value),\r\n            path: path,\r\n            resolution: resolution,\r\n            period: period,\r\n            conflation: conflation,\r\n        };\r\n        if (_definition.type === metric_types_1.default.OBJECT) {\r\n            _definition.Composite = Object.keys(value).reduce(function (arr, key) {\r\n                var val = value[key];\r\n                arr.push(getMetricDefinition(key, val, path));\r\n                return arr;\r\n            }, []);\r\n        }\r\n        return _definition;\r\n    }\r\n    function serializeValue(value, _metric) {\r\n        if (value && value.constructor === Date) {\r\n            return {\r\n                value: {\r\n                    type: _valueTypes.indexOf(\"date\"),\r\n                    value: value.valueOf(),\r\n                    isArray: false,\r\n                },\r\n            };\r\n        }\r\n        if (typeof value === \"object\") {\r\n            return {\r\n                CompositeValue: Object.keys(value).reduce(function (arr, key) {\r\n                    var val = serializeValue(value[key]);\r\n                    val.InnerMetricName = key;\r\n                    arr.push(val);\r\n                    return arr;\r\n                }, []),\r\n            };\r\n        }\r\n        var valueType = _metric ? _metric.getValueType() : undefined;\r\n        valueType = valueType || _valueTypes.indexOf(typeof value);\r\n        return {\r\n            value: {\r\n                type: valueType,\r\n                value: value,\r\n                isArray: false,\r\n            },\r\n        };\r\n    }\r\n    function getTypeFromValue(value) {\r\n        var typeAsString = value.constructor === Date ? \"timestamp\" : typeof value;\r\n        switch (typeAsString) {\r\n            case \"string\":\r\n                return metric_types_1.default.STRING;\r\n            case \"number\":\r\n                return metric_types_1.default.NUMBER;\r\n            case \"timestamp\":\r\n                return metric_types_1.default.TIMESTAMP;\r\n            case \"object\":\r\n                return metric_types_1.default.OBJECT;\r\n        }\r\n        return 0;\r\n    }\r\n    var _valueTypes = [\r\n        \"boolean\",\r\n        \"int\",\r\n        \"number\",\r\n        \"long\",\r\n        \"string\",\r\n        \"date\",\r\n        \"object\",\r\n    ];\r\n    return {\r\n        id: metric.id,\r\n        instance: metric.repo.instance,\r\n        definition: definition,\r\n        value: serializeValue(metric.value, metric),\r\n    };\r\n}\r\nexports.default = metricToMessage;\r\n//# sourceMappingURL=serializer.js.map\n\n/***/ }),\n/* 87 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar serializer_1 = __webpack_require__(88);\r\nfunction default_1(connection, config) {\r\n    if (!connection || typeof connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var joinPromise;\r\n    var session;\r\n    var init = function (repo) {\r\n        var resolveReadyPromise;\r\n        joinPromise = new Promise(function (resolve) {\r\n            resolveReadyPromise = resolve;\r\n        });\r\n        session = connection.domain(\"metrics\", config.logger);\r\n        session.onJoined(function (reconnect) {\r\n            if (!reconnect) {\r\n                resolveReadyPromise();\r\n                resolveReadyPromise = undefined;\r\n            }\r\n            var rootStateMetric = {\r\n                name: \"/State\",\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var defineRootMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [rootStateMetric],\r\n            };\r\n            session.send(defineRootMetricsMsg);\r\n            if (reconnect) {\r\n                replayRepo(repo);\r\n            }\r\n        });\r\n        session.join(config.identity);\r\n    };\r\n    var replayRepo = function (repo) {\r\n        replaySystem(repo.root);\r\n    };\r\n    var replaySystem = function (system) {\r\n        createSystem(system);\r\n        system.metrics.forEach(function (m) {\r\n            createMetric(m);\r\n        });\r\n        system.subSystems.forEach(function (ss) {\r\n            replaySystem(ss);\r\n        });\r\n    };\r\n    var createSystem = function (system) {\r\n        if (system.parent === undefined) {\r\n            return;\r\n        }\r\n        joinPromise.then(function () {\r\n            var metric = {\r\n                name: serializer_1.normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var createMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [metric],\r\n            };\r\n            session.send(createMetricsMsg);\r\n        });\r\n    };\r\n    var updateSystem = function (system, state) {\r\n        joinPromise.then(function () {\r\n            var shadowedUpdateMetric = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: serializer_1.normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                        value: {\r\n                            Description: state.description,\r\n                            Value: state.state,\r\n                        },\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(shadowedUpdateMetric);\r\n            var stateObj = serializer_1.composeMsgForRootStateMetric(system);\r\n            var rootMetric = {\r\n                type: \"publish\",\r\n                peer_id: connection.peerId,\r\n                values: [{\r\n                        name: \"/State\",\r\n                        value: {\r\n                            Description: stateObj.description,\r\n                            Value: stateObj.value,\r\n                        },\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(rootMetric);\r\n        });\r\n    };\r\n    var createMetric = function (metric) {\r\n        joinPromise.then(function () {\r\n            var m = serializer_1.serializeMetric(metric);\r\n            var createMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [m],\r\n            };\r\n            session.send(createMetricsMsg);\r\n            if (typeof metric.value !== \"undefined\") {\r\n                updateMetric(metric);\r\n            }\r\n        });\r\n    };\r\n    var updateMetric = function (metric) {\r\n        joinPromise.then(function () {\r\n            var value = serializer_1.getMetricValueByType(metric);\r\n            var publishMetricsMsg = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: serializer_1.normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name),\r\n                        value: value,\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(publishMetricsMsg);\r\n        });\r\n    };\r\n    return {\r\n        init: init,\r\n        createSystem: createSystem,\r\n        updateSystem: updateSystem,\r\n        createMetric: createMetric,\r\n        updateMetric: updateMetric,\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=gw3.js.map\n\n/***/ }),\n/* 88 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction getMetricTypeByValue(metric) {\r\n    if ((metric.value && metric.value.constructor === Date) || metric.type === metric_types_1.default.TIMESPAN || metric.type === metric_types_1.default.TIMESTAMP) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (typeof metric.value === \"number\") {\r\n        return \"number\";\r\n    }\r\n    else if (typeof metric.value === \"string\" || metric.type === metric_types_1.default.STRING || metric.type === metric_types_1.default.RATE) {\r\n        return \"string\";\r\n    }\r\n    else if (typeof metric.value === \"object\") {\r\n        return \"object\";\r\n    }\r\n}\r\nfunction getTypeByValue(value) {\r\n    if (value.constructor === Date) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (typeof value === \"number\") {\r\n        return \"number\";\r\n    }\r\n    else if (typeof value === \"string\") {\r\n        return \"string\";\r\n    }\r\n    else if (typeof value === \"object\") {\r\n        return \"object\";\r\n    }\r\n    else {\r\n        return \"string\";\r\n    }\r\n}\r\nfunction serializeMetric(metric) {\r\n    var serializedMetrics = {};\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"object\") {\r\n        var values = Object.keys(metric.value).reduce(function (memo, key) {\r\n            var innerType = getTypeByValue(metric.value[key]);\r\n            if (innerType === \"object\") {\r\n                var composite = defineNestedComposite(metric.value[key]);\r\n                memo[key] = {\r\n                    type: \"object\",\r\n                    description: \"\",\r\n                    context: {},\r\n                    composite: composite,\r\n                };\r\n            }\r\n            else {\r\n                memo[key] = {\r\n                    type: innerType,\r\n                    description: \"\",\r\n                    context: {},\r\n                };\r\n            }\r\n            return memo;\r\n        }, {});\r\n        serializedMetrics.composite = values;\r\n    }\r\n    serializedMetrics.name = normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name);\r\n    serializedMetrics.type = type;\r\n    serializedMetrics.description = metric.description;\r\n    serializedMetrics.context = {};\r\n    return serializedMetrics;\r\n}\r\nexports.serializeMetric = serializeMetric;\r\nfunction defineNestedComposite(values) {\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var type = getTypeByValue(values[key]);\r\n        if (type === \"object\") {\r\n            memo[key] = {\r\n                type: \"object\",\r\n                description: \"\",\r\n                context: {},\r\n                composite: defineNestedComposite(values[key]),\r\n            };\r\n        }\r\n        else {\r\n            memo[key] = {\r\n                type: type,\r\n                description: \"\",\r\n                context: {},\r\n            };\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction normalizeMetricName(name) {\r\n    if (typeof name !== \"undefined\" && name.length > 0 && name[0] !== \"/\") {\r\n        return \"/\" + name;\r\n    }\r\n    else {\r\n        return name;\r\n    }\r\n}\r\nexports.normalizeMetricName = normalizeMetricName;\r\nfunction getMetricValueByType(metric) {\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"timestamp\") {\r\n        return Date.now();\r\n    }\r\n    else {\r\n        return publishNestedComposite(metric.value);\r\n    }\r\n}\r\nexports.getMetricValueByType = getMetricValueByType;\r\nfunction publishNestedComposite(values) {\r\n    if (typeof values !== \"object\") {\r\n        return values;\r\n    }\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var value = values[key];\r\n        if (typeof value === \"object\" && value.constructor !== Date) {\r\n            memo[key] = publishNestedComposite(value);\r\n        }\r\n        else if (value.constructor === Date) {\r\n            memo[key] = new Date(value).getTime();\r\n        }\r\n        else if (value.constructor === Boolean) {\r\n            memo[key] = value.toString();\r\n        }\r\n        else {\r\n            memo[key] = value;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction flatten(arr) {\r\n    return arr.reduce(function (flat, toFlatten) {\r\n        return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\r\n    }, []);\r\n}\r\nfunction getHighestState(arr) {\r\n    return arr.sort(function (a, b) {\r\n        return b.state - a.state;\r\n    })[0];\r\n}\r\nfunction aggregateDescription(arr) {\r\n    var msg = \"\";\r\n    arr.forEach(function (m, idx, a) {\r\n        var path = m.path.join(\".\");\r\n        if (idx === a.length - 1) {\r\n            msg += path + \".\" + m.name + \": \" + m.description;\r\n        }\r\n        else {\r\n            msg += path + \".\" + m.name + \": \" + m.description + \",\";\r\n        }\r\n    });\r\n    if (msg.length > 100) {\r\n        return msg.slice(0, 100) + \"...\";\r\n    }\r\n    else {\r\n        return msg;\r\n    }\r\n}\r\nfunction composeMsgForRootStateMetric(system) {\r\n    var aggregatedState = system.root.getAggregateState();\r\n    var merged = flatten(aggregatedState);\r\n    var highestState = getHighestState(merged);\r\n    var aggregateDesc = aggregateDescription(merged);\r\n    return {\r\n        description: aggregateDesc,\r\n        value: highestState.state,\r\n    };\r\n}\r\nexports.composeMsgForRootStateMetric = composeMsgForRootStateMetric;\r\n//# sourceMappingURL=serializer.js.map\n\n/***/ }),\n/* 89 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gw3_1 = __webpack_require__(87);\r\nvar gw1_1 = __webpack_require__(85);\r\nvar repository_1 = __webpack_require__(90);\r\nexports.default = (function (settings) {\r\n    var options = {\r\n        connection: settings.connection,\r\n        identity: settings.identity,\r\n        logger: settings.logger,\r\n        heartbeatInterval: settings.heartbeatInterval,\r\n        settings: {},\r\n        clickStream: settings.clickStream,\r\n    };\r\n    if (!options.connection || typeof options.connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var _protocol;\r\n    if (options.connection.protocolVersion === 3) {\r\n        _protocol = gw3_1.default(options.connection, settings);\r\n    }\r\n    else {\r\n        _protocol = gw1_1.default(options.connection, settings);\r\n    }\r\n    var repo = repository_1.default(options, _protocol);\r\n    var rootSystem = repo.root;\r\n    return rootSystem;\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 90 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar system_1 = __webpack_require__(91);\r\nfunction repository(options, protocol) {\r\n    if (!options.identity) {\r\n        throw new Error(\"Identity missing from metrics configuration\");\r\n    }\r\n    if (!options.identity.service || typeof options.identity.service !== \"string\") {\r\n        throw new Error(\"Service missing or invalid in metrics identity configuration\");\r\n    }\r\n    if (!options.identity.system || typeof options.identity.system !== \"string\") {\r\n        throw new Error(\"System missing or invalid in metrics identity configuration\");\r\n    }\r\n    if (!options.identity.instance || typeof options.identity.instance !== \"string\") {\r\n        throw new Error(\"Instance missing or invalid in metrics identity configuration\");\r\n    }\r\n    var identity = options.identity;\r\n    var instance = options.identity.system + \"/\" + options.identity.service + \"/\" + options.identity.instance;\r\n    function _initSystemMetrics(rootSystem, useClickStream) {\r\n        if (typeof navigator !== \"undefined\") {\r\n            rootSystem.stringMetric(\"UserAgent\", navigator.userAgent);\r\n        }\r\n        if (useClickStream && typeof document !== \"undefined\") {\r\n            var clickStream_1 = rootSystem.subSystem(\"ClickStream\");\r\n            var documentClickHandler = function (e) {\r\n                if (!e.target) {\r\n                    return;\r\n                }\r\n                var target = e.target;\r\n                clickStream_1.objectMetric(\"LastBrowserEvent\", {\r\n                    type: \"click\",\r\n                    timestamp: new Date(),\r\n                    target: {\r\n                        className: e.target ? target.className : \"\",\r\n                        id: target.id,\r\n                        type: \"<\" + target.tagName.toLowerCase() + \">\",\r\n                        href: target.href || \"\",\r\n                    },\r\n                });\r\n            };\r\n            clickStream_1.objectMetric(\"Page\", {\r\n                title: document.title,\r\n                page: window.location.href,\r\n            });\r\n            if (document.addEventListener) {\r\n                document.addEventListener(\"click\", documentClickHandler);\r\n            }\r\n            else {\r\n                document.attachEvent(\"onclick\", documentClickHandler);\r\n            }\r\n        }\r\n        var startTime = rootSystem.stringMetric(\"StartTime\", (new Date()).toString());\r\n        var urlMetric = rootSystem.stringMetric(\"StartURL\", \"\");\r\n        var appNameMetric = rootSystem.stringMetric(\"AppName\", \"\");\r\n        if (typeof window !== \"undefined\") {\r\n            if (typeof window.location !== \"undefined\") {\r\n                var startUrl = window.location.href;\r\n                urlMetric.update(startUrl);\r\n            }\r\n            if (typeof window.glue42gd !== \"undefined\") {\r\n                appNameMetric.update(window.glue42gd.appName);\r\n            }\r\n        }\r\n    }\r\n    var me = {\r\n        identity: identity,\r\n        instance: instance,\r\n        get root() {\r\n            return _root;\r\n        },\r\n    };\r\n    protocol.init(me);\r\n    var _root = system_1.default(\"\", me, protocol);\r\n    _initSystemMetrics(_root, options.clickStream || options.clickStream === undefined);\r\n    return me;\r\n}\r\nexports.default = repository;\r\n//# sourceMappingURL=repository.js.map\n\n/***/ }),\n/* 91 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar address_1 = __webpack_require__(76);\r\nvar count_1 = __webpack_require__(77);\r\nvar number_1 = __webpack_require__(78);\r\nvar object_1 = __webpack_require__(79);\r\nvar rate_1 = __webpack_require__(80);\r\nvar statistics_1 = __webpack_require__(81);\r\nvar string_1 = __webpack_require__(82);\r\nvar timespan_1 = __webpack_require__(83);\r\nvar timestamp_1 = __webpack_require__(84);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction system(name, repo, protocol, parent, description) {\r\n    if (!repo) {\r\n        throw new Error(\"Repository is required\");\r\n    }\r\n    if (!protocol) {\r\n        throw new Error(\"Transport is required\");\r\n    }\r\n    var _transport = protocol;\r\n    var _name = name;\r\n    var _description = description || \"\";\r\n    var _repo = repo;\r\n    var _parent = parent;\r\n    var _path = _buildPath(parent);\r\n    var _state = {};\r\n    var id = _arrayToString(_path, \"/\") + name;\r\n    var identity = repo.identity;\r\n    var root = repo.root;\r\n    var _subSystems = [];\r\n    var _metrics = [];\r\n    function subSystem(nameSystem, descriptionSystem) {\r\n        if (!nameSystem || nameSystem.length === 0) {\r\n            throw new Error(\"name is required\");\r\n        }\r\n        var match = _subSystems.filter(function (s) { return s.name === nameSystem; });\r\n        if (match.length > 0) {\r\n            return match[0];\r\n        }\r\n        var _system = system(nameSystem, _repo, _transport, me, descriptionSystem);\r\n        _subSystems.push(_system);\r\n        return _system;\r\n    }\r\n    function setState(state, stateDescription) {\r\n        _state = { state: state, description: stateDescription };\r\n        _transport.updateSystem(me, _state);\r\n    }\r\n    function stringMetric(definition, value) {\r\n        return _getOrCreateMetric.call(me, definition, metric_types_1.default.STRING, value, function (metricDef) { return string_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function numberMetric(definition, value) {\r\n        return _getOrCreateMetric.call(me, definition, metric_types_1.default.NUMBER, value, function (metricDef) { return number_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function countMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.COUNT, value, function (metricDef) { return count_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function addressMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.ADDRESS, value, function (metricDef) { return address_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function objectMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.OBJECT, value, function (metricDef) { return object_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function timespanMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.TIMESPAN, value, function (metricDef) { return timespan_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function timestampMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.TIMESTAMP, value, function (metricDef) { return timestamp_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function rateMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.RATE, value, function (metricDef) { return rate_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function statisticsMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.STATISTICS, value, function (metricDef) { return statistics_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function _unionToMetricDef(def) {\r\n        var metricDefinition = {};\r\n        if (typeof def === \"string\") {\r\n            metricDefinition.name = def;\r\n        }\r\n        else {\r\n            metricDefinition = def;\r\n        }\r\n        if (metricDefinition.name === undefined) {\r\n            throw new Error(\"Metric name is required\");\r\n        }\r\n        return metricDefinition;\r\n    }\r\n    function _getOrCreateMetric(definition, expectedType, value, createMetric) {\r\n        var metricDefinition = _unionToMetricDef(definition);\r\n        var matching = _metrics.filter(function (shadowedMetric) { return shadowedMetric.name === metricDefinition.name; });\r\n        if (matching.length > 0) {\r\n            var existing = matching[0];\r\n            if (existing.type !== expectedType) {\r\n                throw new Error(\"A metric named \" + metricDefinition.name + \" is already defined with different type.\");\r\n            }\r\n            if (typeof value !== \"undefined\") {\r\n                existing.update(value);\r\n            }\r\n            return existing;\r\n        }\r\n        var metric = createMetric(metricDefinition);\r\n        _metrics.push(metric);\r\n        return metric;\r\n    }\r\n    function _buildPath(shadowedSystem) {\r\n        if (!shadowedSystem || !shadowedSystem.parent) {\r\n            return [];\r\n        }\r\n        var path = _buildPath(shadowedSystem.parent);\r\n        path.push(shadowedSystem.name);\r\n        return path;\r\n    }\r\n    function _arrayToString(path, separator) {\r\n        return ((path && path.length > 0) ? path.join(separator) : \"\");\r\n    }\r\n    function getAggregateState() {\r\n        var aggState = [];\r\n        if (Object.keys(_state).length > 0) {\r\n            aggState.push({\r\n                name: _name,\r\n                path: _path,\r\n                state: _state.state,\r\n                description: _state.description,\r\n            });\r\n        }\r\n        _subSystems.forEach(function (shadowedSubSystem) {\r\n            var result = shadowedSubSystem.getAggregateState();\r\n            if (result.length > 0) {\r\n                aggState.push.apply(aggState, result);\r\n            }\r\n        });\r\n        return aggState;\r\n    }\r\n    var me = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get description() {\r\n            return _description;\r\n        },\r\n        get repo() {\r\n            return _repo;\r\n        },\r\n        get parent() {\r\n            return _parent;\r\n        },\r\n        path: _path,\r\n        id: id,\r\n        identity: identity,\r\n        root: root,\r\n        get subSystems() {\r\n            return _subSystems;\r\n        },\r\n        get metrics() {\r\n            return _metrics;\r\n        },\r\n        subSystem: subSystem,\r\n        getState: function () {\r\n            return _state;\r\n        },\r\n        setState: setState,\r\n        stringMetric: stringMetric,\r\n        statisticsMetric: statisticsMetric,\r\n        rateMetric: rateMetric,\r\n        timestampMetric: timestampMetric,\r\n        timespanMetric: timespanMetric,\r\n        objectMetric: objectMetric,\r\n        addressMetric: addressMetric,\r\n        countMetric: countMetric,\r\n        numberMetric: numberMetric,\r\n        getAggregateState: getAggregateState,\r\n    };\r\n    _transport.createSystem(me);\r\n    return me;\r\n}\r\nexports.default = system;\r\n//# sourceMappingURL=system.js.map\n\n/***/ }),\n/* 92 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction default_1() {\r\n    function now() {\r\n        return new Date().getTime();\r\n    }\r\n    var startTime = now();\r\n    var endTime;\r\n    var period;\r\n    function stop() {\r\n        endTime = now();\r\n        period = now() - startTime;\r\n        return period;\r\n    }\r\n    return {\r\n        get startTime() {\r\n            return startTime;\r\n        },\r\n        get endTime() {\r\n            return endTime;\r\n        },\r\n        get period() {\r\n            return period;\r\n        },\r\n        stop: stop\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=timer.js.map\n\n/***/ })\n/******/ ]);\n});\n//# sourceMappingURL=tick42-glue-core.js.map\n\n/***/ }),\n/* 37 */\n/***/ (function(module, exports) {\n\nvar isFunction = function isFunction (arg) {return !!(arg && arg.constructor && arg.call && arg.apply);}\r\nvar nextTick = function nextTick (cb) { setTimeout(cb, 0); };\r\n\r\nmodule.exports = function (promise, successCallback, errorCallback) {\r\n    'use strict';\r\n    if (!isFunction(successCallback) && !isFunction(errorCallback)) {\r\n        return promise;\r\n    }\r\n\r\n    if (!isFunction(successCallback)) {\r\n        successCallback = function () {};\r\n    } else if (!isFunction(errorCallback)) {\r\n        errorCallback = function () {};        \r\n    }\r\n\r\n    promise.then(successCallback, errorCallback);\r\n}\r\n\n\n/***/ }),\n/* 38 */\n/***/ (function(module, exports) {\n\nvar g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n/***/ }),\n/* 39 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar promiseExtensions_1 = __webpack_require__(8);\r\nvar activityManagementAPI_1 = __webpack_require__(40);\r\nvar activityAGM_1 = __webpack_require__(9);\r\n/**\r\n * The entry points of activities API - accessible from glue.activities\r\n *\r\n * @module activities\r\n */\r\nvar ActivityAPI = /** @class */ (function () {\r\n    function ActivityAPI(manager, my) {\r\n        this._mgr = manager;\r\n        this._my = my;\r\n        this.all = new activityManagementAPI_1.ActivityManagementAPI(manager, my);\r\n    }\r\n    /**\r\n     * The entry point for your activity code.\r\n     *\r\n     * @function ready\r\n     * @returns {Promise<module:activities>} A promise for activity API\r\n     */\r\n    ActivityAPI.prototype.ready = function (callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._mgr.ready()\r\n                .then(function () {\r\n                resolve(_this);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    Object.defineProperty(ActivityAPI.prototype, \"my\", {\r\n        /**\r\n         * A lightweight, single activity oriented subset of the API which should be used by most activity applications\r\n         *\r\n         * @var {module:my} my\r\n         */\r\n        get: function () {\r\n            return this._my;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"aware\", {\r\n        /**\r\n         * True if the current window is activity aware - meaning that the window has been created as\r\n         * an activity participant - either a helper or an independent window.\r\n         * Check this after the API is ready.\r\n         *\r\n         * @var {bool} aware\r\n         */\r\n        get: function () {\r\n            return this._my.window !== undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"inActivity\", {\r\n        /**\r\n         * Returns true if the current window is activity aware and is currently participating in activity\r\n         *\r\n         * @var {bool} inActivity\r\n         */\r\n        get: function () {\r\n            return this.aware && this._my.activity !== undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"agm\", {\r\n        /**\r\n         * Defines an Activity-specific version of the AGM API which:\r\n         * * restricts method registrations to activity-only windows\r\n         * * restricts method discovery and invocation to activity-only methods, unless you explicitly specify otherwise\r\n         * Other than that, the API is pretty much the same.\r\n         *\r\n         * @var  {module:activityAGM} agm\r\n         *\r\n         */\r\n        get: function () {\r\n            if (!this.aware) {\r\n                // no agm if not activity aware\r\n                return undefined;\r\n            }\r\n            if (!this.inActivity) {\r\n                // if we're not in activity no\r\n                return new activityAGM_1.ActivityAGM(null);\r\n            }\r\n            return this._my.activity.agm;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Returns a list of frame colors that can be used as activity frame colors\r\n     *\r\n     * @returns {string[]}\r\n     */\r\n    ActivityAPI.prototype.getAvailableFrameColors = function () {\r\n        var frameColors;\r\n        var hc = window.htmlContainer;\r\n        if (hc) {\r\n            frameColors = hc.getFrameColors();\r\n        }\r\n        frameColors = frameColors || [];\r\n        return frameColors;\r\n    };\r\n    return ActivityAPI;\r\n}());\r\nexports.ActivityAPI = ActivityAPI;\r\n//# sourceMappingURL=activityAPI.js.map\n\n/***/ }),\n/* 40 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar util = __webpack_require__(1);\r\nvar ActivityManagementAPI = /** @class */ (function () {\r\n    function ActivityManagementAPI(manager, my) {\r\n        this._m = manager;\r\n        this._my = my;\r\n        this.activityTypes = {\r\n            get: this._getActivityTypesWrapper.bind(this),\r\n            register: this._m.registerActivityType.bind(this._m),\r\n            unregister: this._m.unregisterActivityType.bind(this._m),\r\n            subscribe: this._m.subscribeActivityTypeEvents.bind(this._m),\r\n            unsubscribe: undefined,\r\n            initiate: this._m.initiate.bind(this._m)\r\n        };\r\n        this.windowTypes = {\r\n            get: this._getWindowTypesWrapper.bind(this),\r\n            registerFactory: this._m.registerWindowFactory.bind(this._m),\r\n            unregisterFactory: this._m.unregisterWindowFactory.bind(this._m),\r\n            subscribe: this._m.subscribeWindowTypeEvents.bind(this._m),\r\n            unsubscribe: undefined\r\n        };\r\n        this.windows = {\r\n            get: this._m.getWindows.bind(this._m),\r\n            subscribe: this._m.subscribeWindowEvents.bind(this._m),\r\n            announce: this._m.announceWindow.bind(this._m),\r\n            unsubscribe: undefined,\r\n            create: this._m.createWindow.bind(this._m)\r\n        };\r\n        this.instances = {\r\n            get: this._m.getActivities.bind(this._m),\r\n            subscribe: this._m.subscribeActivityEvents.bind(this._m),\r\n            unsubscribe: undefined\r\n        };\r\n    }\r\n    ActivityManagementAPI.prototype.onAttached = function (callback) {\r\n        this._m.subscribeActivitiesAttached(callback);\r\n    };\r\n    ActivityManagementAPI.prototype.onDetached = function (callback) {\r\n        this._m.subscribeActivitiesDetached(callback);\r\n    };\r\n    ActivityManagementAPI.prototype.onActivityFrameColorChanged = function (callback) {\r\n        this._m.subscribeActivityFrameColorChanged(callback);\r\n    };\r\n    ActivityManagementAPI.prototype._getActivityTypesWrapper = function (name) {\r\n        if (util.isUndefined(name)) {\r\n            return this._m.getActivityTypes();\r\n        }\r\n        return this._m.getActivityType(name);\r\n    };\r\n    ActivityManagementAPI.prototype._getWindowTypesWrapper = function (name) {\r\n        if (util.isUndefined(name)) {\r\n            return this._m.getWindowTypes();\r\n        }\r\n        return this._m.getWindowType(name);\r\n    };\r\n    return ActivityManagementAPI;\r\n}());\r\nexports.ActivityManagementAPI = ActivityManagementAPI;\r\n//# sourceMappingURL=activityManagementAPI.js.map\n\n/***/ }),\n/* 41 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar entityEvent_1 = __webpack_require__(2);\r\nvar logger_1 = __webpack_require__(4);\r\nvar util = __webpack_require__(1);\r\n/**\r\n * A lightweight, single activity oriented subset of the API which should be used by most activity applications.\r\n * Provides access to the activity of your application (my.activity) and shortcuts to the most commonly used methods\r\n * (e.g. my.createWindow is a shortcut for my.activity.createWindow)\r\n *\r\n * @module my\r\n */\r\nvar ActivityMy = /** @class */ (function () {\r\n    function ActivityMy(manager, windows) {\r\n        var _this = this;\r\n        this._myAttached = [];\r\n        this._myDetached = [];\r\n        this._myAttachedTo = [];\r\n        this._myDetachedFrom = [];\r\n        this._myActivityFrameColorChanged = [];\r\n        this._myActivityJoinedCallbacks = [];\r\n        this._myActivityRemovedCallbacks = [];\r\n        this._myContextUpdateCallbacks = [];\r\n        this._logger = logger_1.Logger.Get(this);\r\n        this._m = manager;\r\n        manager.ready()\r\n            .then(function (am) {\r\n            // Subscribe for events for driving \"my\" logic\r\n            am.subscribeActivityContextChanged(_this._subscribeMyContextChanged.bind(_this));\r\n            am.subscribeWindowEvents(_this._subscribeMyWindowEvent.bind(_this));\r\n            am.subscribeActivitiesAttached(_this._subscribeActivitiesAttached.bind(_this));\r\n            am.subscribeActivitiesDetached(_this._subscribeActivitiesDetached.bind(_this));\r\n            if (windows) {\r\n                windows.onWindowFrameColorChanged(_this._subscribeWindowFrameColorChanged.bind(_this));\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(ActivityMy.prototype, \"window\", {\r\n        /**\r\n         * The current activity window; can be undefined (if the window is not part of any activity)\r\n         *\r\n         * @var {Window} window\r\n         */\r\n        get: function () {\r\n            if (util.isUndefinedOrNull(this._w)) {\r\n                var announcedWindows = this._m.announcedWindows;\r\n                if (announcedWindows.length > 0) {\r\n                    this._w = announcedWindows[0];\r\n                }\r\n            }\r\n            return this._w;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityMy.prototype, \"activity\", {\r\n        /**\r\n         * The current activity that the application participates in.\r\n         * Can be undefined (if currently not part of any activity)\r\n         *\r\n         * @var {module:activity} activity\r\n         */\r\n        get: function () {\r\n            var myWin = this.window;\r\n            if (util.isUndefinedOrNull(myWin)) {\r\n                return undefined;\r\n            }\r\n            return myWin.activity;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Creates a new window and joins it to the activity\r\n     *\r\n     * @function createWindow\r\n     * @param {string| windowDefinition} windowType The type of the window to be created\r\n     * @returns {Promise<module:activityWindow>}\r\n     */\r\n    ActivityMy.prototype.createWindow = function (windowType) {\r\n        return this._m.createWindow(this.activity, windowType);\r\n    };\r\n    /**\r\n     * Creates a stacked set of windows and joins them to the\r\n     *\r\n     * @function createStackedWindows\r\n     * @param {string[] | windowDefinition[]} windowTypes The types of the windows to be created\r\n     * @param {number} timeout\r\n     * @returns {Promise<module:activityWindow[]>}\r\n     */\r\n    ActivityMy.prototype.createStackedWindows = function (windowTypes, timeout) {\r\n        return this._m.createStackedWindows(this.activity, windowTypes, timeout);\r\n    };\r\n    Object.defineProperty(ActivityMy.prototype, \"context\", {\r\n        /**\r\n         * The current activity context. To update use my.updateContext, to replace my.setContext\r\n         *\r\n         * @var {object} context\r\n         */\r\n        get: function () {\r\n            var activity = this.activity;\r\n            if (util.isUndefined(activity)) {\r\n                return {};\r\n            }\r\n            return activity.context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Updates activity context using the properties from the context argument.\r\n     * If old context is {a:1, b:2, c:3} and invoking updateContext({b:3, c:null}) will result a context\r\n     * be {a:1, b:3}\r\n     *\r\n     * @function updateContext\r\n     * @param {object} context\r\n     * @return {Promise<object>}\r\n     */\r\n    ActivityMy.prototype.updateContext = function (context, callback) {\r\n        var activity = this.activity;\r\n        if (util.isUndefined(activity)) {\r\n            return new Promise(function (resolve, reject) {\r\n                reject(\"Not in activity\");\r\n            });\r\n        }\r\n        return activity.updateContext(context, callback);\r\n    };\r\n    /**\r\n     * Replaces the activity context with a new one.\r\n     *\r\n     * @function setContext\r\n     * @param {object} context   The new context\r\n     * @returns {Promise<Object>}\r\n     */\r\n    ActivityMy.prototype.setContext = function (context, callback) {\r\n        var activity = this.activity;\r\n        if (util.isUndefined(activity)) {\r\n            return new Promise(function (resolve, reject) {\r\n                reject(\"Not in activity\");\r\n            });\r\n        }\r\n        return activity.setContext(context, callback);\r\n    };\r\n    ActivityMy.prototype.onActivityJoined = function (callback) {\r\n        this._myActivityJoinedCallbacks.push(callback);\r\n        // replay joined event\r\n        var myWin = this.window;\r\n        if (!util.isUndefinedOrNull(myWin) && !util.isUndefinedOrNull(myWin.activity)) {\r\n            callback(myWin.activity);\r\n        }\r\n    };\r\n    ActivityMy.prototype.onActivityLeft = function (callback) {\r\n        this._myActivityRemovedCallbacks.push(callback);\r\n    };\r\n    /**\r\n     * Subscribe for context updates\r\n     *\r\n     * @function onContextChanged\r\n     * @param {contextChangedHandler} callback Handler function that will receive context related events\r\n     */\r\n    ActivityMy.prototype.onContextChanged = function (callback) {\r\n        this._myContextUpdateCallbacks.push(callback);\r\n        // publish initial event\r\n        var myWin = this.window;\r\n        if (util.isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var activity = myWin.activity;\r\n        if (util.isUndefinedOrNull(activity)) {\r\n            return;\r\n        }\r\n        // NB: either the callback is added before the activity is recorded in the API, or\r\n        // the activity is recorded before the callback\r\n        // in the former case, when the activity is seen, the callback will be invoked in _notifyMyContextChanged\r\n        // in the latter, the callback will be invoked here\r\n        // in both cases, the callback will be invoked at least once as soon as an activity is recorded\r\n        // see \"long analysis for callback behavior in GW3: several cases\" for full explanation\r\n        callback(activity.context, activity.context, [], activity);\r\n    };\r\n    ActivityMy.prototype.clone = function (options, callback) {\r\n        var act = this.activity;\r\n        return this._m.clone(act, options, callback);\r\n    };\r\n    ActivityMy.prototype.attach = function (activity, tag) {\r\n        var activityId;\r\n        if (typeof activity === \"string\") {\r\n            activityId = activity;\r\n        }\r\n        else {\r\n            activityId = activity.id;\r\n        }\r\n        return this._m.attachActivities(activityId, this.activity.id, tag);\r\n    };\r\n    ActivityMy.prototype.onActivityAttached = function (callback) {\r\n        this._myAttached.push(callback);\r\n    };\r\n    ActivityMy.prototype.onActivityDetached = function (callback) {\r\n        this._myDetached.push(callback);\r\n    };\r\n    ActivityMy.prototype.onAttachedToActivity = function (callback) {\r\n        this._myAttachedTo.push(callback);\r\n    };\r\n    ActivityMy.prototype.onDetachedFromActivity = function (callback) {\r\n        this._myDetachedFrom.push(callback);\r\n    };\r\n    Object.defineProperty(ActivityMy.prototype, \"attached\", {\r\n        get: function () {\r\n            if (!this.activity) {\r\n                return [];\r\n            }\r\n            return this.activity.attached;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.setFrameColor = function (color, callback) {\r\n        if (this.activity) {\r\n            return this.activity.setFrameColor(color, callback);\r\n        }\r\n        else {\r\n            return Promise.resolve(null);\r\n        }\r\n    };\r\n    ActivityMy.prototype.getFrameColor = function () {\r\n        if (this.activity) {\r\n            return this.activity.getFrameColor();\r\n        }\r\n        return \"\";\r\n    };\r\n    ActivityMy.prototype.onFrameColorChanged = function (callback) {\r\n        this._myActivityFrameColorChanged.push(callback);\r\n    };\r\n    ActivityMy.prototype._subscribeMyContextChanged = function (activity, context, delta, removed) {\r\n        var myWin = this.window;\r\n        if (util.isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (util.isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        // ignore events not related to my activity\r\n        if (activity.id !== myActivity.id) {\r\n            return;\r\n        }\r\n        this._notifyMyContextChanged(activity, context, delta, removed);\r\n    };\r\n    ActivityMy.prototype._subscribeMyWindowEvent = function (activity, window, event) {\r\n        if (util.isUndefinedOrNull(this.window)) {\r\n            return;\r\n        }\r\n        // ignore events not related to my window\r\n        if (this.window.id !== window.id) {\r\n            return;\r\n        }\r\n        if (event === entityEvent_1.EntityEventType.ActivityWindowJoinedActivity) {\r\n            this._notifyMyWindowEvent(activity, this._myActivityJoinedCallbacks);\r\n            // NB: tick42-contexts doesn't raise automatically an update event on join if the snapshot matches\r\n            // the currently recorded data\r\n            // revisited: however, it is pushing an update on subscribe() (which is performed by js-activity)\r\n            // long analysis for callback behavior in GW3: several cases\r\n            // 1 client calls onContextChanged before joined-activity arrives\r\n            // then callback is pushed but onContextChanged callback call is skipped\r\n            //    1-1 js-activity handles joined-activity first; it calls js-context subscribe\r\n            //    1-1-1 js-context has not seen the activity so far so it doesn't invoke an update\r\n            //    however, js-context then handles joined-activity and raises an update\r\n            //    1-1-2 js-context has seen the activity, so it raises an update\r\n            //    js-context then handles joined-activity and doesn't raise a second update unless the received snapshot is\r\n            //    different from the last seen context value (can this even happen?)\r\n            //    1-2 js-context handles joined-activity first\r\n            //    since js-activity is not subscribed, whether it raises an update or not, it's not propagated\r\n            //    js-activity then handles joined-activity, performs a subscribe and js-context raises an update\r\n            // 2 joined-activity arrives, whatever updates are raised by js-activity's subscribe() or js-context's\r\n            // message handler are not propagated since the callback is not pushed, client then calls onContextChanged,\r\n            // and the callback is called inside that\r\n            // also, the callback cannot be invoked first in 1 then 2 or first 2 then 1\r\n            // => in all cases, a callback is called exactly once as soon as (it's subscribed && the activity is joined)\r\n            // (in 1-1-2 it *might* be possible to be called twice, first with a slightly out of date context,\r\n            // then with the joined-activity snapshot, see \"different from the last seen context value\", but it's unlikely,\r\n            // and not a real issue anyway)\r\n            // in the HC case, however, case 1 doesn't work since js-context doesn't raise updates on subscribe() nor\r\n            // joining the activity (#deleteme TODO LATER MINOR: verify), so we need to raise it ourselves\r\n            // 2017-09-08: final revisit (@vnikolov)\r\n            // since SBGW_D-163 allows automatic subscription to contexts of pre-existing activities, 1-1-2 no longer works\r\n            // (we might have already seen the latest state before joined-activity so no update will be raised)\r\n            // for this reason I'm invoking notifyMyContextChanged unconditionally - so we might have multiple\r\n            // invocations; if this turns into a problem we might add a guard inside notifyMyContextChanged that\r\n            // checks we're not raising it twice with the same context value\r\n            //\r\n            // we might also get a duplicate raise if the sender of an update is also subscribed to the context\r\n            // if (this._m.usingHc) {\r\n            this._notifyMyContextChanged(activity, activity.context, null, null);\r\n            // }\r\n            // #deleteme TODO LATER MAJOR: what about the cases when we're not watching foreign activity contexts?\r\n        }\r\n        else if (event === entityEvent_1.EntityEventType.ActivityWindowLeftActivity) {\r\n            this._notifyMyWindowEvent(activity, this._myActivityRemovedCallbacks);\r\n            // #deleteme TODO LATER MINOR: should we send null update here?\r\n        }\r\n    };\r\n    ActivityMy.prototype._notifyMyWindowEvent = function (activity, callbackStore) {\r\n        var _this = this;\r\n        callbackStore.forEach(function (element) {\r\n            try {\r\n                element(activity, event);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyMyContextChanged = function (activity, context, delta, removed) {\r\n        var _this = this;\r\n        delta = delta || {};\r\n        removed = removed || [];\r\n        this._myContextUpdateCallbacks.forEach(function (element) {\r\n            try {\r\n                element(context, delta, removed, activity);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyAttached = function (state) {\r\n        var _this = this;\r\n        this._myAttached.forEach(function (cb) {\r\n            try {\r\n                cb(state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyDetached = function (state) {\r\n        var _this = this;\r\n        this._myDetached.forEach(function (cb) {\r\n            try {\r\n                cb(state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyAttachedTo = function (state) {\r\n        var _this = this;\r\n        this._myAttachedTo.forEach(function (cb) {\r\n            try {\r\n                cb(_this.activity, state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyDetachedFrom = function (detached, existing, state) {\r\n        var _this = this;\r\n        this._myDetachedFrom.forEach(function (cb) {\r\n            try {\r\n                cb(detached, existing, state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._subscribeActivitiesAttached = function (newAct, state) {\r\n        var myWin = this.window;\r\n        if (util.isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (util.isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        // ignore events not related to my activity\r\n        if (newAct.id !== myActivity.id) {\r\n            return;\r\n        }\r\n        if (state.windowIds.indexOf(myWin.id) >= 0) {\r\n            this._notifyAttachedTo(state);\r\n            return;\r\n        }\r\n        this._notifyAttached(state);\r\n    };\r\n    ActivityMy.prototype._subscribeActivitiesDetached = function (newAct, oldAct, state) {\r\n        var myWin = this.window;\r\n        if (util.isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (util.isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        // ignore events not related to my activity\r\n        if (oldAct.id === myActivity.id) {\r\n            this._notifyDetached(state);\r\n        }\r\n        if (newAct.id === myActivity.id) {\r\n            this._notifyDetachedFrom(newAct, oldAct, state);\r\n        }\r\n    };\r\n    ActivityMy.prototype._subscribeWindowFrameColorChanged = function (window) {\r\n        var act = this.activity;\r\n        if (!act) {\r\n            return;\r\n        }\r\n        if (!act.owner) {\r\n            return;\r\n        }\r\n        if (act.owner.underlyingWindow.id === window.id) {\r\n            this._myActivityFrameColorChanged.forEach(function (callback) {\r\n                callback(window.frameColor);\r\n            });\r\n        }\r\n    };\r\n    return ActivityMy;\r\n}());\r\nexports.default = ActivityMy;\r\n//# sourceMappingURL=activityMyAPI.js.map\n\n/***/ }),\n/* 42 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gw3Bridge_1 = __webpack_require__(43);\r\nvar hcBridge_1 = __webpack_require__(12);\r\nvar activityMyAPI_1 = __webpack_require__(41);\r\nvar activityManager_1 = __webpack_require__(44);\r\nvar activityAPI_1 = __webpack_require__(39);\r\nvar activityAGM_1 = __webpack_require__(9);\r\nvar logger_1 = __webpack_require__(4);\r\nvar util = __webpack_require__(1);\r\nvar promiseExtensions_1 = __webpack_require__(8);\r\n/**\r\n * Activity context update handler - used when we want to subscribe for context changes in a specific activity\r\n *\r\n * @callback contextChangedHandler\r\n * @param {Object} context The full context of the activity after the update\r\n * @param {Object} delta The delta (contains the added/removed keys at top level)\r\n * @param {string[]} removed  Array of keys that were removed from context\r\n * @param {module:activity} activity The activity instance that owns the context\r\n *\r\n */\r\n/**\r\n * @callback windowEventHandler Handler for ActivityWindow events - e.g window joined to activity, window removed from\r\n * activity\r\n * @param {module:activity} activity\r\n * @param {module:activityWindow} window\r\n * @param {string} event 'joined' or 'removed'\r\n */\r\n/**\r\n * @callback activityStatusChangeHandler Handler for activity status changed events\r\n * @param {module:activity} activity\r\n * @param {activityStatus} newStatus\r\n * @param {activityStatus} oldStatus\r\n *\r\n */\r\n/**\r\n * @typedef {Object} windowDefinition\r\n * @property {string} type\r\n * @property {string} name\r\n * @property {Object} arguments\r\n */\r\n/**\r\n * @typedef {Object} bounds\r\n * @param {number} top\r\n * @param {number} left\r\n * @param {number} width\r\n * @param {number} height\r\n *\r\n */\r\n/**\r\n * @typedef {Object} agmInstance\r\n * @param {string} application\r\n * @param {string} pid\r\n * @param {string} machine\r\n * @param {string} user\r\n * @param {string} environment\r\n * @param {string} region\r\n */\r\n// Factory function for activity API\r\nvar ActivityModule = /** @class */ (function () {\r\n    function ActivityModule(config) {\r\n        var _this = this;\r\n        if (!config) {\r\n            throw new Error(\"config can not be null\");\r\n        }\r\n        // set log level\r\n        if (!util.isUndefined(config.logLevel)) {\r\n            logger_1.Logger.Level = config.logLevel;\r\n        }\r\n        if (!util.isUndefinedOrNull(config.logger)) {\r\n            logger_1.Logger.GlueLogger = config.logger;\r\n        }\r\n        // choose the correct bridge\r\n        var bridge;\r\n        this._isUsingHCImplementation = config.gdMajorVersion === 2;\r\n        this._isUsingGW3Implementation = ActivityModule.checkIsUsingGW3Implementation(config.connection);\r\n        if (this._isUsingHCImplementation) {\r\n            bridge = new hcBridge_1.default(undefined, config.windows, config.appManagerGetter, config.mode, config.typesToTrack);\r\n        }\r\n        else if (this._isUsingGW3Implementation) {\r\n            bridge = new gw3Bridge_1.default(config.connection, config.logger, config.contexts, config);\r\n        }\r\n        else {\r\n            throw new Error(\"Unable to instantiate activity bridge implementation\");\r\n        }\r\n        if (!bridge) {\r\n            throw new Error(\"A bridge to native activity is needed to create activity lib.\");\r\n        }\r\n        activityAGM_1.ActivityAGM.AGM = config.agm;\r\n        var activityManager = new activityManager_1.default(bridge, !config.disableAutoAnnounce, config.windows);\r\n        var my = new activityMyAPI_1.default(activityManager, config.windows);\r\n        this._api = new activityAPI_1.ActivityAPI(activityManager, my);\r\n        this._readyPromise = activityManager.ready().then(function (_) { return _this; });\r\n    }\r\n    ActivityModule.checkIsUsingGW3Implementation = function (connection) {\r\n        return connection.protocolVersion === 3;\r\n    };\r\n    Object.defineProperty(ActivityModule.prototype, \"api\", {\r\n        get: function () {\r\n            return this._api;\r\n        },\r\n        set: function (value) {\r\n            this._api = value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityModule.prototype, \"isUsingHCImplementation\", {\r\n        get: function () {\r\n            return this._isUsingHCImplementation;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityModule.prototype, \"isUsingGW3Implementation\", {\r\n        get: function () {\r\n            return this._isUsingGW3Implementation;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityModule.prototype.ready = function (callback) {\r\n        return promiseExtensions_1.nodeify(this._readyPromise, callback);\r\n    };\r\n    return ActivityModule;\r\n}());\r\nexports.ActivityModule = ActivityModule;\r\n//# sourceMappingURL=activityModule.js.map\n\n/***/ }),\n/* 43 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(process) {\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityType_1 = __webpack_require__(10);\r\nvar windowType_1 = __webpack_require__(16);\r\nvar entityEvent_1 = __webpack_require__(2);\r\nvar activity_1 = __webpack_require__(14);\r\nvar activityWindow_1 = __webpack_require__(15);\r\nvar activityStatus_1 = __webpack_require__(13);\r\nvar gwMessageSuccess = \"success\";\r\nvar gwMmessageError = \"error\";\r\nvar gwMessageAddActivityTypes = \"add-types\";\r\nvar gwMmessageActivityTypesAdded = \"types-added\";\r\nvar gwMessageRemoveActivityTypes = \"remove-types\";\r\nvar gwMessageActivityTypesRemoved = \"types-removed\";\r\nvar gwMessageActivityCreated = \"created\";\r\nvar gwMessageActivityDestroyed = \"destroyed\";\r\nvar gwMessageActivityInitiated = \"initiated\";\r\nvar gwMmessageJoinActivity = \"join-activity\";\r\nvar gwMessageJoinedActivity = \"joined\";\r\nvar gwMessageActivityJoined = \"activity-joined\";\r\nvar gwMessageLeaveActivity = \"leave-activity\";\r\nvar gwMessageActivityLeft = \"left\";\r\nvar gwNmessageMergeActivities = \"merge\";\r\nvar gwMessageSplitActivities = \"split\";\r\nvar gwMessageChildrenChanged = \"children-changed\";\r\nvar gwMessageAddPeerFactories = \"add-peer-factories\";\r\nvar gwMessagePeerFactoriesAdded = \"peer-factories-added\";\r\nvar gwMessageRemovePeerFactories = \"remove-peer-factories\";\r\nvar gwMessagePeerFactoriesRemoved = \"peer-factories-removed\";\r\nvar gwMessageCreateActivity = \"create\";\r\nvar gwMessageCreatePeer = \"create-peer\";\r\nvar gwMessagePeerRequested = \"peer-requested\";\r\nvar gwMessageReady = \"ready\";\r\nvar gwMessagePeerCreated = \"peer-created\";\r\nvar gwMessageDestroyActivity = \"destroy\";\r\nvar gwMessageDisposePeer = \"dispose-peer\";\r\nvar GW3Bridge = /** @class */ (function () {\r\n    function GW3Bridge(connection, logger, contexts, config) {\r\n        var _this = this;\r\n        // callbacks\r\n        this._activityChangeCallbacks = [];\r\n        this._activityTypeStatusChangeCallbacks = [];\r\n        this._activityWindowChangeCallbacks = [];\r\n        this._windowTypeStatusChangeCallbacks = [];\r\n        // state tracking\r\n        this._peerIdAndFactoryIdToPeerType = {};\r\n        this._peerFactoriesRegisteredByUs = {};\r\n        this._gw3Subscriptions = [];\r\n        this._contextSubscriptions = {};\r\n        this._activityTypesInitiatedFromMe = {};\r\n        this._config = config;\r\n        this._connection = connection;\r\n        this._logger = logger;\r\n        this._contexts = contexts;\r\n        this._sessionJoinedPromise = new Promise(function (resolve /*, reject */) {\r\n            _this._sessionJoinedPromiseResolve = resolve;\r\n        });\r\n        this._activityJoinedPromise = new Promise(function (resolve /*, reject */) {\r\n            _this._activityJoinedPromiseResolve = resolve;\r\n        });\r\n        if (!this._config.activityId) {\r\n            this._activityJoinedPromiseResolve({});\r\n        }\r\n        this._gw3Session = connection.domain(\"activity\", logger.subLogger(\"session:com.tick42.activity\"), [\"joined\", \"initiated\", \"peer-created\"]);\r\n    }\r\n    GW3Bridge.activityTypeGwMessageEntityToActivityType = function (entity, description) {\r\n        var nameToWindowType = function (windowName) {\r\n            return new windowType_1.default(windowName, undefined);\r\n        };\r\n        return new activityType_1.default(entity.name, entity.owner_type && nameToWindowType(entity.owner_type), entity.helper_types && entity.helper_types.map(nameToWindowType), description);\r\n    };\r\n    GW3Bridge.peerFactoryGwMessageEntityToWindowType = function (entity) {\r\n        return new windowType_1.default(entity.peer_type, \r\n        /* #deleteme TODO: review - appmanager configuration? */ function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.activityGwMessageToActivity = function (msg, status) {\r\n        var ownerId = msg.owner !== undefined ? msg.owner.peer_id : undefined;\r\n        return new activity_1.default(msg.activity_id, msg.activity_type, status, msg.context_snapshot, ownerId);\r\n    };\r\n    GW3Bridge.activityToActivityStatusChangeEvent = function (act) {\r\n        return new entityEvent_1.EntityEvent(act, new entityEvent_1.ActivityStatusChangeEventContext(act.status, undefined));\r\n    };\r\n    Object.defineProperty(GW3Bridge.prototype, \"bridgeType\", {\r\n        get: function () {\r\n            return \"GW3\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3Bridge.prototype.init = function () {\r\n        var _this = this;\r\n        // activity types\r\n        this.forwardActivityTypeMessagesToStatusEventHandlers();\r\n        // activities\r\n        this.subscribe(gwMessageActivityCreated, this.handleActivityCreatedMessage);\r\n        this.subscribe(gwMessageActivityDestroyed, this.handleActivityDestroyedMessage);\r\n        this.forwardActivityMessagesToStatusEventHandlers();\r\n        this.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers();\r\n        // window types / peer factories\r\n        // NB: this forward must happen before the handlePeerFactoriesRemoved subscription\r\n        // since the latter clears state which is used by peerFactoryIdAndOwnerIdToWindowType\r\n        this.forwardPeerFactoryMessagesToStatusEventHandlers();\r\n        this.forwardPeerFactoryMessagesToPeerFactoryRequests();\r\n        this.subscribe(gwMessagePeerFactoriesAdded, this.handlePeerFactoriesAdded);\r\n        this.subscribe(gwMessagePeerFactoriesRemoved, this.handlePeerFactoriesRemoved);\r\n        // activity windows\r\n        this.forwardActivityWindowMessagesToEventHandlers();\r\n        //\r\n        this.subscribe(gwMessageDisposePeer, \r\n        /*(msg)*/ function () {\r\n            if (_this._config.disposeRequestHandling === \"dispose\") {\r\n                _this.dispose();\r\n                return;\r\n            }\r\n            // #deleteme TODO: review - maybe leave activity before dying?\r\n            if (_this._config.disposeRequestHandling === \"exit\") {\r\n                if (typeof window !== \"undefined\" &&\r\n                    typeof window.close === \"function\") {\r\n                    window.close();\r\n                    return;\r\n                }\r\n                if (typeof process !== \"undefined\" &&\r\n                    typeof process.exit === \"function\") {\r\n                    process.exit();\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n        // #deleteme TODO: logging\r\n        // start domain join handshake\r\n        this._gw3Session.onJoined(function () {\r\n            if (_this._config.mode === \"trackMyOnly\" ||\r\n                _this._config.mode === \"trackMyTypeAndInitiatedFromMe\") {\r\n                _this._sessionJoinedPromiseResolve(_this);\r\n            }\r\n            else {\r\n                _this._gw3Session\r\n                    .send({\r\n                    type: \"subscribe\",\r\n                    activity_types: (_this._config.mode === \"trackAll\" ? [] :\r\n                        _this._config.mode === \"trackTypes\" ? _this._config.typesToTrack : [])\r\n                })\r\n                    .then(function () {\r\n                    _this._sessionJoinedPromiseResolve(_this);\r\n                });\r\n            }\r\n        });\r\n        this._gw3Session.join();\r\n    };\r\n    GW3Bridge.prototype.dispose = function () {\r\n        var _this = this;\r\n        this._gw3Subscriptions.forEach(function (sub) { return sub && _this._connection.off(sub); });\r\n        this._gw3Subscriptions.length = 0;\r\n        // #deleteme todo review\r\n        // this._contexts.dispose();\r\n    };\r\n    // ActivityBridge interface\r\n    GW3Bridge.prototype.ready = function () {\r\n        return Promise.all([this._sessionJoinedPromise, this._activityJoinedPromise]);\r\n    };\r\n    GW3Bridge.prototype.initReady = function () {\r\n        return this._sessionJoinedPromise;\r\n    };\r\n    GW3Bridge.prototype.onActivityTypeStatusChange = function (callback) {\r\n        this._activityTypeStatusChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.registerActivityType = function (activityTypeName, ownerWindow, helperWindows, config, description) {\r\n        var _this = this;\r\n        var entity = {};\r\n        entity.name = activityTypeName;\r\n        var toActivityPeerConfig = function (windowDefinition) { return ({ type: windowDefinition.type, name: windowDefinition.name, configuration: windowDefinition }); };\r\n        entity.owner_type = toActivityPeerConfig(ownerWindow);\r\n        entity.helper_types = helperWindows.map(toActivityPeerConfig);\r\n        return this._gw3Session\r\n            .send({\r\n            type: gwMessageAddActivityTypes,\r\n            types: [entity]\r\n        })\r\n            .then(function () {\r\n            var activityType = GW3Bridge.activityTypeGwMessageEntityToActivityType(entity, description);\r\n            _this.invokeCallbacks(_this._activityTypeStatusChangeCallbacks, new entityEvent_1.EntityEvent(activityType, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added)), gwMessageAddActivityTypes);\r\n            return activityType;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.unregisterActivityType = function (activityTypeName) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: gwMessageRemoveActivityTypes,\r\n            types: [activityTypeName]\r\n        })\r\n            .then(function () {\r\n            var activityType = new activityType_1.default(activityTypeName, undefined, undefined, undefined);\r\n            _this.invokeCallbacks(_this._activityTypeStatusChangeCallbacks, new entityEvent_1.EntityEvent(activityType, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Removed)), gwMessageAddActivityTypes);\r\n        });\r\n    };\r\n    GW3Bridge.prototype.onWindowTypeStatusChange = function (callback) {\r\n        this._windowTypeStatusChangeCallbacks.push(callback);\r\n    };\r\n    // NB: in GW3, peer factories have ids separate from the ids of the peers they create\r\n    // in this implementation we keep the two equal for simplicity\r\n    // NB: we assume only one peer will register a peer factory for a given type; otherwise the\r\n    // add/remove window types event logic will get messy\r\n    GW3Bridge.prototype.registerWindowFactory = function (windowType, factory, parameters) {\r\n        var _this = this;\r\n        if (this._peerFactoriesRegisteredByUs[windowType]) {\r\n            return Promise.reject(new Error(\"Factory for windowType \" + windowType + \" already registered.\"));\r\n        }\r\n        this._peerFactoriesRegisteredByUs[windowType] = factory;\r\n        // #deleteme TODO: review success/failure code paths\r\n        // #deleteme TODO: review - should we create the window type here?\r\n        var entity = {\r\n            id: windowType,\r\n            peer_type: windowType,\r\n            configuration: parameters\r\n        };\r\n        return this._gw3Session.send({\r\n            type: gwMessageAddPeerFactories,\r\n            factories: [entity]\r\n        })\r\n            .then(function () {\r\n            _this.invokeCallbacks(_this._windowTypeStatusChangeCallbacks, new entityEvent_1.EntityEvent(GW3Bridge.peerFactoryGwMessageEntityToWindowType(entity), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added)), gwMessageAddPeerFactories);\r\n        })\r\n            .catch(function () {\r\n            delete _this._peerFactoriesRegisteredByUs[windowType];\r\n        });\r\n    };\r\n    GW3Bridge.prototype.unregisterWindowFactory = function (windowType) {\r\n        var _this = this;\r\n        var factory = this._peerFactoriesRegisteredByUs[windowType];\r\n        if (!factory) {\r\n            return Promise.reject(new Error(\"Factory for windowType \" + windowType + \" not registered.\"));\r\n        }\r\n        delete this._peerFactoriesRegisteredByUs[windowType];\r\n        return this._gw3Session.send({\r\n            type: gwMessageRemovePeerFactories,\r\n            factory_ids: [windowType]\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._windowTypeStatusChangeCallbacks, new entityEvent_1.EntityEvent(new windowType_1.default(windowType, undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Removed)), gwMessageAddPeerFactories);\r\n        });\r\n    };\r\n    GW3Bridge.prototype.onActivityStatusChange = function (callback) {\r\n        this._activityChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.initiateActivity = function (activityType, context, configuration) {\r\n        var _this = this;\r\n        var initiateMsg = {\r\n            type: gwMessageCreateActivity,\r\n            activity_type: activityType,\r\n            initial_context: context,\r\n        };\r\n        if (this.isOverrideTypeDefinition(configuration)) {\r\n            initiateMsg.types_override = {\r\n                owner_type: { type: configuration.owner.type, name: configuration.owner.name, configuration: configuration.owner },\r\n                helper_types: configuration.helpers && configuration.helpers.map(function (wd) { return ({ type: wd.type, name: wd.name, configuration: wd }); })\r\n            };\r\n        }\r\n        else {\r\n            initiateMsg.configuration = configuration && configuration.map(function (wd) { return ({ type: wd.type, name: wd.name, configuration: wd }); });\r\n        }\r\n        return this.sendCreateAndMapResultingMessagesToPromise(initiateMsg, gwMessageActivityInitiated, function (msg, requestId) { return msg.request_id === requestId; }, gwMessageActivityCreated, function (msg, requestId, initMsg) { return msg.activity_id === initMsg.activity_id; }, gwMessageActivityDestroyed, function (msg, requestId, initMsg) { return msg.activity_id === initMsg.activity_id; }, function (msg) { return msg.activity_id; }).then(function (id) {\r\n            if (_this._config.mode === \"trackMyTypeAndInitiatedFromMe\") {\r\n                if (!_this._activityTypesInitiatedFromMe[activityType]) {\r\n                    _this._activityTypesInitiatedFromMe[activityType] = true;\r\n                    return _this._gw3Session\r\n                        .send({\r\n                        type: \"subscribe\",\r\n                        activity_types: [activityType]\r\n                    })\r\n                        .then(function () {\r\n                        return id;\r\n                    });\r\n                }\r\n            }\r\n            return id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.stopActivity = function (activity) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageDestroyActivity,\r\n            activity_id: activity.id,\r\n            // #deleteme TODO: review - reason?\r\n            reason_uri: \"com.tick42.glue.activity.constants.destroyReason.general\",\r\n            reason: \"Destroying activity\"\r\n        }).then(function (_) { return true; });\r\n    };\r\n    GW3Bridge.prototype.updateActivityContext = function (activity, context, fullReplace, removedKeys) {\r\n        if (fullReplace) {\r\n            // this will currently fail on GW3\r\n            return this._contexts.set(activity.id, context);\r\n        }\r\n        else {\r\n            removedKeys = removedKeys || [];\r\n            for (var _i = 0, removedKeys_1 = removedKeys; _i < removedKeys_1.length; _i++) {\r\n                var x = removedKeys_1[_i];\r\n                context[x] = null;\r\n            }\r\n            return this._contexts.update(activity.id, context);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.announceWindow = function (windowType, activityWindowId) {\r\n        // in the GW3 case we are only joined to an activity after we announce ourselves\r\n        // so all announcement calls should go in 'registerWindow', not here\r\n        // (registerWindow registers a window that's not part of an activity, at least yet)\r\n        throw new Error(\"Invalid operation 'announceWindow' for GW3 protocol\");\r\n    };\r\n    GW3Bridge.prototype.registerWindow = function (type, name, independent) {\r\n        var shouldSendReady = this._connection.gatewayToken;\r\n        var peerId = this._connection.peerId;\r\n        // if running in GD3 (glue42gd is there) we should send ready only if we have the activityInfo object in glue\r\n        if (typeof window !== \"undefined\") {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                shouldSendReady = glue42gd.activityInfo !== undefined;\r\n            }\r\n        }\r\n        if (shouldSendReady) {\r\n            this._gw3Session.send({\r\n                type: gwMessageReady,\r\n            });\r\n        }\r\n        this.invokeCallbacks(this._activityWindowChangeCallbacks, new entityEvent_1.EntityEvent(new activityWindow_1.default(peerId, name, type, undefined, undefined, independent, this.generateWindowGetter(peerId), undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added)), \"register window\");\r\n        return Promise.resolve(peerId);\r\n    };\r\n    GW3Bridge.prototype.onActivityWindowChange = function (callback) {\r\n        this._activityWindowChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.createWindow = function (activityId, windowDefinition) {\r\n        var _this = this;\r\n        // if the user hasn't provided a layout option but has some of left,top,width,height\r\n        // insert a layout\r\n        if (!windowDefinition.layout) {\r\n            if (windowDefinition.left || windowDefinition.width || windowDefinition.height || windowDefinition.top) {\r\n                windowDefinition.layout = {\r\n                    mode: \"pixels\",\r\n                    cellSize: 1,\r\n                };\r\n            }\r\n        }\r\n        return this.sendCreateAndMapResultingMessagesToPromise({\r\n            type: gwMessageCreatePeer,\r\n            peer_type: windowDefinition.type,\r\n            configuration: windowDefinition,\r\n            activity_id: activityId,\r\n        }, undefined, undefined, gwMessagePeerCreated, function (msg, requestId) { return msg.request_id === requestId; }, undefined, undefined, function (msg) { return msg.created_id; })\r\n            .then(function (id) {\r\n            return _this.joinActivity(activityId, id)\r\n                .then(function () {\r\n                return id;\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.closeWindow = function (id) {\r\n        return this._gw3Session.send({\r\n            destroy_peer_id: id\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.getAnnouncementInfo = function () {\r\n        var activityId = this._config.activityId || (this._config.announcementInfo && this._config.announcementInfo.activityId);\r\n        var activityWindowType = (this._config.announcementInfo && this._config.announcementInfo.activityWindowType);\r\n        var activityWindowIndependent = (this._config.announcementInfo && this._config.announcementInfo.activityWindowIndependent);\r\n        var activityWindowName = (this._config.announcementInfo && this._config.announcementInfo.activityWindowName);\r\n        if (typeof window !== \"undefined\" &&\r\n            typeof window.location !== \"undefined\" &&\r\n            window.location.search &&\r\n            typeof URLSearchParams === \"function\") {\r\n            var searchParams = new URLSearchParams(location.search.slice(1));\r\n            activityWindowType = activityWindowType || searchParams.get(\"t42PeerType\");\r\n            activityWindowType = activityWindowType || searchParams.get(\"t42ActivityWindowType\");\r\n            if (typeof activityWindowIndependent === \"undefined\") {\r\n                activityWindowIndependent = searchParams.get(\"t42ActivityWindowIndependent\");\r\n            }\r\n            activityWindowName = activityWindowName || searchParams.get(\"t42ActivityWindowName\");\r\n            activityId = activityId || searchParams.get(\"t42ActivityId\");\r\n        }\r\n        activityWindowType = activityWindowType || \"unknown\";\r\n        activityWindowIndependent = activityWindowIndependent || false;\r\n        activityWindowName = activityWindowName || this._connection.peerId;\r\n        return {\r\n            activityWindowId: undefined,\r\n            activityId: activityId,\r\n            activityWindowType: activityWindowType,\r\n            activityWindowIndependent: activityWindowIndependent,\r\n            activityWindowName: activityWindowName,\r\n        };\r\n    };\r\n    GW3Bridge.prototype.joinActivity = function (activityId, windowId) {\r\n        var _this = this;\r\n        return this._gw3Session.send({\r\n            type: gwMmessageJoinActivity,\r\n            target_id: windowId,\r\n            activity_id: activityId\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new entityEvent_1.EntityEvent(new activityWindow_1.default(windowId, undefined, undefined, activityId, undefined, undefined, _this.generateWindowGetter(windowId), undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowJoinedActivity)), \"activity joined - ActivityWindow\");\r\n            _this.invokeCallbacks(_this._activityChangeCallbacks, new entityEvent_1.EntityEvent(new activity_1.default(activityId, undefined, new activityStatus_1.ActivityStatus(\"created\", undefined, undefined), undefined, undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Updated)), \"activity joined - Activity\");\r\n        });\r\n    };\r\n    GW3Bridge.prototype.leaveActivity = function (activityId, windowId) {\r\n        var _this = this;\r\n        return this._gw3Session.send({\r\n            type: gwMessageLeaveActivity,\r\n            target_id: windowId,\r\n            activity_id: activityId\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new entityEvent_1.EntityEvent(new activityWindow_1.default(windowId, undefined, undefined, null, undefined, undefined, _this.generateWindowGetter(windowId), undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowLeftActivity)), \"activity left - ActivityWindow\");\r\n            _this.invokeCallbacks(_this._activityChangeCallbacks, new entityEvent_1.EntityEvent(new activity_1.default(activityId, undefined, new activityStatus_1.ActivityStatus(\"created\", undefined, undefined), undefined, undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Updated)), \"activity left - Activity\");\r\n        });\r\n    };\r\n    // purposefully returning empty arrays\r\n    GW3Bridge.prototype.getActivityTypes = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getWindowTypes = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getActivities = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getActivityWindows = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    // N/A\r\n    // #deleteme TODO: ignore for now\r\n    // POSTPONED\r\n    GW3Bridge.prototype.createStackedWindows = function (id, windowDefinitions, timeout) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.getWindowBounds = function (id) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.setWindowBounds = function (id, bounds) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.activateWindow = function (id, focus) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.setWindowVisibility = function (id, visible) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.cloneActivity = function (id, cloneOptions) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.attachActivities = function (from, to, tag) {\r\n        return this._gw3Session.send({\r\n            type: gwNmessageMergeActivities,\r\n            into: to,\r\n            merge: from\r\n        });\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.detachActivities = function (activityId, newActivityInfo) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageSplitActivities,\r\n            from: activityId,\r\n        }).then(function () { return \"\"; });\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.onActivitiesAttached = function (callback) {\r\n        // POSTPONED\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.onActivitiesDetached = function (callback) {\r\n        // POSTPONED\r\n    };\r\n    GW3Bridge.prototype.onActivityAttachedDescriptorsRefreshed = function (callback) {\r\n        // POSTPONED\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.getAttachedDescriptors = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    // helpers\r\n    // Protocol handling\r\n    GW3Bridge.prototype.getRandomRequestId = function () {\r\n        return this._connection.peerId + \":\" + Math.floor(Math.random() * 1e9) + \"\";\r\n    };\r\n    GW3Bridge.prototype.forwardAddedAndRemovedMessagesToEventHandler = function (addedMessageType, removedMessageType, mapper, handlers) {\r\n        var getGetEntityEvent = function (isAdded) { return function (entity) { return new entityEvent_1.EntityEvent(entity, new entityEvent_1.EntityEventContext(isAdded ?\r\n            entityEvent_1.EntityEventType.Added :\r\n            entityEvent_1.EntityEventType.Removed)); }; };\r\n        var sub1;\r\n        var sub2;\r\n        sub1 = addedMessageType && this.forwardMessageToEventHandler(addedMessageType, function (msg) { return mapper(msg, true); }, getGetEntityEvent(true), handlers);\r\n        sub2 = removedMessageType && this.forwardMessageToEventHandler(removedMessageType, function (msg) { return mapper(msg, false); }, getGetEntityEvent(false), handlers);\r\n        return [sub1, sub2].filter(function (x) { return x; });\r\n    };\r\n    GW3Bridge.prototype.forwardMessageToEventHandler = function (messageType, mapper, getEntityEvent, handler) {\r\n        return this.subscribe(messageType, function (msg) {\r\n            mapper(msg)\r\n                .forEach(function (ent) {\r\n                return handler.forEach(function (h) { return h(getEntityEvent(ent, msg)); });\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.sendCreateAndMapResultingMessagesToPromise = function (msg, initiatedMessageType, initiatedMessageFilter, createdMessageType, createdMessageFilter, cancelledMessageType, cancelledMessageFilter, createdMessageToPromiseResolution) {\r\n        var _this = this;\r\n        var reqId = this.getRandomRequestId();\r\n        var resolveCreatedPromise;\r\n        var rejectCreatedPromise;\r\n        var createdPromise = new Promise(function (resolve, reject) {\r\n            resolveCreatedPromise = resolve;\r\n            rejectCreatedPromise = reject;\r\n        });\r\n        var initiatedMessageAck = null;\r\n        var initiatedSubscription;\r\n        var createdSubscription;\r\n        var cancelledSubscription;\r\n        var errorSubscription;\r\n        var dropSubscriptions = function () {\r\n            _this.dropSubscription(initiatedSubscription);\r\n            _this.dropSubscription(createdSubscription);\r\n            _this.dropSubscription(cancelledSubscription);\r\n            _this.dropSubscription(errorSubscription);\r\n        };\r\n        initiatedSubscription = initiatedMessageType &&\r\n            this.subscribe(initiatedMessageType, function (msg4) {\r\n                if (!initiatedMessageFilter(msg4, reqId)) {\r\n                    return;\r\n                }\r\n                initiatedMessageAck = msg4;\r\n                _this.dropSubscription(initiatedSubscription);\r\n            });\r\n        createdSubscription =\r\n            this.subscribe(createdMessageType, function (msg1) {\r\n                if (!createdMessageFilter(msg1, reqId, initiatedMessageAck)) {\r\n                    return;\r\n                }\r\n                resolveCreatedPromise(createdMessageToPromiseResolution(msg1));\r\n            });\r\n        cancelledSubscription = cancelledMessageType &&\r\n            this.subscribe(cancelledMessageType, function (msg2) {\r\n                if (!cancelledMessageFilter(msg2, reqId, initiatedMessageAck)) {\r\n                    return;\r\n                }\r\n                rejectCreatedPromise(msg2);\r\n            });\r\n        errorSubscription = cancelledMessageType &&\r\n            this.subscribe(gwMmessageError, function (msg3) {\r\n                if (msg3.request_id !== reqId) {\r\n                    return;\r\n                }\r\n                rejectCreatedPromise(msg3);\r\n            });\r\n        msg.request_id = reqId;\r\n        var toReturn = this._gw3Session\r\n            .send(msg)\r\n            .then(function () {\r\n            return createdPromise;\r\n        });\r\n        toReturn.then(dropSubscriptions, dropSubscriptions);\r\n        return toReturn;\r\n    };\r\n    // Entity Mapping\r\n    GW3Bridge.prototype.peerFactoryIdAndOwnerIdToWindowType = function (factoryId, ownerId) {\r\n        var peerType = this._peerIdAndFactoryIdToPeerType[ownerId + \":\" + factoryId];\r\n        if (!peerType) {\r\n            return null;\r\n        }\r\n        else {\r\n            return new windowType_1.default(peerType, undefined);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (messageType, handler) {\r\n        var _this = this;\r\n        var sub = this._connection.on(\r\n        // #deleteme TODO: review first arg\r\n        \"js-activity\", messageType, function (msg) { return handler.bind(_this)(msg); });\r\n        this._gw3Subscriptions.push(sub);\r\n        return sub;\r\n    };\r\n    GW3Bridge.prototype.dropSubscription = function (subscription) {\r\n        if (subscription) {\r\n            this._connection.off(subscription);\r\n            delete this._gw3Subscriptions[this._gw3Subscriptions.indexOf(subscription)];\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeCallbacks = function (callbacks, event, description) {\r\n        var _this = this;\r\n        callbacks.forEach(function (cb) {\r\n            try {\r\n                cb(event);\r\n            }\r\n            catch (err) {\r\n                _this._logger.error(\"Error in \" + (description || event.context.type) + \" callback: \" + JSON.stringify(err));\r\n            }\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handleActivityCreatedMessage = function (msg) {\r\n        if (!msg.context_id) {\r\n            this._logger.error(\"Activity created with unknown context_id: \" + msg.activity_id);\r\n        }\r\n        else {\r\n            if (!this._contextSubscriptions[msg.activity_id]) {\r\n                this.subscribeToContext(msg);\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContext = function (msg) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var activityId, _a, _b;\r\n            var _this = this;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        activityId = msg.activity_id;\r\n                        _a = this._contextSubscriptions;\r\n                        _b = activityId;\r\n                        return [4 /*yield*/, this._contexts.subscribe(activityId, function (data, updated, removed) {\r\n                                var event = new entityEvent_1.EntityEvent(new activity_1.default(activityId, undefined, undefined, data, undefined), new entityEvent_1.ActivityContextChangedEventContext(data, updated, removed));\r\n                                _this.invokeCallbacks(_this._activityChangeCallbacks, event, \"context updated\");\r\n                            })];\r\n                    case 1:\r\n                        _a[_b] =\r\n                            _c.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handleActivityDestroyedMessage = function (msg) {\r\n        var unsubscribeContext = this._contextSubscriptions[msg.activity_id];\r\n        if (typeof unsubscribeContext === \"function\") {\r\n            unsubscribeContext();\r\n        }\r\n        delete this._contextSubscriptions[msg.activity_id];\r\n    };\r\n    GW3Bridge.prototype.handlePeerFactoriesAdded = function (msg) {\r\n        var _this = this;\r\n        msg.factories.forEach(function (entity) {\r\n            _this._peerIdAndFactoryIdToPeerType[msg.owner_id + \":\" + entity.id] = entity.peer_type;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handlePeerFactoriesRemoved = function (msg) {\r\n        var _this = this;\r\n        msg.factory_ids.forEach(function (factoryId) {\r\n            delete _this._peerIdAndFactoryIdToPeerType[msg.owner_id + \":\" + factoryId];\r\n        });\r\n    };\r\n    GW3Bridge.prototype.forwardActivityTypeMessagesToStatusEventHandlers = function () {\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMmessageActivityTypesAdded, gwMessageActivityTypesRemoved, function (msg, isAdded) { return isAdded\r\n            ? msg.types.map(function (t) { return GW3Bridge.activityTypeGwMessageEntityToActivityType(t, undefined); })\r\n            : msg.types.map(function (t) { return new activityType_1.default(t.name, undefined, undefined, undefined); }); }, this._activityTypeStatusChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers = function () {\r\n        var _this = this;\r\n        // if we're created as part of this activity, the JOINED ACTIVITY is\r\n        // the first time we'll hear about it; so let's record the participants\r\n        for (var _i = 0, _a = [gwMessageActivityCreated, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var activityCreatedMessage = _a[_i];\r\n            this.forwardMessageToEventHandler(activityCreatedMessage, function (msg) {\r\n                return ([msg.owner])\r\n                    .concat(msg.participants || [])\r\n                    .map(function (info) { return new activityWindow_1.default(info.peer_id, info.name, info.type, msg.activity_id, undefined, undefined, _this.generateWindowGetter(info.peer_id), undefined); });\r\n            }, function (ent, msg) { return new entityEvent_1.EntityEvent(ent, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowJoinedActivity)); }, this._activityWindowChangeCallbacks);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.forwardActivityMessagesToStatusEventHandlers = function () {\r\n        // see dot-net-activity\\Activity\\ActivityState.cs\r\n        for (var _i = 0, _a = [gwMessageActivityCreated, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var createdMessage = _a[_i];\r\n            this.forwardMessageToEventHandler(createdMessage, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new activityStatus_1.ActivityStatus(\"started\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        }\r\n        this.forwardMessageToEventHandler(gwMessageActivityDestroyed, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new activityStatus_1.ActivityStatus(\"destroyed\", msg.reason, new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        this.forwardMessageToEventHandler(gwMessageActivityInitiated, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new activityStatus_1.ActivityStatus(\"created\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardPeerFactoryMessagesToStatusEventHandlers = function () {\r\n        var _this = this;\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerFactoriesAdded, gwMessagePeerFactoriesRemoved, function (msg, isAdded) { return isAdded\r\n            ? msg.factories.map(GW3Bridge.peerFactoryGwMessageEntityToWindowType)\r\n            : msg.factory_ids.map(function (id) { return _this.peerFactoryIdAndOwnerIdToWindowType(id, msg.owner_id); }).filter(function (x) { return x != null; }); }, this._windowTypeStatusChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardPeerFactoryMessagesToPeerFactoryRequests = function () {\r\n        var _this = this;\r\n        this.subscribe(gwMessagePeerRequested, function (msg) {\r\n            var factory = _this._peerFactoriesRegisteredByUs[msg.peer_factory];\r\n            if (!factory) {\r\n                _this._gw3Session.send({\r\n                    type: gwMmessageError,\r\n                    request_id: msg.request_id,\r\n                    reason: \"Unknown peer factory \" + msg.peer_factory\r\n                });\r\n                return;\r\n            }\r\n            try {\r\n                var configuration = msg.configuration || {};\r\n                // NB: peer factories (or whoever they're delegating to) need to support whatever activity\r\n                // environment (GW3, HC) we're targeting when they're creating peers\r\n                // the manager is env agnostic, the bridge will augment the configuration with whatever's required\r\n                // NB: also, since peers are requested in two ways (single peer with just its configuration,\r\n                // or peer created as part of new activity, where the factory receives the aggregate config of\r\n                // all peers, combined from ADD ACTIVITY TYPE and CREATE ACTIVITY), the peer factories need to\r\n                // be able to handle both configuration structures intelligently.\r\n                configuration.gateway_token = configuration.gateway_token || msg.gateway_token;\r\n                configuration.peer_factory = configuration.peer_factory || msg.peer_factory;\r\n                var promise = factory.create({\r\n                    activityId: msg.activity.id,\r\n                    type: msg.activity.type,\r\n                    gwToken: configuration.gateway_token,\r\n                    configuration: configuration,\r\n                });\r\n                if (promise && promise.then && promise.catch) {\r\n                    promise.catch(function (err) { return _this._gw3Session.send({\r\n                        type: gwMmessageError,\r\n                        request_id: msg.request_id,\r\n                        reason: err && (err.message || JSON.stringify(err))\r\n                    }); });\r\n                }\r\n            }\r\n            catch (err) {\r\n                _this._gw3Session.send({\r\n                    type: gwMmessageError,\r\n                    request_id: msg.request_id,\r\n                    reason: err && (err.message || JSON.stringify(err))\r\n                });\r\n            }\r\n        });\r\n    };\r\n    GW3Bridge.prototype.forwardActivityWindowMessagesToEventHandlers = function () {\r\n        var _this = this;\r\n        var _loop_1 = function (joinedMessage) {\r\n            this_1.subscribe(joinedMessage, function (msg) {\r\n                var joinedId = (joinedMessage === gwMessageActivityJoined) ? msg.joined_id : msg.peer_id;\r\n                var joinedType = (joinedMessage === gwMessageActivityJoined) ? msg.joined_type : msg.peer_type;\r\n                var joinedName = (joinedMessage === gwMessageActivityJoined) ? msg.joined_name : msg.peer_name;\r\n                var entity = new activityWindow_1.default(joinedId, joinedName, joinedType /* for ACTIVITY JOINED */, msg.activity_id, undefined, undefined, _this.generateWindowGetter(joinedId), undefined);\r\n                // TODO review - what if it's our activity, do we\r\n                // even need to subscribe\r\n                if (!_this._contextSubscriptions[msg.activity_id]) {\r\n                    _this.subscribeToContext(msg).then(function () {\r\n                        if (joinedMessage === gwMessageJoinedActivity) {\r\n                            _this._activityJoinedPromiseResolve({});\r\n                        }\r\n                    });\r\n                }\r\n                else if (joinedMessage === gwMessageJoinedActivity) {\r\n                    _this._activityJoinedPromiseResolve({});\r\n                }\r\n                // TODO review: we might have the context data here already\r\n                // why not update it here instead of waiting for subscribeToContext\r\n                _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new entityEvent_1.EntityEvent(entity, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowJoinedActivity)), joinedMessage);\r\n            });\r\n        };\r\n        var this_1 = this;\r\n        for (var _i = 0, _a = [gwMessageActivityJoined, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var joinedMessage = _a[_i];\r\n            _loop_1(joinedMessage);\r\n        }\r\n        this.subscribe(gwMessageActivityLeft, function (msg) {\r\n            var entity = new activityWindow_1.default(msg.left_id, undefined, undefined, null, undefined, undefined, _this.generateWindowGetter(msg.left_id), undefined);\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new entityEvent_1.EntityEvent(entity, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowLeftActivity)), gwMessageActivityLeft);\r\n        });\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerCreated, undefined, function (msg) { return [\r\n            new activityWindow_1.default(msg.created_id, undefined /* #deleteme TODO: review - we should know the name if any */, undefined /* #deleteme TODO: review - we should know the type */, undefined, undefined, undefined, _this.generateWindowGetter(msg.created_id), undefined)\r\n        ]; }, this._activityWindowChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.generateWindowGetter = function (peerId) {\r\n        var _this = this;\r\n        return function () {\r\n            var server = _this._config.agm.servers().filter(function (s) { return s.peerId === peerId; })[0];\r\n            if (!server) {\r\n                return;\r\n            }\r\n            var windowId = server.windowId;\r\n            return _this._config.windows.list().filter(function (w) { return w.id === windowId; })[0];\r\n        };\r\n    };\r\n    GW3Bridge.prototype.isOverrideTypeDefinition = function (value) {\r\n        if (typeof value === \"undefined\") {\r\n            return false;\r\n        }\r\n        if (value.owner) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    return GW3Bridge;\r\n}());\r\nexports.default = GW3Bridge;\r\n//# sourceMappingURL=gw3Bridge.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(27)))\n\n/***/ }),\n/* 44 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar entityEvent_1 = __webpack_require__(2);\r\nvar activityType_1 = __webpack_require__(10);\r\nvar promiseExtensions_1 = __webpack_require__(8);\r\nvar readyMarker_1 = __webpack_require__(17);\r\nvar entityObservableCollection_1 = __webpack_require__(47);\r\nvar logger_1 = __webpack_require__(4);\r\nvar util = __webpack_require__(1);\r\nvar localWindowFactory_1 = __webpack_require__(45);\r\nvar entityEvent_2 = __webpack_require__(2);\r\nvar hcBridge_1 = __webpack_require__(12);\r\nvar ActivityManager = /** @class */ (function () {\r\n    function ActivityManager(bridge, autoAnnounce, windows) {\r\n        var _this = this;\r\n        this._logger = logger_1.Logger.Get(\"activityManager\");\r\n        this._announcedWindows = [];\r\n        this._attachedCallbacks = [];\r\n        this._detachedCallbacks = [];\r\n        this._frameColorChangesCallbacks = [];\r\n        this._windowHandlers = [];\r\n        this._bridge = bridge;\r\n        this._activityTypes = new entityObservableCollection_1.EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._windowTypes = new entityObservableCollection_1.EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._activities = new entityObservableCollection_1.EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._windows = new entityObservableCollection_1.EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        // signals to wait for - get AT, get WT, get Activities and get Windows\r\n        this._dataReadyMarker = new readyMarker_1.ReadyMarker(\"Activity Manager Data\", [\"GetActivityTypes\", \"GetWindowTypes\", \"GetActivities\", \"GetWindows\"].length);\r\n        this._descriptorsMarker = new readyMarker_1.ReadyMarker(\"Attached Activities Descriptors\", [\"GetDescriptors\"].length);\r\n        // waiting for activity data first\r\n        // NB: in the GW3 case, we don't have the ability to request data at will\r\n        // but need wait for delta messages\r\n        // So GW3Bridge returns empty arrays from the get() calls\r\n        // We're relying on the fact that the GW3 bridge will wait\r\n        // until resolving its .ready()\r\n        if (autoAnnounce) {\r\n            // if auto announce replace the ready marker, so:\r\n            // 1) wait for data\r\n            // 2) get descriptors\r\n            // 3) announce the current window\r\n            this._readyMarker = new readyMarker_1.ReadyMarker(\"Activity Manager Announce\", [\"Announcement\"].length);\r\n            this._dataReadyMarker.setCallback(function (dataErr) {\r\n                if (dataErr) {\r\n                    _this._readyMarker.error(dataErr);\r\n                }\r\n                _this._descriptorsMarker.setCallback(function (err) {\r\n                    if (err) {\r\n                        _this._readyMarker.error(err);\r\n                    }\r\n                    _this._logger.debug(\"Auto announcing window\");\r\n                    // signal no matter if it failed or not\r\n                    _this.announceWindow()\r\n                        .then(function (w) {\r\n                        // NB: this creates glue.activities.my.window\r\n                        _this._announcedWindows.push(w);\r\n                        _this._readyMarker.signal(\"Successfully announced window with id '\" + w.id + \"'\");\r\n                    })\r\n                        .catch(function (errCatch) {\r\n                        _this._logger.debug(\"Will not announce window - \" + errCatch);\r\n                        _this._readyMarker.signal();\r\n                    });\r\n                });\r\n                _this.refreshDescriptors();\r\n            });\r\n        }\r\n        else {\r\n            // TODO: not sure if this still works\r\n            this._readyMarker = this._dataReadyMarker;\r\n        }\r\n        this._bridge.onActivitiesAttached(function (e) {\r\n            _this._handleActivitiesAttached(e);\r\n        });\r\n        this._bridge.onActivitiesDetached(function (e) {\r\n            _this._handleActivitiesDetached(e);\r\n        });\r\n        this._bridge.onActivityAttachedDescriptorsRefreshed(function (e) {\r\n            _this._handleActivityDescriptorsRefreshed(e);\r\n        });\r\n        if (windows) {\r\n            windows.onWindowFrameColorChanged(this._handleWindowFrameColorChanged.bind(this));\r\n        }\r\n        // initialize the bridge\r\n        this._bridge.init();\r\n        // NB: there is no race condition here.\r\n        // Since browser/Node JS is a single-threaded environment, assuming no events on _bridge\r\n        // fire inside .init(), this subscribe will catch anything that comes between it and the init() call\r\n        this._subscribeForData();\r\n        // NB: in GW3 case, the initial state messages after a JOIN come in before the JOIN's SUCCESS\r\n        // message (see https://confluence.tick42.com:8443/display/TD/Global+Gateway+Domain#GlobalGatewayDomain-JOIN)\r\n        // so the .initReady().then() callback will only get invoked after we've received the initial domain\r\n        // state. We need to be ready to handle events before that, hence the _subscribeForData() above.\r\n        // what's more, our own JOINED ACTIVITY will come only after we've sent our READY, hence waiting\r\n        // for bridge.ready() in the manager's ready()\r\n        // wait for it to become ready and then start getting/subscribing for data\r\n        this._bridge\r\n            .initReady()\r\n            .then(function (aw) {\r\n            _this._getInitialData();\r\n        })\r\n            .catch(function (error) {\r\n            // tslint:disable-next-line\r\n            console.log(error);\r\n        });\r\n    }\r\n    Object.defineProperty(ActivityManager.prototype, \"usingHc\", {\r\n        get: function () {\r\n            return this._bridge.bridgeType === \"HC\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityManager.prototype, \"announcedWindows\", {\r\n        get: function () {\r\n            return this._announcedWindows;\r\n        },\r\n        set: function (v) {\r\n            throw new Error(\"not allowed\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityManager.prototype.ready = function (callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._readyMarker.setCallback(function (err) {\r\n                if (!err) {\r\n                    resolve(_this);\r\n                }\r\n                else {\r\n                    reject(_this._readyMarker.getError());\r\n                }\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(Promise.all([this._bridge.ready(), promise]).then(function () { return _this; }), callback);\r\n    };\r\n    /**\r\n     * @returns All known activity types\r\n     */\r\n    ActivityManager.prototype.getActivityTypes = function () {\r\n        return this._activityTypes.get();\r\n    };\r\n    /**\r\n     * Gets ActivityType by name\r\n     * @param name  Name to search for\r\n     * @returns     If found the @type ActivityType; otherwise undefined\r\n     */\r\n    ActivityManager.prototype.getActivityType = function (name) {\r\n        return this._activityTypes.getByName(name);\r\n    };\r\n    /**\r\n     * Registers a new activity type\r\n     * @param activityTypeName      The name of the activity type to be created\r\n     * @param ownerWindowType       The type of the owner window or a WindowDefinition for the owner window\r\n     * @param helperWindowTypes     Types of helper windows (or WindowDefinitions for helper windows) for that activity type\r\n     * @param config                (HC only, deprecated) Layout config\r\n     * @param description           (HC only, deprecated) Description for the new activity type\r\n     * @param callback              (Optional) Callback for results - if not specified the method will return a promise\r\n     */\r\n    ActivityManager.prototype.registerActivityType = function (activityTypeName, ownerWindowType, helperWindowTypes, config, description, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            // activityTypeName checks\r\n            if (util.isUndefinedOrNull(activityTypeName)) {\r\n                reject(\"activityTypeName argument can not be undefined\");\r\n                return;\r\n            }\r\n            if (!util.isString(activityTypeName)) {\r\n                reject(\"activityTypeName should be string\");\r\n                return;\r\n            }\r\n            // check if type is already defined\r\n            var actType = _this.getActivityType(activityTypeName);\r\n            if (!util.isUndefinedOrNull(actType)) {\r\n                reject(\"Activity type '\" + activityTypeName + \"' already exists\");\r\n                return;\r\n            }\r\n            // ownerWindowType checks\r\n            var ownerDefinition;\r\n            if (util.isUndefined(ownerWindowType)) {\r\n                reject(\"Owner window type can not be undefined\");\r\n                return;\r\n            }\r\n            if (util.isString(ownerWindowType)) {\r\n                ownerDefinition = { type: ownerWindowType, name: \"\", isIndependent: false, arguments: {} };\r\n            }\r\n            else {\r\n                ownerDefinition = ownerWindowType;\r\n            }\r\n            // helperWindowTypes checks\r\n            var helperDefinitions = [];\r\n            if (!util.isUndefined(helperWindowTypes) && util.isArray(helperWindowTypes)) {\r\n                // tslint:disable-next-line\r\n                for (var index in helperWindowTypes) {\r\n                    var item = helperWindowTypes[index];\r\n                    if (util.isString(item)) {\r\n                        var definition = {\r\n                            type: item,\r\n                            name: \"\",\r\n                            isIndependent: false,\r\n                            arguments: {},\r\n                            relativeTo: \"\",\r\n                            relativeDirection: \"\",\r\n                            windowStyleAttributes: {}\r\n                        };\r\n                        helperDefinitions.push(definition);\r\n                    }\r\n                    else {\r\n                        helperDefinitions.push(item);\r\n                    }\r\n                }\r\n            }\r\n            // redirect to bridge\r\n            _this._bridge\r\n                .registerActivityType(activityTypeName, ownerDefinition, helperDefinitions, config, description)\r\n                .then(function (activityType) {\r\n                // add to from collections\r\n                _this._grabEntity(activityType);\r\n                resolve(activityType);\r\n            })\r\n                .catch(function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Unregister existing activity type\r\n     * @param type The name of the activity type to be removed\r\n     */\r\n    ActivityManager.prototype.unregisterActivityType = function (type, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            // check if type is defined\r\n            var actType = _this.getActivityType(type);\r\n            if (util.isUndefined(actType)) {\r\n                reject(\"Activity type '\" + type + \"' does not exists\");\r\n                return;\r\n            }\r\n            _this._bridge.unregisterActivityType(type).then(function () { return resolve(actType); }, reject);\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Initiates a new activity from the given type.\r\n     * @param activityType  The ActivityType to initiate\r\n     * @param context       The initial context of the activity\r\n     * @param callback      Callback for result\r\n     * @param configuration Optional configuration passed to window/peer factories for the new activity's participants\r\n     * @returns             Promise for activity\r\n     */\r\n    ActivityManager.prototype.initiate = function (activityType, context, callback, configuration) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            // check if type is defined\r\n            var actType = _this.getActivityType(activityType);\r\n            if (util.isUndefined(actType)) {\r\n                reject(\"Activity type '\" + activityType + \"' does not exists\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .initiateActivity(activityType, context, configuration)\r\n                .then(function (actId) {\r\n                _this._activities\r\n                    .getOrWait(actId)\r\n                    .then(function (act) {\r\n                    resolve(act);\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityTypeEvents = function (handler) {\r\n        this._activityTypes.subscribe(function (at, context) {\r\n            handler(at, context.type);\r\n        });\r\n    };\r\n    /**\r\n     * @returns All known WindowTypes\r\n     */\r\n    ActivityManager.prototype.getWindowTypes = function () {\r\n        return this._windowTypes.get();\r\n    };\r\n    /**\r\n     * Gets WindowType by name\r\n     * @param name  The name of the type @type WindowType\r\n     * @returns     WindowType if found; undefined otherwise\r\n     */\r\n    ActivityManager.prototype.getWindowType = function (name) {\r\n        return this._windowTypes.getByName(name);\r\n    };\r\n    /**\r\n     * Registers a factory for a given WindowType. The factory will be called once window of that type is requested\r\n     * @param windowType   Window type that will be constructed from the factory. Can be a string (name of the window type)\r\n     * or object that has name, description properties\r\n     * @param factoryMethod      The factory that will construct Windows of that type\r\n     * @param description\r\n     * @param callback\r\n     * @param configuration\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.registerWindowFactory = function (windowType, factoryMethod, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(windowType)) {\r\n                reject(\"no windowType specified\");\r\n                return;\r\n            }\r\n            if (util.isObject(windowType)) {\r\n                windowType = windowType.getName();\r\n            }\r\n            else if (!util.isString(windowType)) {\r\n                reject(\"windowType should be string or object that has getName method\");\r\n                return;\r\n            }\r\n            var factory = new localWindowFactory_1.LocalWindowFactory(factoryMethod);\r\n            _this._bridge\r\n                .registerWindowFactory(windowType, factory)\r\n                .then(function (v) {\r\n                resolve(v);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Unregisters all factories for a given WindowType.\r\n     * @param windowType   Window type that is constructed from the factory.\r\n     * @param callback\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.unregisterWindowFactory = function (windowType, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(windowType)) {\r\n                reject(\"no windowType specified\");\r\n                return;\r\n            }\r\n            if (!util.isString(windowType)) {\r\n                reject(\"windowType should be a string\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .unregisterWindowFactory(windowType)\r\n                .then(function (v) {\r\n                resolve(v);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * @returns All started activities\r\n     * @param activityType Can be a string or @type ActivityType. If string a new activityType will be created using the string for name.\r\n     * @returns Array of Activity objects\r\n     */\r\n    ActivityManager.prototype.getActivities = function (activityType) {\r\n        var act = this._activities.get();\r\n        if (!activityType) {\r\n            return act;\r\n        }\r\n        var types = activityType;\r\n        if (util.isString(activityType)) {\r\n            types = [activityType];\r\n        }\r\n        else if (activityType instanceof activityType_1.default) {\r\n            types = [activityType.name];\r\n        }\r\n        else if (activityType instanceof Array) {\r\n            // TODO check if string array or array of ActivityTypes\r\n        }\r\n        else {\r\n            throw new Error(\"Invalid input argument 'activityType' = \" + activityType);\r\n        }\r\n        return act.filter(function (at) {\r\n            var type = at.type;\r\n            return util.some(types, function (t) {\r\n                return type.id === t.id;\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Returns Activity by ID\r\n     */\r\n    ActivityManager.prototype.getActivityById = function (id) {\r\n        return this._activities.getByName(id);\r\n    };\r\n    /**\r\n     * Initialises activity for the current window - by doing this the window is announced as activity aware to the other participants\r\n     * @param windowType            Type of window\r\n     * @param activityWindowId      The id of the window that was created\r\n     * @returns {}                  Promise for an activity window (joined to an activity, if the activity creation fails the promise will be rejected)\r\n     */\r\n    ActivityManager.prototype.announceWindow = function (activityWindowId, windowType) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            // get the announcement info from the bridge (e.g. the context in HC) - this will be used if no arguments passed\r\n            var announcementInfo = _this._bridge.getAnnouncementInfo();\r\n            if (util.isUndefined(activityWindowId)) {\r\n                activityWindowId = announcementInfo.activityWindowId;\r\n            }\r\n            if (util.isUndefined(windowType)) {\r\n                windowType = announcementInfo.activityWindowType;\r\n            }\r\n            if (util.isUndefinedOrNull(windowType)) {\r\n                throw new Error(\"Can not announce - unknown windowType\");\r\n            }\r\n            var activityId = announcementInfo && announcementInfo.activityId;\r\n            // We cover two cases here:\r\n            // * no activityWindowId supplied (neither in arguments or announcement info) - in that case we register new window by type. Most of the time this is the case when an independent window is created outside activity\r\n            // * activityWindowId supplied - window created as part of activity creation\r\n            // NB: in GW3, windows are created standalone, and receive 'JOINED' after they send a 'READY'\r\n            // so we always go in 'if' case, not 'else'\r\n            if (util.isUndefinedOrNull(activityWindowId)) {\r\n                _this._logger.debug(\"Registering window with type:'\" + windowType + \"', name:'\" + announcementInfo.activityWindowName + \"', ind.:'\" + announcementInfo.activityWindowIndependent + \"'\");\r\n                // register new window created outside activity\r\n                _this._bridge.registerWindow(windowType, announcementInfo.activityWindowName, announcementInfo.activityWindowIndependent)\r\n                    .then(_this._windows.getOrWait.bind(_this._windows))\r\n                    .then(function (w) {\r\n                    if (activityId) {\r\n                        return _this._activities.getOrWait(activityId).then(function (_) { return w; });\r\n                    }\r\n                    else {\r\n                        return w;\r\n                    }\r\n                })\r\n                    .then(function (w) {\r\n                    resolve(w);\r\n                })\r\n                    .catch(function (err) {\r\n                    _this._logger.error(err);\r\n                });\r\n            }\r\n            else {\r\n                // announce new window created in an activity creation process\r\n                _this._logger.debug(\"Announcing window with id '\" + activityWindowId + \"' and type '\" + windowType + \"'\");\r\n                // check if the window is already created -\r\n                var currentWindow = _this._windows.getByName(activityWindowId);\r\n                if (!util.isUndefinedOrNull(currentWindow)) {\r\n                    _this._logger.debug(\"Window with id '\" + activityWindowId + \"' already announced - reusing the window\");\r\n                    resolve(currentWindow);\r\n                    return;\r\n                }\r\n                // window events handler\r\n                var windowEventHandler_1 = function (a, w, e) {\r\n                    if (activityWindowId === w.id) {\r\n                        if (e === entityEvent_1.EntityEventType.ActivityWindowJoinedActivity) {\r\n                            var activity = w.activity;\r\n                            if (util.isUndefined(activity)) {\r\n                                reject(\"UNDEFINED ACTIVITY\");\r\n                            }\r\n                            _this._logger.trace(\"Got joined event for id '\" + activityWindowId + \"'\");\r\n                            resolve(w);\r\n                            _this.unsubscribeWindowEvents(windowEventHandler_1);\r\n                        }\r\n                    }\r\n                };\r\n                _this.subscribeWindowEvents(windowEventHandler_1);\r\n                _this._logger.trace(\"Waiting for joined event for id '\" + activityWindowId + \"'\");\r\n                _this._bridge.announceWindow(windowType, activityWindowId);\r\n            }\r\n        });\r\n        return promise;\r\n    };\r\n    /**\r\n     * Allows you to subscribe for windows events, e.g. window type registered\r\n     * @param handler   The handler to receive notifications\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.subscribeWindowTypeEvents = function (handler) {\r\n        this._windowTypes.subscribe(function (wt, context) {\r\n            handler(wt, context.type);\r\n        });\r\n    };\r\n    /**\r\n     * Subscribe for activity status events\r\n     * @param handler Handler function that will receive status notifications\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.subscribeActivityEvents = function (handler) {\r\n        var _this = this;\r\n        return this._activities.subscribe(function (act, context) {\r\n            if (context.type === entityEvent_1.EntityEventType.StatusChange) {\r\n                var p = context;\r\n                handler(act, p.newStatus, p.oldStatus);\r\n            }\r\n            // implicitly leave the activity on destroy\r\n            if (context.type === entityEvent_1.EntityEventType.Removed ||\r\n                (context.type === entityEvent_1.EntityEventType.StatusChange &&\r\n                    context.newStatus.getState() === entityEvent_2.ActivityState.Destroyed)) {\r\n                for (var _i = 0, _a = _this._windows.get(); _i < _a.length; _i++) {\r\n                    var window_1 = _a[_i];\r\n                    if (window_1.activity && window_1.activity.id === act.id) {\r\n                        _this._windows.process(new entityEvent_1.EntityEvent(window_1, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowLeftActivity)));\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Allows you to subscribe for windows events, e.g. window joining to activity\r\n     * @param handler   The handler to receive notifications\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.subscribeWindowEvents = function (handler) {\r\n        var wrappingHandler = function (window, context) {\r\n            var eventType = context.type;\r\n            if (eventType === entityEvent_1.EntityEventType.Added) {\r\n                // rename added to opened (because added is misleading - semantically it's the opposite of remove);\r\n                eventType = \"opened\";\r\n            }\r\n            handler(window.activity, window, eventType);\r\n        };\r\n        this._windowHandlers.push([handler, wrappingHandler]);\r\n        return this._windows.subscribe(wrappingHandler);\r\n    };\r\n    ActivityManager.prototype.unsubscribeWindowEvents = function (handler) {\r\n        var found = this._windowHandlers.find(function (pair) { return pair[0] === handler; });\r\n        if (found) {\r\n            this._windowHandlers.splice(this._windowHandlers.indexOf(found), 1);\r\n            this._windows.unsubscribe(found[1]);\r\n        }\r\n    };\r\n    /**\r\n     * Creates a new window from a given type and joins it to an activity\r\n     *\r\n     * @param activity      Activity to join the window to\r\n     * @param windowType    The window type to join (string or window definition)\r\n     * @param callback      (Optional) Result callback\r\n     * @returns             Promise for ActivityWindow\r\n     */\r\n    ActivityManager.prototype.createWindow = function (activity, windowTypeOrConfiguration, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(windowTypeOrConfiguration)) {\r\n                reject(\"windowType is undefined\");\r\n            }\r\n            var windowDefinition;\r\n            if (util.isString(windowTypeOrConfiguration)) {\r\n                windowDefinition = { type: windowTypeOrConfiguration, name: \"\", isIndependent: false, arguments: {} };\r\n            }\r\n            else {\r\n                windowDefinition = windowTypeOrConfiguration;\r\n            }\r\n            var relativeToWindow;\r\n            if (!util.isUndefinedOrNull(windowDefinition.relativeTo)) {\r\n                relativeToWindow = windowDefinition.relativeTo;\r\n                if (typeof relativeToWindow === \"string\") {\r\n                    var windows = _this.getWindows({ type: relativeToWindow });\r\n                    if (!util.isUndefinedOrNull(windows) && windows.length > 0) {\r\n                        windowDefinition.relativeTo = windows[0].id;\r\n                    }\r\n                }\r\n                else if (!util.isUndefinedOrNull(relativeToWindow.type)) {\r\n                    var windows = _this.getWindows({ type: relativeToWindow.type });\r\n                    if (!util.isUndefinedOrNull(windows) && windows.length > 0) {\r\n                        windowDefinition.relativeTo = windows[0].id;\r\n                    }\r\n                }\r\n                else if (!util.isUndefinedOrNull(relativeToWindow.windowId)) {\r\n                    windowDefinition.relativeTo = relativeToWindow.windowId;\r\n                }\r\n            }\r\n            _this._bridge.createWindow(activity && activity.id, windowDefinition)\r\n                .then(function (wid) {\r\n                _this._logger.debug(\"Window created, waiting for window entity with id \" + wid);\r\n                var handler = function (window, context) {\r\n                    // wait until the window has activity property (this means it was joined)\r\n                    if (window.id === wid && (!activity || window.activity)) {\r\n                        _this._logger.debug(\"Got entity window with id \" + wid);\r\n                        resolve(window);\r\n                        _this._windows.unsubscribe(handler);\r\n                    }\r\n                };\r\n                // if we can not get the window right away, wait for event\r\n                _this._windows.subscribe(handler);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Creates relative windows from a given types and joins them to an activity\r\n     *\r\n     * @param activity               Activity to join relative windows to\r\n     * @param relativeWindowTypes    Relative window types to join (string or window definitions array)\r\n     * @param callback               (Optional) Result callback\r\n     * @returns                      Promise for ActivityWindow\r\n     */\r\n    ActivityManager.prototype.createStackedWindows = function (activity, relativeWindowTypes, timeout, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(activity)) {\r\n                reject(\"activity is undefined\");\r\n            }\r\n            if (util.isUndefinedOrNull(relativeWindowTypes)) {\r\n                reject(\"relativeWindowTypes is undefined\");\r\n            }\r\n            if (!Array.isArray(relativeWindowTypes)) {\r\n                reject(\"relativeWindowTypes has to be array\");\r\n            }\r\n            if (util.isUndefinedOrNull(timeout)) {\r\n                timeout = 20000; // default timeout: 20 seconds\r\n            }\r\n            var relativeWindows = [];\r\n            relativeWindowTypes.forEach(function (element) {\r\n                var windowDefinition;\r\n                if (util.isString(element)) {\r\n                    windowDefinition = { type: element, name: \"\", isIndependent: false, arguments: {} };\r\n                }\r\n                else {\r\n                    windowDefinition = element;\r\n                }\r\n                var relativeToWindow;\r\n                if (!util.isUndefinedOrNull(windowDefinition.relativeTo)) {\r\n                    // this can not be string, converted in the prev. layer\r\n                    relativeToWindow = windowDefinition.relativeTo;\r\n                    if (!util.isUndefinedOrNull(relativeToWindow.type)) {\r\n                        windowDefinition.relativeTo = relativeToWindow.type;\r\n                    }\r\n                    else if (!util.isUndefinedOrNull(relativeToWindow.windowId)) {\r\n                        var windows = _this.getWindows({ id: relativeToWindow.windowId });\r\n                        if (!util.isUndefinedOrNull(windows) && windows.length > 0) {\r\n                            windowDefinition.relativeTo = windows[0].type.name;\r\n                            windowDefinition.useExisting = true;\r\n                        }\r\n                    }\r\n                }\r\n                relativeWindows.push(windowDefinition);\r\n            });\r\n            _this._bridge.createStackedWindows(activity.id, relativeWindows, timeout)\r\n                .then(function (wid) {\r\n                var activityWindows = [];\r\n                var alreadyCreated = [];\r\n                var handler = function (window, context) {\r\n                    // wait until the window has activity property (this means it was joined)\r\n                    if (wid.indexOf(window.id) >= 0 && alreadyCreated.indexOf(window.id) < 0 && window.activity) {\r\n                        this._logger.debug(\"Got entity window with id \" + wid);\r\n                        activityWindows.push(window);\r\n                        alreadyCreated.push(window.id);\r\n                        if (activityWindows.length === wid.length) {\r\n                            resolve(activityWindows);\r\n                            this._windows.unsubscribe(handler);\r\n                        }\r\n                    }\r\n                }.bind(_this);\r\n                // if we can not get the window right away, wait for event\r\n                _this._windows.subscribe(handler);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Joins a new window from a given type to the activity\r\n     *\r\n     * @param activity      Activity to join the window to\r\n     * @param window        The window to join\r\n     * @param callback      (Optional) Result callback\r\n     * @returns             Promise for ActivityWindow\r\n     */\r\n    ActivityManager.prototype.addWindowToActivity = function (activity, window, callback) {\r\n        var toReturn = this._bridge.joinActivity(activity.id, window.id)\r\n            .then(function () { return window; });\r\n        promiseExtensions_1.nodeify(toReturn, callback);\r\n        return toReturn;\r\n    };\r\n    /**\r\n     * Removes a window from the activity\r\n     *\r\n     * @param activity  Activity to remove the window from\r\n     * @param           The window to remove\r\n     * @param           (Optional) Result callback\r\n     * @returns         Promise for ActivityWindow\r\n     */\r\n    ActivityManager.prototype.leaveWindowFromActivity = function (activity, window, callback) {\r\n        var toReturn = this._bridge.leaveActivity(activity.id, window.id)\r\n            .then(function () { return window; });\r\n        promiseExtensions_1.nodeify(toReturn, callback);\r\n        return toReturn;\r\n    };\r\n    /**\r\n     * Replaces the activity context\r\n     * @param activity  Activity\r\n     * @param context   The new context\r\n     * @param callback  (Optional) Result callback\r\n     * @returns         Promise for Activity\r\n     */\r\n    ActivityManager.prototype.setActivityContext = function (activity, context, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(activity)) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            // TODO: duplication with updateActivityContext\r\n            // DONE: verify is the change visible here when 'updateActivityContext' resolves?\r\n            _this._bridge\r\n                .updateActivityContext(activity, context, true)\r\n                .then(function (_) {\r\n                resolve(activity);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Updates activity context using the properties from  context argument.\r\n     * If old context is {a:1, b:2, c:3} and invoking updateContext({b:3, c:null}) will result a context\r\n     * be {a:1, b:3}\r\n     *\r\n     * @param activity\r\n     * @param context\r\n     * @param callback\r\n     */\r\n    ActivityManager.prototype.updateActivityContext = function (activity, context, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(activity)) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            var removedKeys = [];\r\n            for (var key in context) {\r\n                if (context.hasOwnProperty(key) && context[key] === null) {\r\n                    removedKeys.push(key);\r\n                }\r\n            }\r\n            for (var _i = 0, removedKeys_1 = removedKeys; _i < removedKeys_1.length; _i++) {\r\n                var removedKey = removedKeys_1[_i];\r\n                delete context[removedKey];\r\n            }\r\n            _this._bridge\r\n                .updateActivityContext(activity, context, false, removedKeys)\r\n                .then(function (_) {\r\n                // DONE: verify is the change already visible here when 'updateActivityContext' resolves?\r\n                resolve(activity);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Subscribe for activity context update events\r\n     *\r\n     * @param activity  Activity\r\n     * @param handler   Handler function that will receive context related events\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.subscribeActivityContextChanged = function (handler) {\r\n        this._activities.subscribe(function (act, context) {\r\n            if (context.type === entityEvent_1.EntityEventType.ActivityContextChange) {\r\n                var updateContext = context;\r\n                handler(act, updateContext.context, updateContext.updated, updateContext.removed);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Stops an activity\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.stopActivity = function (activity, callback) {\r\n        var promise = this._bridge.stopActivity(activity);\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Returns activity windows based on some filter. If no filter supplied all activity windows are returned.\r\n     * @param filter  Filter that\r\n     * @returns Array of ActivityWindows that match the filter object\r\n     */\r\n    ActivityManager.prototype.getWindows = function (filter) {\r\n        if (util.isUndefined(filter)) {\r\n            return this._windows.get();\r\n        }\r\n        if (!util.isUndefined(filter.id)) {\r\n            return [this._windows.getByName(filter.id)];\r\n        }\r\n        var allWindows = this._windows.get();\r\n        return allWindows.filter(function (w) {\r\n            if (!util.isUndefined(filter.type) && w.type.id !== filter.type) {\r\n                return false;\r\n            }\r\n            if (!util.isUndefined(filter.name) && w.name !== filter.name) {\r\n                return false;\r\n            }\r\n            if (!util.isUndefined(filter.activityId)) {\r\n                if (util.isUndefinedOrNull(w.activity)) {\r\n                    return false;\r\n                }\r\n                if (w.activity.id !== filter.activityId) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n    };\r\n    ActivityManager.prototype.getWindowBounds = function (id) {\r\n        return this._bridge.getWindowBounds(id);\r\n    };\r\n    ActivityManager.prototype.setWindowBounds = function (id, bounds, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._bridge.setWindowBounds(id, bounds)\r\n                .then(function () { return resolve(); })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.closeWindow = function (id) {\r\n        return this._bridge.closeWindow(id);\r\n    };\r\n    ActivityManager.prototype.activateWindow = function (id, focus) {\r\n        return this._bridge.activateWindow(id, focus);\r\n    };\r\n    ActivityManager.prototype.setWindowVisibility = function (id, visible) {\r\n        return this._bridge.setWindowVisibility(id, visible);\r\n    };\r\n    ActivityManager.prototype.clone = function (activity, cloneOptions, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!activity) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            _this._bridge.cloneActivity(activity.id, cloneOptions)\r\n                .then(function (activityId) {\r\n                _this._activities\r\n                    .getOrWait(activityId)\r\n                    .then(function (act) {\r\n                    resolve(act);\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.attachActivities = function (from, to, tag, callback) {\r\n        var _this = this;\r\n        tag = tag || {};\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var fromActivity = _this._activities.getByName(from);\r\n            if (!fromActivity) {\r\n                reject(\"can not find activity with id \" + from);\r\n                return;\r\n            }\r\n            var toActivity = _this._activities.getByName(to);\r\n            if (!toActivity) {\r\n                reject(\"can not find activity with id \" + to);\r\n                return;\r\n            }\r\n            return _this._bridge.attachActivities(from, to, tag)\r\n                .then(function (data) {\r\n                var newActId = data.to;\r\n                var state = data.descriptor;\r\n                var allStates = data.descriptors;\r\n                _this._activities.getOrWait(newActId).then(function (act) {\r\n                    act._updateDescriptors(allStates);\r\n                    var stateWrapped = act.attached.filter(function (u) { return u.ownerId === state.ownerId; })[0];\r\n                    resolve(stateWrapped);\r\n                });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.detachActivities = function (activityId, descriptor, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            return _this._bridge.detachActivities(activityId, descriptor)\r\n                .then(/*(params)*/ function () {\r\n                // #deleteme TODO: deal with this\r\n                var oldActId = undefined; // params.oldActivityId;\r\n                var newActId = undefined; // params.newActivityId;\r\n                var descriptors = undefined; // params.descriptors;\r\n                _this._activities\r\n                    .getOrWait(oldActId)\r\n                    .then(function (oldAct) {\r\n                    oldAct._updateDescriptors(descriptors);\r\n                    _this._activities\r\n                        .getOrWait(newActId)\r\n                        .then(function (newAct) {\r\n                        resolve(newAct);\r\n                    });\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivitiesAttached = function (callback) {\r\n        this._attachedCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivitiesDetached = function (callback) {\r\n        this._detachedCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityFrameColorChanged = function (callback) {\r\n        this._frameColorChangesCallbacks.push(callback);\r\n    };\r\n    /** Assigns a manager to a given ActivityEntity */\r\n    ActivityManager.prototype._grabEntity = function (entity) {\r\n        entity._manager = this;\r\n    };\r\n    ActivityManager.prototype._getInitialData = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"Request initial data...\");\r\n        // NB: there's no possibility for duplicate entities from events that have come\r\n        // in between _bridge.init() and _bridge.ready()'s resolve, since the ObservableCollections\r\n        // coalesce items by id.\r\n        this._bridge.getActivityTypes()\r\n            .then(function (at) {\r\n            _this._activityTypes.add(at);\r\n            _this._dataReadyMarker.signal(\"Got act types\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity types -\" + error);\r\n        });\r\n        this._bridge.getWindowTypes()\r\n            .then(function (wt) {\r\n            _this._windowTypes.add(wt);\r\n            _this._dataReadyMarker.signal(\"Got window types\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting window types  \" + error);\r\n        });\r\n        this._bridge.getActivities()\r\n            .then(function (ac) {\r\n            _this._activities.add(ac);\r\n            _this._dataReadyMarker.signal(\"Got activities\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity instances -\" + error);\r\n        });\r\n        this._bridge.getActivityWindows()\r\n            .then(function (aw) {\r\n            _this._windows.add(aw);\r\n            _this._dataReadyMarker.signal(\"Got windows\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity windows -\" + error);\r\n        });\r\n    };\r\n    ActivityManager.prototype._subscribeForData = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"Subscribe for data...\");\r\n        // NB: there's no possibility for duplicate entities from events that have come\r\n        // in between _bridge.init() and _bridge.ready()'s resolve, since the ObservableCollections\r\n        // coalesce items by id.\r\n        this._bridge.onActivityTypeStatusChange(function (event) {\r\n            _this._activityTypes.process(event);\r\n        });\r\n        this._bridge.onWindowTypeStatusChange(function (event) {\r\n            _this._windowTypes.process(event);\r\n        });\r\n        this._bridge.onActivityStatusChange(function (event) {\r\n            var activity = _this._activities.process(event);\r\n            if (event.context.type === entityEvent_1.EntityEventType.ActivityWindowJoinedActivity &&\r\n                activity &&\r\n                activity.context &&\r\n                _this._bridge instanceof hcBridge_1.default) {\r\n                // for parity with older code which explicitly sent a context update to subscribers\r\n                // upon joining an activity\r\n                _this._activities.process(new entityEvent_1.EntityEvent(activity, new entityEvent_1.ActivityContextChangedEventContext(activity.context, activity.context, [])));\r\n            }\r\n        });\r\n        this._bridge.onActivityWindowChange(function (event) {\r\n            _this._windows.process(event);\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivitiesAttached = function (data) {\r\n        var _this = this;\r\n        var newActId = data.to;\r\n        var descriptor = data.descriptor;\r\n        var descriptors = data.descriptors;\r\n        this._activities.getOrWait(newActId).then(function (act) {\r\n            act._updateDescriptors(descriptors);\r\n            var descriptorAsObjectFromAPI = act.attached.filter(function (u) { return u.ownerId === descriptor.ownerId; })[0];\r\n            _this._attachedCallbacks.forEach(function (callback) {\r\n                try {\r\n                    callback(act, descriptorAsObjectFromAPI);\r\n                }\r\n                catch (err) {\r\n                    return;\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivitiesDetached = function (data) {\r\n        var _this = this;\r\n        var oldActId = data.oldActivityId;\r\n        var newActId = data.newActivityId;\r\n        var descriptors = data.descriptors;\r\n        var descriptor = data.descriptor;\r\n        this._activities.getOrWait(oldActId).then(function (oldAct) {\r\n            oldAct._updateDescriptors(descriptors);\r\n            _this._activities.getOrWait(newActId).then(function (newAct) {\r\n                _this._detachedCallbacks.forEach(function (callback) {\r\n                    try {\r\n                        callback(newAct, oldAct, descriptor);\r\n                    }\r\n                    catch (err) {\r\n                        return;\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivityDescriptorsRefreshed = function (data) {\r\n        var id = data.id;\r\n        var descriptors = data.descriptors;\r\n        var act = this._activities.getByName(id);\r\n        if (act) {\r\n            act._updateDescriptors(descriptors);\r\n        }\r\n    };\r\n    ActivityManager.prototype.refreshDescriptors = function () {\r\n        var _this = this;\r\n        this._bridge.getAttachedDescriptors()\r\n            .then(function (map) {\r\n            // populate descriptors\r\n            if (map) {\r\n                Object.keys(map).forEach(function (key) {\r\n                    var actId = key;\r\n                    var descriptors = map[key];\r\n                    var act = _this._activities.getByName(actId);\r\n                    if (act) {\r\n                        act._updateDescriptors(descriptors);\r\n                    }\r\n                });\r\n            }\r\n            _this._descriptorsMarker.signal(\"Successfully got descriptors\");\r\n        })\r\n            .catch(function (err) {\r\n            _this._descriptorsMarker.error(\"failed to get descriptors - \" + err);\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleWindowFrameColorChanged = function (win) {\r\n        if (!win.activityId) {\r\n            return;\r\n        }\r\n        var act = this._activities.getByName(win.activityId);\r\n        if (!act) {\r\n            return;\r\n        }\r\n        // notify for the owner only\r\n        if (!act.owner) {\r\n            return;\r\n        }\r\n        if (act.owner.underlyingWindow.id !== win.id) {\r\n            return;\r\n        }\r\n        this._frameColorChangesCallbacks.forEach(function (callback) {\r\n            try {\r\n                callback(act, win.frameColor);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    return ActivityManager;\r\n}());\r\nexports.default = ActivityManager;\r\n//# sourceMappingURL=activityManager.js.map\n\n/***/ }),\n/* 45 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar LocalWindowFactory = /** @class */ (function () {\r\n    function LocalWindowFactory(createFunction) {\r\n        this.createFunction = createFunction;\r\n        this.createFunction = createFunction;\r\n    }\r\n    LocalWindowFactory.prototype.create = function (activityInfo) {\r\n        return this.createFunction(activityInfo);\r\n    };\r\n    return LocalWindowFactory;\r\n}());\r\nexports.LocalWindowFactory = LocalWindowFactory;\r\n//# sourceMappingURL=localWindowFactory.js.map\n\n/***/ }),\n/* 46 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AttachedActivityDescriptor = /** @class */ (function () {\r\n    function AttachedActivityDescriptor(manager, ownerActivityId, state) {\r\n        this._manager = manager;\r\n        this._ownerActivityId = ownerActivityId;\r\n        this._state = state;\r\n    }\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"ownerId\", {\r\n        get: function () {\r\n            return this._state.ownerId;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"windowIds\", {\r\n        get: function () {\r\n            return this._state.windowIds;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"frameColor\", {\r\n        get: function () {\r\n            return this._state.frameColor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"context\", {\r\n        get: function () {\r\n            return this._state.context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"tag\", {\r\n        get: function () {\r\n            return this._state.tag;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AttachedActivityDescriptor.prototype.detach = function (descriptor) {\r\n        var _this = this;\r\n        descriptor = descriptor || {};\r\n        var merged = {};\r\n        Object.keys(this._state).forEach(function (prop) {\r\n            merged[prop] = _this._state[prop];\r\n        });\r\n        merged.context = descriptor.context || merged.context;\r\n        merged.frameColor = descriptor.frameColor || merged.frameColor;\r\n        return this._manager.detachActivities(this._ownerActivityId, merged);\r\n    };\r\n    return AttachedActivityDescriptor;\r\n}());\r\nexports.AttachedActivityDescriptor = AttachedActivityDescriptor;\r\n//# sourceMappingURL=attachedActivityDescriptor.js.map\n\n/***/ }),\n/* 47 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar entityEvent_1 = __webpack_require__(2);\r\nvar entityEvent_2 = __webpack_require__(2);\r\n/**\r\n * Collection of ActivityEntities that provides change notifications\r\n * @module entityCollection\r\n * @private\r\n */\r\nvar EntityObservableCollection = /** @class */ (function () {\r\n    function EntityObservableCollection(processNew) {\r\n        this._items = {};\r\n        this._listeners = [];\r\n        this._processNew = processNew;\r\n    }\r\n    /**\r\n     * Adds one item to the collection\r\n     */\r\n    EntityObservableCollection.prototype.addOne = function (item) {\r\n        this.add([item]);\r\n    };\r\n    /**\r\n     * Adds an array of items to the collection\r\n     */\r\n    EntityObservableCollection.prototype.add = function (items) {\r\n        var _this = this;\r\n        items.forEach(function (element) {\r\n            _this.process(new entityEvent_1.EntityEvent(element, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added)));\r\n        });\r\n    };\r\n    /**\r\n     * Process existing EntityEvent\r\n     */\r\n    EntityObservableCollection.prototype.process = function (event) {\r\n        var context = event.context;\r\n        var type = context.type;\r\n        var entity = event.entity;\r\n        // here we're populating some data which particular implementations (e.g.\r\n        // GW3) can't provide\r\n        // TODO: extract these cases into external filters\r\n        // activity status change without old status?\r\n        // grab it from the existing entity\r\n        if (type === entityEvent_1.EntityEventType.StatusChange &&\r\n            !context.oldStatus) {\r\n            var act = this._items[entity.id];\r\n            if (act) {\r\n                context.oldStatus = act.status;\r\n            }\r\n        }\r\n        // the GW3 bridge notifies us of possible status changes (it's mostly stateless so\r\n        // it can't/doesn't distinguish between JOINED ACTIVITY for an activity we already\r\n        // know about vs a brand new activity. for this reason, we just coalesce status\r\n        // updates which indicate the same state.\r\n        if (type === entityEvent_1.EntityEventType.StatusChange &&\r\n            context.oldStatus &&\r\n            context.newStatus &&\r\n            context.oldStatus.state ===\r\n                context.newStatus.state) {\r\n            context.type = entityEvent_1.EntityEventType.Updated;\r\n        }\r\n        // GW3: coalesce multiple joined/left events\r\n        if (typeof htmlContainer === \"undefined\") {\r\n            if (type === entityEvent_1.EntityEventType.ActivityWindowJoinedActivity &&\r\n                this._items[entity.id] &&\r\n                this._items[entity.id].activity) {\r\n                context.type = entityEvent_1.EntityEventType.Updated;\r\n            }\r\n            if (type === entityEvent_1.EntityEventType.ActivityWindowLeftActivity &&\r\n                this._items[entity.id] &&\r\n                !this._items[entity.id].activity) {\r\n                context.type = entityEvent_1.EntityEventType.Updated;\r\n            }\r\n        }\r\n        // update internal collections (adding the entity or updating existing entity). From that\r\n        // point start using the internalEntity\r\n        // NB: undefined properties are coalesced, null properties represent removals\r\n        var internalEntity = this._updateInternalCollections(entity, type, context);\r\n        this._notifyListeners(internalEntity, context);\r\n        return internalEntity;\r\n    };\r\n    /**\r\n     * Gets all items from the collection.\r\n     */\r\n    EntityObservableCollection.prototype.get = function () {\r\n        var result = [];\r\n        for (var key in this._items) {\r\n            if (this._items.hasOwnProperty(key)) {\r\n                var element = this._items[key];\r\n                result.push(element);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    /**\r\n     * Gets item by name/id\r\n     * @param name  Name/id of the item to get\r\n     * @returns     Item if found; undefined if not\r\n     */\r\n    EntityObservableCollection.prototype.getByName = function (name) {\r\n        // this does not work for some reason\r\n        // return this._items[name];\r\n        for (var key in this._items) {\r\n            if (key === name) {\r\n                return this._items[key];\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n    /**\r\n     * Gets a item if in the collection or waits for it to appear\r\n     * @param name\r\n     * @returns {Promise<T>}\r\n     */\r\n    EntityObservableCollection.prototype.getOrWait = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            var entityAddedHandler = function (entity) {\r\n                if (entity.id !== name) {\r\n                    return;\r\n                }\r\n                resolve(entity);\r\n                _this.unsubscribe(entityAddedHandler);\r\n            };\r\n            _this.subscribe(entityAddedHandler);\r\n            // try to get right away - if not here wait for it to appear\r\n            var window = _this.getByName(name);\r\n            if (window) {\r\n                _this.unsubscribe(entityAddedHandler);\r\n                resolve(window);\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Subscribes a listener for changes\r\n     * @param handler Callback for changes\r\n     */\r\n    EntityObservableCollection.prototype.subscribe = function (handler) {\r\n        var _this = this;\r\n        this._listeners.push(handler);\r\n        // replay existing items for new subscribers\r\n        Object.keys(this._items).forEach(function (key) {\r\n            var element = _this._items[key];\r\n            handler(element, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added.toString()));\r\n        });\r\n        return function () {\r\n            _this.unsubscribe(handler);\r\n        };\r\n    };\r\n    /**\r\n     *  Unsubscribes a listener\r\n     */\r\n    EntityObservableCollection.prototype.unsubscribe = function (handler) {\r\n        var index = this._listeners.indexOf(handler);\r\n        if (index !== -1) {\r\n            this._listeners.splice(index, 1);\r\n        }\r\n    };\r\n    /**\r\n     * Notify all listeners for some event\r\n     */\r\n    EntityObservableCollection.prototype._notifyListeners = function (entity, context) {\r\n        this._listeners.forEach(function (listener) {\r\n            try {\r\n                listener(entity, context);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Update internal collections (usually after some kind of modification event has arrived)\r\n     */\r\n    EntityObservableCollection.prototype._updateInternalCollections = function (entity, type, context) {\r\n        var entityAsAny = entity;\r\n        // #deleteme TODO: refactor - currently we apply some rules for each type\r\n        var isActivityDestroy = (type === entityEvent_1.EntityEventType.StatusChange &&\r\n            entityAsAny.status &&\r\n            entityAsAny.status.state === entityEvent_2.ActivityState.Destroyed) ||\r\n            (type === entityEvent_1.EntityEventType.StatusChange &&\r\n                context &&\r\n                context.newStatus &&\r\n                context.newStatus.state === entityEvent_2.ActivityState.Destroyed);\r\n        // #deleteme TODO: verify this stuff\r\n        // windows have two states - removed from activity and closed (TODO: this only works in GD 2.1 and later)\r\n        var isWindowClose = type === entityEvent_1.EntityEventType.Closed;\r\n        var isTypeRemove = type === entityEvent_1.EntityEventType.Removed && typeof entityAsAny.isIndependent === \"undefined\";\r\n        if (isTypeRemove || isWindowClose || isActivityDestroy) {\r\n            var oldEntity = this._items[entity.id];\r\n            delete this._items[entity.id];\r\n            // on remove return the input entity\r\n            this._processNew(entity);\r\n            if (oldEntity) {\r\n                entity._beforeDelete(oldEntity);\r\n            }\r\n            return entity;\r\n        }\r\n        else {\r\n            var key = entity.id;\r\n            // if new object add, otherwise clone object properties\r\n            if (!this._items.hasOwnProperty(key)) {\r\n                this._processNew(entity);\r\n                this._items[entity.id] = entity;\r\n            }\r\n            else {\r\n                this._items[entity.id]._update(entity);\r\n            }\r\n        }\r\n        return this._items[entity.id];\r\n    };\r\n    return EntityObservableCollection;\r\n}());\r\nexports.EntityObservableCollection = EntityObservableCollection;\r\n//# sourceMappingURL=entityObservableCollection.js.map\n\n/***/ }),\n/* 48 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityModule_1 = __webpack_require__(42);\r\nexports.ActivityModule = activityModule_1.ActivityModule;\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 49 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar application_1 = __webpack_require__(50);\r\nvar callback_registry_1 = __webpack_require__(0);\r\nvar instance_1 = __webpack_require__(54);\r\nvar AppManagerImpl = /** @class */ (function () {\r\n    function AppManagerImpl(_agm, _activities, _windows, _logger, _gdMajorVersion) {\r\n        var _this = this;\r\n        this._agm = _agm;\r\n        this._activities = _activities;\r\n        this._windows = _windows;\r\n        this._logger = _logger;\r\n        this._gdMajorVersion = _gdMajorVersion;\r\n        this._apps = {};\r\n        this._instances = [];\r\n        this._registry = callback_registry_1.default();\r\n        this.application = function (name) {\r\n            return _this._apps[name];\r\n        };\r\n        this.applications = function () {\r\n            return Object.keys(_this._apps).map(function (k) { return _this._apps[k]; });\r\n        };\r\n        this.instances = function () {\r\n            return _this._instances;\r\n        };\r\n        this.getMyInstance = function () {\r\n            if (_this._gdMajorVersion >= 3) {\r\n                // GD3 check\r\n                var instanceId_1 = window.glue42gd.appInstanceId;\r\n                return _this._instances.filter(function (i) { return i.id === instanceId_1; })[0];\r\n            }\r\n            if (_this._gdMajorVersion === 2) {\r\n                var myWindowId_1 = window.htmlContainer.windowId;\r\n                var matchingInstances = _this._instances.filter(function (i) { return i.id === myWindowId_1; });\r\n                if (matchingInstances.length < 2) {\r\n                    return matchingInstances[0];\r\n                }\r\n                // If we have two matches - this can happen only when asking for the window\r\n                // of activity owner - so return the instance that is not activity instance\r\n                return matchingInstances.filter(function (i) { return !i.isActivityInstance; })[0];\r\n            }\r\n            return undefined;\r\n        };\r\n        this.handleAppAdded = function (props) {\r\n            var id = _this._getAppId(props);\r\n            _this._logger.trace(\"adding app \" + id);\r\n            _this._apps[id] = new application_1.default(_this, id, _this._agm);\r\n            var app = _this._updateAppFromProps(props);\r\n            _this._registry.execute(\"appAdded\", app);\r\n        };\r\n        this.handleAppUpdated = function (props) {\r\n            // TODO: check side effects, is this._apps updated?\r\n            var app = _this._updateAppFromProps(props);\r\n            _this._registry.execute(\"appChanged\", app);\r\n        };\r\n        this.handleAppRemoved = function (props) {\r\n            var id = _this._getAppId(props);\r\n            _this._logger.trace(\"removing app \" + id);\r\n            var app = _this.application(id);\r\n            // remove all instances related to the app\r\n            _this._instances = _this._instances.filter(function (i) { return i.application.name !== app.name; });\r\n            delete _this._apps[id];\r\n            _this._registry.execute(\"appRemoved\", app);\r\n        };\r\n        this.handleAppReady = function (props) {\r\n            var id = _this._getAppId(props);\r\n            var app = _this._getAppOrThrow(id);\r\n            app.updateFromProps(props);\r\n            if (app.available) {\r\n                _this._registry.execute(\"appAvailable\", app);\r\n            }\r\n            else {\r\n                _this._registry.execute(\"appUnavailable\", app);\r\n            }\r\n        };\r\n        this.handleInstanceStarted = function (props) {\r\n            _this._logger.trace(\"started app \" + props.Name + \" \" + props.Id);\r\n            var id = _this._getInstanceId(props);\r\n            var app = _this.application(_this._getInstanceAppName(props));\r\n            var instance = new instance_1.default(id, app, _this, _this._agm, _this._activities, _this._windows);\r\n            _this._updateInstanceFromProps(instance, props);\r\n            _this._instances.push(instance);\r\n            _this._registry.execute(\"instanceStarted\", instance);\r\n        };\r\n        this.handleInstanceStopped = function (props) {\r\n            _this._logger.trace(\"failed to start app \" + props.Name + \" \" + props.Id);\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, appName);\r\n            _this._instances = _this._instances.filter(function (i) { return !_this._matchInstance(i, id, appName); });\r\n            _this._registry.execute(\"instanceStopped\", instance);\r\n            instance.done();\r\n        };\r\n        this.handleInstanceAgmServerReady = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, appName);\r\n            instance.updateAgmInstanceFromProps(props);\r\n            _this._registry.execute(\"instanceAgmServerReady\", instance);\r\n        };\r\n        this.handleInstanceStartFailed = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var app = _this.application(_this._getInstanceAppName(props));\r\n            var startFailed = true;\r\n            var instance = new instance_1.default(id, app, undefined, undefined, undefined, undefined, startFailed);\r\n            _this._updateInstanceFromProps(instance, props);\r\n            _this._registry.execute(\"instanceStartFailed\", instance);\r\n        };\r\n        this.handleInstanceUpdated = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var app = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, app);\r\n            _this._updateInstanceFromProps(instance, props);\r\n        };\r\n        /** Event subscription methods */\r\n        this.onInstanceStarted = function (callback) {\r\n            _this._replay(_this._instances, callback);\r\n            return _this._registry.add(\"instanceStarted\", callback);\r\n        };\r\n        this.onInstanceStartFailed = function (callback) {\r\n            return _this._registry.add(\"instanceStartFailed\", callback);\r\n        };\r\n        this.onInstanceStopped = function (callback) {\r\n            return _this._registry.add(\"instanceStopped\", callback);\r\n        };\r\n        this.onInstanceUpdated = function (callback) {\r\n            return _this._registry.add(\"instanceChanged\", callback);\r\n        };\r\n        this.onInstanceAgmServerReady = function (callback) {\r\n            return _this._registry.add(\"instanceAgmServerReady\", callback);\r\n        };\r\n        this.onAppAdded = function (callback) {\r\n            _this._replay(_this._apps, callback);\r\n            return _this._registry.add(\"appAdded\", callback);\r\n        };\r\n        this.onAppRemoved = function (callback) {\r\n            return _this._registry.add(\"appRemoved\", callback);\r\n        };\r\n        this.onAppAvailable = function (callback) {\r\n            return _this._registry.add(\"appAvailable\", callback);\r\n        };\r\n        this.onAppUnavailable = function (callback) {\r\n            return _this._registry.add(\"appUnavailable\", callback);\r\n        };\r\n        this.onAppChanged = function (callback) {\r\n            return _this._registry.add(\"appChanged\", callback);\r\n        };\r\n        //\r\n    }\r\n    AppManagerImpl.prototype._getAppOrThrow = function (id) {\r\n        var result = this.application(id);\r\n        if (!result) {\r\n            throw Error(\"app with id \" + id + \" not found\");\r\n        }\r\n        return result;\r\n    };\r\n    AppManagerImpl.prototype._getAppId = function (props) {\r\n        return props.Name;\r\n    };\r\n    AppManagerImpl.prototype._matchInstance = function (instance, id, appName) {\r\n        return instance.id === id && instance.application.name === appName;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceByIdAndName = function (id, appName) {\r\n        var _this = this;\r\n        return this._instances.filter(function (i) { return _this._matchInstance(i, id, appName); })[0];\r\n    };\r\n    AppManagerImpl.prototype._getInstanceOrThrow = function (id, appName) {\r\n        var result = this._getInstanceByIdAndName(id, appName);\r\n        if (!result) {\r\n            throw Error(\"instance with id \" + id + \" not found\");\r\n        }\r\n        return result;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceId = function (props) {\r\n        return props.Id;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceAppName = function (props) {\r\n        return props.Name;\r\n    };\r\n    AppManagerImpl.prototype._updateAppFromProps = function (props) {\r\n        var id = this._getAppId(props);\r\n        this._logger.trace(\"updating app with  + \" + id + \", \" + props);\r\n        var app = this._getAppOrThrow(id);\r\n        app.updateFromProps(props);\r\n        return app;\r\n    };\r\n    AppManagerImpl.prototype._updateInstanceFromProps = function (instance, props) {\r\n        this._logger.trace(\"updating instance with \" + this._getInstanceId(props) + \" for app \" + this._getInstanceAppName(props));\r\n        instance.updateFromProps(props);\r\n    };\r\n    AppManagerImpl.prototype._replay = function (itemsToReplay, callback) {\r\n        if (itemsToReplay) {\r\n            // if not array transform to array using Object.values\r\n            if (Array.isArray(itemsToReplay)) {\r\n                itemsToReplay.forEach(function (item) { return callback(item); });\r\n            }\r\n            else {\r\n                var itemsToReplayArr = Object.keys(itemsToReplay).map(function (key) { return itemsToReplay[key]; });\r\n                itemsToReplayArr.forEach(function (item) { return callback(item); });\r\n            }\r\n        }\r\n    };\r\n    return AppManagerImpl;\r\n}());\r\nexports.default = AppManagerImpl;\r\n//# sourceMappingURL=app-manager.js.map\n\n/***/ }),\n/* 50 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgmNames = __webpack_require__(5);\r\nvar callback_registry_1 = __webpack_require__(0);\r\nvar helper_1 = __webpack_require__(11);\r\nvar ApplicationImpl = /** @class */ (function () {\r\n    function ApplicationImpl(_appManager, _name, _agm) {\r\n        // TODO: Replace string events with constants. The string declaration of the registry event name should only ever appear once. Ever. Period.\r\n        var _this = this;\r\n        this._appManager = _appManager;\r\n        this._name = _name;\r\n        this._agm = _agm;\r\n        this._registry = callback_registry_1.default();\r\n        // subscribe for events from app-manager\r\n        _appManager.onInstanceStarted(function (instance) {\r\n            if (instance.application.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"instanceStarted\", instance);\r\n        });\r\n        _appManager.onInstanceStopped(function (instance) {\r\n            if (instance.application.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"instanceStopped\", instance);\r\n        });\r\n        _appManager.onAppRemoved(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appRemoved\", app);\r\n        });\r\n        _appManager.onAppChanged(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appChanged\", app);\r\n        });\r\n        _appManager.onAppAvailable(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appAvailable\", app);\r\n        });\r\n        _appManager.onAppUnavailable(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appUnavailable\", app);\r\n        });\r\n    }\r\n    Object.defineProperty(ApplicationImpl.prototype, \"name\", {\r\n        get: function () { return this._name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"title\", {\r\n        get: function () { return this._props.Title; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"version\", {\r\n        get: function () { return this._props.Version; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"autoStart\", {\r\n        get: function () { return this._props.AutoStart; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"isShell\", {\r\n        get: function () { return this._props.IsShell; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"caption\", {\r\n        get: function () { return this._props.Caption; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"hidden\", {\r\n        get: function () { return this._props.IsHidden; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"container\", {\r\n        get: function () { return this._props.ApplicationName; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"activityType\", {\r\n        get: function () { return this._props.ActivityType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"activityWindowType\", {\r\n        get: function () { return this._props.ActivityWindowType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"windowSettings\", {\r\n        get: function () {\r\n            if (!this._props.Arguments) {\r\n                return {};\r\n            }\r\n            return helper_1.objectClone(this._props.Arguments);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"allowMultiple\", {\r\n        get: function () { return this._props.AllowMultiple; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"available\", {\r\n        get: function () { return this._props.IsReady || false; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"icon\", {\r\n        get: function () { return this._props.Icon; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"iconURL\", {\r\n        get: function () { return this._props.IconUrl; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"sortOrder\", {\r\n        get: function () { return this._props.SortOrder; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"userProperties\", {\r\n        get: function () {\r\n            if (!this._props.UserProperties) {\r\n                return {};\r\n            }\r\n            return helper_1.objectClone(this._props.UserProperties);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"isActivity\", {\r\n        get: function () {\r\n            return this._props.ActivityType !== undefined && this._props.ActivityType !== \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"configuration\", {\r\n        get: function () {\r\n            return {\r\n                autoStart: this._props.AutoStart,\r\n                caption: this._props.Caption,\r\n                hidden: this._props.IsHidden,\r\n                container: this._props.ApplicationName,\r\n                activityType: this._props.ActivityType,\r\n                allowMultiple: this._props.AllowMultiple\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"instances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances().filter(function (instance) { return instance.application.name === _this._name; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"type\", {\r\n        get: function () {\r\n            return this._props.Type;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"mode\", {\r\n        get: function () {\r\n            if (!this._props) {\r\n                // no info about the app\r\n                return \"unknown\";\r\n            }\r\n            // GD3 - we always have Mode from the stream object\r\n            if (this._props.Mode && typeof this._props.Mode === \"string\") {\r\n                return this._props.Mode.toLowerCase();\r\n            }\r\n            // GD2\r\n            // return unknown for activity applications\r\n            if (this.isActivity) {\r\n                return \"unknown\";\r\n            }\r\n            // check definition -> hc.args.mode\r\n            if (this._props.Arguments && this._props.Arguments.mode && typeof this._props.Arguments.mode === \"string\") {\r\n                return this._props.Arguments.mode.toLowerCase();\r\n            }\r\n            // if no hc.args.mode, check hc.WindowStyleAttributes\r\n            var styleAttributes = this._props.WindowStyleAttributes;\r\n            if (styleAttributes) {\r\n                // WindowStyleAttributes is not a valid JSON, we will need to find mode in the string\r\n                styleAttributes = styleAttributes.split(\" \").join(\"\");\r\n                var searchFor = \"mode:\\\"\";\r\n                var modeIndex = styleAttributes.indexOf(searchFor);\r\n                if (modeIndex !== -1) {\r\n                    var startModeIndex = modeIndex + searchFor.length;\r\n                    var stopModeIndex = styleAttributes.indexOf(\"\\\"\", startModeIndex);\r\n                    var style = styleAttributes.substr(startModeIndex, stopModeIndex - startModeIndex);\r\n                    if (style && typeof style === \"string\") {\r\n                        return style.toLowerCase();\r\n                    }\r\n                }\r\n            }\r\n            // default mode for GD2\r\n            return \"flat\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ApplicationImpl.prototype.updateFromProps = function (props) {\r\n        var _this = this;\r\n        if (!this._props) {\r\n            this._props = { Name: props.Name };\r\n        }\r\n        Object.keys(props).forEach(function (key) {\r\n            _this._props[key] = props[key];\r\n        });\r\n    };\r\n    ApplicationImpl.prototype.start = function (context, options) {\r\n        var _this = this;\r\n        var name = this._name;\r\n        var startTimeout = 10000;\r\n        return new Promise(function (resolve, reject) {\r\n            options = options || {};\r\n            context = context || {};\r\n            context._t42 = { createWindowArgs: options };\r\n            if (typeof options.waitForAGMReady === \"undefined\") {\r\n                options.waitForAGMReady = true;\r\n            }\r\n            var waitForAGMInstance = options.waitForAGMReady;\r\n            var waitForInstance = !options.waitForAGMReady;\r\n            var waitForApplicationInstance = function (id) {\r\n                // fetch from the current list in app-manager\r\n                var check = function () {\r\n                    var filtered = _this._appManager.instances().filter(function (i) { return i.id === id; });\r\n                    var result;\r\n                    if (filtered.length === 2) {\r\n                        result = filtered[0].isActivityInstance ? filtered[0] : filtered[1];\r\n                    }\r\n                    result = filtered[0];\r\n                    if (result && waitForAGMInstance) {\r\n                        if (result.agm) {\r\n                            return result;\r\n                        }\r\n                        else {\r\n                            return undefined;\r\n                        }\r\n                    }\r\n                    return result;\r\n                };\r\n                var unsub;\r\n                // reject after some timeout\r\n                setTimeout(function () {\r\n                    if (unsub) {\r\n                        unsub();\r\n                        reject(\"timeout\");\r\n                    }\r\n                }, startTimeout);\r\n                var waitFunc = function (i) {\r\n                    if (i.id !== id) {\r\n                        return;\r\n                    }\r\n                    if (unsub) {\r\n                        unsub();\r\n                        unsub = undefined;\r\n                    }\r\n                    // schedule - we need this because there might be more than one\r\n                    // instance with the same id (activity case) - so this handler\r\n                    // will kick for the very first\r\n                    setTimeout(function () {\r\n                        resolve(check());\r\n                    }, 1);\r\n                };\r\n                if (waitForAGMInstance) {\r\n                    unsub = _this._appManager.onInstanceAgmServerReady(waitFunc);\r\n                }\r\n                else {\r\n                    // if not there subscribe for instance events\r\n                    unsub = _this._appManager.onInstanceStarted(waitFunc);\r\n                }\r\n                // try to find it in the current list\r\n                var instances = check();\r\n                if (instances) {\r\n                    unsub = undefined;\r\n                    resolve(instances);\r\n                }\r\n            };\r\n            _this._agm.invoke(AgmNames.StartApplicationMethodName, {\r\n                Name: name,\r\n                Context: context,\r\n                WaitForAgmInstance: waitForAGMInstance,\r\n                WaitForInstance: waitForInstance\r\n            }, \"best\", {\r\n                methodResponseTimeoutMs: startTimeout\r\n            }, function (result) {\r\n                var acsResult = result.returned.Instance_0 || result.returned;\r\n                if (acsResult && acsResult.Id) {\r\n                    // we received instance from ACS, let's wait until it appears on the stream\r\n                    waitForApplicationInstance(acsResult.Id);\r\n                }\r\n                else {\r\n                    // we haven't received instance from ACS - this might happen if the app does not\r\n                    // support tracking instances (e.g. we start internet explorer with some url)\r\n                    resolve(undefined);\r\n                }\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    ApplicationImpl.prototype.onInstanceStarted = function (callback) {\r\n        this._registry.add(\"instanceStarted\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onInstanceStopped = function (callback) {\r\n        this._registry.add(\"instanceStopped\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onAvailable = function (callback) {\r\n        this._registry.add(\"appAvailable\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onUnavailable = function (callback) {\r\n        this._registry.add(\"appUnavailable\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onChanged = function (callback) {\r\n        this._registry.add(\"appChanged\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onRemoved = function (callback) {\r\n        this._registry.add(\"appRemoved\", callback);\r\n    };\r\n    return ApplicationImpl;\r\n}());\r\nexports.default = ApplicationImpl;\r\n//# sourceMappingURL=application.js.map\n\n/***/ }),\n/* 51 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.OnNotificationEvent = \"OnNotification\";\r\nexports.OnBranchChangedEvent = \"OnBranchChanged\";\r\nexports.OnBranchesModifiedEvent = \"OnBranchesModified\";\r\nexports.OnApplicationAddedEvent = \"OnApplicationAdded\";\r\nexports.OnApplicationRemovedEvent = \"OnApplicationRemoved\";\r\nexports.OnApplicationChangedEvent = \"OnApplicationChanged\";\r\nexports.OnApplicationReadyEvent = \"OnApplicationReady\";\r\nexports.OnApplicationStartedEvent = \"OnApplicationStarted\";\r\nexports.OnApplicationRegisteredEvent = \"OnApplicationRegistered\";\r\nexports.OnApplicationAgmServerReadyEvent = \"OnApplicationAgmServerReady\";\r\nexports.OnApplicationUpdatedEvent = \"OnApplicationUpdated\";\r\nexports.OnApplicationStoppedEvent = \"OnApplicationStopped\";\r\nexports.OnApplicationStartFailedEvent = \"OnApplicationStartFailed\";\r\n//# sourceMappingURL=event-names.js.map\n\n/***/ }),\n/* 52 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgmNames = __webpack_require__(5);\r\nvar EventNames = __webpack_require__(51);\r\nvar helper_1 = __webpack_require__(11);\r\n/** Subscribe for the AGM stream published by ACS and distributes events to applications and instances components */\r\nfunction createDataSubscription(agm, applications, entitlements, skipIcons) {\r\n    var subscription;\r\n    var start = function () {\r\n        var resolveFunc;\r\n        var rejectFunc;\r\n        var resultPromise = new Promise(function (resolve, reject) {\r\n            resolveFunc = resolve;\r\n            rejectFunc = reject;\r\n        });\r\n        agm.subscribe(AgmNames.OnEventMethodName, { arguments: { skipIcon: skipIcons }, waitTimeoutMs: 10000 })\r\n            .then(function (s) {\r\n            subscription = s;\r\n            subscription.onData(function (streamData) {\r\n                var events = streamData.data;\r\n                helper_1.objectValues(events[EventNames.OnApplicationAddedEvent])\r\n                    .map(function (item) { return applications.handleAppAdded(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationChangedEvent])\r\n                    .map(function (item) { return applications.handleAppUpdated(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationRemovedEvent])\r\n                    .map(function (item) { return applications.handleAppRemoved(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationReadyEvent])\r\n                    .map(function (item) { return applications.handleAppReady(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationStartedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStarted(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationStartFailedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStartFailed(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationStoppedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStopped(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationUpdatedEvent])\r\n                    .map(function (item) { return applications.handleInstanceUpdated(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationAgmServerReadyEvent])\r\n                    .map(function (item) { return applications.handleInstanceAgmServerReady(item); });\r\n                helper_1.objectValues(events[EventNames.OnBranchChangedEvent])\r\n                    .map(function (item) { return entitlements.handleBranchModified(item); });\r\n                helper_1.objectValues(events[EventNames.OnBranchesModifiedEvent])\r\n                    .map(function (item) { return entitlements.handleBranchesModified(item); });\r\n                resolveFunc();\r\n            });\r\n            subscription.onFailed(function (err) { return rejectFunc(err); });\r\n        })\r\n            .catch(function (err) { return rejectFunc(\"Error subscribing for \" + AgmNames.OnEventMethodName + \" stream. Err: \" + err); });\r\n        return resultPromise;\r\n    };\r\n    var stop = function () {\r\n        if (subscription) {\r\n            subscription.close();\r\n        }\r\n    };\r\n    return {\r\n        start: start,\r\n        stop: stop\r\n    };\r\n}\r\nexports.default = createDataSubscription;\r\n//# sourceMappingURL=data-subscription.js.map\n\n/***/ }),\n/* 53 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgmNames = __webpack_require__(5);\r\nvar callback_registry_1 = __webpack_require__(0);\r\nvar promisify = __webpack_require__(37);\r\nvar EntitlementsImpl = /** @class */ (function () {\r\n    function EntitlementsImpl(_agm) {\r\n        var _this = this;\r\n        this._agm = _agm;\r\n        this._registry = callback_registry_1.default();\r\n        this.handleBranchModified = function (branch) {\r\n            _this._registry.execute(\"branchChanged\", branch);\r\n        };\r\n        this.handleBranchesModified = function (branches) {\r\n            _this._registry.execute(\"branchesChanged\", branches);\r\n        };\r\n        this.getRegion = function (success, error) {\r\n            return promisify(_this._agmInvoke(AgmNames.GetConfigurationRegionMethodName, function (e) { return e.returned.Region; }), success, error);\r\n        };\r\n        this.getBranches = function (success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.GetBranchesMethodName, function (e) {\r\n                var obj = e.returned.Branches;\r\n                return Object.keys(obj).map(function (key) { return obj[key]; });\r\n            });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.getCurrentBranch = function (success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.GetCurrentBranchMethodName, function (e) { return e.returned.Branch; }, undefined);\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.setRegion = function (region, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.SetConfigurationRegionMethodName, function (e) { return e.returned.ResultMessage; }, { Region: region });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.setCurrentBranch = function (branch, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.SetCurrentBranchMethodName, function (e) { return e.returned.ResultMessage; }, { Branch: branch });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.currentUser = function (success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.GetUserMethodName);\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.getFunctionalEntitlement = function (funct, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.GetFunctionalEntitlementMethodName, function (e) { return e.returned.Entitlement; }, { Function: funct });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.getFunctionalEntitlementBranch = function (funct, branch, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.GetFunctionalEntitlementMethodName, function (e) { return e.returned.Entitlement; }, { Function: funct, Branch: branch });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.canI = function (func, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.CanIMethodName, function (e) { return e.returned.Result; }, { Function: func });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.canIBranch = function (func, branch, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.CanIMethodName, function (e) { return e.returned.Result; }, { Function: func, Branch: branch });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.onBranchesChanged = function (callback) {\r\n            _this._registry.add(\"branchesChanged\", callback);\r\n        };\r\n        this.onBranchChanged = function (callback) {\r\n            _this._registry.add(\"branchChanged\", callback);\r\n        };\r\n        this.exit = function (options) {\r\n            return _this._agmInvoke(AgmNames.ShutdownMethodName, null, options);\r\n        };\r\n        this._agmInvoke = function (method, transformFunction, args) {\r\n            args = args || {};\r\n            return new Promise(function (resolve, reject) {\r\n                var errHandler = function (error) { return reject(error); };\r\n                _this._agm.invoke(method, args)\r\n                    .then(function (result) {\r\n                    if (!transformFunction) {\r\n                        transformFunction = function (d) { return d.returned; };\r\n                    }\r\n                    resolve(transformFunction(result));\r\n                })\r\n                    .catch(errHandler);\r\n            });\r\n        };\r\n        //\r\n    }\r\n    return EntitlementsImpl;\r\n}());\r\nexports.default = EntitlementsImpl;\r\n//# sourceMappingURL=entitlements.js.map\n\n/***/ }),\n/* 54 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgmNames = __webpack_require__(5);\r\nvar callback_registry_1 = __webpack_require__(0);\r\nvar InstanceImpl = /** @class */ (function () {\r\n    function InstanceImpl(_id, _app, _appManager, _agm, _activities, _windows, startFailed) {\r\n        var _this = this;\r\n        this._id = _id;\r\n        this._app = _app;\r\n        this._appManager = _appManager;\r\n        this._agm = _agm;\r\n        this._activities = _activities;\r\n        this._windows = _windows;\r\n        this.onAgmReady = this._addToRegistry(\"agmReady\");\r\n        this.onStopped = this._addToRegistry(\"stopped\");\r\n        this._registry = callback_registry_1.default();\r\n        if (startFailed) {\r\n            return;\r\n        }\r\n        this._unsubscribeInstanceStopped = this._appManager.onInstanceStopped(function (instance) {\r\n            if (instance.id !== _this._id) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"stopped\", instance);\r\n        });\r\n        this._unsubscribeInstanceAgmServerReady = this._appManager.onInstanceAgmServerReady(function (instance) {\r\n            if (instance.id !== _this._id) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"agmReady\", instance);\r\n        });\r\n    }\r\n    Object.defineProperty(InstanceImpl.prototype, \"id\", {\r\n        get: function () { return this._id; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"application\", {\r\n        get: function () { return this._app; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activity\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (!this._activities) {\r\n                throw new Error(\"This method requires glue.activities library to be enabled.\");\r\n            }\r\n            return this._activities.all.instances.get()\r\n                .filter(function (activityInstance) { return activityInstance.id === _this._activityId; })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityInstances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances()\r\n                .filter(function (i) { return i.context && (i.context.activityId === _this._activityId); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityOwnerInstance\", {\r\n        get: function () {\r\n            return this._appManager.instances()\r\n                .filter(function (instance) {\r\n                if (instance.window && instance.window.context) {\r\n                    var instWinCntx = instance.window.context;\r\n                    if (instWinCntx._t42 && instWinCntx._t42.activityIsOwner) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"window\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (!this._windows) {\r\n                throw new Error(\"This method requires glue.windows library to be enabled.\");\r\n            }\r\n            var win = this._windows.list().filter(function (w) { return w.id === _this._id; })[0];\r\n            if (!win && this.activity && this.activityOwnerInstance) {\r\n                // This is covering GD3 activity instance\r\n                win = this.activityOwnerInstance.window;\r\n            }\r\n            return win;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"context\", {\r\n        get: function () { return this._startUpContext; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"title\", {\r\n        get: function () { return this._title; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isActivityInstance\", {\r\n        get: function () { return this._isActivityInstance; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityId\", {\r\n        get: function () { return this._activityId; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"inActivity\", {\r\n        get: function () { return this._inActivity; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isSingleWindowApp\", {\r\n        get: function () { return !this._inActivity; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"agm\", {\r\n        get: function () {\r\n            return this._agmInstance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InstanceImpl.prototype.updateFromProps = function (props) {\r\n        this._startUpContext = props.Context;\r\n        this._title = props.Title;\r\n        this._isActivityInstance = false;\r\n        if (props.ActivityId && props.ActivityId !== \"\") {\r\n            this._activityId = props.ActivityId;\r\n            this._isActivityInstance = true;\r\n        }\r\n        if (!this._activityId && this._startUpContext && this._startUpContext.activityId) {\r\n            this._activityId = this._startUpContext.activityId;\r\n        }\r\n        this._inActivity = Boolean(this._activityId);\r\n        this.updateAgmInstanceFromProps(props);\r\n    };\r\n    InstanceImpl.prototype.updateAgmInstanceFromProps = function (props) {\r\n        if (!props.AgmServers) {\r\n            return;\r\n        }\r\n        if (props.GD3) {\r\n            var agmInstances = props.AgmServers;\r\n            if (agmInstances) {\r\n                this._agmInstance = agmInstances[0];\r\n            }\r\n        }\r\n        else {\r\n            var gdAgmServers = props.AgmServers;\r\n            var propsAgmServer = Object.keys(gdAgmServers)[0];\r\n            if (!propsAgmServer) {\r\n                return;\r\n            }\r\n            var propsAgm = gdAgmServers[propsAgmServer];\r\n            this._agmInstance = {\r\n                machine: propsAgm.machineName,\r\n                user: propsAgm.userName,\r\n                environment: propsAgm.environment,\r\n                application: propsAgm.applicationName,\r\n            };\r\n        }\r\n    };\r\n    InstanceImpl.prototype.stop = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var unsubscribe = _this._appManager.onInstanceStopped(function (instance) {\r\n                if (instance.id === _this._id) {\r\n                    unsubscribe();\r\n                    resolve();\r\n                }\r\n            });\r\n            _this._agm.invoke(AgmNames.StopApplicationMethodName, {\r\n                Name: _this._app.name,\r\n                Id: _this._id\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n    };\r\n    InstanceImpl.prototype.activate = function () {\r\n        return this._agm.invoke(AgmNames.ActivateApplicationMethodName, { Name: this._app.name, Id: this._id });\r\n    };\r\n    InstanceImpl.prototype.done = function () {\r\n        // remove all handlers\r\n        this._registry.clear();\r\n        // remove subscriptions\r\n        this._unsubscribeInstanceAgmServerReady();\r\n        this._unsubscribeInstanceStopped();\r\n    };\r\n    InstanceImpl.prototype._addToRegistry = function (key) {\r\n        var _this = this;\r\n        return function (callback) {\r\n            _this._registry.add(key, callback);\r\n        };\r\n    };\r\n    return InstanceImpl;\r\n}());\r\nexports.default = InstanceImpl;\r\n//# sourceMappingURL=instance.js.map\n\n/***/ }),\n/* 55 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar app_manager_1 = __webpack_require__(49);\r\nvar entitlements_1 = __webpack_require__(53);\r\nvar snapshot_1 = __webpack_require__(56);\r\nvar data_subscription_1 = __webpack_require__(52);\r\nexports.default = (function (config) {\r\n    if (!config) {\r\n        throw Error(\"config not set\");\r\n    }\r\n    if (!config.agm) {\r\n        throw Error(\"config.agm is missing\");\r\n    }\r\n    var START_ONLY = \"startOnly\";\r\n    var SKIP_ICONS = \"skipIcons\";\r\n    var FULL = \"full\";\r\n    var mode = config.mode || START_ONLY;\r\n    if (mode !== START_ONLY && mode !== SKIP_ICONS && mode !== FULL) {\r\n        throw new Error(\"Invalid mode for appManager lib - \" + mode + \" is not supported\");\r\n    }\r\n    var activities = config.activities;\r\n    var agm = config.agm;\r\n    var logger = config.logger;\r\n    var windows = config.windows;\r\n    var appManager = new app_manager_1.default(agm, activities, windows, logger.subLogger(\"applications\"), config.gdMajorVersion);\r\n    var entitlements = new entitlements_1.default(agm);\r\n    var readyPromise;\r\n    if (mode === START_ONLY) {\r\n        readyPromise = snapshot_1.default(agm, appManager);\r\n    }\r\n    else {\r\n        var subscription = data_subscription_1.default(agm, appManager, entitlements, mode === SKIP_ICONS);\r\n        readyPromise = subscription.start();\r\n    }\r\n    var api = {\r\n        ready: function () { return readyPromise; },\r\n        applications: appManager.applications,\r\n        application: appManager.application,\r\n        onAppAdded: appManager.onAppAdded,\r\n        onAppRemoved: appManager.onAppRemoved,\r\n        onAppChanged: appManager.onAppChanged,\r\n        onAppAvailable: appManager.onAppAvailable,\r\n        onAppUnavailable: appManager.onAppUnavailable,\r\n        instances: appManager.instances,\r\n        get myInstance() {\r\n            return appManager.getMyInstance();\r\n        },\r\n        onInstanceStarted: appManager.onInstanceStarted,\r\n        onInstanceStopped: appManager.onInstanceStopped,\r\n        onInstanceUpdated: appManager.onInstanceUpdated,\r\n        onInstanceStartFailed: appManager.onInstanceStartFailed,\r\n        getRegion: entitlements.getRegion,\r\n        getBranches: entitlements.getBranches,\r\n        getCurrentBranch: entitlements.getCurrentBranch,\r\n        getFunctionalEntitlement: entitlements.getFunctionalEntitlement,\r\n        getFunctionalEntitlementBranch: entitlements.getFunctionalEntitlementBranch,\r\n        setCurrentBranch: entitlements.setCurrentBranch,\r\n        setRegion: entitlements.setRegion,\r\n        currentUser: entitlements.currentUser,\r\n        canI: entitlements.canI,\r\n        canIBranch: entitlements.canIBranch,\r\n        onBranchesChanged: entitlements.onBranchesChanged,\r\n        exit: entitlements.exit\r\n    };\r\n    return api;\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 56 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgmNames = __webpack_require__(5);\r\nvar helper_1 = __webpack_require__(11);\r\n/** Retrieves application snapshot from ACS */\r\nfunction snapshot(agm, appManager) {\r\n    return new Promise(function (resolve, reject) {\r\n        agm.invoke(AgmNames.GetApplicationsMethodName, { skipIcon: true })\r\n            .then(function (response) {\r\n            var data = response.returned;\r\n            if (!data) {\r\n                resolve();\r\n            }\r\n            var applications = data.applications;\r\n            if (!applications) {\r\n                resolve();\r\n            }\r\n            helper_1.objectValues(applications).map(function (item) { return appManager.handleAppAdded(item); });\r\n            resolve();\r\n        })\r\n            .catch(function (err) { return reject(\"Error getting application snapshot: \" + err.message); });\r\n    });\r\n}\r\nexports.default = snapshot;\r\n//# sourceMappingURL=snapshot.js.map\n\n/***/ }),\n/* 57 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction setupAGM(agm, channels) {\r\n    var windowId;\r\n    if (typeof window !== \"undefined\") {\r\n        if (window.htmlContainer) {\r\n            windowId = window.htmlContainer.windowId;\r\n        }\r\n        else if (window.glue42gd) {\r\n            windowId = window.glue42gd.windowId;\r\n        }\r\n    }\r\n    if (!windowId) {\r\n        // not supported\r\n        return;\r\n    }\r\n    // agm interface is available for SW windows only\r\n    agm.invoke(\"T42.Channels.Announce\", { swId: windowId, instance: agm.instance.instance });\r\n    agm.register(\"T42.Channels.Command\", function (args) {\r\n        var command = args.command;\r\n        if (!command) {\r\n            throw new Error(\"missing command argument\");\r\n        }\r\n        if (command === \"join\") {\r\n            var id = args.channel;\r\n            if (!id) {\r\n                throw new Error(\"missing argument id\");\r\n            }\r\n            channels.join(id);\r\n            return;\r\n        }\r\n        if (command === \"leave\") {\r\n            channels.leave();\r\n            return;\r\n        }\r\n        if (command === \"get\") {\r\n            var id = channels.current();\r\n            return { id: id };\r\n        }\r\n        throw new Error(\"unknown command \" + command);\r\n    });\r\n}\r\nexports.setupAGM = setupAGM;\r\n//# sourceMappingURL=agm.js.map\n\n/***/ }),\n/* 58 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(0);\r\nvar ChannelsImpl = /** @class */ (function () {\r\n    function ChannelsImpl(shared) {\r\n        this.shared = shared;\r\n        this.subsKey = \"subs\";\r\n        this.changedKey = \"changed\";\r\n        this.registry = callback_registry_1.default();\r\n        this.shared.subscribe(this.handler.bind(this));\r\n    }\r\n    ChannelsImpl.prototype.current = function () {\r\n        return this.currentContext;\r\n    };\r\n    ChannelsImpl.prototype.subscribe = function (callback) {\r\n        return this.registry.add(this.subsKey, callback);\r\n    };\r\n    ChannelsImpl.prototype.publish = function (data) {\r\n        if (!this.currentContext) {\r\n            throw new Error(\"not joined to any channel\");\r\n        }\r\n        return this.shared.update(this.currentContext, { data: data });\r\n    };\r\n    ChannelsImpl.prototype.join = function (id) {\r\n        this.currentContext = id;\r\n        this.registry.execute(this.changedKey, id);\r\n        return this.shared.switchChannel(id);\r\n    };\r\n    ChannelsImpl.prototype.leave = function () {\r\n        this.currentContext = undefined;\r\n        this.registry.execute(this.changedKey, undefined);\r\n        return this.shared.unsubscribe();\r\n    };\r\n    ChannelsImpl.prototype.all = function () {\r\n        return this.shared.all();\r\n    };\r\n    ChannelsImpl.prototype.changed = function (callback) {\r\n        this.registry.add(this.changedKey, callback);\r\n    };\r\n    ChannelsImpl.prototype.meta = function (name, meta) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    ChannelsImpl.prototype.add = function (info) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var context;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!info) {\r\n                            throw new Error(\"info argument can not be undefined\");\r\n                        }\r\n                        if (!info.name) {\r\n                            throw new Error(\"info.name is missing\");\r\n                        }\r\n                        context = {\r\n                            name: info.name,\r\n                            meta: info.meta || {},\r\n                            data: info.data || {}\r\n                        };\r\n                        return [4 /*yield*/, this.shared.add(info.name, context)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/, context];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.remove = function (id) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    ChannelsImpl.prototype.onChannelAdded = function (cb) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    ChannelsImpl.prototype.onChannelRemoved = function (cb) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    ChannelsImpl.prototype.apps = function (channelId) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    ChannelsImpl.prototype.handler = function (context) {\r\n        this.registry.execute(this.subsKey, context.data, context);\r\n    };\r\n    return ChannelsImpl;\r\n}());\r\nexports.ChannelsImpl = ChannelsImpl;\r\n//# sourceMappingURL=channels.js.map\n\n/***/ }),\n/* 59 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CONTEXT_PREFIX = \"___channel___\";\r\nvar SharedContextSubscriber = /** @class */ (function () {\r\n    function SharedContextSubscriber(contexts) {\r\n        this.contexts = contexts;\r\n        this.unsubscribeFunc = undefined;\r\n        this.current = undefined;\r\n    }\r\n    SharedContextSubscriber.prototype.subscribe = function (callback) {\r\n        this.callback = callback;\r\n    };\r\n    SharedContextSubscriber.prototype.switchChannel = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var sharedContextName, _a;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.unsubscribe();\r\n                        this.current = name;\r\n                        sharedContextName = this.createContextName(name);\r\n                        _a = this;\r\n                        return [4 /*yield*/, this.contexts.subscribe(sharedContextName, function (data) {\r\n                                if (_this.callback) {\r\n                                    _this.callback(data);\r\n                                }\r\n                            })];\r\n                    case 1:\r\n                        _a.unsubscribeFunc = _b.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.unsubscribe = function () {\r\n        if (this.unsubscribeFunc) {\r\n            this.unsubscribeFunc();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    SharedContextSubscriber.prototype.add = function (id, data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var name;\r\n            return __generator(this, function (_a) {\r\n                name = this.createContextName(id);\r\n                return [2 /*return*/, this.contexts.set(name, data)];\r\n            });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.all = function () {\r\n        var allContexts = this.contexts.all();\r\n        var channels = allContexts.filter(function (c) { return c.startsWith(CONTEXT_PREFIX); });\r\n        var ids = channels.map(function (c) { return c.substr(CONTEXT_PREFIX.length); });\r\n        return Promise.resolve(ids);\r\n    };\r\n    SharedContextSubscriber.prototype.update = function (id, data) {\r\n        var name = this.createContextName(id);\r\n        return this.contexts.update(name, data);\r\n    };\r\n    SharedContextSubscriber.prototype.createContextName = function (id) {\r\n        return CONTEXT_PREFIX + id;\r\n    };\r\n    return SharedContextSubscriber;\r\n}());\r\nexports.SharedContextSubscriber = SharedContextSubscriber;\r\n//# sourceMappingURL=contexts.js.map\n\n/***/ }),\n/* 60 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar agm_1 = __webpack_require__(57);\r\nvar contexts_1 = __webpack_require__(59);\r\nvar channels_1 = __webpack_require__(58);\r\nfunction factory(contexts, agm) {\r\n    var sharedContexts = new contexts_1.SharedContextSubscriber(contexts);\r\n    var channels = new channels_1.ChannelsImpl(sharedContexts);\r\n    agm_1.setupAGM(agm, channels);\r\n    return {\r\n        subscribe: channels.subscribe.bind(channels),\r\n        publish: channels.publish.bind(channels),\r\n        all: channels.all.bind(channels),\r\n        current: channels.current.bind(channels),\r\n        join: channels.join.bind(channels),\r\n        leave: channels.leave.bind(channels),\r\n        add: channels.add.bind(channels),\r\n        changed: channels.changed.bind(channels),\r\n        ready: function () { return contexts.ready(); }\r\n    };\r\n}\r\nexports.factory = factory;\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 61 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = (function (options) {\r\n    // Possible options per lib (this is InputLibConfig type)\r\n    // * false - library is disabled (e.g. config.appManager = false)\r\n    // * true - library is enabled in running in default mode (e.g config.appManager = true).\r\n    //          Exception is if default mode is false - in that case it runs default true mode.\r\n    // * string - start in some mode (e.g. config.appManager = \"full\")\r\n    // * object - allows further customization (e.g config.appManager = {mode: \"full\", someSetting: 42})\r\n    //\r\n    // Some libs support different running modes, some do not.\r\n    //\r\n    // Currently defaults are:\r\n    // appManager: disabled\r\n    // layouts: enabled in 'slim' mode\r\n    // activities: enabled in 'trackMyTypeAndInitiatedFromMe' mode\r\n    // windows: enabled (does not support modes)\r\n    //\r\n    // InputLibConfig is transformed to LibConfigObject\r\n    /**\r\n     * Transforms InputLibConfig (the config as specified from the user)\r\n     * to LibConfigObject(internal library configuration)\r\n     */\r\n    function getLibConfig(value, defaultMode, trueMode) {\r\n        // if value is false return undefined\r\n        if (typeof value === \"boolean\" && !value) {\r\n            return undefined;\r\n        }\r\n        // find the mode of the library\r\n        var mode = getModeAsString(value, defaultMode, trueMode);\r\n        // if object we will replace the mode because appManager = {mode: true, setting: 42}\r\n        // should be turned into appManager = {mode: 'slim', setting: 42}\r\n        if (typeof value === \"object\") {\r\n            value.mode = mode;\r\n            return value;\r\n        }\r\n        return {\r\n            mode: mode,\r\n        };\r\n    }\r\n    /**\r\n     * Finds the mode based for a given library\r\n     * 1. If object we call recursively using object.mode for value\r\n     * 1. If the user hasn't specified anything we use the hard coded defaults\r\n     * 3. If the value is false or it got defaulted to false, we return undefined\r\n     * 4. If the value is true we return trueMode or defaultMode (if trueMode is undefined)\r\n     */\r\n    function getModeAsString(value, defaultMode, trueMode) {\r\n        if (typeof value === \"object\") {\r\n            // 1. if object\r\n            return getModeAsString(value.mode, defaultMode, trueMode) + \"\";\r\n        }\r\n        else if (typeof value === \"undefined\") {\r\n            // 2. if the user does not pass anything\r\n            if (typeof defaultMode === \"boolean\" && !defaultMode) {\r\n                // 3. if gets defaulted to false, the library should be off\r\n                return undefined;\r\n            }\r\n            else {\r\n                return defaultMode + \"\";\r\n            }\r\n        }\r\n        else if (typeof value === \"boolean\") {\r\n            // 4. if the user passes true, use trueMode or defaultMode\r\n            if (value) {\r\n                // if the user passes true, use trueMode or defaultMode\r\n                return ((trueMode === undefined) ? defaultMode : trueMode) + \"\";\r\n            }\r\n            else {\r\n                // 3. if the user passes false, the library should be off\r\n                return undefined;\r\n            }\r\n        }\r\n        return value + \"\";\r\n    }\r\n    var appDefaultMode = false;\r\n    var appDefaultTrueMode = \"startOnly\";\r\n    var activitiesDefaultMode = \"trackMyTypeAndInitiatedFromMe\";\r\n    var layoutsDefaultMode = \"slim\";\r\n    return {\r\n        layouts: getLibConfig(options.layouts, layoutsDefaultMode),\r\n        activities: getLibConfig(options.activities, activitiesDefaultMode),\r\n        appManager: getLibConfig(options.appManager, appDefaultMode, appDefaultTrueMode),\r\n        windows: getLibConfig(options.windows, true),\r\n        channels: getLibConfig(options.channels || false, false)\r\n    };\r\n});\r\n//# sourceMappingURL=config.js.map\n\n/***/ }),\n/* 62 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(0);\r\nvar CommandMethod = \"T42.Hotkeys.Command\";\r\nvar InvokeMethod = \"T42.Hotkeys.Invoke\";\r\nvar RegisterCommand = \"register\";\r\nvar UnregisterCommand = \"unregister\";\r\nvar UnregisterAllCommand = \"unregisterAll\";\r\nvar HotkeysImpl = /** @class */ (function () {\r\n    function HotkeysImpl(agm) {\r\n        this.agm = agm;\r\n        this.registry = callback_registry_1.default();\r\n        this.firstHotkey = true;\r\n        this.hotkeys = new Map();\r\n    }\r\n    HotkeysImpl.prototype.register = function (info, callback) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var hkToLower;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info === \"undefined\") {\r\n                            throw new Error(\"Hotkey parameter missing\");\r\n                        }\r\n                        if (typeof info === \"string\") {\r\n                            info = {\r\n                                hotkey: info\r\n                            };\r\n                        }\r\n                        else {\r\n                            if (!info.hotkey) {\r\n                                throw new Error(\"Info's hotkey parameter missing\");\r\n                            }\r\n                            info = {\r\n                                hotkey: info.hotkey,\r\n                                description: info.description\r\n                            };\r\n                        }\r\n                        hkToLower = this.formatHotkey(info.hotkey);\r\n                        if (this.hotkeys.has(hkToLower)) {\r\n                            throw new Error(\"Shortcut for \" + hkToLower + \" already registered\");\r\n                        }\r\n                        if (!this.firstHotkey) return [3 /*break*/, 2];\r\n                        this.firstHotkey = false;\r\n                        return [4 /*yield*/, this.registerInvokeAGMMethod()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        // store the callback\r\n                        this.registry.add(hkToLower, callback);\r\n                        // invoke GD method\r\n                        return [4 /*yield*/, this.agm.invoke(CommandMethod, { command: RegisterCommand, hotkey: hkToLower, description: info.description })];\r\n                    case 3:\r\n                        // invoke GD method\r\n                        _a.sent();\r\n                        this.hotkeys.set(hkToLower, info);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.unregister = function (hotkey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var hkToLower;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof hotkey === \"undefined\") {\r\n                            throw new Error(\"hotkey parameter missing\");\r\n                        }\r\n                        if (typeof hotkey !== \"string\") {\r\n                            throw new Error(\"hotkey parameter must be string\");\r\n                        }\r\n                        hkToLower = this.formatHotkey(hotkey);\r\n                        return [4 /*yield*/, this.agm.invoke(CommandMethod, { command: UnregisterCommand, hotkey: hkToLower })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.hotkeys.delete(hkToLower);\r\n                        this.registry.clearKey(hkToLower);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.unregisterAll = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.agm.invoke(CommandMethod, { command: UnregisterAllCommand })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.hotkeys.clear();\r\n                        this.registry.clear();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Whether this application has registered accelerator.\r\n     * @param hotkey\r\n     */\r\n    HotkeysImpl.prototype.isRegistered = function (hotkey) {\r\n        var hkToLower = this.formatHotkey(hotkey);\r\n        return this.hotkeys.has(hkToLower);\r\n    };\r\n    HotkeysImpl.prototype.registerInvokeAGMMethod = function () {\r\n        var _this = this;\r\n        this.agm.register(InvokeMethod, function (args) {\r\n            var hkToLower = args.key.toLowerCase();\r\n            var info = _this.hotkeys.get(hkToLower);\r\n            _this.registry.execute(hkToLower, info);\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.formatHotkey = function (hotkey) {\r\n        if (hotkey) {\r\n            return hotkey.replace(/\\s/g, \"\").toLowerCase();\r\n        }\r\n    };\r\n    return HotkeysImpl;\r\n}());\r\nexports.HotkeysImpl = HotkeysImpl;\r\n//# sourceMappingURL=hotkeys.js.map\n\n/***/ }),\n/* 63 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar hotkeys_1 = __webpack_require__(62);\r\nfunction factory(agm) {\r\n    var hotkeys = new hotkeys_1.HotkeysImpl(agm);\r\n    return {\r\n        register: hotkeys.register.bind(hotkeys),\r\n        unregister: hotkeys.unregister.bind(hotkeys),\r\n        unregisterAll: hotkeys.unregisterAll.bind(hotkeys),\r\n        isRegistered: hotkeys.isRegistered.bind(hotkeys),\r\n        ready: function () { return Promise.resolve(); }\r\n    };\r\n}\r\nexports.factory = factory;\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 64 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar SaveContextMethodName = \"T42.HC.GetSaveContext\";\r\n/**\r\n * Logic for apps that want to provide custom context on save\r\n */\r\nvar ContextProvider = /** @class */ (function () {\r\n    function ContextProvider(agm, activitiesGetter, callbacks) {\r\n        this.agm = agm;\r\n        this.activitiesGetter = activitiesGetter;\r\n        this.callbacks = callbacks;\r\n        this.registeredRequestsMethods = false;\r\n    }\r\n    ContextProvider.prototype.onSaveRequested = function (callback) {\r\n        if (!this.registeredRequestsMethods) {\r\n            this.registerRequestMethods();\r\n            this.registeredRequestsMethods = true;\r\n        }\r\n        return this.callbacks.add(\"saveRequested\", callback);\r\n    };\r\n    ContextProvider.prototype.isActivityOwner = function () {\r\n        // fallback for GD2 - remove once the bellow code is tested\r\n        if (typeof htmlContainer !== \"undefined\") {\r\n            var context = htmlContainer.getContext();\r\n            return context && context._t42 && context._t42.activityIsOwner;\r\n        }\r\n        // check if we're the activity owners\r\n        var activities = this.activitiesGetter();\r\n        if (!activities) {\r\n            return false;\r\n        }\r\n        if (!activities.inActivity) {\r\n            return false;\r\n        }\r\n        var myWindow = activities.my.window;\r\n        var myActivity = activities.my.activity;\r\n        if (!myActivity && !myWindow) {\r\n            return false;\r\n        }\r\n        // TODO - fix activities typings\r\n        return myActivity.owner.id === myWindow.id;\r\n    };\r\n    ContextProvider.prototype.registerRequestMethods = function () {\r\n        var _this = this;\r\n        this.agm.register(SaveContextMethodName, function (args) {\r\n            var requestResult = _this.callbacks.execute(\"saveRequested\", args)[0];\r\n            if (!requestResult) {\r\n                return {};\r\n            }\r\n            requestResult.activityContext = requestResult.activityContext || {};\r\n            requestResult.windowContext = requestResult.windowContext || {};\r\n            // always include the window context\r\n            var result = { windowContext: requestResult.windowContext, activityContext: undefined };\r\n            // if we're the activity owner put the context too\r\n            if (_this.isActivityOwner()) {\r\n                result.activityContext = requestResult.activityContext;\r\n            }\r\n            return result;\r\n        });\r\n    };\r\n    return ContextProvider;\r\n}());\r\nexports.default = ContextProvider;\r\n//# sourceMappingURL=contextProvider.js.map\n\n/***/ }),\n/* 65 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar store_1 = __webpack_require__(19);\r\nvar shortid_1 = __webpack_require__(28);\r\nvar contextProvider_1 = __webpack_require__(64);\r\nvar transform_1 = __webpack_require__(20);\r\nvar layout_1 = __webpack_require__(18);\r\nvar LayoutsAPIImpl = /** @class */ (function () {\r\n    function LayoutsAPIImpl(config, stream, callbacks) {\r\n        this.config = config;\r\n        this.stream = stream;\r\n        this.callbacks = callbacks;\r\n        this.appManager = config.appManager;\r\n        this.onEvent = stream.onEvent;\r\n        this.provider = new contextProvider_1.default(config.agm, config.activityGetter, callbacks);\r\n        stream.subscribe();\r\n    }\r\n    LayoutsAPIImpl.prototype.ready = function () {\r\n        if (this.config.mode === \"fullWaitSnapshot\") {\r\n            return this.stream.gotSnapshot;\r\n        }\r\n        return this.stream.ready;\r\n    };\r\n    LayoutsAPIImpl.prototype.save = function (layout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!layout.name) {\r\n                throw Error(\"layout.name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                layout.type = \"Global\";\r\n            }\r\n            if (layout.activityId) {\r\n                layout.type = \"Activity\";\r\n            }\r\n            if (typeof layout.ignoreHidden === \"undefined\") {\r\n                layout.ignoreHidden = true; // default to true\r\n            }\r\n            var layoutObject = {\r\n                name: layout.name,\r\n                actIds: [],\r\n                appIds: [],\r\n                type: layout.type,\r\n                context: layout.context,\r\n                metadata: layout.metadata || {},\r\n                options: { ignoreLayoutRestrictions: false },\r\n            };\r\n            if (layout.type === \"Activity\") {\r\n                var actId = layout.activityId;\r\n                if (!actId) {\r\n                    if (!_this.appManager.myInstance.inActivity) {\r\n                        throw new Error(\"Current application is not in activity. Can not save activity layout for it\");\r\n                    }\r\n                    actId = _this.appManager.myInstance.activityId;\r\n                }\r\n                layoutObject.actIds.push(actId);\r\n                layoutObject.options = { ignoreLayoutRestrictions: true };\r\n            }\r\n            else if (layout.type === \"Global\") {\r\n                var instances = _this.appManager.instances();\r\n                if (layout.ignoreHidden) {\r\n                    instances = instances.filter(function (i) { return _this.isVisibleWindow(i); });\r\n                }\r\n                if (layout.ignoreMyInstance && _this.appManager.myInstance) {\r\n                    instances = instances.filter(function (i) { return i.id !== _this.appManager.myInstance.id; });\r\n                }\r\n                instances.reduce(function (prev, current) {\r\n                    if (!current.id) {\r\n                        return prev;\r\n                    }\r\n                    if (current.inActivity) {\r\n                        var actId = current.activityId;\r\n                        if (prev.actIds.indexOf(actId) === -1) {\r\n                            prev.actIds.push(actId);\r\n                        }\r\n                    }\r\n                    else {\r\n                        prev.appIds.push(current.id);\r\n                    }\r\n                    return prev;\r\n                }, layoutObject);\r\n            }\r\n            else {\r\n                throw new Error(\"layout type \" + layout.type + \" not supported\");\r\n            }\r\n            _this.invokeMethodAndTrack(\"T42.ACS.SaveLayout\", layoutObject, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.restore = function (options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (typeof options === \"undefined\") {\r\n                throw Error(\"options argument is required\");\r\n            }\r\n            if (!options.name) {\r\n                throw Error(\"options.name argument is required\");\r\n            }\r\n            if (!options.type) {\r\n                options.type = \"Global\";\r\n            }\r\n            if (options.activityIdToJoin) {\r\n                options.type = \"Activity\";\r\n            }\r\n            if (typeof options.restoreActivityOwner === \"undefined\") {\r\n                options.restoreActivityOwner = false;\r\n            }\r\n            if (typeof options.ignoreActivityWindowTypes === \"undefined\") {\r\n                options.ignoreActivityWindowTypes = [];\r\n            }\r\n            if (typeof options.setActivityContext === \"undefined\") {\r\n                options.setActivityContext = true;\r\n            }\r\n            // if no closeOwnRunning we set closeRunningInstance to true; if\r\n            if (typeof options.closeRunningInstance === \"undefined\") {\r\n                if (options.type === \"Global\") {\r\n                    options.closeRunningInstance = true;\r\n                }\r\n                else if (options.type === \"Activity\") {\r\n                    // we don't close anything in case of activity layout type\r\n                    options.closeRunningInstance = false;\r\n                }\r\n            }\r\n            if (typeof options.reuseWindows === \"undefined\") {\r\n                options.reuseWindows = true;\r\n            }\r\n            options.context = options.context || {};\r\n            var t42 = {\r\n                restoreOptions: {\r\n                    activityToJoin: options.activityIdToJoin,\r\n                    setActivityContext: options.setActivityContext,\r\n                    ignoreActivityWindowTypes: options.ignoreActivityWindowTypes,\r\n                    restoreActivityOwner: options.restoreActivityOwner,\r\n                    closeOldWindows: true,\r\n                    reuseExistingWindows: options.reuseWindows\r\n                }\r\n            };\r\n            var arg = {\r\n                type: options.type,\r\n                name: options.name,\r\n                context: options.context,\r\n                toClose: [],\r\n                splash: options.splash\r\n            };\r\n            if (options.closeRunningInstance) {\r\n                arg.toClose = _this.getInstancesToClose(options);\r\n            }\r\n            if (options.timeout) {\r\n                arg.timeout = options.timeout;\r\n            }\r\n            arg.context._t42 = t42;\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RestoreLayout\", arg, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.remove = function (type, name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            var msg = {\r\n                type: type,\r\n                name: name,\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RemoveLayout\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.list = function () {\r\n        this.verifyNotSlimMode();\r\n        return store_1.default.all;\r\n    };\r\n    LayoutsAPIImpl.prototype.import = function (layouts, mode) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            var msg = {\r\n                mode: mode || \"replace\",\r\n                layouts: layouts\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ImportLayouts\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.export = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var handleResult = function (result) {\r\n                var layouts = _this.getObjectValues(result.Layouts).map(function (t) { return new layout_1.default(transform_1.default(t)); });\r\n                resolve(layouts);\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ExportLayouts\", {}, handleResult, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.rename = function (layout, newName) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!layout) {\r\n                throw Error(\"layout argument is required\");\r\n            }\r\n            if (!layout.name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            var msg = { type: layout.type, oldName: layout.name, newName: newName };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RenameLayout\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.updateMetadata = function (layout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!layout) {\r\n                throw Error(\"layout argument is required\");\r\n            }\r\n            if (!layout.name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            if (!layout.metadata) {\r\n                throw Error(\"metadata argument is required\");\r\n            }\r\n            var layoutObject = {\r\n                name: name,\r\n                type: layout.type,\r\n                metadata: layout.metadata\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.UpdateMetadata\", layoutObject, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.onAdded = function (callback) {\r\n        var result = this.callbacks.add(\"added\", callback);\r\n        if (store_1.default.all.length > 0) {\r\n            store_1.default.all.forEach(function (layout) {\r\n                try {\r\n                    callback(layout);\r\n                }\r\n                catch (err) { /** */ }\r\n            });\r\n        }\r\n        return result;\r\n    };\r\n    LayoutsAPIImpl.prototype.onRemoved = function (callback) {\r\n        return this.callbacks.add(\"removed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onChanged = function (callback) {\r\n        return this.callbacks.add(\"changed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onRenamed = function (callback) {\r\n        return this.callbacks.add(\"renamed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onEvent = function (callback) {\r\n        return this.stream.onEvent(callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onSaveRequested = function (callback) {\r\n        return this.provider.onSaveRequested(callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.filterInstance = function (ignoreHidden, ignoreMyInstance) {\r\n        var _this = this;\r\n        var instances = this.appManager.instances();\r\n        if (ignoreHidden) {\r\n            instances = instances.filter(function (i) { return _this.isVisibleWindow(i); });\r\n        }\r\n        if (ignoreMyInstance && this.appManager.myInstance) {\r\n            instances = instances.filter(function (i) { return i.id !== _this.appManager.myInstance.id; });\r\n        }\r\n        return instances.reduce(function (prev, current) {\r\n            if (!current.id) {\r\n                return prev;\r\n            }\r\n            if (current.inActivity) {\r\n                var actId = current.activityId;\r\n                if (prev.actIds.indexOf(actId) === -1) {\r\n                    prev.actIds.push(actId);\r\n                }\r\n            }\r\n            else {\r\n                prev.appIds.push(current.id);\r\n            }\r\n            return prev;\r\n        }, { actIds: [], appIds: [] });\r\n    };\r\n    LayoutsAPIImpl.prototype.verifyNotSlimMode = function () {\r\n        if (this.config.mode === \"slim\") {\r\n            throw Error(\"Operation not allowed in slim mode. Run in full mode.\");\r\n        }\r\n    };\r\n    LayoutsAPIImpl.prototype.isVisibleWindow = function (instance) {\r\n        // GD3\r\n        // allow exes to participate in layouts (TODO - check if the app is layouts aware (has the layouts methods) - if not treat it as not visible window)\r\n        if (instance.application.type === \"exe\" || instance.application.type === \"node\") {\r\n            return true;\r\n        }\r\n        // allow activities to participate in layouts\r\n        if (instance.application.type === \"activity\") {\r\n            return true;\r\n        }\r\n        if (!instance || !instance.window) {\r\n            return false;\r\n        }\r\n        return instance.window.isVisible;\r\n    };\r\n    LayoutsAPIImpl.prototype.invokeMethodAndTrack = function (methodName, args, resolve, reject, skipStreamEvent) {\r\n        var streamEventReceived = skipStreamEvent;\r\n        var agmResult;\r\n        var token = shortid_1.generate();\r\n        args.token = token;\r\n        var handleResult = function () {\r\n            if (streamEventReceived && agmResult) {\r\n                resolve(agmResult);\r\n            }\r\n        };\r\n        if (!skipStreamEvent) {\r\n            this.stream.waitFor(token)\r\n                .then(function () {\r\n                streamEventReceived = true;\r\n                handleResult();\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        }\r\n        var responseHandler = function (result) {\r\n            if (!result.returned) {\r\n                reject(\"No result from method \" + methodName);\r\n            }\r\n            if (result.returned.status && (result.returned.status !== \"Success\" && result.returned.status !== \"PartialSuccess\")) {\r\n                reject(result.returned);\r\n            }\r\n            agmResult = result.returned;\r\n            handleResult();\r\n        };\r\n        this.config.agm.invoke(methodName, args, \"best\", { methodResponseTimeoutMs: 120 * 1000 })\r\n            .then(responseHandler)\r\n            .catch(function (err) { return reject(err); });\r\n    };\r\n    LayoutsAPIImpl.prototype.getInstancesToClose = function (options) {\r\n        var _this = this;\r\n        var instances = [];\r\n        var shellApp = this.appManager.applications().filter(function (a) { return a.isShell; })[0];\r\n        var shellApplicationName = shellApp ? shellApp.name : \"AppManager\";\r\n        this.appManager.instances().forEach(function (i) {\r\n            // ignore my instance\r\n            if (_this.appManager.myInstance && i.id === _this.appManager.myInstance.id) {\r\n                return;\r\n            }\r\n            // ignore shell app\r\n            if (i.application.name === shellApplicationName) {\r\n                return;\r\n            }\r\n            // ignore hidden windows\r\n            if (!_this.isVisibleWindow(i)) {\r\n                return;\r\n            }\r\n            // if activity layout stop only the instances\r\n            // running in the same activity\r\n            if (options.type === \"Activity\") {\r\n                if (i.activityId !== options.activityIdToJoin) {\r\n                    return;\r\n                }\r\n            }\r\n            instances.push({ application: i.application.name, instance: i.id });\r\n        });\r\n        return instances;\r\n    };\r\n    LayoutsAPIImpl.prototype.getObjectValues = function (obj) {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.keys(obj).map(function (k) { return obj[k]; });\r\n    };\r\n    return LayoutsAPIImpl;\r\n}());\r\nexports.default = LayoutsAPIImpl;\r\n//# sourceMappingURL=layouts.js.map\n\n/***/ }),\n/* 66 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar layouts_1 = __webpack_require__(65);\r\nvar acsStream_1 = __webpack_require__(67);\r\nvar nullStream_1 = __webpack_require__(68);\r\nvar callback_registry_1 = __webpack_require__(0);\r\nfunction default_1(config) {\r\n    if (!config.agm) {\r\n        throw Error(\"config.agm is required\");\r\n    }\r\n    if (!config.logger) {\r\n        throw Error(\"config.logger is required\");\r\n    }\r\n    // default mode to slim\r\n    config.mode = config.mode || \"slim\";\r\n    var logger = config.logger;\r\n    var callbacks = callback_registry_1.default();\r\n    var acsStream;\r\n    if (config.mode === \"full\" || \"fullWaitSnapshot\") {\r\n        acsStream = new acsStream_1.default(config.agm, callbacks);\r\n    }\r\n    else {\r\n        acsStream = nullStream_1.default();\r\n    }\r\n    return new layouts_1.default(config, acsStream, callbacks);\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 67 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar store_1 = __webpack_require__(19);\r\nvar layout_1 = __webpack_require__(18);\r\nvar transform_1 = __webpack_require__(20);\r\n/**\r\n * ACS event stream related to layouts\r\n */\r\nvar ACSStream = /** @class */ (function () {\r\n    function ACSStream(agm, callbacks) {\r\n        var _this = this;\r\n        this.agm = agm;\r\n        this.callbacks = callbacks;\r\n        this.ready = new Promise(function (resolve, reject) {\r\n            _this.resolveReady = resolve;\r\n            _this.rejectReady = reject;\r\n        });\r\n        this.gotSnapshot = new Promise(function (resolve, reject) {\r\n            _this.resolveGotSnapshot = resolve;\r\n            _this.rejectGotSnapshot = reject;\r\n        });\r\n    }\r\n    ACSStream.prototype.subscribe = function (noRetry) {\r\n        var _this = this;\r\n        var transform = function (obj) {\r\n            return _this.getObjectValues(obj).map(function (t) { return transform_1.default(t); });\r\n        };\r\n        // if we don't have OnLayoutEvent stream  we're running pre 2.1 GD version or outside GD,\r\n        if (!this.checkForLayoutEventMethod()) {\r\n            // if no retry resolve right away\r\n            if (noRetry) {\r\n                this.resolveReady();\r\n            }\r\n            // if we should retry, schedule  one more time\r\n            setTimeout(function () {\r\n                _this.subscribe(true);\r\n            }, 500);\r\n        }\r\n        else {\r\n            this.agm.subscribe(\"T42.ACS.OnLayoutEvent\", { waitTimeoutMs: 10000 })\r\n                .then(function (subs) {\r\n                subs.onData(function (args) {\r\n                    var data = args.data;\r\n                    if (data.IsSnapshot) {\r\n                        _this.resolveGotSnapshot();\r\n                    }\r\n                    _this.addLayouts(transform(data.OnLayoutAdded));\r\n                    _this.removeLayouts(transform(data.OnLayoutRemoved));\r\n                    _this.changeLayouts(transform(data.OnLayoutChanged));\r\n                    _this.renameLayouts(transform(data.OnLayoutRenamed));\r\n                    _this.callbacks.execute(\"streamEvent\", data);\r\n                });\r\n                subs.onFailed(function (err) {\r\n                    var msg = \"can not subscribe to T42.ACS.OnLayoutEvent \" + err;\r\n                    _this.rejectReady(msg);\r\n                    _this.rejectGotSnapshot(msg);\r\n                });\r\n                _this.resolveReady();\r\n            })\r\n                .catch(function (err) {\r\n                var msg = \"Error subscribing for T42.ACS.OnLayoutEvent stream. Err: \" + err;\r\n                _this.rejectReady(msg);\r\n                _this.rejectGotSnapshot(msg);\r\n            });\r\n        }\r\n    };\r\n    ACSStream.prototype.onEvent = function (callback) {\r\n        return this.callbacks.add(\"streamEvent\", callback);\r\n    };\r\n    ACSStream.prototype.waitFor = function (token, timeout) {\r\n        var _this = this;\r\n        if (!timeout) {\r\n            timeout = 10000; // default timeout is 10 seconds\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            var done = false;\r\n            var unsubscribe = _this.onEvent(function (streamEvent) {\r\n                if (streamEvent.Token === token) {\r\n                    done = true;\r\n                    unsubscribe();\r\n                    resolve();\r\n                }\r\n            });\r\n            setTimeout(function () {\r\n                if (!done) {\r\n                    reject(\"timed out\");\r\n                }\r\n            }, timeout);\r\n        });\r\n    };\r\n    ACSStream.prototype.checkForLayoutEventMethod = function () {\r\n        try {\r\n            return this.agm\r\n                .methods()\r\n                .map(function (m) { return m.name; })\r\n                .indexOf(\"T42.ACS.OnLayoutEvent\") !== -1;\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n    ACSStream.prototype.addLayouts = function (layoutsData) {\r\n        var _this = this;\r\n        if (!layoutsData) {\r\n            return;\r\n        }\r\n        layoutsData.forEach(function (layoutData) {\r\n            var layout = new layout_1.default(layoutData);\r\n            store_1.default.add(layout);\r\n            _this.callbacks.execute(\"added\", layout);\r\n        });\r\n    };\r\n    ACSStream.prototype.removeLayouts = function (removedLayouts) {\r\n        var _this = this;\r\n        if (!removedLayouts) {\r\n            return;\r\n        }\r\n        removedLayouts.forEach(function (removedLayout) {\r\n            store_1.default.removeWhere(function (existingLayout) { return !_this.compareLayouts(existingLayout, removedLayout); });\r\n            _this.callbacks.execute(\"removed\", removedLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.changeLayouts = function (changedLayouts) {\r\n        var _this = this;\r\n        if (!changedLayouts) {\r\n            return;\r\n        }\r\n        changedLayouts.forEach(function (changedLayout) {\r\n            // removed the changed layout and push it again\r\n            store_1.default.removeWhere(function (existingLayout) { return !_this.compareLayouts(existingLayout, changedLayout); });\r\n            store_1.default.add(new layout_1.default(changedLayout));\r\n            // execute callback\r\n            _this.callbacks.execute(\"changed\", changedLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.renameLayouts = function (renamedLayouts) {\r\n        var _this = this;\r\n        if (!renamedLayouts) {\r\n            return;\r\n        }\r\n        renamedLayouts.forEach(function (renamedLayout) {\r\n            var existingLayout = store_1.default.first(function (current) { return _this.compareLayouts(current, { type: renamedLayout.type, name: renamedLayout.oldName }); });\r\n            if (!existingLayout) {\r\n                throw Error(\"received rename event for unknown layout with type \" + renamedLayout.type + \" and name \" + renamedLayout.oldName);\r\n            }\r\n            existingLayout.name = renamedLayout.newName;\r\n            _this.callbacks.execute(\"renamed\", existingLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.compareLayouts = function (layout1, layout2) {\r\n        return layout1.name === layout2.name && layout1.type === layout2.type;\r\n    };\r\n    ACSStream.prototype.getObjectValues = function (obj) {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.keys(obj).map(function (k) { return obj[k]; });\r\n    };\r\n    return ACSStream;\r\n}());\r\nexports.default = ACSStream;\r\n//# sourceMappingURL=acsStream.js.map\n\n/***/ }),\n/* 68 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction default_1() {\r\n    return {\r\n        ready: Promise.resolve(undefined),\r\n        subscribe: function () { },\r\n        onEvent: function (callback) { return function () { }; },\r\n        waitFor: function (token, timeout) { return Promise.resolve(undefined); },\r\n        gotSnapshot: Promise.resolve(undefined),\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=nullStream.js.map\n\n/***/ }),\n/* 69 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar glue_1 = __webpack_require__(23);\r\nif (typeof window !== \"undefined\") {\r\n    window.Glue = glue_1.default;\r\n}\r\n// add default library for ES6 modules\r\nglue_1.default.default = glue_1.default;\r\nmodule.exports = glue_1.default;\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 70 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Utils = /** @class */ (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return -1;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? -1 : ver;\r\n    };\r\n    Utils.isNode = function () {\r\n        // Only Node.JS has a process variable that is of [[Class]] process\r\n        try {\r\n            return Object.prototype.toString.call(global.process) === \"[object process]\";\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n    return Utils;\r\n}());\r\nexports.default = Utils;\r\n//# sourceMappingURL=utils.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(38)))\n\n/***/ }),\n/* 71 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gd_1 = __webpack_require__(73);\r\nvar hc_1 = __webpack_require__(75);\r\nexports.default = (function (agm, logger, appManagerGetter, gdMajorVersion) {\r\n    var _logger = logger;\r\n    return new Promise(function (resolve, reject) {\r\n        if (gdMajorVersion === 2) {\r\n            // We are running in HC\r\n            _logger.trace(\"running in HC\");\r\n            hc_1.default(agm, _logger, appManagerGetter, window.htmlContainer.containerName, window.htmlContainer.windowId)\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n        else if (gdMajorVersion >= 3) {\r\n            // We are running in GD 3\r\n            // TODO expose instance in glu42gd\r\n            _logger.trace(\"running in GD\");\r\n            var gd = new gd_1.default(agm, _logger, appManagerGetter, undefined, window.glue42gd.windowId);\r\n            gd.init()\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n        else {\r\n            // We are running in Browser or Node, we should check which stream is available\r\n            // But we need to pass the container as dependency\r\n            var hcPromise = hc_1.default(agm, _logger, appManagerGetter);\r\n            var gdPromise = new gd_1.default(agm, _logger, appManagerGetter).init();\r\n            var wait = function (ms) { return new Promise(function (res, rej) { return setTimeout(function () { rej(\"timeout waiting for streams\"); }, ms); }); };\r\n            Promise.race([hcPromise, gdPromise, wait(10000)])\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n    });\r\n});\r\n//# sourceMappingURL=detector.js.map\n\n/***/ }),\n/* 72 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar objectAssign = __webpack_require__(26);\r\nvar GDExecutor = /** @class */ (function () {\r\n    function GDExecutor() {\r\n    }\r\n    Object.defineProperty(GDExecutor.prototype, \"hostInstance\", {\r\n        get: function () {\r\n            return this.agmTarget;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GDExecutor.prototype.init = function (agm, instance) {\r\n        this.agm = agm;\r\n        this.agmTarget = instance;\r\n    };\r\n    GDExecutor.prototype.close = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"close\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.navigate = function (resultWindow, newUrl) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"navigate\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    url: newUrl\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setStyle = function (resultWindow, style) {\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            Promise.resolve();\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTitle = function (resultWindow, newTitle) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var options = {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    title: newTitle\r\n                }\r\n            };\r\n            _this.execute(\"setTitle\", options)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n            Promise.resolve();\r\n        });\r\n    };\r\n    GDExecutor.prototype.moveResize = function (resultWindow, dimensions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"moveResize\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    bounds: dimensions\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.addFrameButton = function (resultWindow, buttonInfo) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"addButton\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonInfo\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.removeFrameButton = function (resultWindow, buttonId) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"removeButton\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonId\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.activate = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"activate\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.focus = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"focus\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.maximizeRestore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            _this.execute(\"maximizeRestore\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.maximize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"maximize\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.restore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"restore\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.minimize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"minimize\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.collapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"collapse\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.expand = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"expand\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.toggleCollapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"toggleCollapse\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.snap = function (resultWindow, target, direction) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId = resultWindow.id;\r\n            var targetWindowId;\r\n            var errorMessage = \"Invalid target parameter - should be an object with property id or a string. Invoked for source window id:\" +\r\n                resultWindow.id;\r\n            if (!target) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof target === \"string\") {\r\n                targetWindowId = target;\r\n            }\r\n            else if (typeof target.id !== \"undefined\") {\r\n                targetWindowId = target.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var args = {\r\n                targetWindowId: targetWindowId\r\n            };\r\n            if (direction) {\r\n                args.snappingEdge = direction;\r\n            }\r\n            _this.execute(\"snap\", {\r\n                windowId: resultWindow.id,\r\n                options: args\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.attachTab = function (resultWindow, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"attachTab\", {\r\n                windowId: resultWindow.id,\r\n                options: options\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.detachTab = function (resultWindow, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            _this.execute(\"detachTab\", {\r\n                windowId: resultWindow.id,\r\n                options: options\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setVisible = function (resultWindow, toBeVisible) {\r\n        var _this = this;\r\n        if (toBeVisible === void 0) { toBeVisible = true; }\r\n        return new Promise(function (resolve, reject) {\r\n            var command;\r\n            if (toBeVisible) {\r\n                command = \"show\";\r\n            }\r\n            else {\r\n                command = \"hide\";\r\n            }\r\n            _this.execute(command, { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showLoader = function (resultWindow, loader) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"showLoadingAnimation\", { windowId: resultWindow.id, options: loader })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.hideLoader = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"hideLoadingAnimation\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.updateContext = function (resultWindow, context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"updateContext\", {\r\n                windowId: resultWindow.id,\r\n                context: context,\r\n                replace: Object.keys(resultWindow.context).length > 0 ? false : true\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.lock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"lockUnlock\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    isLocked: true\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.unlock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"lockUnlock\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    isLocked: false\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.getIcon = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"getIcon\", {\r\n                windowId: resultWindow.id,\r\n                options: {}\r\n            })\r\n                .then(function (result) {\r\n                resolve(result.icon);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setIcon = function (resultWindow, base64Image) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setIcon\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    dataURL: base64Image\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setFrameColor = function (resultWindow, frameColor) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            _this.execute(\"setFrameColor\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    frameColor: frameColor\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTabHeaderVisible = function (resultWindow, toBeTabHeaderVisible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            _this.execute(\"setTabHeaderVisible\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    toShow: toBeTabHeaderVisible\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.execute = function (command, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var args = {};\r\n            objectAssign(args, options);\r\n            args.command = command;\r\n            _this.agm\r\n                .invoke(\"T42.Wnd.Execute\", args, _this.agmTarget)\r\n                .then(function (i) {\r\n                if (i.returned && i.returned.errorMsg) {\r\n                    reject(i);\r\n                }\r\n                else {\r\n                    resolve(i.returned);\r\n                }\r\n            })\r\n                .catch(function (i) {\r\n                reject(i);\r\n            });\r\n        });\r\n    };\r\n    /** Groups */\r\n    GDExecutor.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this.execute(\"setGroupHeaderVisibility\", {\r\n            windowId: windowId,\r\n            options: {\r\n                toShow: toShow\r\n            }\r\n        });\r\n    };\r\n    return GDExecutor;\r\n}());\r\nexports.GDExecutor = GDExecutor;\r\nexports.default = new GDExecutor();\r\n//# sourceMappingURL=executor.js.map\n\n/***/ }),\n/* 73 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = __webpack_require__(0);\r\nvar store_1 = __webpack_require__(3);\r\nvar window_1 = __webpack_require__(22);\r\nvar executor_1 = __webpack_require__(72);\r\nvar helpers_1 = __webpack_require__(21);\r\nvar GDEnvironment = /** @class */ (function () {\r\n    function GDEnvironment(agm, logger, appManagerGetter, instance, wndId) {\r\n        this._registry = CallbackFactory();\r\n        this._waitTimeout = 10000;\r\n        this._agm = agm;\r\n        this._logger = logger.subLogger(\"gd-env\");\r\n        this._agmInstance = this.normalizeInstance(instance);\r\n        this._windowId = wndId;\r\n        this._appManagerGetter = appManagerGetter;\r\n    }\r\n    GDEnvironment.prototype.init = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // if we don't have an Instance, thats means that we are running outside from any Tick42 Containers\r\n            // so our target is best\r\n            if (typeof _this._agmInstance === \"undefined\") {\r\n                _this._agmInstance = \"best\";\r\n            }\r\n            var streamPromise = new Promise(function (streamResolve, streamReject) {\r\n                _this._agm.subscribe(\"T42.Wnd.OnEvent\", {\r\n                    waitTimeoutMs: _this._waitTimeout,\r\n                    target: _this._agmInstance,\r\n                })\r\n                    .then(function (stream) {\r\n                    stream.onData(function (streamData) {\r\n                        _this.updateWindow(streamData.data);\r\n                    });\r\n                    stream.onFailed(function (err) {\r\n                        reject(err);\r\n                    });\r\n                    _this._agmInstance = _this.normalizeInstance(stream.serverInstance);\r\n                    // Init the executor\r\n                    executor_1.default.init(_this._agm, _this._agmInstance);\r\n                    resolve(_this);\r\n                })\r\n                    .catch(function (err) {\r\n                    reject(\"Can not subscribe for stream T42.Wnd.OnEvent. Err: \" + err);\r\n                });\r\n            });\r\n        });\r\n    };\r\n    Object.defineProperty(GDEnvironment.prototype, \"executor\", {\r\n        get: function () {\r\n            return executor_1.default;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GDEnvironment.prototype.open = function (name, url, options, success, error) {\r\n        options = options || {};\r\n        var copyOptions = Object.assign({}, options);\r\n        // relativeTo fix\r\n        if (typeof name === \"undefined\") {\r\n            if (error) {\r\n                error({ message: \"The name is undefined\" });\r\n            }\r\n            return;\r\n        }\r\n        if (typeof copyOptions.relativeTo !== \"undefined\" && typeof copyOptions.relativeTo !== \"string\") {\r\n            copyOptions.relativeTo = copyOptions.relativeTo.id || \"\";\r\n        }\r\n        copyOptions.name = name;\r\n        copyOptions.url = url;\r\n        // This is for compatability between gd2 and gd3\r\n        copyOptions.windowState = options.windowState || options.state;\r\n        // Otherwise glue desktop throws an error for extra properties\r\n        delete copyOptions.state;\r\n        this._agm.invoke(\"T42.Wnd.Create\", copyOptions, this._agmInstance)\r\n            .then(function (message) {\r\n            if (message.returned !== undefined) {\r\n                var id = message.returned.id;\r\n                success(id);\r\n            }\r\n            else {\r\n                error({ message: \"failed to execute T42.Wnd.Create - unknown reason\" });\r\n            }\r\n        }).catch(function (e) {\r\n            if (typeof error === \"function\") {\r\n                error(e);\r\n            }\r\n        });\r\n    };\r\n    GDEnvironment.prototype.tabAttached = function (callback) {\r\n        return this._registry.add(\"tab-attached\", callback);\r\n    };\r\n    GDEnvironment.prototype.tabDetached = function (callback) {\r\n        return this._registry.add(\"tab-detached\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowFrameColorChanged = function (callback) {\r\n        return this._registry.add(\"frame-color-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onEvent = function (callback) {\r\n        return this._registry.add(\"window-event\", callback);\r\n    };\r\n    GDEnvironment.prototype.my = function () {\r\n        return this._windowId;\r\n    };\r\n    GDEnvironment.prototype.execute = function (command, options) {\r\n        return this._agm.invoke(\"T42.Wnd.Execute\", {\r\n            command: command,\r\n            options: options,\r\n        });\r\n    };\r\n    /** Groups */\r\n    GDEnvironment.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this._agm.invoke(\"T42.Wnd.SetGroupHeaderVisible\", {\r\n            windowId: windowId,\r\n            toShow: toShow,\r\n        }, this._agmInstance);\r\n    };\r\n    GDEnvironment.prototype.onCompositionChanged = function (callback) {\r\n        return this._registry.add(\"composition-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onGroupHeaderVisibilityChanged = function (callback) {\r\n        return this._registry.add(\"group-header-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowGotFocus = function (callback) {\r\n        return this._registry.add(\"got-focus\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowLostFocus = function (callback) {\r\n        return this._registry.add(\"lost-focus\", callback);\r\n    };\r\n    GDEnvironment.prototype.normalizeInstance = function (instance) {\r\n        if (!instance) {\r\n            return undefined;\r\n        }\r\n        return {\r\n            application: instance.application,\r\n            machine: instance.machine,\r\n            user: instance.user,\r\n        };\r\n    };\r\n    GDEnvironment.prototype.updateWindow = function (windowInfo) {\r\n        var _this = this;\r\n        var extendedStreamEvent = this.getExtendedStreamEvent(windowInfo);\r\n        // this is the snapshot of all windows\r\n        if (windowInfo.type === \"Snapshot\") {\r\n            var windowInfoFullInfoEvent = windowInfo;\r\n            windowInfoFullInfoEvent.windows.forEach(function (w) {\r\n                var win = _this.createWindow(w.id, w);\r\n                store_1.default.markReadyToShow(win.API.id);\r\n                _this._registry.execute(\"window-event\", extendedStreamEvent);\r\n            });\r\n            return;\r\n        }\r\n        // if new window handle it separately\r\n        if (windowInfo.type === \"Created\") {\r\n            var windowInfoCreatedEvent = windowInfo;\r\n            var win = this.createWindow(windowInfoCreatedEvent.windowId, windowInfoCreatedEvent.data || {});\r\n            store_1.default.setReadyState(win.API.id);\r\n            this._registry.execute(\"window-event\", extendedStreamEvent);\r\n            return;\r\n        }\r\n        // otherwise check if the window is in our internal collections and update its state\r\n        var windowObjectAndEvents = store_1.default.get(windowInfo.windowId);\r\n        if (!windowObjectAndEvents) {\r\n            this._logger.error(\"received update for unknown window. Stream:', \" + JSON.stringify(windowInfo, null, 4));\r\n            return;\r\n        }\r\n        var theWindow = windowObjectAndEvents.API;\r\n        var theWindowEvents = windowObjectAndEvents.Events;\r\n        // handle bounds changed\r\n        if (windowInfo.type === \"BoundsChanged\") {\r\n            var windowInfoBoundsChangedEvent = windowInfo;\r\n            theWindowEvents.handleBoundsChanged(windowInfoBoundsChangedEvent.data);\r\n        }\r\n        // handle url changed\r\n        if (windowInfo.type === \"UrlChanged\") {\r\n            var windowInfoUrlChangedEvent = windowInfo;\r\n            store_1.default.setUrlChangedState(windowInfoUrlChangedEvent.windowId);\r\n            theWindowEvents.handleUrlChanged(windowInfoUrlChangedEvent.data);\r\n        }\r\n        // handle title changed\r\n        if (windowInfo.type === \"TitleChanged\") {\r\n            var windowInfoTitleChanged = windowInfo;\r\n            theWindowEvents.handleTitleChanged(windowInfoTitleChanged.data);\r\n        }\r\n        // handle visibility changed\r\n        if (windowInfo.type === \"VisibilityChanged\") {\r\n            theWindowEvents.handleVisibilityChanged(windowInfo.data);\r\n        }\r\n        // handle context changed\r\n        if (windowInfo.type === \"ContextChanged\") {\r\n            theWindowEvents.handleContextUpdated(windowInfo.data);\r\n        }\r\n        // handle window state changed\r\n        if (windowInfo.type === \"StateChanged\") {\r\n            theWindowEvents.handleWindowChangeState(windowInfo.data);\r\n        }\r\n        // handle frame color changed\r\n        if (windowInfo.type === \"FrameColorChanged\") {\r\n            theWindowEvents.handleFrameColorChanged(windowInfo.data);\r\n            this._registry.execute(\"frame-color-changed\", theWindow);\r\n        }\r\n        // handle composition changed - groups API\r\n        if (windowInfo.type === \"CompositionChanged\") {\r\n            var windowInfoCompositionChanged = windowInfo;\r\n            theWindowEvents.handleCompositionChanged(windowInfoCompositionChanged.data.neighbors, windowInfoCompositionChanged.data.groupId);\r\n            this._registry.execute(\"composition-changed\", windowInfoCompositionChanged.data);\r\n        }\r\n        if (windowInfo.type === \"GroupHeaderVisibilityChanged\") {\r\n            var info = windowInfo;\r\n            theWindowEvents.handleGroupHeaderVisibilityChanged(info.data.groupHeaderVisible);\r\n            this._registry.execute(\"group-header-changed\", info.data);\r\n        }\r\n        // handle focus changed\r\n        if (windowInfo.type === \"FocusChanged\") {\r\n            var windowInfoFocusChanged = windowInfo;\r\n            this.focusChanged(theWindowEvents, theWindow, windowInfoFocusChanged.data);\r\n        }\r\n        if (windowInfo.type === \"WindowFrameChanged\") {\r\n            theWindowEvents.handleFrameAttached(windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n            this._registry.execute(\"frame-changed\");\r\n        }\r\n        if (windowInfo.type === \"WindowFrameAdded\") {\r\n            theWindowEvents.handleAttached(windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n            var winsToBeNotified_1 = helpers_1.getWindowsByTabGroupId(theWindow.id, windowInfo.data.frameId);\r\n            // Getting all windows, except current, with same tabGroupId\r\n            Object.keys(winsToBeNotified_1).forEach(function (id) {\r\n                var win = winsToBeNotified_1[id];\r\n                // Executing event windowAttached to all windows\r\n                win.Events.handleWindowAttached(theWindow);\r\n            });\r\n            this._registry.execute(\"tab-attached\", theWindow, windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n        }\r\n        if (windowInfo.type === \"WindowFrameRemoved\") {\r\n            // In the event, tabGroupId is empty, will be update on the next event FrameAttached\r\n            var oldTabGroupId = theWindow.tabGroupId;\r\n            theWindowEvents.handleDetached(windowInfo.data.frameId);\r\n            var winsToBeNotified_2 = helpers_1.getWindowsByTabGroupId(theWindow.id, oldTabGroupId);\r\n            Object.keys(winsToBeNotified_2).forEach(function (id) {\r\n                var win = winsToBeNotified_2[id];\r\n                win.Events.handleWindowDetached(theWindow);\r\n            });\r\n            var un_1 = this._registry.add(\"frame-changed\", function () {\r\n                un_1();\r\n                _this._registry.execute(\"tab-detached\", theWindow, windowInfo.data.frameId, theWindow.tabGroupId);\r\n            });\r\n        }\r\n        if (windowInfo.type === \"TabHeaderVisibilityChanged\") {\r\n            theWindowEvents.handleTabHeaderVisibilityChanged(windowInfo.data.isTabHeaderVisible);\r\n        }\r\n        if (windowInfo.type === \"FrameSelectionChanged\") {\r\n            theWindowEvents.handleFrameSelectionChanged(windowInfo.data.newWindowId, windowInfo.data.prevWindowId);\r\n        }\r\n        if (windowInfo.type === \"ButtonClicked\") {\r\n            theWindowEvents.handleFrameButtonClicked(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ButtonAdded\") {\r\n            theWindowEvents.handleFrameButtonAdded(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ButtonRemoved\") {\r\n            theWindowEvents.handleFrameButtonRemoved(windowInfo.data);\r\n        }\r\n        // Clear the window on close event\r\n        if (windowInfo.type === \"Closed\") {\r\n            store_1.default.remove(windowObjectAndEvents);\r\n            theWindowEvents.handleWindowClose();\r\n        }\r\n        // expose to external listeners\r\n        this._registry.execute(\"window-event\", extendedStreamEvent);\r\n    };\r\n    GDEnvironment.prototype.createWindow = function (windowId, options) {\r\n        var windowObjAndEvents = window_1.default(windowId, this.mapToWindowConstructorOptions(options), executor_1.default, this._logger, this._appManagerGetter);\r\n        store_1.default.add(windowObjAndEvents);\r\n        return windowObjAndEvents;\r\n    };\r\n    GDEnvironment.prototype.focusChanged = function (theWindowEvents, theWindow, focus) {\r\n        theWindowEvents.handleFocusChanged(focus);\r\n        if (focus) {\r\n            this._registry.execute(\"got-focus\", theWindow);\r\n        }\r\n        else {\r\n            this._registry.execute(\"lost-focus\", theWindow);\r\n        }\r\n    };\r\n    GDEnvironment.prototype.mapToWindowConstructorOptions = function (args) {\r\n        // TODO\r\n        return {\r\n            name: args.name,\r\n            context: args.context,\r\n            bounds: args.bounds,\r\n            url: args.url,\r\n            title: args.title,\r\n            isVisible: args.isVisible,\r\n            focus: args.isFocused,\r\n            state: args.state,\r\n            frameColor: args.frameColor,\r\n            groupId: args.groupId,\r\n            neighbours: args.neighbors,\r\n            isFocused: args.isFocused,\r\n            isGroupHeaderVisible: args.groupHeaderVisible,\r\n            isCollapsed: args.isCollapsed,\r\n            tabGroupId: args.frameId,\r\n            mode: args.mode,\r\n            isTabHeaderVisible: args.isTabHeaderVisible,\r\n            isTabSelected: args.isActiveTab,\r\n            settings: args.settings,\r\n            windowType: args.windowType,\r\n        };\r\n    };\r\n    GDEnvironment.prototype.getExtendedStreamEvent = function (streamEvent) {\r\n        try {\r\n            var result = __assign({ state: streamEvent.type, windowName: store_1.default.get(streamEvent.windowId).API.name }, streamEvent);\r\n            if (result.state === \"WindowFrameAdded\") {\r\n                result.state = \"TabAttached\";\r\n            }\r\n            if (result.state === \"StateChanged\") {\r\n                result.state = result.data.charAt(0).toUpperCase() + result.data.slice(1);\r\n            }\r\n            if (result.state === \"ButtonAdded\") {\r\n                result.state = \"FrameButtonAdded\";\r\n            }\r\n            if (result.state === \"ButtonRemoved\") {\r\n                result.state = \"FrameButtonRemoved\";\r\n            }\r\n            return result;\r\n        }\r\n        catch (error) {\r\n            return streamEvent;\r\n        }\r\n    };\r\n    return GDEnvironment;\r\n}());\r\nexports.default = GDEnvironment;\r\n//# sourceMappingURL=gd.js.map\n\n/***/ }),\n/* 74 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar HcExecutor = /** @class */ (function () {\r\n    function HcExecutor() {\r\n    }\r\n    Object.defineProperty(HcExecutor.prototype, \"hostInstance\", {\r\n        get: function () {\r\n            return this.agmTarget;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    HcExecutor.prototype.init = function (agm, instance) {\r\n        this.agm = agm;\r\n        this.agmTarget = instance;\r\n    };\r\n    HcExecutor.prototype.close = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.url === undefined;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Close\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onClose);\r\n        });\r\n    };\r\n    HcExecutor.prototype.navigate = function (resultWindow, newUrl) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.url === newUrl;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Html.OpenUrl\", successHandler, errorHandler, { url: newUrl }, conditionFunc, resultWindow.onUrlChanged, true);\r\n        });\r\n    };\r\n    HcExecutor.prototype.setStyle = function (resultWindow, style) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetWindowStyle\", successHandler, errorHandler, { windowStyleAttributes: JSON.stringify(style) });\r\n        });\r\n    };\r\n    HcExecutor.prototype.setTitle = function (resultWindow, newTitle) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.title === newTitle;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetWindowTitle\", successHandler, errorHandler, { title: newTitle }, conditionFunc, resultWindow.onTitleChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.moveResize = function (resultWindow, dimensions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                var b = resultWindow.bounds;\r\n                var isSame = true;\r\n                Object.keys(dimensions).forEach(function (key) {\r\n                    if (dimensions[key] !== b[key]) {\r\n                        isSame = false;\r\n                        return;\r\n                    }\r\n                });\r\n                return isSame;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.ResizeAndMove\", successHandler, errorHandler, dimensions, conditionFunc, resultWindow.onBoundsChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.addFrameButton = function (resultWindow, buttonInfo) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.AddFrameButton\", successHandler, errorHandler, { buttonInfo: buttonInfo }, conditionFunc, resultWindow.onFrameButtonAdded);\r\n        });\r\n    };\r\n    HcExecutor.prototype.removeFrameButton = function (resultWindow, buttonId) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.RemoveFrameButton\", successHandler, errorHandler, { buttonId: buttonId }, conditionFunc, resultWindow.onFrameButtonRemoved);\r\n        });\r\n    };\r\n    HcExecutor.prototype.activate = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.isFocused;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Activate\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onFocusChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.focus = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.isFocused;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Activate\", successHandler, errorHandler, { focus: true }, conditionFunc, resultWindow.onFocusChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.maximizeRestore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var eventToSubscribe = resultWindow.state !== \"maximized\" ? resultWindow.onNormal : resultWindow.onMaximized;\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.MaximizeOrRestoreDown\", successHandler, errorHandler, {}, conditionFunc, eventToSubscribe);\r\n        });\r\n    };\r\n    HcExecutor.prototype.maximize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.state === \"maximized\";\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Maximize\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onMaximized);\r\n        });\r\n    };\r\n    HcExecutor.prototype.restore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.state === \"normal\";\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Restore\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onNormal);\r\n        });\r\n    };\r\n    HcExecutor.prototype.minimize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.state === \"minimized\";\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Minimize\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onMinimized);\r\n        });\r\n    };\r\n    HcExecutor.prototype.collapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.isCollapsed;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetCollapsed\", successHandler, errorHandler, { collapsed: true }, conditionFunc, resultWindow.onCollapsed);\r\n        });\r\n    };\r\n    HcExecutor.prototype.expand = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return !resultWindow.isCollapsed;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetCollapsed\", successHandler, errorHandler, { collapsed: false }, conditionFunc, resultWindow.onExpanded);\r\n        });\r\n    };\r\n    HcExecutor.prototype.toggleCollapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            var subscribeFunc = resultWindow.isCollapsed ? resultWindow.onExpanded : resultWindow.onCollapsed;\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetCollapsed\", successHandler, errorHandler, { title: \"\" }, conditionFunc, subscribeFunc);\r\n        });\r\n    };\r\n    HcExecutor.prototype.snap = function (resultWindow, target, direction) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId = resultWindow.id;\r\n            var targetWindowId;\r\n            var errorMessage = \"Invalid target parameter - should be an object with property id or a string. Invoked for source window id:\" + resultWindow.id;\r\n            if (!target) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof target === \"string\") {\r\n                targetWindowId = target;\r\n            }\r\n            else if (typeof target.id !== \"undefined\") {\r\n                targetWindowId = target.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var args = {\r\n                sourceWindowId: sourceWindowId,\r\n                targetWindowId: targetWindowId,\r\n            };\r\n            if (direction) {\r\n                args.snappingEdge = direction;\r\n            }\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Snap\", successHandler, errorHandler, args);\r\n        });\r\n    };\r\n    HcExecutor.prototype.attachTab = function (resultWindow, args) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.AttachTab\", successHandler, errorHandler, args);\r\n        });\r\n    };\r\n    HcExecutor.prototype.detachTab = function (resultWindow, args) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var _options = args || {};\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.DettachTab\", successHandler, errorHandler, args);\r\n        });\r\n    };\r\n    HcExecutor.prototype.setVisible = function (resultWindow, toBeVisible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof toBeVisible === \"undefined\") {\r\n                toBeVisible = true;\r\n            }\r\n            var conditionFunc = function () {\r\n                return resultWindow.isVisible === toBeVisible;\r\n            };\r\n            var styles = { Hidden: !toBeVisible };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetWindowStyle\", successHandler, errorHandler, { windowStyleAttributes: JSON.stringify(styles) }, conditionFunc, resultWindow.onVisibilityChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.showLoader = function (resultWindow, loader) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var opt = loader || {};\r\n            opt.enabled = true;\r\n            opt.timeout = opt.timeout || -1; // by default show the loader forever\r\n            var argsForSend = { loader: opt };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.UpdateLoader\", successHandler, errorHandler, argsForSend);\r\n        });\r\n    };\r\n    HcExecutor.prototype.hideLoader = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.UpdateLoader\", successHandler, errorHandler, { loader: { enabled: false } });\r\n        });\r\n    };\r\n    HcExecutor.prototype.updateContext = function (resultWindow, context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!context) {\r\n                reject(\"Invalid context parameter - should be an object. Invoked for source window id:\" + resultWindow.id);\r\n                return;\r\n            }\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.UpdateContext\", successHandler, errorHandler, { context: context }, conditionFunc, resultWindow.onContextUpdated);\r\n        });\r\n    };\r\n    HcExecutor.prototype.lock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Lock\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onLockingChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.unlock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Unlock\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onLockingChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.getIcon = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // TODO check it in HC\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.GetIcon\", successHandler, errorHandler);\r\n        });\r\n    };\r\n    HcExecutor.prototype.setIcon = function (resultWindow, base64Image) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!base64Image) {\r\n                reject(\"Invalid base64Image parameter. Invoked for source window id:\" + resultWindow.id);\r\n                return;\r\n            }\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetIcon\", successHandler, errorHandler, { base64ImageSource: base64Image });\r\n        });\r\n    };\r\n    HcExecutor.prototype.setFrameColor = function (resultWindow, frameColor) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!frameColor) {\r\n                reject(\"Invalid frameColor parameter. Invoked for source window id:\" + resultWindow.id);\r\n                return;\r\n            }\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetWindowStyle\", successHandler, errorHandler, { windowStyleAttributes: JSON.stringify({ stickyFrameColor: frameColor }) }, conditionFunc, resultWindow.onFrameColorChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.setTabHeaderVisible = function (resultWindow, toBeTabHeaderVisible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof toBeTabHeaderVisible === \"undefined\") {\r\n                toBeTabHeaderVisible = true;\r\n            }\r\n            var conditionFunc = function () {\r\n                return resultWindow.isTabHeaderVisible === toBeTabHeaderVisible;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetTabHeaderVisible\", successHandler, errorHandler, { toShow: toBeTabHeaderVisible }, conditionFunc, resultWindow.onTabHeaderVisibilityChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.execute = function (command, options) {\r\n        return this.agm.invoke(\"T42.Wnd.Execute\", {\r\n            command: command,\r\n            options: options,\r\n        });\r\n    };\r\n    /** Groups */\r\n    HcExecutor.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this.agm.invoke(\"T42.Wnd.SetGroupHeaderVisible\", {\r\n            windowId: windowId,\r\n            toShow: toShow,\r\n        }, this.agmTarget);\r\n    };\r\n    HcExecutor.prototype.agmAction = function (resultWindow, action, success, error, args, conditionFunc, subscribeFunc, ignoreTimeout) {\r\n        // Stop if the window is closed\r\n        ignoreTimeout = ignoreTimeout || false;\r\n        if (resultWindow.url === undefined) {\r\n            if (typeof error === \"function\") {\r\n                error(\"Cannot execute a command on a closed window.\");\r\n            }\r\n            return;\r\n        }\r\n        if (typeof conditionFunc === \"undefined\" || conditionFunc()) {\r\n            this.agmInvoke(resultWindow, action, args, success, error);\r\n        }\r\n        else {\r\n            var removeCallback_1 = function () {\r\n                return;\r\n            };\r\n            var isResolved_1 = false;\r\n            var successHandler = function () {\r\n                isResolved_1 = true;\r\n                removeCallback_1();\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n            };\r\n            removeCallback_1 = subscribeFunc(successHandler);\r\n            if (!ignoreTimeout) {\r\n                setTimeout(function () {\r\n                    if (!isResolved_1) {\r\n                        if (typeof error === \"function\") {\r\n                            error(\"Agm invoke timeout! action: \" + action);\r\n                        }\r\n                    }\r\n                }, 2000);\r\n            }\r\n            this.agmInvoke(resultWindow, action, args, function () {\r\n                return;\r\n            }, error);\r\n        }\r\n    };\r\n    HcExecutor.prototype.agmInvoke = function (resultWindow, action, args, success, error) {\r\n        // Add the window ID to the arguments\r\n        args = args || {};\r\n        args.windowId = resultWindow.id;\r\n        // Invoke the AGM method\r\n        this.agm.invoke(action, args, this.agmTarget, {}, successHandler, errorHandler);\r\n        function successHandler() {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n        }\r\n        function errorHandler(err) {\r\n            if (typeof error === \"function\") {\r\n                if (err.all_return_values && err.all_return_values.length > 0) {\r\n                    error(err.all_return_values[0].message);\r\n                }\r\n                else {\r\n                    error(err);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return HcExecutor;\r\n}());\r\nexports.HcExecutor = HcExecutor;\r\nexports.default = new HcExecutor();\r\n//# sourceMappingURL=executor.js.map\n\n/***/ }),\n/* 75 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = __webpack_require__(0);\r\nvar store_1 = __webpack_require__(3);\r\nvar window_1 = __webpack_require__(22);\r\nvar executor_1 = __webpack_require__(74);\r\nvar helpers_1 = __webpack_require__(21);\r\nexports.default = (function (agm, logger, appManagerGetter, cntName, wndId) {\r\n    return new Promise(function (resolve, reject) {\r\n        var _registry = CallbackFactory();\r\n        var _logger = logger.subLogger(\"hc-env\");\r\n        var waitTimeout = 10000;\r\n        var _windowId = wndId;\r\n        var hcEnv;\r\n        var instance;\r\n        // We have two cases here:\r\n        // 1. when we are in HC\r\n        // 2. when we are in Browser/Node, but we have also started  HC/GD\r\n        if (typeof cntName !== \"undefined\") {\r\n            instance = { application: \"HtmlContainer.\" + cntName };\r\n        }\r\n        else {\r\n            instance = \"best\";\r\n        }\r\n        var streamPromise = new Promise(function (streamResolve, streamReject) {\r\n            agm.subscribe(\"T42.Wnd.WindowStateChanged\", {\r\n                waitTimeoutMs: waitTimeout,\r\n                target: instance,\r\n            })\r\n                .then(function (stream) {\r\n                stream.onData(function (streamData) {\r\n                    instance = streamData.server;\r\n                    updateWindow(streamData.data.state, streamData.data);\r\n                });\r\n                stream.onFailed(function (err) {\r\n                    streamReject(err);\r\n                });\r\n                streamResolve();\r\n            })\r\n                .catch(function (err) {\r\n                streamReject(\"Can not subscribe for stream T42.Wnd.WindowStateChanged. Err: \" + err);\r\n            });\r\n        });\r\n        var listWindowsPromise = new Promise(function (listWndResolve, listWndReject) {\r\n            agm.invoke(\"T42.Wnd.ListWindows\", {}, instance, { waitTimeoutMs: waitTimeout })\r\n                .then(function (result) {\r\n                // add the server object\r\n                instance = result.executed_by;\r\n                // populate windows\r\n                Object.keys(result.returned).forEach(function (existingWindow) {\r\n                    var windowInfo = result.returned[existingWindow];\r\n                    var windowObjAndEvents = createWindow(windowInfo.windowId, windowInfo);\r\n                    // Added to store, showing to world\r\n                    store_1.default.markReadyToShow(windowObjAndEvents.API.id);\r\n                });\r\n                listWndResolve();\r\n            })\r\n                .catch(function (e) {\r\n                listWndReject(\"Can not invoke T42.Wnd.ListWindows method. Err: \" + e);\r\n            });\r\n        });\r\n        Promise.all([streamPromise, listWindowsPromise])\r\n            .then(function () {\r\n            // Init the executor, if we have container name - use it, if not get the first one from the collection\r\n            executor_1.default.init(agm, instance);\r\n            resolve(hcEnv);\r\n        })\r\n            .catch(function (e) {\r\n            reject(\"can not subscribe for stream T42.Wnd.WindowStateChanged or can not invoke T42.Wnd.ListWindows \");\r\n        });\r\n        function updateWindow(eventType, windowInfo) {\r\n            // if new window handle it separately\r\n            if (eventType === \"Created\") {\r\n                var win = createWindow(windowInfo.windowId, windowInfo);\r\n                _registry.execute(\"window-event\", windowInfo);\r\n                // if the window has focus, trigger got focus event\r\n                if (windowInfo.focus) {\r\n                    focusChanged(win.Events, win.API, true);\r\n                }\r\n                return;\r\n            }\r\n            // otherwise check if the window is in our internal collections and update its state\r\n            var windowObjectAndEvents = store_1.default.get(windowInfo.windowId);\r\n            if (!windowObjectAndEvents) {\r\n                _logger.error(\"received update for unknown window. Stream:', \" + JSON.stringify(windowInfo, null, 4));\r\n                return;\r\n            }\r\n            var theWindow = windowObjectAndEvents.API;\r\n            var theWindowEvents = windowObjectAndEvents.Events;\r\n            var oldFrameColor = theWindow.frameColor;\r\n            // const property: string = \"handle\" + eventType;\r\n            // // Try the generic handlers\r\n            // if (theWindowEvents.hasOwnProperty(property)) {\r\n            //     theWindowEvents[property](windowInfo);\r\n            // }\r\n            if (eventType === \"Ready\") {\r\n                store_1.default.setReadyState(windowObjectAndEvents.API.id);\r\n            }\r\n            if (eventType === \"TitleChanged\") {\r\n                theWindowEvents.handleTitleChanged(windowInfo.windowTitle);\r\n            }\r\n            if (eventType === \"UrlChanged\") {\r\n                store_1.default.setUrlChangedState(windowObjectAndEvents.API.id);\r\n                theWindowEvents.handleUrlChanged(windowInfo.url);\r\n            }\r\n            if (eventType === \"WindowStyleChanged\") {\r\n                var parsedWsa = parseWindowStyleAttributes(windowInfo.windowStyleAttributes);\r\n                theWindowEvents.handleWindowSettingsChanged(parsedWsa);\r\n                theWindowEvents.handleVisibilityChanged(!parsedWsa.hidden);\r\n            }\r\n            if (eventType === \"Normal\" ||\r\n                eventType === \"Maximized\" ||\r\n                eventType === \"Minimized\" ||\r\n                eventType === \"Collapsed\" ||\r\n                eventType === \"Expanded\") {\r\n                var state = eventType.toLowerCase();\r\n                theWindowEvents.handleWindowChangeState(state);\r\n            }\r\n            if (eventType === \"ContextUpdated\") {\r\n                theWindowEvents.handleContextUpdated(windowInfo.context);\r\n            }\r\n            if (eventType === \"FrameButtonAdded\") {\r\n                theWindowEvents.handleFrameButtonAdded(windowInfo);\r\n            }\r\n            if (eventType === \"FrameButtonRemoved\") {\r\n                theWindowEvents.handleFrameButtonRemoved(windowInfo.buttonId);\r\n            }\r\n            if (eventType === \"FrameButtonClicked\") {\r\n                theWindowEvents.handleFrameButtonClicked(windowInfo);\r\n            }\r\n            if (eventType === \"FrameSelectionChanged\") {\r\n                theWindowEvents.handleFrameSelectionChanged(windowInfo.newWindow, windowInfo.prevWindow);\r\n            }\r\n            if (eventType === \"FrameIsLockedChanged\") {\r\n                theWindowEvents.handleFrameIsLockedChanged(windowInfo.isLocked);\r\n            }\r\n            if (eventType === \"TabHeaderVisibilityChanged\") {\r\n                theWindowEvents.handleTabHeaderVisibilityChanged(windowInfo.tabHeaderVisible);\r\n            }\r\n            if (eventType === \"BoundsChanged\") {\r\n                var bounds = {\r\n                    height: windowInfo.height,\r\n                    left: windowInfo.left,\r\n                    top: windowInfo.top,\r\n                    width: windowInfo.width,\r\n                };\r\n                theWindowEvents.handleBoundsChanged(bounds);\r\n            }\r\n            if (eventType === \"FocusChanged\") {\r\n                focusChanged(theWindowEvents, theWindow, windowInfo.focus);\r\n            }\r\n            if (eventType === \"FrameColorChanged\") {\r\n                if (oldFrameColor !== windowInfo.frameColor) {\r\n                    theWindowEvents.handleFrameColorChanged(windowInfo.frameColor);\r\n                    _registry.execute(\"frame-color-changed\", theWindow);\r\n                }\r\n            }\r\n            if (eventType === \"FrameAttached\") {\r\n                theWindowEvents.handleFrameAttached(windowInfo.tabGroupId, windowInfo.tabHeaderVisible);\r\n            }\r\n            if (eventType === \"TabAttached\") {\r\n                theWindowEvents.handleAttached(windowInfo.tabGroupId, windowInfo.tabHeaderVisible);\r\n                var winsToBeNotified_1 = helpers_1.getWindowsByTabGroupId(theWindow.id, windowInfo.tabGroupId);\r\n                // Getting all windows, except current, with same tabGroupId\r\n                Object.keys(winsToBeNotified_1).forEach(function (id) {\r\n                    var win = winsToBeNotified_1[id];\r\n                    // Executing event windowAttached to all windows\r\n                    win.Events.handleWindowAttached(theWindow);\r\n                });\r\n                _registry.execute(\"tab-attached\", theWindow, windowInfo.tabGroupId, windowInfo.tabHeaderVisible);\r\n            }\r\n            if (eventType === \"TabDettached\") {\r\n                // In the event, tabGroupId is empty, will be update on the next event FrameAttached\r\n                var oldTabGroupId = theWindow.tabGroupId;\r\n                theWindowEvents.handleDetached(windowInfo.tabGroupId);\r\n                var winsToBeNotified_2 = helpers_1.getWindowsByTabGroupId(theWindow.id, oldTabGroupId);\r\n                Object.keys(winsToBeNotified_2).forEach(function (id) {\r\n                    var win = winsToBeNotified_2[id];\r\n                    win.Events.handleWindowDetached(theWindow);\r\n                });\r\n                _registry.execute(\"tab-detached\", theWindow, windowInfo.tabGroupId, theWindow.tabGroupId);\r\n            }\r\n            if (eventType === \"CompositionChanged\") {\r\n                theWindowEvents.handleCompositionChanged(windowInfo.neighbours, windowInfo.groupId);\r\n                _registry.execute(\"composition-changed\", windowInfo);\r\n            }\r\n            if (eventType === \"GroupHeaderVisibilityChanged\") {\r\n                theWindowEvents.handleGroupHeaderVisibilityChanged(windowInfo.groupHeaderVisible);\r\n                _registry.execute(\"group-header-changed\", windowInfo);\r\n            }\r\n            // Clear the window on close event\r\n            if (eventType === \"Closed\") {\r\n                if (windowInfo.focus) {\r\n                    // raise lost focus event\r\n                    focusChanged(theWindowEvents, theWindow, false);\r\n                }\r\n                store_1.default.remove(windowObjectAndEvents);\r\n                theWindowEvents.handleWindowClose();\r\n            }\r\n            // expose to external listeners\r\n            _registry.execute(\"window-event\", windowInfo);\r\n        }\r\n        function focusChanged(theWindowEvents, theWindow, focus) {\r\n            theWindowEvents.handleFocusChanged(focus);\r\n            if (focus) {\r\n                _registry.execute(\"got-focus\", theWindow);\r\n            }\r\n            else {\r\n                _registry.execute(\"lost-focus\", theWindow);\r\n            }\r\n        }\r\n        function createWindow(windowId, args) {\r\n            var windowObjAndEvents = window_1.default(windowId, mapToWindowConstructorOptions(args), executor_1.default, _logger, appManagerGetter);\r\n            store_1.default.add(windowObjAndEvents);\r\n            return windowObjAndEvents;\r\n        }\r\n        function open(name, url, options, success, error) {\r\n            options = options || {};\r\n            // relativeTo fix\r\n            if (typeof options.relativeTo !== \"undefined\" && typeof options.relativeTo !== \"string\") {\r\n                options.relativeTo = options.relativeTo.id || \"\";\r\n            }\r\n            options.windowName = name;\r\n            options.url = url;\r\n            agm.invoke(\"T42.Html.CreateWindow\", options)\r\n                .then(function (message) {\r\n                if (message.returned !== undefined) {\r\n                    var id = message.returned.id;\r\n                    success(id);\r\n                }\r\n                else {\r\n                    error(\"failed to execute T42.Html.CreateWindow - unknown reason\");\r\n                }\r\n            }).catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n            });\r\n        }\r\n        function tabAttached(callback) {\r\n            return _registry.add(\"tab-attached\", callback);\r\n        }\r\n        function tabDetached(callback) {\r\n            return _registry.add(\"tab-detached\", callback);\r\n        }\r\n        function onWindowFrameColorChanged(callback) {\r\n            return _registry.add(\"frame-color-changed\", callback);\r\n        }\r\n        function onWindowGotFocus(callback) {\r\n            return _registry.add(\"got-focus\", callback);\r\n        }\r\n        function onWindowLostFocus(callback) {\r\n            return _registry.add(\"lost-focus\", callback);\r\n        }\r\n        function onEvent(callback) {\r\n            return _registry.add(\"window-event\", callback);\r\n        }\r\n        function my() {\r\n            return _windowId;\r\n        }\r\n        function onCompositionChanged(callback) {\r\n            return _registry.add(\"composition-changed\", callback);\r\n        }\r\n        function onGroupHeaderVisibilityChanged(callback) {\r\n            return _registry.add(\"group-header-changed\", callback);\r\n        }\r\n        function mapToWindowConstructorOptions(args) {\r\n            var _state = typeof args.WindowState !== \"undefined\" ? args.WindowState.toLowerCase() : \"normal\";\r\n            var windowStyleAttributes = parseWindowStyleAttributes(args.windowStyleAttributes);\r\n            return {\r\n                name: args.windowName,\r\n                url: args.url,\r\n                title: args.windowTitle,\r\n                context: args.context,\r\n                bounds: {\r\n                    height: args.height,\r\n                    left: args.left,\r\n                    top: args.top,\r\n                    width: args.width,\r\n                },\r\n                focus: args.focus,\r\n                frameColor: args.frameColor,\r\n                groupId: args.groupId,\r\n                isCollapsed: args.isCollapsed,\r\n                isGroupHeaderVisible: args.isGroupHeaderVisible,\r\n                isLocked: args.isLocked,\r\n                isTabHeaderVisible: args.isTabHeaderVisible,\r\n                isTabSelected: args.isTabSelected,\r\n                isVisible: !windowStyleAttributes.hidden,\r\n                isFocused: windowStyleAttributes.focus,\r\n                mode: windowStyleAttributes.mode,\r\n                settings: windowStyleAttributes,\r\n                state: _state,\r\n                tabGroupId: args.tabGroupId,\r\n                neighbours: args.neighbours,\r\n            };\r\n        }\r\n        function parseWindowStyleAttributes(windowStyles) {\r\n            if (windowStyles === undefined) {\r\n                return {};\r\n            }\r\n            if (typeof windowStyles !== \"object\") {\r\n                return JSON.parse(windowStyles);\r\n            }\r\n            return windowStyles;\r\n        }\r\n        hcEnv = {\r\n            my: my,\r\n            onEvent: onEvent,\r\n            open: open,\r\n            tabAttached: tabAttached,\r\n            tabDetached: tabDetached,\r\n            onWindowFrameColorChanged: onWindowFrameColorChanged,\r\n            executor: executor_1.default,\r\n            onCompositionChanged: onCompositionChanged,\r\n            onGroupHeaderVisibilityChanged: onGroupHeaderVisibilityChanged,\r\n            onWindowGotFocus: onWindowGotFocus,\r\n            onWindowLostFocus: onWindowLostFocus,\r\n        };\r\n    });\r\n});\r\n//# sourceMappingURL=hc.js.map\n\n/***/ }),\n/* 76 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = __webpack_require__(0);\r\nvar store_1 = __webpack_require__(3);\r\nexports.default = (function (id, executor) {\r\n    var _registry = CallbackFactory();\r\n    var _windowsId = [];\r\n    var isGroupHeaderVisibleCalled;\r\n    //#region \"API functions\"\r\n    function addWindow(winId) {\r\n        if (_windowsId.indexOf(winId) === -1) {\r\n            _windowsId.push(winId);\r\n            var window_1 = store_1.default.get(winId);\r\n            window_1.Events.handleGroupAssociation(groupObject);\r\n            _registry.execute(\"window-added\", groupObject, window_1.API);\r\n        }\r\n    }\r\n    function removeWindow(winId) {\r\n        var index = _windowsId.indexOf(winId);\r\n        if (index !== -1) {\r\n            _windowsId.splice(index, 1);\r\n            var window_2 = _mapToWindowObject(winId);\r\n            _registry.execute(\"window-removed\", groupObject, window_2);\r\n        }\r\n    }\r\n    function find(window, success) {\r\n        var winId;\r\n        if (typeof window === \"string\") {\r\n            winId = window;\r\n        }\r\n        else {\r\n            winId = window.id;\r\n        }\r\n        var index = _windowsId.indexOf(winId);\r\n        if (index !== -1) {\r\n            var mappedWindow = _mapToWindowObject(_windowsId[index]);\r\n            if (typeof success === \"function\") {\r\n                success(mappedWindow);\r\n            }\r\n            return mappedWindow;\r\n        }\r\n    }\r\n    function windows(success) {\r\n        var mappedWindows = _mapToWindowObjects();\r\n        if (typeof success === \"function\") {\r\n            success(mappedWindows);\r\n        }\r\n        return mappedWindows;\r\n    }\r\n    function showHeader(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setGroupHeaderVisible(_windowsId[0], true)\r\n                .then(function (w) {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function hideHeader(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setGroupHeaderVisible(_windowsId[0], false)\r\n                .then(function (w) {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                return;\r\n            });\r\n        });\r\n    }\r\n    function execute(command, options, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.execute(command, options)\r\n                .then(function (w) {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    //#endregion \"API functions\"\r\n    //#region \"Stream function\"\r\n    function handleGroupHeaderVisibilityChanged(windowInfo) {\r\n        if (isGroupHeaderVisibleCalled !== windowInfo.groupHeaderVisible) {\r\n            isGroupHeaderVisibleCalled = windowInfo.groupHeaderVisible;\r\n            _registry.execute(\"header-visibility-changed\", groupObject);\r\n        }\r\n    }\r\n    //#endregion \"Stream function\"\r\n    //#region \"Internal function\"\r\n    function _mapToWindowObjects() {\r\n        var winObjects = [];\r\n        _windowsId.forEach(function (winId) {\r\n            var windowObject = _mapToWindowObject(winId);\r\n            if (typeof windowObject !== \"undefined\") {\r\n                winObjects.push(windowObject);\r\n            }\r\n        });\r\n        return winObjects;\r\n    }\r\n    function _mapToWindowObject(windowId) {\r\n        return store_1.default.get(windowId) ? store_1.default.get(windowId).API : undefined;\r\n    }\r\n    function _getGroupHeaderVisibility() {\r\n        // if one of the windows has a flag hideGroupHeader the group header should be off.\r\n        var _isGroupHeaderVisible;\r\n        var result = _mapToWindowObjects().filter(function (w) {\r\n            return !w.isGroupHeaderVisible;\r\n        });\r\n        _isGroupHeaderVisible = result.length === 0;\r\n        return _isGroupHeaderVisible;\r\n    }\r\n    //#endregion \"Internal function\"\r\n    //#region \"Events\"\r\n    function onHeaderVisibilityChanged(callback) {\r\n        return _registry.add(\"header-visibility-changed\", callback);\r\n    }\r\n    function onWindowAdded(callback) {\r\n        return _registry.add(\"window-added\", callback);\r\n    }\r\n    function onWindowRemoved(callback) {\r\n        return _registry.add(\"window-removed\", callback);\r\n    }\r\n    //#endregion \"Events\"\r\n    //#region \"API\"\r\n    var groupObject = {\r\n        id: id,\r\n        get windows() {\r\n            return windows();\r\n        },\r\n        find: find,\r\n        get isHeaderVisible() {\r\n            return _getGroupHeaderVisibility();\r\n        },\r\n        showHeader: showHeader,\r\n        hideHeader: hideHeader,\r\n        maximize: function (success, error) {\r\n            return execute(\"maximize\", { groupId: id }, success, error);\r\n        },\r\n        restore: function (success, error) {\r\n            return execute(\"restore\", { groupId: id }, success, error);\r\n        },\r\n        onHeaderVisibilityChanged: onHeaderVisibilityChanged,\r\n        onWindowAdded: onWindowAdded,\r\n        onWindowRemoved: onWindowRemoved,\r\n    };\r\n    var internal = {\r\n        addWindow: addWindow,\r\n        removeWindow: removeWindow,\r\n        handleGroupHeaderVisibilityChanged: handleGroupHeaderVisibilityChanged,\r\n    };\r\n    return {\r\n        groupAPI: groupObject,\r\n        groupInternal: internal,\r\n    };\r\n    //#endregion \"API\"\r\n});\r\n//# sourceMappingURL=group.js.map\n\n/***/ }),\n/* 77 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = __webpack_require__(0);\r\nvar group_1 = __webpack_require__(76);\r\nvar store_1 = __webpack_require__(3);\r\nexports.default = (function (environment, logger) {\r\n    var _logger = logger.subLogger(\"groups\");\r\n    var _registry = CallbackFactory();\r\n    var _groups = {};\r\n    // Getting already existing windows and create Group API for each window\r\n    var windows = store_1.default.list;\r\n    Object.keys(windows).forEach(function (k) {\r\n        addNewWindow(windows[k]);\r\n    });\r\n    environment.onCompositionChanged(function (windowInfo) {\r\n        handleCompositionChanged(windowInfo);\r\n    });\r\n    environment.onGroupHeaderVisibilityChanged(function (windowInfo) {\r\n        var windowId = windowInfo.windowId;\r\n        var group = findGroupByWindow(windowId);\r\n        if (typeof group !== \"undefined\") {\r\n            var groupEvents = _groups[group.id];\r\n            groupEvents.groupInternal.handleGroupHeaderVisibilityChanged(windowInfo);\r\n        }\r\n    });\r\n    store_1.default.onAdded(function (win) {\r\n        addNewWindow(win);\r\n    });\r\n    store_1.default.onRemoved(function (win) {\r\n        removeWindow(win);\r\n    });\r\n    // Methods\r\n    function my() {\r\n        return findGroupByWindow(environment.my());\r\n    }\r\n    function list(success) {\r\n        var result = Object.keys(_groups).map(function (groupId) {\r\n            if (_groups[groupId]) {\r\n                return _groups[groupId].groupAPI;\r\n            }\r\n        });\r\n        if (typeof success === \"function\") {\r\n            success(result);\r\n        }\r\n        return result;\r\n    }\r\n    function findGroupByWindow(winId, success) {\r\n        var windowId;\r\n        if (typeof winId === \"undefined\") {\r\n            logger.debug(\"trying to find a group by a window, but winId is undefined\");\r\n            return;\r\n        }\r\n        if (typeof winId === \"string\") {\r\n            windowId = winId;\r\n        }\r\n        else {\r\n            windowId = winId.id;\r\n        }\r\n        var groupFound;\r\n        Object.keys(_groups).forEach(function (groupId) {\r\n            var group = _groups[groupId].groupAPI;\r\n            if (group.find(windowId) !== undefined) {\r\n                groupFound = group;\r\n                return;\r\n            }\r\n        });\r\n        if (typeof success === \"function\") {\r\n            success(groupFound);\r\n        }\r\n        return groupFound;\r\n    }\r\n    // Events\r\n    function onWindowMoved(callback) {\r\n        return _registry.add(\"window-moved\", callback);\r\n    }\r\n    // Private\r\n    function createOrGetGroup(groupId) {\r\n        if (!_groups.hasOwnProperty(groupId)) {\r\n            var createdGroup = group_1.default(groupId, environment.executor);\r\n            _groups[groupId] = createdGroup;\r\n            return createdGroup;\r\n        }\r\n        else {\r\n            return _groups[groupId];\r\n        }\r\n    }\r\n    function deleteGroup(groupId) {\r\n        if (_groups.hasOwnProperty(groupId) && typeof _groups[groupId] !== \"undefined\") {\r\n            if (_groups[groupId].groupAPI.windows.length === 0) {\r\n                delete _groups[groupId];\r\n            }\r\n        }\r\n    }\r\n    function addNewWindow(win) {\r\n        _logger.trace(\"Adding new window \" + win.API.id + \" to win.API.groupId \" + win.API.groupId);\r\n        var group = addWindow(win);\r\n        if (group) {\r\n            _logger.trace(\"handleGroupAssociation \" + win.API.id + \" to group.groupAPI.id \" + group.groupAPI.id);\r\n            win.Events.handleGroupAssociation(group.groupAPI);\r\n        }\r\n    }\r\n    function addWindow(win, groupId) {\r\n        var windowGroupId = groupId || win.API.groupId;\r\n        var windowId = win.API.id;\r\n        if (typeof windowGroupId === \"undefined\" || typeof windowId === \"undefined\") {\r\n            _logger.debug(\"trying to add a window without group - winId: \" + windowId);\r\n            return;\r\n        }\r\n        var group = createOrGetGroup(windowGroupId);\r\n        group.groupInternal.addWindow(windowId);\r\n        return group;\r\n    }\r\n    function removeWindow(win, groupId) {\r\n        var windowId = win.API.id;\r\n        var windowGroupId = groupId || win.API.groupId;\r\n        if (typeof windowGroupId !== \"undefined\") {\r\n            var group = _groups[windowGroupId];\r\n            group.groupInternal.removeWindow(windowId);\r\n            win.Events.handleGroupAssociation(undefined);\r\n            deleteGroup(windowGroupId);\r\n        }\r\n    }\r\n    function handleCompositionChanged(windowInfo) {\r\n        var newGroupId = windowInfo.groupId;\r\n        var windowId = windowInfo.windowId;\r\n        var oldGroup = findGroupByWindow(windowId);\r\n        var oldGroupId = oldGroup ? oldGroup.id : undefined;\r\n        _logger.trace(\"handleCompositionChanged newGroupId: \" + newGroupId + \" windowId: \" + windowId + \" oldGroup: \" + oldGroupId);\r\n        if (oldGroupId === newGroupId) {\r\n            _logger.trace(\"handleCompositionChanged newGroupId: \" + newGroupId + \" windowId: \" + windowId + \" oldGroup: \" + oldGroupId + \" are the same - returning...\");\r\n            return;\r\n        }\r\n        var win = store_1.default.get(windowId) || store_1.default.get(windowId);\r\n        var newGroup = addWindow(win, newGroupId);\r\n        if (oldGroup) {\r\n            removeWindow(win, oldGroupId);\r\n            _registry.execute(\"window-moved\", windowId, oldGroup, newGroupId);\r\n        }\r\n        win.Events.handleGroupChanged(newGroup.groupAPI, oldGroup);\r\n    }\r\n    //#region \"API\"\r\n    var groups = {\r\n        get my() {\r\n            return my();\r\n        },\r\n        list: list,\r\n        findGroupByWindow: findGroupByWindow,\r\n    };\r\n    //#endregion \"API\r\n    var events = { onWindowMoved: onWindowMoved };\r\n    return {\r\n        groupsAPI: groups,\r\n        groupsEvents: events,\r\n    };\r\n});\r\n//# sourceMappingURL=groups.js.map\n\n/***/ }),\n/* 78 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = __webpack_require__(0);\r\nvar detector_1 = __webpack_require__(71);\r\nvar groups_1 = __webpack_require__(77);\r\nvar store_1 = __webpack_require__(3);\r\nexports.default = (function (agm, logger, appManagerGetter, gdMajorVersion) {\r\n    var _registry = CallbackFactory();\r\n    var _logger = logger;\r\n    var groups;\r\n    var environment;\r\n    store_1.default.init(_logger);\r\n    var isReady = new Promise(function (resolve, reject) {\r\n        detector_1.default(agm, _logger, appManagerGetter, gdMajorVersion)\r\n            .then(function (env) {\r\n            environment = env;\r\n            groups = groups_1.default(env, _logger);\r\n            resolve();\r\n        })\r\n            .catch(function (e) {\r\n            var err = \"Environment detector fails with: \" + e;\r\n            _logger.error(err);\r\n            reject(err);\r\n        });\r\n    });\r\n    function ready() {\r\n        return isReady;\r\n    }\r\n    function my() {\r\n        var myWindow = store_1.default.getIfReady(environment.my());\r\n        return myWindow ? myWindow.API : undefined;\r\n    }\r\n    function open(name, url, options, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var errorHandler = function (errorResponse) {\r\n                if (typeof error === \"function\") {\r\n                    error(errorResponse);\r\n                }\r\n                reject(errorResponse);\r\n            };\r\n            var successHandler = function (id) {\r\n                store_1.default.waitFor(id)\r\n                    .then(function (win) {\r\n                    if (typeof success === \"function\") {\r\n                        success(win);\r\n                    }\r\n                    resolve(win);\r\n                })\r\n                    .catch(errorHandler);\r\n            };\r\n            environment.open(name, url, options, successHandler, errorHandler);\r\n        });\r\n    }\r\n    function find(name, success, error) {\r\n        var windows = store_1.default.list;\r\n        var windowsForListing = Object.keys(windows).reduce(function (memo, winId) {\r\n            var window = windows[winId];\r\n            if (window && window.API.name === name) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing[0];\r\n        }\r\n        if (windowsForListing.length > 0) {\r\n            success(windowsForListing[0]);\r\n        }\r\n        else {\r\n            if (typeof error === \"function\") {\r\n                error(\"There is no window with name:\" + name);\r\n            }\r\n        }\r\n    }\r\n    function findById(id, success, error) {\r\n        var windows = store_1.default.list;\r\n        var windowsForListing = Object.keys(windows).reduce(function (memo, winId) {\r\n            var window = windows[winId];\r\n            if (typeof window !== \"undefined\" && window.API.id === id) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing[0];\r\n        }\r\n        if (windowsForListing.length > 0) {\r\n            success(windowsForListing[0]);\r\n        }\r\n        else {\r\n            if (typeof error === \"function\") {\r\n                error(\"There is no window with such id:\" + id);\r\n            }\r\n        }\r\n    }\r\n    function list(success) {\r\n        var windows = store_1.default.list;\r\n        var windowsForListing = Object.keys(windows)\r\n            .map(function (k) {\r\n            return windows[k].API;\r\n        });\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing;\r\n        }\r\n        success(windowsForListing);\r\n    }\r\n    function windowAdded(callback) {\r\n        return _registry.add(\"window-added\", callback);\r\n    }\r\n    function windowRemoved(callback) {\r\n        return _registry.add(\"window-removed\", callback);\r\n    }\r\n    function tabAttached(callback) {\r\n        return isReady.then(function () {\r\n            environment.tabAttached(callback);\r\n        });\r\n    }\r\n    function tabDetached(callback) {\r\n        return isReady.then(function () {\r\n            environment.tabDetached(callback);\r\n        });\r\n    }\r\n    function onWindowFrameColorChanged(callback) {\r\n        return isReady.then(function () {\r\n            return environment.onWindowFrameColorChanged(callback);\r\n        });\r\n    }\r\n    function onWindowGotFocus(callback) {\r\n        var unsubscribe;\r\n        isReady.then(function () {\r\n            unsubscribe = environment.onWindowGotFocus(callback);\r\n        });\r\n        return function () {\r\n            if (unsubscribe) {\r\n                unsubscribe();\r\n            }\r\n        };\r\n    }\r\n    function onWindowLostFocus(callback) {\r\n        var unsubscribe;\r\n        isReady.then(function () {\r\n            unsubscribe = environment.onWindowLostFocus(callback);\r\n        });\r\n        return function () {\r\n            if (unsubscribe) {\r\n                unsubscribe();\r\n            }\r\n        };\r\n    }\r\n    function onEvent(callback) {\r\n        var unsubFunc;\r\n        var unsubscribed = false;\r\n        isReady.then(function () {\r\n            if (unsubscribed) {\r\n                return;\r\n            }\r\n            unsubFunc = environment.onEvent(callback);\r\n        });\r\n        return function () {\r\n            unsubscribed = true;\r\n            if (unsubFunc) {\r\n                unsubFunc();\r\n            }\r\n        };\r\n    }\r\n    function handleWindowAdded(w) {\r\n        _registry.execute(\"window-added\", w.API);\r\n    }\r\n    function handleWindowRemoved(w) {\r\n        _registry.execute(\"window-removed\", w.API);\r\n    }\r\n    store_1.default.onReadyWindow(handleWindowAdded);\r\n    store_1.default.onRemoved(handleWindowRemoved);\r\n    // The API itself\r\n    return {\r\n        my: my,\r\n        open: open,\r\n        find: find,\r\n        findById: findById,\r\n        list: list,\r\n        ready: ready,\r\n        onWindowAdded: windowAdded,\r\n        windowAdded: windowAdded,\r\n        onWindowRemoved: windowRemoved,\r\n        windowRemoved: windowRemoved,\r\n        onTabAttached: tabAttached,\r\n        onTabDetached: tabDetached,\r\n        onWindowFrameColorChanged: onWindowFrameColorChanged,\r\n        get groups() {\r\n            return groups.groupsAPI;\r\n        },\r\n        onWindowGotFocus: onWindowGotFocus,\r\n        onWindowLostFocus: onWindowLostFocus,\r\n        onEvent: onEvent,\r\n    };\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// tick42-glue.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 69);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7dd767f6dfa5f38960ac","\"use strict\";\r\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    function clearKey(key) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            return;\r\n        }\r\n        delete callbacks[key];\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear,\r\n        clearKey: clearKey\r\n    };\r\n}\r\n;\r\ncreateRegistry.default = createRegistry;\r\nmodule.exports = createRegistry;\r\n//# sourceMappingURL=index.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/callback-registry/lib/index.js\n// module id = 0\n// module chunks = 0","\"use strict\";\r\n// some small useful functions (so we don't reference underscore or lodash)\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction isNumber(arg) {\r\n    return typeof arg === \"number\";\r\n}\r\nexports.isNumber = isNumber;\r\nfunction isString(arg) {\r\n    return typeof arg === \"string\";\r\n}\r\nexports.isString = isString;\r\nfunction isObject(arg) {\r\n    return typeof arg === \"object\" && arg !== null;\r\n}\r\nexports.isObject = isObject;\r\nfunction isArray(arg) {\r\n    // TODO optimize\r\n    if (Array.isArray) {\r\n        return Array.isArray(arg);\r\n    }\r\n    return toString.call(arg) === \"[object Array]\";\r\n}\r\nexports.isArray = isArray;\r\nfunction isUndefined(arg) {\r\n    return typeof arg === \"undefined\";\r\n}\r\nexports.isUndefined = isUndefined;\r\nfunction isUndefinedOrNull(arg) {\r\n    return !arg || typeof arg === \"undefined\";\r\n}\r\nexports.isUndefinedOrNull = isUndefinedOrNull;\r\n/**\r\n *  Checks if an object is empty (has no properties)\r\n * @private\r\n */\r\nfunction isEmpty(arg) {\r\n    for (var prop in arg) {\r\n        if (arg.hasOwnProperty(prop)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nexports.isEmpty = isEmpty;\r\nfunction isFunction(arg) {\r\n    return !!(arg && arg.constructor && arg.call && arg.apply);\r\n}\r\nexports.isFunction = isFunction;\r\nfunction some(array, predicate) {\r\n    for (var index = 0; index < array.length; index++) {\r\n        if (predicate(array[index], index)) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nexports.some = some;\r\nfunction first(array, predicate) {\r\n    for (var index = 0; index < array.length; index++) {\r\n        if (predicate(array[index], index)) {\r\n            return array[index];\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\nexports.first = first;\r\nfunction ifNotUndefined(what, doWithIt) {\r\n    if (typeof what !== \"undefined\") {\r\n        doWithIt(what);\r\n    }\r\n}\r\nexports.ifNotUndefined = ifNotUndefined;\r\nfunction promisify(promise, successCallback, errorCallback) {\r\n    \"use strict\";\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { return; };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { return; };\r\n    }\r\n    promise.then(successCallback, errorCallback);\r\n}\r\nexports.promisify = promisify;\r\n//# sourceMappingURL=util.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/helpers/util.js\n// module id = 1\n// module chunks = 0","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar EntityEvent = /** @class */ (function () {\r\n    function EntityEvent(entitiy, context) {\r\n        this.entity = entitiy;\r\n        this.context = context;\r\n    }\r\n    return EntityEvent;\r\n}());\r\nexports.EntityEvent = EntityEvent;\r\nvar EntityEventContext = /** @class */ (function () {\r\n    function EntityEventContext(eventType) {\r\n        this.type = eventType;\r\n    }\r\n    return EntityEventContext;\r\n}());\r\nexports.EntityEventContext = EntityEventContext;\r\nvar ActivityStatusChangeEventContext = /** @class */ (function (_super) {\r\n    __extends(ActivityStatusChangeEventContext, _super);\r\n    function ActivityStatusChangeEventContext(newStatus, oldStatus) {\r\n        var _this = _super.call(this, EntityEventType.StatusChange) || this;\r\n        _this.newStatus = newStatus;\r\n        _this.oldStatus = oldStatus;\r\n        return _this;\r\n    }\r\n    return ActivityStatusChangeEventContext;\r\n}(EntityEventContext));\r\nexports.ActivityStatusChangeEventContext = ActivityStatusChangeEventContext;\r\nvar ActivityContextChangedEventContext = /** @class */ (function (_super) {\r\n    __extends(ActivityContextChangedEventContext, _super);\r\n    function ActivityContextChangedEventContext(context, updated, removed) {\r\n        var _this = _super.call(this, EntityEventType.ActivityContextChange) || this;\r\n        _this.context = typeof context === \"string\" ? JSON.parse(context) : context;\r\n        _this.updated = updated;\r\n        _this.removed = removed;\r\n        return _this;\r\n    }\r\n    return ActivityContextChangedEventContext;\r\n}(EntityEventContext));\r\nexports.ActivityContextChangedEventContext = ActivityContextChangedEventContext;\r\nvar EntityEventType = /** @class */ (function () {\r\n    function EntityEventType() {\r\n    }\r\n    EntityEventType.Added = \"added\";\r\n    EntityEventType.Removed = \"removed\";\r\n    EntityEventType.Updated = \"updated\";\r\n    EntityEventType.Closed = \"closed\";\r\n    EntityEventType.StatusChange = \"statusChange\";\r\n    EntityEventType.ActivityContextChange = \"activityContextUpdate\";\r\n    EntityEventType.ActivityWindowEvent = \"activityWindowEvent\";\r\n    // #deleteme TODO: these are not implemented in HC\r\n    EntityEventType.ActivityWindowJoinedActivity = \"joined\";\r\n    EntityEventType.ActivityWindowLeftActivity = \"left\";\r\n    return EntityEventType;\r\n}());\r\nexports.EntityEventType = EntityEventType;\r\nvar ActivityState = /** @class */ (function () {\r\n    function ActivityState() {\r\n    }\r\n    ActivityState.Created = \"created\";\r\n    ActivityState.Started = \"started\";\r\n    ActivityState.Destroyed = \"destroyed\";\r\n    return ActivityState;\r\n}());\r\nexports.ActivityState = ActivityState;\r\n//# sourceMappingURL=entityEvent.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/contracts/entityEvent.js\n// module id = 2\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = require(\"callback-registry\");\r\nvar WindowStore = /** @class */ (function () {\r\n    function WindowStore() {\r\n        this.waitForTimeoutInMilliseconds = 60000;\r\n        this._windows = {};\r\n        this._pendingWindows = {};\r\n        this._pendingWindowsStates = {};\r\n        this._registry = CallbackFactory();\r\n    }\r\n    WindowStore.prototype.init = function (logger) {\r\n        this._logger = logger;\r\n    };\r\n    // Returns a window which either in Ready OR NOT 'ready' state (when the window is NOT marked with readyToShow)\r\n    WindowStore.prototype.get = function (id) {\r\n        return this._windows[id] || this._pendingWindows[id];\r\n    };\r\n    // Returns a window which is in 'ready' state (when the window is marked with readyToShow)\r\n    WindowStore.prototype.getIfReady = function (id) {\r\n        return this._windows[id];\r\n    };\r\n    Object.defineProperty(WindowStore.prototype, \"list\", {\r\n        get: function () {\r\n            return this._windows;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowStore.prototype.add = function (window) {\r\n        var isExist = this._pendingWindows[window.API.id] ? true : false;\r\n        if (isExist) {\r\n            this._logger.error(\"trying to add window with id \" + window.API.id + \" from windowStore, which already exists\");\r\n            return;\r\n        }\r\n        var remote = window.API.windowType === \"remote\";\r\n        this._pendingWindows[window.API.id] = window;\r\n        this._pendingWindowsStates[window.API.id] = {\r\n            ready: false,\r\n            urlChanged: remote,\r\n        };\r\n        this._registry.execute(\"on-added\", window);\r\n    };\r\n    WindowStore.prototype.remove = function (window) {\r\n        delete this._windows[window.API.id];\r\n        delete this._pendingWindows[window.API.id];\r\n        delete this._pendingWindowsStates[window.API.id];\r\n        this._registry.execute(\"on-removed\", window);\r\n    };\r\n    WindowStore.prototype.setReadyState = function (windowId) {\r\n        var targetWindowState = this._pendingWindowsStates[windowId];\r\n        if (typeof targetWindowState === \"undefined\") {\r\n            return;\r\n        }\r\n        targetWindowState.ready = true;\r\n        if (targetWindowState.urlChanged) {\r\n            this.markReadyToShow(windowId);\r\n        }\r\n    };\r\n    WindowStore.prototype.setUrlChangedState = function (windowId) {\r\n        var targetWindowState = this._pendingWindowsStates[windowId];\r\n        if (typeof targetWindowState === \"undefined\") {\r\n            return;\r\n        }\r\n        targetWindowState.urlChanged = true;\r\n        if (targetWindowState.ready) {\r\n            this.markReadyToShow(windowId);\r\n        }\r\n    };\r\n    WindowStore.prototype.waitFor = function (id) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var un;\r\n            var timeout = setTimeout(function () {\r\n                un();\r\n                reject(\"waitFor timed out.\");\r\n            }, _this.waitForTimeoutInMilliseconds);\r\n            var win = _this._windows[id];\r\n            if (win) {\r\n                clearTimeout(timeout);\r\n                resolve(win.API);\r\n            }\r\n            else {\r\n                un = _this.onReadyWindow(function (w) {\r\n                    if (w.API.id !== id) {\r\n                        return;\r\n                    }\r\n                    clearTimeout(timeout);\r\n                    un();\r\n                    resolve(w.API);\r\n                });\r\n            }\r\n        });\r\n    };\r\n    WindowStore.prototype.onReadyWindow = function (callback) {\r\n        return this._registry.add(\"on-ready\", callback);\r\n    };\r\n    WindowStore.prototype.onAdded = function (callback) {\r\n        return this._registry.add(\"on-added\", callback);\r\n    };\r\n    WindowStore.prototype.onRemoved = function (callback) {\r\n        return this._registry.add(\"on-removed\", callback);\r\n    };\r\n    // newly created windows now need to hear both \"ready\" and \"urlChanged\" events in otder to be markedReadyToShow\r\n    WindowStore.prototype.markReadyToShow = function (windowId) {\r\n        if (this._pendingWindows[windowId]) {\r\n            this._windows[windowId] = this._pendingWindows[windowId];\r\n            delete this._pendingWindows[windowId];\r\n            delete this._pendingWindowsStates[windowId];\r\n        }\r\n        this._registry.execute(\"on-ready\", this._windows[windowId]);\r\n    };\r\n    return WindowStore;\r\n}());\r\nexports.WindowStore = WindowStore;\r\nexports.default = new WindowStore();\r\n//# sourceMappingURL=store.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/store.js\n// module id = 3\n// module chunks = 0","\"use strict\";\r\n/* tslint:disable */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar util = require(\"./util\");\r\nvar LogLevel = /** @class */ (function () {\r\n    function LogLevel() {\r\n    }\r\n    LogLevel.Trace = \"trace\";\r\n    LogLevel.Debug = \"debug\";\r\n    LogLevel.Info = \"info\";\r\n    LogLevel.Warn = \"warn\";\r\n    LogLevel.Error = \"error\";\r\n    return LogLevel;\r\n}());\r\nexports.LogLevel = LogLevel;\r\nvar Logger = /** @class */ (function () {\r\n    function Logger(name) {\r\n        this._name = name;\r\n        // we have a glue logger let's create a new logger for it\r\n        if (!util.isUndefinedOrNull(Logger.GlueLogger)) {\r\n            this._glueLogger = Logger.GlueLogger.subLogger(name);\r\n        }\r\n    }\r\n    Logger.GetNamed = function (name) {\r\n        return new Logger(name);\r\n    };\r\n    Logger.Get = function (owner) {\r\n        return new Logger(Logger.GetTypeName(owner));\r\n    };\r\n    Logger.prototype.trace = function (message) {\r\n        if (!util.isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.trace(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Trace) {\r\n                console.info(this._getMessage(message, LogLevel.Trace));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.debug = function (message) {\r\n        if (!util.isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.debug(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace) {\r\n                console.info(this._getMessage(message, LogLevel.Debug));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.info = function (message) {\r\n        if (!util.isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.info(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace ||\r\n                Logger.Level === LogLevel.Info) {\r\n                console.info(this._getMessage(message, LogLevel.Info));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.warn = function (message) {\r\n        if (!util.isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.warn(message);\r\n        }\r\n        else {\r\n            if (Logger.Level === LogLevel.Debug ||\r\n                Logger.Level === LogLevel.Trace ||\r\n                Logger.Level === LogLevel.Info ||\r\n                Logger.Level === LogLevel.Warn) {\r\n                console.info(this._getMessage(message, LogLevel.Info));\r\n            }\r\n        }\r\n    };\r\n    Logger.prototype.error = function (message) {\r\n        if (!util.isUndefinedOrNull(this._glueLogger)) {\r\n            this._glueLogger.error(message);\r\n        }\r\n        else {\r\n            console.error(this._getMessage(message, LogLevel.Error));\r\n            console.trace();\r\n        }\r\n    };\r\n    Logger.prototype._getMessage = function (message, level) {\r\n        return \"[\" + level + \"] \" + this._name + \" - \" + message;\r\n    };\r\n    /**\r\n     * Returns the function name for a given object (same as constructor.name but cross-browser)\r\n     */\r\n    Logger.GetTypeName = function (object) {\r\n        var funcNameRegex = /function (.{1,})\\(/;\r\n        var results = (funcNameRegex).exec(object.constructor.toString());\r\n        return (results && results.length > 1) ? results[1] : \"\";\r\n    };\r\n    Logger.Level = LogLevel.Info;\r\n    return Logger;\r\n}());\r\nexports.Logger = Logger;\r\n//# sourceMappingURL=logger.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/helpers/logger.js\n// module id = 4\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ShutdownMethodName = \"T42.ACS.Shutdown\";\r\nexports.FeedackMethodName = \"T42.ACS.Feedback\";\r\nexports.GetConfigurationRegionMethodName = \"T42.ACS.GetConfigurationRegion\";\r\nexports.SetConfigurationRegionMethodName = \"T42.ACS.SetConfigurationRegion\";\r\nexports.GetUserMethodName = \"T42.ACS.GetUser\";\r\nexports.GetBranchesMethodName = \"T42.ACS.GetBranches\";\r\nexports.GetCurrentBranchMethodName = \"T42.ACS.GetCurrentBranch\";\r\nexports.SetCurrentBranchMethodName = \"T42.ACS.SetCurrentBranch\";\r\nexports.GetFunctionalEntitlementMethodName = \"T42.ACS.GetFunctionalEntitlement\";\r\nexports.CanIMethodName = \"T42.ACS.CanI\";\r\nexports.StartApplicationMethodName = \"T42.ACS.StartApplication\";\r\nexports.StopApplicationMethodName = \"T42.ACS.StopApplication\";\r\nexports.ActivateApplicationMethodName = \"T42.ACS.ActivateApplication\";\r\nexports.RunApplicationMethodName = \"T42.ACS.RunApplication\";\r\nexports.OnEventMethodName = \"T42.ACS.OnEvent\";\r\nexports.GetApplicationsMethodName = \"T42.ACS.GetApplications\";\r\n//# sourceMappingURL=agm-names.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/app-manager/const/agm-names.js\n// module id = 5\n// module chunks = 0","'use strict';\n\nvar randomFromSeed = require('./random/random-from-seed');\n\nvar ORIGINAL = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet;\nvar previousSeed;\n\nvar shuffled;\n\nfunction reset() {\n    shuffled = false;\n}\n\nfunction setCharacters(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet !== ORIGINAL) {\n            alphabet = ORIGINAL;\n            reset();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet = _alphabet_;\n    reset();\n}\n\nfunction characters(_alphabet_) {\n    setCharacters(_alphabet_);\n    return alphabet;\n}\n\nfunction setSeed(seed) {\n    randomFromSeed.seed(seed);\n    if (previousSeed !== seed) {\n        reset();\n        previousSeed = seed;\n    }\n}\n\nfunction shuffle() {\n    if (!alphabet) {\n        setCharacters(ORIGINAL);\n    }\n\n    var sourceArray = alphabet.split('');\n    var targetArray = [];\n    var r = randomFromSeed.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled() {\n    if (shuffled) {\n        return shuffled;\n    }\n    shuffled = shuffle();\n    return shuffled;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup(index) {\n    var alphabetShuffled = getShuffled();\n    return alphabetShuffled[index];\n}\n\nfunction get () {\n  return alphabet || ORIGINAL;\n}\n\nmodule.exports = {\n    get: get,\n    characters: characters,\n    seed: setSeed,\n    lookup: lookup,\n    shuffled: getShuffled\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/shortid/lib/alphabet.js\n// module id = 6\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * Base class for activity entities with reference to the activity manager\r\n * @private\r\n */\r\nvar ActivityEntity = /** @class */ (function () {\r\n    function ActivityEntity(id) {\r\n        this._id = id;\r\n    }\r\n    Object.defineProperty(ActivityEntity.prototype, \"id\", {\r\n        get: function () {\r\n            return this._id;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Updates the properties of the current object using the properties of another object\r\n     * These two should have the same id.\r\n     */\r\n    ActivityEntity.prototype._update = function (other) {\r\n        if (other._id !== this._id) {\r\n            throw Error(\"Can not update from entity with different id.\");\r\n        }\r\n        this._updateCore(other);\r\n    };\r\n    ActivityEntity.prototype._updateCore = function (other) {\r\n        return;\r\n    };\r\n    ActivityEntity.prototype._beforeDelete = function (other) {\r\n        return;\r\n    };\r\n    return ActivityEntity;\r\n}());\r\nexports.default = ActivityEntity;\r\n//# sourceMappingURL=activityEntity.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/entities/activityEntity.js\n// module id = 7\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar util = require(\"../helpers/util\");\r\nvar nextTick = function (cb) {\r\n    setTimeout(cb, 0);\r\n};\r\n/**\r\n * Convert a Promise to node style callback\r\n * @private\r\n */\r\nfunction nodeify(promise, callback) {\r\n    if (!util.isFunction(callback)) {\r\n        return promise;\r\n    }\r\n    promise.then(function (resp) {\r\n        nextTick(function () {\r\n            callback(null, resp);\r\n        });\r\n    }, function (err) {\r\n        nextTick(function () {\r\n            callback(err, null);\r\n        });\r\n    });\r\n}\r\nexports.nodeify = nodeify;\r\n//# sourceMappingURL=promiseExtensions.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/helpers/promiseExtensions.js\n// module id = 8\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar util = require(\"../helpers/util\");\r\nvar util_1 = require(\"../helpers/util\");\r\n// A helper class that provides lame activity AGM implementation\r\n// Can be initialized with or without activity - in case no activity (independent windows outside activity) only\r\n// subset of the methods work\r\nvar ActivityAGM = /** @class */ (function () {\r\n    function ActivityAGM(activity) {\r\n        this._activity = activity;\r\n    }\r\n    ActivityAGM.prototype.register = function (definition, handler) {\r\n        this._ensureHasAgm();\r\n        ActivityAGM.AGM.register(definition, handler);\r\n    };\r\n    ActivityAGM.prototype.servers = function () {\r\n        this._ensureHasAgm();\r\n        if (util.isUndefinedOrNull(this._activity)) {\r\n            // or return ActivityAGM.AGM.servers()\r\n            return [];\r\n        }\r\n        return this._activity.windows.map(function (w) {\r\n            return w.instance;\r\n        });\r\n    };\r\n    ActivityAGM.prototype.methods = function () {\r\n        var _this = this;\r\n        this._ensureHasAgm();\r\n        if (util.isUndefinedOrNull(this._activity)) {\r\n            // or return ActivityAGM.AGM.methods()\r\n            return [];\r\n        }\r\n        var windows = this._activity.windows;\r\n        var methodNames = [];\r\n        var methods = [];\r\n        // get all windows and their methods, then assemble distinct methods\r\n        windows.forEach(function (window) {\r\n            var windowMethods = _this.methodsForWindow(window);\r\n            windowMethods.forEach(function (currentWindowMethod) {\r\n                if (methodNames.indexOf(currentWindowMethod.name) === -1) {\r\n                    methodNames.push(currentWindowMethod.name);\r\n                    methods.push(currentWindowMethod);\r\n                }\r\n            });\r\n        });\r\n        return methods;\r\n    };\r\n    ActivityAGM.prototype.methodsForWindow = function (window) {\r\n        this._ensureHasAgm();\r\n        // get instance and use agm to get methods for instance\r\n        if (!window.instance) {\r\n            return [];\r\n        }\r\n        return ActivityAGM.AGM.methodsForInstance(window.instance);\r\n    };\r\n    /** Possible invoke targets\r\n     *\r\n     * \"activity.all\" - [default]\r\n     * \"activity.best\"\r\n     * ActivityWindow\r\n     * [ActivityWindow] -\r\n     *\r\n     * classic AGM\r\n     * \"all\" - agm all\r\n     * \"best\" - agm best\r\n     * instance - agm\r\n     * [ instances ]\r\n     *\r\n     */\r\n    ActivityAGM.prototype.invoke = function (methodName, arg, target, options, success, error) {\r\n        this._ensureHasAgm();\r\n        var activityServers = this.servers();\r\n        var serversToInvokeAgainst = [];\r\n        if (util.isUndefinedOrNull(target)) {\r\n            target = \"activity.all\";\r\n        }\r\n        if (util.isString(target)) {\r\n            if (target === \"activity.all\") {\r\n                serversToInvokeAgainst = activityServers;\r\n            }\r\n            else if (target === \"activity.best\") {\r\n                var potentialTargets = activityServers.filter(function (server) {\r\n                    var methods = ActivityAGM.AGM.methodsForInstance(server);\r\n                    return methods.filter(function (m) {\r\n                        return m.name === methodName;\r\n                    }).length > 0;\r\n                });\r\n                if (potentialTargets.length > 0) {\r\n                    serversToInvokeAgainst = [potentialTargets[0]];\r\n                }\r\n            }\r\n            else if (target === \"all\" || target === \"best\") {\r\n                return util_1.promisify(ActivityAGM.AGM.invoke(methodName, arg, target, options), success, error);\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid invoke target \" + target);\r\n            }\r\n        }\r\n        else if (util.isArray(target)) {\r\n            // if the array is not empty\r\n            if (target.length >= 0) {\r\n                var firstElem = target[0];\r\n                // check argument type\r\n                if (this._isInstance(firstElem)) {\r\n                    serversToInvokeAgainst = target.map(function (instance) { return instance; });\r\n                }\r\n                else if (this._isActivityWindow(firstElem)) {\r\n                    serversToInvokeAgainst = target.map(function (win) { return win.instance; });\r\n                }\r\n                else {\r\n                    throw new Error(\"Unknown target object\");\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (this._isInstance(target)) {\r\n                serversToInvokeAgainst = [target];\r\n            }\r\n            else if (this._isActivityWindow(target)) {\r\n                serversToInvokeAgainst = [target.instance];\r\n            }\r\n            else {\r\n                throw new Error(\"Unknown target object\");\r\n            }\r\n        }\r\n        throw new Error(\"Not implemented\");\r\n        // return promisify(ActivityAGM.AGM.invoke(methodName, arg, serversToInvokeAgainst, options), success, error);\r\n    };\r\n    ActivityAGM.prototype.unregister = function (definition) {\r\n        this._ensureHasAgm();\r\n        return ActivityAGM.AGM.unregister(definition);\r\n    };\r\n    ActivityAGM.prototype.createStream = function (methodDefinition, subscriptionAddedHandler, subscriptionRemovedHandler) {\r\n        this._ensureHasAgm();\r\n        ActivityAGM.AGM.createStream(methodDefinition, {\r\n            subscriptionAddedHandler: subscriptionAddedHandler,\r\n            subscriptionRemovedHandler: subscriptionRemovedHandler,\r\n            subscriptionRequestHandler: undefined\r\n        });\r\n    };\r\n    ActivityAGM.prototype.subscribe = function (methodDefinition, parameters, target) {\r\n        this._ensureHasAgm();\r\n        // #deleteme TODO: check servers needed?\r\n        // const servers = this.servers();\r\n        return ActivityAGM.AGM.subscribe(methodDefinition, parameters);\r\n    };\r\n    ActivityAGM.prototype._ensureHasAgm = function () {\r\n        if (util.isUndefinedOrNull(ActivityAGM.AGM)) {\r\n            throw new Error(\"Agm should be configured to be used in activity\");\r\n        }\r\n    };\r\n    ActivityAGM.prototype._isInstance = function (obj) {\r\n        // lame check\r\n        return obj.application !== undefined;\r\n    };\r\n    ActivityAGM.prototype._isActivityWindow = function (obj) {\r\n        return obj.instance !== undefined;\r\n    };\r\n    return ActivityAGM;\r\n}());\r\nexports.ActivityAGM = ActivityAGM;\r\n//# sourceMappingURL=activityAGM.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/core/activityAGM.js\n// module id = 9\n// module chunks = 0","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityEntity_1 = require(\"./activityEntity\");\r\nvar util_1 = require(\"../helpers/util\");\r\n/**\r\n * An activity type is a definition template for an activity, consisting of a collection of window types,\r\n * their layout and an initial activity context.\r\n *\r\n * @module activityType\r\n */\r\nvar ActivityType = /** @class */ (function (_super) {\r\n    __extends(ActivityType, _super);\r\n    function ActivityType(name, ownerWindow, helperWindows, description) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this._name = name;\r\n        _this._description = description;\r\n        _this._ownerWindow = ownerWindow;\r\n        _this._helperWindows = helperWindows || [];\r\n        return _this;\r\n    }\r\n    Object.defineProperty(ActivityType.prototype, \"name\", {\r\n        /**\r\n         * @var {string} name Name of the activity type\r\n         */\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"description\", {\r\n        /**\r\n         * @var {string} description description for the activity type\r\n         */\r\n        get: function () {\r\n            return this._description;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"helperWindows\", {\r\n        /**\r\n         * A list of window types that should be created when initiating a new instance of that activity type\r\n         * @var {windowDefinition[]} helperWindows\r\n         */\r\n        get: function () {\r\n            return this._helperWindows;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityType.prototype, \"ownerWindow\", {\r\n        /**\r\n         * @var {windowDefinition} ownerWindow Returns the definition of the owner window for that activity type\r\n         */\r\n        get: function () {\r\n            return this._ownerWindow;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Initiates a new activity of this type\r\n     *\r\n     * @function initiate\r\n     * @param {object} context The initial context to be used for the new activity\r\n     * @param callback\r\n     * @param configuration\r\n     * @returns {Promise<activity>}\r\n     */\r\n    ActivityType.prototype.initiate = function (context, callback, configuration) {\r\n        return this._manager.initiate(this._name, context, callback, configuration);\r\n    };\r\n    ActivityType.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        _super.prototype._updateCore.call(this, other);\r\n        util_1.ifNotUndefined(other._description, function (x) { return _this._description = x; });\r\n        util_1.ifNotUndefined(other._ownerWindow, function (x) { return _this._ownerWindow = x; });\r\n        util_1.ifNotUndefined(other._helperWindows, function (x) { return _this._helperWindows = x; });\r\n    };\r\n    return ActivityType;\r\n}(activityEntity_1.default));\r\nexports.default = ActivityType;\r\n//# sourceMappingURL=activityType.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/entities/activityType.js\n// module id = 10\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction objectValues(source) {\r\n    if (!source) {\r\n        return [];\r\n    }\r\n    return Object.keys(source).map(function (key) { return source[key]; });\r\n}\r\nexports.objectValues = objectValues;\r\nfunction objectClone(obj) {\r\n    var result;\r\n    try {\r\n        result = JSON.parse(JSON.stringify(obj || {}));\r\n    }\r\n    catch (error) {\r\n        result = {};\r\n    }\r\n    return result;\r\n}\r\nexports.objectClone = objectClone;\r\n//# sourceMappingURL=helper.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/app-manager/helper.js\n// module id = 11\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar entityEvent_1 = require(\"../contracts/entityEvent\");\r\nvar activityStatus_1 = require(\"../contracts/activityStatus\");\r\nvar activityType_1 = require(\"../entities/activityType\");\r\nvar windowType_1 = require(\"../entities/windowType\");\r\nvar activity_1 = require(\"../entities/activity\");\r\nvar activityWindow_1 = require(\"../entities/activityWindow\");\r\nvar logger_1 = require(\"../helpers/logger\");\r\nvar readyMarker_1 = require(\"../helpers/readyMarker\");\r\nvar util = require(\"../helpers/util\");\r\n/**\r\n * HtmlContainer (HC) bridge\r\n * @private\r\n * @module hcBridge\r\n */\r\nvar HCBridge = /** @class */ (function () {\r\n    function HCBridge(agm, windows, appManagerGetter, mode, typesToTrack) {\r\n        // HC constants\r\n        this._activityTypeEntityName = \"activityType\";\r\n        this._windowTypeEntityName = \"windowType\";\r\n        this._activityEntityName = \"activity\";\r\n        this._windowEntityName = \"activityWindow\";\r\n        this._logger = logger_1.Logger.Get(\"hcBridge\");\r\n        // event sequences\r\n        this._lastSeq = 0;\r\n        this._eventQueue = [];\r\n        this._activityTypeCallbacks = [];\r\n        this._windowTypeCallbacks = [];\r\n        this._activityCallbacks = [];\r\n        this._windowCallbacks = [];\r\n        this._agm = agm;\r\n        this._windows = windows;\r\n        this._appManagerGetter = appManagerGetter;\r\n        this._mode = mode;\r\n        this._typesToTrack = typesToTrack;\r\n    }\r\n    /**\r\n     *  Convert an ActivityType entity coming from HC to ActivityType\r\n     */\r\n    HCBridge._hcToJsActivityType = function (hcActType) {\r\n        return new activityType_1.default(hcActType.name, hcActType.ownerWindowType, hcActType.helperWindowTypes, hcActType.description);\r\n    };\r\n    HCBridge._getURLParameter = function (name) {\r\n        return decodeURIComponent((new RegExp(\"[?|&]\" + name + \"=\" + \"([^&;]+?)(&|#|;|$)\").exec(location.search) || [, \"\"])[1].replace(/\\+/g, \"%20\")) || null;\r\n    };\r\n    Object.defineProperty(HCBridge.prototype, \"bridgeType\", {\r\n        get: function () {\r\n            return \"HC\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    HCBridge.prototype.joinActivity = function (activityId, windowId) {\r\n        throw new Error(\"Not implemented\");\r\n    };\r\n    HCBridge.prototype.leaveActivity = function (activityId, windowId) {\r\n        throw new Error(\"Not implemented\");\r\n    };\r\n    HCBridge.prototype.init = function () {\r\n        var _this = this;\r\n        this._readyMarker = new readyMarker_1.ReadyMarker(\"HC Bridge\", 1);\r\n        this._htmlContainer = window.htmlContainer.activityFacade;\r\n        if (this._htmlContainer.subscribeForJoinBreakEvents) {\r\n            this._htmlContainer.subscribeForJoinBreakEvents(function (e) {\r\n                _this._handleGenericEvents(e);\r\n            });\r\n        }\r\n        var options = this._agm ? this._agm.instance : undefined;\r\n        var initFunc = this._htmlContainer.init;\r\n        if (this._htmlContainer.init2) {\r\n            initFunc = this._htmlContainer.init2;\r\n            options = {\r\n                jsAgmInstance: options,\r\n                glueVersion: 3,\r\n                mode: this._mode,\r\n                typesToTrack: this._typesToTrack\r\n            };\r\n        }\r\n        initFunc(options, this._hcEventHandler.bind(this), // event listener\r\n        function () {\r\n            _this._readyMarker.signal(\"Init done from HC\");\r\n        }, function (error) {\r\n            _this._readyMarker.error(error);\r\n        });\r\n    };\r\n    HCBridge.prototype.initReady = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._readyMarker.setCallback(function (err) {\r\n                if (!err) {\r\n                    resolve(_this);\r\n                }\r\n                else {\r\n                    _this._logger.error(\"Error initializing HC bridge - \" + err);\r\n                    reject(_this._readyMarker.getError());\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.ready = function () {\r\n        return this.initReady();\r\n    };\r\n    HCBridge.prototype._handleGenericEvents = function (event) {\r\n        this._processEventBySeq(event);\r\n    };\r\n    HCBridge.prototype._hcEventHandler = function (eventJson) {\r\n        this._logger.trace(eventJson);\r\n        var event = JSON.parse(eventJson);\r\n        this._processEventBySeq(event);\r\n    };\r\n    HCBridge.prototype._processEventBySeq = function (event) {\r\n        var seq = event.sequence;\r\n        if (seq === this._lastSeq + 1) {\r\n            // if this is the event we expect process it\r\n            this._processEvent(event);\r\n            this._lastSeq++;\r\n            // empty the next items in the queue - if any\r\n            var nextEvent = this._eventQueue[seq + 1];\r\n            if (!util.isUndefined(nextEvent)) {\r\n                this._logger.debug(\"replaying message number \" + seq);\r\n                this._processEventBySeq(nextEvent);\r\n                delete this._eventQueue[seq + 1];\r\n            }\r\n        }\r\n        else {\r\n            // save in the queue\r\n            this._eventQueue[seq] = event;\r\n            this._logger.debug(\"Got out of order event with number \" + seq + \". Will wait for previous event(s) before replaying.\");\r\n        }\r\n    };\r\n    HCBridge.prototype._processEvent = function (event) {\r\n        var _this = this;\r\n        if (event.genericEvent) {\r\n            this._processGenericEvent(event);\r\n            return;\r\n        }\r\n        var entityType = event.entityType;\r\n        var eventContext = this._convertContext(event.context);\r\n        var entity;\r\n        // Hack for Activities .NET api not delivering right context\r\n        if (event.context.type === entityEvent_1.EntityEventType.ActivityContextChange &&\r\n            (!this._htmlContainer.contextUpdateRaceFixed)) {\r\n            // When there is a context update, we will ask the container for all activities\r\n            // and use the context of the returned activity instead of the one we received from the update\r\n            // we should remove this hack once a fix in HC is deployed\r\n            this.getActivities()\r\n                .then(function (activities) {\r\n                var updated = event.context.updated;\r\n                var removed = event.context.removed;\r\n                var activityInEvent = _this._hcToJsActivity(event.entity);\r\n                var contextAsString = event.entity.context;\r\n                activities.forEach(function (activity) {\r\n                    if (activity.id !== activityInEvent.id) {\r\n                        return;\r\n                    }\r\n                    var hackEventContext = new entityEvent_1.ActivityContextChangedEventContext(contextAsString, updated, removed);\r\n                    _this._publishActivityStatusChange(activityInEvent, hackEventContext);\r\n                });\r\n            });\r\n            return;\r\n        }\r\n        switch (entityType) {\r\n            case this._activityTypeEntityName:\r\n                entity = HCBridge._hcToJsActivityType(event.entity);\r\n                this._publishActivityTypeStatusChange(entity, eventContext);\r\n                break;\r\n            case this._windowTypeEntityName:\r\n                entity = this._hcToJsWindowType(event.entity);\r\n                this._publishWindowTypeStatusChange(entity, eventContext);\r\n                break;\r\n            case this._activityEntityName:\r\n                entity = this._hcToJsActivity(event.entity);\r\n                this._publishActivityStatusChange(entity, eventContext);\r\n                break;\r\n            case this._windowEntityName:\r\n                entity = this._hcToJsWindow(event.entity);\r\n                this._publishActivityWindowEvent(entity, eventContext);\r\n                break;\r\n        }\r\n    };\r\n    HCBridge.prototype._processGenericEvent = function (event) {\r\n        var info = event.data;\r\n        if (event.type === \"ActivitiesAttached\") {\r\n            if (this._activitiesAttachedHandler) {\r\n                this._activitiesAttachedHandler(info);\r\n            }\r\n        }\r\n        else if (event.type === \"ActivitiesDetached\") {\r\n            if (this._activitiesDetached) {\r\n                this._activitiesDetached(info);\r\n            }\r\n        }\r\n        else if (event.type === \"ActivityAttachedDescriptorsRefreshed\") {\r\n            if (this._activityAttachedDescriptorsRefreshed) {\r\n                this._activityAttachedDescriptorsRefreshed(info);\r\n            }\r\n        }\r\n    };\r\n    HCBridge.prototype._convertContext = function (hcContext) {\r\n        if (hcContext.type === entityEvent_1.EntityEventType.StatusChange) {\r\n            var oldStatus = new activityStatus_1.ActivityStatus(hcContext.oldStatus.state, hcContext.oldStatus.statusMessage, hcContext.oldStatus.statusTime);\r\n            var newStatus = new activityStatus_1.ActivityStatus(hcContext.newStatus.state, hcContext.newStatus.statusMessage, hcContext.newStatus.statusTime);\r\n            return new entityEvent_1.ActivityStatusChangeEventContext(newStatus, oldStatus);\r\n        }\r\n        else if (hcContext.type === entityEvent_1.EntityEventType.ActivityWindowEvent) {\r\n            return new entityEvent_1.EntityEventContext(hcContext.event);\r\n        }\r\n        else if (hcContext.type === entityEvent_1.EntityEventType.ActivityContextChange) {\r\n            return new entityEvent_1.ActivityContextChangedEventContext(hcContext.newContext, hcContext.updated, hcContext.removed);\r\n        }\r\n        return new entityEvent_1.EntityEventContext(hcContext.type);\r\n    };\r\n    /**\r\n     *  Convert an Activity entity from HC to Activity\r\n     */\r\n    HCBridge.prototype._hcToJsActivity = function (hcAct) {\r\n        var window = hcAct.owner ? this._hcToJsWindow(hcAct.owner) : null;\r\n        var windowId = window ? window.id : null;\r\n        var status = new activityStatus_1.ActivityStatus(hcAct.status.state, hcAct.status.statusMessage, hcAct.status.statusTime);\r\n        var context = JSON.parse(hcAct.context);\r\n        return new activity_1.default(hcAct.id, hcAct.type.name, status, context, windowId);\r\n    };\r\n    /**\r\n     *  Convert a WindowType entity coming from HC to WindowType\r\n     */\r\n    HCBridge.prototype._hcToJsWindowType = function (hcWinType) {\r\n        var _this = this;\r\n        if (util.isUndefined(hcWinType.factories)) {\r\n            hcWinType.factories = [];\r\n        }\r\n        // lazy init\r\n        if (!this._appByWindowTypeGetter) {\r\n            if (!this._appManagerGetter) {\r\n                this._appByWindowTypeGetter = function () { return undefined; };\r\n            }\r\n            this._appByWindowTypeGetter = function (wt) {\r\n                var appMgr = _this._appManagerGetter();\r\n                return appMgr.applications().filter(function (app) { return app.activityWindowType === wt; })[0];\r\n            };\r\n        }\r\n        return new windowType_1.default(hcWinType.name, this._appByWindowTypeGetter);\r\n    };\r\n    // /** Convert a WindowFactory entity coming from HC to WindowFactory */\r\n    // static _hcToJsWindowTypeFactory(hcWinTypeFactory: any): WindowFactory {\r\n    //   return new ProxyWindowFactory(hcWinTypeFactory.description);\r\n    // }\r\n    HCBridge.prototype.getActivityTypes = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // get all from HC\r\n            _this._htmlContainer.getActivityTypes(function (infos) {\r\n                // transform to Activity Js Entities\r\n                var result = infos.map(function (info) { return HCBridge._hcToJsActivityType(info); });\r\n                resolve(result);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.registerActivityType = function (activityTypeName, ownerWindow, helperWindows, layoutConfig, description) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (helperWindows === undefined) {\r\n                helperWindows = [];\r\n            }\r\n            var config = {\r\n                name: activityTypeName,\r\n                ownerWindowType: ownerWindow,\r\n                helperWindowTypes: helperWindows,\r\n                description: description,\r\n                layoutConfig: JSON.stringify(layoutConfig)\r\n            };\r\n            // pass create request to HC\r\n            _this._htmlContainer.registerActivityType(JSON.stringify(config), function (info) {\r\n                // transform to Activity Js Entity\r\n                var newActivityType = HCBridge._hcToJsActivityType(info);\r\n                resolve(newActivityType);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.unregisterActivityType = function (activityTypeName) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // pass create request to HC\r\n            _this._htmlContainer.unregisterActivityType(activityTypeName, \r\n            /*( info )*/ function () {\r\n                resolve();\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.getWindowTypes = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // get all from HC\r\n            _this._htmlContainer.getWindowTypes(function (infos) {\r\n                // transform to Activity Js Entities\r\n                var result = infos.map(function (info) { return _this._hcToJsWindowType(info); });\r\n                resolve(result);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.registerWindowFactory = function (windowTypeName, factory, parameters) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(windowTypeName)) {\r\n                reject(\"windowTypeName should be provided\");\r\n                return;\r\n            }\r\n            // pass create request to HC\r\n            _this._htmlContainer.registerWindowFactory(windowTypeName, factory.create.bind(factory), \r\n            /*(info)*/ function () {\r\n                resolve();\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.initiateActivity = function (activityType, context, configuration) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(activityType)) {\r\n                reject(\"windowTypeName should be provided\");\r\n                return;\r\n            }\r\n            if (util.isUndefinedOrNull(context)) {\r\n                context = {};\r\n            }\r\n            // pass create request to HC\r\n            _this._htmlContainer.initiate(activityType, JSON.stringify(context), function (activityId) {\r\n                resolve(activityId);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.getAnnouncementInfo = function () {\r\n        var hc = window.htmlContainer;\r\n        var context = hc.getContext();\r\n        var result = { activityWindowId: \"\", activityWindowType: \"\", activityWindowIndependent: false, activityWindowName: \"\" };\r\n        if (!context.activityId) {\r\n            // in case we're not in activity just return. this will\r\n            // lead to window not registering itself\r\n            return result;\r\n        }\r\n        result.activityWindowType = context.activityWindowType;\r\n        if (util.isUndefined(result.activityWindowType)) {\r\n            result.activityWindowType = HCBridge._getURLParameter(\"activityWindowType\");\r\n        }\r\n        result.activityWindowId = context.activityWindowId;\r\n        if (util.isUndefined(result.activityWindowId)) {\r\n            result.activityWindowId = HCBridge._getURLParameter(\"activityWindowId\");\r\n        }\r\n        result.activityWindowIndependent = context.activityWindowIndependent;\r\n        if (util.isUndefined(result.activityWindowIndependent)) {\r\n            // TODO parse\r\n            // result.activityWindowIndependent = this._getURLParameter(\"activityWindowIndependent\");\r\n        }\r\n        result.activityWindowName = context.activityWindowName;\r\n        if (util.isUndefined(result.activityWindowName)) {\r\n            result.activityWindowName = HCBridge._getURLParameter(\"activityWindowName\");\r\n        }\r\n        return result;\r\n    };\r\n    HCBridge.prototype.announceWindow = function (windowType, activityWindowId) {\r\n        var _this = this;\r\n        if (util.isUndefined(windowType)) {\r\n            throw new Error(\"can not determine window type\");\r\n        }\r\n        if (util.isUndefined(windowType)) {\r\n            throw new Error(\"can not determine window activityWindowId\");\r\n        }\r\n        this._htmlContainer.announceWindow(windowType, activityWindowId, function (error) {\r\n            _this._logger.error(\"Error announcing activity window with id '\" + activityWindowId + \"'. \" + error);\r\n        });\r\n    };\r\n    HCBridge.prototype.getActivities = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // get all from HC\r\n            _this._logger.trace(\"Executing getActivities()\");\r\n            _this._htmlContainer.getActivities(function (activitiesStr) {\r\n                // transform to Activity Js Entities\r\n                _this._logger.trace(\"Got getActivities() :\" + activitiesStr);\r\n                var activities = JSON.parse(activitiesStr);\r\n                var result = activities.map(function (act) { return _this._hcToJsActivity(act); });\r\n                resolve(result);\r\n            }, function (error) {\r\n                _this._logger.trace(\"Error in getActivities() :\" + error);\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.updateActivityContext = function (activity, context, fullReplace, removedKeys) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (util.isUndefined(removedKeys)) {\r\n                removedKeys = [];\r\n            }\r\n            var options = {\r\n                fullReplace: fullReplace,\r\n                removedKeys: removedKeys\r\n            };\r\n            _this._htmlContainer.setActivityContext(activity.id, JSON.stringify(context), JSON.stringify(options), function (newContextString) {\r\n                // receives the new context as string\r\n                var newContext = JSON.parse(newContextString);\r\n                resolve(newContext);\r\n            }, function (error) { return reject(error); });\r\n        });\r\n    };\r\n    HCBridge.prototype.getActivityWindows = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // get all from HC\r\n            _this._htmlContainer.getWindows(function (windows) {\r\n                // transform to Activity Js Entities\r\n                var result = windows.map(function (wind) { return _this._hcToJsWindow(wind); });\r\n                resolve(result);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.stopActivity = function (activity) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.stopActivity(activity.id, function (result) {\r\n                resolve(result);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.unregisterWindowFactory = function (windowTypeName) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.registerWindowFactory(windowTypeName, \r\n            /*(info)*/ function () {\r\n                resolve();\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.createWindow = function (id, windowDefinition) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var objToSend = windowDefinition;\r\n            var functionToUse = _this._htmlContainer.createWindow2;\r\n            if (!functionToUse) {\r\n                functionToUse = _this._htmlContainer.createWindow;\r\n                objToSend = JSON.stringify(windowDefinition);\r\n            }\r\n            functionToUse(id, objToSend, function (newId) {\r\n                resolve(newId);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.createStackedWindows = function (id, windowDefinitions, timeout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var objToSend = windowDefinitions;\r\n            var functionToUse = _this._htmlContainer.createStackedWindows2;\r\n            if (!functionToUse) {\r\n                functionToUse = _this._htmlContainer.createStackedWindows;\r\n                objToSend = JSON.stringify(windowDefinitions);\r\n            }\r\n            functionToUse(id, objToSend, timeout, function (newId) {\r\n                resolve(newId);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.onActivityTypeStatusChange = function (callback) {\r\n        this._activityTypeCallbacks.push(callback);\r\n    };\r\n    HCBridge.prototype.onWindowTypeStatusChange = function (callback) {\r\n        this._windowTypeCallbacks.push(callback);\r\n    };\r\n    HCBridge.prototype.onActivityStatusChange = function (callback) {\r\n        this._activityCallbacks.push(callback);\r\n    };\r\n    HCBridge.prototype.onActivityWindowChange = function (callback) {\r\n        this._windowCallbacks.push(callback);\r\n    };\r\n    HCBridge.prototype.getWindowBounds = function (id) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.getWindowBounds(id, function (bounds) {\r\n                resolve(bounds);\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.setWindowBounds = function (id, bounds) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.setWindowBounds(id, JSON.stringify(bounds), function () {\r\n                resolve();\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.registerWindow = function (type, name, independent) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.registerWindow(type, name, independent, function (id) {\r\n                resolve(id);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.closeWindow = function (id) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.closeWindow(id, function () {\r\n                resolve();\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.activateWindow = function (id, focus) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.activateWindow(id, focus, function () {\r\n                resolve();\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.setWindowVisibility = function (id, visible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.setWindowVisibility(id, visible, function () {\r\n                resolve();\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.cloneActivity = function (id, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.cloneActivity(id, options, function (activityId) {\r\n                resolve(activityId);\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype._publishStatusChange = function (entity, context, callbacks) {\r\n        var entityEvent = new entityEvent_1.EntityEvent(entity, context);\r\n        callbacks.forEach(function (callback) {\r\n            callback(entityEvent);\r\n        });\r\n    };\r\n    HCBridge.prototype._publishActivityTypeStatusChange = function (at, context) {\r\n        this._publishStatusChange(at, context, this._activityTypeCallbacks);\r\n    };\r\n    HCBridge.prototype._publishWindowTypeStatusChange = function (wt, context) {\r\n        this._publishStatusChange(wt, context, this._windowTypeCallbacks);\r\n    };\r\n    HCBridge.prototype._publishActivityStatusChange = function (act, context) {\r\n        this._publishStatusChange(act, context, this._activityCallbacks);\r\n    };\r\n    HCBridge.prototype._publishActivityWindowEvent = function (w, context) {\r\n        this._publishStatusChange(w, context, this._windowCallbacks);\r\n    };\r\n    HCBridge.prototype.attachActivities = function (from, to, tag) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.attachActivities(from, to, tag, function (state) {\r\n                resolve(state);\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.detachActivities = function (activityId, newActivityInfo) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this._htmlContainer.detachActivities(activityId, newActivityInfo, function (newActivityId) {\r\n                resolve(newActivityId);\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    HCBridge.prototype.onActivitiesAttached = function (callback) {\r\n        this._activitiesAttachedHandler = callback;\r\n    };\r\n    HCBridge.prototype.onActivitiesDetached = function (callback) {\r\n        this._activitiesDetached = callback;\r\n    };\r\n    HCBridge.prototype.onActivityAttachedDescriptorsRefreshed = function (callback) {\r\n        this._activityAttachedDescriptorsRefreshed = callback;\r\n    };\r\n    HCBridge.prototype.getAttachedDescriptors = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!_this._htmlContainer.getAttachedDescriptors) {\r\n                // support for container that does not have descriptors\r\n                resolve([]);\r\n                return;\r\n            }\r\n            _this._htmlContainer.getAttachedDescriptors(function (result) {\r\n                resolve(result);\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     *  Convert a ActivityWindow entity coming from HC to ActivityWindow\r\n     */\r\n    HCBridge.prototype._hcToJsWindow = function (hcWindow) {\r\n        var _this = this;\r\n        var windowGetter = function () { return undefined; };\r\n        if (this._windows) {\r\n            if (hcWindow.hcWindowId) {\r\n                windowGetter = function () { return _this._windows.list().filter(function (w) { return w.id === hcWindow.hcWindowId; })[0]; };\r\n            }\r\n            else {\r\n                // backward compatibility for HC < 1.58\r\n                windowGetter = function () { return _this._windows.list().filter(function (w) { return w.application === hcWindow.instance.application; })[0]; };\r\n            }\r\n        }\r\n        return new activityWindow_1.default(hcWindow.id, hcWindow.name, hcWindow.type, hcWindow.activityId, hcWindow.instance, hcWindow.isIndependent, windowGetter, hcWindow.hcWindowId);\r\n    };\r\n    return HCBridge;\r\n}());\r\nexports.default = HCBridge;\r\n//# sourceMappingURL=hcBridge.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/bridges/hcBridge.js\n// module id = 12\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * @typedef {Object} activityStatus Defines activity instance status\r\n * @property {string} state Current state\r\n * @property {string} message Message\r\n * @property {Date} time Time of the last status update\r\n */\r\nvar ActivityStatus = /** @class */ (function () {\r\n    function ActivityStatus(state, message, time) {\r\n        this.state = state;\r\n        this.message = message;\r\n        this.time = time;\r\n    }\r\n    ActivityStatus.prototype.getState = function () {\r\n        return this.state;\r\n    };\r\n    ActivityStatus.prototype.getMessage = function () {\r\n        return this.message;\r\n    };\r\n    ActivityStatus.prototype.getTime = function () {\r\n        return this.time;\r\n    };\r\n    return ActivityStatus;\r\n}());\r\nexports.ActivityStatus = ActivityStatus;\r\n//# sourceMappingURL=activityStatus.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/contracts/activityStatus.js\n// module id = 13\n// module chunks = 0","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityEntity_1 = require(\"./activityEntity\");\r\nvar activityAGM_1 = require(\"../core/activityAGM\");\r\nvar attachedActivityDescriptor_1 = require(\"./attachedActivityDescriptor\");\r\nvar promiseExtensions_1 = require(\"../helpers/promiseExtensions\");\r\nvar util_1 = require(\"../helpers/util\");\r\n/**\r\n * Activity is an instance of an activity type just like an object is an instance of a class\r\n * in class-based languages (and just like John is an instance of a 'Person).\r\n *\r\n * Activity is often used as a synonym for activity instance.\r\n *\r\n * Each activity instance has a single owner window and can optionally have one or more helper windows.\r\n *\r\n * @module activity\r\n */\r\nvar Activity = /** @class */ (function (_super) {\r\n    __extends(Activity, _super);\r\n    function Activity(id, actType, status, context, ownerId) {\r\n        var _this = _super.call(this, id) || this;\r\n        _this._id = id;\r\n        _this._actType = actType;\r\n        _this._status = status;\r\n        _this._context = context;\r\n        _this._ownerId = ownerId;\r\n        _this._agm = new activityAGM_1.ActivityAGM(_this);\r\n        return _this;\r\n    }\r\n    Object.defineProperty(Activity.prototype, \"type\", {\r\n        /**\r\n         * Activity type\r\n         * @var {module:activityType} type\r\n         */\r\n        get: function () {\r\n            if (this._manager) {\r\n                return this._manager.getActivityType(this._actType);\r\n            }\r\n            return undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"context\", {\r\n        /**\r\n         * Get current activity context. To update use updateContext , to replace setContext\r\n         * @var {object} context\r\n         */\r\n        get: function () {\r\n            return this._context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"status\", {\r\n        /**\r\n         * Get activity status\r\n         * @var {activityStatus} status\r\n         */\r\n        get: function () {\r\n            return this._status;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"owner\", {\r\n        /**\r\n         * The owner window\r\n         * @var {module:activityWindow} owner\r\n         */\r\n        get: function () {\r\n            if (!this._ownerId) {\r\n                return null;\r\n            }\r\n            return this._manager.getWindows({ id: this._ownerId })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"windows\", {\r\n        /**\r\n         * All windows participating in the activity\r\n         * @var {module:activityWindow[]} windows\r\n         */\r\n        get: function () {\r\n            return this._manager.getWindows({ activityId: this._id });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(Activity.prototype, \"agm\", {\r\n        /**\r\n         * @var {module:activityAGM} agm\r\n         */\r\n        get: function () {\r\n            return this._agm;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Joins a specific window to the activity\r\n     *\r\n     * @private\r\n     * @function join\r\n     * @param window    The window to join\r\n     * @param callback  (Optional) Result callback\r\n     * @returns         Promise for ActivityWindow\r\n     */\r\n    Activity.prototype.addWindow = function (window, callback) {\r\n        return this._manager.addWindowToActivity(this, window, callback);\r\n    };\r\n    /**\r\n     * Creates a new window and joins it to the activity\r\n     *\r\n     * @function createWindow\r\n     * @param {string|windowDefinition} windowType The type of the window to be created\r\n     * @param callback\r\n     * @returns {Promise<module:activityWindow>}\r\n     */\r\n    Activity.prototype.createWindow = function (windowType, callback) {\r\n        return this._manager.createWindow(this, windowType, callback);\r\n    };\r\n    /**\r\n     * Creates a stacked set of windows and joins them to the\r\n     *\r\n     * @function createStackedWindows\r\n     * @param {string[] | windowDefinition[]} windowTypes The types of the windows to be created\r\n     * @param {number} timeout\r\n     * @param callback\r\n     * @returns {Promise<module:activityWindow[]>}\r\n     */\r\n    Activity.prototype.createStackedWindows = function (windowTypes, timeout, callback) {\r\n        return this._manager.createStackedWindows(this, windowTypes, timeout, callback);\r\n    };\r\n    /**\r\n     * Removes a window from the activity\r\n     *\r\n     * @private\r\n     * @param window\r\n     * @param callback\r\n     * @returns     Promise for ActivityWindow\r\n     */\r\n    Activity.prototype.leave = function (window, callback) {\r\n        return this._manager.leaveWindowFromActivity(this, window, callback);\r\n    };\r\n    /**\r\n     * Get all windows participating in the activity from a given type\r\n     *\r\n     * @param {string} windowType\r\n     * @returns {module:activityWindow[]}\r\n     */\r\n    Activity.prototype.getWindowsByType = function (windowType) {\r\n        var filter = { activityId: this._id, type: windowType };\r\n        return this._manager.getWindows(filter);\r\n    };\r\n    /**\r\n     * Replaces the activity context with a new one.\r\n     *\r\n     * @function setContext\r\n     * @param {object} context   The new context\r\n     * @param callback\r\n     * @returns {Promise<Object>}\r\n     */\r\n    Activity.prototype.setContext = function (context, callback) {\r\n        return this._manager.setActivityContext(this, context, callback);\r\n    };\r\n    /**\r\n     * Updates activity context using the properties from the context argument.\r\n     * If old context is {a:1, b:2, c:3} and invoking updateContext({b:3, c:null}) will result a context\r\n     * be {a:1, b:3}\r\n     *\r\n     * @function updateContext\r\n     * @param {object} context\r\n     * @param callback\r\n     * @return {Promise<object>}\r\n     */\r\n    Activity.prototype.updateContext = function (context, callback) {\r\n        return this._manager.updateActivityContext(this, context, callback);\r\n    };\r\n    /**\r\n     * Subscribe for status change events\r\n     *\r\n     * @function onStatusChange\r\n     *\r\n     * @param {activityStatusChangeHandler} handler Handler function that will receive status notifications\r\n     */\r\n    Activity.prototype.onStatusChange = function (handler) {\r\n        var _this = this;\r\n        return this._manager.subscribeActivityEvents(function (a, ns, os) {\r\n            if (a.id === _this.id) {\r\n                handler(a, ns, os);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Subscribe for window related events, like joined, removed from activity\r\n     *\r\n     * @function onWindowEvent\r\n     * @param {windowEventHandler} handler Handler function that will receive windows events\r\n     */\r\n    Activity.prototype.onWindowEvent = function (handler) {\r\n        var _this = this;\r\n        return this._manager.subscribeWindowEvents(function (a, w, e) {\r\n            if (a.id === _this.id) {\r\n                handler(a, w, e);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Subscribe for context updates\r\n     *\r\n     * @function onContextChanged\r\n     * @param {contextChangedHandler} handler Handler function that will receive context related events\r\n     */\r\n    Activity.prototype.onContextChanged = function (handler) {\r\n        var _this = this;\r\n        this._manager.subscribeActivityContextChanged(function (act, context, updated, removed) {\r\n            if (act.id === _this.id) {\r\n                handler(context, updated, removed, act);\r\n            }\r\n        });\r\n        try {\r\n            // replay the context at the time of subscribing, swallow user exceptions\r\n            handler(this.context, this.context, [], this);\r\n        }\r\n        catch (e) {\r\n            return;\r\n        }\r\n    };\r\n    /**\r\n     * Stops the activity\r\n     * @function stop\r\n     */\r\n    Activity.prototype.stop = function () {\r\n        this._manager.stopActivity(this);\r\n    };\r\n    /**\r\n     * Clones the activity into a new one\r\n     * @function clone\r\n     * @param {CloneOptions} options\r\n     */\r\n    Activity.prototype.clone = function (options) {\r\n        return this._manager.clone(this, options);\r\n    };\r\n    Activity.prototype.attach = function (activity, tag) {\r\n        var activityId;\r\n        if (typeof activity === \"string\") {\r\n            activityId = activity;\r\n        }\r\n        else {\r\n            activityId = activity.id;\r\n        }\r\n        return this._manager.attachActivities(activityId, this.id, tag);\r\n    };\r\n    Activity.prototype.onActivityAttached = function (callback) {\r\n        var _this = this;\r\n        this._manager.subscribeActivitiesAttached(function (newActId, oldActId, descriptor) {\r\n            if (newActId !== _this._id) {\r\n                return;\r\n            }\r\n            callback(descriptor);\r\n        });\r\n    };\r\n    Activity.prototype.onDetached = function (callback) {\r\n        var _this = this;\r\n        this._manager.subscribeActivitiesDetached(function (newAct, originalActivity, state) {\r\n            if (originalActivity.id !== _this._id) {\r\n                return;\r\n            }\r\n            callback(newAct, state);\r\n        });\r\n    };\r\n    Activity.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        _super.prototype._updateCore.call(this, other);\r\n        util_1.ifNotUndefined(other._actType, function (x) { return _this._actType = x; });\r\n        util_1.ifNotUndefined(other._context, function (x) { return _this._context = x; });\r\n        util_1.ifNotUndefined(other._ownerId, function (x) { return _this._ownerId = x; });\r\n        if (other._status && (!this._status || (this._status.state !== other._status.state))) {\r\n            this._status = other._status;\r\n        }\r\n    };\r\n    Activity.prototype._updateDescriptors = function (allStates) {\r\n        var _this = this;\r\n        this._attached = allStates.map(function (s) {\r\n            return new attachedActivityDescriptor_1.AttachedActivityDescriptor(_this._manager, _this._id, s);\r\n        });\r\n    };\r\n    Object.defineProperty(Activity.prototype, \"attached\", {\r\n        get: function () {\r\n            return this._attached;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Activity.prototype.setFrameColor = function (color, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var callbacksToWait = _this.windows.length;\r\n            if (callbacksToWait === 0) {\r\n                resolve(_this);\r\n            }\r\n            _this.windows.forEach(function (w) {\r\n                w.underlyingWindow.setFrameColor(color, function () {\r\n                    callbacksToWait--;\r\n                    if (callbacksToWait <= 0) {\r\n                        resolve(_this);\r\n                    }\r\n                });\r\n            });\r\n            setTimeout(function () {\r\n                if (callbacksToWait > 0) {\r\n                    reject(_this.id + \" - timed out waiting for setFrameColor with\" + color);\r\n                }\r\n            }, 5000);\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    Activity.prototype.getFrameColor = function () {\r\n        if (!this.windows || this.windows.length === 0) {\r\n            return \"\";\r\n        }\r\n        return this.windows[0].underlyingWindow.frameColor;\r\n    };\r\n    return Activity;\r\n}(activityEntity_1.default));\r\nexports.default = Activity;\r\n//# sourceMappingURL=activity.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/entities/activity.js\n// module id = 14\n// module chunks = 0","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityEntity_1 = require(\"./activityEntity\");\r\nvar logger_1 = require(\"../helpers/logger\");\r\nvar util = require(\"../helpers/util\");\r\nvar util_1 = require(\"../helpers/util\");\r\nvar entityEvent_1 = require(\"../contracts/entityEvent\");\r\n/**\r\n * A window participating in an activity\r\n *\r\n * @module activityWindow\r\n */\r\nvar ActivityWindow = /** @class */ (function (_super) {\r\n    __extends(ActivityWindow, _super);\r\n    function ActivityWindow(id, name, type, activityId, instance, isIndependent, windowGetter, hcWindowId) {\r\n        var _this = _super.call(this, id) || this;\r\n        _this._logger = logger_1.Logger.Get(\"window\");\r\n        _this._type = type;\r\n        _this._activityId = activityId;\r\n        _this._name = name;\r\n        _this._instance = instance;\r\n        _this._isIndependent = isIndependent;\r\n        _this._windowGetter = windowGetter;\r\n        _this._hcWindowId = hcWindowId;\r\n        return _this;\r\n    }\r\n    /**\r\n     * Return window's title\r\n     * @function getBounds\r\n     * @return {Promise<WindowBounds>}\r\n     */\r\n    ActivityWindow.prototype.getBounds = function () {\r\n        return this._manager.getWindowBounds(this.id);\r\n    };\r\n    Object.defineProperty(ActivityWindow.prototype, \"name\", {\r\n        /**\r\n         * @var {string} name The window name\r\n         */\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"isIndependent\", {\r\n        /**\r\n         * @var {bool} isIndependent True if this is an independent window\r\n         */\r\n        get: function () {\r\n            return this._isIndependent;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"type\", {\r\n        /**\r\n         * @var {module:windowType} type The window type\r\n         */\r\n        get: function () {\r\n            if (this._manager) {\r\n                return this._manager.getWindowType(this._type);\r\n            }\r\n            return undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"activity\", {\r\n        /**\r\n         * @var {module:activity} activity The activity that the window is part of\r\n         */\r\n        get: function () {\r\n            if (util.isUndefined(this._activityId)) {\r\n                return undefined;\r\n            }\r\n            return this._manager.getActivityById(this._activityId);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"isOwner\", {\r\n        /**\r\n         * @var {bool} isOwner True if the window is the owner of the activity.\r\n         */\r\n        get: function () {\r\n            var act = this.activity;\r\n            if (util.isUndefined(act)) {\r\n                return false;\r\n            }\r\n            return act.owner.id === this.id;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Sets window's visibility\r\n     *\r\n     * @function setVisible\r\n     * @param {boolean} isVisible\r\n     * @returns {Promise<module:activityWindow>}\r\n     */\r\n    ActivityWindow.prototype.setVisible = function (isVisible, callback) {\r\n        return this._manager.setWindowVisibility(this.id, isVisible);\r\n    };\r\n    /**\r\n     * Activate window\r\n     * @function activate\r\n     * @param {boolean} focus If true then activate window with focus otherwise activate window without focus\r\n     */\r\n    ActivityWindow.prototype.activate = function (focus) {\r\n        return this._manager.activateWindow(this.id, focus);\r\n    };\r\n    /**\r\n     * Sets window's bounds\r\n     * @function setBounds\r\n     *\r\n     * @param {bounds} bounds The new bounds to be applied\r\n     * @returns  {Promise<module:activityWindow>}\r\n     */\r\n    ActivityWindow.prototype.setBounds = function (bounds, callback) {\r\n        return this._manager.setWindowBounds(this.id, bounds, callback);\r\n    };\r\n    /**\r\n     * Closes the window\r\n     *\r\n     * @function close\r\n     * @returns {Promise}\r\n     */\r\n    ActivityWindow.prototype.close = function () {\r\n        return this._manager.closeWindow(this.id);\r\n    };\r\n    Object.defineProperty(ActivityWindow.prototype, \"instance\", {\r\n        /**\r\n         * @var {agmInstance} instance The agm instance of that window. You can use this to invoke AGM methods against that window\r\n         */\r\n        get: function () {\r\n            return this._instance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityWindow.prototype, \"underlyingWindow\", {\r\n        /**\r\n         * Returns the window as object from Windows API (glue.windows).\r\n         *\r\n         * @var {window} underlyingWindow\r\n         */\r\n        get: function () {\r\n            var window = this._windowGetter();\r\n            if (!window) {\r\n                // we don't have the window object any more, let's return as much as we can\r\n                return {\r\n                    id: this._hcWindowId\r\n                };\r\n            }\r\n            return window;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityWindow.prototype.onActivityJoined = function (callback) {\r\n        this._subscribeForActivityWindowEvent(entityEvent_1.EntityEventType.ActivityWindowJoinedActivity, callback);\r\n    };\r\n    ActivityWindow.prototype.onActivityRemoved = function (callback) {\r\n        this._subscribeForActivityWindowEvent(entityEvent_1.EntityEventType.ActivityWindowLeftActivity, callback);\r\n    };\r\n    ActivityWindow.prototype._updateCore = function (other) {\r\n        var _this = this;\r\n        util_1.ifNotUndefined(other._activityId, function (x) { return _this._activityId = x; });\r\n        util_1.ifNotUndefined(other._isIndependent, function (x) { return _this._isIndependent = x; });\r\n        util_1.ifNotUndefined(other._hcWindowId, function (x) { return _this._hcWindowId = x; });\r\n        util_1.ifNotUndefined(other._type, function (x) { return _this._type = x; });\r\n        util_1.ifNotUndefined(other._name, function (x) { return _this._name = x; });\r\n        if (!util.isUndefinedOrNull(other._instance)) {\r\n            this._instance = other._instance;\r\n        }\r\n    };\r\n    ActivityWindow.prototype._subscribeForActivityWindowEvent = function (eventName, callback) {\r\n        var _this = this;\r\n        this._manager.subscribeWindowEvents(function (activity, window, event) {\r\n            // ignore events not related to this window\r\n            if (window.id !== _this.id) {\r\n                return;\r\n            }\r\n            if (event === eventName) {\r\n                callback(activity);\r\n            }\r\n        });\r\n    };\r\n    ActivityWindow.prototype._beforeDelete = function (other) {\r\n        this._hcWindowId = other._hcWindowId;\r\n    };\r\n    return ActivityWindow;\r\n}(activityEntity_1.default));\r\nexports.default = ActivityWindow;\r\n//# sourceMappingURL=activityWindow.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/entities/activityWindow.js\n// module id = 15\n// module chunks = 0","\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityEntity_1 = require(\"./activityEntity\");\r\n/**\r\n * A window type is a definition of a window, typically configured in ACS.\r\n *\r\n * @module windowType\r\n */\r\nvar WindowType = /** @class */ (function (_super) {\r\n    __extends(WindowType, _super);\r\n    function WindowType(name, appByWindowTypeGetter) {\r\n        var _this = _super.call(this, name) || this;\r\n        _this._name = name;\r\n        _this._appByWindowTypeGetter = appByWindowTypeGetter;\r\n        return _this;\r\n    }\r\n    Object.defineProperty(WindowType.prototype, \"name\", {\r\n        /**\r\n         * Name of the window type\r\n         * @var {string} name\r\n         */\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(WindowType.prototype, \"config\", {\r\n        /**\r\n         * Returns the ACS configuration related to this window type (as application object from AppManager API)\r\n         * @returns {any}\r\n         */\r\n        get: function () {\r\n            return this._appByWindowTypeGetter(this._name);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(WindowType.prototype, \"windows\", {\r\n        /**\r\n         * @var {activityWindow[]} windows All windows from that type\r\n         */\r\n        get: function () {\r\n            return this._manager.getWindows({ type: this._name });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowType.prototype.create = function (activity, configuration) {\r\n        var definition = Object.assign({ type: this.name, name: this.name, isIndependent: false }, configuration);\r\n        return this._manager.createWindow(activity, definition);\r\n    };\r\n    return WindowType;\r\n}(activityEntity_1.default));\r\nexports.default = WindowType;\r\n//# sourceMappingURL=windowType.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/entities/windowType.js\n// module id = 16\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar logger_1 = require(\"./logger\");\r\nvar util = require(\"../helpers/util\");\r\n/**\r\n * Class that can be used as a marker for successful completion of a set of events\r\n * @private\r\n * @module readyMarker\r\n */\r\nvar ReadyMarker = /** @class */ (function () {\r\n    /**\r\n     * Creates new marker\r\n     * @param name Name of the marker, useful in logging\r\n     * @param signalsToWait Number of signals(events) that needs to be signaled (completed) before the marker is set as completed\r\n     */\r\n    function ReadyMarker(name, signalsToWait) {\r\n        this._logger = logger_1.Logger.Get(\"ReadyMarker [\" + name + \"]\");\r\n        this._logger.debug(\"Initializing ready marker for '\" + name + \"' with \" + signalsToWait + \" signals to wait\");\r\n        if (signalsToWait <= 0) {\r\n            throw new Error(\"Invalid signal number. Should be > 0\");\r\n        }\r\n        this._signals = signalsToWait;\r\n        this._callbacks = [];\r\n        this._name = name;\r\n    }\r\n    /**\r\n     * Adds a new callback that will be notified when the events are completed (success) or some error happened\r\n     */\r\n    ReadyMarker.prototype.setCallback = function (callback) {\r\n        if (this.isSet()) {\r\n            callback(undefined);\r\n            return;\r\n        }\r\n        else if (this.isError()) {\r\n            callback(this._error);\r\n            return;\r\n        }\r\n        this._callbacks.push(callback);\r\n    };\r\n    /**\r\n     * Signals for a completion of an event. If this is the last event success callbacks will be called\r\n     */\r\n    ReadyMarker.prototype.signal = function (message) {\r\n        this._logger.debug(\"Signaled - \" + message + \" - signals left \" + (this._signals - 1));\r\n        this._signals--;\r\n        if (this._signals < 0) {\r\n            throw new Error(\"Error in ready marker '\" + this._name + \" - signals are \" + this._signals);\r\n        }\r\n        if (this.isSet()) {\r\n            this._callbacks.forEach(function (callback) {\r\n                callback(undefined);\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Signals for an error in some of the events. This will notify all callbacks that the marker has failed\r\n     */\r\n    ReadyMarker.prototype.error = function (error) {\r\n        this._error = error;\r\n        this._callbacks.forEach(function (errorCallback) {\r\n            errorCallback(error);\r\n        });\r\n    };\r\n    /**\r\n     * Checks if the marker is set (completed)\r\n     */\r\n    ReadyMarker.prototype.isSet = function () {\r\n        if (this.isError()) {\r\n            return false;\r\n        }\r\n        return this._signals === 0;\r\n    };\r\n    /**\r\n     * Checks if the marker has failed (some of the events has failed)\r\n     */\r\n    ReadyMarker.prototype.isError = function () {\r\n        return !util.isUndefined(this._error);\r\n    };\r\n    /**\r\n     * Returns the last reported error (undefined if no error)\r\n     */\r\n    ReadyMarker.prototype.getError = function () {\r\n        return this._error;\r\n    };\r\n    return ReadyMarker;\r\n}());\r\nexports.ReadyMarker = ReadyMarker;\r\n//# sourceMappingURL=readyMarker.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/helpers/readyMarker.js\n// module id = 17\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar LayoutImpl = /** @class */ (function () {\r\n    function LayoutImpl(data) {\r\n        this.name = data.name;\r\n        this.type = data.type;\r\n        this.components = data.components;\r\n        this.context = data.context;\r\n        this.metadata = data.metadata;\r\n    }\r\n    return LayoutImpl;\r\n}());\r\nexports.default = LayoutImpl;\r\n//# sourceMappingURL=layout.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/layouts/layout.js\n// module id = 18\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n// provides a unified way to access layouts array\r\nvar LayoutStore = /** @class */ (function () {\r\n    function LayoutStore() {\r\n        this.layouts = [];\r\n    }\r\n    LayoutStore.prototype.removeWhere = function (condition) {\r\n        this.layouts = this.layouts.filter(condition);\r\n    };\r\n    LayoutStore.prototype.add = function (item) {\r\n        this.layouts.push(item);\r\n    };\r\n    Object.defineProperty(LayoutStore.prototype, \"all\", {\r\n        get: function () {\r\n            return this.layouts;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LayoutStore.prototype.where = function (condition) {\r\n        return this.layouts.filter(condition);\r\n    };\r\n    LayoutStore.prototype.first = function (condition) {\r\n        return this.where(condition)[0];\r\n    };\r\n    return LayoutStore;\r\n}());\r\nexports.LayoutStore = LayoutStore;\r\nexports.default = new LayoutStore();\r\n//# sourceMappingURL=store.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/layouts/store.js\n// module id = 19\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n// A simple transformation that makes object to start with lowercase\r\n// Note that this is not full implementation as it supports only:\r\n// undefined, null, arrays, number, string, bool. Anything out of this\r\n// list is considered Object\r\nfunction transformACSLayout(something) {\r\n    if (!something) {\r\n        return something;\r\n    }\r\n    if (Array.isArray(something)) {\r\n        return something.map(function (item) {\r\n            return transformACSLayout(item);\r\n        });\r\n    }\r\n    if (typeof something === \"string\" || typeof something === \"number\" || typeof something === \"boolean\") {\r\n        return something;\r\n    }\r\n    var initial = {};\r\n    return Object.keys(something).reduce(function (accumulator, current) {\r\n        var value = something[current];\r\n        var convertedValue = transformACSLayout(value);\r\n        var key = current;\r\n        if (current[0].toLowerCase() !== current[0]) {\r\n            key = current[0].toLowerCase() + current.substr(1);\r\n        }\r\n        accumulator[key] = convertedValue;\r\n        return accumulator;\r\n    }, initial);\r\n}\r\nexports.default = transformACSLayout;\r\n//# sourceMappingURL=transform.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/layouts/transform.js\n// module id = 20\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar store_1 = require(\"../store\");\r\nfunction getWindowsByTabGroupId(windowId, tabGroupId) {\r\n    var windows = store_1.default.list;\r\n    return Object.keys(windows).reduce(function (memo, id) {\r\n        var win = windows[id];\r\n        if (win.API.tabGroupId === tabGroupId && win.API.id !== windowId) {\r\n            memo[id] = win;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nexports.getWindowsByTabGroupId = getWindowsByTabGroupId;\r\n//# sourceMappingURL=helpers.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/environment/helpers.js\n// module id = 21\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = require(\"callback-registry\");\r\nvar store_1 = require(\"./store\");\r\nexports.default = (function (id, options, executor, logger, appManagerGetter) {\r\n    var _registry = callback_registry_1.default();\r\n    var _logger = logger.subLogger(\"window \" + id);\r\n    var _name = options.name;\r\n    var _mode = options.mode;\r\n    var _url = options.url;\r\n    var _title = options.title;\r\n    var _context = options.context || {};\r\n    var _bounds = options.bounds;\r\n    var _frameColor = options.frameColor;\r\n    var _focus = options.focus;\r\n    var _neighbours = options.neighbours || {};\r\n    var _groupId = options.groupId;\r\n    var _isGroupHeaderVisible = options.isGroupHeaderVisible;\r\n    var _isTabHeaderVisible = options.isTabHeaderVisible;\r\n    var _isTabSelected = options.isTabSelected;\r\n    var _settings = options.settings;\r\n    // is Window visible\r\n    var _isVisible = options.isVisible;\r\n    // Window state Collapsed | Expanded\r\n    var isCollapsed = options.isCollapsed;\r\n    // Window state normal | maximized | minimized\r\n    var _windowState = options.state;\r\n    // tabGroupId only for window with 'Tab' mode\r\n    var _tabGroupId = options.tabGroupId;\r\n    // window is locked or unlocked;\r\n    var _isLocked = options.isLocked;\r\n    var _group;\r\n    var resultWindow;\r\n    // Holding all frame buttons\r\n    var _frameButtons = [];\r\n    //#region \"AGM methods\"\r\n    function close(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.close(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function navigate(newUrl, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.navigate(resultWindow, newUrl)\r\n                .then(function () {\r\n                if (newUrl === _url) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onUrlChanged(function (url, win) {\r\n                    if (win.id === id && url === win.url) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setStyle(style, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setStyle(resultWindow, style)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setTitle(newTitle, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setTitle(resultWindow, newTitle)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n        // OPTION 2\r\n        // const promise = executor.setTitle(resultWindow, newTitle)\r\n        // return promisify\r\n    }\r\n    function moveResize(dimensions, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.moveResize(resultWindow, dimensions)\r\n                .then(function () {\r\n                var areHeightsEqual = dimensions.height ? _bounds.height === dimensions.height : true;\r\n                var areWidthsEqual = dimensions.width ? _bounds.width === dimensions.width : true;\r\n                var areLeftsEqual = dimensions.left ? _bounds.left === dimensions.left : true;\r\n                var areTopsEqual = dimensions.top ? _bounds.top === dimensions.top : true;\r\n                if (areHeightsEqual &&\r\n                    areWidthsEqual &&\r\n                    areLeftsEqual &&\r\n                    areTopsEqual) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onBoundsChanged(function (win) {\r\n                    areHeightsEqual = dimensions.height ? win.bounds.height === dimensions.height : true;\r\n                    areWidthsEqual = dimensions.width ? win.bounds.width === dimensions.width : true;\r\n                    areLeftsEqual = dimensions.left ? win.bounds.left === dimensions.left : true;\r\n                    areTopsEqual = dimensions.top ? win.bounds.top === dimensions.top : true;\r\n                    if (win.id === resultWindow.id &&\r\n                        areHeightsEqual &&\r\n                        areWidthsEqual &&\r\n                        areLeftsEqual &&\r\n                        areTopsEqual) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function addFrameButton(buttonInfo, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof buttonInfo === \"undefined\") {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No button info\");\r\n                    return;\r\n                }\r\n                reject(\"No button info\");\r\n                return;\r\n            }\r\n            if (buttonInfo.buttonId === undefined) {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No buttonId\");\r\n                    return;\r\n                }\r\n                reject(\"No buttonId\");\r\n                return;\r\n            }\r\n            if (buttonInfo.imageBase64 === undefined) {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No imageBase64\");\r\n                    return;\r\n                }\r\n                reject(\"No imageBase64\");\r\n                return;\r\n            }\r\n            executor.addFrameButton(resultWindow, buttonInfo)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function removeFrameButton(buttonId, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (buttonId === undefined || buttonId === \"\") {\r\n                if (typeof error === \"function\") {\r\n                    error(\"No buttonId\");\r\n                    return;\r\n                }\r\n                reject(\"No buttonId\");\r\n                return;\r\n            }\r\n            executor.removeFrameButton(resultWindow, buttonId)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function activate(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.activate(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function focus(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.focus(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function maximizeRestore(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var currEvent = _windowState === \"normal\" ? onMaximized : onNormal;\r\n            executor.maximizeRestore(resultWindow)\r\n                .then(function () {\r\n                var un = currEvent(function () {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    if (un) {\r\n                        un();\r\n                    }\r\n                    resolve(resultWindow);\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function maximize(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.maximize(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"maximized\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onMaximized(function (win) {\r\n                    if (win.id === id && win.state === \"maximized\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function restore(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.restore(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"normal\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onNormal(function (win) {\r\n                    if (id === win.id && win.state === \"normal\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function minimize(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.minimize(resultWindow)\r\n                .then(function () {\r\n                if (_windowState === \"minimized\") {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onMinimized(function (win) {\r\n                    if (id === win.id && win.state === \"minimized\") {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        return resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function collapse(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (isCollapsed) {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                return resolve(resultWindow);\r\n            }\r\n            executor.collapse(resultWindow)\r\n                .then(function () {\r\n                if (isCollapsed) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onCollapsed(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function expand(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            if (!isCollapsed) {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                return resolve(resultWindow);\r\n            }\r\n            executor.expand(resultWindow)\r\n                .then(function () {\r\n                if (!isCollapsed) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onExpanded(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function toggleCollapse(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var currEvent = isCollapsed ? onExpanded : onCollapsed;\r\n            executor.toggleCollapse(resultWindow)\r\n                .then(function () {\r\n                currEvent(function (win) {\r\n                    if (win.id === id) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function snap(target, direction, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.snap(resultWindow, target, direction)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function attachTab(tab, index, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId;\r\n            var targetWindowId = resultWindow.id;\r\n            var errorMessage = \"Invalid tab parameter - should be an object with property id or a string. Invoked for source window id:\" + resultWindow.id;\r\n            if (!tab) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof tab === \"string\") {\r\n                sourceWindowId = tab;\r\n            }\r\n            else if (typeof tab.id !== \"undefined\") {\r\n                sourceWindowId = tab.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var argsForSend = {\r\n                sourceWindowId: sourceWindowId,\r\n                targetWindowId: targetWindowId,\r\n            };\r\n            if (index) {\r\n                argsForSend.index = index;\r\n            }\r\n            var sourceWin = store_1.default.get(argsForSend.sourceWindowId).API;\r\n            var un = sourceWin.onAttached(function (win) {\r\n                if (win.id === sourceWin.id) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    un();\r\n                    resolve(resultWindow);\r\n                }\r\n            });\r\n            executor.attachTab(resultWindow, argsForSend)\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                un();\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function detachTab(opt, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var argsForSend = { windowId: resultWindow.id };\r\n            var _options = opt || {};\r\n            if (typeof _options.relativeTo !== \"undefined\") {\r\n                if (typeof _options.relativeTo === \"string\") {\r\n                    argsForSend.relativeTo = _options.relativeTo;\r\n                }\r\n                else if (typeof _options.relativeTo.id !== \"undefined\") {\r\n                    argsForSend.relativeTo = _options.relativeTo.id;\r\n                }\r\n                if (typeof _options.relativeDirection !== \"undefined\") {\r\n                    argsForSend.relativeDirection = _options.relativeDirection;\r\n                }\r\n                if (typeof _options.width !== \"undefined\") {\r\n                    argsForSend.width = _options.width;\r\n                }\r\n                if (typeof _options.height !== \"undefined\") {\r\n                    argsForSend.height = _options.height;\r\n                }\r\n            }\r\n            if (typeof _options.bounds !== \"undefined\") {\r\n                argsForSend.bounds = _options.bounds;\r\n            }\r\n            if (typeof _options.hideTabHeader !== \"undefined\") {\r\n                argsForSend.hideTabHeader = _options.hideTabHeader;\r\n            }\r\n            var visibilityChangeHeard = false;\r\n            var detachedHeard = false;\r\n            var unVisibility = _registry.add(\"frame-attached\", (function (win) {\r\n                var isVisibilityCorrect = _options.hideTabHeader === undefined || _options.hideTabHeader !== win.isTabHeaderVisible;\r\n                if (id === win.id && isVisibilityCorrect) {\r\n                    visibilityChangeHeard = true;\r\n                    unVisibility();\r\n                    if (detachedHeard) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                        if (typeof unDetached === \"function\") {\r\n                            unDetached();\r\n                        }\r\n                    }\r\n                }\r\n            }));\r\n            var unDetached = onDetached(function (win) {\r\n                if (id === win.id) {\r\n                    detachedHeard = true;\r\n                    unDetached();\r\n                    if (visibilityChangeHeard) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        resolve(resultWindow);\r\n                        if (typeof unVisibility === \"function\") {\r\n                            unVisibility();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            executor.detachTab(resultWindow, argsForSend)\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                unDetached();\r\n                unVisibility();\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setVisible(toBeVisible, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setVisible(resultWindow, toBeVisible)\r\n                .then(function () {\r\n                var isVisibilityCorrect = toBeVisible === undefined ? _isVisible === true : _isVisible === toBeVisible;\r\n                if (isVisibilityCorrect) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onVisibilityChanged(function (win) {\r\n                    isVisibilityCorrect = toBeVisible === undefined ? win.isVisible === true : win.isVisible === toBeVisible;\r\n                    if (win.id === id && isVisibilityCorrect) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function showLoader(loader) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.showLoader(resultWindow, loader)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function hideLoader() {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.hideLoader(resultWindow)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function updateContext(context, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.updateContext(resultWindow, context)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function lock(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.lock(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function unlock(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.unlock(resultWindow)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function getIcon(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            // agm.invoke(\"T42.Wnd.GetIcon\", { windowId: resultWindow.id }, \"best\", {}, successHandler, error);\r\n            executor.getIcon(resultWindow)\r\n                .then(function (icon) {\r\n                if (typeof success === \"function\") {\r\n                    success(icon);\r\n                }\r\n                resolve(icon);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setIcon(base64Image, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setIcon(resultWindow, base64Image)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setFrameColor(frameColor, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setFrameColor(resultWindow, frameColor)\r\n                .then(function () {\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function setTabHeaderVisible(toBeTabHeaderVisible, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setTabHeaderVisible(resultWindow, toBeTabHeaderVisible)\r\n                .then(function () {\r\n                if (_isTabHeaderVisible === toBeTabHeaderVisible) {\r\n                    if (typeof success === \"function\") {\r\n                        success(resultWindow);\r\n                    }\r\n                    return resolve(resultWindow);\r\n                }\r\n                var un = onTabHeaderVisibilityChanged(function (win) {\r\n                    if (win.id === id && win.isTabHeaderVisible === toBeTabHeaderVisible) {\r\n                        if (typeof success === \"function\") {\r\n                            success(resultWindow);\r\n                        }\r\n                        un();\r\n                        resolve(resultWindow);\r\n                    }\r\n                });\r\n            })\r\n                .catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    //#endregion \"AGM methods\"\r\n    //#region \"Events\"\r\n    function onTitleChanged(callback) {\r\n        callback(resultWindow.title, resultWindow);\r\n        return _registry.add(\"onTitleChanged\", callback);\r\n    }\r\n    function onClose(callback) {\r\n        return _registry.add(\"onClose\", callback);\r\n    }\r\n    function onUrlChanged(callback) {\r\n        return _registry.add(\"onUrlChanged\", callback);\r\n    }\r\n    function onFrameButtonAdded(callback) {\r\n        return _registry.add(\"onFrameButtonAdded\", callback);\r\n    }\r\n    function onFrameButtonRemoved(callback) {\r\n        return _registry.add(\"onFrameButtonRemoved\", callback);\r\n    }\r\n    function onFrameButtonClicked(callback) {\r\n        return _registry.add(\"onFrameButtonClicked\", callback);\r\n    }\r\n    function onCollapsed(callback) {\r\n        if (isCollapsed) {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"collapsed\", callback);\r\n    }\r\n    function onExpanded(callback) {\r\n        if (!isCollapsed) {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"expanded\", callback);\r\n    }\r\n    function onMaximized(callback) {\r\n        if (_windowState === \"maximized\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"maximized\", callback);\r\n    }\r\n    function onMinimized(callback) {\r\n        if (_windowState === \"minimized\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"minimized\", callback);\r\n    }\r\n    function onNormal(callback) {\r\n        if (_windowState === \"normal\") {\r\n            callback(resultWindow);\r\n        }\r\n        return _registry.add(\"normal\", callback);\r\n    }\r\n    function onAttached(callback) {\r\n        return _registry.add(\"attached\", callback);\r\n    }\r\n    function onDetached(callback) {\r\n        return _registry.add(\"detached\", callback);\r\n    }\r\n    function onVisibilityChanged(callback) {\r\n        return _registry.add(\"visibility-changed\", callback);\r\n    }\r\n    function onContextUpdated(callback) {\r\n        return _registry.add(\"context-updated\", callback);\r\n    }\r\n    function onLockingChanged(callback) {\r\n        return _registry.add(\"lock-changed\", callback);\r\n    }\r\n    function onBoundsChanged(callback) {\r\n        return _registry.add(\"bounds-changed\", callback);\r\n    }\r\n    function onFocusChanged(callback) {\r\n        return _registry.add(\"focus-changed\", callback);\r\n    }\r\n    function onFrameColorChanged(callback) {\r\n        return _registry.add(\"frame-color-changed\", callback);\r\n    }\r\n    function onTabHeaderVisibilityChanged(callback) {\r\n        return _registry.add(\"tab-header-visibility-changed\", callback);\r\n    }\r\n    function onWindowAttached(callback) {\r\n        return _registry.add(\"window-attached\", callback);\r\n    }\r\n    function onWindowDetached(callback) {\r\n        return _registry.add(\"window-detached\", callback);\r\n    }\r\n    function onGroupChanged(callback) {\r\n        return _registry.add(\"group-changed\", callback);\r\n    }\r\n    function onTabSelectionChanged(callback) {\r\n        return _registry.add(\"tab-selection-changed\", callback);\r\n    }\r\n    //#endregion \"Events\"\r\n    //#region \"Stream function\"\r\n    function handleTitleChanged(newTitle) {\r\n        _title = newTitle;\r\n        _registry.execute(\"onTitleChanged\", newTitle, resultWindow);\r\n    }\r\n    function handleUrlChanged(newUrl) {\r\n        _url = newUrl;\r\n        _registry.execute(\"onUrlChanged\", newUrl, resultWindow);\r\n    }\r\n    function handleVisibilityChanged(isVisible) {\r\n        if (isVisible === _isVisible) {\r\n            return;\r\n        }\r\n        _isVisible = isVisible;\r\n        _registry.execute(\"visibility-changed\", resultWindow);\r\n    }\r\n    function handleWindowSettingsChanged(settings) {\r\n        _settings = settings;\r\n        _registry.execute(\"settings-changed\", resultWindow);\r\n    }\r\n    function handleContextUpdated(context) {\r\n        _context = context;\r\n        _registry.execute(\"context-updated\", _context, resultWindow);\r\n    }\r\n    function handleWindowClose() {\r\n        if (resultWindow.id === undefined) {\r\n            return;\r\n        }\r\n        resultWindow.id = undefined;\r\n        _registry.execute(\"onClose\", resultWindow);\r\n    }\r\n    function handleFrameButtonAdded(frameButton) {\r\n        var buttonObj = [\"buttonId\", \"imageBase64\", \"order\", \"tooltip\"].reduce(function (memo, k) {\r\n            memo[k] = frameButton[k];\r\n            return memo;\r\n        }, {});\r\n        var frameButtonsIds = _frameButtons.map(function (btn) {\r\n            return btn.buttonId;\r\n        });\r\n        if (frameButtonsIds.indexOf(frameButton.buttonId) === -1) {\r\n            _frameButtons.push(buttonObj);\r\n        }\r\n        _registry.execute(\"onFrameButtonAdded\", buttonObj, resultWindow);\r\n    }\r\n    function handleFrameButtonRemoved(frameButtonId) {\r\n        var button;\r\n        _frameButtons = _frameButtons.reduce(function (memo, btn) {\r\n            if (btn.buttonId === frameButtonId) {\r\n                button = btn;\r\n            }\r\n            else {\r\n                memo.push(btn);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (button !== undefined) {\r\n            _registry.execute(\"onFrameButtonRemoved\", button, resultWindow);\r\n        }\r\n    }\r\n    function handleFrameButtonClicked(frameButton) {\r\n        var button = _frameButtons.filter(function (btn) {\r\n            return btn.buttonId === frameButton.buttonId;\r\n        });\r\n        if (button.length > 0) {\r\n            _registry.execute(\"onFrameButtonClicked\", button[0], resultWindow);\r\n        }\r\n    }\r\n    function handleWindowChangeState(state) {\r\n        if (state === \"collapsed\") {\r\n            isCollapsed = true;\r\n        }\r\n        else if (state === \"expanded\") {\r\n            isCollapsed = false;\r\n        }\r\n        else {\r\n            _windowState = state;\r\n        }\r\n        _registry.execute(state, resultWindow);\r\n    }\r\n    function handleFrameIsLockedChanged(isLocked) {\r\n        _isLocked = isLocked;\r\n        _registry.execute(\"lock-changed\", resultWindow);\r\n    }\r\n    function handleBoundsChanged(bounds) {\r\n        if (_bounds.top === bounds.top && _bounds.left === bounds.left && _bounds.width === bounds.width && _bounds.height === bounds.height) {\r\n            return;\r\n        }\r\n        _bounds.top = bounds.top;\r\n        _bounds.left = bounds.left;\r\n        _bounds.width = bounds.width;\r\n        _bounds.height = bounds.height;\r\n        _registry.execute(\"bounds-changed\", resultWindow);\r\n    }\r\n    function handleFocusChanged(isFocused) {\r\n        _focus = isFocused;\r\n        _registry.execute(\"focus-changed\", resultWindow);\r\n    }\r\n    function handleFrameColorChanged(frameColor) {\r\n        _frameColor = frameColor;\r\n        _registry.execute(\"frame-color-changed\", resultWindow);\r\n    }\r\n    function handleFrameAttached(tabGroupId, isTabHeaderVisible) {\r\n        _tabGroupId = tabGroupId;\r\n        _isTabHeaderVisible = isTabHeaderVisible;\r\n        _registry.execute(\"frame-attached\", resultWindow);\r\n    }\r\n    function handleCompositionChanged(neighbours, groupId) {\r\n        _neighbours = neighbours || {};\r\n        _groupId = groupId;\r\n    }\r\n    function handleGroupHeaderVisibilityChanged(isGroupHeaderVisible) {\r\n        _isGroupHeaderVisible = isGroupHeaderVisible;\r\n    }\r\n    function handleTabHeaderVisibilityChanged(isTabHeaderVisible) {\r\n        if (_isTabHeaderVisible !== isTabHeaderVisible) {\r\n            _isTabHeaderVisible = isTabHeaderVisible;\r\n            _registry.execute(\"tab-header-visibility-changed\", resultWindow);\r\n        }\r\n    }\r\n    function handleFrameSelectionChanged(newWindow, prevWindow) {\r\n        var selectedWindow;\r\n        if (typeof newWindow !== \"undefined\" && newWindow === id) {\r\n            _isTabSelected = true;\r\n            selectedWindow = resultWindow;\r\n        }\r\n        else {\r\n            _isTabSelected = false;\r\n            selectedWindow = store_1.default.get(newWindow) ? store_1.default.get(newWindow).API : undefined;\r\n        }\r\n        var previousWindow = store_1.default.get(prevWindow) ? store_1.default.get(prevWindow).API : undefined;\r\n        if (_isTabSelected && previousWindow) {\r\n            var un_1 = previousWindow.onTabSelectionChanged(function (newWin, prevWin) {\r\n                if ((prevWin && prevWin.id) === previousWindow.id) {\r\n                    un_1();\r\n                    _registry.execute(\"tab-selection-changed\", selectedWindow, previousWindow, resultWindow);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            _registry.execute(\"tab-selection-changed\", selectedWindow, previousWindow, resultWindow);\r\n        }\r\n    }\r\n    function handleAttached(newTabGroupId, tabHeaderVisible) {\r\n        _tabGroupId = newTabGroupId;\r\n        _isTabHeaderVisible = tabHeaderVisible;\r\n        _registry.execute(\"attached\", resultWindow);\r\n    }\r\n    function handleWindowAttached(win) {\r\n        _registry.execute(\"window-attached\", win);\r\n    }\r\n    function handleDetached(tabGroupId) {\r\n        _tabGroupId = tabGroupId;\r\n        // this tabGroupId is always the same as the current one\r\n        // the tabGroupId is actually changed in the frame-attached event\r\n        var un = _registry.add(\"frame-attached\", function (win) {\r\n            if (win.id === id) {\r\n                un();\r\n                _registry.execute(\"detached\", resultWindow);\r\n            }\r\n        });\r\n    }\r\n    function handleWindowDetached(win) {\r\n        _registry.execute(\"window-detached\", win);\r\n    }\r\n    //#endregion \"Stream function\"\r\n    //#region \"Group Events\"\r\n    function handleGroupChanged(newGroup, oldGroup) {\r\n        logger.trace(\"handle group changed to win: \" + id + \" with group id: \" + newGroup.id);\r\n        _group = newGroup;\r\n        _groupId = newGroup.id;\r\n        _registry.execute(\"group-changed\", resultWindow, newGroup, oldGroup);\r\n    }\r\n    // This is used to set the relation from window to corespondent group API, it could be undefined, if the window is removed from group\r\n    function handleGroupAssociation(group) {\r\n        if (group) {\r\n            _logger.trace(\"setting group to win: \" + id + \" with group id: \" + group.id);\r\n        }\r\n        _group = group;\r\n    }\r\n    //#region \"Internal function\"\r\n    function getAllTabs() {\r\n        var allWindows = store_1.default.list;\r\n        if (_mode.toLowerCase() !== \"tab\") {\r\n            return [];\r\n        }\r\n        return Object.keys(allWindows).reduce(function (memo, win) {\r\n            var window = allWindows[win];\r\n            if (window\r\n                && window.API.tabGroupId\r\n                && typeof window.API.tabGroupId !== \"undefined\"\r\n                && typeof resultWindow.tabGroupId !== \"undefined\"\r\n                && window.API.tabGroupId === resultWindow.tabGroupId) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    }\r\n    function mapWindowIdsToWindowObjects(windowIdArr) {\r\n        return windowIdArr.reduce(function (memo, winId) {\r\n            var window = store_1.default.get(winId);\r\n            if (window) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n    }\r\n    function getNeighboursByDirection(direction) {\r\n        var windowIds = _neighbours[direction];\r\n        if (typeof windowIds !== \"undefined\") {\r\n            return mapWindowIdsToWindowObjects(windowIds);\r\n        }\r\n    }\r\n    function getApplicationName() {\r\n        if (_context._APPLICATION_NAME) {\r\n            return _context._APPLICATION_NAME;\r\n        }\r\n        if (_context && _context._t42 && _context._t42.application) {\r\n            return _context._t42.application;\r\n        }\r\n        var info = getWindowInfo();\r\n        if (!info) {\r\n            return undefined;\r\n        }\r\n        return info.applicationName;\r\n    }\r\n    function getWindowInfo() {\r\n        if (typeof window.glue42gd !== \"undefined\" && window.glue42gd.getWindowInfo) {\r\n            var info = window.glue42gd.getWindowInfo(id);\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            else {\r\n                return info;\r\n            }\r\n        }\r\n    }\r\n    //#endregion \"Internal function\"\r\n    //#region \"API\"\r\n    resultWindow = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get application() {\r\n            var appManager = appManagerGetter();\r\n            return appManager ? appManager.application(getApplicationName()) : undefined;\r\n        },\r\n        get hostInstance() {\r\n            return executor.hostInstance;\r\n        },\r\n        get agmInstance() {\r\n            var appName = getApplicationName();\r\n            return appName ? { application: appName } : undefined;\r\n        },\r\n        get url() {\r\n            return _url;\r\n        },\r\n        id: id,\r\n        get title() {\r\n            return _title;\r\n        },\r\n        get windowStyleAttributes() {\r\n            return _settings;\r\n        },\r\n        get settings() {\r\n            return _settings;\r\n        },\r\n        get tabGroupId() {\r\n            return _mode.toLowerCase() === \"tab\" ? _tabGroupId : undefined;\r\n        },\r\n        get frameButtons() {\r\n            return _frameButtons;\r\n        },\r\n        get mode() {\r\n            return _mode;\r\n        },\r\n        get state() {\r\n            return _windowState;\r\n        },\r\n        get isCollapsed() {\r\n            return isCollapsed;\r\n        },\r\n        get isVisible() {\r\n            return _isVisible;\r\n        },\r\n        get isLocked() {\r\n            return _isLocked;\r\n        },\r\n        get context() {\r\n            return _context;\r\n        },\r\n        get bounds() {\r\n            return _bounds;\r\n        },\r\n        get isFocused() {\r\n            return _focus;\r\n        },\r\n        get frameColor() {\r\n            return _frameColor;\r\n        },\r\n        get opened() {\r\n            return resultWindow.id !== undefined;\r\n        },\r\n        get group() {\r\n            return _group;\r\n        },\r\n        get groupId() {\r\n            return _groupId;\r\n        },\r\n        get topNeighbours() {\r\n            return getNeighboursByDirection(\"top\");\r\n        },\r\n        get leftNeighbours() {\r\n            return getNeighboursByDirection(\"left\");\r\n        },\r\n        get rightNeighbours() {\r\n            return getNeighboursByDirection(\"right\");\r\n        },\r\n        get bottomNeighbours() {\r\n            return getNeighboursByDirection(\"bottom\");\r\n        },\r\n        get isGroupHeaderVisible() {\r\n            return _isGroupHeaderVisible;\r\n        },\r\n        get activityId() {\r\n            if (_context._t42) {\r\n                return _context._t42.activityId;\r\n            }\r\n            var info = getWindowInfo();\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            return info.activityId;\r\n        },\r\n        get activityWindowId() {\r\n            if (_context._t42) {\r\n                return _context._t42.activityWindowId;\r\n            }\r\n            var info = getWindowInfo();\r\n            if (!info) {\r\n                return undefined;\r\n            }\r\n            return info.activityWindowId;\r\n        },\r\n        get windowType() {\r\n            return options.windowType || \"electron\";\r\n        },\r\n        maximize: maximize,\r\n        restore: restore,\r\n        minimize: minimize,\r\n        maximizeRestore: maximizeRestore,\r\n        collapse: collapse,\r\n        expand: expand,\r\n        toggleCollapse: toggleCollapse,\r\n        focus: focus,\r\n        activate: activate,\r\n        moveResize: moveResize,\r\n        setTitle: setTitle,\r\n        setStyle: setStyle,\r\n        navigate: navigate,\r\n        addFrameButton: addFrameButton,\r\n        removeFrameButton: removeFrameButton,\r\n        setVisible: setVisible,\r\n        close: close,\r\n        snap: snap,\r\n        showLoader: showLoader,\r\n        hideLoader: hideLoader,\r\n        updateContext: updateContext,\r\n        lock: lock,\r\n        unlock: unlock,\r\n        getIcon: getIcon,\r\n        setIcon: setIcon,\r\n        setFrameColor: setFrameColor,\r\n        attachTab: attachTab,\r\n        detachTab: detachTab,\r\n        setTabHeaderVisible: setTabHeaderVisible,\r\n        onClose: onClose,\r\n        onUrlChanged: onUrlChanged,\r\n        onTitleChanged: onTitleChanged,\r\n        onFrameButtonAdded: onFrameButtonAdded,\r\n        onFrameButtonRemoved: onFrameButtonRemoved,\r\n        onFrameButtonClicked: onFrameButtonClicked,\r\n        onCollapsed: onCollapsed,\r\n        onExpanded: onExpanded,\r\n        onMinimized: onMinimized,\r\n        onMaximized: onMaximized,\r\n        onNormal: onNormal,\r\n        onAttached: onAttached,\r\n        onDetached: onDetached,\r\n        onVisibilityChanged: onVisibilityChanged,\r\n        onContextUpdated: onContextUpdated,\r\n        onLockingChanged: onLockingChanged,\r\n        onBoundsChanged: onBoundsChanged,\r\n        onFrameColorChanged: onFrameColorChanged,\r\n        onFocusChanged: onFocusChanged,\r\n        onGroupChanged: onGroupChanged,\r\n        onWindowAttached: onWindowAttached,\r\n        onWindowDetached: onWindowDetached,\r\n        onTabSelectionChanged: onTabSelectionChanged,\r\n        onTabHeaderVisibilityChanged: onTabHeaderVisibilityChanged,\r\n        get tabs() {\r\n            return getAllTabs();\r\n        },\r\n        get isTabHeaderVisible() {\r\n            return _isTabHeaderVisible;\r\n        },\r\n        get isTabSelected() {\r\n            return _isTabSelected;\r\n        },\r\n    };\r\n    //#endregion \"API\"\r\n    //#endregion \"Group Events\"\r\n    var events = {\r\n        handleWindowClose: handleWindowClose,\r\n        handleWindowChangeState: handleWindowChangeState,\r\n        handleTitleChanged: handleTitleChanged,\r\n        handleVisibilityChanged: handleVisibilityChanged,\r\n        handleUrlChanged: handleUrlChanged,\r\n        handleWindowSettingsChanged: handleWindowSettingsChanged,\r\n        handleContextUpdated: handleContextUpdated,\r\n        handleFrameIsLockedChanged: handleFrameIsLockedChanged,\r\n        handleBoundsChanged: handleBoundsChanged,\r\n        handleFocusChanged: handleFocusChanged,\r\n        handleFrameButtonAdded: handleFrameButtonAdded,\r\n        handleFrameButtonRemoved: handleFrameButtonRemoved,\r\n        handleFrameButtonClicked: handleFrameButtonClicked,\r\n        handleFrameColorChanged: handleFrameColorChanged,\r\n        handleFrameAttached: handleFrameAttached,\r\n        handleFrameSelectionChanged: handleFrameSelectionChanged,\r\n        handleCompositionChanged: handleCompositionChanged,\r\n        handleGroupHeaderVisibilityChanged: handleGroupHeaderVisibilityChanged,\r\n        handleTabHeaderVisibilityChanged: handleTabHeaderVisibilityChanged,\r\n        handleGroupChanged: handleGroupChanged,\r\n        handleGroupAssociation: handleGroupAssociation,\r\n        handleAttached: handleAttached,\r\n        handleDetached: handleDetached,\r\n        handleWindowAttached: handleWindowAttached,\r\n        handleWindowDetached: handleWindowDetached,\r\n    };\r\n    return {\r\n        API: resultWindow,\r\n        Events: events,\r\n    };\r\n});\r\n//# sourceMappingURL=window.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/window.js\n// module id = 22\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tick42_glue_core_1 = require(\"tick42-glue-core\");\r\nvar main_1 = require(\"./activity/main\");\r\nvar main_2 = require(\"./app-manager/main\");\r\nvar main_3 = require(\"./windows/main\");\r\nvar main_4 = require(\"./layouts/main\");\r\nvar main_5 = require(\"./channels/main\");\r\nvar main_6 = require(\"./hotkeys/main\");\r\nvar pjson = require(\"../package.json\");\r\nvar config_1 = require(\"./config\");\r\nvar utils_1 = require(\"./utils\");\r\nexports.default = (function (options) {\r\n    var gdMajorVersion = utils_1.default.getGDMajorVersion();\r\n    // get config object\r\n    // basically selecting some properties (and defaulting them)\r\n    // it's used to extract things like layouts, appManager, activities etc things\r\n    // that glueCore itself doesn't know about\r\n    options = options || {};\r\n    var glueConfig = config_1.default(options);\r\n    options.gateway = options.gateway || {};\r\n    // Init the GLUE namespace\r\n    var hc = typeof window !== \"undefined\" && window.htmlContainer;\r\n    var _appManager;\r\n    var _activity;\r\n    var _windows;\r\n    // dependency graph:\r\n    //   windows: agm, appManager (via getter)\r\n    //   activities: contexts, agm, logger, windows, appManager (via getter)\r\n    //   appManager: agm, windows, logger, activities\r\n    //   layouts: agm, appManager, logger\r\n    function createWindows(core) {\r\n        if (glueConfig.windows) {\r\n            var windowsLogger = getLibLogger(\"windows\", core.logger, glueConfig.windows);\r\n            _windows = main_3.default(core.agm, windowsLogger, function () {\r\n                return _appManager;\r\n            }, gdMajorVersion);\r\n            debugLog(_windows);\r\n            return _windows;\r\n        }\r\n    }\r\n    function createActivities(core) {\r\n        if (glueConfig.activities) {\r\n            if ((gdMajorVersion === 2) ||\r\n                (main_1.ActivityModule.checkIsUsingGW3Implementation &&\r\n                    main_1.ActivityModule.checkIsUsingGW3Implementation(core.connection))) {\r\n                var activityLogger = getLibLogger(\"activity\", core.logger, glueConfig.activities);\r\n                _activity = new main_1.ActivityModule({\r\n                    connection: core.connection,\r\n                    contexts: core.contexts,\r\n                    agm: core.agm,\r\n                    logger: activityLogger,\r\n                    logLevel: \"info\",\r\n                    disableAutoAnnounce: false,\r\n                    disposeRequestHandling: \"ignore\",\r\n                    announcementInfo: null,\r\n                    windows: _windows,\r\n                    appManagerGetter: function () {\r\n                        return _appManager;\r\n                    },\r\n                    mode: glueConfig.activities.mode,\r\n                    typesToTrack: glueConfig.activities.typesToTrack,\r\n                    activityId: typeof window !== \"undefined\" && window.glue42gd && window.glue42gd.activityInfo && window.glue42gd.activityInfo.activityId,\r\n                    gdMajorVersion: gdMajorVersion\r\n                }).api;\r\n                debugLog(_activity);\r\n                return _activity;\r\n            }\r\n        }\r\n    }\r\n    function createAppManager(core) {\r\n        if (!glueConfig.appManager) {\r\n            return;\r\n        }\r\n        var logger = getLibLogger(\"appManager\", core.logger, glueConfig.appManager);\r\n        // AppManager v3\r\n        _appManager = main_2.default({\r\n            agm: core.agm,\r\n            windows: _windows,\r\n            logger: logger,\r\n            activities: _activity,\r\n            mode: glueConfig.appManager.mode,\r\n            gdMajorVersion: gdMajorVersion\r\n        });\r\n        debugLog(_appManager);\r\n        return _appManager;\r\n    }\r\n    function createLayouts(core) {\r\n        if (!glueConfig.layouts) {\r\n            return;\r\n        }\r\n        var logger = getLibLogger(\"layouts\", core.logger, glueConfig.layouts);\r\n        var lay = main_4.default({\r\n            agm: core.agm,\r\n            appManager: _appManager,\r\n            activityGetter: function () { return _activity; },\r\n            logger: logger,\r\n            mode: glueConfig.layouts.mode,\r\n        });\r\n        debugLog(lay);\r\n        return lay;\r\n    }\r\n    function createChannels(core) {\r\n        if (!glueConfig.channels) {\r\n            return;\r\n        }\r\n        if (!core.contexts) {\r\n            // TODO log - notify the user that he can not use channels without context\r\n            return;\r\n        }\r\n        // Logger\r\n        var channelsAPI = main_5.factory(core.contexts, core.agm);\r\n        debugLog(channelsAPI);\r\n        return channelsAPI;\r\n    }\r\n    function createHotkeys(core) {\r\n        var hotkeysAPI = main_6.factory(core.agm);\r\n        debugLog(hotkeysAPI);\r\n        return hotkeysAPI;\r\n    }\r\n    function getLibLogger(loggerName, logger, config) {\r\n        var newLogger = logger.subLogger(loggerName);\r\n        if (config && config.logger) {\r\n            var loggerConfig = config.logger;\r\n            if (loggerConfig.console) {\r\n                newLogger.consoleLevel(loggerConfig.console);\r\n            }\r\n            if (loggerConfig.publish) {\r\n                newLogger.publishLevel(loggerConfig.publish);\r\n            }\r\n            if (loggerConfig.metrics) {\r\n                newLogger.metricsLevel(loggerConfig.metrics);\r\n            }\r\n        }\r\n        return newLogger;\r\n    }\r\n    var ext = {\r\n        // define extra libraries for glue-core to raise\r\n        libs: [\r\n            { name: \"windows\", create: createWindows },\r\n            { name: \"activities\", create: createActivities },\r\n            { name: \"appManager\", create: createAppManager },\r\n            { name: \"layouts\", create: createLayouts },\r\n            { name: \"channels\", create: createChannels },\r\n            { name: \"hotkeys\", create: createHotkeys },\r\n        ],\r\n        version: pjson.version,\r\n        enrichGlue: function (glue) {\r\n            // put some data to config\r\n            glue.config.activities = glueConfig.activities;\r\n            glue.config.windows = glueConfig.windows;\r\n            glue.config.appManager = glueConfig.appManager;\r\n            glue.config.layouts = glueConfig.layouts;\r\n            glue.config.channels = glueConfig.channels;\r\n        },\r\n    };\r\n    var currentLog = [];\r\n    if (typeof window !== \"undefined\") {\r\n        if (!window.glueFactoryLog) {\r\n            window.glueFactoryLog = [];\r\n        }\r\n        window.glueFactoryLog.push(currentLog);\r\n    }\r\n    function debugLog(entry) {\r\n        currentLog.push(entry);\r\n    }\r\n    return tick42_glue_core_1.default(options, ext);\r\n});\r\n//# sourceMappingURL=glue.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/glue.js\n// module id = 23\n// module chunks = 0","module.exports = {\"name\":\"tick42-glue\",\"description\":\"Tick42 GLUE\",\"version\":\"4.4.1\",\"main\":\"./dist/node/tick42-glue.js\",\"browser\":\"./dist/web/tick42-glue.js\",\"types\":\"./glue.d.ts\",\"docName\":\"Glue\",\"scripts\":{\"init-dev-mode\":\"node ./build/scripts/init-dev-mode.js\",\"remove-installed-dependencies\":\"node ./build/scripts/remove-installed-dependencies.js\",\"clean\":\"node ./build/scripts/clean.js\",\"file-versionify\":\"node ./build/scripts/file-versionify.js\",\"pre:build\":\"npm run tslint && tsc && set NODE_ENV=development && npm run clean\",\"tslint\":\"tslint -t codeFrame ./src/**/*.ts\",\"tslint:fix\":\"tslint -t codeFrame --fix ./src/**/*.ts\",\"watch\":\"onchange ./src/**/*.ts -- npm run build:dev\",\"build:dev\":\"npm run tslint && npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify\",\"prepublish\":\"npm run build:prod && npm run test:only\",\"build:prod\":\"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify\",\"test\":\"npm run build:dev && mocha ./tests\",\"test:only\":\"mocha ./tests\",\"generate-docs\":\"glue-js-documentation-builder build-reference --project g4e -q reference --modules ./glue.d.ts,./node_modules/tick42-glue-core/glue.d.ts\"},\"repository\":{\"type\":\"git\",\"url\":\"https://stash.tick42.com:8443/scm/ofgw/js-glue.git\"},\"author\":{\"name\":\"Tick42\",\"url\":\"http://www.glue42.com\"},\"license\":\"ISC\",\"dependencies\":{\"callback-registry\":\"2.5.1\",\"es6-promise\":\"^4.1.1\",\"object-assign\":\"^4.1.1\",\"shortid\":\"^2.2.8\",\"tick42-glue-core\":\"^4.3.7\",\"tick42-promisify\":\"1.0.3\"},\"devDependencies\":{\"@types/node\":\"^10.7.1\",\"@types/object-assign\":\"^4.0.30\",\"@types/shortid\":\"0.0.29\",\"chai\":\"^4.1.0\",\"glue-js-documentation-builder\":\"*\",\"mocha\":\"^2.4.5\",\"onchange\":\"3.*\",\"pre-commit\":\"^1.1.3\",\"readline-sync\":\"^1.4.5\",\"shelljs\":\"^0.6.0\",\"tick42-gateway\":\"0.2.7\",\"tick42-webpack-config\":\"4.1.6\",\"tslint\":\"^5.5.0\",\"typescript\":\"^3.0.1\",\"webpack\":\"2.3.3\"},\"bundleDependencies\":[\"tick42-glue-core\",\"tick42-promisify\",\"callback-registry\"]}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./package.json\n// module id = 24\n// module chunks = 0","/**\n * Secure random string generator with custom alphabet.\n *\n * Alphabet must contain 256 symbols or less. Otherwise, the generator\n * will not be secure.\n *\n * @param {generator} random The random bytes generator.\n * @param {string} alphabet Symbols to be used in new random string.\n * @param {size} size The number of symbols in new random string.\n *\n * @return {string} Random string.\n *\n * @example\n * const format = require('nanoid/format')\n *\n * function random (size) {\n *   const result = []\n *   for (let i = 0; i < size; i++) {\n *     result.push(randomByte())\n *   }\n *   return result\n * }\n *\n * format(random, \"abcdef\", 5) //=> \"fbaef\"\n *\n * @name format\n * @function\n */\nmodule.exports = function (random, alphabet, size) {\n  var mask = (2 << Math.log(alphabet.length - 1) / Math.LN2) - 1\n  var step = Math.ceil(1.6 * mask * size / alphabet.length)\n\n  var id = ''\n  while (true) {\n    var bytes = random(step)\n    for (var i = 0; i < step; i++) {\n      var byte = bytes[i] & mask\n      if (alphabet[byte]) {\n        id += alphabet[byte]\n        if (id.length === size) return id\n      }\n    }\n  }\n}\n\n/**\n * @callback generator\n * @param {number} bytes The number of bytes to generate.\n * @return {number[]} Random bytes.\n */\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/nanoid/format.js\n// module id = 25\n// module chunks = 0","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/object-assign/index.js\n// module id = 26\n// module chunks = 0","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/process/browser.js\n// module id = 27\n// module chunks = 0","'use strict';\nmodule.exports = require('./lib/index');\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/shortid/index.js\n// module id = 28\n// module chunks = 0","'use strict';\n\nvar generate = require('./generate');\nvar alphabet = require('./alphabet');\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version = 6;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction build(clusterWorkerId) {\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + generate(version);\n    str = str + generate(clusterWorkerId);\n    if (counter > 0) {\n        str = str + generate(counter);\n    }\n    str = str + generate(seconds);\n    return str;\n}\n\nmodule.exports = build;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/shortid/lib/build.js\n// module id = 29\n// module chunks = 0","'use strict';\n\nvar alphabet = require('./alphabet');\nvar random = require('./random/random-byte');\nvar format = require('nanoid/format');\n\nfunction generate(number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + format(random, alphabet.get(), 1);\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nmodule.exports = generate;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/shortid/lib/generate.js\n// module id = 30\n// module chunks = 0","'use strict';\n\nvar alphabet = require('./alphabet');\nvar build = require('./build');\nvar isValid = require('./is-valid');\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId = require('./util/cluster-worker-id') || 0;\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet.characters(newCharacters);\n    }\n\n    return alphabet.shuffled();\n}\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n  return build(clusterWorkerId);\n}\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.isValid = isValid;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/shortid/lib/index.js\n// module id = 31\n// module chunks = 0","'use strict';\nvar alphabet = require('./alphabet');\n\nfunction isShortId(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var nonAlphabetic = new RegExp('[^' +\n      alphabet.get().replace(/[|\\\\{}()[\\]^$+*?.-]/g, '\\\\$&') +\n    ']');\n    return !nonAlphabetic.test(id);\n}\n\nmodule.exports = isShortId;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/shortid/lib/is-valid.js\n// module id = 32\n// module chunks = 0","'use strict';\n\nvar crypto = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nvar randomByte;\n\nif (!crypto || !crypto.getRandomValues) {\n    randomByte = function(size) {\n        var bytes = [];\n        for (var i = 0; i < size; i++) {\n            bytes.push(Math.floor(Math.random() * 256));\n        }\n        return bytes;\n    };\n} else {\n    randomByte = function(size) {\n        return crypto.getRandomValues(new Uint8Array(size));\n    };\n}\n\nmodule.exports = randomByte;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/shortid/lib/random/random-byte-browser.js\n// module id = 33\n// module chunks = 0","'use strict';\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue() {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed/(233280.0);\n}\n\nfunction setSeed(_seed_) {\n    seed = _seed_;\n}\n\nmodule.exports = {\n    nextValue: getNextValue,\n    seed: setSeed\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/shortid/lib/random/random-from-seed.js\n// module id = 34\n// module chunks = 0","'use strict';\n\nmodule.exports = 0;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/shortid/lib/util/cluster-worker-id-browser.js\n// module id = 35\n// module chunks = 0","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"tick42-glue-core\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"tick42-glue-core\"] = factory();\n\telse\n\t\troot[\"tick42-glue-core\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 75);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = {\r\n    DEFAULT: 0,\r\n    STRING: 1,\r\n    NUMBER: 2,\r\n    COUNT: 3,\r\n    RATE: 4,\r\n    STATISTICS: 6,\r\n    TIMESTAMP: 7,\r\n    ADDRESS: 8,\r\n    TIMESPAN: 10,\r\n    OBJECT: 11\r\n};\r\n//# sourceMappingURL=metric-types.js.map\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nfunction createRegistry(options) {\r\n    if (options && options.errorHandling\r\n        && typeof options.errorHandling !== \"function\"\r\n        && options.errorHandling !== \"log\"\r\n        && options.errorHandling !== \"silent\"\r\n        && options.errorHandling !== \"throw\") {\r\n        throw new Error(\"Invalid options passed to createRegistry. Prop errorHandling should be [\\\"log\\\" | \\\"silent\\\" | \\\"throw\\\" | (err) => void], but \" + typeof options.errorHandling + \" was passed\");\r\n    }\r\n    var _userErrorHandler = options && typeof options.errorHandling === \"function\" && options.errorHandling;\r\n    var callbacks = {};\r\n    function add(key, callback) {\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey) {\r\n            callbacksForKey = [];\r\n            callbacks[key] = callbacksForKey;\r\n        }\r\n        callbacksForKey.push(callback);\r\n        return function () {\r\n            var allForKey = callbacks[key];\r\n            if (!allForKey) {\r\n                return;\r\n            }\r\n            allForKey = allForKey.reduce(function (acc, element, index) {\r\n                if (!(element === callback && acc.length === index)) {\r\n                    acc.push(element);\r\n                }\r\n                return acc;\r\n            }, []);\r\n            callbacks[key] = allForKey;\r\n        };\r\n    }\r\n    function execute(key) {\r\n        var argumentsArr = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            argumentsArr[_i - 1] = arguments[_i];\r\n        }\r\n        var callbacksForKey = callbacks[key];\r\n        if (!callbacksForKey || callbacksForKey.length === 0) {\r\n            return [];\r\n        }\r\n        var results = [];\r\n        callbacksForKey.forEach(function (callback) {\r\n            try {\r\n                var result = callback.apply(undefined, argumentsArr);\r\n                results.push(result);\r\n            }\r\n            catch (err) {\r\n                results.push(undefined);\r\n                _handleError(err, key);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n    function _handleError(exceptionArtifact, key) {\r\n        var errParam = exceptionArtifact instanceof Error ? exceptionArtifact : new Error(exceptionArtifact);\r\n        if (_userErrorHandler) {\r\n            _userErrorHandler(errParam);\r\n            return;\r\n        }\r\n        var msg = \"[ERROR] callback-registry: User callback for key \\\"\" + key + \"\\\" failed: \" + errParam.stack;\r\n        if (options) {\r\n            switch (options.errorHandling) {\r\n                case \"log\":\r\n                    return console.error(msg);\r\n                case \"silent\":\r\n                    return;\r\n                case \"throw\":\r\n                    throw new Error(msg);\r\n            }\r\n        }\r\n        console.error(msg);\r\n    }\r\n    function clear() {\r\n        callbacks = {};\r\n    }\r\n    return {\r\n        add: add,\r\n        execute: execute,\r\n        clear: clear\r\n    };\r\n}\r\n;\r\ncreateRegistry.default = createRegistry;\r\nmodule.exports = createRegistry;\r\n//# sourceMappingURL=index.js.map\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = {\r\n    validate: function (definition, parent, transport) {\r\n        if (definition === null || typeof definition !== \"object\") {\r\n            throw new Error(\"Missing definition\");\r\n        }\r\n        if (parent === null || typeof parent !== \"object\") {\r\n            throw new Error(\"Missing parent\");\r\n        }\r\n        if (transport === null || typeof transport !== \"object\") {\r\n            throw new Error(\"Missing transport\");\r\n        }\r\n    },\r\n};\r\n//# sourceMappingURL=helpers.js.map\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar shortid = __webpack_require__(6);\r\nexports.default = shortid;\r\n//# sourceMappingURL=random.js.map\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar randomFromSeed = __webpack_require__(24);\n\nvar ORIGINAL = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-';\nvar alphabet;\nvar previousSeed;\n\nvar shuffled;\n\nfunction reset() {\n    shuffled = false;\n}\n\nfunction setCharacters(_alphabet_) {\n    if (!_alphabet_) {\n        if (alphabet !== ORIGINAL) {\n            alphabet = ORIGINAL;\n            reset();\n        }\n        return;\n    }\n\n    if (_alphabet_ === alphabet) {\n        return;\n    }\n\n    if (_alphabet_.length !== ORIGINAL.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. You submitted ' + _alphabet_.length + ' characters: ' + _alphabet_);\n    }\n\n    var unique = _alphabet_.split('').filter(function(item, ind, arr){\n       return ind !== arr.lastIndexOf(item);\n    });\n\n    if (unique.length) {\n        throw new Error('Custom alphabet for shortid must be ' + ORIGINAL.length + ' unique characters. These characters were not unique: ' + unique.join(', '));\n    }\n\n    alphabet = _alphabet_;\n    reset();\n}\n\nfunction characters(_alphabet_) {\n    setCharacters(_alphabet_);\n    return alphabet;\n}\n\nfunction setSeed(seed) {\n    randomFromSeed.seed(seed);\n    if (previousSeed !== seed) {\n        reset();\n        previousSeed = seed;\n    }\n}\n\nfunction shuffle() {\n    if (!alphabet) {\n        setCharacters(ORIGINAL);\n    }\n\n    var sourceArray = alphabet.split('');\n    var targetArray = [];\n    var r = randomFromSeed.nextValue();\n    var characterIndex;\n\n    while (sourceArray.length > 0) {\n        r = randomFromSeed.nextValue();\n        characterIndex = Math.floor(r * sourceArray.length);\n        targetArray.push(sourceArray.splice(characterIndex, 1)[0]);\n    }\n    return targetArray.join('');\n}\n\nfunction getShuffled() {\n    if (shuffled) {\n        return shuffled;\n    }\n    shuffled = shuffle();\n    return shuffled;\n}\n\n/**\n * lookup shuffled letter\n * @param index\n * @returns {string}\n */\nfunction lookup(index) {\n    var alphabetShuffled = getShuffled();\n    return alphabetShuffled[index];\n}\n\nfunction get () {\n  return alphabet || ORIGINAL;\n}\n\nmodule.exports = {\n    get: get,\n    characters: characters,\n    seed: setSeed,\n    lookup: lookup,\n    shuffled: getShuffled\n};\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction convertInfoToInstance(info) {\r\n    if (typeof info !== \"object\") {\r\n        info = {};\r\n    }\r\n    return {\r\n        application: info.ApplicationName,\r\n        environment: info.Environment,\r\n        machine: info.MachineName,\r\n        pid: info.ProcessId,\r\n        region: info.Region,\r\n        service: info.ServiceName,\r\n        user: info.UserName,\r\n        started: info.ProcessStartTime,\r\n    };\r\n}\r\nexports.convertInfoToInstance = convertInfoToInstance;\r\nfunction isStreamingFlagSet(flags) {\r\n    if (typeof flags !== \"number\" || isNaN(flags)) {\r\n        return false;\r\n    }\r\n    var mask = 32;\r\n    var result = flags & mask;\r\n    return result === mask;\r\n}\r\nexports.isStreamingFlagSet = isStreamingFlagSet;\r\nfunction convertInstance(instance) {\r\n    return {\r\n        ApplicationName: instance.application,\r\n        ProcessId: instance.pid,\r\n        MachineName: instance.machine,\r\n        UserName: instance.user,\r\n        Environment: instance.environment,\r\n        Region: instance.region,\r\n    };\r\n}\r\nexports.convertInstance = convertInstance;\r\n//# sourceMappingURL=helpers.js.map\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nmodule.exports = __webpack_require__(21);\n\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports) {\n\nvar g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction default_1(promise, successCallback, errorCallback) {\r\n    if (typeof successCallback !== \"function\" && typeof errorCallback !== \"function\") {\r\n        return promise;\r\n    }\r\n    if (typeof successCallback !== \"function\") {\r\n        successCallback = function () { };\r\n    }\r\n    else if (typeof errorCallback !== \"function\") {\r\n        errorCallback = function () { };\r\n    }\r\n    promise.then(successCallback, errorCallback);\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=promisify.js.map\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ServerSubscription = (function () {\r\n    function ServerSubscription(protocol, repoMethod, subscription) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.subscription = subscription;\r\n    }\r\n    Object.defineProperty(ServerSubscription.prototype, \"stream\", {\r\n        get: function () { return this.repoMethod.stream; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"arguments\", {\r\n        get: function () { return this.subscription.arguments || {}; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"branchKey\", {\r\n        get: function () { return this.subscription.branchKey; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ServerSubscription.prototype, \"instance\", {\r\n        get: function () { return this.subscription.instance; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerSubscription.prototype.close = function () {\r\n        this.protocol.server.closeSingleSubscription(this.repoMethod, this.subscription);\r\n    };\r\n    ServerSubscription.prototype.push = function (data) {\r\n        this.protocol.server.pushDataToSingle(this.repoMethod, this.subscription, data);\r\n    };\r\n    return ServerSubscription;\r\n}());\r\nexports.default = ServerSubscription;\r\n//# sourceMappingURL=subscription.js.map\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar msg = __webpack_require__(14);\r\nexports.ContextMessageReplaySpec = {\r\n    get name() {\r\n        return \"context\";\r\n    },\r\n    get types() {\r\n        return [\r\n            msg.GW_MESSAGE_CREATE_CONTEXT,\r\n            msg.GW_MESSAGE_ACTIVITY_CREATED,\r\n            msg.GW_MESSAGE_ACTIVITY_DESTROYED,\r\n            msg.GW_MESSAGE_CONTEXT_CREATED,\r\n            msg.GW_MESSAGE_CONTEXT_ADDED,\r\n            msg.GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            msg.GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            msg.GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            msg.GW_MESSAGE_DESTROY_CONTEXT,\r\n            msg.GW_MESSAGE_CONTEXT_DESTROYED,\r\n            msg.GW_MESSAGE_UPDATE_CONTEXT,\r\n            msg.GW_MESSAGE_CONTEXT_UPDATED,\r\n            msg.GW_MESSAGE_JOINED_ACTIVITY\r\n        ];\r\n    }\r\n};\r\n//# sourceMappingURL=contextMessageReplaySpec.js.map\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Utils = (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return -1;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? -1 : ver;\r\n    };\r\n    Utils.isNode = function () {\r\n        try {\r\n            return Object.prototype.toString.call(global.process) === \"[object process]\";\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n    return Utils;\r\n}());\r\nexports.default = Utils;\r\n//# sourceMappingURL=utils.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(7)))\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports) {\n\nmodule.exports = {\"name\":\"tick42-glue-core\",\"version\":\"4.3.7\",\"description\":\"Glue42 core library including logger, connection, agm and metrics\",\"main\":\"./dist/node/tick42-glue-core.js\",\"types\":\"./glue.d.ts\",\"browser\":\"./dist/web/tick42-glue-core.js\",\"scripts\":{\"init-dev-mode\":\"node ./build/scripts/init-dev-mode.js\",\"remove-installed-dependencies\":\"node ./build/scripts/remove-installed-dependencies.js\",\"clean\":\"node ./build/scripts/clean.js\",\"pre:build\":\"npm run clean && npm run tslint && tsc && set NODE_ENV=development\",\"file-versionify\":\"node ./build/scripts/file-versionify.js\",\"tslint\":\"tslint -t codeFrame ./src/**.ts\",\"tslint:fix\":\"tslint -t codeFrame --fix ./src/**.ts\",\"watch\":\"onchange ./src/**/*.ts -- npm run build:dev\",\"build:dev\":\"npm run pre:build && set NODE_ENV=development && webpack && npm run file-versionify\",\"build:prod\":\"npm run pre:build && set NODE_ENV=development && webpack && set NODE_ENV=production && webpack && npm run file-versionify\",\"docs\":\"typedoc --options typedoc.json ./src\",\"prepublish\":\"npm run build:prod && npm run test:only\",\"test\":\"npm run build:dev && npm run test:only\",\"test:only\":\"mocha ./tests/ --recursive\",\"test:core\":\"mocha ./tests/core\",\"test:agm\":\"mocha ./tests/agm\",\"test:bus\":\"mocha ./tests/bus\"},\"repository\":{\"type\":\"git\",\"url\":\"https://stash.tick42.com/scm/tg/js-glue-core.git\"},\"author\":{\"name\":\"Tick42\",\"url\":\"http://www.glue42.com\"},\"license\":\"ISC\",\"dependencies\":{\"callback-registry\":\"^2.4.0\",\"es6-promise\":\"^4.1.0\",\"shortid\":\"^2.2.6\",\"util-deprecate\":\"^1.0.2\",\"ws\":\"^0.7.2\"},\"devDependencies\":{\"@types/node\":\"^10.7.0\",\"@types/shortid\":\"0.0.29\",\"archiver\":\"^1.3.0\",\"babel-core\":\"^6.25.0\",\"babel-loader\":\"^6.4.1\",\"babel-plugin-add-module-exports\":\"^0.2.1\",\"babel-preset-es2015\":\"^6.16.0\",\"babel-preset-stage-2\":\"^6.22.0\",\"chai\":\"^4.0.2\",\"deep-equal\":\"^1.0.1\",\"mocha\":\"^2.5.3\",\"onchange\":\"3.*\",\"pre-commit\":\"^1.1.3\",\"readline-sync\":\"^1.4.5\",\"shelljs\":\"^0.6.0\",\"tick42-gateway\":\"0.2.7\",\"tick42-webpack-config\":\"4.1.6\",\"tslint\":\"^5.11.0\",\"typescript\":\"^3.0.1\",\"webpack\":\"2.3.3\"}}\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar ConnectionImpl = (function () {\r\n    function ConnectionImpl(settings) {\r\n        this.messageHandlers = {};\r\n        this.ids = 1;\r\n        this.registry = callback_registry_1.default();\r\n        this._connected = false;\r\n        this._settings = settings;\r\n        this._logger = settings.logger;\r\n    }\r\n    ConnectionImpl.prototype.init = function (transport, protocol) {\r\n        this._protocol = protocol;\r\n        this._transport = transport;\r\n        this._transport.onConnectedChanged(this.handleConnectionChanged.bind(this));\r\n        this._transport.onMessage(this.handleTransportMessage.bind(this));\r\n    };\r\n    ConnectionImpl.prototype.send = function (product, type, message, id, options) {\r\n        if (this._transport.isObjectBasedTransport) {\r\n            var msg = this._protocol.createObjectMessage(product, type, message, id);\r\n            return this._transport.sendObject(msg, product, type, options);\r\n        }\r\n        else {\r\n            var strMessage = this._protocol.createStringMessage(product, type, message, id);\r\n            return this._transport.send(strMessage, product, type, options);\r\n        }\r\n    };\r\n    ConnectionImpl.prototype.on = function (product, type, messageHandler) {\r\n        type = type.toLowerCase();\r\n        if (this.messageHandlers[type] === undefined) {\r\n            this.messageHandlers[type] = {};\r\n        }\r\n        var id = this.ids++;\r\n        this.messageHandlers[type][id] = messageHandler;\r\n        return {\r\n            type: type,\r\n            id: id,\r\n        };\r\n    };\r\n    ConnectionImpl.prototype.off = function (info) {\r\n        delete this.messageHandlers[info.type.toLowerCase()][info.id];\r\n    };\r\n    Object.defineProperty(ConnectionImpl.prototype, \"isConnected\", {\r\n        get: function () {\r\n            return this._connected;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ConnectionImpl.prototype.connected = function (callback) {\r\n        if (this._connected) {\r\n            callback(this._settings.ws || this._settings.http);\r\n        }\r\n        return this.registry.add(\"connected\", callback);\r\n    };\r\n    ConnectionImpl.prototype.disconnected = function (callback) {\r\n        return this.registry.add(\"disconnected\", callback);\r\n    };\r\n    ConnectionImpl.prototype.login = function (authRequest) {\r\n        this._transport.open();\r\n        return this._protocol.login(authRequest);\r\n    };\r\n    ConnectionImpl.prototype.logout = function () {\r\n        this._protocol.logout();\r\n        this._transport.close();\r\n    };\r\n    ConnectionImpl.prototype.loggedIn = function (callback) {\r\n        return this._protocol.loggedIn(callback);\r\n    };\r\n    Object.defineProperty(ConnectionImpl.prototype, \"protocolVersion\", {\r\n        get: function () {\r\n            return this._settings.protocolVersion || 1;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ConnectionImpl.prototype.toAPI = function () {\r\n        var that = this;\r\n        return {\r\n            send: that.send.bind(that),\r\n            on: that.on.bind(that),\r\n            off: that.off.bind(that),\r\n            login: that.login.bind(that),\r\n            logout: that.logout.bind(that),\r\n            loggedIn: that.loggedIn.bind(that),\r\n            connected: that.connected.bind(that),\r\n            disconnected: that.disconnected.bind(that),\r\n            get protocolVersion() {\r\n                return that.protocolVersion;\r\n            }\r\n        };\r\n    };\r\n    ConnectionImpl.prototype.distributeMessage = function (message, type) {\r\n        var _this = this;\r\n        var handlers = this.messageHandlers[type.toLowerCase()];\r\n        if (handlers !== undefined) {\r\n            Object.keys(handlers).forEach(function (handlerId) {\r\n                var handler = handlers[handlerId];\r\n                if (handler !== undefined) {\r\n                    try {\r\n                        handler(message);\r\n                    }\r\n                    catch (error) {\r\n                        _this._logger.error(\"Message handler failed with \" + error.stack);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    ConnectionImpl.prototype.handleConnectionChanged = function (connected) {\r\n        if (this._connected === connected) {\r\n            return;\r\n        }\r\n        this._connected = connected;\r\n        if (connected) {\r\n            this.registry.execute(\"connected\");\r\n        }\r\n        else {\r\n            this.registry.execute(\"disconnected\");\r\n        }\r\n    };\r\n    ConnectionImpl.prototype.handleTransportMessage = function (msg) {\r\n        var msgObj;\r\n        if (typeof msg === \"string\") {\r\n            msgObj = this._protocol.processStringMessage(msg);\r\n        }\r\n        else {\r\n            msgObj = this._protocol.processObjectMessage(msg);\r\n        }\r\n        this.distributeMessage(msgObj.msg, msgObj.msgType);\r\n    };\r\n    return ConnectionImpl;\r\n}());\r\nexports.default = ConnectionImpl;\r\n//# sourceMappingURL=connection.js.map\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.GW_MESSAGE_CREATE_CONTEXT = \"create-context\";\r\nexports.GW_MESSAGE_ACTIVITY_CREATED = \"created\";\r\nexports.GW_MESSAGE_ACTIVITY_DESTROYED = \"destroyed\";\r\nexports.GW_MESSAGE_CONTEXT_CREATED = \"context-created\";\r\nexports.GW_MESSAGE_CONTEXT_ADDED = \"context-added\";\r\nexports.GW_MESSAGE_SUBSCRIBE_CONTEXT = \"subscribe-context\";\r\nexports.GW_MESSAGE_SUBSCRIBED_CONTEXT = \"subscribed-context\";\r\nexports.GW_MESSAGE_UNSUBSCRIBE_CONTEXT = \"unsubscribe-context\";\r\nexports.GW_MESSAGE_DESTROY_CONTEXT = \"destroy-context\";\r\nexports.GW_MESSAGE_CONTEXT_DESTROYED = \"context-destroyed\";\r\nexports.GW_MESSAGE_UPDATE_CONTEXT = \"update-context\";\r\nexports.GW_MESSAGE_CONTEXT_UPDATED = \"context-updated\";\r\nexports.GW_MESSAGE_JOINED_ACTIVITY = \"joined\";\r\n//# sourceMappingURL=gw3Messages.js.map\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar connection = {\r\n    protocolVersion: -1,\r\n    send: function (product, type, message, id, options) {\r\n        return Promise.resolve(undefined);\r\n    },\r\n    on: function (product, type, messageHandler) {\r\n        return { type: \"1\", id: 1 };\r\n    },\r\n    off: function (info) {\r\n    },\r\n    login: function (message) {\r\n        return undefined;\r\n    },\r\n    logout: function () {\r\n    },\r\n    loggedIn: function (callback) {\r\n        return undefined;\r\n    },\r\n    connected: function (callback) {\r\n        return undefined;\r\n    },\r\n    disconnected: function (callback) {\r\n        return undefined;\r\n    },\r\n};\r\nexports.default = connection;\r\n//# sourceMappingURL=dummyConnection.js.map\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar main_1 = __webpack_require__(89);\r\nvar main_2 = __webpack_require__(57);\r\nvar main_3 = __webpack_require__(74);\r\nvar main_4 = __webpack_require__(35);\r\nvar main_5 = __webpack_require__(52);\r\nvar config_1 = __webpack_require__(55);\r\nvar dummyConnection_1 = __webpack_require__(15);\r\nvar timer_1 = __webpack_require__(92);\r\nvar utils_1 = __webpack_require__(11);\r\nvar dummyConnection_2 = __webpack_require__(15);\r\nvar main_6 = __webpack_require__(71);\r\nvar contextMessageReplaySpec_1 = __webpack_require__(10);\r\nvar GlueCore = function (userConfig, ext) {\r\n    var gdVersion = -1;\r\n    var hc;\r\n    var glue42gd;\r\n    if (typeof window !== \"undefined\") {\r\n        gdVersion = utils_1.default.getGDMajorVersion();\r\n        if (gdVersion === 2) {\r\n            hc = window.htmlContainer;\r\n        }\r\n        else if (gdVersion >= 3) {\r\n            glue42gd = window.glue42gd;\r\n        }\r\n    }\r\n    var glueInitTimer = timer_1.default();\r\n    userConfig = userConfig || {};\r\n    ext = ext || {};\r\n    var internalConfig = config_1.default(userConfig, ext, hc, glue42gd, gdVersion);\r\n    var _connection;\r\n    var _agm;\r\n    var _logger;\r\n    var _rootMetrics;\r\n    var _metrics;\r\n    var _contexts;\r\n    var _bus;\r\n    var libs = {};\r\n    function registerLib(name, inner, t) {\r\n        inner.initStartTime = t.startTime;\r\n        if (inner.ready) {\r\n            inner.ready().then(function () {\r\n                inner.initTime = t.stop();\r\n                inner.initEndTime = t.endTime;\r\n            });\r\n        }\r\n        else {\r\n            inner.initTime = t.stop();\r\n            inner.initEndTime = t.endTime;\r\n        }\r\n        libs[name] = inner;\r\n        GlueCore[name] = inner;\r\n    }\r\n    function setupConnection() {\r\n        var initTimer = timer_1.default();\r\n        internalConfig.connection.logger = _logger.subLogger(\"connection\");\r\n        _connection = main_2.default(internalConfig.connection);\r\n        var authPromise = Promise.resolve(internalConfig.auth);\r\n        if (internalConfig.connection && !internalConfig.auth) {\r\n            var protocolVersion = internalConfig.connection.protocolVersion;\r\n            if (!protocolVersion || protocolVersion === 1) {\r\n                registerLib(\"connection\", _connection, initTimer);\r\n                return Promise.resolve({});\r\n            }\r\n            if (protocolVersion === 2) {\r\n                return Promise.reject(\"You need to provide auth information\");\r\n            }\r\n            if (protocolVersion === 3) {\r\n                if (glue42gd) {\r\n                    authPromise = glue42gd.getGWToken().then(function (token) {\r\n                        return {\r\n                            gatewayToken: token\r\n                        };\r\n                    });\r\n                }\r\n                else {\r\n                    authPromise = Promise.reject(\"You need to provide auth information\");\r\n                }\r\n            }\r\n        }\r\n        return authPromise\r\n            .then(function (authConfig) {\r\n            var authRequest;\r\n            if (typeof authConfig === \"string\" || typeof authConfig === \"number\") {\r\n                authRequest = {\r\n                    token: authConfig\r\n                };\r\n            }\r\n            else if (Object.prototype.toString.call(authConfig) === \"[object Object]\") {\r\n                authRequest = authConfig;\r\n            }\r\n            else {\r\n                throw new Error(\"Invalid auth object - \" + JSON.stringify(authConfig));\r\n            }\r\n            return authRequest;\r\n        })\r\n            .then(function (authRequest) {\r\n            return _connection.login(authRequest);\r\n        })\r\n            .then(function (identity) {\r\n            if (identity) {\r\n                if (identity.machine) {\r\n                    internalConfig.agm.instance.machine = identity.machine;\r\n                }\r\n                if (identity.user) {\r\n                    internalConfig.agm.instance.user = identity.user;\r\n                }\r\n            }\r\n            registerLib(\"connection\", _connection, initTimer);\r\n            return internalConfig;\r\n        })\r\n            .catch(function (e) {\r\n            if (_connection) {\r\n                _connection.logout();\r\n            }\r\n            throw e;\r\n        });\r\n    }\r\n    function setupLogger() {\r\n        var initTimer = timer_1.default();\r\n        var loggerConfig = {\r\n            identity: internalConfig.identity,\r\n            getConnection: function () {\r\n                return _connection || dummyConnection_1.default;\r\n            },\r\n            publish: internalConfig.logger.publish || \"off\",\r\n            console: internalConfig.logger.console || \"info\",\r\n            metrics: (internalConfig.metrics && internalConfig.logger.metrics) || \"off\"\r\n        };\r\n        _logger = main_3.default(loggerConfig);\r\n        registerLib(\"logger\", _logger, initTimer);\r\n        return Promise.resolve(undefined);\r\n    }\r\n    function setupMetrics() {\r\n        if (internalConfig.metrics) {\r\n            var initTimer = timer_1.default();\r\n            _rootMetrics = main_1.default({\r\n                identity: internalConfig.metrics.identity,\r\n                connection: internalConfig.metrics ? _connection : dummyConnection_1.default,\r\n                logger: _logger.subLogger(\"metrics\")\r\n            });\r\n            _metrics = _rootMetrics.subSystem(\"App\");\r\n            var reportingSystem_1 = _metrics.subSystem(\"reporting\");\r\n            var def_1 = {\r\n                name: \"features\",\r\n                conflation: 1,\r\n            };\r\n            var _featureMetric_1;\r\n            _metrics.featureMetric = function (name, action, payload) {\r\n                if (typeof name === \"undefined\" || name === \"\") {\r\n                    throw new Error(\"name is mandatory\");\r\n                }\r\n                else if (typeof action === \"undefined\" || action === \"\") {\r\n                    throw new Error(\"action is mandatory\");\r\n                }\r\n                else if (typeof payload === \"undefined\" || payload === \"\") {\r\n                    throw new Error(\"payload is mandatory\");\r\n                }\r\n                if (!_featureMetric_1) {\r\n                    _featureMetric_1 = reportingSystem_1.objectMetric(def_1, { name: name, action: action, payload: payload });\r\n                }\r\n                else {\r\n                    _featureMetric_1.update({\r\n                        name: name,\r\n                        action: action,\r\n                        payload: payload\r\n                    });\r\n                }\r\n            };\r\n            _logger.metricsLevel(\"warn\", _metrics.parent.subSystem(\"LogEvents\"));\r\n            registerLib(\"metrics\", _metrics, initTimer);\r\n        }\r\n        return Promise.resolve(undefined);\r\n    }\r\n    function setupAGM() {\r\n        var initTimer = timer_1.default();\r\n        var agmConfig = {\r\n            instance: internalConfig.agm.instance,\r\n            connection: _connection,\r\n            logger: _logger.subLogger(\"agm\"),\r\n            forceGW: internalConfig.connection && internalConfig.connection.force,\r\n            gdVersion: gdVersion,\r\n        };\r\n        return new Promise(function (resolve, reject) {\r\n            main_4.default(agmConfig)\r\n                .then(function (agmLib) {\r\n                _agm = agmLib;\r\n                registerLib(\"agm\", _agm, initTimer);\r\n                resolve(internalConfig);\r\n            })\r\n                .catch(function (err) {\r\n                return reject(err);\r\n            });\r\n        });\r\n    }\r\n    function setupContexts() {\r\n        var hasActivities = (internalConfig.activities && dummyConnection_2.default.protocolVersion === 3);\r\n        var needsContexts = internalConfig.contexts || hasActivities;\r\n        if (needsContexts) {\r\n            var initTimer = timer_1.default();\r\n            _contexts = new main_6.ContextsModule({\r\n                connection: _connection,\r\n                logger: _logger.subLogger(\"contexts\"),\r\n                gdMajorVersion: gdVersion\r\n            });\r\n            registerLib(\"contexts\", _contexts, initTimer);\r\n            return _contexts;\r\n        }\r\n        else {\r\n            var replayer = dummyConnection_2.default.replayer;\r\n            if (replayer) {\r\n                replayer.drain(contextMessageReplaySpec_1.ContextMessageReplaySpec.name, null);\r\n            }\r\n        }\r\n    }\r\n    function setupExternalLibs(externalLibs) {\r\n        try {\r\n            externalLibs.forEach(function (lib) {\r\n                setupExternalLib(lib.name, lib.create);\r\n            });\r\n            return Promise.resolve();\r\n        }\r\n        catch (e) {\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n    function setupExternalLib(name, createCallback) {\r\n        var initTimer = timer_1.default();\r\n        var lib = createCallback(libs);\r\n        if (lib) {\r\n            registerLib(name, lib, initTimer);\r\n        }\r\n    }\r\n    function waitForLibs() {\r\n        var libsReadyPromises = Object.keys(libs).map(function (key) {\r\n            var lib = libs[key];\r\n            return lib.ready ?\r\n                lib.ready() : Promise.resolve();\r\n        });\r\n        return Promise.all(libsReadyPromises);\r\n    }\r\n    function constructGlueObject() {\r\n        var feedbackFunc = function () {\r\n            if (!_agm) {\r\n                return;\r\n            }\r\n            _agm.invoke(\"T42.ACS.Feedback\", {}, \"best\");\r\n        };\r\n        var info = { glueVersion: internalConfig.version };\r\n        glueInitTimer.stop();\r\n        var glue = {\r\n            feedback: feedbackFunc,\r\n            info: info,\r\n            version: internalConfig.version,\r\n            userConfig: userConfig,\r\n            done: function () {\r\n                _connection.logout();\r\n                return Promise.resolve();\r\n            }\r\n        };\r\n        glue.performance = {\r\n            get browser() {\r\n                return window.performance.timing.toJSON();\r\n            },\r\n            get memory() {\r\n                return window.performance.memory;\r\n            },\r\n            get initTimes() {\r\n                var result = Object.keys(glue)\r\n                    .filter(function (key) {\r\n                    if (key === \"initTimes\") {\r\n                        return false;\r\n                    }\r\n                    return glue[key].initTime;\r\n                })\r\n                    .map(function (key) {\r\n                    return {\r\n                        name: key,\r\n                        time: glue[key].initTime,\r\n                        startTime: glue[key].initStartTime,\r\n                        endTime: glue[key].initEndTime\r\n                    };\r\n                });\r\n                result.push({\r\n                    name: \"glue\",\r\n                    startTime: glueInitTimer.startTime,\r\n                    endTime: glueInitTimer.endTime,\r\n                    time: glueInitTimer.period\r\n                });\r\n                return result;\r\n            }\r\n        };\r\n        Object.keys(libs).forEach(function (key) {\r\n            var lib = libs[key];\r\n            glue[key] = lib;\r\n            info[key] = lib.version;\r\n        });\r\n        if (hc && hc.perfDataNeeded && hc.updatePerfData) {\r\n            var delay = hc.perfDataDelay || 100;\r\n            setTimeout(function () {\r\n                hc.updatePerfData(glue.performance);\r\n            }, delay);\r\n        }\r\n        if (glue42gd && glue42gd.updatePerfData) {\r\n            glue42gd.updatePerfData(glue.performance);\r\n        }\r\n        glue.config = {};\r\n        if (ext.enrichGlue) {\r\n            ext.enrichGlue(glue);\r\n        }\r\n        Object.keys(internalConfig).forEach(function (k) {\r\n            glue.config[k] = internalConfig[k];\r\n        });\r\n        if (ext.extOptions) {\r\n            Object.keys(ext.extOptions).forEach(function (k) {\r\n                glue.config[k] = ext.extOptions[k];\r\n            });\r\n        }\r\n        return glue;\r\n    }\r\n    function setupBus() {\r\n        if (!internalConfig.bus) {\r\n            return Promise.resolve(undefined);\r\n        }\r\n        var initTimer = timer_1.default();\r\n        var busSettings = {\r\n            connection: _connection,\r\n            logger: _logger.subLogger(\"bus\")\r\n        };\r\n        return new Promise(function (resolve, reject) {\r\n            main_5.default(busSettings)\r\n                .then(function (busLib) {\r\n                _bus = busLib;\r\n                registerLib(\"bus\", _bus, initTimer);\r\n                resolve();\r\n            })\r\n                .catch(function (err) {\r\n                return reject(err);\r\n            });\r\n        });\r\n    }\r\n    return setupLogger()\r\n        .then(setupConnection)\r\n        .then(function () { return Promise.all([setupMetrics(), setupAGM(), setupContexts(), setupBus()]); })\r\n        .then(function () {\r\n        return setupExternalLibs(internalConfig.libs || []);\r\n    })\r\n        .then(waitForLibs)\r\n        .then(constructGlueObject)\r\n        .catch(function (err) {\r\n        return Promise.reject({\r\n            err: err,\r\n            libs: libs\r\n        });\r\n    });\r\n};\r\nexports.default = GlueCore;\r\n//# sourceMappingURL=glue.js.map\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports) {\n\n/**\n * Secure random string generator with custom alphabet.\n *\n * Alphabet must contain 256 symbols or less. Otherwise, the generator\n * will not be secure.\n *\n * @param {generator} random The random bytes generator.\n * @param {string} alphabet Symbols to be used in new random string.\n * @param {size} size The number of symbols in new random string.\n *\n * @return {string} Random string.\n *\n * @example\n * const format = require('nanoid/format')\n *\n * function random (size) {\n *   const result = []\n *   for (let i = 0; i < size; i++) {\n *     result.push(randomByte())\n *   }\n *   return result\n * }\n *\n * format(random, \"abcdef\", 5) //=> \"fbaef\"\n *\n * @name format\n * @function\n */\nmodule.exports = function (random, alphabet, size) {\n  var mask = (2 << Math.log(alphabet.length - 1) / Math.LN2) - 1\n  var step = Math.ceil(1.6 * mask * size / alphabet.length)\n\n  var id = ''\n  while (true) {\n    var bytes = random(step)\n    for (var i = 0; i < step; i++) {\n      var byte = bytes[i] & mask\n      if (alphabet[byte]) {\n        id += alphabet[byte]\n        if (id.length === size) return id\n      }\n    }\n  }\n}\n\n/**\n * @callback generator\n * @param {number} bytes The number of bytes to generate.\n * @return {number[]} Random bytes.\n */\n\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports) {\n\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar generate = __webpack_require__(20);\nvar alphabet = __webpack_require__(4);\n\n// Ignore all milliseconds before a certain time to reduce the size of the date entropy without sacrificing uniqueness.\n// This number should be updated every year or so to keep the generated id short.\n// To regenerate `new Date() - 0` and bump the version. Always bump the version!\nvar REDUCE_TIME = 1459707606518;\n\n// don't change unless we change the algos or REDUCE_TIME\n// must be an integer and less than 16\nvar version = 6;\n\n// Counter is used when shortid is called multiple times in one second.\nvar counter;\n\n// Remember the last time shortid was called in case counter is needed.\nvar previousSeconds;\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction build(clusterWorkerId) {\n    var str = '';\n\n    var seconds = Math.floor((Date.now() - REDUCE_TIME) * 0.001);\n\n    if (seconds === previousSeconds) {\n        counter++;\n    } else {\n        counter = 0;\n        previousSeconds = seconds;\n    }\n\n    str = str + generate(version);\n    str = str + generate(clusterWorkerId);\n    if (counter > 0) {\n        str = str + generate(counter);\n    }\n    str = str + generate(seconds);\n    return str;\n}\n\nmodule.exports = build;\n\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar alphabet = __webpack_require__(4);\nvar random = __webpack_require__(23);\nvar format = __webpack_require__(17);\n\nfunction generate(number) {\n    var loopCounter = 0;\n    var done;\n\n    var str = '';\n\n    while (!done) {\n        str = str + format(random, alphabet.get(), 1);\n        done = number < (Math.pow(16, loopCounter + 1 ) );\n        loopCounter++;\n    }\n    return str;\n}\n\nmodule.exports = generate;\n\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar alphabet = __webpack_require__(4);\nvar build = __webpack_require__(19);\nvar isValid = __webpack_require__(22);\n\n// if you are using cluster or multiple servers use this to make each instance\n// has a unique value for worker\n// Note: I don't know if this is automatically set when using third\n// party cluster solutions such as pm2.\nvar clusterWorkerId = __webpack_require__(25) || 0;\n\n/**\n * Set the seed.\n * Highly recommended if you don't want people to try to figure out your id schema.\n * exposed as shortid.seed(int)\n * @param seed Integer value to seed the random alphabet.  ALWAYS USE THE SAME SEED or you might get overlaps.\n */\nfunction seed(seedValue) {\n    alphabet.seed(seedValue);\n    return module.exports;\n}\n\n/**\n * Set the cluster worker or machine id\n * exposed as shortid.worker(int)\n * @param workerId worker must be positive integer.  Number less than 16 is recommended.\n * returns shortid module so it can be chained.\n */\nfunction worker(workerId) {\n    clusterWorkerId = workerId;\n    return module.exports;\n}\n\n/**\n *\n * sets new characters to use in the alphabet\n * returns the shuffled alphabet\n */\nfunction characters(newCharacters) {\n    if (newCharacters !== undefined) {\n        alphabet.characters(newCharacters);\n    }\n\n    return alphabet.shuffled();\n}\n\n/**\n * Generate unique id\n * Returns string id\n */\nfunction generate() {\n  return build(clusterWorkerId);\n}\n\n// Export all other functions as properties of the generate function\nmodule.exports = generate;\nmodule.exports.generate = generate;\nmodule.exports.seed = seed;\nmodule.exports.worker = worker;\nmodule.exports.characters = characters;\nmodule.exports.isValid = isValid;\n\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\nvar alphabet = __webpack_require__(4);\n\nfunction isShortId(id) {\n    if (!id || typeof id !== 'string' || id.length < 6 ) {\n        return false;\n    }\n\n    var nonAlphabetic = new RegExp('[^' +\n      alphabet.get().replace(/[|\\\\{}()[\\]^$+*?.-]/g, '\\\\$&') +\n    ']');\n    return !nonAlphabetic.test(id);\n}\n\nmodule.exports = isShortId;\n\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar crypto = typeof window === 'object' && (window.crypto || window.msCrypto); // IE 11 uses window.msCrypto\n\nvar randomByte;\n\nif (!crypto || !crypto.getRandomValues) {\n    randomByte = function(size) {\n        var bytes = [];\n        for (var i = 0; i < size; i++) {\n            bytes.push(Math.floor(Math.random() * 256));\n        }\n        return bytes;\n    };\n} else {\n    randomByte = function(size) {\n        return crypto.getRandomValues(new Uint8Array(size));\n    };\n}\n\nmodule.exports = randomByte;\n\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n// Found this seed-based random generator somewhere\n// Based on The Central Randomizer 1.3 (C) 1997 by Paul Houle (houle@msc.cornell.edu)\n\nvar seed = 1;\n\n/**\n * return a random number based on a seed\n * @param seed\n * @returns {number}\n */\nfunction getNextValue() {\n    seed = (seed * 9301 + 49297) % 233280;\n    return seed/(233280.0);\n}\n\nfunction setSeed(_seed_) {\n    seed = _seed_;\n}\n\nmodule.exports = {\n    nextValue: getNextValue,\n    seed: setSeed\n};\n\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = 0;\n\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports) {\n\n\n/**\n * Module dependencies.\n */\n\nvar global = (function() { return this; })();\n\n/**\n * WebSocket constructor.\n */\n\nvar WebSocket = global.WebSocket || global.MozWebSocket;\n\n/**\n * Module exports.\n */\n\nmodule.exports = WebSocket ? ws : null;\n\n/**\n * WebSocket constructor.\n *\n * The third `opts` options object gets ignored in web browsers, since it's\n * non-standard, and throws a TypeError if passed to the constructor.\n * See: https://github.com/einaros/ws/issues/227\n *\n * @param {String} uri\n * @param {Array} protocols (optional)\n * @param {Object) opts (optional)\n * @api public\n */\n\nfunction ws(uri, protocols, opts) {\n  var instance;\n  if (protocols) {\n    instance = new WebSocket(uri, protocols);\n  } else {\n    instance = new WebSocket(uri);\n  }\n  return instance;\n}\n\nif (WebSocket) ws.prototype = WebSocket.prototype;\n\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar client_1 = __webpack_require__(28);\r\nvar server_1 = __webpack_require__(49);\r\nvar AGMImpl = (function () {\r\n    function AGMImpl(protocol, clientRepository, serverRepository, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.clientRepository = clientRepository;\r\n        this.serverRepository = serverRepository;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n        this.client = new client_1.default(protocol, clientRepository, instance, configuration);\r\n        this.server = new server_1.default(protocol, serverRepository, instance, configuration);\r\n    }\r\n    AGMImpl.prototype.serverRemoved = function (callback) {\r\n        return this.client.serverRemoved(callback);\r\n    };\r\n    AGMImpl.prototype.serverAdded = function (callback) {\r\n        return this.client.serverAdded(callback);\r\n    };\r\n    AGMImpl.prototype.serverMethodRemoved = function (callback) {\r\n        return this.client.serverMethodRemoved(callback);\r\n    };\r\n    AGMImpl.prototype.serverMethodAdded = function (callback) {\r\n        return this.client.serverMethodAdded(callback);\r\n    };\r\n    AGMImpl.prototype.methodRemoved = function (callback) {\r\n        return this.client.methodRemoved(callback);\r\n    };\r\n    AGMImpl.prototype.methodAdded = function (callback) {\r\n        return this.client.methodAdded(callback);\r\n    };\r\n    AGMImpl.prototype.methodsForInstance = function (instance) {\r\n        return this.client.methodsForInstance(instance);\r\n    };\r\n    AGMImpl.prototype.methods = function (methodFilter) {\r\n        return this.client.methods(methodFilter);\r\n    };\r\n    AGMImpl.prototype.servers = function (methodFilter) {\r\n        return this.client.servers(methodFilter);\r\n    };\r\n    AGMImpl.prototype.subscribe = function (method, options, successCallback, errorCallback) {\r\n        return this.client.subscribe(method, options, successCallback, errorCallback);\r\n    };\r\n    AGMImpl.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback) {\r\n        return this.server.createStream(streamDef, callbacks, successCallback, errorCallback);\r\n    };\r\n    AGMImpl.prototype.unregister = function (methodFilter) {\r\n        return this.server.unregister(methodFilter);\r\n    };\r\n    AGMImpl.prototype.registerAsync = function (methodDefinition, callback) {\r\n        return this.server.registerAsync(methodDefinition, callback);\r\n    };\r\n    AGMImpl.prototype.register = function (methodDefinition, callback) {\r\n        return this.server.register(methodDefinition, callback);\r\n    };\r\n    AGMImpl.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        return this.client.invoke(methodFilter, argumentObj, target, additionalOptions, success, error);\r\n    };\r\n    AGMImpl.prototype.updateInstance = function (newInstance) {\r\n        if (this.instance.machine === undefined) {\r\n            this.instance.machine = newInstance.MachineName || newInstance.machine;\r\n        }\r\n        if (this.instance.user === undefined) {\r\n            this.instance.user = newInstance.UserName || newInstance.user;\r\n        }\r\n        if (this.instance.environment === undefined) {\r\n            this.instance.environment = newInstance.Environment || newInstance.environment;\r\n        }\r\n        if (this.instance.region === undefined) {\r\n            this.instance.region = newInstance.Region || newInstance.region;\r\n        }\r\n    };\r\n    return AGMImpl;\r\n}());\r\nexports.default = AGMImpl;\r\n//# sourceMappingURL=agm.js.map\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar invoke_1 = __webpack_require__(29);\r\nvar promisify_1 = __webpack_require__(8);\r\nvar Client = (function () {\r\n    function Client(protocol, repo, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.repo = repo;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n        this.clientInvocations = new invoke_1.default(protocol);\r\n    }\r\n    Client.prototype.subscribe = function (method, options, successCallback, errorCallback) {\r\n        var _this = this;\r\n        var callProtocolSubscribe = function (targetServers, stream, successProxy, errorProxy) {\r\n            _this.protocol.client.subscribe(stream, options.arguments, targetServers, { methodResponseTimeout: options.waitTimeoutMs }, successProxy, errorProxy);\r\n        };\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var successProxy = function (sub) {\r\n                resolve(sub);\r\n            };\r\n            var errorProxy = function (err) {\r\n                reject(err);\r\n            };\r\n            var methodDef;\r\n            if (typeof method === \"string\") {\r\n                methodDef = { name: method };\r\n            }\r\n            else {\r\n                methodDef = method;\r\n            }\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            var target = options.target;\r\n            if (target === undefined) {\r\n                target = \"best\";\r\n            }\r\n            if (typeof target === \"string\" && target !== \"all\" && target !== \"best\") {\r\n                reject({ message: '\"' + target + '\" is not a valid target. Valid targets are \"all\", \"best\", or an instance.' });\r\n            }\r\n            if (options.methodResponseTimeout === undefined) {\r\n                options.methodResponseTimeout = options.method_response_timeout;\r\n                if (options.methodResponseTimeout === undefined) {\r\n                    options.methodResponseTimeout = _this.configuration.methodResponseTimeout;\r\n                }\r\n            }\r\n            if (options.waitTimeoutMs === undefined) {\r\n                options.waitTimeoutMs = options.wait_for_method_timeout;\r\n                if (options.waitTimeoutMs === undefined) {\r\n                    options.waitTimeoutMs = _this.configuration.waitTimeoutMs;\r\n                }\r\n            }\r\n            var delayStep = 500;\r\n            var delayTillNow = 0;\r\n            var currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n            if (currentServers.length > 0) {\r\n                callProtocolSubscribe(currentServers, currentServers[0].methods[0], successProxy, errorProxy);\r\n            }\r\n            else {\r\n                var retry_1 = function () {\r\n                    delayTillNow += delayStep;\r\n                    currentServers = _this.getServerMethodsByFilterAndTarget(methodDef, target);\r\n                    if (currentServers.length > 0) {\r\n                        var streamInfo = currentServers[0].methods[0];\r\n                        callProtocolSubscribe(currentServers, streamInfo, successProxy, errorProxy);\r\n                    }\r\n                    else if (delayTillNow >= options.waitTimeoutMs) {\r\n                        var def = typeof method === \"string\" ? { name: method } : method;\r\n                        var info = {\r\n                            id: undefined,\r\n                            info: def,\r\n                            getInfoForUser: function () {\r\n                                return methodDef;\r\n                            },\r\n                            protocolState: undefined,\r\n                        };\r\n                        callProtocolSubscribe(currentServers, info, successProxy, errorProxy);\r\n                    }\r\n                    else {\r\n                        setTimeout(retry_1, delayStep);\r\n                    }\r\n                };\r\n                setTimeout(retry_1, delayStep);\r\n            }\r\n        });\r\n        return promisify_1.default(promise, successCallback, errorCallback);\r\n    };\r\n    Client.prototype.servers = function (methodFilter) {\r\n        return this.getServers(methodFilter).map(function (serverMethodMap) {\r\n            return serverMethodMap.server.getInfoForUser();\r\n        });\r\n    };\r\n    Client.prototype.methods = function (methodFilter) {\r\n        return this.getMethods(methodFilter).map(function (m) {\r\n            return m.getInfoForUser();\r\n        });\r\n    };\r\n    Client.prototype.methodsForInstance = function (instance) {\r\n        return this.getMethodsForInstance(instance).map(function (m) {\r\n            return m.getInfoForUser();\r\n        });\r\n    };\r\n    Client.prototype.methodAdded = function (callback) {\r\n        return this.repo.onMethodAdded(function (method) {\r\n            callback(method.getInfoForUser());\r\n        });\r\n    };\r\n    Client.prototype.methodRemoved = function (callback) {\r\n        return this.repo.onMethodRemoved(function (method) {\r\n            callback(method.getInfoForUser());\r\n        });\r\n    };\r\n    Client.prototype.serverAdded = function (callback) {\r\n        return this.repo.onServerAdded(function (server) {\r\n            callback(server.getInfoForUser());\r\n        });\r\n    };\r\n    Client.prototype.serverRemoved = function (callback) {\r\n        return this.repo.onServerRemoved(function (server, reason) {\r\n            callback(server.getInfoForUser(), reason);\r\n        });\r\n    };\r\n    Client.prototype.serverMethodAdded = function (callback) {\r\n        return this.repo.onServerMethodAdded(function (server, method) {\r\n            callback({ server: server.getInfoForUser(), method: method.getInfoForUser() });\r\n        });\r\n    };\r\n    Client.prototype.serverMethodRemoved = function (callback) {\r\n        return this.repo.onServerMethodRemoved(function (server, method) {\r\n            callback({ server: server.getInfoForUser(), method: method.getInfoForUser() });\r\n        });\r\n    };\r\n    Client.prototype.invoke = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var successProxy = function (args) {\r\n                resolve(args);\r\n            };\r\n            var errorProxy = function (err) {\r\n                reject(err);\r\n            };\r\n            if (!argumentObj) {\r\n                argumentObj = {};\r\n            }\r\n            if (!target) {\r\n                target = \"best\";\r\n            }\r\n            if (typeof target === \"string\" && target !== \"all\" && target !== \"best\") {\r\n                reject({ message: '\"' + target + '\" is not a valid target. Valid targets are \"all\" and \"best\".' });\r\n            }\r\n            if (!additionalOptions) {\r\n                additionalOptions = {};\r\n            }\r\n            if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                additionalOptions.methodResponseTimeoutMs = additionalOptions.method_response_timeout;\r\n                if (additionalOptions.methodResponseTimeoutMs === undefined) {\r\n                    additionalOptions.methodResponseTimeoutMs = _this.configuration.methodResponseTimeout;\r\n                }\r\n            }\r\n            if (additionalOptions.waitTimeoutMs === undefined) {\r\n                additionalOptions.waitTimeoutMs = additionalOptions.wait_for_method_timeout;\r\n                if (additionalOptions.waitTimeoutMs === undefined) {\r\n                    additionalOptions.waitTimeoutMs = _this.configuration.waitTimeoutMs;\r\n                }\r\n            }\r\n            if (additionalOptions.waitTimeoutMs !== undefined && typeof additionalOptions.waitTimeoutMs !== \"number\") {\r\n                reject({ message: '\"' + additionalOptions.waitTimeoutMs + '\" is not a valid number for \\'waitTimeoutMs\\'' });\r\n                return;\r\n            }\r\n            if (typeof argumentObj !== \"object\") {\r\n                reject({ message: \"The method arguments must be an object.\" });\r\n                return;\r\n            }\r\n            if (typeof methodFilter === \"string\") {\r\n                methodFilter = { name: methodFilter };\r\n            }\r\n            var serversMethodMap = _this.getServerMethodsByFilterAndTarget(methodFilter, target);\r\n            if (serversMethodMap.length === 0) {\r\n                _this.invokeUnExisting(methodFilter, argumentObj, target, additionalOptions, successProxy, errorProxy);\r\n            }\r\n            else if (serversMethodMap.length === 1) {\r\n                var serverMethodPair = serversMethodMap[0];\r\n                _this.clientInvocations.invoke(serverMethodPair.methods[0], argumentObj, serverMethodPair.server, additionalOptions, successProxy, errorProxy);\r\n            }\r\n            else {\r\n                _this.invokeOnAll(serversMethodMap, argumentObj, additionalOptions, successProxy, errorProxy);\r\n            }\r\n        });\r\n        return promisify_1.default(promise, success, error);\r\n    };\r\n    Client.prototype.invokeUnExisting = function (methodFilter, argumentObj, target, additionalOptions, success, error) {\r\n        var _this = this;\r\n        var callError = function () {\r\n            error({\r\n                method: methodFilter,\r\n                called_with: argumentObj,\r\n                message: \"Can not find a method matching \" + JSON.stringify(methodFilter) + \" with server filter \" + JSON.stringify(target),\r\n                executed_by: undefined,\r\n                returned: undefined,\r\n                status: undefined,\r\n            });\r\n        };\r\n        if (additionalOptions.waitTimeoutMs === 0) {\r\n            callError();\r\n        }\r\n        else {\r\n            var delayStep_1 = 500;\r\n            var delayTillNow_1 = 0;\r\n            var retry_2 = function () {\r\n                delayTillNow_1 += delayStep_1;\r\n                var serversMethodMap = _this.getServerMethodsByFilterAndTarget(methodFilter, target);\r\n                if (serversMethodMap.length > 0) {\r\n                    _this.invoke(methodFilter, argumentObj, target, additionalOptions, success, error);\r\n                }\r\n                else if (delayTillNow_1 >= additionalOptions.waitTimeoutMs) {\r\n                    callError();\r\n                }\r\n                else {\r\n                    setTimeout(retry_2, delayStep_1);\r\n                }\r\n            };\r\n            setTimeout(retry_2, delayStep_1);\r\n        }\r\n    };\r\n    Client.prototype.invokeOnAll = function (serverMethodsMap, argumentObj, additionalOptions, success, error) {\r\n        var _this = this;\r\n        var successes = [];\r\n        var errors = [];\r\n        var successCallback = function (result) {\r\n            successes.push(result);\r\n            sendResponse();\r\n        };\r\n        var errorCallback = function (err) {\r\n            errors.push(err);\r\n            sendResponse();\r\n        };\r\n        var sendResponse = function () {\r\n            if (successes.length + errors.length < serverMethodsMap.length) {\r\n                return;\r\n            }\r\n            if (successes.length !== 0) {\r\n                var result_1 = successes.reduce(function (obj, invResult) {\r\n                    obj.method = invResult.method;\r\n                    obj.called_with = invResult.called_with;\r\n                    obj.returned = invResult.returned;\r\n                    obj.all_return_values.push({\r\n                        executed_by: invResult.executed_by,\r\n                        returned: invResult.returned,\r\n                        called_with: invResult.called_with,\r\n                        method: invResult.method,\r\n                        message: undefined,\r\n                        status: undefined,\r\n                    });\r\n                    obj.executed_by = invResult.executed_by;\r\n                    return obj;\r\n                }, { all_return_values: [] });\r\n                if (errors.length !== 0) {\r\n                    result_1.all_errors = [];\r\n                    errors.forEach(function (obj) {\r\n                        result_1.all_errors.push({\r\n                            executed_by: obj.executed_by,\r\n                            called_with: obj.called_with,\r\n                            name: obj.method.name,\r\n                            message: obj.message,\r\n                        });\r\n                    });\r\n                }\r\n                success(result_1);\r\n            }\r\n            else if (errors.length !== 0) {\r\n                error(errors.reduce(function (obj, currentError) {\r\n                    obj.method = currentError.method;\r\n                    obj.called_with = currentError.called_with;\r\n                    obj.message = currentError.message;\r\n                    obj.all_errors.push({\r\n                        executed_by: currentError.executed_by,\r\n                        message: currentError.message,\r\n                    });\r\n                    return obj;\r\n                }, { all_errors: [] }));\r\n            }\r\n        };\r\n        serverMethodsMap.forEach(function (serverMethodsPair) {\r\n            _this.clientInvocations.invoke(serverMethodsPair.methods[0], argumentObj, serverMethodsPair.server, additionalOptions, successCallback, errorCallback);\r\n        });\r\n    };\r\n    Client.prototype.filterByTarget = function (target, serverMethodMap) {\r\n        var _this = this;\r\n        var targetServerMethod = [];\r\n        if (typeof target === \"string\") {\r\n            if (target === \"all\") {\r\n                targetServerMethod = serverMethodMap;\r\n            }\r\n            else if (target === \"best\") {\r\n                var matchingMachine = serverMethodMap.filter(function (serverMethodPair) {\r\n                    var serverInfo = serverMethodPair.server.info;\r\n                    return serverInfo.machine === _this.instance.machine;\r\n                })[0];\r\n                if (matchingMachine) {\r\n                    return [matchingMachine];\r\n                }\r\n                targetServerMethod = serverMethodMap[0] !== undefined ? [serverMethodMap[0]] : [];\r\n            }\r\n        }\r\n        else {\r\n            if (!Array.isArray(target)) {\r\n                target = [target];\r\n            }\r\n            if (Array.isArray(target)) {\r\n                targetServerMethod = target.reduce(function (matches, filter) {\r\n                    var myMatches = serverMethodMap.filter(function (serverMethodPair) {\r\n                        return _this.instanceMatch(filter, serverMethodPair.server.info);\r\n                    });\r\n                    return matches.concat(myMatches);\r\n                }, []);\r\n            }\r\n        }\r\n        return targetServerMethod;\r\n    };\r\n    Client.prototype.instanceMatch = function (instanceFilter, instanceDefinition) {\r\n        return this.containsProps(instanceFilter, instanceDefinition);\r\n    };\r\n    Client.prototype.methodMatch = function (methodFilter, methodDefinition) {\r\n        return this.containsProps(methodFilter, methodDefinition);\r\n    };\r\n    Client.prototype.containsProps = function (filter, object) {\r\n        return Object.keys(filter).reduce(function (match, prop) {\r\n            if (!filter[prop] || typeof filter[prop] === \"function\") {\r\n                return match;\r\n            }\r\n            if (filter[prop].constructor === RegExp) {\r\n                if (!filter[prop].test(object[prop])) {\r\n                    return false;\r\n                }\r\n                else {\r\n                    return match;\r\n                }\r\n            }\r\n            else {\r\n                if (String(filter[prop]).toLowerCase() !== String(object[prop]).toLowerCase()) {\r\n                    return false;\r\n                }\r\n                else {\r\n                    return match;\r\n                }\r\n            }\r\n        }, true);\r\n    };\r\n    Client.prototype.getMethods = function (methodFilter) {\r\n        var _this = this;\r\n        if (methodFilter === undefined) {\r\n            return this.repo.getMethods();\r\n        }\r\n        if (typeof methodFilter === \"string\") {\r\n            methodFilter = { name: methodFilter };\r\n        }\r\n        return this.repo.getMethods().filter(function (method) {\r\n            return _this.methodMatch(methodFilter, method.info);\r\n        });\r\n    };\r\n    Client.prototype.getMethodsForInstance = function (instanceFilter) {\r\n        var _this = this;\r\n        var allServers = this.repo.getServers();\r\n        var matchingServers = allServers.filter(function (server) {\r\n            return _this.instanceMatch(instanceFilter, server.info);\r\n        });\r\n        if (matchingServers.length === 0) {\r\n            return [];\r\n        }\r\n        var resultMethodsObject = {};\r\n        if (matchingServers.length === 1) {\r\n            resultMethodsObject = matchingServers[0].methods;\r\n        }\r\n        else {\r\n            matchingServers.forEach(function (server) {\r\n                Object.keys(server.methods).forEach(function (methodKey) {\r\n                    var method = server.methods[methodKey];\r\n                    resultMethodsObject[method.id] = method;\r\n                });\r\n            });\r\n        }\r\n        return Object.keys(resultMethodsObject)\r\n            .map(function (key) {\r\n            return resultMethodsObject[key];\r\n        });\r\n    };\r\n    Client.prototype.getServers = function (methodFilter) {\r\n        var _this = this;\r\n        var servers = this.repo.getServers();\r\n        if (methodFilter === undefined) {\r\n            return servers.map(function (server) {\r\n                return { server: server };\r\n            });\r\n        }\r\n        var methods = this.getMethods(methodFilter);\r\n        if (methods === undefined) {\r\n            return [];\r\n        }\r\n        return servers.reduce(function (prev, current) {\r\n            var methodsForServer = _this.repo.getServerMethodsById(current.id);\r\n            var matchingMethods = methodsForServer.filter(function (method) {\r\n                return _this.methodMatch(methodFilter, method.info);\r\n            });\r\n            if (matchingMethods.length > 0) {\r\n                prev.push({ server: current, methods: matchingMethods });\r\n            }\r\n            return prev;\r\n        }, []);\r\n    };\r\n    Client.prototype.getServerMethodsByFilterAndTarget = function (methodFilter, target) {\r\n        var serversMethodMap = this.getServers(methodFilter);\r\n        return this.filterByTarget(target, serversMethodMap);\r\n    };\r\n    return Client;\r\n}());\r\nexports.default = Client;\r\n//# sourceMappingURL=client.js.map\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nvar ClientInvocations = (function () {\r\n    function ClientInvocations(_protocol) {\r\n        var _this = this;\r\n        this._protocol = _protocol;\r\n        this._pendingCallbacks = {};\r\n        _protocol.client.onInvocationResult(function (invocationId, executedBy, status, result, resultMessage) {\r\n            return _this.processInvocationResult(invocationId, executedBy, status, result, resultMessage);\r\n        });\r\n    }\r\n    ClientInvocations.prototype.invoke = function (method, argumentsObj, target, stuff, success, error) {\r\n        var invocationId = random_1.default();\r\n        this.registerInvocation(invocationId, {\r\n            method: method,\r\n            calledWith: argumentsObj,\r\n        }, success, error, stuff.methodResponseTimeoutMs);\r\n        this._protocol.client.invoke(invocationId, method, argumentsObj, target, stuff);\r\n    };\r\n    ClientInvocations.prototype.registerInvocation = function (invocationId, invocationInfo, success, error, timeout) {\r\n        var _this = this;\r\n        this._pendingCallbacks[invocationId] = { invocationInfo: invocationInfo, success: success, error: error };\r\n        setTimeout(function () {\r\n            if (_this._pendingCallbacks[invocationId] === undefined) {\r\n                return;\r\n            }\r\n            error({\r\n                method: invocationInfo.method.getInfoForUser(),\r\n                called_with: invocationInfo.calledWith,\r\n                executed_by: undefined,\r\n                status: undefined,\r\n                returned: undefined,\r\n                message: \"Invocation timeout (\" + timeout + \" ms) reached\",\r\n            });\r\n            delete _this._pendingCallbacks[invocationId];\r\n        }, timeout);\r\n    };\r\n    ClientInvocations.prototype.processInvocationResult = function (invocationId, executedBy, status, result, resultMessage) {\r\n        var callback = this._pendingCallbacks[invocationId];\r\n        if (callback === undefined) {\r\n            return;\r\n        }\r\n        if (status === 0 && typeof callback.success === \"function\") {\r\n            callback.success({\r\n                method: callback.invocationInfo.method.getInfoForUser(),\r\n                called_with: callback.invocationInfo.calledWith,\r\n                executed_by: executedBy,\r\n                returned: result,\r\n                message: resultMessage,\r\n                status: status,\r\n            });\r\n        }\r\n        else if (typeof callback.error === \"function\") {\r\n            callback.error({\r\n                method: callback.invocationInfo.method.getInfoForUser(),\r\n                called_with: callback.invocationInfo.calledWith,\r\n                executed_by: executedBy,\r\n                message: resultMessage,\r\n                status: status,\r\n                returned: result,\r\n            });\r\n        }\r\n        delete this._pendingCallbacks[invocationId];\r\n    };\r\n    return ClientInvocations;\r\n}());\r\nexports.default = ClientInvocations;\r\n//# sourceMappingURL=invoke.js.map\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar ClientRepository = (function () {\r\n    function ClientRepository() {\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n        this.callbacks = callback_registry_1.default();\r\n    }\r\n    ClientRepository.prototype.addServer = function (info, serverId) {\r\n        var _this = this;\r\n        var current = this.servers[serverId];\r\n        if (current) {\r\n            return current.id;\r\n        }\r\n        var serverEntry = {\r\n            id: serverId,\r\n            info: info,\r\n            methods: {},\r\n            getInfoForUser: function () {\r\n                var serverInfo = _this.createUserServerInfo(serverEntry.info);\r\n                serverInfo.getMethods = function () {\r\n                    return _this.getServerMethodsById(serverEntry.id).map(function (m) {\r\n                        return m.getInfoForUser();\r\n                    });\r\n                };\r\n                serverInfo.getStreams = function () {\r\n                    return _this.getServerMethodsById(serverEntry.id)\r\n                        .filter(function (method) {\r\n                        return method.info.supportsStreaming;\r\n                    })\r\n                        .map(function (m) {\r\n                        return m.getInfoForUser();\r\n                    });\r\n                };\r\n                return serverInfo;\r\n            },\r\n        };\r\n        this.servers[serverId] = serverEntry;\r\n        this.callbacks.execute(\"onServerAdded\", serverEntry);\r\n        return serverId;\r\n    };\r\n    ClientRepository.prototype.removeServerById = function (id, reason) {\r\n        var _this = this;\r\n        var server = this.servers[id];\r\n        Object.keys(server.methods).forEach(function (methodId) {\r\n            _this.removeServerMethod(id, methodId);\r\n        });\r\n        delete this.servers[id];\r\n        this.callbacks.execute(\"onServerRemoved\", server, reason);\r\n    };\r\n    ClientRepository.prototype.addServerMethod = function (serverId, method, protocolState) {\r\n        if (!protocolState) {\r\n            protocolState = {};\r\n        }\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        var methodId = this.createMethodId(method);\r\n        if (server.methods[methodId]) {\r\n            return;\r\n        }\r\n        var that = this;\r\n        var methodEntity = {\r\n            id: methodId,\r\n            info: method,\r\n            getInfoForUser: function () {\r\n                var result = that.createUserMethodInfo(methodEntity.info);\r\n                result.getServers = function () {\r\n                    return that.getServersByMethod(methodId);\r\n                };\r\n                return result;\r\n            },\r\n            protocolState: protocolState,\r\n        };\r\n        server.methods[methodId] = methodEntity;\r\n        if (!this.methodsCount[methodId]) {\r\n            this.methodsCount[methodId] = 0;\r\n            this.callbacks.execute(\"onMethodAdded\", methodEntity);\r\n        }\r\n        this.methodsCount[methodId] = this.methodsCount[methodId] + 1;\r\n        this.callbacks.execute(\"onServerMethodAdded\", server, methodEntity);\r\n    };\r\n    ClientRepository.prototype.createMethodId = function (methodInfo) {\r\n        var accepts = methodInfo.accepts !== undefined ? methodInfo.accepts : \"\";\r\n        var returns = methodInfo.returns !== undefined ? methodInfo.returns : \"\";\r\n        return (methodInfo.name + accepts + returns).toLowerCase();\r\n    };\r\n    ClientRepository.prototype.removeServerMethod = function (serverId, methodId) {\r\n        var server = this.servers[serverId];\r\n        if (!server) {\r\n            throw new Error(\"server does not exists\");\r\n        }\r\n        var method = server.methods[methodId];\r\n        delete server.methods[methodId];\r\n        this.methodsCount[methodId] = this.methodsCount[methodId] - 1;\r\n        if (this.methodsCount[methodId] === 0) {\r\n            this.callbacks.execute(\"onMethodRemoved\", method);\r\n        }\r\n        this.callbacks.execute(\"onServerMethodRemoved\", server, method);\r\n    };\r\n    ClientRepository.prototype.getMethods = function () {\r\n        var _this = this;\r\n        var allMethods = {};\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                var method = server.methods[methodId];\r\n                allMethods[method.id] = method;\r\n            });\r\n        });\r\n        var methodsAsArray = Object.keys(allMethods).map(function (id) {\r\n            return allMethods[id];\r\n        });\r\n        return methodsAsArray;\r\n    };\r\n    ClientRepository.prototype.getServers = function () {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            allServers.push(server);\r\n        });\r\n        return allServers;\r\n    };\r\n    ClientRepository.prototype.getServerMethodsById = function (serverId) {\r\n        var server = this.servers[serverId];\r\n        return Object.keys(server.methods).map(function (id) {\r\n            return server.methods[id];\r\n        });\r\n    };\r\n    ClientRepository.prototype.onServerAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerAdded\", callback);\r\n        this.getServers().forEach(function (server) {\r\n            callback(server);\r\n        });\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodAdded\", callback);\r\n        this.getMethods().forEach(function (method) {\r\n            callback(method);\r\n        });\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerMethodAdded = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodAdded\", callback);\r\n        this.getServers().forEach(function (server) {\r\n            var methods = server.methods;\r\n            Object.keys(methods).forEach(function (methodId) {\r\n                callback(server, methods[methodId]);\r\n            });\r\n        });\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.onServerMethodRemoved = function (callback) {\r\n        var unsubscribeFunc = this.callbacks.add(\"onServerMethodRemoved\", callback);\r\n        return unsubscribeFunc;\r\n    };\r\n    ClientRepository.prototype.getServerById = function (id) {\r\n        return this.servers[id];\r\n    };\r\n    ClientRepository.prototype.reset = function () {\r\n        this.servers = {};\r\n        this.methodsCount = {};\r\n    };\r\n    ClientRepository.prototype.createUserServerInfo = function (serverInfo) {\r\n        return {\r\n            machine: serverInfo.machine,\r\n            pid: serverInfo.pid,\r\n            user: serverInfo.user,\r\n            application: serverInfo.application,\r\n            environment: serverInfo.environment,\r\n            region: serverInfo.region,\r\n            instance: serverInfo.instance,\r\n            windowId: serverInfo.windowId,\r\n            peerId: serverInfo.peerId,\r\n        };\r\n    };\r\n    ClientRepository.prototype.createUserMethodInfo = function (methodInfo) {\r\n        var result = {\r\n            name: methodInfo.name,\r\n            accepts: methodInfo.accepts,\r\n            returns: methodInfo.returns,\r\n            description: methodInfo.description,\r\n            displayName: methodInfo.displayName,\r\n            objectTypes: methodInfo.objectTypes,\r\n            supportsStreaming: methodInfo.supportsStreaming,\r\n        };\r\n        result.object_types = methodInfo.objectTypes;\r\n        result.display_name = methodInfo.displayName;\r\n        result.version = methodInfo.version;\r\n        return result;\r\n    };\r\n    ClientRepository.prototype.getServersByMethod = function (id) {\r\n        var _this = this;\r\n        var allServers = [];\r\n        Object.keys(this.servers).forEach(function (serverId) {\r\n            var server = _this.servers[serverId];\r\n            Object.keys(server.methods).forEach(function (methodId) {\r\n                if (methodId === id) {\r\n                    allServers.push(server.getInfoForUser());\r\n                }\r\n            });\r\n        });\r\n        return allServers;\r\n    };\r\n    return ClientRepository;\r\n}());\r\nexports.default = ClientRepository;\r\n//# sourceMappingURL=repository.js.map\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar promisify_1 = __webpack_require__(8);\r\nvar NativeAGM = (function () {\r\n    function NativeAGM(instance, helpers, agmFacade) {\r\n        this.instance = instance;\r\n        this.helpers = helpers;\r\n        this.agmFacade = agmFacade;\r\n        this.protocolVersion = this.agmFacade.protocolVersion;\r\n    }\r\n    NativeAGM.prototype.register = function (name, handler) {\r\n        var methodInfoAsObject = this.helpers.stringToObject(name, \"name\");\r\n        this.helpers.validateMethodInfo(methodInfoAsObject);\r\n        if (this.protocolVersion && this.protocolVersion >= 3) {\r\n            this.agmFacade.register(JSON.stringify(methodInfoAsObject), handler, true);\r\n        }\r\n        else {\r\n            this.agmFacade.register(JSON.stringify(methodInfoAsObject), function (arg, caller) {\r\n                var methodResult = handler(JSON.parse(arg), caller);\r\n                return JSON.stringify(methodResult);\r\n            });\r\n        }\r\n    };\r\n    NativeAGM.prototype.registerAsync = function (name, handler) {\r\n        if (!this.agmFacade.registerAsync) {\r\n            throw new Error(\"not supported in that version of HtmlContainer\");\r\n        }\r\n        var methodInfoAsObject = this.helpers.stringToObject(name, \"name\");\r\n        this.helpers.validateMethodInfo(methodInfoAsObject);\r\n        this.agmFacade.registerAsync(methodInfoAsObject, function (args, instance, tracker) {\r\n            handler(args, instance, function (successArgs) {\r\n                tracker.success(successArgs);\r\n            }, function (error) {\r\n                tracker.error(error);\r\n            });\r\n        });\r\n    };\r\n    NativeAGM.prototype.unregister = function (definition) {\r\n        this.agmFacade.unregister(JSON.stringify(this.helpers.stringToObject(definition, \"name\")));\r\n    };\r\n    NativeAGM.prototype.invoke = function (method, argumentObj, target, options, success, error) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (argumentObj === undefined) {\r\n                argumentObj = {};\r\n            }\r\n            if (typeof argumentObj !== \"object\") {\r\n                reject({ message: \"The method arguments must be an object.\" });\r\n            }\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            target = _this.helpers.targetArgToObject(target);\r\n            if (_this.agmFacade.invoke2) {\r\n                _this.agmFacade.invoke2(JSON.stringify(_this.helpers.stringToObject(method, \"name\")), argumentObj, JSON.stringify(target), JSON.stringify(options), function (a) {\r\n                    resolve(a);\r\n                }, function (err) {\r\n                    reject(err);\r\n                });\r\n            }\r\n            else {\r\n                var successProxy = void 0;\r\n                var errorProxy = void 0;\r\n                successProxy = function (args) {\r\n                    var parsed = JSON.parse(args);\r\n                    resolve(parsed);\r\n                };\r\n                errorProxy = function (args) {\r\n                    var parsed = JSON.parse(args);\r\n                    reject(parsed);\r\n                };\r\n                _this.agmFacade.invoke(JSON.stringify(_this.helpers.stringToObject(method, \"name\")), JSON.stringify(argumentObj), JSON.stringify(target), JSON.stringify(options), successProxy, errorProxy);\r\n            }\r\n        });\r\n        return promisify_1.default(promise, success, error);\r\n    };\r\n    NativeAGM.prototype.createStream = function (methodDefinition, options, successCallback, errorCallback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (typeof methodDefinition === \"string\") {\r\n                methodDefinition = {\r\n                    name: methodDefinition,\r\n                    getServers: function () { return []; },\r\n                };\r\n            }\r\n            if (!options) {\r\n                options = {\r\n                    subscriptionRequestHandler: undefined,\r\n                    subscriptionAddedHandler: undefined,\r\n                    subscriptionRemovedHandler: undefined,\r\n                };\r\n            }\r\n            _this.agmFacade.createStream2(JSON.stringify(methodDefinition), options.subscriptionRequestHandler, options.subscriptionAddedHandler, options.subscriptionRemovedHandler, function (stream) {\r\n                resolve(stream);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n        return promisify_1.default(promise, successCallback, errorCallback);\r\n    };\r\n    NativeAGM.prototype.subscribe = function (methodDefinition, parameters, successCallback, errorCallback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (typeof methodDefinition === \"undefined\") {\r\n                reject(\"method definition param is required\");\r\n            }\r\n            if (parameters === undefined) {\r\n                parameters = {};\r\n            }\r\n            parameters.args = JSON.stringify(parameters.arguments || {});\r\n            parameters.target = _this.helpers.targetArgToObject(parameters.target);\r\n            var name;\r\n            if (typeof methodDefinition === \"string\") {\r\n                name = methodDefinition;\r\n            }\r\n            else {\r\n                name = methodDefinition.name;\r\n            }\r\n            _this.agmFacade.subscribe2(name, JSON.stringify(parameters), function (sub) {\r\n                resolve(sub);\r\n            }, function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n        return promisify_1.default(promise, successCallback, errorCallback);\r\n    };\r\n    NativeAGM.prototype.servers = function (filter) {\r\n        var _this = this;\r\n        var jsonResult = this.agmFacade.servers(JSON.stringify(this.helpers.stringToObject(filter, \"name\")));\r\n        var parsedResult = this.helpers.agmParse(jsonResult);\r\n        return parsedResult.map(function (server) {\r\n            return _this.transformServerObject(server);\r\n        });\r\n    };\r\n    NativeAGM.prototype.methods = function (filter) {\r\n        var _this = this;\r\n        var jsonResult = this.agmFacade.methods(JSON.stringify(this.helpers.stringToObject(filter, \"name\")));\r\n        var parsedResult = this.helpers.agmParse(jsonResult);\r\n        return parsedResult.map(function (method) {\r\n            return _this.transformMethodObject(method);\r\n        });\r\n    };\r\n    NativeAGM.prototype.methodAdded = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.methodAdded(function (method) {\r\n            if (subscribed) {\r\n                callback(_this.transformMethodObject(method));\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.methodRemoved = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.methodRemoved(function (method) {\r\n            if (subscribed) {\r\n                callback(_this.transformMethodObject(method));\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.serverAdded = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.serverAdded(function (server) {\r\n            if (subscribed) {\r\n                callback(_this.transformServerObject(server));\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.serverRemoved = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.serverRemoved(function (server) {\r\n            if (subscribed) {\r\n                callback(_this.transformServerObject(server));\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.serverMethodAdded = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.serverMethodAdded(function (info) {\r\n            if (subscribed) {\r\n                callback({\r\n                    server: _this.transformServerObject(info.server),\r\n                    method: _this.transformMethodObject(info.method),\r\n                });\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.serverMethodRemoved = function (callback) {\r\n        var _this = this;\r\n        var subscribed = true;\r\n        this.agmFacade.serverMethodRemoved(function (info) {\r\n            if (subscribed) {\r\n                callback({\r\n                    server: _this.transformServerObject(info.server),\r\n                    method: _this.transformMethodObject(info.method),\r\n                });\r\n            }\r\n        });\r\n        return function () {\r\n            subscribed = false;\r\n        };\r\n    };\r\n    NativeAGM.prototype.methodsForInstance = function (server) {\r\n        var jsonResult = this.agmFacade.methodsForInstance(JSON.stringify(server));\r\n        var methods = this.helpers.agmParse(jsonResult);\r\n        return methods.map(this.transformMethodObject);\r\n    };\r\n    NativeAGM.prototype.transformMethodObject = function (method) {\r\n        var _this = this;\r\n        if (!method) {\r\n            return undefined;\r\n        }\r\n        if (!method.displayName) {\r\n            method.displayName = method.display_name;\r\n        }\r\n        if (!method.objectTypes) {\r\n            method.objectTypes = method.object_types;\r\n        }\r\n        method.getServers = function () {\r\n            return _this.servers(method.name);\r\n        };\r\n        return method;\r\n    };\r\n    NativeAGM.prototype.transformServerObject = function (server) {\r\n        var _this = this;\r\n        if (!server) {\r\n            return undefined;\r\n        }\r\n        server.getMethods = function () {\r\n            return _this.methodsForInstance(server);\r\n        };\r\n        server.getStreams = function () {\r\n            return _this.methodsForInstance(server).filter(function (method) {\r\n                return method.supportsStreaming;\r\n            });\r\n        };\r\n        return server;\r\n    };\r\n    return NativeAGM;\r\n}());\r\nexports.NativeAGM = NativeAGM;\r\n//# sourceMappingURL=agm.js.map\n\n/***/ }),\n/* 32 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Helpers = (function () {\r\n    function Helpers(facade) {\r\n        this.facade = facade;\r\n        this.dateTimeIdentifier = facade.jsonValueDatePrefix;\r\n        this.lenOfIdentifier = this.dateTimeIdentifier.length;\r\n    }\r\n    Helpers.prototype.agmParse = function (str) {\r\n        var _this = this;\r\n        return JSON.parse(str, function (k, v) {\r\n            if (typeof v !== \"string\") {\r\n                return v;\r\n            }\r\n            if (v[0] !== _this.dateTimeIdentifier[0]) {\r\n                return v;\r\n            }\r\n            if (v.indexOf(_this.dateTimeIdentifier) !== 0) {\r\n                return v;\r\n            }\r\n            var unixTimestampMs = v.substr(_this.lenOfIdentifier);\r\n            return new Date(parseFloat(unixTimestampMs));\r\n        });\r\n    };\r\n    Helpers.prototype.targetArgToObject = function (target) {\r\n        var _this = this;\r\n        target = target || \"best\";\r\n        if (typeof target === \"string\") {\r\n            if (target !== \"all\" && target !== \"best\") {\r\n                throw new Error(target + \" is not a valid target. Valid targets are 'all' and 'best'\");\r\n            }\r\n            return { target: target };\r\n        }\r\n        else {\r\n            if (!Array.isArray(target)) {\r\n                target = [target];\r\n            }\r\n            target = target.map(function (e) {\r\n                return _this.convertInstanceToRegex(e);\r\n            });\r\n            return { serverFilter: target };\r\n        }\r\n    };\r\n    Helpers.prototype.convertInstanceToRegex = function (instance) {\r\n        var instanceConverted = {};\r\n        Object.keys(instance).forEach(function (key) {\r\n            var propValue = instance[key];\r\n            instanceConverted[key] = propValue;\r\n            if (typeof propValue === \"undefined\" || propValue === null) {\r\n                return;\r\n            }\r\n            if (typeof propValue === \"string\" && propValue !== \"\") {\r\n                instanceConverted[key] = \"^\" + instance[key] + \"$\";\r\n            }\r\n            else if (instance[key].constructor === RegExp) {\r\n                instanceConverted[key] = instance[key].source;\r\n            }\r\n            else {\r\n                instanceConverted[key] = instance[key];\r\n            }\r\n        });\r\n        return instanceConverted;\r\n    };\r\n    Helpers.prototype.validateMethodInfo = function (methodInfo) {\r\n        if (typeof methodInfo === \"undefined\") {\r\n            throw Error(\"methodInfo is required argument\");\r\n        }\r\n        if (!methodInfo.name) {\r\n            throw Error(\"methodInfo object must contain name property\");\r\n        }\r\n        if (methodInfo.objectTypes) {\r\n            methodInfo.object_types = methodInfo.objectTypes;\r\n        }\r\n        if (methodInfo.displayName) {\r\n            methodInfo.display_name = methodInfo.displayName;\r\n        }\r\n    };\r\n    Helpers.prototype.stringToObject = function (param, stringPropName) {\r\n        if (typeof param === \"string\") {\r\n            var obj = {};\r\n            obj[stringPropName] = param;\r\n            return obj;\r\n        }\r\n        return param;\r\n    };\r\n    return Helpers;\r\n}());\r\nexports.Helpers = Helpers;\r\n//# sourceMappingURL=helpers.js.map\n\n/***/ }),\n/* 33 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar agm_1 = __webpack_require__(31);\r\nvar helpers_1 = __webpack_require__(32);\r\nfunction default_1(configuration) {\r\n    var facade = window.htmlContainer.jsAgmFacade;\r\n    var cfgAsString = createConfig(configuration);\r\n    return new Promise(function (resolve, reject) {\r\n        var successInit = function (instance) {\r\n            var nativeAGM = new agm_1.NativeAGM(instance, new helpers_1.Helpers(facade), facade);\r\n            nativeAGM.create_stream = nativeAGM.createStream;\r\n            nativeAGM.methods_for_instance = nativeAGM.methodsForInstance;\r\n            nativeAGM.method_added = nativeAGM.methodAdded;\r\n            nativeAGM.method_removed = nativeAGM.methodRemoved;\r\n            nativeAGM.server_added = nativeAGM.serverAdded;\r\n            nativeAGM.server_removed = nativeAGM.serverRemoved;\r\n            nativeAGM.server_method_added = nativeAGM.serverMethodAdded;\r\n            nativeAGM.server_method_removed = nativeAGM.serverMethodRemoved;\r\n            resolve(nativeAGM);\r\n        };\r\n        if (facade.protocolVersion && facade.protocolVersion >= 5 && facade.initAsync) {\r\n            facade.initAsync(cfgAsString, successInit, function (err) {\r\n                reject(err);\r\n            });\r\n        }\r\n        else {\r\n            var instance = facade.init(cfgAsString);\r\n            successInit(instance);\r\n        }\r\n    });\r\n}\r\nexports.default = default_1;\r\nvar createConfig = function (configuration) {\r\n    if (configuration !== undefined && configuration.metrics !== undefined) {\r\n        configuration.metrics.metricsIdentity = configuration.metrics.identity;\r\n        var metricsConfig = {\r\n            metricsIdentity: configuration.metrics.metricsIdentity,\r\n            path: configuration.metrics.path,\r\n        };\r\n        configuration.metrics = metricsConfig;\r\n    }\r\n    delete configuration.logger;\r\n    return JSON.stringify(configuration);\r\n};\r\n//# sourceMappingURL=native.js.map\n\n/***/ }),\n/* 34 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nfunction createOwnInstance(userSubmittedProperties, resolvedIdentity, peerId) {\r\n    var document = global.document || global.process;\r\n    var instance = {\r\n        application: document.title + random_1.default(),\r\n        pid: Math.floor(Math.random() * 10000000000),\r\n    };\r\n    instance.peerId = peerId;\r\n    if (typeof userSubmittedProperties === \"object\") {\r\n        if (userSubmittedProperties.application !== undefined) {\r\n            instance.application = userSubmittedProperties.application;\r\n        }\r\n        instance.machine = userSubmittedProperties.machine;\r\n        instance.user = userSubmittedProperties.user;\r\n        instance.environment = userSubmittedProperties.environment;\r\n        instance.region = userSubmittedProperties.region;\r\n    }\r\n    if (typeof resolvedIdentity !== \"undefined\") {\r\n        instance.user = resolvedIdentity.user;\r\n        instance.instance = resolvedIdentity.instance;\r\n        instance.application = resolvedIdentity.application;\r\n        instance.pid = resolvedIdentity.process;\r\n        instance.machine = resolvedIdentity.machine;\r\n        instance.environment = resolvedIdentity.environment;\r\n        instance.region = resolvedIdentity.region;\r\n        instance.windowId = resolvedIdentity.windowId;\r\n    }\r\n    return instance;\r\n}\r\nexports.createOwnInstance = createOwnInstance;\r\n//# sourceMappingURL=instance.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(7)))\n\n/***/ }),\n/* 35 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar instance_1 = __webpack_require__(34);\r\nvar native_1 = __webpack_require__(33);\r\nvar factory_1 = __webpack_require__(38);\r\nvar factory_2 = __webpack_require__(43);\r\nvar agm_1 = __webpack_require__(27);\r\nvar repository_1 = __webpack_require__(30);\r\nvar repository_2 = __webpack_require__(47);\r\nexports.default = (function (configuration) {\r\n    if (!configuration.forceGW && configuration.gdVersion === 2) {\r\n        return native_1.default(configuration);\r\n    }\r\n    if (typeof configuration === \"undefined\") {\r\n        throw new Error(\"configuration is required\");\r\n    }\r\n    if (typeof configuration.connection === \"undefined\") {\r\n        throw new Error(\"configuration.connections is required\");\r\n    }\r\n    var connection = configuration.connection;\r\n    if (typeof configuration.methodResponseTimeout !== \"number\") {\r\n        configuration.methodResponseTimeout = 3000;\r\n    }\r\n    if (typeof configuration.waitTimeoutMs !== \"number\") {\r\n        configuration.waitTimeoutMs = 3000;\r\n    }\r\n    var myIdentity = connection.resolvedIdentity;\r\n    var myInstance = instance_1.createOwnInstance(configuration.instance, myIdentity, connection.peerId);\r\n    var clientRepository = new repository_1.default();\r\n    var serverRepository = new repository_2.default();\r\n    var protocolPromise;\r\n    var agmImpl;\r\n    if (connection.protocolVersion === 3) {\r\n        protocolPromise = factory_2.default(myInstance, connection, clientRepository, serverRepository, configuration, function () { return agmImpl; });\r\n    }\r\n    else {\r\n        protocolPromise = factory_1.default(myInstance, connection, clientRepository, serverRepository, configuration, function () { return agmImpl; });\r\n    }\r\n    return new Promise(function (resolve, reject) {\r\n        protocolPromise.then(function (protocol) {\r\n            agmImpl = new agm_1.default(protocol, clientRepository, serverRepository, myInstance, configuration);\r\n            resolve(agmImpl);\r\n        }).catch(function (err) {\r\n            reject(err);\r\n        });\r\n    });\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 36 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nvar helpers_1 = __webpack_require__(5);\r\nvar STATUS_AWAITING_ACCEPT = \"awaitingAccept\";\r\nvar STATUS_SUBSCRIBED = \"subscribed\";\r\nvar ERR_MSG_SUB_FAILED = \"Subscription failed.\";\r\nvar ERR_MSG_SUB_REJECTED = \"Subscription rejected.\";\r\nvar ON_CLOSE_MSG_SERVER_INIT = \"ServerInitiated\";\r\nvar ON_CLOSE_MSG_CLIENT_INIT = \"ClientInitiated\";\r\nvar ClientStreaming = (function () {\r\n    function ClientStreaming(configuration, instance, sendRequest, nextResponseSubject) {\r\n        this.configuration = configuration;\r\n        this.instance = instance;\r\n        this.sendRequest = sendRequest;\r\n        this.nextResponseSubject = nextResponseSubject;\r\n        this.subscriptionsList = {};\r\n    }\r\n    ClientStreaming.prototype.subscribe = function (stream, args, targetServers, options, success, error) {\r\n        var _this = this;\r\n        if (targetServers.length === 0) {\r\n            error({\r\n                method: stream.getInfoForUser(),\r\n                message: ERR_MSG_SUB_FAILED + \" No available servers matched the target params.\",\r\n                called_with: args,\r\n            });\r\n            return;\r\n        }\r\n        var subscriptionId = \"subscriptionId_\" + random_1.default();\r\n        var pendingSub = this.registerSubscription(subscriptionId, stream, args, success, error, options.methodResponseTimeout);\r\n        if (typeof pendingSub !== \"object\") {\r\n            error({\r\n                method: stream.getInfoForUser(),\r\n                message: ERR_MSG_SUB_FAILED + \" Unable to register the user callbacks.\",\r\n                called_with: args,\r\n            });\r\n            return;\r\n        }\r\n        targetServers.forEach(function (target) {\r\n            var responseSubject = _this.nextResponseSubject();\r\n            var requestSubject = stream.info.requestSubject;\r\n            pendingSub.trackedServers.push({\r\n                server: undefined,\r\n                streamId: undefined,\r\n                streamSubjects: {\r\n                    global: undefined,\r\n                    private: undefined,\r\n                },\r\n                methodRequestSubject: requestSubject,\r\n                methodResponseSubject: responseSubject,\r\n            });\r\n            var message = {\r\n                EventStreamAction: 1,\r\n                MethodRequestSubject: requestSubject,\r\n                MethodResponseSubject: responseSubject,\r\n                Client: helpers_1.convertInstance(_this.instance),\r\n                Context: {\r\n                    ArgumentsJson: args,\r\n                    InvocationId: subscriptionId,\r\n                    MethodName: stream.info.name,\r\n                    ExecutionServer: target.server.info,\r\n                    Timeout: options.methodResponseTimeout,\r\n                },\r\n            };\r\n            _this.sendRequest(message);\r\n        });\r\n    };\r\n    ClientStreaming.prototype.processPublisherMsg = function (msg) {\r\n        if (!(msg && msg.EventStreamAction && msg.EventStreamAction !== 0)) {\r\n            return;\r\n        }\r\n        if (msg.EventStreamAction === 2) {\r\n            this.serverIsKickingASubscriber(msg);\r\n        }\r\n        else if (msg.EventStreamAction === 3) {\r\n            this.serverAcknowledgesGoodSubscription(msg);\r\n        }\r\n        else if (msg.EventStreamAction === 5) {\r\n            this.serverHasPushedSomeDataIntoTheStream(msg);\r\n        }\r\n    };\r\n    ClientStreaming.prototype.registerSubscription = function (subscriptionId, method, args, success, error, timeout) {\r\n        var _this = this;\r\n        this.subscriptionsList[subscriptionId] = {\r\n            status: STATUS_AWAITING_ACCEPT,\r\n            method: method,\r\n            arguments: args,\r\n            success: success,\r\n            error: error,\r\n            trackedServers: [],\r\n            handlers: {\r\n                onData: [],\r\n                onClosed: [],\r\n            },\r\n            queued: {\r\n                data: [],\r\n                closers: [],\r\n            },\r\n            timeoutId: undefined,\r\n        };\r\n        this.subscriptionsList[subscriptionId].timeoutId = setTimeout(function () {\r\n            if (_this.subscriptionsList[subscriptionId] === undefined) {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subscriptionId];\r\n            if (subscription.status === STATUS_AWAITING_ACCEPT) {\r\n                error({\r\n                    method: method,\r\n                    called_with: args,\r\n                    message: ERR_MSG_SUB_FAILED + \" Subscription attempt timed out after \" + timeout + \"ms.\",\r\n                });\r\n                delete _this.subscriptionsList[subscriptionId];\r\n            }\r\n            else if (subscription.status === STATUS_SUBSCRIBED &&\r\n                subscription.trackedServers.length > 0) {\r\n                subscription.trackedServers = subscription.trackedServers.filter(function (server) {\r\n                    return (typeof server.streamId === \"string\" && server.streamId !== \"\");\r\n                });\r\n                subscription.timeoutId = undefined;\r\n                if (subscription.trackedServers.length === 0) {\r\n                    var closersCount = subscription.queued.closers.length;\r\n                    var closingServer_1 = (closersCount > 0) ? subscription.queued.closers[closersCount - 1] : null;\r\n                    subscription.handlers.onClosed.forEach(function (callback) {\r\n                        if (typeof callback === \"function\") {\r\n                            callback({\r\n                                message: ON_CLOSE_MSG_SERVER_INIT,\r\n                                requestArguments: subscription.arguments,\r\n                                server: closingServer_1,\r\n                                stream: subscription.method,\r\n                            });\r\n                        }\r\n                    });\r\n                    delete _this.subscriptionsList[subscriptionId];\r\n                }\r\n            }\r\n        }, timeout);\r\n        return this.subscriptionsList[subscriptionId];\r\n    };\r\n    ClientStreaming.prototype.serverIsKickingASubscriber = function (msg) {\r\n        var _this = this;\r\n        var keys = Object.keys(this.subscriptionsList);\r\n        if (typeof msg.InvocationId === \"string\" && msg.InvocationId !== \"\") {\r\n            keys = keys.filter(function (k) { return k === msg.InvocationId; });\r\n        }\r\n        var deletionsList = [];\r\n        keys.forEach(function (key) {\r\n            if (typeof _this.subscriptionsList[key] !== \"object\") {\r\n                return;\r\n            }\r\n            _this.subscriptionsList[key].trackedServers = _this.subscriptionsList[key].trackedServers.filter(function (server) {\r\n                var isRejecting = (server.methodRequestSubject === msg.MethodRequestSubject && server.methodResponseSubject === msg.MethodResponseSubject);\r\n                var isKicking = (server.streamId === msg.StreamId &&\r\n                    (server.streamSubjects.global === msg.EventStreamSubject || server.streamSubjects.private === msg.EventStreamSubject));\r\n                var isRejectingOrKicking = isRejecting || isKicking;\r\n                return !isRejectingOrKicking;\r\n            });\r\n            if (_this.subscriptionsList[key].trackedServers.length === 0) {\r\n                deletionsList.push(key);\r\n            }\r\n        });\r\n        deletionsList.forEach(function (key) {\r\n            if (typeof _this.subscriptionsList[key] !== \"object\") {\r\n                return;\r\n            }\r\n            if (_this.subscriptionsList[key].status === STATUS_AWAITING_ACCEPT &&\r\n                typeof _this.subscriptionsList[key].timeoutId === \"number\") {\r\n                var reason = (typeof msg.ResultMessage === \"string\" && msg.ResultMessage !== \"\") ?\r\n                    ' Publisher said \"' + msg.ResultMessage + '\".' :\r\n                    \" No reason given.\";\r\n                var callArgs = typeof _this.subscriptionsList[key].arguments === \"object\" ?\r\n                    JSON.stringify(_this.subscriptionsList[key].arguments) :\r\n                    \"{}\";\r\n                _this.subscriptionsList[key].error(ERR_MSG_SUB_REJECTED + reason + \" Called with:\" + callArgs);\r\n                clearTimeout(_this.subscriptionsList[key].timeoutId);\r\n            }\r\n            else {\r\n                _this.subscriptionsList[key].handlers.onClosed.forEach(function (callback) {\r\n                    if (typeof callback !== \"function\") {\r\n                        return;\r\n                    }\r\n                    callback({\r\n                        message: ON_CLOSE_MSG_SERVER_INIT,\r\n                        requestArguments: _this.subscriptionsList[key].arguments,\r\n                        server: helpers_1.convertInfoToInstance(msg.Server),\r\n                        stream: _this.subscriptionsList[key].method,\r\n                    });\r\n                });\r\n            }\r\n            delete _this.subscriptionsList[key];\r\n        });\r\n    };\r\n    ClientStreaming.prototype.serverAcknowledgesGoodSubscription = function (msg) {\r\n        var _this = this;\r\n        var subscriptionId = msg.InvocationId;\r\n        var subscription = this.subscriptionsList[subscriptionId];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        var acceptingServer = subscription.trackedServers.filter(function (server) {\r\n            return (server.methodRequestSubject === msg.MethodRequestSubject &&\r\n                server.methodResponseSubject === msg.MethodResponseSubject);\r\n        })[0];\r\n        if (typeof acceptingServer !== \"object\") {\r\n            return;\r\n        }\r\n        var isFirstResponse = (subscription.status === STATUS_AWAITING_ACCEPT);\r\n        subscription.status = STATUS_SUBSCRIBED;\r\n        var privateStreamSubject = this.generatePrivateStreamSubject(subscription.method.name);\r\n        if (typeof acceptingServer.streamId === \"string\" && acceptingServer.streamId !== \"\") {\r\n            return;\r\n        }\r\n        acceptingServer.server = helpers_1.convertInfoToInstance(msg.Server);\r\n        acceptingServer.streamId = msg.StreamId;\r\n        acceptingServer.streamSubjects.global = msg.EventStreamSubject;\r\n        acceptingServer.streamSubjects.private = privateStreamSubject;\r\n        var confirmatoryRequest = {\r\n            EventStreamAction: 3,\r\n            EventStreamSubject: privateStreamSubject,\r\n            StreamId: msg.StreamId,\r\n            MethodRequestSubject: msg.MethodRequestSubject,\r\n            MethodResponseSubject: acceptingServer.methodResponseSubject,\r\n            Client: helpers_1.convertInstance(this.instance),\r\n            Context: {\r\n                ArgumentsJson: subscription.arguments,\r\n                MethodName: subscription.method.name,\r\n            },\r\n        };\r\n        this.sendRequest(confirmatoryRequest);\r\n        if (isFirstResponse) {\r\n            subscription.success({\r\n                onData: function (dataCallback) {\r\n                    if (typeof dataCallback !== \"function\") {\r\n                        throw new TypeError(\"The data callback must be a function.\");\r\n                    }\r\n                    this.handlers.onData.push(dataCallback);\r\n                    if (this.handlers.onData.length === 1 && this.queued.data.length > 0) {\r\n                        this.queued.data.forEach(function (dataItem) {\r\n                            dataCallback(dataItem);\r\n                        });\r\n                    }\r\n                }.bind(subscription),\r\n                onClosed: function (closedCallback) {\r\n                    if (typeof closedCallback !== \"function\") {\r\n                        throw new TypeError(\"The callback must be a function.\");\r\n                    }\r\n                    this.handlers.onClosed.push(closedCallback);\r\n                }.bind(subscription),\r\n                onFailed: function () { },\r\n                close: function () { return _this.closeSubscription(subscription, subscriptionId); },\r\n                requestArguments: subscription.arguments,\r\n                serverInstance: helpers_1.convertInfoToInstance(msg.Server),\r\n                stream: subscription.method,\r\n            });\r\n        }\r\n    };\r\n    ClientStreaming.prototype.serverHasPushedSomeDataIntoTheStream = function (msg) {\r\n        var _loop_1 = function (key) {\r\n            if (this_1.subscriptionsList.hasOwnProperty(key) && typeof this_1.subscriptionsList[key] === \"object\") {\r\n                var isPrivateData = void 0;\r\n                var trackedServersFound = this_1.subscriptionsList[key].trackedServers.filter(function (ls) {\r\n                    return (ls.streamId === msg.StreamId &&\r\n                        (ls.streamSubjects.global === msg.EventStreamSubject ||\r\n                            ls.streamSubjects.private === msg.EventStreamSubject));\r\n                });\r\n                if (trackedServersFound.length === 0) {\r\n                    isPrivateData = undefined;\r\n                }\r\n                else if (trackedServersFound[0].streamSubjects.global === msg.EventStreamSubject) {\r\n                    isPrivateData = false;\r\n                }\r\n                else if (trackedServersFound[0].streamSubjects.private === msg.EventStreamSubject) {\r\n                    isPrivateData = true;\r\n                }\r\n                if (isPrivateData !== undefined) {\r\n                    var receivedStreamData_1 = {\r\n                        data: msg.ResultContextJson,\r\n                        server: helpers_1.convertInfoToInstance(msg.Server),\r\n                        requestArguments: this_1.subscriptionsList[key].arguments || {},\r\n                        message: msg.ResultMessage,\r\n                        private: isPrivateData,\r\n                    };\r\n                    var onDataHandlers = this_1.subscriptionsList[key].handlers.onData;\r\n                    var queuedData = this_1.subscriptionsList[key].queued.data;\r\n                    if (Array.isArray(onDataHandlers)) {\r\n                        if (onDataHandlers.length > 0) {\r\n                            onDataHandlers.forEach(function (callback) {\r\n                                if (typeof callback === \"function\") {\r\n                                    callback(receivedStreamData_1);\r\n                                }\r\n                            });\r\n                        }\r\n                        else {\r\n                            queuedData.push(receivedStreamData_1);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        var this_1 = this;\r\n        for (var key in this.subscriptionsList) {\r\n            _loop_1(key);\r\n        }\r\n    };\r\n    ClientStreaming.prototype.closeSubscription = function (sub, subId) {\r\n        var _this = this;\r\n        var responseSubject = this.nextResponseSubject();\r\n        sub.trackedServers.forEach(function (server) {\r\n            _this.sendRequest({\r\n                EventStreamAction: 2,\r\n                Client: helpers_1.convertInstance(_this.instance),\r\n                MethodRequestSubject: server.methodRequestSubject,\r\n                MethodResponseSubject: responseSubject,\r\n                StreamId: server.streamId,\r\n                EventStreamSubject: server.streamSubjects.private,\r\n            });\r\n        });\r\n        sub.handlers.onClosed.forEach(function (callback) {\r\n            if (typeof callback === \"function\") {\r\n                callback({\r\n                    message: ON_CLOSE_MSG_CLIENT_INIT,\r\n                    requestArguments: sub.arguments || {},\r\n                    server: sub.trackedServers[sub.trackedServers.length - 1].server,\r\n                    stream: sub.method,\r\n                });\r\n            }\r\n        });\r\n        delete this.subscriptionsList[subId];\r\n    };\r\n    ClientStreaming.prototype.generatePrivateStreamSubject = function (methodName) {\r\n        var appInfo = helpers_1.convertInstance(this.instance);\r\n        return \"ESSpriv-jsb_\" +\r\n            appInfo.ApplicationName +\r\n            \"_on_\" +\r\n            methodName +\r\n            \"_\" +\r\n            random_1.default();\r\n    };\r\n    return ClientStreaming;\r\n}());\r\nexports.default = ClientStreaming;\r\n//# sourceMappingURL=client-streaming.js.map\n\n/***/ }),\n/* 37 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar client_streaming_1 = __webpack_require__(36);\r\nvar helpers_1 = __webpack_require__(5);\r\nvar numberMissingHeartbeatsToRemove = 3;\r\nvar ClientProtocol = (function () {\r\n    function ClientProtocol(connection, instance, configuration, repository) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n        this.repository = repository;\r\n        this.respCounter = 0;\r\n        this.callbacks = callback_registry_1.default();\r\n        this.timers = {};\r\n        this.timers = {};\r\n        this.streaming = new client_streaming_1.default(configuration, instance, function (msg) {\r\n            connection.send(\"agm\", \"MethodInvocationRequestMessage\", msg);\r\n        }, function () { return _this.nextResponseSubject(); });\r\n        this.listenForEvents();\r\n    }\r\n    ClientProtocol.prototype.subscribe = function (stream, args, targetServers, options, success, error) {\r\n        this.streaming.subscribe(stream, args, targetServers, options, success, error);\r\n    };\r\n    ClientProtocol.prototype.onInvocationResult = function (callback) {\r\n        this.callbacks.add(\"onResult\", callback);\r\n    };\r\n    ClientProtocol.prototype.invoke = function (id, method, args, target, stuff) {\r\n        var methodInfo = method.info;\r\n        var message = {\r\n            MethodRequestSubject: methodInfo.requestSubject,\r\n            MethodResponseSubject: this.nextResponseSubject(),\r\n            Client: helpers_1.convertInstance(this.instance),\r\n            Context: {\r\n                ArgumentsJson: args,\r\n                InvocationId: id,\r\n                MethodName: methodInfo.name,\r\n                ExecutionServer: target.info,\r\n                Timeout: stuff.methodResponseTimeoutMs,\r\n            },\r\n        };\r\n        this.connection.send(\"agm\", \"MethodInvocationRequestMessage\", message);\r\n    };\r\n    ClientProtocol.prototype.nextResponseSubject = function () {\r\n        return \"resp_\" + (this.respCounter++) + \"_\" + random_1.default();\r\n    };\r\n    ClientProtocol.prototype.createServerInfo = function (instance) {\r\n        return {\r\n            machine: instance.MachineName,\r\n            pid: instance.ProcessId,\r\n            user: instance.UserName,\r\n            application: instance.ApplicationName,\r\n            environment: instance.Environment,\r\n            region: instance.Region,\r\n        };\r\n    };\r\n    ClientProtocol.prototype.createMethod = function (methodInfo) {\r\n        var method = methodInfo.Method;\r\n        return {\r\n            name: method.Name,\r\n            accepts: method.InputSignature,\r\n            returns: method.ResultSignature,\r\n            requestSubject: methodInfo.MethodRequestSubject,\r\n            description: method.Description,\r\n            displayName: method.DisplayName,\r\n            version: method.Version,\r\n            objectTypes: method.ObjectTypeRestrictions,\r\n            supportsStreaming: helpers_1.isStreamingFlagSet(method.Flags),\r\n        };\r\n    };\r\n    ClientProtocol.prototype.createServerId = function (serverInfo) {\r\n        if (serverInfo === undefined) {\r\n            return undefined;\r\n        }\r\n        return [serverInfo.application,\r\n            serverInfo.user,\r\n            serverInfo.machine,\r\n            serverInfo.started,\r\n            serverInfo.pid].join(\"/\").toLowerCase();\r\n    };\r\n    ClientProtocol.prototype.processServerPresence = function (presence, isPresence) {\r\n        var instance = presence.Instance;\r\n        var serverInfo = this.createServerInfo(instance);\r\n        var serverId = this.createServerId(serverInfo);\r\n        if (isPresence) {\r\n            serverId = this.repository.addServer(serverInfo, serverId);\r\n            if (presence.PublishingInterval) {\r\n                this.scheduleTimeout(serverId, presence.PublishingInterval);\r\n            }\r\n        }\r\n        else if (presence.PublishingInterval === 0) {\r\n            var server = this.repository.getServerById(serverId);\r\n            if (typeof server !== \"undefined\") {\r\n                this.repository.removeServerById(serverId);\r\n            }\r\n        }\r\n        if (presence.MethodDefinitions !== undefined) {\r\n            this.updateServerMethods(serverId, presence.MethodDefinitions);\r\n        }\r\n    };\r\n    ClientProtocol.prototype.scheduleTimeout = function (serverId, duration) {\r\n        var _this = this;\r\n        if (duration === -1) {\r\n            return;\r\n        }\r\n        var timer = this.timers[serverId];\r\n        if (timer !== undefined) {\r\n            clearTimeout(timer);\r\n        }\r\n        this.timers[serverId] = setTimeout(function () {\r\n            _this.repository.removeServerById(serverId);\r\n        }, duration * (numberMissingHeartbeatsToRemove + 1));\r\n    };\r\n    ClientProtocol.prototype.updateServerMethods = function (serverId, newMethods) {\r\n        var _this = this;\r\n        var oldMethods = this.repository.getServerMethodsById(serverId);\r\n        var newMethodsReduced = newMethods\r\n            .map(function (nm) { return _this.createMethod(nm); })\r\n            .reduce(function (obj, method) {\r\n            var methodId = _this.repository.createMethodId(method);\r\n            obj[methodId] = method;\r\n            return obj;\r\n        }, {});\r\n        oldMethods.forEach(function (method) {\r\n            if (newMethodsReduced[method.id] === undefined) {\r\n                _this.repository.removeServerMethod(serverId, method.id);\r\n            }\r\n            else {\r\n                delete newMethodsReduced[method.id];\r\n            }\r\n        });\r\n        Object.keys(newMethodsReduced).forEach(function (key) {\r\n            var method = newMethodsReduced[key];\r\n            _this.repository.addServerMethod(serverId, method);\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleInvokeResultMessage = function (message) {\r\n        if (message && message.EventStreamAction && message.EventStreamAction !== 0) {\r\n            this.streaming.processPublisherMsg(message);\r\n            return;\r\n        }\r\n        var server = message.Server ? this.createServerInfo(message.Server) : undefined;\r\n        var result = message.ResultContextJson;\r\n        if (result && Object.keys(result).length === 0) {\r\n            result = undefined;\r\n        }\r\n        this.callbacks.execute(\"onResult\", message.InvocationId, server, message.Status, result, message.ResultMessage);\r\n    };\r\n    ClientProtocol.prototype.listenForEvents = function () {\r\n        var _this = this;\r\n        this.connection.on(\"agm\", \"ServerPresenceMessage\", function (msg) {\r\n            _this.processServerPresence(msg, true);\r\n        });\r\n        this.connection.on(\"agm\", \"ServerHeartbeatMessage\", function (msg) {\r\n            _this.processServerPresence(msg, false);\r\n        });\r\n        this.connection.on(\"agm\", \"MethodInvocationResultMessage\", function (msg) {\r\n            _this.handleInvokeResultMessage(msg);\r\n        });\r\n    };\r\n    return ClientProtocol;\r\n}());\r\nexports.default = ClientProtocol;\r\n//# sourceMappingURL=client.js.map\n\n/***/ }),\n/* 38 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar server_1 = __webpack_require__(40);\r\nvar client_1 = __webpack_require__(37);\r\nfunction default_1(instance, connection, clientRepository, serverRepository, configuration, getAGM) {\r\n    var unsubscribe = connection.on(\"agm\", \"Instance\", function (newInstance) {\r\n        getAGM().updateInstance(newInstance);\r\n        connection.off(unsubscribe);\r\n    });\r\n    var server = new server_1.default(connection, instance, configuration, serverRepository);\r\n    var client = new client_1.default(connection, instance, configuration, clientRepository);\r\n    return new Promise(function (resolve) {\r\n        resolve({\r\n            server: server,\r\n            client: client,\r\n        });\r\n    });\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=factory.js.map\n\n/***/ }),\n/* 39 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nvar helpers_1 = __webpack_require__(5);\r\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(connection, instance) {\r\n        this.connection = connection;\r\n        this.instance = instance;\r\n    }\r\n    ServerStreaming.prototype.isStreamMsg = function (msg, method) {\r\n        return (msg &&\r\n            msg.EventStreamAction &&\r\n            msg.EventStreamAction !== 0 &&\r\n            typeof method === \"object\" &&\r\n            method.definition.supportsStreaming === true);\r\n    };\r\n    ServerStreaming.prototype.pushData = function (streamingMethod, data, branches) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        if (typeof branches === \"string\") {\r\n            branches = [branches];\r\n        }\r\n        else if (!Array.isArray(branches) || branches.length <= 0) {\r\n            branches = null;\r\n        }\r\n        var streamIdList = streamingMethod.protocolState.branchKeyToStreamIdMap\r\n            .filter(function (br) {\r\n            return (branches === null || (Boolean(br) && typeof br.key === \"string\" && branches.indexOf(br.key) >= 0));\r\n        }).map(function (br) {\r\n            return br.streamId;\r\n        });\r\n        var server = helpers_1.convertInstance(this.instance);\r\n        streamIdList.forEach(function (streamId) {\r\n            _this.sendResult({\r\n                EventStreamAction: 5,\r\n                EventStreamSubject: streamingMethod.protocolState.globalEventStreamSubject,\r\n                MethodName: streamingMethod.protocolState.method.Method.Name,\r\n                MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n                ResultContextJson: data,\r\n                Server: server,\r\n                StreamId: streamId,\r\n            });\r\n        });\r\n    };\r\n    ServerStreaming.prototype.closeAllSubscriptions = function (streamingMethod, branchKey) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        var streamList = streamingMethod.protocolState.branchKeyToStreamIdMap;\r\n        if (typeof branchKey === \"string\") {\r\n            streamList = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (br) {\r\n                return (typeof br === \"object\" && br.key === branchKey);\r\n            });\r\n        }\r\n        streamList.forEach(function (br) {\r\n            var streamId = br.streamId;\r\n            _this.sendResult({\r\n                EventStreamAction: 2,\r\n                EventStreamSubject: streamingMethod.protocolState.globalEventStreamSubject,\r\n                MethodName: streamingMethod.protocolState.method.Method.Name,\r\n                MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n                Server: helpers_1.convertInstance(_this.instance),\r\n                StreamId: streamId,\r\n                Status: 0,\r\n            });\r\n        });\r\n    };\r\n    ServerStreaming.prototype.getBranchList = function (streamingMethod) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        return this.getUniqueBranchNames(streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.getSubscriptionList = function (streamingMethod, branchKey) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var subscriptions = [];\r\n        if (typeof branchKey !== \"string\") {\r\n            subscriptions = streamingMethod.protocolState.subscriptions;\r\n        }\r\n        else {\r\n            subscriptions = streamingMethod.protocolState.subscriptions.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        return subscriptions;\r\n    };\r\n    ServerStreaming.prototype.onSubAdded = function (handlerFunc) {\r\n        if (typeof handlerFunc !== \"function\") {\r\n            return;\r\n        }\r\n        this.subAddedHandler = handlerFunc;\r\n    };\r\n    ServerStreaming.prototype.onSubRemoved = function (handlerFunc) {\r\n        if (typeof handlerFunc !== \"function\") {\r\n            return;\r\n        }\r\n        this.subRemovedHandler = handlerFunc;\r\n    };\r\n    ServerStreaming.prototype.onSubRequest = function (handlerFunc) {\r\n        if (typeof handlerFunc !== \"function\") {\r\n            return;\r\n        }\r\n        this.requestHandler = handlerFunc;\r\n    };\r\n    ServerStreaming.prototype.generateNewStreamId = function (streamingMethodName) {\r\n        var appInfo = helpers_1.convertInstance(this.instance);\r\n        return \"streamId-jsb_of_\" +\r\n            streamingMethodName +\r\n            \"__by_\" +\r\n            appInfo.ApplicationName +\r\n            \"_\" +\r\n            random_1.default();\r\n    };\r\n    ServerStreaming.prototype.rejectRequest = function (requestContext, streamingMethod, reason) {\r\n        if (typeof reason !== \"string\") {\r\n            reason = \"\";\r\n        }\r\n        var msg = requestContext.msg;\r\n        this.sendResult({\r\n            EventStreamAction: 2,\r\n            EventStreamSubject: streamingMethod.protocolState.globalEventStreamSubject,\r\n            MethodName: streamingMethod.protocolState.method.Method.Name,\r\n            MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n            MethodResponseSubject: msg.MethodResponseSubject,\r\n            MethodVersion: streamingMethod.protocolState.method.Method.Version,\r\n            ResultMessage: reason,\r\n            Server: helpers_1.convertInstance(this.instance),\r\n            StreamId: \"default_rejection_streamId\",\r\n        });\r\n    };\r\n    ServerStreaming.prototype.pushDataToSingle = function (streamingMethod, subscription, data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        this.sendResult({\r\n            EventStreamAction: 5,\r\n            EventStreamSubject: subscription.privateEventStreamSubject,\r\n            MethodName: streamingMethod.protocolState.method.Method.Name,\r\n            MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n            ResultContextJson: data,\r\n            Server: helpers_1.convertInstance(this.instance),\r\n            StreamId: subscription.streamId,\r\n        });\r\n    };\r\n    ServerStreaming.prototype.closeSingleSubscription = function (streamingMethod, subscription) {\r\n        this.closeIndividualSubscription(streamingMethod, subscription.streamId, subscription.privateEventStreamSubject, true);\r\n    };\r\n    ServerStreaming.prototype.acceptRequestOnBranch = function (requestContext, streamingMethod, branch) {\r\n        if (typeof branch !== \"string\") {\r\n            branch = \"\";\r\n        }\r\n        var streamId = this.getStreamId(streamingMethod, branch);\r\n        var msg = requestContext.msg;\r\n        this.sendResult({\r\n            EventStreamAction: 3,\r\n            EventStreamSubject: streamingMethod.protocolState.globalEventStreamSubject,\r\n            InvocationId: msg.Context.InvocationId,\r\n            MethodName: streamingMethod.protocolState.method.Method.Name,\r\n            MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n            MethodResponseSubject: msg.MethodResponseSubject,\r\n            MethodVersion: streamingMethod.protocolState.method.Method.Version,\r\n            ResultMessage: \"Accepted\",\r\n            Server: helpers_1.convertInstance(this.instance),\r\n            StreamId: streamId,\r\n        });\r\n    };\r\n    ServerStreaming.prototype.processSubscriberMsg = function (msg, streamingMethod) {\r\n        if (!(msg && msg.EventStreamAction && msg.EventStreamAction !== 0)) {\r\n            return;\r\n        }\r\n        if (msg.EventStreamAction === 1) {\r\n            this.clientWishesToSubscribe(msg, streamingMethod);\r\n        }\r\n        else if (msg.EventStreamAction === 2) {\r\n            this.clientWishesToUnsubscribe(msg, streamingMethod);\r\n        }\r\n        else if (msg.EventStreamAction === 3) {\r\n            this.clientAcknowledgesItDidSubscribe(msg, streamingMethod);\r\n        }\r\n        else if (msg.EventStreamAction === 4) {\r\n            this.clientPerSubHeartbeat(msg);\r\n        }\r\n    };\r\n    ServerStreaming.prototype.sendResult = function (message) {\r\n        if (typeof message !== \"object\") {\r\n            throw new Error(\"Invalid message.\");\r\n        }\r\n        if (typeof message.Status !== \"number\") {\r\n            message.Status = 0;\r\n        }\r\n        this.connection.send(\"agm\", \"MethodInvocationResultMessage\", message);\r\n    };\r\n    ServerStreaming.prototype.clientWishesToSubscribe = function (msg, streamingMethod) {\r\n        var requestContext = {\r\n            msg: msg,\r\n            arguments: msg.Context.ArgumentsJson || {},\r\n            instance: helpers_1.convertInfoToInstance(msg.Client),\r\n        };\r\n        if (typeof this.requestHandler === \"function\") {\r\n            this.requestHandler(requestContext, streamingMethod);\r\n        }\r\n    };\r\n    ServerStreaming.prototype.clientWishesToUnsubscribe = function (msg, streamingMethod) {\r\n        if (!(streamingMethod &&\r\n            Array.isArray(streamingMethod.protocolState.subscriptions) &&\r\n            streamingMethod.protocolState.subscriptions.length > 0)) {\r\n            return;\r\n        }\r\n        this.closeIndividualSubscription(streamingMethod, msg.StreamId, msg.EventStreamSubject, false);\r\n    };\r\n    ServerStreaming.prototype.clientAcknowledgesItDidSubscribe = function (msg, streamingMethod) {\r\n        if (typeof msg.StreamId !== \"string\" || msg.StreamId === \"\") {\r\n            return;\r\n        }\r\n        var branchKey = this.getBranchKey(streamingMethod, msg.StreamId);\r\n        if (typeof branchKey !== \"string\") {\r\n            return;\r\n        }\r\n        if (!Array.isArray(streamingMethod.protocolState.subscriptions)) {\r\n            return;\r\n        }\r\n        var subscription = {\r\n            branchKey: branchKey,\r\n            instance: helpers_1.convertInfoToInstance(msg.Client),\r\n            arguments: msg.Context.ArgumentsJson,\r\n            streamId: msg.StreamId,\r\n            privateEventStreamSubject: msg.EventStreamSubject,\r\n            methodResponseSubject: msg.MethodResponseSubject,\r\n        };\r\n        streamingMethod.protocolState.subscriptions.push(subscription);\r\n        if (typeof this.subAddedHandler === \"function\") {\r\n            this.subAddedHandler(subscription, streamingMethod);\r\n        }\r\n    };\r\n    ServerStreaming.prototype.clientPerSubHeartbeat = function (msg) {\r\n    };\r\n    ServerStreaming.prototype.getBranchKey = function (streamingMethod, streamId) {\r\n        if (typeof streamId !== \"string\" || typeof streamingMethod !== \"object\") {\r\n            return;\r\n        }\r\n        var needle = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.streamId === streamId;\r\n        })[0];\r\n        if (typeof needle !== \"object\" || typeof needle.key !== \"string\") {\r\n            return;\r\n        }\r\n        return needle.key;\r\n    };\r\n    ServerStreaming.prototype.getStreamId = function (streamingMethod, branchKey) {\r\n        if (typeof branchKey !== \"string\") {\r\n            branchKey = \"\";\r\n        }\r\n        var needleBranch = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.key === branchKey;\r\n        })[0];\r\n        var streamId = (needleBranch ? needleBranch.streamId : undefined);\r\n        if (typeof streamId !== \"string\" || streamId === \"\") {\r\n            streamId = this.generateNewStreamId(streamingMethod.protocolState.method.Method.Name);\r\n            streamingMethod.protocolState.branchKeyToStreamIdMap.push({ key: branchKey, streamId: streamId });\r\n        }\r\n        return streamId;\r\n    };\r\n    ServerStreaming.prototype.closeIndividualSubscription = function (streamingMethod, streamId, privateEventStreamSubject, sendKickMessage) {\r\n        var subscription = streamingMethod.protocolState.subscriptions.filter(function (subItem) {\r\n            return (subItem.privateEventStreamSubject === privateEventStreamSubject &&\r\n                subItem.streamId === streamId);\r\n        })[0];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        var initialLength = streamingMethod.protocolState.subscriptions.length;\r\n        streamingMethod.protocolState.subscriptions = streamingMethod.protocolState.subscriptions.filter(function (subItem) {\r\n            return !(subItem.privateEventStreamSubject === subscription.privateEventStreamSubject &&\r\n                subItem.streamId === subscription.streamId);\r\n        });\r\n        var filteredLength = streamingMethod.protocolState.subscriptions.length;\r\n        if (filteredLength !== (initialLength - 1)) {\r\n            return;\r\n        }\r\n        if (sendKickMessage === true) {\r\n            this.sendResult({\r\n                EventStreamAction: 2,\r\n                EventStreamSubject: privateEventStreamSubject,\r\n                MethodName: streamingMethod.protocolState.method.Method.Name,\r\n                MethodRequestSubject: streamingMethod.protocolState.method.MethodRequestSubject,\r\n                MethodResponseSubject: subscription.methodResponseSubject,\r\n                MethodVersion: streamingMethod.protocolState.method.Method.Version,\r\n                ResponseContextJson: {},\r\n                Server: helpers_1.convertInstance(this.instance),\r\n                StreamId: subscription.streamId,\r\n                Status: 0,\r\n            });\r\n        }\r\n        if (typeof this.subRemovedHandler === \"function\") {\r\n            this.subRemovedHandler(subscription, streamingMethod);\r\n        }\r\n    };\r\n    ServerStreaming.prototype.getUniqueBranchNames = function (streamingMethod) {\r\n        var keysWithDuplicates = streamingMethod.protocolState.subscriptions.map(function (sub) {\r\n            var result = null;\r\n            if (typeof sub === \"object\" && typeof sub.branchKey === \"string\") {\r\n                result = sub.branchKey;\r\n            }\r\n            return result;\r\n        });\r\n        var seen = [];\r\n        var branchArray = keysWithDuplicates.filter(function (bKey) {\r\n            if (bKey === null || seen.indexOf(bKey) >= 0) {\r\n                return false;\r\n            }\r\n            seen.push(bKey);\r\n            return true;\r\n        });\r\n        return branchArray;\r\n    };\r\n    return ServerStreaming;\r\n}());\r\nexports.default = ServerStreaming;\r\n//# sourceMappingURL=server-streaming.js.map\n\n/***/ }),\n/* 40 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar random_1 = __webpack_require__(3);\r\nvar server_streaming_1 = __webpack_require__(39);\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar helpers_1 = __webpack_require__(5);\r\nvar HeartbeatInterval = 5000;\r\nvar PresenceInterval = 10000;\r\nvar ServerProtocol = (function () {\r\n    function ServerProtocol(connection, instance, configuration, serverRepository) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        this.instance = instance;\r\n        this.serverRepository = serverRepository;\r\n        this.invocationMessagesMap = {};\r\n        this.reqCounter = 0;\r\n        this.callbacks = callback_registry_1.default();\r\n        this.streaming = new server_streaming_1.default(connection, instance);\r\n        connection.on(\"agm\", \"MethodInvocationRequestMessage\", function (msg) { return _this.handleMethodInvocationMessage(msg); });\r\n        connection.disconnected(this.stopTimers.bind(this));\r\n        this.sendHeartbeat();\r\n        if (this.heartbeatTimer === undefined) {\r\n            this.heartbeatTimer = setInterval(function () { return _this.sendHeartbeat(); }, HeartbeatInterval);\r\n        }\r\n        this.getBranchList = this.streaming.getBranchList;\r\n        this.getSubscriptionList = this.streaming.getSubscriptionList;\r\n        this.closeAllSubscriptions = this.streaming.closeAllSubscriptions;\r\n        this.closeSingleSubscription = this.streaming.closeSingleSubscription;\r\n        this.pushDataToSingle = this.streaming.pushDataToSingle;\r\n        this.pushData = this.streaming.pushData;\r\n        this.onSubRequest = this.streaming.onSubRequest;\r\n        this.acceptRequestOnBranch = this.streaming.acceptRequestOnBranch;\r\n        this.rejectRequest = this.streaming.rejectRequest;\r\n        this.onSubAdded = this.streaming.onSubAdded;\r\n        this.onSubRemoved = this.streaming.onSubRemoved;\r\n    }\r\n    ServerProtocol.prototype.stopTimers = function () {\r\n        clearInterval(this.presenceTimer);\r\n        clearInterval(this.heartbeatTimer);\r\n    };\r\n    ServerProtocol.prototype.unregister = function (info) {\r\n        this.sendPresence();\r\n        return Promise.resolve();\r\n    };\r\n    ServerProtocol.prototype.register = function (repoMethod, success, error) {\r\n        var reqSubj = this.nextRequestSubject();\r\n        repoMethod.protocolState.method = this.createNewMethodMessage(repoMethod.definition, reqSubj, false);\r\n        this.announceNewMethod();\r\n        success();\r\n        return Promise.resolve();\r\n    };\r\n    ServerProtocol.prototype.createStream = function (repoMethod, success, error) {\r\n        var reqSubj = this.nextRequestSubject();\r\n        var streamConverted = this.createNewMethodMessage(repoMethod.definition, reqSubj, true);\r\n        repoMethod.protocolState.method = streamConverted;\r\n        repoMethod.protocolState.globalEventStreamSubject = repoMethod.definition.name + \".jsStream.\" + random_1.default();\r\n        repoMethod.protocolState.subscriptions = [];\r\n        repoMethod.protocolState.branchKeyToStreamIdMap = [];\r\n        this.announceNewMethod();\r\n        success();\r\n    };\r\n    ServerProtocol.prototype.onInvoked = function (callback) {\r\n        this.callbacks.add(\"onInvoked\", callback);\r\n    };\r\n    ServerProtocol.prototype.methodInvocationResult = function (executedMethod, invocationId, err, result) {\r\n        var message = this.invocationMessagesMap[invocationId];\r\n        if (!message) {\r\n            return;\r\n        }\r\n        if (message.MethodResponseSubject === \"null\") {\r\n            return;\r\n        }\r\n        if (executedMethod === undefined) {\r\n            return;\r\n        }\r\n        var resultMessage = {\r\n            MethodRequestSubject: message.MethodRequestSubject,\r\n            MethodResponseSubject: message.MethodResponseSubject,\r\n            MethodName: executedMethod.protocolState.method.Method.Name,\r\n            InvocationId: invocationId,\r\n            ResultContextJson: result,\r\n            Server: helpers_1.convertInstance(this.instance),\r\n            ResultMessage: err,\r\n            Status: err ? 1 : 0,\r\n        };\r\n        this.connection.send(\"agm\", \"MethodInvocationResultMessage\", resultMessage);\r\n        delete this.invocationMessagesMap[invocationId];\r\n    };\r\n    ServerProtocol.prototype.nextRequestSubject = function () {\r\n        return \"req_\" + (this.reqCounter++) + \"_\" + random_1.default();\r\n    };\r\n    ServerProtocol.prototype.sendHeartbeat = function () {\r\n        this.connection.send(\"agm\", \"ServerHeartbeatMessage\", this.constructHeartbeat());\r\n    };\r\n    ServerProtocol.prototype.constructHeartbeat = function () {\r\n        return {\r\n            PublishingInterval: HeartbeatInterval,\r\n            Instance: helpers_1.convertInstance(this.instance),\r\n        };\r\n    };\r\n    ServerProtocol.prototype.constructPresence = function () {\r\n        var methods = this.serverRepository.getList();\r\n        return {\r\n            PublishingInterval: PresenceInterval,\r\n            Instance: helpers_1.convertInstance(this.instance),\r\n            MethodDefinitions: methods.map(function (m) { return m.protocolState.method; }),\r\n        };\r\n    };\r\n    ServerProtocol.prototype.sendPresence = function () {\r\n        this.connection.send(\"agm\", \"ServerPresenceMessage\", this.constructPresence());\r\n    };\r\n    ServerProtocol.prototype.announceNewMethod = function () {\r\n        var _this = this;\r\n        this.sendPresence();\r\n        if (this.presenceTimer === undefined) {\r\n            this.presenceTimer = setInterval(function () { return _this.sendPresence(); }, PresenceInterval);\r\n        }\r\n    };\r\n    ServerProtocol.prototype.handleMethodInvocationMessage = function (message) {\r\n        var subject = message.MethodRequestSubject;\r\n        var methodList = this.serverRepository.getList();\r\n        var method = methodList.filter(function (m) {\r\n            return m.protocolState.method.MethodRequestSubject === subject;\r\n        })[0];\r\n        if (method === undefined) {\r\n            return;\r\n        }\r\n        if (this.streaming.isStreamMsg(message, method)) {\r\n            this.streaming.processSubscriberMsg(message, method);\r\n            return;\r\n        }\r\n        var invocationId = message.Context.InvocationId;\r\n        this.invocationMessagesMap[invocationId] = message;\r\n        var invocationArgs = {\r\n            args: message.Context.ArgumentsJson,\r\n            instance: helpers_1.convertInfoToInstance(message.Client),\r\n        };\r\n        this.callbacks.execute(\"onInvoked\", method, invocationId, invocationArgs);\r\n    };\r\n    ServerProtocol.prototype.createNewMethodMessage = function (methodIdentifier, subject, stream) {\r\n        if (typeof methodIdentifier === \"string\") {\r\n            methodIdentifier = { name: methodIdentifier };\r\n        }\r\n        if (typeof methodIdentifier.version !== \"number\") {\r\n            methodIdentifier.version = 0;\r\n        }\r\n        return {\r\n            Method: {\r\n                Name: methodIdentifier.name,\r\n                InputSignature: methodIdentifier.accepts,\r\n                ResultSignature: methodIdentifier.returns,\r\n                Description: methodIdentifier.description,\r\n                DisplayName: methodIdentifier.displayName,\r\n                Version: methodIdentifier.version,\r\n                ObjectTypeRestrictions: methodIdentifier.objectTypes,\r\n                Flags: stream ? 32 : undefined,\r\n            },\r\n            MethodRequestSubject: subject,\r\n        };\r\n    };\r\n    return ServerProtocol;\r\n}());\r\nexports.default = ServerProtocol;\r\n//# sourceMappingURL=server.js.map\n\n/***/ }),\n/* 41 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar STATUS_AWAITING_ACCEPT = \"awaitingAccept\";\r\nvar STATUS_SUBSCRIBED = \"subscribed\";\r\nvar ERR_MSG_SUB_FAILED = \"Subscription failed.\";\r\nvar ERR_MSG_SUB_REJECTED = \"Subscription rejected.\";\r\nvar ON_CLOSE_MSG_SERVER_INIT = \"ServerInitiated\";\r\nvar ON_CLOSE_MSG_CLIENT_INIT = \"ClientInitiated\";\r\nvar ClientStreaming = (function () {\r\n    function ClientStreaming(instance, session, repository, logger) {\r\n        var _this = this;\r\n        this.instance = instance;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        this.subscriptionsList = {};\r\n        this.subscriptionIdToLocalKeyMap = {};\r\n        this.nextSubLocalKey = 0;\r\n        this.handleErrorSubscribing = function (errorResponse) {\r\n            var tag = errorResponse._tag;\r\n            var subLocalKey = tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                return server.serverId !== tag.serverId;\r\n            });\r\n            if (pendingSub.trackedServers.length <= 0) {\r\n                clearTimeout(pendingSub.timeoutId);\r\n                if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                    var reason = (typeof errorResponse.reason === \"string\" && errorResponse.reason !== \"\") ?\r\n                        ' Publisher said \"' + errorResponse.reason + '\".' :\r\n                        \" No reason given.\";\r\n                    var callArgs = typeof pendingSub.arguments === \"object\" ?\r\n                        JSON.stringify(pendingSub.arguments) :\r\n                        \"{}\";\r\n                    pendingSub.error({\r\n                        message: ERR_MSG_SUB_REJECTED + reason + \" Called with:\" + callArgs,\r\n                        called_with: pendingSub.arguments,\r\n                        method: pendingSub.method.getInfoForUser(),\r\n                    });\r\n                }\r\n                else if (pendingSub.status === STATUS_SUBSCRIBED) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                }\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n        };\r\n        this.handleSubscribed = function (msg) {\r\n            var subLocalKey = msg._tag.subLocalKey;\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (typeof pendingSub !== \"object\") {\r\n                return;\r\n            }\r\n            var serverId = msg._tag.serverId;\r\n            var acceptingServer = pendingSub.trackedServers\r\n                .filter(function (server) {\r\n                return server.serverId === serverId;\r\n            })[0];\r\n            if (typeof acceptingServer !== \"object\") {\r\n                return;\r\n            }\r\n            acceptingServer.subscriptionId = msg.subscription_id;\r\n            _this.subscriptionIdToLocalKeyMap[msg.subscription_id] = subLocalKey;\r\n            var isFirstResponse = (pendingSub.status === STATUS_AWAITING_ACCEPT);\r\n            pendingSub.status = STATUS_SUBSCRIBED;\r\n            var that = _this;\r\n            if (isFirstResponse) {\r\n                pendingSub.success({\r\n                    onData: function (dataCallback) {\r\n                        if (typeof dataCallback !== \"function\") {\r\n                            throw new TypeError(\"The data callback must be a function.\");\r\n                        }\r\n                        pendingSub.handlers.onData.push(dataCallback);\r\n                        if (pendingSub.handlers.onData.length === 1 && pendingSub.queued.data.length > 0) {\r\n                            pendingSub.queued.data.forEach(function (dataItem) {\r\n                                dataCallback(dataItem);\r\n                            });\r\n                        }\r\n                    },\r\n                    onClosed: function (closedCallback) {\r\n                        if (typeof closedCallback !== \"function\") {\r\n                            throw new TypeError(\"The callback must be a function.\");\r\n                        }\r\n                        pendingSub.handlers.onClosed.push(closedCallback);\r\n                    },\r\n                    onFailed: function () {\r\n                    },\r\n                    close: function () { return that.closeSubscription(subLocalKey); },\r\n                    requestArguments: pendingSub.arguments,\r\n                    serverInstance: that.repository.getServerById(serverId).getInfoForUser(),\r\n                    stream: pendingSub.method.info,\r\n                });\r\n            }\r\n        };\r\n        this.handleEventData = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var trackedServersFound = subscription.trackedServers.filter(function (server) {\r\n                return server.subscriptionId === msg.subscription_id;\r\n            });\r\n            if (trackedServersFound.length !== 1) {\r\n                return;\r\n            }\r\n            var isPrivateData = msg.oob && msg.snapshot;\r\n            var sendingServerId = trackedServersFound[0].serverId;\r\n            var receivedStreamData = function () {\r\n                return {\r\n                    data: msg.data,\r\n                    server: _this.repository.getServerById(sendingServerId).getInfoForUser(),\r\n                    requestArguments: subscription.arguments || {},\r\n                    message: null,\r\n                    private: isPrivateData,\r\n                };\r\n            };\r\n            var onDataHandlers = subscription.handlers.onData;\r\n            var queuedData = subscription.queued.data;\r\n            if (onDataHandlers.length > 0) {\r\n                onDataHandlers.forEach(function (callback) {\r\n                    if (typeof callback === \"function\") {\r\n                        callback(receivedStreamData());\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                queuedData.push(receivedStreamData());\r\n            }\r\n        };\r\n        this.handleSubscriptionCancelled = function (msg) {\r\n            var subLocalKey = _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n            if (typeof subLocalKey === \"undefined\") {\r\n                return;\r\n            }\r\n            var subscription = _this.subscriptionsList[subLocalKey];\r\n            if (typeof subscription !== \"object\") {\r\n                return;\r\n            }\r\n            var expectedNewLength = subscription.trackedServers.length - 1;\r\n            subscription.trackedServers = subscription.trackedServers.filter(function (server) {\r\n                if (server.subscriptionId === msg.subscription_id) {\r\n                    subscription.queued.closers.push(server.serverId);\r\n                    return false;\r\n                }\r\n                else {\r\n                    return true;\r\n                }\r\n            });\r\n            if (subscription.trackedServers.length !== expectedNewLength) {\r\n                return;\r\n            }\r\n            if (subscription.trackedServers.length <= 0) {\r\n                clearTimeout(subscription.timeoutId);\r\n                _this.callOnClosedHandlers(subscription);\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            delete _this.subscriptionIdToLocalKeyMap[msg.subscription_id];\r\n        };\r\n        session.on(\"subscribed\", this.handleSubscribed);\r\n        session.on(\"event\", this.handleEventData);\r\n        session.on(\"subscription-cancelled\", this.handleSubscriptionCancelled);\r\n    }\r\n    ClientStreaming.prototype.subscribe = function (streamingMethod, argumentObj, targetServers, stuff, success, error) {\r\n        var _this = this;\r\n        if (targetServers.length === 0) {\r\n            error({\r\n                method: streamingMethod.getInfoForUser(),\r\n                called_with: argumentObj,\r\n                message: ERR_MSG_SUB_FAILED + \" No available servers matched the target params.\",\r\n            });\r\n            return;\r\n        }\r\n        var subLocalKey = this.getNextSubscriptionLocalKey();\r\n        var pendingSub = this.registerSubscription(subLocalKey, streamingMethod, argumentObj, success, error, stuff.methodResponseTimeout);\r\n        if (typeof pendingSub !== \"object\") {\r\n            error({\r\n                method: streamingMethod.getInfoForUser(),\r\n                called_with: argumentObj,\r\n                message: ERR_MSG_SUB_FAILED + \" Unable to register the user callbacks.\",\r\n            });\r\n            return;\r\n        }\r\n        targetServers.forEach(function (target) {\r\n            var serverId = target.server.id;\r\n            pendingSub.trackedServers.push({\r\n                serverId: serverId,\r\n                subscriptionId: undefined,\r\n            });\r\n            var msg = {\r\n                type: \"subscribe\",\r\n                server_id: serverId,\r\n                method_id: streamingMethod.protocolState.id,\r\n                arguments_kv: argumentObj,\r\n            };\r\n            _this.session.send(msg, { serverId: serverId, subLocalKey: subLocalKey })\r\n                .then(function (m) { return _this.handleSubscribed(m); })\r\n                .catch(function (err) { return _this.handleErrorSubscribing(err); });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.getNextSubscriptionLocalKey = function () {\r\n        var current = this.nextSubLocalKey;\r\n        this.nextSubLocalKey += 1;\r\n        return current;\r\n    };\r\n    ClientStreaming.prototype.registerSubscription = function (subLocalKey, method, args, success, error, timeout) {\r\n        var _this = this;\r\n        this.subscriptionsList[subLocalKey] = {\r\n            status: STATUS_AWAITING_ACCEPT,\r\n            method: method,\r\n            arguments: args,\r\n            success: success,\r\n            error: error,\r\n            trackedServers: [],\r\n            handlers: {\r\n                onData: [],\r\n                onClosed: [],\r\n            },\r\n            queued: {\r\n                data: [],\r\n                closers: [],\r\n            },\r\n            timeoutId: undefined,\r\n        };\r\n        this.subscriptionsList[subLocalKey].timeoutId = setTimeout(function () {\r\n            if (_this.subscriptionsList[subLocalKey] === undefined) {\r\n                return;\r\n            }\r\n            var pendingSub = _this.subscriptionsList[subLocalKey];\r\n            if (pendingSub.status === STATUS_AWAITING_ACCEPT) {\r\n                error({\r\n                    method: method.getInfoForUser(),\r\n                    called_with: args,\r\n                    message: ERR_MSG_SUB_FAILED + \" Subscription attempt timed out after \" + timeout + \" ms.\",\r\n                });\r\n                delete _this.subscriptionsList[subLocalKey];\r\n            }\r\n            else if (pendingSub.status === STATUS_SUBSCRIBED && pendingSub.trackedServers.length > 0) {\r\n                pendingSub.trackedServers = pendingSub.trackedServers.filter(function (server) {\r\n                    return (typeof server.subscriptionId !== \"undefined\");\r\n                });\r\n                delete pendingSub.timeoutId;\r\n                if (pendingSub.trackedServers.length <= 0) {\r\n                    _this.callOnClosedHandlers(pendingSub);\r\n                    delete _this.subscriptionsList[subLocalKey];\r\n                }\r\n            }\r\n        }, timeout);\r\n        return this.subscriptionsList[subLocalKey];\r\n    };\r\n    ClientStreaming.prototype.callOnClosedHandlers = function (subscription, reason) {\r\n        var closersCount = subscription.queued.closers.length;\r\n        var closingServerId = (closersCount > 0) ? subscription.queued.closers[closersCount - 1] : null;\r\n        var closingServer = null;\r\n        if (typeof closingServerId === \"number\") {\r\n            closingServer = this.repository.getServerById(closingServerId).getInfoForUser();\r\n        }\r\n        subscription.handlers.onClosed.forEach(function (callback) {\r\n            if (typeof callback !== \"function\") {\r\n                return;\r\n            }\r\n            callback({\r\n                message: reason || ON_CLOSE_MSG_SERVER_INIT,\r\n                requestArguments: subscription.arguments,\r\n                server: closingServer,\r\n                stream: subscription.method,\r\n            });\r\n        });\r\n    };\r\n    ClientStreaming.prototype.closeSubscription = function (subLocalKey) {\r\n        var _this = this;\r\n        var subscription = this.subscriptionsList[subLocalKey];\r\n        if (typeof subscription !== \"object\") {\r\n            return;\r\n        }\r\n        subscription.trackedServers.forEach(function (server) {\r\n            if (typeof server.subscriptionId === \"undefined\") {\r\n                return;\r\n            }\r\n            _this.session.sendFireAndForget({\r\n                type: \"unsubscribe\",\r\n                subscription_id: server.subscriptionId,\r\n                reason_uri: \"\",\r\n                reason: ON_CLOSE_MSG_CLIENT_INIT,\r\n            });\r\n            delete _this.subscriptionIdToLocalKeyMap[server.subscriptionId];\r\n        });\r\n        subscription.trackedServers = [];\r\n        this.callOnClosedHandlers(subscription, ON_CLOSE_MSG_CLIENT_INIT);\r\n        delete this.subscriptionsList[subLocalKey];\r\n    };\r\n    return ClientStreaming;\r\n}());\r\nexports.default = ClientStreaming;\r\n//# sourceMappingURL=client-streaming.js.map\n\n/***/ }),\n/* 42 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar client_streaming_1 = __webpack_require__(41);\r\nvar ClientProtocol = (function () {\r\n    function ClientProtocol(instance, session, repository, logger) {\r\n        var _this = this;\r\n        this.instance = instance;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.logger = logger;\r\n        this.callbacks = callback_registry_1.default();\r\n        session.on(\"peer-added\", function (msg) { return _this.handlePeerAdded(msg); });\r\n        session.on(\"peer-removed\", function (msg) { return _this.handlePeerRemoved(msg); });\r\n        session.on(\"methods-added\", function (msg) { return _this.handleMethodsAddedMessage(msg); });\r\n        session.on(\"methods-removed\", function (msg) { return _this.handleMethodsRemovedMessage(msg); });\r\n        this.streaming = new client_streaming_1.default(instance, session, repository, logger);\r\n    }\r\n    ClientProtocol.prototype.subscribe = function (stream, args, targetServers, options, success, error) {\r\n        this.streaming.subscribe(stream, args, targetServers, options, success, error);\r\n    };\r\n    ClientProtocol.prototype.invoke = function (id, method, args, target) {\r\n        var _this = this;\r\n        var serverId = target.id;\r\n        var methodId = method.protocolState.id;\r\n        var msg = {\r\n            type: \"call\",\r\n            server_id: serverId,\r\n            method_id: methodId,\r\n            arguments_kv: args,\r\n        };\r\n        this.session.send(msg, { invocationId: id, serverId: serverId })\r\n            .then(function (m) { return _this.handleResultMessage(m); })\r\n            .catch(function (err) { return _this.handleInvocationError(err); });\r\n    };\r\n    ClientProtocol.prototype.onInvocationResult = function (callback) {\r\n        this.callbacks.add(\"onResult\", callback);\r\n    };\r\n    ClientProtocol.prototype.handlePeerAdded = function (msg) {\r\n        var newPeerId = msg.new_peer_id;\r\n        var remoteId = msg.identity;\r\n        var pid = Number(remoteId.process);\r\n        var serverInfo = {\r\n            machine: remoteId.machine,\r\n            pid: isNaN(pid) ? remoteId.process : pid,\r\n            instance: remoteId.instance,\r\n            application: remoteId.application,\r\n            environment: remoteId.environment,\r\n            region: remoteId.region,\r\n            user: remoteId.user,\r\n            windowId: remoteId.windowId,\r\n            peerId: newPeerId,\r\n        };\r\n        this.repository.addServer(serverInfo, newPeerId);\r\n    };\r\n    ClientProtocol.prototype.handlePeerRemoved = function (msg) {\r\n        var removedPeerId = msg.removed_id;\r\n        var reason = msg.reason;\r\n        this.repository.removeServerById(removedPeerId, reason);\r\n    };\r\n    ClientProtocol.prototype.handleMethodsAddedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methods = msg.methods;\r\n        methods.forEach(function (method) {\r\n            var methodInfo = {\r\n                name: method.name,\r\n                displayName: method.display_name,\r\n                description: method.description,\r\n                version: method.version,\r\n                objectTypes: method.object_types || [],\r\n                accepts: method.input_signature,\r\n                returns: method.result_signature,\r\n                supportsStreaming: typeof method.flags !== \"undefined\" ? method.flags.streaming : false,\r\n            };\r\n            _this.repository.addServerMethod(serverId, methodInfo, { id: method.id });\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleMethodsRemovedMessage = function (msg) {\r\n        var _this = this;\r\n        var serverId = msg.server_id;\r\n        var methodIdList = msg.methods;\r\n        var server = this.repository.getServerById(serverId);\r\n        var serverMethodKeys = Object.keys(server.methods);\r\n        serverMethodKeys.forEach(function (methodKey) {\r\n            var method = server.methods[methodKey];\r\n            if (methodIdList.indexOf(method.protocolState.id) > -1) {\r\n                _this.repository.removeServerMethod(serverId, methodKey);\r\n            }\r\n        });\r\n    };\r\n    ClientProtocol.prototype.handleResultMessage = function (msg) {\r\n        var invocationId = msg._tag.invocationId;\r\n        var result = msg.result;\r\n        var serverId = msg._tag.serverId;\r\n        var server = this.repository.getServerById(serverId);\r\n        this.callbacks.execute(\"onResult\", invocationId, server.getInfoForUser(), 0, result, \"\");\r\n    };\r\n    ClientProtocol.prototype.handleInvocationError = function (msg) {\r\n        this.logger.debug(\"handle invocation error \" + JSON.stringify(msg));\r\n        var invocationId = msg._tag.invocationId;\r\n        var serverId = msg._tag.serverId;\r\n        var server = this.repository.getServerById(serverId);\r\n        var message = msg.reason;\r\n        var context = msg.context;\r\n        this.callbacks.execute(\"onResult\", invocationId, server.getInfoForUser(), 1, context, message);\r\n    };\r\n    return ClientProtocol;\r\n}());\r\nexports.default = ClientProtocol;\r\n//# sourceMappingURL=client.js.map\n\n/***/ }),\n/* 43 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar server_1 = __webpack_require__(45);\r\nvar client_1 = __webpack_require__(42);\r\nfunction default_1(instance, connection, clientRepository, serverRepository, libConfig, getAGM) {\r\n    var logger = libConfig.logger.subLogger(\"gw3-protocol\");\r\n    var resolveReadyPromise;\r\n    var readyPromise = new Promise(function (resolve) {\r\n        resolveReadyPromise = resolve;\r\n    });\r\n    var session = connection.domain(\"agm\", logger.subLogger(\"domain\"), [\"subscribed\"]);\r\n    var server = new server_1.default(instance, session, clientRepository, serverRepository, logger.subLogger(\"server\"));\r\n    var client = new client_1.default(instance, session, clientRepository, logger.subLogger(\"client\"));\r\n    function handleReconnect() {\r\n        logger.info(\"reconnected - will replay registered methods and subscriptions\");\r\n        clientRepository.reset();\r\n        clientRepository.addServer(instance, connection.peerId);\r\n        var registeredMethods = serverRepository.getList();\r\n        serverRepository.reset();\r\n        registeredMethods.forEach(function (method) {\r\n            var def = method.definition;\r\n            if (method.theFunction.userCallback) {\r\n                getAGM().register(def, method.theFunction.userCallback);\r\n            }\r\n            else if (method.theFunction.userCallbackAsync) {\r\n                getAGM().registerAsync(def, method.theFunction.userCallbackAsync);\r\n            }\r\n        });\r\n    }\r\n    function handleInitialJoin() {\r\n        clientRepository.addServer(instance, connection.peerId);\r\n        resolveReadyPromise({\r\n            client: client,\r\n            server: server,\r\n        });\r\n        resolveReadyPromise = undefined;\r\n    }\r\n    session.onJoined(function (reconnect) {\r\n        if (reconnect) {\r\n            handleReconnect();\r\n        }\r\n        else {\r\n            handleInitialJoin();\r\n        }\r\n    });\r\n    session.join();\r\n    return readyPromise;\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=factory.js.map\n\n/***/ }),\n/* 44 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar SUBSCRIPTION_REQUEST = \"onSubscriptionRequest\";\r\nvar SUBSCRIPTION_ADDED = \"onSubscriptionAdded\";\r\nvar SUBSCRIPTION_REMOVED = \"onSubscriptionRemoved\";\r\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(instance, session, repository, serverRepository, logger) {\r\n        var _this = this;\r\n        this.instance = instance;\r\n        this.session = session;\r\n        this.repository = repository;\r\n        this.serverRepository = serverRepository;\r\n        this.logger = logger;\r\n        this.ERR_URI_SUBSCRIPTION_FAILED = \"com.tick42.agm.errors.subscription.failure\";\r\n        this.callbacks = callback_registry_1.default();\r\n        this.nextStreamId = 0;\r\n        session.on(\"add-interest\", function (msg) { _this.handleAddInterest(msg); });\r\n        session.on(\"remove-interest\", function (msg) { _this.handleRemoveInterest(msg); });\r\n    }\r\n    ServerStreaming.prototype.acceptRequestOnBranch = function (requestContext, streamingMethod, branch) {\r\n        if (typeof branch !== \"string\") {\r\n            branch = \"\";\r\n        }\r\n        if (typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            throw new TypeError(\"The streaming method is missing its subscriptions.\");\r\n        }\r\n        if (!Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            throw new TypeError(\"The streaming method is missing its branches.\");\r\n        }\r\n        var streamId = this.getStreamId(streamingMethod, branch);\r\n        var key = requestContext.msg.subscription_id;\r\n        var subscription = {\r\n            id: key,\r\n            arguments: requestContext.arguments,\r\n            instance: requestContext.instance,\r\n            branchKey: branch,\r\n            streamId: streamId,\r\n            subscribeMsg: requestContext.msg,\r\n        };\r\n        streamingMethod.protocolState.subscriptionsMap[key] = subscription;\r\n        this.session.sendFireAndForget({\r\n            type: \"accepted\",\r\n            subscription_id: key,\r\n            stream_id: streamId,\r\n        });\r\n        this.callbacks.execute(SUBSCRIPTION_ADDED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.rejectRequest = function (requestContext, streamingMethod, reason) {\r\n        if (typeof reason !== \"string\") {\r\n            reason = \"\";\r\n        }\r\n        this.sendSubscriptionFailed(\"Subscription rejected by user. \" + reason, requestContext.msg.subscription_id);\r\n    };\r\n    ServerStreaming.prototype.pushData = function (streamingMethod, data, branches) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || !Array.isArray(streamingMethod.protocolState.branchKeyToStreamIdMap)) {\r\n            return;\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        if (typeof branches === \"string\") {\r\n            branches = [branches];\r\n        }\r\n        else if (!Array.isArray(branches) || branches.length <= 0) {\r\n            branches = null;\r\n        }\r\n        var streamIdList = streamingMethod.protocolState.branchKeyToStreamIdMap\r\n            .filter(function (br) {\r\n            return (branches === null || (Boolean(br) && typeof br.key === \"string\" && branches.indexOf(br.key) >= 0));\r\n        }).map(function (br) {\r\n            return br.streamId;\r\n        });\r\n        streamIdList.forEach(function (streamId) {\r\n            var publishMessage = {\r\n                type: \"publish\",\r\n                stream_id: streamId,\r\n                data: data,\r\n            };\r\n            _this.session.sendFireAndForget(publishMessage);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        var postMessage = {\r\n            type: \"post\",\r\n            subscription_id: subscription.id,\r\n            data: data,\r\n        };\r\n        this.session.sendFireAndForget(postMessage);\r\n    };\r\n    ServerStreaming.prototype.closeSingleSubscription = function (streamingMethod, subscription) {\r\n        delete streamingMethod.protocolState.subscriptionsMap[subscription.id];\r\n        var dropSubscriptionMessage = {\r\n            type: \"drop-subscription\",\r\n            subscription_id: subscription.id,\r\n            reason: \"Server dropping a single subscription\",\r\n        };\r\n        this.session.sendFireAndForget(dropSubscriptionMessage);\r\n        var subscriber = subscription.instance;\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.closeMultipleSubscriptions = function (streamingMethod, branchKey) {\r\n        var _this = this;\r\n        if (typeof streamingMethod !== \"object\" || typeof streamingMethod.protocolState.subscriptionsMap !== \"object\") {\r\n            return;\r\n        }\r\n        var subscriptionsToClose = Object.keys(streamingMethod.protocolState.subscriptionsMap)\r\n            .map(function (key) {\r\n            return streamingMethod.protocolState.subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey === \"string\") {\r\n            subscriptionsToClose = subscriptionsToClose.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        subscriptionsToClose.forEach(function (subscription) {\r\n            delete streamingMethod.protocolState.subscriptionsMap[subscription.id];\r\n            var drop = {\r\n                type: \"drop-subscription\",\r\n                subscription_id: subscription.id,\r\n                reason: \"Server dropping all subscriptions on stream_id: \" + subscription.streamId,\r\n            };\r\n            _this.session.sendFireAndForget(drop);\r\n        });\r\n    };\r\n    ServerStreaming.prototype.getSubscriptionList = function (streamingMethod, branchKey) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var subscriptions = [];\r\n        var allSubscriptions = Object.keys(streamingMethod.protocolState.subscriptionsMap)\r\n            .map(function (key) {\r\n            return streamingMethod.protocolState.subscriptionsMap[key];\r\n        });\r\n        if (typeof branchKey !== \"string\") {\r\n            subscriptions = allSubscriptions;\r\n        }\r\n        else {\r\n            subscriptions = allSubscriptions.filter(function (sub) {\r\n                return sub.branchKey === branchKey;\r\n            });\r\n        }\r\n        return subscriptions;\r\n    };\r\n    ServerStreaming.prototype.getBranchList = function (streamingMethod) {\r\n        if (typeof streamingMethod !== \"object\") {\r\n            return [];\r\n        }\r\n        var allSubscriptions = Object.keys(streamingMethod.protocolState.subscriptionsMap)\r\n            .map(function (key) {\r\n            return streamingMethod.protocolState.subscriptionsMap[key];\r\n        });\r\n        var keysWithDuplicates = allSubscriptions.map(function (sub) {\r\n            var result = null;\r\n            if (typeof sub === \"object\" && typeof sub.branchKey === \"string\") {\r\n                result = sub.branchKey;\r\n            }\r\n            return result;\r\n        });\r\n        var seen = [];\r\n        var branchArray = keysWithDuplicates.filter(function (bKey) {\r\n            if (bKey === null || seen.indexOf(bKey) >= 0) {\r\n                return false;\r\n            }\r\n            seen.push(bKey);\r\n            return true;\r\n        });\r\n        return branchArray;\r\n    };\r\n    ServerStreaming.prototype.onSubAdded = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_ADDED, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRequest = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REQUEST, callback);\r\n    };\r\n    ServerStreaming.prototype.onSubRemoved = function (callback) {\r\n        this.onSubscriptionLifetimeEvent(SUBSCRIPTION_REMOVED, callback);\r\n    };\r\n    ServerStreaming.prototype.handleRemoveInterest = function (msg) {\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (typeof msg.subscription_id !== \"string\" ||\r\n            typeof streamingMethod !== \"object\" ||\r\n            typeof streamingMethod.protocolState.subscriptionsMap[msg.subscription_id] !== \"object\") {\r\n            return;\r\n        }\r\n        var subscription = streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        delete streamingMethod.protocolState.subscriptionsMap[msg.subscription_id];\r\n        this.callbacks.execute(SUBSCRIPTION_REMOVED, subscription, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.onSubscriptionLifetimeEvent = function (eventName, handlerFunc) {\r\n        this.callbacks.add(eventName, handlerFunc);\r\n    };\r\n    ServerStreaming.prototype.getNextStreamId = function () {\r\n        return this.nextStreamId++ + \"\";\r\n    };\r\n    ServerStreaming.prototype.handleAddInterest = function (msg) {\r\n        var caller = this.repository.getServerById(msg.caller_id);\r\n        var instance = (typeof caller.getInfoForUser === \"function\") ? caller.getInfoForUser() : null;\r\n        var requestContext = {\r\n            msg: msg,\r\n            arguments: msg.arguments_kv || {},\r\n            instance: instance,\r\n        };\r\n        var streamingMethod = this.serverRepository.getById(msg.method_id);\r\n        if (streamingMethod === undefined) {\r\n            var errorMsg = \"No method with id \" + msg.method_id + \" on this server.\";\r\n            this.sendSubscriptionFailed(errorMsg, msg.subscription_id);\r\n            return;\r\n        }\r\n        if (streamingMethod.protocolState.subscriptionsMap &&\r\n            streamingMethod.protocolState.subscriptionsMap[msg.subscription_id]) {\r\n            this.sendSubscriptionFailed(\"A subscription with id \" + msg.subscription_id + \" already exists.\", msg.subscription_id);\r\n            return;\r\n        }\r\n        this.callbacks.execute(SUBSCRIPTION_REQUEST, requestContext, streamingMethod);\r\n    };\r\n    ServerStreaming.prototype.sendSubscriptionFailed = function (reason, subscriptionId) {\r\n        var errorMessage = {\r\n            type: \"error\",\r\n            reason_uri: this.ERR_URI_SUBSCRIPTION_FAILED,\r\n            reason: reason,\r\n            request_id: subscriptionId,\r\n        };\r\n        this.session.sendFireAndForget(errorMessage);\r\n    };\r\n    ServerStreaming.prototype.getStreamId = function (streamingMethod, branchKey) {\r\n        if (typeof branchKey !== \"string\") {\r\n            branchKey = \"\";\r\n        }\r\n        var needleBranch = streamingMethod.protocolState.branchKeyToStreamIdMap.filter(function (branch) {\r\n            return branch.key === branchKey;\r\n        })[0];\r\n        var streamId = (needleBranch ? needleBranch.streamId : undefined);\r\n        if (typeof streamId !== \"string\" || streamId === \"\") {\r\n            streamId = this.getNextStreamId();\r\n            streamingMethod.protocolState.branchKeyToStreamIdMap.push({ key: branchKey, streamId: streamId });\r\n        }\r\n        return streamId;\r\n    };\r\n    return ServerStreaming;\r\n}());\r\nexports.default = ServerStreaming;\r\n//# sourceMappingURL=server-streaming.js.map\n\n/***/ }),\n/* 45 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar server_streaming_1 = __webpack_require__(44);\r\nvar ServerProtocol = (function () {\r\n    function ServerProtocol(instance, session, clientRepository, serverRepository, logger) {\r\n        var _this = this;\r\n        this.session = session;\r\n        this.clientRepository = clientRepository;\r\n        this.serverRepository = serverRepository;\r\n        this.logger = logger;\r\n        this.callbacks = callback_registry_1.default();\r\n        this.streaming = new server_streaming_1.default(instance, session, clientRepository, serverRepository, logger);\r\n        this.session.on(\"invoke\", function (msg) { return _this.handleInvokeMessage(msg); });\r\n    }\r\n    ServerProtocol.prototype.createStream = function (repoMethod, success, error) {\r\n        var isStreaming = true;\r\n        repoMethod.protocolState.subscriptionsMap = {};\r\n        repoMethod.protocolState.branchKeyToStreamIdMap = [];\r\n        this.register(repoMethod, success, error, isStreaming);\r\n    };\r\n    ServerProtocol.prototype.register = function (repoMethod, success, error, isStreaming) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodDef, flags, registerMsg;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodDef = repoMethod.definition;\r\n                        repoMethod.protocolState.registrationCallbacks = {\r\n                            success: success,\r\n                            fail: error,\r\n                        };\r\n                        flags = { streaming: isStreaming || false };\r\n                        this.logger.debug('registering method \"' + methodDef.name + '\"');\r\n                        registerMsg = {\r\n                            type: \"register\",\r\n                            methods: [{\r\n                                    id: repoMethod.repoId,\r\n                                    name: methodDef.name,\r\n                                    display_name: methodDef.displayName,\r\n                                    description: methodDef.description,\r\n                                    version: methodDef.version,\r\n                                    flags: flags,\r\n                                    object_types: methodDef.objectTypes || methodDef.object_types,\r\n                                    input_signature: methodDef.accepts,\r\n                                    result_signature: methodDef.returns,\r\n                                    restrictions: undefined,\r\n                                }],\r\n                        };\r\n                        return [4, this.session.send(registerMsg, { methodId: repoMethod.repoId })\r\n                                .then(function (msg) { return _this.handleRegisteredMessage(msg); })\r\n                                .catch(function (err) { return _this.handleErrorRegister(err); })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerProtocol.prototype.onInvoked = function (callback) {\r\n        this.callbacks.add(\"onInvoked\", callback);\r\n    };\r\n    ServerProtocol.prototype.methodInvocationResult = function (method, invocationId, err, result) {\r\n        var msg;\r\n        if (err) {\r\n            msg = {\r\n                type: \"error\",\r\n                request_id: invocationId,\r\n                reason_uri: \"agm.errors.client_error\",\r\n                reason: err,\r\n                context: result,\r\n                peer_id: undefined,\r\n            };\r\n        }\r\n        else {\r\n            msg = {\r\n                type: \"yield\",\r\n                invocation_id: invocationId,\r\n                peer_id: this.session.peerId,\r\n                result: result,\r\n                request_id: undefined,\r\n            };\r\n        }\r\n        this.session.sendFireAndForget(msg);\r\n    };\r\n    ServerProtocol.prototype.unregister = function (method) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var msg;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        msg = {\r\n                            type: \"unregister\",\r\n                            methods: [method.repoId],\r\n                        };\r\n                        return [4, this.session.send(msg)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ServerProtocol.prototype.getBranchList = function (method) {\r\n        return this.streaming.getBranchList(method);\r\n    };\r\n    ServerProtocol.prototype.getSubscriptionList = function (method, branchKey) {\r\n        return this.streaming.getSubscriptionList(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.closeAllSubscriptions = function (method, branchKey) {\r\n        this.streaming.closeMultipleSubscriptions(method, branchKey);\r\n    };\r\n    ServerProtocol.prototype.pushData = function (method, data, branches) {\r\n        this.streaming.pushData(method, data, branches);\r\n    };\r\n    ServerProtocol.prototype.pushDataToSingle = function (method, subscription, data) {\r\n        this.streaming.pushDataToSingle(method, subscription, data);\r\n    };\r\n    ServerProtocol.prototype.closeSingleSubscription = function (method, subscription) {\r\n        this.streaming.closeSingleSubscription(method, subscription);\r\n    };\r\n    ServerProtocol.prototype.acceptRequestOnBranch = function (requestContext, method, branch) {\r\n        this.streaming.acceptRequestOnBranch(requestContext, method, branch);\r\n    };\r\n    ServerProtocol.prototype.rejectRequest = function (requestContext, method, reason) {\r\n        this.streaming.rejectRequest(requestContext, method, reason);\r\n    };\r\n    ServerProtocol.prototype.onSubRequest = function (callback) {\r\n        this.streaming.onSubRequest(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubAdded = function (callback) {\r\n        this.streaming.onSubAdded(callback);\r\n    };\r\n    ServerProtocol.prototype.onSubRemoved = function (callback) {\r\n        this.streaming.onSubRemoved(callback);\r\n    };\r\n    ServerProtocol.prototype.handleRegisteredMessage = function (msg) {\r\n        var methodId = msg._tag.methodId;\r\n        var repoMethod = this.serverRepository.getById(methodId);\r\n        if (repoMethod && repoMethod.protocolState.registrationCallbacks) {\r\n            this.logger.debug(\"registered method \" + repoMethod.definition.name + \" with id \" + methodId);\r\n            repoMethod.protocolState.registrationCallbacks.success();\r\n        }\r\n    };\r\n    ServerProtocol.prototype.handleErrorRegister = function (msg) {\r\n        this.logger.warn(JSON.stringify(msg));\r\n        var methodId = msg._tag.methodId;\r\n        var repoMethod = this.serverRepository.getById(methodId);\r\n        if (repoMethod && repoMethod.protocolState.registrationCallbacks) {\r\n            this.logger.debug(\"failed to register method \" + repoMethod.definition.name + \" with id \" + methodId);\r\n            repoMethod.protocolState.registrationCallbacks.fail();\r\n        }\r\n    };\r\n    ServerProtocol.prototype.handleInvokeMessage = function (msg) {\r\n        var invocationId = msg.invocation_id;\r\n        var callerId = msg.caller_id;\r\n        var methodId = msg.method_id;\r\n        var args = msg.arguments_kv;\r\n        this.logger.debug('received invocation for method id \"' + methodId + '\" from peer ' + callerId);\r\n        var methodList = this.serverRepository.getList();\r\n        var method = methodList.filter(function (m) {\r\n            return m.repoId === methodId;\r\n        })[0];\r\n        if (method === undefined) {\r\n            return;\r\n        }\r\n        var client = this.clientRepository.getServerById(callerId);\r\n        var invocationArgs = { args: args, instance: client.getInfoForUser() };\r\n        this.callbacks.execute(\"onInvoked\", method, invocationId, invocationArgs);\r\n    };\r\n    return ServerProtocol;\r\n}());\r\nexports.default = ServerProtocol;\r\n//# sourceMappingURL=server.js.map\n\n/***/ }),\n/* 46 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar subscription_1 = __webpack_require__(9);\r\nvar ServerBranch = (function () {\r\n    function ServerBranch(key, protocol, repoMethod) {\r\n        this.key = key;\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n    }\r\n    ServerBranch.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this.protocol.server.getSubscriptionList(this.repoMethod, this.key);\r\n        return subList.map(function (sub) {\r\n            return new subscription_1.default(_this.protocol, _this.repoMethod, sub);\r\n        });\r\n    };\r\n    ServerBranch.prototype.close = function () {\r\n        this.protocol.server.closeAllSubscriptions(this.repoMethod, this.key);\r\n    };\r\n    ServerBranch.prototype.push = function (data) {\r\n        this.protocol.server.pushData(this.repoMethod, data, [this.key]);\r\n    };\r\n    return ServerBranch;\r\n}());\r\nexports.default = ServerBranch;\r\n//# sourceMappingURL=branch.js.map\n\n/***/ }),\n/* 47 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ServerRepository = (function () {\r\n    function ServerRepository() {\r\n        this.nextId = 0;\r\n        this.methods = [];\r\n    }\r\n    ServerRepository.prototype.add = function (method) {\r\n        if (typeof method !== \"object\") {\r\n            return;\r\n        }\r\n        if (method.repoId !== undefined) {\r\n            return;\r\n        }\r\n        method.repoId = String(this.nextId);\r\n        this.nextId += 1;\r\n        this.methods.push(method);\r\n        return method;\r\n    };\r\n    ServerRepository.prototype.remove = function (repoId) {\r\n        if (typeof repoId !== \"string\") {\r\n            return new TypeError(\"Expecting a string\");\r\n        }\r\n        this.methods = this.methods.filter(function (m) {\r\n            return m.repoId !== repoId;\r\n        });\r\n    };\r\n    ServerRepository.prototype.getById = function (id) {\r\n        if (typeof id !== \"string\") {\r\n            return undefined;\r\n        }\r\n        return this.methods.filter(function (m) {\r\n            return m.repoId === id;\r\n        })[0];\r\n    };\r\n    ServerRepository.prototype.getList = function () {\r\n        return this.methods.map(function (m) { return m; });\r\n    };\r\n    ServerRepository.prototype.length = function () {\r\n        return this.methods.length;\r\n    };\r\n    ServerRepository.prototype.reset = function () {\r\n        this.methods = [];\r\n    };\r\n    return ServerRepository;\r\n}());\r\nexports.default = ServerRepository;\r\n//# sourceMappingURL=repository.js.map\n\n/***/ }),\n/* 48 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Request = (function () {\r\n    function Request(protocol, repoMethod, requestContext) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.requestContext = requestContext;\r\n        this.arguments = requestContext.arguments;\r\n        this.instance = requestContext.instance;\r\n    }\r\n    Request.prototype.accept = function () {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, \"\");\r\n    };\r\n    Request.prototype.acceptOnBranch = function (branch) {\r\n        this.protocol.server.acceptRequestOnBranch(this.requestContext, this.repoMethod, branch);\r\n    };\r\n    Request.prototype.reject = function (reason) {\r\n        this.protocol.server.rejectRequest(this.requestContext, this.repoMethod, reason);\r\n    };\r\n    return Request;\r\n}());\r\nexports.default = Request;\r\n//# sourceMappingURL=request.js.map\n\n/***/ }),\n/* 49 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar promisify_1 = __webpack_require__(8);\r\nvar streaming_1 = __webpack_require__(51);\r\nvar stream_1 = __webpack_require__(50);\r\nvar Server = (function () {\r\n    function Server(protocol, serverRepository, instance, configuration) {\r\n        this.protocol = protocol;\r\n        this.serverRepository = serverRepository;\r\n        this.instance = instance;\r\n        this.configuration = configuration;\r\n        this.invocations = 0;\r\n        this.streaming = new streaming_1.default(protocol, this);\r\n        this.protocol.server.onInvoked(this.onMethodInvoked.bind(this));\r\n    }\r\n    Server.prototype.register = function (methodDefinition, callback) {\r\n        if (methodDefinition === undefined) {\r\n            return Promise.reject(\"Please supply either a string of the Unique name or an object with property name\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be the callback function\");\r\n        }\r\n        var wrappedCallbackFunction = function (context, resultCallback) {\r\n            try {\r\n                var result = callback(context.args, context.instance);\r\n                resultCallback(null, result);\r\n            }\r\n            catch (e) {\r\n                resultCallback(e, e);\r\n            }\r\n        };\r\n        wrappedCallbackFunction.userCallback = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallbackFunction);\r\n    };\r\n    Server.prototype.registerAsync = function (methodDefinition, callback) {\r\n        if (methodDefinition === undefined) {\r\n            return Promise.reject(\"Please supply either a string of the Unique name or an object with property name\");\r\n        }\r\n        if (typeof callback !== \"function\") {\r\n            return Promise.reject(\"The second parameter must be the callback function\");\r\n        }\r\n        var wrappedCallback = function (context, resultCallback) {\r\n            try {\r\n                callback(context.args, context.instance, function (result) {\r\n                    resultCallback(null, result);\r\n                }, function (e) {\r\n                    resultCallback(e, e);\r\n                });\r\n            }\r\n            catch (e) {\r\n                resultCallback(e, null);\r\n            }\r\n        };\r\n        wrappedCallback.userCallbackAsync = callback;\r\n        return this.registerCore(methodDefinition, wrappedCallback);\r\n    };\r\n    Server.prototype.registerCore = function (method, theFunction) {\r\n        var _this = this;\r\n        var methodDefinition;\r\n        if (typeof method === \"string\") {\r\n            methodDefinition = { name: \"\" + method };\r\n        }\r\n        else {\r\n            methodDefinition = __assign({}, method);\r\n        }\r\n        var nameAlreadyExists = this.serverRepository.getList()\r\n            .some(function (serverMethod) { return serverMethod.definition.name === methodDefinition.name; });\r\n        if (nameAlreadyExists) {\r\n            return Promise.reject(\"Name already exists !\");\r\n        }\r\n        if (methodDefinition.supportsStreaming) {\r\n            return Promise.reject(\"supportsStreaming can not be true ! If you want to create a stream please use glue.agm.createStream\");\r\n        }\r\n        var repoMethod = this.serverRepository.add({\r\n            definition: methodDefinition,\r\n            theFunction: theFunction,\r\n            protocolState: {},\r\n        });\r\n        return this.protocol.server.register(repoMethod, function () {\r\n        }, function () {\r\n            _this.serverRepository.remove(repoMethod.repoId);\r\n        });\r\n    };\r\n    Server.prototype.createStream = function (streamDef, callbacks, successCallback, errorCallback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (typeof streamDef === \"string\") {\r\n                if (streamDef === \"\") {\r\n                    reject(\"Invalid stream name - can not be empty\");\r\n                }\r\n                streamDef = { name: streamDef };\r\n            }\r\n            streamDef.supportsStreaming = true;\r\n            if (!callbacks) {\r\n                callbacks = {};\r\n            }\r\n            if (typeof callbacks.subscriptionRequestHandler !== \"function\") {\r\n                callbacks.subscriptionRequestHandler = function (request) {\r\n                    request.accept();\r\n                };\r\n            }\r\n            var repoMethod = {\r\n                definition: streamDef,\r\n                streamCallbacks: callbacks,\r\n                protocolState: {},\r\n            };\r\n            _this.serverRepository.add(repoMethod);\r\n            _this.protocol.server.createStream(repoMethod, function () {\r\n                var streamFrontObject = new stream_1.default(_this.protocol, repoMethod, _this);\r\n                repoMethod.stream = streamFrontObject;\r\n                resolve(streamFrontObject);\r\n            }, function (err) {\r\n                _this.serverRepository.remove(repoMethod.repoId);\r\n                reject(err);\r\n            });\r\n        });\r\n        return promisify_1.default(promise, successCallback, errorCallback);\r\n    };\r\n    Server.prototype.unregister = function (methodFilter, forStream) {\r\n        if (forStream === void 0) { forStream = false; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodDefinition, methodToBeRemoved;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (methodFilter === undefined) {\r\n                            return [2, Promise.reject(\"Please supply either a string of the Unique name or an object with property name\")];\r\n                        }\r\n                        if (!(typeof methodFilter === \"function\")) return [3, 2];\r\n                        return [4, this.unregisterWithPredicate(methodFilter, forStream)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                    case 2:\r\n                        if (typeof methodFilter === \"string\") {\r\n                            methodDefinition = { name: methodFilter };\r\n                        }\r\n                        else {\r\n                            methodDefinition = methodFilter;\r\n                        }\r\n                        if (methodDefinition.name === undefined) {\r\n                            return [2, Promise.reject(\"Method with undefined name does not exist !\")];\r\n                        }\r\n                        methodToBeRemoved = this.serverRepository.getList().find(function (serverMethod) {\r\n                            return serverMethod.definition.name === methodDefinition.name\r\n                                && (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodToBeRemoved) {\r\n                            return [2, Promise.reject(\"Method does not exist or it is not registered by your application !\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams([methodToBeRemoved])];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.unregisterWithPredicate = function (filterPredicate, forStream) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var methodsOrStreamsToRemove;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        methodsOrStreamsToRemove = this.serverRepository.getList()\r\n                            .filter(function (sm) { return filterPredicate(sm.definition); })\r\n                            .filter(function (serverMethod) {\r\n                            return (serverMethod.definition.supportsStreaming || false) === forStream;\r\n                        });\r\n                        if (!methodsOrStreamsToRemove || methodsOrStreamsToRemove.length === 0) {\r\n                            return [2, Promise.reject(\"No \" + (forStream ? \"stream\" : \"method\") + \" matches the condition !\")];\r\n                        }\r\n                        return [4, this.removeMethodsOrStreams(methodsOrStreamsToRemove)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.removeMethodsOrStreams = function (methodsToRemove) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, Promise.all(methodsToRemove.map(function (method) { return __awaiter(_this, void 0, void 0, function () {\r\n                            return __generator(this, function (_a) {\r\n                                switch (_a.label) {\r\n                                    case 0: return [4, this.protocol.server.unregister(method)];\r\n                                    case 1:\r\n                                        _a.sent();\r\n                                        this.serverRepository.remove(method.repoId);\r\n                                        return [2];\r\n                                }\r\n                            });\r\n                        }); }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Server.prototype.containsProps = function (filter, methodDefinition) {\r\n        var filterProps = Object.keys(filter)\r\n            .filter(function (prop) {\r\n            return typeof filter[prop] !== \"function\"\r\n                && prop !== \"object_types\"\r\n                && prop !== \"display_name\";\r\n        });\r\n        var methodDefProps = Object.keys(methodDefinition);\r\n        var uniqProps = Array.from(new Set(filterProps.concat(methodDefProps)));\r\n        return uniqProps.reduce(function (isMatch, prop) {\r\n            var filterValue = filter[prop];\r\n            var methodDefValue = methodDefinition[prop];\r\n            if (prop === \"supportsStreaming\") {\r\n                methodDefValue = methodDefValue || false;\r\n                filterValue = filterValue || false;\r\n            }\r\n            if (prop === \"objectTypes\" && filterValue !== undefined && methodDefValue !== undefined) {\r\n                if (filterValue.length !== methodDefValue.length) {\r\n                    isMatch = false;\r\n                }\r\n                else {\r\n                    var firstObjType = filterValue.sort();\r\n                    var secondObjTypes_1 = methodDefValue.sort();\r\n                    var hasADifference = firstObjType.some(function (objType, index) { return objType !== secondObjTypes_1[index]; });\r\n                    if (hasADifference) {\r\n                        isMatch = false;\r\n                    }\r\n                }\r\n            }\r\n            else if (filterValue !== methodDefValue) {\r\n                isMatch = false;\r\n            }\r\n            return isMatch;\r\n        }, true);\r\n    };\r\n    Server.prototype.onMethodInvoked = function (methodToExecute, invocationId, invocationArgs) {\r\n        var _this = this;\r\n        if (!methodToExecute) {\r\n            return;\r\n        }\r\n        methodToExecute.theFunction(invocationArgs, function (err, result) {\r\n            if (err) {\r\n                if (typeof err.message === \"string\") {\r\n                    err = err.message;\r\n                }\r\n                else if (typeof err !== \"string\") {\r\n                    try {\r\n                        err = JSON.stringify(err);\r\n                    }\r\n                    catch (unStrException) {\r\n                        err = \"un-stringifyable error in onMethodInvoked ! Top level prop names: \" + Object.keys(err);\r\n                    }\r\n                }\r\n            }\r\n            if (!result || typeof result !== \"object\" || result.constructor === Array) {\r\n                result = { _result: result };\r\n            }\r\n            _this.protocol.server.methodInvocationResult(methodToExecute, invocationId, err, result);\r\n        });\r\n    };\r\n    return Server;\r\n}());\r\nexports.default = Server;\r\n//# sourceMappingURL=server.js.map\n\n/***/ }),\n/* 50 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar subscription_1 = __webpack_require__(9);\r\nvar branch_1 = __webpack_require__(46);\r\nvar ServerStream = (function () {\r\n    function ServerStream(protocol, repoMethod, server) {\r\n        this.protocol = protocol;\r\n        this.repoMethod = repoMethod;\r\n        this.server = server;\r\n        this.def = repoMethod.definition;\r\n    }\r\n    Object.defineProperty(ServerStream.prototype, \"name\", {\r\n        get: function () { return this.def.name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerStream.prototype.branches = function (key) {\r\n        var _this = this;\r\n        var bList = this.protocol.server.getBranchList(this.repoMethod);\r\n        if (key) {\r\n            if (bList.indexOf(key) > -1) {\r\n                return new branch_1.default(key, this.protocol, this.repoMethod);\r\n            }\r\n            return undefined;\r\n        }\r\n        else {\r\n            return bList.map(function (branchKey) {\r\n                return new branch_1.default(branchKey, _this.protocol, _this.repoMethod);\r\n            });\r\n        }\r\n    };\r\n    ServerStream.prototype.subscriptions = function () {\r\n        var _this = this;\r\n        var subList = this.protocol.server.getSubscriptionList(this.repoMethod);\r\n        return subList.map(function (sub) {\r\n            return new subscription_1.default(_this.protocol, _this.repoMethod, sub);\r\n        });\r\n    };\r\n    Object.defineProperty(ServerStream.prototype, \"definition\", {\r\n        get: function () {\r\n            var def2 = this.def;\r\n            return {\r\n                accepts: def2.accepts,\r\n                description: def2.description,\r\n                displayName: def2.displayName,\r\n                name: def2.name,\r\n                objectTypes: def2.objectTypes,\r\n                returns: def2.returns,\r\n                supportsStreaming: def2.supportsStreaming,\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ServerStream.prototype.close = function () {\r\n        this.protocol.server.closeAllSubscriptions(this.repoMethod);\r\n        this.server.unregister(this.repoMethod.definition, true);\r\n    };\r\n    ServerStream.prototype.push = function (data, branches) {\r\n        if (typeof branches !== \"string\" && !Array.isArray(branches) && branches !== undefined) {\r\n            throw new Error(\"invalid branches should be string or string array\");\r\n        }\r\n        if (typeof data !== \"object\") {\r\n            throw new Error(\"Invalid arguments. Data must be an object.\");\r\n        }\r\n        this.protocol.server.pushData(this.repoMethod, data, branches);\r\n    };\r\n    return ServerStream;\r\n}());\r\nexports.default = ServerStream;\r\n//# sourceMappingURL=stream.js.map\n\n/***/ }),\n/* 51 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar subscription_1 = __webpack_require__(9);\r\nvar request_1 = __webpack_require__(48);\r\nvar ServerStreaming = (function () {\r\n    function ServerStreaming(protocol, server) {\r\n        var _this = this;\r\n        this.protocol = protocol;\r\n        this.server = server;\r\n        protocol.server.onSubRequest(function (rc, rm) { return _this.handleSubRequest(rc, rm); });\r\n        protocol.server.onSubAdded(function (sub, rm) { return _this.handleSubAdded(sub, rm); });\r\n        protocol.server.onSubRemoved(function (sub, rm) { return _this.handleSubRemoved(sub, rm); });\r\n    }\r\n    ServerStreaming.prototype.handleSubRequest = function (requestContext, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRequestHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var request = new request_1.default(this.protocol, repoMethod, requestContext);\r\n        repoMethod.streamCallbacks.subscriptionRequestHandler(request);\r\n    };\r\n    ServerStreaming.prototype.handleSubAdded = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionAddedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new subscription_1.default(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionAddedHandler(sub);\r\n    };\r\n    ServerStreaming.prototype.handleSubRemoved = function (subscription, repoMethod) {\r\n        if (!(repoMethod &&\r\n            repoMethod.streamCallbacks &&\r\n            typeof repoMethod.streamCallbacks.subscriptionRemovedHandler === \"function\")) {\r\n            return;\r\n        }\r\n        var sub = new subscription_1.default(this.protocol, repoMethod, subscription);\r\n        repoMethod.streamCallbacks.subscriptionRemovedHandler(sub);\r\n    };\r\n    return ServerStreaming;\r\n}());\r\nexports.default = ServerStreaming;\r\n//# sourceMappingURL=streaming.js.map\n\n/***/ }),\n/* 52 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar protocol_1 = __webpack_require__(53);\r\nvar successMessages = ['subscribed', 'success'];\r\nexports.default = (function (configuration) {\r\n    var connection = configuration.connection, logger = configuration.logger;\r\n    var session = connection.domain('bus', logger, successMessages);\r\n    return new Promise(function (resolve, reject) {\r\n        session.join()\r\n            .then(function () {\r\n            var protocol = protocol_1.default(connection, logger, session);\r\n            resolve(protocol);\r\n        })\r\n            .catch(reject);\r\n    });\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 53 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar utils_1 = __webpack_require__(54);\r\n;\r\nvar Protocol = (function () {\r\n    function Protocol(connection, logger, session) {\r\n        var _this = this;\r\n        this.publish = function (topic, data, options) {\r\n            var _a = options || {}, _b = _a.routingKey, routingKey = _b === void 0 ? undefined : _b, _c = _a.target, target = _c === void 0 ? undefined : _c;\r\n            var args = utils_1.removeEmptyValues({\r\n                type: 'publish',\r\n                topic: topic,\r\n                data: data,\r\n                peer_id: _this.peerId,\r\n                routing_key: routingKey,\r\n                target_identity: target\r\n            });\r\n            _this.session.send(args);\r\n        };\r\n        this.subscribe = function (topic, callback, options) {\r\n            return new Promise(function (resolve, reject) {\r\n                var _a = options || {}, _b = _a.routingKey, routingKey = _b === void 0 ? undefined : _b, _c = _a.target, target = _c === void 0 ? undefined : _c;\r\n                var args = utils_1.removeEmptyValues({\r\n                    type: 'subscribe',\r\n                    topic: topic,\r\n                    peer_id: _this.peerId,\r\n                    routing_key: routingKey,\r\n                    source: target\r\n                });\r\n                _this.session.send(args)\r\n                    .then(function (response) {\r\n                    var subscription_id = response.subscription_id;\r\n                    _this.subscriptions.push({ subscription_id: subscription_id, topic: topic, callback: callback, source: target });\r\n                    resolve({\r\n                        unsubscribe: function () {\r\n                            _this.session.send({ type: 'unsubscribe', subscription_id: subscription_id, peer_id: _this.peerId });\r\n                            _this.subscriptions = _this.subscriptions.filter(function (s) { return s.subscription_id !== subscription_id; });\r\n                            return Promise.resolve();\r\n                        }\r\n                    });\r\n                })\r\n                    .catch(function (error) { return reject(error); });\r\n            });\r\n        };\r\n        this.watchOnEvent = function () {\r\n            _this.session.on('event', function (args) {\r\n                var data = args.data, subscription_id = args.subscription_id;\r\n                var source = args['publisher-identity'];\r\n                var subscription = _this.subscriptions.find(function (s) { return s.subscription_id === subscription_id; });\r\n                if (subscription) {\r\n                    if (!subscription.source) {\r\n                        subscription.callback(data, subscription.topic, source);\r\n                    }\r\n                    else {\r\n                        if (utils_1.keysMatch(subscription.source, source)) {\r\n                            subscription.callback(data, subscription.topic, source);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        this.connection = connection;\r\n        this.logger = logger;\r\n        this.session = session;\r\n        this.peerId = connection.peerId;\r\n        this.subscriptions = [];\r\n    }\r\n    return Protocol;\r\n}());\r\nfunction default_1(connection, logger, session) {\r\n    var protocol = new Protocol(connection, logger, session);\r\n    protocol.watchOnEvent();\r\n    return protocol;\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=protocol.js.map\n\n/***/ }),\n/* 54 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction removeEmptyValues(obj) {\r\n    var cleaned = {};\r\n    Object.keys(obj).forEach(function (key) {\r\n        if (obj[key] !== undefined && obj[key] !== null) {\r\n            cleaned[key] = obj[key];\r\n        }\r\n    });\r\n    return cleaned;\r\n}\r\nexports.removeEmptyValues = removeEmptyValues;\r\nfunction keysMatch(obj1, obj2) {\r\n    var keysObj1 = Object.keys(obj1);\r\n    var allMatch = true;\r\n    keysObj1.forEach(function (key) {\r\n        if (obj1[key] !== obj2[key]) {\r\n            allMatch = false;\r\n        }\r\n    });\r\n    return allMatch;\r\n}\r\nexports.keysMatch = keysMatch;\r\n//# sourceMappingURL=utils.js.map\n\n/***/ }),\n/* 55 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global, process) {\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar shortid_1 = __webpack_require__(6);\r\nvar utils_1 = __webpack_require__(11);\r\nvar contextMessageReplaySpec_1 = __webpack_require__(10);\r\nvar pjson = __webpack_require__(12);\r\nfunction default_1(configuration, ext, hc, glue42gd, gdVersion) {\r\n    if (typeof window !== \"undefined\") {\r\n        global = global || window;\r\n    }\r\n    global = global || {};\r\n    var uid = shortid_1.generate();\r\n    var masterConfig = global.GLUE_CONFIG || {};\r\n    var dynamicDefaults = global.GLUE_DEFAULT_CONFIG || {};\r\n    var hardDefaults = getHardDefaults();\r\n    var metricsIdentity = {\r\n        system: getConfigProp(\"metrics\", \"system\"),\r\n        service: getConfigProp(\"metrics\", \"service\"),\r\n        instance: getConfigProp(\"metrics\", \"instance\")\r\n    };\r\n    function getMetrics() {\r\n        return ifNotFalse(getConfigProp(\"metrics\"), {\r\n            identity: metricsIdentity\r\n        });\r\n    }\r\n    function getGateway() {\r\n        var force = getConfigProp(\"gateway\", \"force\");\r\n        var gw = hc === undefined || force;\r\n        if (gw) {\r\n            var gwConfig = getConfigProp(\"gateway\");\r\n            var protocolVersion = getConfigProp(\"gateway\", \"protocolVersion\");\r\n            var reconnectInterval = getConfigProp(\"gateway\", \"reconnectInterval\");\r\n            var reconnectAttempts = getConfigProp(\"gateway\", \"reconnectAttempts\");\r\n            var ws = gwConfig.ws;\r\n            var http = gwConfig.http;\r\n            var inproc = gwConfig.inproc;\r\n            if (!ws && !http && !inproc) {\r\n                if (utils_1.default.isNode() || (\"WebSocket\" in window && window.WebSocket.CLOSING === 2)) {\r\n                    ws = getConfigProp(\"gateway\", \"ws\");\r\n                }\r\n                else {\r\n                    http = getConfigProp(\"gateway\", \"http\");\r\n                }\r\n            }\r\n            var windowId = void 0;\r\n            var pid = void 0;\r\n            if (hc) {\r\n                windowId = hc.windowId;\r\n            }\r\n            else if (typeof glue42gd !== \"undefined\") {\r\n                windowId = glue42gd.windowId;\r\n                pid = glue42gd.pid;\r\n            }\r\n            else if (utils_1.default.isNode()) {\r\n                pid = process.pid;\r\n            }\r\n            var replaySpecs = getConfigProp(\"gateway\", \"replaySpecs\") || [];\r\n            replaySpecs.push(contextMessageReplaySpec_1.ContextMessageReplaySpec);\r\n            return {\r\n                identity: {\r\n                    application: getApplication(),\r\n                    windowId: windowId,\r\n                    process: pid,\r\n                },\r\n                reconnectInterval: reconnectInterval,\r\n                ws: ws,\r\n                http: http,\r\n                gw: inproc,\r\n                protocolVersion: protocolVersion,\r\n                reconnectAttempts: reconnectAttempts,\r\n                force: true,\r\n                replaySpecs: replaySpecs,\r\n                gdVersion: gdVersion,\r\n            };\r\n        }\r\n        return { gdVersion: gdVersion };\r\n    }\r\n    function getLogger() {\r\n        return getConfigProp(\"logger\");\r\n    }\r\n    function getAgm() {\r\n        return ifNotFalse(configuration.agm, {\r\n            instance: {\r\n                application: getApplication()\r\n            }\r\n        });\r\n    }\r\n    function getContexts(connectionConfig) {\r\n        if (connectionConfig.protocolVersion < 3) {\r\n            return false;\r\n        }\r\n        var contextConfig = getConfigProp(\"contexts\");\r\n        if (typeof contextConfig === \"boolean\" && !contextConfig) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    function getChannels(contextsEnabled) {\r\n        if (!contextsEnabled) {\r\n            return false;\r\n        }\r\n        var channelsConfig = getConfigProp(\"channels\");\r\n        if (typeof channelsConfig === \"boolean\" && !channelsConfig) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    function getBus(connectionConfig) {\r\n        var contextConfig = getConfigProp(\"bus\");\r\n        if (typeof contextConfig === \"boolean\" && contextConfig) {\r\n            if (connectionConfig.protocolVersion && connectionConfig.protocolVersion < 3) {\r\n                return false;\r\n            }\r\n            if (gdVersion === 2) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    function getApplication() {\r\n        return getConfigProp(\"application\");\r\n    }\r\n    function getAuth() {\r\n        return getConfigProp(\"auth\");\r\n    }\r\n    function getHardDefaults() {\r\n        function getMetricsDefaults() {\r\n            var documentTitle = typeof document !== \"undefined\" ? document.title : \"unknown\";\r\n            documentTitle = documentTitle || \"none\";\r\n            if (typeof hc === \"undefined\") {\r\n                return {\r\n                    system: \"Connect.Browser\",\r\n                    service: configuration.application || documentTitle,\r\n                    instance: \"~\" + uid\r\n                };\r\n            }\r\n            if (typeof hc.metricsFacade.getIdentity !== \"undefined\") {\r\n                var identity = hc.metricsFacade.getIdentity();\r\n                return {\r\n                    system: identity.system,\r\n                    service: identity.service,\r\n                    instance: identity.instance\r\n                };\r\n            }\r\n            return {\r\n                system: \"HtmlContainer.\" + hc.containerName,\r\n                service: \"JS.\" + hc.browserWindowName,\r\n                instance: \"~\" + hc.machineName\r\n            };\r\n        }\r\n        function getGatewayDefaults() {\r\n            var defaultProtocol = 3;\r\n            var gatewayURL = \"localhost:8385\";\r\n            var defaultWs = \"ws://\" + gatewayURL;\r\n            var defaultHttp = \"http://\" + gatewayURL;\r\n            if (glue42gd) {\r\n                defaultProtocol = 3;\r\n                defaultWs = glue42gd.gwURL;\r\n            }\r\n            return {\r\n                ws: defaultWs,\r\n                http: defaultHttp,\r\n                protocolVersion: defaultProtocol,\r\n                reconnectInterval: 1000\r\n            };\r\n        }\r\n        function getDefaultApplicationName() {\r\n            if (hc) {\r\n                return hc.containerName + \".\" + hc.browserWindowName;\r\n            }\r\n            if (glue42gd) {\r\n                return glue42gd.appName;\r\n            }\r\n            if (typeof window !== \"undefined\" && typeof document !== \"undefined\") {\r\n                return (window.agm_application || document.title) + uid;\r\n            }\r\n            else {\r\n                return \"NodeJS\" + uid;\r\n            }\r\n        }\r\n        function getDefaultLogger() {\r\n            return {\r\n                publish: \"off\",\r\n                console: \"info\",\r\n                metrics: \"off\",\r\n            };\r\n        }\r\n        return {\r\n            application: getDefaultApplicationName(),\r\n            metrics: getMetricsDefaults(),\r\n            agm: {},\r\n            gateway: getGatewayDefaults(),\r\n            logger: getDefaultLogger(),\r\n            bus: false\r\n        };\r\n    }\r\n    function getConfigProp(prop1, prop2) {\r\n        var masterConfigProp1 = masterConfig[prop1];\r\n        var userProp1 = configuration[prop1];\r\n        var dynamicDefaultsProp1 = dynamicDefaults[prop1];\r\n        var hardDefaultsProp1 = hardDefaults[prop1];\r\n        if (prop2) {\r\n            if (masterConfigProp1 && masterConfigProp1[prop2] !== undefined) {\r\n                return masterConfigProp1[prop2];\r\n            }\r\n            if (userProp1 && userProp1[prop2] !== undefined) {\r\n                return userProp1[prop2];\r\n            }\r\n            if (dynamicDefaultsProp1 && dynamicDefaultsProp1[prop2] !== undefined) {\r\n                return dynamicDefaultsProp1[prop2];\r\n            }\r\n            if (hardDefaultsProp1 && hardDefaultsProp1[prop2] !== undefined) {\r\n                return hardDefaultsProp1[prop2];\r\n            }\r\n        }\r\n        else {\r\n            if (masterConfigProp1 !== undefined) {\r\n                return masterConfigProp1;\r\n            }\r\n            if (userProp1 !== undefined) {\r\n                return userProp1;\r\n            }\r\n            if (dynamicDefaultsProp1 !== undefined) {\r\n                return dynamicDefaultsProp1;\r\n            }\r\n            if (hardDefaultsProp1 !== undefined) {\r\n                return hardDefaultsProp1;\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n    function ifNotFalse(what, then) {\r\n        if (typeof what === \"boolean\" && !what) {\r\n            return undefined;\r\n        }\r\n        else {\r\n            return then;\r\n        }\r\n    }\r\n    var connection = getGateway();\r\n    var contexts = getContexts(connection);\r\n    var channels = getChannels(contexts);\r\n    var bus = getBus(connection);\r\n    return {\r\n        bus: bus,\r\n        identity: metricsIdentity,\r\n        application: getApplication(),\r\n        auth: getAuth(),\r\n        logger: getLogger(),\r\n        connection: connection,\r\n        metrics: getMetrics(),\r\n        agm: getAgm(),\r\n        contexts: contexts,\r\n        channels: channels,\r\n        version: ext.version || pjson.version,\r\n        libs: ext.libs\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=config.js.map\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(7), __webpack_require__(18)))\n\n/***/ }),\n/* 56 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    }\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar connection_1 = __webpack_require__(13);\r\nvar messageReplayer_1 = __webpack_require__(58);\r\nvar GW3ConnectionImpl = (function (_super) {\r\n    __extends(GW3ConnectionImpl, _super);\r\n    function GW3ConnectionImpl(settings) {\r\n        var _this = _super.call(this, settings) || this;\r\n        if (settings.replaySpecs &&\r\n            settings.replaySpecs.length) {\r\n            _this.replayer = new messageReplayer_1.MessageReplayerImpl(settings.replaySpecs);\r\n        }\r\n        return _this;\r\n    }\r\n    GW3ConnectionImpl.prototype.init = function (transport, protocol) {\r\n        _super.prototype.init.call(this, transport, protocol);\r\n        if (this.replayer) {\r\n            this.replayer.init(this);\r\n        }\r\n        this.gw3Protocol = protocol;\r\n    };\r\n    GW3ConnectionImpl.prototype.toAPI = function () {\r\n        var that = this;\r\n        var superAPI = _super.prototype.toAPI.call(this);\r\n        return {\r\n            domain: that.domain.bind(that),\r\n            get peerId() { return that.peerId; },\r\n            get token() { return that.token; },\r\n            get info() { return that.info; },\r\n            get resolvedIdentity() { return that.resolvedIdentity; },\r\n            get availableDomains() { return that.availableDomains; },\r\n            get gatewayToken() { return that.gatewayToken; },\r\n            get replayer() { return that.replayer; },\r\n            on: superAPI.on,\r\n            send: superAPI.send,\r\n            off: superAPI.off,\r\n            login: superAPI.login,\r\n            logout: superAPI.logout,\r\n            loggedIn: superAPI.loggedIn,\r\n            connected: superAPI.connected,\r\n            disconnected: superAPI.disconnected,\r\n            authToken: that.authToken.bind(that),\r\n            get protocolVersion() { return superAPI.protocolVersion; },\r\n        };\r\n    };\r\n    GW3ConnectionImpl.prototype.domain = function (domain, logger, successMessages, errorMessages) {\r\n        return this.gw3Protocol.domain(domain, logger, successMessages, errorMessages);\r\n    };\r\n    GW3ConnectionImpl.prototype.authToken = function () {\r\n        return this.gw3Protocol.authToken();\r\n    };\r\n    return GW3ConnectionImpl;\r\n}(connection_1.default));\r\nexports.default = GW3ConnectionImpl;\r\n//# sourceMappingURL=gw3Connection.js.map\n\n/***/ }),\n/* 57 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar connection_1 = __webpack_require__(13);\r\nvar gw3_1 = __webpack_require__(60);\r\nvar hc_1 = __webpack_require__(62);\r\nvar ws_1 = __webpack_require__(65);\r\nvar gw3Connection_1 = __webpack_require__(56);\r\nvar gw1_1 = __webpack_require__(59);\r\nvar hc_2 = __webpack_require__(63);\r\nvar inproc_1 = __webpack_require__(64);\r\nexports.default = (function (settings) {\r\n    settings = settings || {};\r\n    settings.reconnectAttempts = settings.reconnectAttempts || 10;\r\n    settings.reconnectInterval = settings.reconnectInterval || 500;\r\n    var connection = new connection_1.default(settings);\r\n    var logger = settings.logger;\r\n    if (!logger) {\r\n        throw new Error(\"please pass a logger object\");\r\n    }\r\n    var protocol = new hc_1.default();\r\n    var transport = new hc_2.default();\r\n    var outsideHC = settings.gdVersion !== 2 || settings.force;\r\n    if (outsideHC) {\r\n        if (settings.gw && settings.gw.facade && settings.gw.token && settings.protocolVersion === 3) {\r\n            transport = new inproc_1.default(settings.gw.token, settings.gw.facade, logger.subLogger(\"inproc\"));\r\n        }\r\n        else if (settings.ws !== undefined) {\r\n            transport = new ws_1.default(settings, logger.subLogger(\"ws\"));\r\n        }\r\n        else {\r\n            throw new Error(\"No connection information specified\");\r\n        }\r\n        if (settings.protocolVersion === 3) {\r\n            var gw3Connection = new gw3Connection_1.default(settings);\r\n            var gw3Port = gw3_1.default(gw3Connection, settings, logger.subLogger(\"gw3\"));\r\n            gw3Connection.init(transport, gw3Port);\r\n            return gw3Connection.toAPI();\r\n        }\r\n        else {\r\n            protocol = new gw1_1.default(connection, settings);\r\n        }\r\n    }\r\n    connection.init(transport, protocol);\r\n    return connection.toAPI();\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 58 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar MessageReplayerImpl = (function () {\r\n    function MessageReplayerImpl(specs) {\r\n        this.specsNames = [];\r\n        this.messages = {};\r\n        this.subs = {};\r\n        this.subsRefCount = {};\r\n        this.specs = {};\r\n        for (var _i = 0, specs_1 = specs; _i < specs_1.length; _i++) {\r\n            var spec = specs_1[_i];\r\n            this.specs[spec.name] = spec;\r\n            this.specsNames.push(spec.name);\r\n        }\r\n    }\r\n    MessageReplayerImpl.prototype.init = function (connection) {\r\n        var _this = this;\r\n        this.connection = connection;\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var _loop_1 = function (type) {\r\n                var refCount = this_1.subsRefCount[type];\r\n                if (!refCount) {\r\n                    refCount = 0;\r\n                }\r\n                refCount += 1;\r\n                this_1.subsRefCount[type] = refCount;\r\n                if (refCount > 1) {\r\n                    return \"continue\";\r\n                }\r\n                var sub = connection.on(\"glue-core\", type, function (msg) { return _this.processMessage(type, msg); });\r\n                this_1.subs[type] = sub;\r\n            };\r\n            var this_1 = this;\r\n            for (var _b = 0, _c = this.specs[name_1].types; _b < _c.length; _b++) {\r\n                var type = _c[_b];\r\n                _loop_1(type);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.processMessage = function (type, msg) {\r\n        if (this.isDone || !msg) {\r\n            return;\r\n        }\r\n        for (var _i = 0, _a = this.specsNames; _i < _a.length; _i++) {\r\n            var name_2 = _a[_i];\r\n            if (this.specs[name_2].types.indexOf(type) !== -1) {\r\n                var messages = this.messages[name_2] || [];\r\n                this.messages[name_2] = messages;\r\n                messages.push(msg);\r\n            }\r\n        }\r\n    };\r\n    MessageReplayerImpl.prototype.drain = function (name, callback) {\r\n        if (callback) {\r\n            (this.messages[name] || []).forEach(callback);\r\n        }\r\n        delete this.messages[name];\r\n        for (var _i = 0, _a = this.specs[name].types; _i < _a.length; _i++) {\r\n            var type = _a[_i];\r\n            this.subsRefCount[type] -= 1;\r\n            if (this.subsRefCount[type] <= 0) {\r\n                this.connection.off(this.subs[type]);\r\n                delete this.subs[type];\r\n                delete this.subsRefCount[type];\r\n            }\r\n        }\r\n        delete this.specs[name];\r\n        if (!this.specs.length) {\r\n            this.isDone = true;\r\n        }\r\n    };\r\n    return MessageReplayerImpl;\r\n}());\r\nexports.MessageReplayerImpl = MessageReplayerImpl;\r\n//# sourceMappingURL=messageReplayer.js.map\n\n/***/ }),\n/* 59 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar GW1Protocol = (function () {\r\n    function GW1Protocol(connection, settings) {\r\n        this._connection = connection;\r\n        this._settings = settings;\r\n    }\r\n    GW1Protocol.prototype.processStringMessage = function (message) {\r\n        var messageObj = JSON.parse(message);\r\n        return {\r\n            msg: messageObj.message,\r\n            msgType: messageObj.type,\r\n        };\r\n    };\r\n    GW1Protocol.prototype.createStringMessage = function (product, type, message, id) {\r\n        return JSON.stringify({\r\n            type: type,\r\n            message: message,\r\n            id: id,\r\n        });\r\n    };\r\n    GW1Protocol.prototype.login = function (message) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var sendOptions = {\r\n                retryInterval: _this._settings.reconnectInterval,\r\n                maxRetries: _this._settings.reconnectAttempts\r\n            };\r\n            _this._connection.send(\"hello\", \"hello\", {}, null, sendOptions)\r\n                .then(function () { return resolve({ application: undefined }); })\r\n                .catch(reject);\r\n        });\r\n    };\r\n    GW1Protocol.prototype.logout = function () {\r\n    };\r\n    GW1Protocol.prototype.loggedIn = function (callback) {\r\n        callback();\r\n        return function () {\r\n        };\r\n    };\r\n    GW1Protocol.prototype.processObjectMessage = function (message) {\r\n        throw new Error(\"not supported\");\r\n    };\r\n    GW1Protocol.prototype.createObjectMessage = function (product, type, message, id) {\r\n        throw new Error(\"not supported\");\r\n    };\r\n    return GW1Protocol;\r\n}());\r\nexports.default = GW1Protocol;\r\n//# sourceMappingURL=gw1.js.map\n\n/***/ }),\n/* 60 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gw3Domain_1 = __webpack_require__(61);\r\nvar callback_registry_1 = __webpack_require__(1);\r\nfunction default_1(connection, settings, logger) {\r\n    var datePrefix = \"#T42_DATE#\";\r\n    var datePrefixLen = datePrefix.length;\r\n    var dateMinLen = datePrefixLen + 1;\r\n    var datePrefixFirstChar = datePrefix[0];\r\n    var registry = callback_registry_1.default();\r\n    var globalDomain;\r\n    var isLoggedIn = false;\r\n    var shouldTryLogin = true;\r\n    var initialLogin = true;\r\n    var initialLoginAttempts = 3;\r\n    var initialLoginAttemptsInterval = 500;\r\n    var pingTimer;\r\n    var sessions = [];\r\n    var loginConfig;\r\n    connection.disconnected(handleDisconnected.bind(this));\r\n    ping();\r\n    function processStringMessage(message) {\r\n        var msg = JSON.parse(message, function (key, value) {\r\n            if (typeof value !== \"string\") {\r\n                return value;\r\n            }\r\n            if (value.length < dateMinLen) {\r\n                return value;\r\n            }\r\n            if (value[0] !== datePrefixFirstChar) {\r\n                return value;\r\n            }\r\n            if (value.substring(0, datePrefixLen) !== datePrefix) {\r\n                return value;\r\n            }\r\n            try {\r\n                var milliseconds = parseInt(value.substring(datePrefixLen, value.length), 10);\r\n                if (isNaN(milliseconds)) {\r\n                    return value;\r\n                }\r\n                return new Date(milliseconds);\r\n            }\r\n            catch (ex) {\r\n                return value;\r\n            }\r\n        });\r\n        return {\r\n            msg: msg,\r\n            msgType: msg.type,\r\n        };\r\n    }\r\n    function createStringMessage(product, type, message, id) {\r\n        var oldToJson = Date.prototype.toJSON;\r\n        try {\r\n            Date.prototype.toJSON = function () {\r\n                return datePrefix + this.getTime();\r\n            };\r\n            var result = JSON.stringify(message);\r\n            return result;\r\n        }\r\n        finally {\r\n            Date.prototype.toJSON = oldToJson;\r\n        }\r\n    }\r\n    function processObjectMessage(message) {\r\n        if (!message.type) {\r\n            throw new Error(\"Object should have type property\");\r\n        }\r\n        return {\r\n            msg: message,\r\n            msgType: message.type,\r\n        };\r\n    }\r\n    function createObjectMessage(product, type, message, id) {\r\n        return message;\r\n    }\r\n    function login(config) {\r\n        logger.debug(\"logging in...\");\r\n        loginConfig = config;\r\n        if (!loginConfig) {\r\n            loginConfig = { username: \"\", password: \"\" };\r\n        }\r\n        shouldTryLogin = true;\r\n        return new Promise(function (resolve, reject) {\r\n            var authentication = {};\r\n            connection.gatewayToken = config.gatewayToken;\r\n            if (connection.gatewayToken) {\r\n                authentication.method = \"gateway-token\";\r\n                authentication.token = connection.gatewayToken;\r\n            }\r\n            else if (config.token) {\r\n                authentication.method = \"access-token\";\r\n                authentication.token = config.token;\r\n            }\r\n            else if (config.username) {\r\n                authentication.method = \"secret\";\r\n                authentication.login = config.username;\r\n                authentication.secret = config.password;\r\n            }\r\n            else {\r\n                throw new Error(\"invalid auth message\" + JSON.stringify(config));\r\n            }\r\n            var helloMsg = {\r\n                type: \"hello\",\r\n                identity: settings.identity,\r\n                authentication: authentication,\r\n            };\r\n            globalDomain = gw3Domain_1.default(\"global\", connection, logger, [\r\n                \"welcome\",\r\n                \"token\"\r\n            ]);\r\n            var sendOptions = { skipPeerId: true };\r\n            if (initialLogin) {\r\n                sendOptions.retryInterval = settings.reconnectInterval;\r\n                sendOptions.maxRetries = settings.reconnectAttempts;\r\n            }\r\n            globalDomain.send(helloMsg, undefined, sendOptions)\r\n                .then(function (msg) {\r\n                initialLogin = false;\r\n                logger.debug(\"login successful with PeerId \" + msg.peer_id);\r\n                connection.peerId = msg.peer_id;\r\n                connection.resolvedIdentity = msg.resolved_identity;\r\n                connection.availableDomains = msg.available_domains;\r\n                if (msg.options) {\r\n                    connection.token = msg.options.access_token;\r\n                    connection.info = msg.options.info;\r\n                }\r\n                setLoggedIn(true);\r\n                resolve(msg.resolved_identity);\r\n            })\r\n                .catch(function (err) {\r\n                logger.error(\"error sending hello message - \" + err);\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n    function logout() {\r\n        logger.debug(\"logging out...\");\r\n        shouldTryLogin = false;\r\n        if (pingTimer) {\r\n            clearTimeout(pingTimer);\r\n        }\r\n        sessions.forEach(function (session) {\r\n            session.leave();\r\n        });\r\n    }\r\n    function loggedIn(callback) {\r\n        if (isLoggedIn) {\r\n            callback();\r\n        }\r\n        return registry.add(\"onLoggedIn\", callback);\r\n    }\r\n    function domain(domainName, domainLogger, successMessages, errorMessages) {\r\n        var session = sessions.filter(function (s) { return s.domain === domainName; })[0];\r\n        if (!session) {\r\n            session = gw3Domain_1.default(domainName, connection, domainLogger, successMessages, errorMessages);\r\n            sessions.push(session);\r\n        }\r\n        return session;\r\n    }\r\n    function handleDisconnected() {\r\n        setLoggedIn(false);\r\n        var tryToLogin = shouldTryLogin;\r\n        if (tryToLogin && initialLogin) {\r\n            if (initialLoginAttempts <= 0) {\r\n                return;\r\n            }\r\n            initialLoginAttempts--;\r\n        }\r\n        logger.debug(\"disconnected - will try new login?\" + shouldTryLogin);\r\n        if (shouldTryLogin) {\r\n            connection.login(loginConfig)\r\n                .catch(function () {\r\n                setTimeout(handleDisconnected, 1000);\r\n            });\r\n        }\r\n    }\r\n    function setLoggedIn(value) {\r\n        isLoggedIn = value;\r\n        if (isLoggedIn) {\r\n            registry.execute(\"onLoggedIn\");\r\n        }\r\n    }\r\n    function ping() {\r\n        if (!shouldTryLogin) {\r\n            return;\r\n        }\r\n        if (isLoggedIn) {\r\n            connection.send(\"\", \"\", { type: \"ping\" });\r\n        }\r\n        pingTimer = setTimeout(ping, 30 * 1000);\r\n    }\r\n    function authToken() {\r\n        var createTokenReq = {\r\n            type: \"create-token\"\r\n        };\r\n        return globalDomain.send(createTokenReq)\r\n            .then(function (res) {\r\n            return res.token;\r\n        });\r\n    }\r\n    return {\r\n        processStringMessage: processStringMessage,\r\n        createStringMessage: createStringMessage,\r\n        createObjectMessage: createObjectMessage,\r\n        processObjectMessage: processObjectMessage,\r\n        login: login,\r\n        logout: logout,\r\n        loggedIn: loggedIn,\r\n        domain: domain,\r\n        authToken: authToken,\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=gw3.js.map\n\n/***/ }),\n/* 61 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callbackRegistry = __webpack_require__(1);\r\nvar shortid_1 = __webpack_require__(6);\r\nfunction default_1(domain, connection, logger, successMessages, errorMessages) {\r\n    if (domain == null) {\r\n        domain = \"global\";\r\n    }\r\n    var isJoined = false;\r\n    var tryReconnecting = false;\r\n    var _latestOptions;\r\n    var _connectionOn = false;\r\n    var callbacks = callbackRegistry();\r\n    connection.disconnected(handleConnectionDisconnected);\r\n    connection.loggedIn(handleConnectionLoggedIn);\r\n    connection.on(domain, \"success\", function (msg) { return handleSuccessMessage(msg); });\r\n    connection.on(domain, \"error\", function (msg) { return handleErrorMessage(msg); });\r\n    connection.on(domain, \"result\", function (msg) { return handleSuccessMessage(msg); });\r\n    if (successMessages) {\r\n        successMessages.forEach(function (sm) {\r\n            connection.on(domain, sm, function (msg) { return handleSuccessMessage(msg); });\r\n        });\r\n    }\r\n    if (errorMessages) {\r\n        errorMessages.forEach(function (sm) {\r\n            connection.on(domain, sm, function (msg) { return handleErrorMessage(msg); });\r\n        });\r\n    }\r\n    var requestsMap = {};\r\n    function join(options) {\r\n        _latestOptions = options;\r\n        return new Promise(function (resolve, reject) {\r\n            if (isJoined) {\r\n                resolve();\r\n                return;\r\n            }\r\n            var joinPromise;\r\n            if (domain === \"global\") {\r\n                joinPromise = _connectionOn ? Promise.resolve({}) : Promise.reject(\"not connected to gateway\");\r\n            }\r\n            else {\r\n                logger.debug(\"joining \" + domain);\r\n                var joinMsg = {\r\n                    type: \"join\",\r\n                    destination: domain,\r\n                    domain: \"global\",\r\n                    options: options,\r\n                };\r\n                joinPromise = send(joinMsg);\r\n            }\r\n            joinPromise\r\n                .then(function () {\r\n                handleJoined();\r\n                resolve();\r\n            })\r\n                .catch(function (err) {\r\n                logger.debug(\"error joining \" + domain + \" domain: \" + JSON.stringify(err));\r\n                reject(err);\r\n            });\r\n        });\r\n    }\r\n    function leave() {\r\n        if (domain === \"global\") {\r\n            return;\r\n        }\r\n        logger.debug(\"stopping session \" + domain + \"...\");\r\n        var leaveMsg = {\r\n            type: \"leave\",\r\n            destination: domain,\r\n            domain: \"global\",\r\n        };\r\n        send(leaveMsg).then(function () {\r\n            isJoined = false;\r\n            callbacks.execute(\"onLeft\");\r\n        });\r\n    }\r\n    function handleJoined() {\r\n        logger.debug(\"did join \" + domain);\r\n        isJoined = true;\r\n        var wasReconnect = tryReconnecting;\r\n        tryReconnecting = false;\r\n        callbacks.execute(\"onJoined\", wasReconnect);\r\n    }\r\n    function handleConnectionDisconnected() {\r\n        _connectionOn = false;\r\n        logger.warn(\"connection is down\");\r\n        isJoined = false;\r\n        tryReconnecting = true;\r\n        callbacks.execute(\"onLeft\", { disconnected: true });\r\n    }\r\n    function handleConnectionLoggedIn() {\r\n        _connectionOn = true;\r\n        if (tryReconnecting) {\r\n            logger.info(\"connection is now up - trying to reconnect...\");\r\n            join(_latestOptions);\r\n        }\r\n    }\r\n    function onJoined(callback) {\r\n        if (isJoined) {\r\n            callback(false);\r\n        }\r\n        return callbacks.add(\"onJoined\", callback);\r\n    }\r\n    function onLeft(callback) {\r\n        if (!isJoined) {\r\n            callback();\r\n        }\r\n        return callbacks.add(\"onLeft\", callback);\r\n    }\r\n    function handleErrorMessage(msg) {\r\n        if (domain !== msg.domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.error(msg);\r\n    }\r\n    function handleSuccessMessage(msg) {\r\n        if (msg.domain !== domain) {\r\n            return;\r\n        }\r\n        var requestId = msg.request_id;\r\n        var entry = requestsMap[requestId];\r\n        if (!entry) {\r\n            return;\r\n        }\r\n        entry.success(msg);\r\n    }\r\n    function getNextRequestId() {\r\n        return shortid_1.generate();\r\n    }\r\n    function send(msg, tag, options) {\r\n        options = options || {};\r\n        msg.request_id = msg.request_id || getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        if (!options.skipPeerId) {\r\n            msg.peer_id = connection.peerId;\r\n        }\r\n        var requestId = msg.request_id;\r\n        return new Promise(function (resolve, reject) {\r\n            requestsMap[requestId] = {\r\n                success: function (successMsg) {\r\n                    delete requestsMap[requestId];\r\n                    successMsg._tag = tag;\r\n                    resolve(successMsg);\r\n                },\r\n                error: function (errorMsg) {\r\n                    logger.warn(\"GW error - \" + JSON.stringify(errorMsg) + \" for request \" + JSON.stringify(msg));\r\n                    delete requestsMap[requestId];\r\n                    errorMsg._tag = tag;\r\n                    reject(errorMsg);\r\n                },\r\n            };\r\n            connection\r\n                .send(domain, domain, msg, undefined, options)\r\n                .catch(function (err) {\r\n                requestsMap[requestId].error({ err: err });\r\n            });\r\n        });\r\n    }\r\n    function sendFireAndForget(msg) {\r\n        msg.request_id = msg.request_id ? msg.request_id : getNextRequestId();\r\n        msg.domain = msg.domain || domain;\r\n        msg.peer_id = connection.peerId;\r\n        connection.send(domain, domain, msg);\r\n    }\r\n    return {\r\n        join: join,\r\n        leave: leave,\r\n        onJoined: onJoined,\r\n        onLeft: onLeft,\r\n        send: send,\r\n        sendFireAndForget: sendFireAndForget,\r\n        on: function (type, callback) {\r\n            connection.on(domain, type, function (msg) {\r\n                if (msg.domain !== domain) {\r\n                    return;\r\n                }\r\n                try {\r\n                    callback(msg);\r\n                }\r\n                catch (e) {\r\n                    logger.error(\"Callback  failed: \" + e + \" \\n msg was: \" + JSON.stringify(msg));\r\n                }\r\n            });\r\n        },\r\n        loggedIn: function (callback) { return connection.loggedIn(callback); },\r\n        connected: function (callback) { return connection.connected(callback); },\r\n        disconnected: function (callback) { return connection.disconnected(callback); },\r\n        get peerId() {\r\n            return connection.peerId;\r\n        },\r\n        get domain() {\r\n            return domain;\r\n        },\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=gw3Domain.js.map\n\n/***/ }),\n/* 62 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar HCProtocol = (function () {\r\n    function HCProtocol() {\r\n    }\r\n    HCProtocol.prototype.processStringMessage = function (message) {\r\n        var messageObj = JSON.parse(message);\r\n        return {\r\n            msg: messageObj,\r\n            msgType: messageObj.type,\r\n        };\r\n    };\r\n    HCProtocol.prototype.createStringMessage = function (product, type, message, id) {\r\n        return JSON.stringify(message);\r\n    };\r\n    HCProtocol.prototype.login = function (message) {\r\n        return Promise.resolve({ application: undefined });\r\n    };\r\n    HCProtocol.prototype.logout = function () {\r\n    };\r\n    HCProtocol.prototype.loggedIn = function (callback) {\r\n        callback();\r\n        return function () {\r\n        };\r\n    };\r\n    HCProtocol.prototype.processObjectMessage = function (message) {\r\n        throw new Error(\"not supported\");\r\n    };\r\n    HCProtocol.prototype.createObjectMessage = function (product, type, message, id) {\r\n        throw new Error(\"not supported\");\r\n    };\r\n    return HCProtocol;\r\n}());\r\nexports.default = HCProtocol;\r\n//# sourceMappingURL=hc.js.map\n\n/***/ }),\n/* 63 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar HCTransport = (function () {\r\n    function HCTransport() {\r\n        this.connectionId = Math.floor(1e10 * Math.random()).toString();\r\n    }\r\n    HCTransport.prototype.send = function (message, product, type) {\r\n        if (product === \"metrics\") {\r\n            window.htmlContainer.metricsFacade.send(type, message);\r\n        }\r\n        else if (product === \"log\") {\r\n            window.htmlContainer.loggingFacade.send(type, message);\r\n        }\r\n        return Promise.resolve(undefined);\r\n    };\r\n    HCTransport.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    HCTransport.prototype.onMessage = function (callback) {\r\n    };\r\n    HCTransport.prototype.close = function () {\r\n    };\r\n    HCTransport.prototype.open = function () {\r\n    };\r\n    return HCTransport;\r\n}());\r\nexports.default = HCTransport;\r\n//# sourceMappingURL=hc.js.map\n\n/***/ }),\n/* 64 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar Inproc = (function () {\r\n    function Inproc(token, gw, logger) {\r\n        this.registry = callback_registry_1.default();\r\n        this.gw = gw;\r\n        this.gwToken = token;\r\n        this.logger = logger;\r\n        this.connectToken = this.gw.connect(this.gwToken, this.messageHandler.bind(this));\r\n    }\r\n    Object.defineProperty(Inproc.prototype, \"isObjectBasedTransport\", {\r\n        get: function () {\r\n            return true;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Inproc.prototype.sendObject = function (msg) {\r\n        this.logger.debug(JSON.stringify(msg));\r\n        this.gw.send(this.connectToken, msg);\r\n        return Promise.resolve(undefined);\r\n    };\r\n    Inproc.prototype.send = function (msg, product, type) {\r\n        return Promise.reject(\"not supported\");\r\n    };\r\n    Inproc.prototype.onMessage = function (callback) {\r\n        return this.registry.add(\"onMessage\", callback);\r\n    };\r\n    Inproc.prototype.onConnectedChanged = function (callback) {\r\n        callback(true);\r\n    };\r\n    Inproc.prototype.close = function () {\r\n    };\r\n    Inproc.prototype.open = function () {\r\n    };\r\n    Inproc.prototype.messageHandler = function (msg) {\r\n        if (this.logger.consoleLevel() === \"trace\") {\r\n            this.logger.debug(JSON.stringify(msg));\r\n        }\r\n        this.registry.execute(\"onMessage\", msg);\r\n    };\r\n    return Inproc;\r\n}());\r\nexports.default = Inproc;\r\n//# sourceMappingURL=inproc.js.map\n\n/***/ }),\n/* 65 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = __webpack_require__(1);\r\nvar utils_1 = __webpack_require__(11);\r\nvar WebSocket = utils_1.default.isNode() ? __webpack_require__(26) : window.WebSocket;\r\nvar WS = (function () {\r\n    function WS(settings, logger) {\r\n        this._running = true;\r\n        this._initied = false;\r\n        this._registry = callback_registry_1.default();\r\n        this._settings = settings;\r\n        this._logger = logger;\r\n    }\r\n    WS.prototype.onMessage = function (callback) {\r\n        return this._registry.add(\"onMessage\", callback);\r\n    };\r\n    WS.prototype.send = function (msg, product, type, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            options = options || {};\r\n            _this.waitForSocketConnection(function () {\r\n                try {\r\n                    _this._ws.send(msg);\r\n                    resolve();\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\r\n            }, reject, options.maxRetries, options.retryInterval);\r\n        });\r\n    };\r\n    WS.prototype.open = function () {\r\n        this._running = true;\r\n    };\r\n    WS.prototype.close = function () {\r\n        this._running = false;\r\n        this._ws.close();\r\n    };\r\n    WS.prototype.onConnectedChanged = function (callback) {\r\n        return this._registry.add(\"onConnectedChanged\", callback);\r\n    };\r\n    WS.prototype.initiateSocket = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"initiating _ws to \" + this._settings.ws + \"...\");\r\n        this._ws = new WebSocket(this._settings.ws);\r\n        this._ws.onerror = function (err) {\r\n            _this.notifyStatusChanged(false, err);\r\n        };\r\n        this._ws.onclose = function () {\r\n            _this._logger.debug(\"_ws closed\");\r\n            _this.notifyStatusChanged(false);\r\n        };\r\n        this._ws.onopen = function () {\r\n            _this._logger.debug(\"_ws opened\");\r\n            _this.notifyStatusChanged(true);\r\n        };\r\n        this._ws.onmessage = function (message) {\r\n            _this._registry.execute(\"onMessage\", message.data);\r\n        };\r\n    };\r\n    WS.prototype.waitForSocketConnection = function (callback, failed, retriesLeft, retryInterval) {\r\n        var _this = this;\r\n        if (!callback) {\r\n            callback = function () { };\r\n        }\r\n        if (!failed) {\r\n            failed = function () { };\r\n        }\r\n        if (retryInterval === undefined) {\r\n            retryInterval = this._settings.reconnectInterval;\r\n        }\r\n        if (retriesLeft !== undefined) {\r\n            if (retriesLeft === 0) {\r\n                failed(\"wait for socket on \" + this._settings.ws + \" failed - no more retries left\");\r\n                return;\r\n            }\r\n            this._logger.debug(\"will retry \" + retriesLeft + \" more times (every \" + retryInterval + \" ms)\");\r\n        }\r\n        if (!this._running) {\r\n            failed(\"wait for socket on \" + this._settings.ws + \" failed - socket closed by user\");\r\n            return;\r\n        }\r\n        if (!this._ws || this._ws.readyState > 1) {\r\n            this.initiateSocket();\r\n        }\r\n        else if (this._ws.readyState === 1) {\r\n            return callback();\r\n        }\r\n        setTimeout(function () {\r\n            var retries = retriesLeft === undefined ? undefined : retriesLeft - 1;\r\n            _this.waitForSocketConnection(callback, failed, retries, retryInterval);\r\n        }, retryInterval);\r\n    };\r\n    WS.prototype.notifyStatusChanged = function (status, reason) {\r\n        this._registry.execute(\"onConnectedChanged\", status, reason);\r\n    };\r\n    return WS;\r\n}());\r\nexports.default = WS;\r\n//# sourceMappingURL=ws.js.map\n\n/***/ }),\n/* 66 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gw3ContextData_1 = __webpack_require__(67);\r\nvar helpers_1 = __webpack_require__(70);\r\nvar msg = __webpack_require__(14);\r\nvar contextMessageReplaySpec_1 = __webpack_require__(10);\r\nvar GW3Bridge = (function () {\r\n    function GW3Bridge(config) {\r\n        var _this = this;\r\n        this._contextNameToData = {};\r\n        this._gw3Subscriptions = [];\r\n        this._nextCallbackSubscriptionNumber = 0;\r\n        this._contextNameToId = {};\r\n        this._contextIdToName = {};\r\n        this._connection = config.connection;\r\n        this._logger = config.logger;\r\n        this._gw3Session = this._connection.domain(\"global\", this._logger, [\r\n            msg.GW_MESSAGE_CONTEXT_CREATED,\r\n            msg.GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            msg.GW_MESSAGE_CONTEXT_DESTROYED,\r\n            msg.GW_MESSAGE_CONTEXT_UPDATED,\r\n        ]);\r\n        this.subscribeToContextCreatedMessages();\r\n        this.subscribeToContextUpdatedMessages();\r\n        this.subscribeToContextDestroyedMessages();\r\n        this._connection.replayer.drain(contextMessageReplaySpec_1.ContextMessageReplaySpec.name, function (message) {\r\n            var type = message.type;\r\n            if (!type) {\r\n                return;\r\n            }\r\n            if (type === msg.GW_MESSAGE_CONTEXT_CREATED ||\r\n                type === msg.GW_MESSAGE_CONTEXT_ADDED ||\r\n                type === msg.GW_MESSAGE_ACTIVITY_CREATED) {\r\n                _this.handleContextCreatedMessage(message);\r\n            }\r\n            else if (type === msg.GW_MESSAGE_SUBSCRIBED_CONTEXT ||\r\n                type === msg.GW_MESSAGE_CONTEXT_UPDATED ||\r\n                type === msg.GW_MESSAGE_JOINED_ACTIVITY) {\r\n                _this.handleContextUpdatedMessage(message);\r\n            }\r\n            else if (type === msg.GW_MESSAGE_CONTEXT_DESTROYED ||\r\n                type === msg.GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n                _this.handleContextDestroyedMessage(message);\r\n            }\r\n        });\r\n    }\r\n    GW3Bridge.prototype.dispose = function () {\r\n        for (var _i = 0, _a = this._gw3Subscriptions; _i < _a.length; _i++) {\r\n            var sub = _a[_i];\r\n            this._connection.off(sub);\r\n        }\r\n        this._gw3Subscriptions.length = 0;\r\n        for (var contextName in this._contextNameToData) {\r\n            if (this._contextNameToId.hasOwnProperty(contextName)) {\r\n                delete this._contextNameToData[contextName];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.createContext = function (name, data) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: msg.GW_MESSAGE_CREATE_CONTEXT,\r\n            domain: \"global\",\r\n            name: name,\r\n            data: data,\r\n            lifetime: \"retained\",\r\n        })\r\n            .then(function (createContextMsg) {\r\n            _this._contextNameToId[name] = createContextMsg.context_id;\r\n            if (!_this._contextIdToName[createContextMsg.context_id]) {\r\n                _this._contextIdToName[createContextMsg.context_id] = name;\r\n                var contextData = _this._contextNameToData[name] || new gw3ContextData_1.GW3ContextData(createContextMsg.context_id, name, true, null);\r\n                contextData.isAnnounced = true;\r\n                contextData.name = name;\r\n                contextData.contextId = createContextMsg.context_id;\r\n                _this._contextNameToData[name] = contextData;\r\n                contextData.context = createContextMsg.data;\r\n                contextData.sentExplicitSubscription = true;\r\n                if (contextData.context) {\r\n                    _this.invokeUpdateCallbacks(contextData, contextData.context, null);\r\n                }\r\n                return _this.update(name, data).then(function () { return createContextMsg.context_id; });\r\n            }\r\n            return createContextMsg.context_id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.all = function () {\r\n        var _this = this;\r\n        return Object.keys(this._contextNameToData)\r\n            .filter(function (name) { return _this._contextNameToData[name].isAnnounced; });\r\n    };\r\n    GW3Bridge.prototype.update = function (name, delta) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return this.createContext(name, delta);\r\n        }\r\n        var calculatedDelta = this.calculateContextDelta(contextData.context, delta);\r\n        if (!Object.keys(calculatedDelta.added).length\r\n            && !Object.keys(calculatedDelta.updated).length\r\n            && !calculatedDelta.removed.length) {\r\n            return Promise.resolve();\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: msg.GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: calculatedDelta,\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, calculatedDelta, {\r\n                updaterId: gwResponse.peer_id\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.set = function (name, data) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return this.createContext(name, data);\r\n        }\r\n        return this._gw3Session\r\n            .send({\r\n            type: msg.GW_MESSAGE_UPDATE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n            delta: { reset: data },\r\n        }, {}, { skipPeerId: false })\r\n            .then(function (gwResponse) {\r\n            _this.handleUpdated(contextData, { reset: data, added: {}, removed: [], updated: {} }, { updaterId: gwResponse.peer_id });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.get = function (name) {\r\n        var _this = this;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\r\n                var _this = this;\r\n                return __generator(this, function (_a) {\r\n                    this.subscribe(name, function (data, delta, removed, un) {\r\n                        _this.unsubscribe(un);\r\n                        resolve(data);\r\n                    });\r\n                    return [2];\r\n                });\r\n            }); });\r\n        }\r\n        else {\r\n            return Promise.resolve(contextData.context);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (name, callback) {\r\n        var thisCallbackSubscriptionNumber = this._nextCallbackSubscriptionNumber;\r\n        this._nextCallbackSubscriptionNumber += 1;\r\n        var contextData = this._contextNameToData[name];\r\n        if (!contextData ||\r\n            !contextData.isAnnounced) {\r\n            contextData = contextData || new gw3ContextData_1.GW3ContextData(undefined, name, false, undefined);\r\n            this._contextNameToData[name] = contextData;\r\n            contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n        var hadCallbacks = contextData.hasCallbacks();\r\n        contextData.updateCallbacks[thisCallbackSubscriptionNumber] = callback;\r\n        if (!hadCallbacks) {\r\n            if (!contextData.joinedActivity) {\r\n                if (contextData.context &&\r\n                    contextData.sentExplicitSubscription) {\r\n                    callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n                    return Promise.resolve(thisCallbackSubscriptionNumber);\r\n                }\r\n                return this.sendSubscribe(contextData)\r\n                    .then(function () { return thisCallbackSubscriptionNumber; });\r\n            }\r\n            else {\r\n                callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n                return Promise.resolve(thisCallbackSubscriptionNumber);\r\n            }\r\n        }\r\n        else {\r\n            callback(contextData.context, contextData.context, [], thisCallbackSubscriptionNumber);\r\n            return Promise.resolve(thisCallbackSubscriptionNumber);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.unsubscribe = function (subscriptionKey) {\r\n        for (var _i = 0, _a = Object.keys(this._contextNameToData); _i < _a.length; _i++) {\r\n            var name_1 = _a[_i];\r\n            var contextId = this._contextNameToId[name_1];\r\n            var contextData = this._contextNameToData[name_1];\r\n            if (!contextData) {\r\n                return;\r\n            }\r\n            var hadCallbacks = contextData.hasCallbacks();\r\n            delete contextData.updateCallbacks[subscriptionKey];\r\n            if (contextData.isAnnounced &&\r\n                hadCallbacks &&\r\n                !contextData.hasCallbacks() &&\r\n                contextData.sentExplicitSubscription) {\r\n                this.sendUnsubscribe(contextData);\r\n            }\r\n            if (!contextData.isAnnounced &&\r\n                !contextData.hasCallbacks()) {\r\n                delete this._contextNameToData[name_1];\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleUpdated = function (contextData, delta, extraData) {\r\n        var oldContext = contextData.context;\r\n        contextData.context = helpers_1.applyContextDelta(contextData.context, delta);\r\n        if (this._contextNameToData[contextData.name] === contextData &&\r\n            !helpers_1.deepEqual(oldContext, contextData.context)) {\r\n            this.invokeUpdateCallbacks(contextData, contextData.context, delta, extraData);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextCreatedMessages = function () {\r\n        var createdMessageTypes = [\r\n            msg.GW_MESSAGE_CONTEXT_ADDED,\r\n            msg.GW_MESSAGE_CONTEXT_CREATED,\r\n            msg.GW_MESSAGE_ACTIVITY_CREATED,\r\n        ];\r\n        for (var _i = 0, createdMessageTypes_1 = createdMessageTypes; _i < createdMessageTypes_1.length; _i++) {\r\n            var createdMessageType = createdMessageTypes_1[_i];\r\n            var sub = this._connection.on(\"js-contexts\", createdMessageType, this.handleContextCreatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextCreatedMessage = function (contextCreatedMsg) {\r\n        var createdMessageType = contextCreatedMsg.type;\r\n        if (createdMessageType === msg.GW_MESSAGE_ACTIVITY_CREATED) {\r\n            this._contextNameToId[contextCreatedMsg.activity_id] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.activity_id;\r\n        }\r\n        else if (createdMessageType === msg.GW_MESSAGE_CONTEXT_ADDED) {\r\n            this._contextNameToId[contextCreatedMsg.name] = contextCreatedMsg.context_id;\r\n            this._contextIdToName[contextCreatedMsg.context_id] = contextCreatedMsg.name;\r\n        }\r\n        else if (createdMessageType === msg.GW_MESSAGE_CONTEXT_CREATED) {\r\n        }\r\n        var name = this._contextIdToName[contextCreatedMsg.context_id];\r\n        if (!name) {\r\n            throw new Error(\"Received created event for context with unknown name: \" + contextCreatedMsg.context_id);\r\n        }\r\n        if (!this._contextNameToId[name]) {\r\n            throw new Error(\"Received created event for context with unknown id: \" + contextCreatedMsg.context_id);\r\n        }\r\n        var contextData = this._contextNameToData[name];\r\n        if (contextData) {\r\n            if (contextData.isAnnounced) {\r\n                return;\r\n            }\r\n            else {\r\n                if (!contextData.hasCallbacks()) {\r\n                    throw new Error(\"Assertion failure: contextData.hasCallbacks()\");\r\n                }\r\n                contextData.isAnnounced = true;\r\n                contextData.contextId = contextCreatedMsg.context_id;\r\n                contextData.activityId = contextCreatedMsg.activity_id;\r\n                if (!contextData.sentExplicitSubscription) {\r\n                    this.sendSubscribe(contextData);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this._contextNameToData[name] = contextData =\r\n                new gw3ContextData_1.GW3ContextData(contextCreatedMsg.context_id, name, true, contextCreatedMsg.activity_id);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextUpdatedMessages = function () {\r\n        var updatedMessageTypes = [\r\n            msg.GW_MESSAGE_CONTEXT_UPDATED,\r\n            msg.GW_MESSAGE_SUBSCRIBED_CONTEXT,\r\n            msg.GW_MESSAGE_JOINED_ACTIVITY,\r\n        ];\r\n        for (var _i = 0, updatedMessageTypes_1 = updatedMessageTypes; _i < updatedMessageTypes_1.length; _i++) {\r\n            var updatedMessageType = updatedMessageTypes_1[_i];\r\n            var sub = this._connection.on(\"js-contexts\", updatedMessageType, this.handleContextUpdatedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextUpdatedMessage = function (contextUpdatedMsg) {\r\n        var updatedMessageType = contextUpdatedMsg.type;\r\n        var contextId = contextUpdatedMsg.context_id;\r\n        var contextData = this._contextNameToData[this._contextIdToName[contextId]];\r\n        var justSeen = !contextData || !contextData.isAnnounced;\r\n        if (updatedMessageType === msg.GW_MESSAGE_JOINED_ACTIVITY) {\r\n            if (!contextData) {\r\n                contextData = new gw3ContextData_1.GW3ContextData(contextId, contextUpdatedMsg.activity_id, true, contextUpdatedMsg.activity_id);\r\n                this._contextNameToData[contextUpdatedMsg.activity_id] = contextData;\r\n                this._contextIdToName[contextId] = contextUpdatedMsg.activity_id;\r\n                this._contextNameToId[contextUpdatedMsg.activity_id] = contextId;\r\n            }\r\n            else {\r\n                contextData.contextId = contextId;\r\n                contextData.isAnnounced = true;\r\n                contextData.activityId = contextUpdatedMsg.activity_id;\r\n            }\r\n            contextData.joinedActivity = true;\r\n        }\r\n        else {\r\n            if (!contextData || !contextData.isAnnounced) {\r\n                if (updatedMessageType === msg.GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n                    contextData = contextData || new gw3ContextData_1.GW3ContextData(contextId, contextUpdatedMsg.name, true, null);\r\n                    contextData.sentExplicitSubscription = true;\r\n                    this._contextNameToData[contextUpdatedMsg.name] = contextData;\r\n                    this._contextIdToName[contextId] = contextUpdatedMsg.name;\r\n                    this._contextNameToId[contextUpdatedMsg.name] = contextId;\r\n                }\r\n                else {\r\n                    this._logger.error(\"Received 'update' for unknown context: \" + contextId);\r\n                }\r\n                return;\r\n            }\r\n        }\r\n        var oldContext = contextData.context;\r\n        if (updatedMessageType === msg.GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            contextData.context = contextUpdatedMsg.data || {};\r\n        }\r\n        else if (updatedMessageType === msg.GW_MESSAGE_JOINED_ACTIVITY) {\r\n            contextData.context = contextUpdatedMsg.context_snapshot || {};\r\n        }\r\n        else if (updatedMessageType === msg.GW_MESSAGE_CONTEXT_UPDATED) {\r\n            contextData.context = helpers_1.applyContextDelta(contextData.context, contextUpdatedMsg.delta);\r\n        }\r\n        else {\r\n            throw new Error(\"Unrecognized context update message \" + updatedMessageType);\r\n        }\r\n        if (justSeen ||\r\n            !helpers_1.deepEqual(contextData.context, oldContext) ||\r\n            updatedMessageType === msg.GW_MESSAGE_SUBSCRIBED_CONTEXT) {\r\n            this.invokeUpdateCallbacks(contextData, contextData.context, null, { updaterId: contextUpdatedMsg.updater_id });\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeUpdateCallbacks = function (contextData, data, delta, extraData) {\r\n        delta = delta || { added: {}, updated: {}, reset: {}, removed: [] };\r\n        for (var updateCallbackIndex in contextData.updateCallbacks) {\r\n            if (contextData.updateCallbacks.hasOwnProperty(updateCallbackIndex)) {\r\n                try {\r\n                    var updateCallback = contextData.updateCallbacks[updateCallbackIndex];\r\n                    updateCallback(helpers_1.deepClone(data), Object.assign({}, delta.added || {}, delta.updated || {}, delta.reset || {}), delta.removed, parseInt(updateCallbackIndex), extraData);\r\n                }\r\n                catch (err) {\r\n                    this._logger.debug(\"Callback error: \" + JSON.stringify(err));\r\n                }\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContextDestroyedMessages = function () {\r\n        var destroyedMessageTypes = [\r\n            msg.GW_MESSAGE_CONTEXT_DESTROYED,\r\n            msg.GW_MESSAGE_ACTIVITY_DESTROYED,\r\n        ];\r\n        for (var _i = 0, destroyedMessageTypes_1 = destroyedMessageTypes; _i < destroyedMessageTypes_1.length; _i++) {\r\n            var destroyedMessageType = destroyedMessageTypes_1[_i];\r\n            var sub = this._connection.on(\"js-contexts\", destroyedMessageType, this.handleContextDestroyedMessage.bind(this));\r\n            this._gw3Subscriptions.push(sub);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.handleContextDestroyedMessage = function (destroyedMsg) {\r\n        var destroyedMessageType = destroyedMsg.type;\r\n        var contextId;\r\n        var name;\r\n        if (destroyedMessageType === msg.GW_MESSAGE_ACTIVITY_DESTROYED) {\r\n            name = destroyedMsg.activity_id;\r\n            contextId = this._contextNameToId[name];\r\n            if (!contextId) {\r\n                this._logger.error(\"Received 'destroyed' for unknown activity: \" + destroyedMsg.activity_id);\r\n                return;\r\n            }\r\n        }\r\n        else {\r\n            contextId = destroyedMsg.context_id;\r\n            name = this._contextIdToName[contextId];\r\n            if (!name) {\r\n                this._logger.error(\"Received 'destroyed' for unknown context: \" + destroyedMsg.context_id);\r\n                return;\r\n            }\r\n        }\r\n        delete this._contextIdToName[contextId];\r\n        delete this._contextNameToId[name];\r\n        var contextData = this._contextNameToData[name];\r\n        delete this._contextNameToData[name];\r\n        if (!contextData || !contextData.isAnnounced) {\r\n            this._logger.error(\"Received 'destroyed' for unknown context: \" + contextId);\r\n            return;\r\n        }\r\n    };\r\n    GW3Bridge.prototype.sendSubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = true;\r\n        return this._gw3Session\r\n            .send({\r\n            type: msg.GW_MESSAGE_SUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.sendUnsubscribe = function (contextData) {\r\n        contextData.sentExplicitSubscription = false;\r\n        return this._gw3Session\r\n            .send({\r\n            type: msg.GW_MESSAGE_UNSUBSCRIBE_CONTEXT,\r\n            domain: \"global\",\r\n            context_id: contextData.contextId,\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.calculateContextDelta = function (from, to) {\r\n        var delta = { added: {}, updated: {}, removed: [], reset: null };\r\n        if (from) {\r\n            for (var _i = 0, _a = Object.keys(from); _i < _a.length; _i++) {\r\n                var x = _a[_i];\r\n                if (Object.keys(to).indexOf(x) !== -1\r\n                    && to[x] !== null\r\n                    && !helpers_1.deepEqual(from[x], to[x])) {\r\n                    delta.updated[x] = to[x];\r\n                }\r\n            }\r\n        }\r\n        for (var _b = 0, _c = Object.keys(to); _b < _c.length; _b++) {\r\n            var x = _c[_b];\r\n            if (!from || (Object.keys(from).indexOf(x) === -1)) {\r\n                if (to[x] !== null) {\r\n                    delta.added[x] = to[x];\r\n                }\r\n            }\r\n            else if (to[x] === null) {\r\n                delta.removed.push(x);\r\n            }\r\n        }\r\n        return delta;\r\n    };\r\n    return GW3Bridge;\r\n}());\r\nexports.GW3Bridge = GW3Bridge;\r\n//# sourceMappingURL=gw3Bridge.js.map\n\n/***/ }),\n/* 67 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar GW3ContextData = (function () {\r\n    function GW3ContextData(contextId, name, isAnnounced, activityId) {\r\n        this.updateCallbacks = {};\r\n        this.contextId = contextId;\r\n        this.name = name;\r\n        this.isAnnounced = isAnnounced;\r\n        this.activityId = activityId;\r\n        this.context = {};\r\n    }\r\n    GW3ContextData.prototype.hasCallbacks = function () {\r\n        return Object.keys(this.updateCallbacks).length > 0;\r\n    };\r\n    GW3ContextData.prototype.getState = function () {\r\n        if (this.isAnnounced && this.hasCallbacks()) {\r\n            return 3;\r\n        }\r\n        if (this.isAnnounced) {\r\n            return 2;\r\n        }\r\n        if (this.hasCallbacks()) {\r\n            return 1;\r\n        }\r\n        return 0;\r\n    };\r\n    return GW3ContextData;\r\n}());\r\nexports.GW3ContextData = GW3ContextData;\r\n//# sourceMappingURL=gw3ContextData.js.map\n\n/***/ }),\n/* 68 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar HCBridge = (function () {\r\n    function HCBridge(config) {\r\n        this._facade = window.htmlContainer.sharedContextFacade;\r\n    }\r\n    HCBridge.prototype.all = function () {\r\n        var allObj = this._facade.all();\r\n        if (!allObj || !allObj.keys) {\r\n            return [];\r\n        }\r\n        return allObj.keys;\r\n    };\r\n    HCBridge.prototype.update = function (name, delta) {\r\n        this._facade.update(name, delta);\r\n        return Promise.resolve();\r\n    };\r\n    HCBridge.prototype.set = function (name, data) {\r\n        this._facade.set(name, data);\r\n        return Promise.resolve();\r\n    };\r\n    HCBridge.prototype.subscribe = function (name, callback) {\r\n        var snapshot = null;\r\n        var key = this._facade.subscribe(name, function (data, delta, removed) {\r\n            if (!key && key !== 0) {\r\n                snapshot = data;\r\n                return;\r\n            }\r\n            callback(data, delta, removed, key);\r\n        });\r\n        if (snapshot) {\r\n            callback(snapshot, snapshot, [], key);\r\n            snapshot = null;\r\n        }\r\n        return Promise.resolve(key);\r\n    };\r\n    HCBridge.prototype.get = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                this.subscribe(name, function (data, un) {\r\n                    _this.unsubscribe(un);\r\n                    resolve(data);\r\n                });\r\n                return [2];\r\n            });\r\n        }); });\r\n    };\r\n    HCBridge.prototype.unsubscribe = function (key) {\r\n        this._facade.unsubscribe(key);\r\n    };\r\n    return HCBridge;\r\n}());\r\nexports.HCBridge = HCBridge;\r\n//# sourceMappingURL=hcBridge.js.map\n\n/***/ }),\n/* 69 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gw3Bridge_1 = __webpack_require__(66);\r\nvar hcBridge_1 = __webpack_require__(68);\r\nvar ContextsModule = (function () {\r\n    function ContextsModule(config) {\r\n        this.config = config;\r\n        try {\r\n            if (config.gdMajorVersion === 2) {\r\n                var hc = window.htmlContainer;\r\n                if (!hc.sharedContextFacade) {\r\n                    throw new Error(\"Your version of HtmlContainer does not support contexts.\"\r\n                        + \" Get version 1.46.0.0 or later to have that feature.\");\r\n                }\r\n                this._bridge = new hcBridge_1.HCBridge(config);\r\n            }\r\n            else if (config.connection.protocolVersion === 3) {\r\n                this._bridge = new gw3Bridge_1.GW3Bridge(config);\r\n            }\r\n            else {\r\n                throw new Error(\"To use the Contexts library you must run in the\"\r\n                    + \" HTML Container or using a connection to Gateway v3.\");\r\n            }\r\n        }\r\n        catch (err) {\r\n            throw err;\r\n        }\r\n    }\r\n    ContextsModule.prototype.all = function () {\r\n        return this._bridge.all();\r\n    };\r\n    ContextsModule.prototype.update = function (name, delta) {\r\n        this.checkName(name);\r\n        return this._bridge.update(name, delta);\r\n    };\r\n    ContextsModule.prototype.set = function (name, data) {\r\n        this.checkName(name);\r\n        return this._bridge.set(name, data);\r\n    };\r\n    ContextsModule.prototype.subscribe = function (name, callback) {\r\n        var _this = this;\r\n        this.checkName(name);\r\n        return this._bridge\r\n            .subscribe(name, function (data, delta, removed, key, extraData) { return callback(data, delta, removed, function () { return _this._bridge.unsubscribe(key); }, extraData); })\r\n            .then(function (key) {\r\n            return function () {\r\n                _this._bridge.unsubscribe(key);\r\n            };\r\n        });\r\n    };\r\n    ContextsModule.prototype.get = function (name) {\r\n        return this._bridge.get(name);\r\n    };\r\n    ContextsModule.prototype.ready = function () {\r\n        return Promise.resolve(this);\r\n    };\r\n    ContextsModule.prototype.checkName = function (name) {\r\n        if (typeof name !== \"string\" ||\r\n            name == \"\") {\r\n            throw new Error(\"'name' must be non-empty string, got '\" + name + \"'\");\r\n        }\r\n    };\r\n    return ContextsModule;\r\n}());\r\nexports.ContextsModule = ContextsModule;\r\n//# sourceMappingURL=contextsModule.js.map\n\n/***/ }),\n/* 70 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction applyContextDelta(context, delta) {\r\n    if (delta) {\r\n        if (delta.reset) {\r\n            context = __assign({}, delta.reset);\r\n            return context;\r\n        }\r\n        context = deepClone(context, null);\r\n        var added_1 = delta.added;\r\n        var updated_1 = delta.updated;\r\n        var removed = delta.removed;\r\n        if (added_1) {\r\n            Object.keys(added_1).forEach(function (key) {\r\n                context[key] = added_1[key];\r\n            });\r\n        }\r\n        if (updated_1) {\r\n            Object.keys(updated_1).forEach(function (key) {\r\n                mergeObjectsProperties(key, context, updated_1);\r\n            });\r\n        }\r\n        if (removed) {\r\n            removed.forEach(function (key) {\r\n                delete context[key];\r\n            });\r\n        }\r\n    }\r\n    return context;\r\n}\r\nexports.applyContextDelta = applyContextDelta;\r\nfunction deepClone(obj, hash) {\r\n    hash = hash || new WeakMap();\r\n    if (Object(obj) !== obj) {\r\n        return obj;\r\n    }\r\n    if (obj instanceof Set) {\r\n        return new Set(obj);\r\n    }\r\n    if (hash.has(obj)) {\r\n        return hash.get(obj);\r\n    }\r\n    var result = obj instanceof Date ? new Date(obj)\r\n        : obj instanceof RegExp ? new RegExp(obj.source, obj.flags)\r\n            : obj.constructor ? new obj.constructor()\r\n                : Object.create(null);\r\n    hash.set(obj, result);\r\n    if (obj instanceof Map) {\r\n        Array.from(obj, function (_a) {\r\n            var key = _a[0], val = _a[1];\r\n            return result.set(key, deepClone(val, hash));\r\n        });\r\n    }\r\n    return Object.assign.apply(Object, [result].concat(Object.keys(obj).map(function (key) {\r\n        var _a;\r\n        return (_a = {}, _a[key] = deepClone(obj[key], hash), _a);\r\n    })));\r\n}\r\nexports.deepClone = deepClone;\r\nvar mergeObjectsProperties = function (key, what, withWhat) {\r\n    var right = withWhat[key];\r\n    if (right === undefined) {\r\n        return what;\r\n    }\r\n    var left = what[key];\r\n    if (!left || !right) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    if (typeof left === \"string\" ||\r\n        typeof left === \"number\" ||\r\n        typeof left === \"boolean\" ||\r\n        typeof right === \"string\" ||\r\n        typeof right === \"number\" ||\r\n        typeof right === \"boolean\" ||\r\n        Array.isArray(left) ||\r\n        Array.isArray(right)) {\r\n        what[key] = right;\r\n        return what;\r\n    }\r\n    what[key] = Object.assign({}, left, right);\r\n    return what;\r\n};\r\nfunction deepEqual(x, y) {\r\n    if (x === y) {\r\n        return true;\r\n    }\r\n    if (!(x instanceof Object) || !(y instanceof Object)) {\r\n        return false;\r\n    }\r\n    if (x.constructor !== y.constructor) {\r\n        return false;\r\n    }\r\n    for (var p in x) {\r\n        if (!x.hasOwnProperty(p)) {\r\n            continue;\r\n        }\r\n        if (!y.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n        if (x[p] === y[p]) {\r\n            continue;\r\n        }\r\n        if (typeof (x[p]) !== \"object\") {\r\n            return false;\r\n        }\r\n        if (!deepEqual(x[p], y[p])) {\r\n            return false;\r\n        }\r\n    }\r\n    for (var p in y) {\r\n        if (y.hasOwnProperty(p) && !x.hasOwnProperty(p)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\nexports.deepEqual = deepEqual;\r\n//# sourceMappingURL=helpers.js.map\n\n/***/ }),\n/* 71 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar contextsModule_1 = __webpack_require__(69);\r\nexports.ContextsModule = contextsModule_1.ContextsModule;\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 72 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar LogLevel = (function () {\r\n    function LogLevel() {\r\n    }\r\n    LogLevel.canPublish = function (level, restriction) {\r\n        var levelIdx = LogLevel.order.indexOf(level);\r\n        var restrictionIdx = LogLevel.order.indexOf(restriction);\r\n        return levelIdx >= restrictionIdx;\r\n    };\r\n    LogLevel.off = \"off\";\r\n    LogLevel.trace = \"trace\";\r\n    LogLevel.debug = \"debug\";\r\n    LogLevel.info = \"info\";\r\n    LogLevel.warn = \"warn\";\r\n    LogLevel.error = \"error\";\r\n    LogLevel.order = [LogLevel.trace, LogLevel.debug, LogLevel.info, LogLevel.warn, LogLevel.error, LogLevel.off];\r\n    return LogLevel;\r\n}());\r\nexports.default = LogLevel;\r\n//# sourceMappingURL=levels.js.map\n\n/***/ }),\n/* 73 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar levels_1 = __webpack_require__(72);\r\nvar LoggerImpl = (function () {\r\n    function LoggerImpl(name, parent, metricSystem) {\r\n        this._subloggers = [];\r\n        this._name = name;\r\n        this._parent = parent;\r\n        if (parent) {\r\n            this._path = parent.path + \".\" + name;\r\n        }\r\n        else {\r\n            this._path = name;\r\n        }\r\n        this._loggerFullName = \"[\" + this._path + \"]\";\r\n        if (typeof metricSystem !== \"undefined\") {\r\n            this.metricsLevel(\"warn\", metricSystem.subSystem(name));\r\n        }\r\n    }\r\n    Object.defineProperty(LoggerImpl.prototype, \"name\", {\r\n        get: function () {\r\n            return this._name;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(LoggerImpl.prototype, \"path\", {\r\n        get: function () {\r\n            return this._path;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    LoggerImpl.prototype.subLogger = function (name) {\r\n        var existingSub = this._subloggers.filter(function (subLogger) {\r\n            return subLogger.name === name;\r\n        })[0];\r\n        if (existingSub !== undefined) {\r\n            return existingSub;\r\n        }\r\n        Object.keys(this).forEach(function (key) {\r\n            if (key === name) {\r\n                throw new Error(\"This sub logger name is not allowed.\");\r\n            }\r\n        });\r\n        var sub = new LoggerImpl(name, this);\r\n        this._subloggers.push(sub);\r\n        return sub;\r\n    };\r\n    LoggerImpl.prototype.publishLevel = function (level) {\r\n        if (level !== null && level !== undefined) {\r\n            this._publishLevel = level;\r\n        }\r\n        return this._publishLevel || this._parent.publishLevel();\r\n    };\r\n    LoggerImpl.prototype.consoleLevel = function (level) {\r\n        if (level !== null && level !== undefined) {\r\n            this._consoleLevel = level;\r\n        }\r\n        return this._consoleLevel || this._parent.consoleLevel();\r\n    };\r\n    LoggerImpl.prototype.metricsLevel = function (level, metricsSystem) {\r\n        if (level !== null && level !== undefined) {\r\n            this._metricLevel = level;\r\n        }\r\n        if (metricsSystem !== undefined) {\r\n            if (typeof metricsSystem === \"object\" && typeof metricsSystem.objectMetric === \"function\") {\r\n                this._metricSystem = metricsSystem;\r\n            }\r\n            else {\r\n                throw new Error(\"Please specify metric system\");\r\n            }\r\n        }\r\n        return this._metricLevel || this._parent.metricsLevel();\r\n    };\r\n    LoggerImpl.prototype.log = function (message, level) {\r\n        this.publishMessage(level || levels_1.default.info, message);\r\n    };\r\n    LoggerImpl.prototype.trace = function (message) {\r\n        this.log(message, levels_1.default.trace);\r\n    };\r\n    LoggerImpl.prototype.debug = function (message) {\r\n        this.log(message, levels_1.default.debug);\r\n    };\r\n    LoggerImpl.prototype.info = function (message) {\r\n        this.log(message, levels_1.default.info);\r\n    };\r\n    LoggerImpl.prototype.warn = function (message) {\r\n        this.log(message, levels_1.default.warn);\r\n    };\r\n    LoggerImpl.prototype.error = function (message) {\r\n        this.log(message, levels_1.default.error);\r\n    };\r\n    LoggerImpl.prototype.toAPIObject = function () {\r\n        var that = this;\r\n        return {\r\n            name: this.name,\r\n            subLogger: this.subLogger.bind(that),\r\n            publishLevel: this.publishLevel.bind(that),\r\n            consoleLevel: this.consoleLevel.bind(that),\r\n            metricsLevel: this.metricsLevel.bind(that),\r\n            log: this.log.bind(that),\r\n            trace: this.trace.bind(that),\r\n            debug: this.debug.bind(that),\r\n            info: this.info.bind(that),\r\n            warn: this.warn.bind(that),\r\n            error: this.error.bind(that),\r\n        };\r\n    };\r\n    LoggerImpl.prototype.publishMessage = function (level, message) {\r\n        var loggerName = this._loggerFullName;\r\n        if (level === levels_1.default.error) {\r\n            var e = new Error();\r\n            if (e.stack) {\r\n                message = message + \"\\n\" +\r\n                    (e.stack.split(\"\\n\").slice(3).join(\"\\n\"));\r\n            }\r\n        }\r\n        if (levels_1.default.canPublish(level, this.consoleLevel())) {\r\n            var toPrint = loggerName + \": \" + message;\r\n            switch (level) {\r\n                case levels_1.default.trace:\r\n                    console.trace(toPrint);\r\n                    break;\r\n                case levels_1.default.debug:\r\n                    if (console.debug) {\r\n                        console.debug(toPrint);\r\n                    }\r\n                    else {\r\n                        console.log(toPrint);\r\n                    }\r\n                    break;\r\n                case levels_1.default.info:\r\n                    console.info(toPrint);\r\n                    break;\r\n                case levels_1.default.warn:\r\n                    console.warn(toPrint);\r\n                    break;\r\n                case levels_1.default.error:\r\n                    console.error(toPrint);\r\n                    break;\r\n            }\r\n        }\r\n        if (levels_1.default.canPublish(level, this.publishLevel())) {\r\n            LoggerImpl.GetConnection().send(\"log\", \"LogMessage\", {\r\n                instance: LoggerImpl.Instance,\r\n                level: levels_1.default.order.indexOf(level),\r\n                logger: loggerName,\r\n                message: message,\r\n            });\r\n        }\r\n        if (levels_1.default.canPublish(level, this.metricsLevel())) {\r\n            if (this._metricSystem !== undefined) {\r\n                this._metricSystem.objectMetric(\"LogMessage\", {\r\n                    Level: level,\r\n                    Logger: loggerName,\r\n                    Message: message,\r\n                    Time: new Date(),\r\n                });\r\n                if (level === levels_1.default.error) {\r\n                    this._metricSystem.setState(100, message);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return LoggerImpl;\r\n}());\r\nexports.default = LoggerImpl;\r\n//# sourceMappingURL=logger.js.map\n\n/***/ }),\n/* 74 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar logger_1 = __webpack_require__(73);\r\nexports.default = (function (settings) {\r\n    var identity = settings.identity;\r\n    if (!identity) {\r\n        throw new Error(\"identity is missing\");\r\n    }\r\n    var identityStr = identity.system + \"\\\\\" + identity.service + \"\\\\\" + identity.instance;\r\n    logger_1.default.Instance = identityStr;\r\n    logger_1.default.GetConnection = settings.getConnection;\r\n    var mainLogger = new logger_1.default(\"main\");\r\n    mainLogger.publishLevel(settings.publish || \"off\");\r\n    mainLogger.consoleLevel(settings.console || \"info\");\r\n    mainLogger.metricsLevel(settings.metrics || \"off\");\r\n    var apiLogger = mainLogger.toAPIObject();\r\n    return apiLogger;\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 75 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nvar glue_1 = __webpack_require__(16);\r\nvar pjson = __webpack_require__(12);\r\nif (typeof window !== \"undefined\") {\r\n    window.GlueCore = glue_1.default;\r\n}\r\nglue_1.default.default = glue_1.default;\r\nglue_1.default.version = pjson.version;\r\nmodule.exports = glue_1.default;\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 76 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction addressMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var conflation = definition.conflation;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.ADDRESS;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = addressMetric;\r\n//# sourceMappingURL=address.js.map\n\n/***/ }),\n/* 77 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction countMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || 0;\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.COUNT;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    function incrementBy(num) {\r\n        update(_value + num);\r\n    }\r\n    function increment() {\r\n        incrementBy(1);\r\n    }\r\n    function decrement() {\r\n        incrementBy(-1);\r\n    }\r\n    function decrementBy(num) {\r\n        incrementBy(num * -1);\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get path() {\r\n            return _path;\r\n        },\r\n        get value() {\r\n            return _value;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n        incrementBy: incrementBy,\r\n        increment: increment,\r\n        decrement: decrement,\r\n        decrementBy: decrementBy,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = countMetric;\r\n//# sourceMappingURL=count.js.map\n\n/***/ }),\n/* 78 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction numberMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _path = parent.path.slice(0);\r\n    var _value = value || 0;\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.NUMBER;\r\n    _path.push(parent.name);\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    function incrementBy(num) {\r\n        update(_value + num);\r\n    }\r\n    function increment() {\r\n        incrementBy(1);\r\n    }\r\n    function decrement() {\r\n        incrementBy(-1);\r\n    }\r\n    function decrementBy(num) {\r\n        incrementBy(num * -1);\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        type: type,\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n        incrementBy: incrementBy,\r\n        increment: increment,\r\n        decrement: decrement,\r\n        decrementBy: decrementBy,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = numberMetric;\r\n//# sourceMappingURL=number.js.map\n\n/***/ }),\n/* 79 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar metric_types_1 = __webpack_require__(0);\r\nvar helpers_1 = __webpack_require__(2);\r\nfunction objectMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.OBJECT;\r\n    function update(newValue) {\r\n        mergeValues(newValue);\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    function mergeValues(values) {\r\n        return Object.keys(_value).forEach(function (k) {\r\n            if (typeof values[k] !== \"undefined\") {\r\n                _value[k] = values[k];\r\n            }\r\n        });\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = objectMetric;\r\n//# sourceMappingURL=object.js.map\n\n/***/ }),\n/* 80 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction rateMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.RATE;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = rateMetric;\r\n//# sourceMappingURL=rate.js.map\n\n/***/ }),\n/* 81 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction statisticsMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.STATISTICS;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = statisticsMetric;\r\n//# sourceMappingURL=statistics.js.map\n\n/***/ }),\n/* 82 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction stringMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.STRING;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        type: type,\r\n        update: update,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = stringMetric;\r\n//# sourceMappingURL=string.js.map\n\n/***/ }),\n/* 83 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction timespanMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.TIMESPAN;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function start() {\r\n        update(true);\r\n    }\r\n    function stop() {\r\n        update(false);\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        start: start,\r\n        stop: stop,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = timespanMetric;\r\n//# sourceMappingURL=timespan.js.map\n\n/***/ }),\n/* 84 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar helpers_1 = __webpack_require__(2);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction timestampMetric(definition, parent, transport, value) {\r\n    helpers_1.default.validate(definition, parent, transport);\r\n    var _transport = transport;\r\n    var _value = value || \"\";\r\n    var _path = parent.path.slice(0);\r\n    _path.push(parent.name);\r\n    var name = definition.name;\r\n    var description = definition.description;\r\n    var period = definition.period;\r\n    var resolution = definition.resolution;\r\n    var conflation = definition.conflation;\r\n    var system = parent;\r\n    var repo = parent.repo;\r\n    var id = parent.path + \"/\" + name;\r\n    var type = metric_types_1.default.TIMESTAMP;\r\n    function update(newValue) {\r\n        _value = newValue;\r\n        _transport.updateMetric(me);\r\n    }\r\n    function now() {\r\n        update(new Date());\r\n    }\r\n    function getValueType() {\r\n        return undefined;\r\n    }\r\n    var me = {\r\n        name: name,\r\n        description: description,\r\n        period: period,\r\n        resolution: resolution,\r\n        system: system,\r\n        repo: repo,\r\n        id: id,\r\n        type: type,\r\n        conflation: conflation,\r\n        get value() {\r\n            return _value;\r\n        },\r\n        get path() {\r\n            return _path;\r\n        },\r\n        update: update,\r\n        now: now,\r\n        getValueType: getValueType,\r\n    };\r\n    _transport.createMetric(me);\r\n    return me;\r\n}\r\nexports.default = timestampMetric;\r\n//# sourceMappingURL=timestamp.js.map\n\n/***/ }),\n/* 85 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar serializer_1 = __webpack_require__(86);\r\nfunction default_1(connection, config) {\r\n    var DEFAULT_HEARTBEAT_INTERVAL = 3000;\r\n    var heartbeatTimer;\r\n    if (!connection || typeof connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var _connection = connection;\r\n    var heartbeatInterval = config.heartbeatInterval || DEFAULT_HEARTBEAT_INTERVAL;\r\n    var send = function (type, message) {\r\n        _connection.send(\"metrics\", type, message);\r\n    };\r\n    function sendFull(repo) {\r\n        if (!repo.root) {\r\n            return;\r\n        }\r\n        if (repo.root.subSystems.length === 0) {\r\n            return;\r\n        }\r\n        sendFullSystem(repo.root);\r\n    }\r\n    function sendFullSystem(system) {\r\n        createSystem(system);\r\n        system.subSystems.forEach(function (sub) {\r\n            sendFullSystem(sub);\r\n        });\r\n        system.metrics.forEach(function (metric) {\r\n            createMetric(metric);\r\n        });\r\n    }\r\n    function heartbeat(repo) {\r\n        send(\"HeartbeatMetrics\", {\r\n            publishingInterval: heartbeatInterval,\r\n            instance: repo.instance,\r\n        });\r\n    }\r\n    function createSystem(system) {\r\n        if (system.parent !== undefined) {\r\n            send(\"CreateMetricSystem\", {\r\n                id: system.id,\r\n                instance: system.repo.instance,\r\n                definition: {\r\n                    name: system.name,\r\n                    description: system.description,\r\n                    path: system.path,\r\n                },\r\n            });\r\n        }\r\n    }\r\n    function updateSystem(system, state) {\r\n        send(\"UpdateMetricSystem\", {\r\n            id: system.id,\r\n            instance: system.repo.instance,\r\n            state: state,\r\n        });\r\n    }\r\n    function createMetric(metric) {\r\n        send(\"CreateMetric\", serializer_1.default(metric));\r\n    }\r\n    function updateMetric(metric) {\r\n        send(\"UpdateMetric\", serializer_1.default(metric));\r\n    }\r\n    function init(repo) {\r\n        heartbeat(repo);\r\n        _connection.on(\"metrics\", \"MetricsSnapshotRequest\", function (instanceInfo) {\r\n            if (instanceInfo.Instance !== repo.instance) {\r\n                return;\r\n            }\r\n            sendFull(repo);\r\n        });\r\n        _connection.disconnected(function () { return clearInterval(heartbeatTimer); });\r\n        if (typeof window !== \"undefined\" && typeof window.htmlContainer === \"undefined\") {\r\n            heartbeatTimer = setInterval(function () {\r\n                heartbeat(repo);\r\n            }, heartbeatInterval);\r\n        }\r\n    }\r\n    var me = {\r\n        createSystem: createSystem,\r\n        updateSystem: updateSystem,\r\n        createMetric: createMetric,\r\n        updateMetric: updateMetric,\r\n        init: init,\r\n    };\r\n    return me;\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=gw1.js.map\n\n/***/ }),\n/* 86 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction metricToMessage(metric) {\r\n    var definition = getMetricDefinition(metric.name, metric.value, metric.path, metric.type, metric.description, metric.period, metric.resolution, metric.conflation);\r\n    function getMetricDefinition(name, value, path, type, description, period, resolution, conflation) {\r\n        var _definition = {\r\n            name: name,\r\n            description: description,\r\n            type: type ? type : getTypeFromValue(value),\r\n            path: path,\r\n            resolution: resolution,\r\n            period: period,\r\n            conflation: conflation,\r\n        };\r\n        if (_definition.type === metric_types_1.default.OBJECT) {\r\n            _definition.Composite = Object.keys(value).reduce(function (arr, key) {\r\n                var val = value[key];\r\n                arr.push(getMetricDefinition(key, val, path));\r\n                return arr;\r\n            }, []);\r\n        }\r\n        return _definition;\r\n    }\r\n    function serializeValue(value, _metric) {\r\n        if (value && value.constructor === Date) {\r\n            return {\r\n                value: {\r\n                    type: _valueTypes.indexOf(\"date\"),\r\n                    value: value.valueOf(),\r\n                    isArray: false,\r\n                },\r\n            };\r\n        }\r\n        if (typeof value === \"object\") {\r\n            return {\r\n                CompositeValue: Object.keys(value).reduce(function (arr, key) {\r\n                    var val = serializeValue(value[key]);\r\n                    val.InnerMetricName = key;\r\n                    arr.push(val);\r\n                    return arr;\r\n                }, []),\r\n            };\r\n        }\r\n        var valueType = _metric ? _metric.getValueType() : undefined;\r\n        valueType = valueType || _valueTypes.indexOf(typeof value);\r\n        return {\r\n            value: {\r\n                type: valueType,\r\n                value: value,\r\n                isArray: false,\r\n            },\r\n        };\r\n    }\r\n    function getTypeFromValue(value) {\r\n        var typeAsString = value.constructor === Date ? \"timestamp\" : typeof value;\r\n        switch (typeAsString) {\r\n            case \"string\":\r\n                return metric_types_1.default.STRING;\r\n            case \"number\":\r\n                return metric_types_1.default.NUMBER;\r\n            case \"timestamp\":\r\n                return metric_types_1.default.TIMESTAMP;\r\n            case \"object\":\r\n                return metric_types_1.default.OBJECT;\r\n        }\r\n        return 0;\r\n    }\r\n    var _valueTypes = [\r\n        \"boolean\",\r\n        \"int\",\r\n        \"number\",\r\n        \"long\",\r\n        \"string\",\r\n        \"date\",\r\n        \"object\",\r\n    ];\r\n    return {\r\n        id: metric.id,\r\n        instance: metric.repo.instance,\r\n        definition: definition,\r\n        value: serializeValue(metric.value, metric),\r\n    };\r\n}\r\nexports.default = metricToMessage;\r\n//# sourceMappingURL=serializer.js.map\n\n/***/ }),\n/* 87 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar serializer_1 = __webpack_require__(88);\r\nfunction default_1(connection, config) {\r\n    if (!connection || typeof connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var joinPromise;\r\n    var session;\r\n    var init = function (repo) {\r\n        var resolveReadyPromise;\r\n        joinPromise = new Promise(function (resolve) {\r\n            resolveReadyPromise = resolve;\r\n        });\r\n        session = connection.domain(\"metrics\", config.logger);\r\n        session.onJoined(function (reconnect) {\r\n            if (!reconnect) {\r\n                resolveReadyPromise();\r\n                resolveReadyPromise = undefined;\r\n            }\r\n            var rootStateMetric = {\r\n                name: \"/State\",\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var defineRootMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [rootStateMetric],\r\n            };\r\n            session.send(defineRootMetricsMsg);\r\n            if (reconnect) {\r\n                replayRepo(repo);\r\n            }\r\n        });\r\n        session.join(config.identity);\r\n    };\r\n    var replayRepo = function (repo) {\r\n        replaySystem(repo.root);\r\n    };\r\n    var replaySystem = function (system) {\r\n        createSystem(system);\r\n        system.metrics.forEach(function (m) {\r\n            createMetric(m);\r\n        });\r\n        system.subSystems.forEach(function (ss) {\r\n            replaySystem(ss);\r\n        });\r\n    };\r\n    var createSystem = function (system) {\r\n        if (system.parent === undefined) {\r\n            return;\r\n        }\r\n        joinPromise.then(function () {\r\n            var metric = {\r\n                name: serializer_1.normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                type: \"object\",\r\n                composite: {\r\n                    Description: {\r\n                        type: \"string\",\r\n                        description: \"\",\r\n                    },\r\n                    Value: {\r\n                        type: \"number\",\r\n                        description: \"\",\r\n                    },\r\n                },\r\n                description: \"System state\",\r\n                context: {},\r\n            };\r\n            var createMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [metric],\r\n            };\r\n            session.send(createMetricsMsg);\r\n        });\r\n    };\r\n    var updateSystem = function (system, state) {\r\n        joinPromise.then(function () {\r\n            var shadowedUpdateMetric = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: serializer_1.normalizeMetricName(system.path.join(\"/\") + \"/\" + system.name + \"/State\"),\r\n                        value: {\r\n                            Description: state.description,\r\n                            Value: state.state,\r\n                        },\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(shadowedUpdateMetric);\r\n            var stateObj = serializer_1.composeMsgForRootStateMetric(system);\r\n            var rootMetric = {\r\n                type: \"publish\",\r\n                peer_id: connection.peerId,\r\n                values: [{\r\n                        name: \"/State\",\r\n                        value: {\r\n                            Description: stateObj.description,\r\n                            Value: stateObj.value,\r\n                        },\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(rootMetric);\r\n        });\r\n    };\r\n    var createMetric = function (metric) {\r\n        joinPromise.then(function () {\r\n            var m = serializer_1.serializeMetric(metric);\r\n            var createMetricsMsg = {\r\n                type: \"define\",\r\n                metrics: [m],\r\n            };\r\n            session.send(createMetricsMsg);\r\n            if (typeof metric.value !== \"undefined\") {\r\n                updateMetric(metric);\r\n            }\r\n        });\r\n    };\r\n    var updateMetric = function (metric) {\r\n        joinPromise.then(function () {\r\n            var value = serializer_1.getMetricValueByType(metric);\r\n            var publishMetricsMsg = {\r\n                type: \"publish\",\r\n                values: [{\r\n                        name: serializer_1.normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name),\r\n                        value: value,\r\n                        timestamp: Date.now(),\r\n                    }],\r\n            };\r\n            session.send(publishMetricsMsg);\r\n        });\r\n    };\r\n    return {\r\n        init: init,\r\n        createSystem: createSystem,\r\n        updateSystem: updateSystem,\r\n        createMetric: createMetric,\r\n        updateMetric: updateMetric,\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=gw3.js.map\n\n/***/ }),\n/* 88 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction getMetricTypeByValue(metric) {\r\n    if ((metric.value && metric.value.constructor === Date) || metric.type === metric_types_1.default.TIMESPAN || metric.type === metric_types_1.default.TIMESTAMP) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (typeof metric.value === \"number\") {\r\n        return \"number\";\r\n    }\r\n    else if (typeof metric.value === \"string\" || metric.type === metric_types_1.default.STRING || metric.type === metric_types_1.default.RATE) {\r\n        return \"string\";\r\n    }\r\n    else if (typeof metric.value === \"object\") {\r\n        return \"object\";\r\n    }\r\n}\r\nfunction getTypeByValue(value) {\r\n    if (value.constructor === Date) {\r\n        return \"timestamp\";\r\n    }\r\n    else if (typeof value === \"number\") {\r\n        return \"number\";\r\n    }\r\n    else if (typeof value === \"string\") {\r\n        return \"string\";\r\n    }\r\n    else if (typeof value === \"object\") {\r\n        return \"object\";\r\n    }\r\n    else {\r\n        return \"string\";\r\n    }\r\n}\r\nfunction serializeMetric(metric) {\r\n    var serializedMetrics = {};\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"object\") {\r\n        var values = Object.keys(metric.value).reduce(function (memo, key) {\r\n            var innerType = getTypeByValue(metric.value[key]);\r\n            if (innerType === \"object\") {\r\n                var composite = defineNestedComposite(metric.value[key]);\r\n                memo[key] = {\r\n                    type: \"object\",\r\n                    description: \"\",\r\n                    context: {},\r\n                    composite: composite,\r\n                };\r\n            }\r\n            else {\r\n                memo[key] = {\r\n                    type: innerType,\r\n                    description: \"\",\r\n                    context: {},\r\n                };\r\n            }\r\n            return memo;\r\n        }, {});\r\n        serializedMetrics.composite = values;\r\n    }\r\n    serializedMetrics.name = normalizeMetricName(metric.path.join(\"/\") + \"/\" + metric.name);\r\n    serializedMetrics.type = type;\r\n    serializedMetrics.description = metric.description;\r\n    serializedMetrics.context = {};\r\n    return serializedMetrics;\r\n}\r\nexports.serializeMetric = serializeMetric;\r\nfunction defineNestedComposite(values) {\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var type = getTypeByValue(values[key]);\r\n        if (type === \"object\") {\r\n            memo[key] = {\r\n                type: \"object\",\r\n                description: \"\",\r\n                context: {},\r\n                composite: defineNestedComposite(values[key]),\r\n            };\r\n        }\r\n        else {\r\n            memo[key] = {\r\n                type: type,\r\n                description: \"\",\r\n                context: {},\r\n            };\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction normalizeMetricName(name) {\r\n    if (typeof name !== \"undefined\" && name.length > 0 && name[0] !== \"/\") {\r\n        return \"/\" + name;\r\n    }\r\n    else {\r\n        return name;\r\n    }\r\n}\r\nexports.normalizeMetricName = normalizeMetricName;\r\nfunction getMetricValueByType(metric) {\r\n    var type = getMetricTypeByValue(metric);\r\n    if (type === \"timestamp\") {\r\n        return Date.now();\r\n    }\r\n    else {\r\n        return publishNestedComposite(metric.value);\r\n    }\r\n}\r\nexports.getMetricValueByType = getMetricValueByType;\r\nfunction publishNestedComposite(values) {\r\n    if (typeof values !== \"object\") {\r\n        return values;\r\n    }\r\n    return Object.keys(values).reduce(function (memo, key) {\r\n        var value = values[key];\r\n        if (typeof value === \"object\" && value.constructor !== Date) {\r\n            memo[key] = publishNestedComposite(value);\r\n        }\r\n        else if (value.constructor === Date) {\r\n            memo[key] = new Date(value).getTime();\r\n        }\r\n        else if (value.constructor === Boolean) {\r\n            memo[key] = value.toString();\r\n        }\r\n        else {\r\n            memo[key] = value;\r\n        }\r\n        return memo;\r\n    }, {});\r\n}\r\nfunction flatten(arr) {\r\n    return arr.reduce(function (flat, toFlatten) {\r\n        return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);\r\n    }, []);\r\n}\r\nfunction getHighestState(arr) {\r\n    return arr.sort(function (a, b) {\r\n        return b.state - a.state;\r\n    })[0];\r\n}\r\nfunction aggregateDescription(arr) {\r\n    var msg = \"\";\r\n    arr.forEach(function (m, idx, a) {\r\n        var path = m.path.join(\".\");\r\n        if (idx === a.length - 1) {\r\n            msg += path + \".\" + m.name + \": \" + m.description;\r\n        }\r\n        else {\r\n            msg += path + \".\" + m.name + \": \" + m.description + \",\";\r\n        }\r\n    });\r\n    if (msg.length > 100) {\r\n        return msg.slice(0, 100) + \"...\";\r\n    }\r\n    else {\r\n        return msg;\r\n    }\r\n}\r\nfunction composeMsgForRootStateMetric(system) {\r\n    var aggregatedState = system.root.getAggregateState();\r\n    var merged = flatten(aggregatedState);\r\n    var highestState = getHighestState(merged);\r\n    var aggregateDesc = aggregateDescription(merged);\r\n    return {\r\n        description: aggregateDesc,\r\n        value: highestState.state,\r\n    };\r\n}\r\nexports.composeMsgForRootStateMetric = composeMsgForRootStateMetric;\r\n//# sourceMappingURL=serializer.js.map\n\n/***/ }),\n/* 89 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gw3_1 = __webpack_require__(87);\r\nvar gw1_1 = __webpack_require__(85);\r\nvar repository_1 = __webpack_require__(90);\r\nexports.default = (function (settings) {\r\n    var options = {\r\n        connection: settings.connection,\r\n        identity: settings.identity,\r\n        logger: settings.logger,\r\n        heartbeatInterval: settings.heartbeatInterval,\r\n        settings: {},\r\n        clickStream: settings.clickStream,\r\n    };\r\n    if (!options.connection || typeof options.connection !== \"object\") {\r\n        throw new Error(\"Connection is required parameter\");\r\n    }\r\n    var _protocol;\r\n    if (options.connection.protocolVersion === 3) {\r\n        _protocol = gw3_1.default(options.connection, settings);\r\n    }\r\n    else {\r\n        _protocol = gw1_1.default(options.connection, settings);\r\n    }\r\n    var repo = repository_1.default(options, _protocol);\r\n    var rootSystem = repo.root;\r\n    return rootSystem;\r\n});\r\n//# sourceMappingURL=main.js.map\n\n/***/ }),\n/* 90 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar system_1 = __webpack_require__(91);\r\nfunction repository(options, protocol) {\r\n    if (!options.identity) {\r\n        throw new Error(\"Identity missing from metrics configuration\");\r\n    }\r\n    if (!options.identity.service || typeof options.identity.service !== \"string\") {\r\n        throw new Error(\"Service missing or invalid in metrics identity configuration\");\r\n    }\r\n    if (!options.identity.system || typeof options.identity.system !== \"string\") {\r\n        throw new Error(\"System missing or invalid in metrics identity configuration\");\r\n    }\r\n    if (!options.identity.instance || typeof options.identity.instance !== \"string\") {\r\n        throw new Error(\"Instance missing or invalid in metrics identity configuration\");\r\n    }\r\n    var identity = options.identity;\r\n    var instance = options.identity.system + \"/\" + options.identity.service + \"/\" + options.identity.instance;\r\n    function _initSystemMetrics(rootSystem, useClickStream) {\r\n        if (typeof navigator !== \"undefined\") {\r\n            rootSystem.stringMetric(\"UserAgent\", navigator.userAgent);\r\n        }\r\n        if (useClickStream && typeof document !== \"undefined\") {\r\n            var clickStream_1 = rootSystem.subSystem(\"ClickStream\");\r\n            var documentClickHandler = function (e) {\r\n                if (!e.target) {\r\n                    return;\r\n                }\r\n                var target = e.target;\r\n                clickStream_1.objectMetric(\"LastBrowserEvent\", {\r\n                    type: \"click\",\r\n                    timestamp: new Date(),\r\n                    target: {\r\n                        className: e.target ? target.className : \"\",\r\n                        id: target.id,\r\n                        type: \"<\" + target.tagName.toLowerCase() + \">\",\r\n                        href: target.href || \"\",\r\n                    },\r\n                });\r\n            };\r\n            clickStream_1.objectMetric(\"Page\", {\r\n                title: document.title,\r\n                page: window.location.href,\r\n            });\r\n            if (document.addEventListener) {\r\n                document.addEventListener(\"click\", documentClickHandler);\r\n            }\r\n            else {\r\n                document.attachEvent(\"onclick\", documentClickHandler);\r\n            }\r\n        }\r\n        var startTime = rootSystem.stringMetric(\"StartTime\", (new Date()).toString());\r\n        var urlMetric = rootSystem.stringMetric(\"StartURL\", \"\");\r\n        var appNameMetric = rootSystem.stringMetric(\"AppName\", \"\");\r\n        if (typeof window !== \"undefined\") {\r\n            if (typeof window.location !== \"undefined\") {\r\n                var startUrl = window.location.href;\r\n                urlMetric.update(startUrl);\r\n            }\r\n            if (typeof window.glue42gd !== \"undefined\") {\r\n                appNameMetric.update(window.glue42gd.appName);\r\n            }\r\n        }\r\n    }\r\n    var me = {\r\n        identity: identity,\r\n        instance: instance,\r\n        get root() {\r\n            return _root;\r\n        },\r\n    };\r\n    protocol.init(me);\r\n    var _root = system_1.default(\"\", me, protocol);\r\n    _initSystemMetrics(_root, options.clickStream || options.clickStream === undefined);\r\n    return me;\r\n}\r\nexports.default = repository;\r\n//# sourceMappingURL=repository.js.map\n\n/***/ }),\n/* 91 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar address_1 = __webpack_require__(76);\r\nvar count_1 = __webpack_require__(77);\r\nvar number_1 = __webpack_require__(78);\r\nvar object_1 = __webpack_require__(79);\r\nvar rate_1 = __webpack_require__(80);\r\nvar statistics_1 = __webpack_require__(81);\r\nvar string_1 = __webpack_require__(82);\r\nvar timespan_1 = __webpack_require__(83);\r\nvar timestamp_1 = __webpack_require__(84);\r\nvar metric_types_1 = __webpack_require__(0);\r\nfunction system(name, repo, protocol, parent, description) {\r\n    if (!repo) {\r\n        throw new Error(\"Repository is required\");\r\n    }\r\n    if (!protocol) {\r\n        throw new Error(\"Transport is required\");\r\n    }\r\n    var _transport = protocol;\r\n    var _name = name;\r\n    var _description = description || \"\";\r\n    var _repo = repo;\r\n    var _parent = parent;\r\n    var _path = _buildPath(parent);\r\n    var _state = {};\r\n    var id = _arrayToString(_path, \"/\") + name;\r\n    var identity = repo.identity;\r\n    var root = repo.root;\r\n    var _subSystems = [];\r\n    var _metrics = [];\r\n    function subSystem(nameSystem, descriptionSystem) {\r\n        if (!nameSystem || nameSystem.length === 0) {\r\n            throw new Error(\"name is required\");\r\n        }\r\n        var match = _subSystems.filter(function (s) { return s.name === nameSystem; });\r\n        if (match.length > 0) {\r\n            return match[0];\r\n        }\r\n        var _system = system(nameSystem, _repo, _transport, me, descriptionSystem);\r\n        _subSystems.push(_system);\r\n        return _system;\r\n    }\r\n    function setState(state, stateDescription) {\r\n        _state = { state: state, description: stateDescription };\r\n        _transport.updateSystem(me, _state);\r\n    }\r\n    function stringMetric(definition, value) {\r\n        return _getOrCreateMetric.call(me, definition, metric_types_1.default.STRING, value, function (metricDef) { return string_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function numberMetric(definition, value) {\r\n        return _getOrCreateMetric.call(me, definition, metric_types_1.default.NUMBER, value, function (metricDef) { return number_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function countMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.COUNT, value, function (metricDef) { return count_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function addressMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.ADDRESS, value, function (metricDef) { return address_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function objectMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.OBJECT, value, function (metricDef) { return object_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function timespanMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.TIMESPAN, value, function (metricDef) { return timespan_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function timestampMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.TIMESTAMP, value, function (metricDef) { return timestamp_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function rateMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.RATE, value, function (metricDef) { return rate_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function statisticsMetric(definition, value) {\r\n        return _getOrCreateMetric.call(this, definition, metric_types_1.default.STATISTICS, value, function (metricDef) { return statistics_1.default(metricDef, me, _transport, value); });\r\n    }\r\n    function _unionToMetricDef(def) {\r\n        var metricDefinition = {};\r\n        if (typeof def === \"string\") {\r\n            metricDefinition.name = def;\r\n        }\r\n        else {\r\n            metricDefinition = def;\r\n        }\r\n        if (metricDefinition.name === undefined) {\r\n            throw new Error(\"Metric name is required\");\r\n        }\r\n        return metricDefinition;\r\n    }\r\n    function _getOrCreateMetric(definition, expectedType, value, createMetric) {\r\n        var metricDefinition = _unionToMetricDef(definition);\r\n        var matching = _metrics.filter(function (shadowedMetric) { return shadowedMetric.name === metricDefinition.name; });\r\n        if (matching.length > 0) {\r\n            var existing = matching[0];\r\n            if (existing.type !== expectedType) {\r\n                throw new Error(\"A metric named \" + metricDefinition.name + \" is already defined with different type.\");\r\n            }\r\n            if (typeof value !== \"undefined\") {\r\n                existing.update(value);\r\n            }\r\n            return existing;\r\n        }\r\n        var metric = createMetric(metricDefinition);\r\n        _metrics.push(metric);\r\n        return metric;\r\n    }\r\n    function _buildPath(shadowedSystem) {\r\n        if (!shadowedSystem || !shadowedSystem.parent) {\r\n            return [];\r\n        }\r\n        var path = _buildPath(shadowedSystem.parent);\r\n        path.push(shadowedSystem.name);\r\n        return path;\r\n    }\r\n    function _arrayToString(path, separator) {\r\n        return ((path && path.length > 0) ? path.join(separator) : \"\");\r\n    }\r\n    function getAggregateState() {\r\n        var aggState = [];\r\n        if (Object.keys(_state).length > 0) {\r\n            aggState.push({\r\n                name: _name,\r\n                path: _path,\r\n                state: _state.state,\r\n                description: _state.description,\r\n            });\r\n        }\r\n        _subSystems.forEach(function (shadowedSubSystem) {\r\n            var result = shadowedSubSystem.getAggregateState();\r\n            if (result.length > 0) {\r\n                aggState.push.apply(aggState, result);\r\n            }\r\n        });\r\n        return aggState;\r\n    }\r\n    var me = {\r\n        get name() {\r\n            return _name;\r\n        },\r\n        get description() {\r\n            return _description;\r\n        },\r\n        get repo() {\r\n            return _repo;\r\n        },\r\n        get parent() {\r\n            return _parent;\r\n        },\r\n        path: _path,\r\n        id: id,\r\n        identity: identity,\r\n        root: root,\r\n        get subSystems() {\r\n            return _subSystems;\r\n        },\r\n        get metrics() {\r\n            return _metrics;\r\n        },\r\n        subSystem: subSystem,\r\n        getState: function () {\r\n            return _state;\r\n        },\r\n        setState: setState,\r\n        stringMetric: stringMetric,\r\n        statisticsMetric: statisticsMetric,\r\n        rateMetric: rateMetric,\r\n        timestampMetric: timestampMetric,\r\n        timespanMetric: timespanMetric,\r\n        objectMetric: objectMetric,\r\n        addressMetric: addressMetric,\r\n        countMetric: countMetric,\r\n        numberMetric: numberMetric,\r\n        getAggregateState: getAggregateState,\r\n    };\r\n    _transport.createSystem(me);\r\n    return me;\r\n}\r\nexports.default = system;\r\n//# sourceMappingURL=system.js.map\n\n/***/ }),\n/* 92 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction default_1() {\r\n    function now() {\r\n        return new Date().getTime();\r\n    }\r\n    var startTime = now();\r\n    var endTime;\r\n    var period;\r\n    function stop() {\r\n        endTime = now();\r\n        period = now() - startTime;\r\n        return period;\r\n    }\r\n    return {\r\n        get startTime() {\r\n            return startTime;\r\n        },\r\n        get endTime() {\r\n            return endTime;\r\n        },\r\n        get period() {\r\n            return period;\r\n        },\r\n        stop: stop\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=timer.js.map\n\n/***/ })\n/******/ ]);\n});\n//# sourceMappingURL=tick42-glue-core.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/tick42-glue-core/dist/web/tick42-glue-core.js\n// module id = 36\n// module chunks = 0","var isFunction = function isFunction (arg) {return !!(arg && arg.constructor && arg.call && arg.apply);}\r\nvar nextTick = function nextTick (cb) { setTimeout(cb, 0); };\r\n\r\nmodule.exports = function (promise, successCallback, errorCallback) {\r\n    'use strict';\r\n    if (!isFunction(successCallback) && !isFunction(errorCallback)) {\r\n        return promise;\r\n    }\r\n\r\n    if (!isFunction(successCallback)) {\r\n        successCallback = function () {};\r\n    } else if (!isFunction(errorCallback)) {\r\n        errorCallback = function () {};        \r\n    }\r\n\r\n    promise.then(successCallback, errorCallback);\r\n}\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/tick42-promisify/main.js\n// module id = 37\n// module chunks = 0","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\r\n} catch(e) {\r\n\t// This works if the window reference is available\r\n\tif(typeof window === \"object\")\r\n\t\tg = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// (webpack)/buildin/global.js\n// module id = 38\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar promiseExtensions_1 = require(\"./../helpers/promiseExtensions\");\r\nvar activityManagementAPI_1 = require(\"./activityManagementAPI\");\r\nvar activityAGM_1 = require(\"../core/activityAGM\");\r\n/**\r\n * The entry points of activities API - accessible from glue.activities\r\n *\r\n * @module activities\r\n */\r\nvar ActivityAPI = /** @class */ (function () {\r\n    function ActivityAPI(manager, my) {\r\n        this._mgr = manager;\r\n        this._my = my;\r\n        this.all = new activityManagementAPI_1.ActivityManagementAPI(manager, my);\r\n    }\r\n    /**\r\n     * The entry point for your activity code.\r\n     *\r\n     * @function ready\r\n     * @returns {Promise<module:activities>} A promise for activity API\r\n     */\r\n    ActivityAPI.prototype.ready = function (callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._mgr.ready()\r\n                .then(function () {\r\n                resolve(_this);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    Object.defineProperty(ActivityAPI.prototype, \"my\", {\r\n        /**\r\n         * A lightweight, single activity oriented subset of the API which should be used by most activity applications\r\n         *\r\n         * @var {module:my} my\r\n         */\r\n        get: function () {\r\n            return this._my;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"aware\", {\r\n        /**\r\n         * True if the current window is activity aware - meaning that the window has been created as\r\n         * an activity participant - either a helper or an independent window.\r\n         * Check this after the API is ready.\r\n         *\r\n         * @var {bool} aware\r\n         */\r\n        get: function () {\r\n            return this._my.window !== undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"inActivity\", {\r\n        /**\r\n         * Returns true if the current window is activity aware and is currently participating in activity\r\n         *\r\n         * @var {bool} inActivity\r\n         */\r\n        get: function () {\r\n            return this.aware && this._my.activity !== undefined;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityAPI.prototype, \"agm\", {\r\n        /**\r\n         * Defines an Activity-specific version of the AGM API which:\r\n         * * restricts method registrations to activity-only windows\r\n         * * restricts method discovery and invocation to activity-only methods, unless you explicitly specify otherwise\r\n         * Other than that, the API is pretty much the same.\r\n         *\r\n         * @var  {module:activityAGM} agm\r\n         *\r\n         */\r\n        get: function () {\r\n            if (!this.aware) {\r\n                // no agm if not activity aware\r\n                return undefined;\r\n            }\r\n            if (!this.inActivity) {\r\n                // if we're not in activity no\r\n                return new activityAGM_1.ActivityAGM(null);\r\n            }\r\n            return this._my.activity.agm;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Returns a list of frame colors that can be used as activity frame colors\r\n     *\r\n     * @returns {string[]}\r\n     */\r\n    ActivityAPI.prototype.getAvailableFrameColors = function () {\r\n        var frameColors;\r\n        var hc = window.htmlContainer;\r\n        if (hc) {\r\n            frameColors = hc.getFrameColors();\r\n        }\r\n        frameColors = frameColors || [];\r\n        return frameColors;\r\n    };\r\n    return ActivityAPI;\r\n}());\r\nexports.ActivityAPI = ActivityAPI;\r\n//# sourceMappingURL=activityAPI.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/API/activityAPI.js\n// module id = 39\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar util = require(\"./../helpers/util\");\r\nvar ActivityManagementAPI = /** @class */ (function () {\r\n    function ActivityManagementAPI(manager, my) {\r\n        this._m = manager;\r\n        this._my = my;\r\n        this.activityTypes = {\r\n            get: this._getActivityTypesWrapper.bind(this),\r\n            register: this._m.registerActivityType.bind(this._m),\r\n            unregister: this._m.unregisterActivityType.bind(this._m),\r\n            subscribe: this._m.subscribeActivityTypeEvents.bind(this._m),\r\n            unsubscribe: undefined,\r\n            initiate: this._m.initiate.bind(this._m)\r\n        };\r\n        this.windowTypes = {\r\n            get: this._getWindowTypesWrapper.bind(this),\r\n            registerFactory: this._m.registerWindowFactory.bind(this._m),\r\n            unregisterFactory: this._m.unregisterWindowFactory.bind(this._m),\r\n            subscribe: this._m.subscribeWindowTypeEvents.bind(this._m),\r\n            unsubscribe: undefined\r\n        };\r\n        this.windows = {\r\n            get: this._m.getWindows.bind(this._m),\r\n            subscribe: this._m.subscribeWindowEvents.bind(this._m),\r\n            announce: this._m.announceWindow.bind(this._m),\r\n            unsubscribe: undefined,\r\n            create: this._m.createWindow.bind(this._m)\r\n        };\r\n        this.instances = {\r\n            get: this._m.getActivities.bind(this._m),\r\n            subscribe: this._m.subscribeActivityEvents.bind(this._m),\r\n            unsubscribe: undefined\r\n        };\r\n    }\r\n    ActivityManagementAPI.prototype.onAttached = function (callback) {\r\n        this._m.subscribeActivitiesAttached(callback);\r\n    };\r\n    ActivityManagementAPI.prototype.onDetached = function (callback) {\r\n        this._m.subscribeActivitiesDetached(callback);\r\n    };\r\n    ActivityManagementAPI.prototype.onActivityFrameColorChanged = function (callback) {\r\n        this._m.subscribeActivityFrameColorChanged(callback);\r\n    };\r\n    ActivityManagementAPI.prototype._getActivityTypesWrapper = function (name) {\r\n        if (util.isUndefined(name)) {\r\n            return this._m.getActivityTypes();\r\n        }\r\n        return this._m.getActivityType(name);\r\n    };\r\n    ActivityManagementAPI.prototype._getWindowTypesWrapper = function (name) {\r\n        if (util.isUndefined(name)) {\r\n            return this._m.getWindowTypes();\r\n        }\r\n        return this._m.getWindowType(name);\r\n    };\r\n    return ActivityManagementAPI;\r\n}());\r\nexports.ActivityManagementAPI = ActivityManagementAPI;\r\n//# sourceMappingURL=activityManagementAPI.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/API/activityManagementAPI.js\n// module id = 40\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar entityEvent_1 = require(\"./../contracts/entityEvent\");\r\nvar logger_1 = require(\"./../helpers/logger\");\r\nvar util = require(\"./../helpers/util\");\r\n/**\r\n * A lightweight, single activity oriented subset of the API which should be used by most activity applications.\r\n * Provides access to the activity of your application (my.activity) and shortcuts to the most commonly used methods\r\n * (e.g. my.createWindow is a shortcut for my.activity.createWindow)\r\n *\r\n * @module my\r\n */\r\nvar ActivityMy = /** @class */ (function () {\r\n    function ActivityMy(manager, windows) {\r\n        var _this = this;\r\n        this._myAttached = [];\r\n        this._myDetached = [];\r\n        this._myAttachedTo = [];\r\n        this._myDetachedFrom = [];\r\n        this._myActivityFrameColorChanged = [];\r\n        this._myActivityJoinedCallbacks = [];\r\n        this._myActivityRemovedCallbacks = [];\r\n        this._myContextUpdateCallbacks = [];\r\n        this._logger = logger_1.Logger.Get(this);\r\n        this._m = manager;\r\n        manager.ready()\r\n            .then(function (am) {\r\n            // Subscribe for events for driving \"my\" logic\r\n            am.subscribeActivityContextChanged(_this._subscribeMyContextChanged.bind(_this));\r\n            am.subscribeWindowEvents(_this._subscribeMyWindowEvent.bind(_this));\r\n            am.subscribeActivitiesAttached(_this._subscribeActivitiesAttached.bind(_this));\r\n            am.subscribeActivitiesDetached(_this._subscribeActivitiesDetached.bind(_this));\r\n            if (windows) {\r\n                windows.onWindowFrameColorChanged(_this._subscribeWindowFrameColorChanged.bind(_this));\r\n            }\r\n        });\r\n    }\r\n    Object.defineProperty(ActivityMy.prototype, \"window\", {\r\n        /**\r\n         * The current activity window; can be undefined (if the window is not part of any activity)\r\n         *\r\n         * @var {Window} window\r\n         */\r\n        get: function () {\r\n            if (util.isUndefinedOrNull(this._w)) {\r\n                var announcedWindows = this._m.announcedWindows;\r\n                if (announcedWindows.length > 0) {\r\n                    this._w = announcedWindows[0];\r\n                }\r\n            }\r\n            return this._w;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityMy.prototype, \"activity\", {\r\n        /**\r\n         * The current activity that the application participates in.\r\n         * Can be undefined (if currently not part of any activity)\r\n         *\r\n         * @var {module:activity} activity\r\n         */\r\n        get: function () {\r\n            var myWin = this.window;\r\n            if (util.isUndefinedOrNull(myWin)) {\r\n                return undefined;\r\n            }\r\n            return myWin.activity;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Creates a new window and joins it to the activity\r\n     *\r\n     * @function createWindow\r\n     * @param {string| windowDefinition} windowType The type of the window to be created\r\n     * @returns {Promise<module:activityWindow>}\r\n     */\r\n    ActivityMy.prototype.createWindow = function (windowType) {\r\n        return this._m.createWindow(this.activity, windowType);\r\n    };\r\n    /**\r\n     * Creates a stacked set of windows and joins them to the\r\n     *\r\n     * @function createStackedWindows\r\n     * @param {string[] | windowDefinition[]} windowTypes The types of the windows to be created\r\n     * @param {number} timeout\r\n     * @returns {Promise<module:activityWindow[]>}\r\n     */\r\n    ActivityMy.prototype.createStackedWindows = function (windowTypes, timeout) {\r\n        return this._m.createStackedWindows(this.activity, windowTypes, timeout);\r\n    };\r\n    Object.defineProperty(ActivityMy.prototype, \"context\", {\r\n        /**\r\n         * The current activity context. To update use my.updateContext, to replace my.setContext\r\n         *\r\n         * @var {object} context\r\n         */\r\n        get: function () {\r\n            var activity = this.activity;\r\n            if (util.isUndefined(activity)) {\r\n                return {};\r\n            }\r\n            return activity.context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Updates activity context using the properties from the context argument.\r\n     * If old context is {a:1, b:2, c:3} and invoking updateContext({b:3, c:null}) will result a context\r\n     * be {a:1, b:3}\r\n     *\r\n     * @function updateContext\r\n     * @param {object} context\r\n     * @return {Promise<object>}\r\n     */\r\n    ActivityMy.prototype.updateContext = function (context, callback) {\r\n        var activity = this.activity;\r\n        if (util.isUndefined(activity)) {\r\n            return new Promise(function (resolve, reject) {\r\n                reject(\"Not in activity\");\r\n            });\r\n        }\r\n        return activity.updateContext(context, callback);\r\n    };\r\n    /**\r\n     * Replaces the activity context with a new one.\r\n     *\r\n     * @function setContext\r\n     * @param {object} context   The new context\r\n     * @returns {Promise<Object>}\r\n     */\r\n    ActivityMy.prototype.setContext = function (context, callback) {\r\n        var activity = this.activity;\r\n        if (util.isUndefined(activity)) {\r\n            return new Promise(function (resolve, reject) {\r\n                reject(\"Not in activity\");\r\n            });\r\n        }\r\n        return activity.setContext(context, callback);\r\n    };\r\n    ActivityMy.prototype.onActivityJoined = function (callback) {\r\n        this._myActivityJoinedCallbacks.push(callback);\r\n        // replay joined event\r\n        var myWin = this.window;\r\n        if (!util.isUndefinedOrNull(myWin) && !util.isUndefinedOrNull(myWin.activity)) {\r\n            callback(myWin.activity);\r\n        }\r\n    };\r\n    ActivityMy.prototype.onActivityLeft = function (callback) {\r\n        this._myActivityRemovedCallbacks.push(callback);\r\n    };\r\n    /**\r\n     * Subscribe for context updates\r\n     *\r\n     * @function onContextChanged\r\n     * @param {contextChangedHandler} callback Handler function that will receive context related events\r\n     */\r\n    ActivityMy.prototype.onContextChanged = function (callback) {\r\n        this._myContextUpdateCallbacks.push(callback);\r\n        // publish initial event\r\n        var myWin = this.window;\r\n        if (util.isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var activity = myWin.activity;\r\n        if (util.isUndefinedOrNull(activity)) {\r\n            return;\r\n        }\r\n        // NB: either the callback is added before the activity is recorded in the API, or\r\n        // the activity is recorded before the callback\r\n        // in the former case, when the activity is seen, the callback will be invoked in _notifyMyContextChanged\r\n        // in the latter, the callback will be invoked here\r\n        // in both cases, the callback will be invoked at least once as soon as an activity is recorded\r\n        // see \"long analysis for callback behavior in GW3: several cases\" for full explanation\r\n        callback(activity.context, activity.context, [], activity);\r\n    };\r\n    ActivityMy.prototype.clone = function (options, callback) {\r\n        var act = this.activity;\r\n        return this._m.clone(act, options, callback);\r\n    };\r\n    ActivityMy.prototype.attach = function (activity, tag) {\r\n        var activityId;\r\n        if (typeof activity === \"string\") {\r\n            activityId = activity;\r\n        }\r\n        else {\r\n            activityId = activity.id;\r\n        }\r\n        return this._m.attachActivities(activityId, this.activity.id, tag);\r\n    };\r\n    ActivityMy.prototype.onActivityAttached = function (callback) {\r\n        this._myAttached.push(callback);\r\n    };\r\n    ActivityMy.prototype.onActivityDetached = function (callback) {\r\n        this._myDetached.push(callback);\r\n    };\r\n    ActivityMy.prototype.onAttachedToActivity = function (callback) {\r\n        this._myAttachedTo.push(callback);\r\n    };\r\n    ActivityMy.prototype.onDetachedFromActivity = function (callback) {\r\n        this._myDetachedFrom.push(callback);\r\n    };\r\n    Object.defineProperty(ActivityMy.prototype, \"attached\", {\r\n        get: function () {\r\n            if (!this.activity) {\r\n                return [];\r\n            }\r\n            return this.activity.attached;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityMy.prototype.setFrameColor = function (color, callback) {\r\n        if (this.activity) {\r\n            return this.activity.setFrameColor(color, callback);\r\n        }\r\n        else {\r\n            return Promise.resolve(null);\r\n        }\r\n    };\r\n    ActivityMy.prototype.getFrameColor = function () {\r\n        if (this.activity) {\r\n            return this.activity.getFrameColor();\r\n        }\r\n        return \"\";\r\n    };\r\n    ActivityMy.prototype.onFrameColorChanged = function (callback) {\r\n        this._myActivityFrameColorChanged.push(callback);\r\n    };\r\n    ActivityMy.prototype._subscribeMyContextChanged = function (activity, context, delta, removed) {\r\n        var myWin = this.window;\r\n        if (util.isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (util.isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        // ignore events not related to my activity\r\n        if (activity.id !== myActivity.id) {\r\n            return;\r\n        }\r\n        this._notifyMyContextChanged(activity, context, delta, removed);\r\n    };\r\n    ActivityMy.prototype._subscribeMyWindowEvent = function (activity, window, event) {\r\n        if (util.isUndefinedOrNull(this.window)) {\r\n            return;\r\n        }\r\n        // ignore events not related to my window\r\n        if (this.window.id !== window.id) {\r\n            return;\r\n        }\r\n        if (event === entityEvent_1.EntityEventType.ActivityWindowJoinedActivity) {\r\n            this._notifyMyWindowEvent(activity, this._myActivityJoinedCallbacks);\r\n            // NB: tick42-contexts doesn't raise automatically an update event on join if the snapshot matches\r\n            // the currently recorded data\r\n            // revisited: however, it is pushing an update on subscribe() (which is performed by js-activity)\r\n            // long analysis for callback behavior in GW3: several cases\r\n            // 1 client calls onContextChanged before joined-activity arrives\r\n            // then callback is pushed but onContextChanged callback call is skipped\r\n            //    1-1 js-activity handles joined-activity first; it calls js-context subscribe\r\n            //    1-1-1 js-context has not seen the activity so far so it doesn't invoke an update\r\n            //    however, js-context then handles joined-activity and raises an update\r\n            //    1-1-2 js-context has seen the activity, so it raises an update\r\n            //    js-context then handles joined-activity and doesn't raise a second update unless the received snapshot is\r\n            //    different from the last seen context value (can this even happen?)\r\n            //    1-2 js-context handles joined-activity first\r\n            //    since js-activity is not subscribed, whether it raises an update or not, it's not propagated\r\n            //    js-activity then handles joined-activity, performs a subscribe and js-context raises an update\r\n            // 2 joined-activity arrives, whatever updates are raised by js-activity's subscribe() or js-context's\r\n            // message handler are not propagated since the callback is not pushed, client then calls onContextChanged,\r\n            // and the callback is called inside that\r\n            // also, the callback cannot be invoked first in 1 then 2 or first 2 then 1\r\n            // => in all cases, a callback is called exactly once as soon as (it's subscribed && the activity is joined)\r\n            // (in 1-1-2 it *might* be possible to be called twice, first with a slightly out of date context,\r\n            // then with the joined-activity snapshot, see \"different from the last seen context value\", but it's unlikely,\r\n            // and not a real issue anyway)\r\n            // in the HC case, however, case 1 doesn't work since js-context doesn't raise updates on subscribe() nor\r\n            // joining the activity (#deleteme TODO LATER MINOR: verify), so we need to raise it ourselves\r\n            // 2017-09-08: final revisit (@vnikolov)\r\n            // since SBGW_D-163 allows automatic subscription to contexts of pre-existing activities, 1-1-2 no longer works\r\n            // (we might have already seen the latest state before joined-activity so no update will be raised)\r\n            // for this reason I'm invoking notifyMyContextChanged unconditionally - so we might have multiple\r\n            // invocations; if this turns into a problem we might add a guard inside notifyMyContextChanged that\r\n            // checks we're not raising it twice with the same context value\r\n            //\r\n            // we might also get a duplicate raise if the sender of an update is also subscribed to the context\r\n            // if (this._m.usingHc) {\r\n            this._notifyMyContextChanged(activity, activity.context, null, null);\r\n            // }\r\n            // #deleteme TODO LATER MAJOR: what about the cases when we're not watching foreign activity contexts?\r\n        }\r\n        else if (event === entityEvent_1.EntityEventType.ActivityWindowLeftActivity) {\r\n            this._notifyMyWindowEvent(activity, this._myActivityRemovedCallbacks);\r\n            // #deleteme TODO LATER MINOR: should we send null update here?\r\n        }\r\n    };\r\n    ActivityMy.prototype._notifyMyWindowEvent = function (activity, callbackStore) {\r\n        var _this = this;\r\n        callbackStore.forEach(function (element) {\r\n            try {\r\n                element(activity, event);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyMyContextChanged = function (activity, context, delta, removed) {\r\n        var _this = this;\r\n        delta = delta || {};\r\n        removed = removed || [];\r\n        this._myContextUpdateCallbacks.forEach(function (element) {\r\n            try {\r\n                element(context, delta, removed, activity);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyAttached = function (state) {\r\n        var _this = this;\r\n        this._myAttached.forEach(function (cb) {\r\n            try {\r\n                cb(state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyDetached = function (state) {\r\n        var _this = this;\r\n        this._myDetached.forEach(function (cb) {\r\n            try {\r\n                cb(state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyAttachedTo = function (state) {\r\n        var _this = this;\r\n        this._myAttachedTo.forEach(function (cb) {\r\n            try {\r\n                cb(_this.activity, state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._notifyDetachedFrom = function (detached, existing, state) {\r\n        var _this = this;\r\n        this._myDetachedFrom.forEach(function (cb) {\r\n            try {\r\n                cb(detached, existing, state);\r\n            }\r\n            catch (e) {\r\n                _this._logger.warn(\"error in user callback \" + e);\r\n            }\r\n        });\r\n    };\r\n    ActivityMy.prototype._subscribeActivitiesAttached = function (newAct, state) {\r\n        var myWin = this.window;\r\n        if (util.isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (util.isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        // ignore events not related to my activity\r\n        if (newAct.id !== myActivity.id) {\r\n            return;\r\n        }\r\n        if (state.windowIds.indexOf(myWin.id) >= 0) {\r\n            this._notifyAttachedTo(state);\r\n            return;\r\n        }\r\n        this._notifyAttached(state);\r\n    };\r\n    ActivityMy.prototype._subscribeActivitiesDetached = function (newAct, oldAct, state) {\r\n        var myWin = this.window;\r\n        if (util.isUndefinedOrNull(myWin)) {\r\n            return;\r\n        }\r\n        var myActivity = myWin.activity;\r\n        if (util.isUndefinedOrNull(myActivity)) {\r\n            return;\r\n        }\r\n        // ignore events not related to my activity\r\n        if (oldAct.id === myActivity.id) {\r\n            this._notifyDetached(state);\r\n        }\r\n        if (newAct.id === myActivity.id) {\r\n            this._notifyDetachedFrom(newAct, oldAct, state);\r\n        }\r\n    };\r\n    ActivityMy.prototype._subscribeWindowFrameColorChanged = function (window) {\r\n        var act = this.activity;\r\n        if (!act) {\r\n            return;\r\n        }\r\n        if (!act.owner) {\r\n            return;\r\n        }\r\n        if (act.owner.underlyingWindow.id === window.id) {\r\n            this._myActivityFrameColorChanged.forEach(function (callback) {\r\n                callback(window.frameColor);\r\n            });\r\n        }\r\n    };\r\n    return ActivityMy;\r\n}());\r\nexports.default = ActivityMy;\r\n//# sourceMappingURL=activityMyAPI.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/API/activityMyAPI.js\n// module id = 41\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gw3Bridge_1 = require(\"./bridges/gw3Bridge\");\r\nvar hcBridge_1 = require(\"./bridges/hcBridge\");\r\nvar activityMyAPI_1 = require(\"./API/activityMyAPI\");\r\nvar activityManager_1 = require(\"./core/activityManager\");\r\nvar activityAPI_1 = require(\"./API/activityAPI\");\r\nvar activityAGM_1 = require(\"./core/activityAGM\");\r\nvar logger_1 = require(\"./helpers/logger\");\r\nvar util = require(\"./helpers/util\");\r\nvar promiseExtensions_1 = require(\"./helpers/promiseExtensions\");\r\n/**\r\n * Activity context update handler - used when we want to subscribe for context changes in a specific activity\r\n *\r\n * @callback contextChangedHandler\r\n * @param {Object} context The full context of the activity after the update\r\n * @param {Object} delta The delta (contains the added/removed keys at top level)\r\n * @param {string[]} removed  Array of keys that were removed from context\r\n * @param {module:activity} activity The activity instance that owns the context\r\n *\r\n */\r\n/**\r\n * @callback windowEventHandler Handler for ActivityWindow events - e.g window joined to activity, window removed from\r\n * activity\r\n * @param {module:activity} activity\r\n * @param {module:activityWindow} window\r\n * @param {string} event 'joined' or 'removed'\r\n */\r\n/**\r\n * @callback activityStatusChangeHandler Handler for activity status changed events\r\n * @param {module:activity} activity\r\n * @param {activityStatus} newStatus\r\n * @param {activityStatus} oldStatus\r\n *\r\n */\r\n/**\r\n * @typedef {Object} windowDefinition\r\n * @property {string} type\r\n * @property {string} name\r\n * @property {Object} arguments\r\n */\r\n/**\r\n * @typedef {Object} bounds\r\n * @param {number} top\r\n * @param {number} left\r\n * @param {number} width\r\n * @param {number} height\r\n *\r\n */\r\n/**\r\n * @typedef {Object} agmInstance\r\n * @param {string} application\r\n * @param {string} pid\r\n * @param {string} machine\r\n * @param {string} user\r\n * @param {string} environment\r\n * @param {string} region\r\n */\r\n// Factory function for activity API\r\nvar ActivityModule = /** @class */ (function () {\r\n    function ActivityModule(config) {\r\n        var _this = this;\r\n        if (!config) {\r\n            throw new Error(\"config can not be null\");\r\n        }\r\n        // set log level\r\n        if (!util.isUndefined(config.logLevel)) {\r\n            logger_1.Logger.Level = config.logLevel;\r\n        }\r\n        if (!util.isUndefinedOrNull(config.logger)) {\r\n            logger_1.Logger.GlueLogger = config.logger;\r\n        }\r\n        // choose the correct bridge\r\n        var bridge;\r\n        this._isUsingHCImplementation = config.gdMajorVersion === 2;\r\n        this._isUsingGW3Implementation = ActivityModule.checkIsUsingGW3Implementation(config.connection);\r\n        if (this._isUsingHCImplementation) {\r\n            bridge = new hcBridge_1.default(undefined, config.windows, config.appManagerGetter, config.mode, config.typesToTrack);\r\n        }\r\n        else if (this._isUsingGW3Implementation) {\r\n            bridge = new gw3Bridge_1.default(config.connection, config.logger, config.contexts, config);\r\n        }\r\n        else {\r\n            throw new Error(\"Unable to instantiate activity bridge implementation\");\r\n        }\r\n        if (!bridge) {\r\n            throw new Error(\"A bridge to native activity is needed to create activity lib.\");\r\n        }\r\n        activityAGM_1.ActivityAGM.AGM = config.agm;\r\n        var activityManager = new activityManager_1.default(bridge, !config.disableAutoAnnounce, config.windows);\r\n        var my = new activityMyAPI_1.default(activityManager, config.windows);\r\n        this._api = new activityAPI_1.ActivityAPI(activityManager, my);\r\n        this._readyPromise = activityManager.ready().then(function (_) { return _this; });\r\n    }\r\n    ActivityModule.checkIsUsingGW3Implementation = function (connection) {\r\n        return connection.protocolVersion === 3;\r\n    };\r\n    Object.defineProperty(ActivityModule.prototype, \"api\", {\r\n        get: function () {\r\n            return this._api;\r\n        },\r\n        set: function (value) {\r\n            this._api = value;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityModule.prototype, \"isUsingHCImplementation\", {\r\n        get: function () {\r\n            return this._isUsingHCImplementation;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityModule.prototype, \"isUsingGW3Implementation\", {\r\n        get: function () {\r\n            return this._isUsingGW3Implementation;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityModule.prototype.ready = function (callback) {\r\n        return promiseExtensions_1.nodeify(this._readyPromise, callback);\r\n    };\r\n    return ActivityModule;\r\n}());\r\nexports.ActivityModule = ActivityModule;\r\n//# sourceMappingURL=activityModule.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/activityModule.js\n// module id = 42\n// module chunks = 0","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityType_1 = require(\"../entities/activityType\");\r\nvar windowType_1 = require(\"../entities/windowType\");\r\nvar entityEvent_1 = require(\"../contracts/entityEvent\");\r\nvar activity_1 = require(\"../entities/activity\");\r\nvar activityWindow_1 = require(\"../entities/activityWindow\");\r\nvar activityStatus_1 = require(\"../contracts/activityStatus\");\r\nvar gwMessageSuccess = \"success\";\r\nvar gwMmessageError = \"error\";\r\nvar gwMessageAddActivityTypes = \"add-types\";\r\nvar gwMmessageActivityTypesAdded = \"types-added\";\r\nvar gwMessageRemoveActivityTypes = \"remove-types\";\r\nvar gwMessageActivityTypesRemoved = \"types-removed\";\r\nvar gwMessageActivityCreated = \"created\";\r\nvar gwMessageActivityDestroyed = \"destroyed\";\r\nvar gwMessageActivityInitiated = \"initiated\";\r\nvar gwMmessageJoinActivity = \"join-activity\";\r\nvar gwMessageJoinedActivity = \"joined\";\r\nvar gwMessageActivityJoined = \"activity-joined\";\r\nvar gwMessageLeaveActivity = \"leave-activity\";\r\nvar gwMessageActivityLeft = \"left\";\r\nvar gwNmessageMergeActivities = \"merge\";\r\nvar gwMessageSplitActivities = \"split\";\r\nvar gwMessageChildrenChanged = \"children-changed\";\r\nvar gwMessageAddPeerFactories = \"add-peer-factories\";\r\nvar gwMessagePeerFactoriesAdded = \"peer-factories-added\";\r\nvar gwMessageRemovePeerFactories = \"remove-peer-factories\";\r\nvar gwMessagePeerFactoriesRemoved = \"peer-factories-removed\";\r\nvar gwMessageCreateActivity = \"create\";\r\nvar gwMessageCreatePeer = \"create-peer\";\r\nvar gwMessagePeerRequested = \"peer-requested\";\r\nvar gwMessageReady = \"ready\";\r\nvar gwMessagePeerCreated = \"peer-created\";\r\nvar gwMessageDestroyActivity = \"destroy\";\r\nvar gwMessageDisposePeer = \"dispose-peer\";\r\nvar GW3Bridge = /** @class */ (function () {\r\n    function GW3Bridge(connection, logger, contexts, config) {\r\n        var _this = this;\r\n        // callbacks\r\n        this._activityChangeCallbacks = [];\r\n        this._activityTypeStatusChangeCallbacks = [];\r\n        this._activityWindowChangeCallbacks = [];\r\n        this._windowTypeStatusChangeCallbacks = [];\r\n        // state tracking\r\n        this._peerIdAndFactoryIdToPeerType = {};\r\n        this._peerFactoriesRegisteredByUs = {};\r\n        this._gw3Subscriptions = [];\r\n        this._contextSubscriptions = {};\r\n        this._activityTypesInitiatedFromMe = {};\r\n        this._config = config;\r\n        this._connection = connection;\r\n        this._logger = logger;\r\n        this._contexts = contexts;\r\n        this._sessionJoinedPromise = new Promise(function (resolve /*, reject */) {\r\n            _this._sessionJoinedPromiseResolve = resolve;\r\n        });\r\n        this._activityJoinedPromise = new Promise(function (resolve /*, reject */) {\r\n            _this._activityJoinedPromiseResolve = resolve;\r\n        });\r\n        if (!this._config.activityId) {\r\n            this._activityJoinedPromiseResolve({});\r\n        }\r\n        this._gw3Session = connection.domain(\"activity\", logger.subLogger(\"session:com.tick42.activity\"), [\"joined\", \"initiated\", \"peer-created\"]);\r\n    }\r\n    GW3Bridge.activityTypeGwMessageEntityToActivityType = function (entity, description) {\r\n        var nameToWindowType = function (windowName) {\r\n            return new windowType_1.default(windowName, undefined);\r\n        };\r\n        return new activityType_1.default(entity.name, entity.owner_type && nameToWindowType(entity.owner_type), entity.helper_types && entity.helper_types.map(nameToWindowType), description);\r\n    };\r\n    GW3Bridge.peerFactoryGwMessageEntityToWindowType = function (entity) {\r\n        return new windowType_1.default(entity.peer_type, \r\n        /* #deleteme TODO: review - appmanager configuration? */ function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.activityGwMessageToActivity = function (msg, status) {\r\n        var ownerId = msg.owner !== undefined ? msg.owner.peer_id : undefined;\r\n        return new activity_1.default(msg.activity_id, msg.activity_type, status, msg.context_snapshot, ownerId);\r\n    };\r\n    GW3Bridge.activityToActivityStatusChangeEvent = function (act) {\r\n        return new entityEvent_1.EntityEvent(act, new entityEvent_1.ActivityStatusChangeEventContext(act.status, undefined));\r\n    };\r\n    Object.defineProperty(GW3Bridge.prototype, \"bridgeType\", {\r\n        get: function () {\r\n            return \"GW3\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GW3Bridge.prototype.init = function () {\r\n        var _this = this;\r\n        // activity types\r\n        this.forwardActivityTypeMessagesToStatusEventHandlers();\r\n        // activities\r\n        this.subscribe(gwMessageActivityCreated, this.handleActivityCreatedMessage);\r\n        this.subscribe(gwMessageActivityDestroyed, this.handleActivityDestroyedMessage);\r\n        this.forwardActivityMessagesToStatusEventHandlers();\r\n        this.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers();\r\n        // window types / peer factories\r\n        // NB: this forward must happen before the handlePeerFactoriesRemoved subscription\r\n        // since the latter clears state which is used by peerFactoryIdAndOwnerIdToWindowType\r\n        this.forwardPeerFactoryMessagesToStatusEventHandlers();\r\n        this.forwardPeerFactoryMessagesToPeerFactoryRequests();\r\n        this.subscribe(gwMessagePeerFactoriesAdded, this.handlePeerFactoriesAdded);\r\n        this.subscribe(gwMessagePeerFactoriesRemoved, this.handlePeerFactoriesRemoved);\r\n        // activity windows\r\n        this.forwardActivityWindowMessagesToEventHandlers();\r\n        //\r\n        this.subscribe(gwMessageDisposePeer, \r\n        /*(msg)*/ function () {\r\n            if (_this._config.disposeRequestHandling === \"dispose\") {\r\n                _this.dispose();\r\n                return;\r\n            }\r\n            // #deleteme TODO: review - maybe leave activity before dying?\r\n            if (_this._config.disposeRequestHandling === \"exit\") {\r\n                if (typeof window !== \"undefined\" &&\r\n                    typeof window.close === \"function\") {\r\n                    window.close();\r\n                    return;\r\n                }\r\n                if (typeof process !== \"undefined\" &&\r\n                    typeof process.exit === \"function\") {\r\n                    process.exit();\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n        // #deleteme TODO: logging\r\n        // start domain join handshake\r\n        this._gw3Session.onJoined(function () {\r\n            if (_this._config.mode === \"trackMyOnly\" ||\r\n                _this._config.mode === \"trackMyTypeAndInitiatedFromMe\") {\r\n                _this._sessionJoinedPromiseResolve(_this);\r\n            }\r\n            else {\r\n                _this._gw3Session\r\n                    .send({\r\n                    type: \"subscribe\",\r\n                    activity_types: (_this._config.mode === \"trackAll\" ? [] :\r\n                        _this._config.mode === \"trackTypes\" ? _this._config.typesToTrack : [])\r\n                })\r\n                    .then(function () {\r\n                    _this._sessionJoinedPromiseResolve(_this);\r\n                });\r\n            }\r\n        });\r\n        this._gw3Session.join();\r\n    };\r\n    GW3Bridge.prototype.dispose = function () {\r\n        var _this = this;\r\n        this._gw3Subscriptions.forEach(function (sub) { return sub && _this._connection.off(sub); });\r\n        this._gw3Subscriptions.length = 0;\r\n        // #deleteme todo review\r\n        // this._contexts.dispose();\r\n    };\r\n    // ActivityBridge interface\r\n    GW3Bridge.prototype.ready = function () {\r\n        return Promise.all([this._sessionJoinedPromise, this._activityJoinedPromise]);\r\n    };\r\n    GW3Bridge.prototype.initReady = function () {\r\n        return this._sessionJoinedPromise;\r\n    };\r\n    GW3Bridge.prototype.onActivityTypeStatusChange = function (callback) {\r\n        this._activityTypeStatusChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.registerActivityType = function (activityTypeName, ownerWindow, helperWindows, config, description) {\r\n        var _this = this;\r\n        var entity = {};\r\n        entity.name = activityTypeName;\r\n        var toActivityPeerConfig = function (windowDefinition) { return ({ type: windowDefinition.type, name: windowDefinition.name, configuration: windowDefinition }); };\r\n        entity.owner_type = toActivityPeerConfig(ownerWindow);\r\n        entity.helper_types = helperWindows.map(toActivityPeerConfig);\r\n        return this._gw3Session\r\n            .send({\r\n            type: gwMessageAddActivityTypes,\r\n            types: [entity]\r\n        })\r\n            .then(function () {\r\n            var activityType = GW3Bridge.activityTypeGwMessageEntityToActivityType(entity, description);\r\n            _this.invokeCallbacks(_this._activityTypeStatusChangeCallbacks, new entityEvent_1.EntityEvent(activityType, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added)), gwMessageAddActivityTypes);\r\n            return activityType;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.unregisterActivityType = function (activityTypeName) {\r\n        var _this = this;\r\n        return this._gw3Session\r\n            .send({\r\n            type: gwMessageRemoveActivityTypes,\r\n            types: [activityTypeName]\r\n        })\r\n            .then(function () {\r\n            var activityType = new activityType_1.default(activityTypeName, undefined, undefined, undefined);\r\n            _this.invokeCallbacks(_this._activityTypeStatusChangeCallbacks, new entityEvent_1.EntityEvent(activityType, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Removed)), gwMessageAddActivityTypes);\r\n        });\r\n    };\r\n    GW3Bridge.prototype.onWindowTypeStatusChange = function (callback) {\r\n        this._windowTypeStatusChangeCallbacks.push(callback);\r\n    };\r\n    // NB: in GW3, peer factories have ids separate from the ids of the peers they create\r\n    // in this implementation we keep the two equal for simplicity\r\n    // NB: we assume only one peer will register a peer factory for a given type; otherwise the\r\n    // add/remove window types event logic will get messy\r\n    GW3Bridge.prototype.registerWindowFactory = function (windowType, factory, parameters) {\r\n        var _this = this;\r\n        if (this._peerFactoriesRegisteredByUs[windowType]) {\r\n            return Promise.reject(new Error(\"Factory for windowType \" + windowType + \" already registered.\"));\r\n        }\r\n        this._peerFactoriesRegisteredByUs[windowType] = factory;\r\n        // #deleteme TODO: review success/failure code paths\r\n        // #deleteme TODO: review - should we create the window type here?\r\n        var entity = {\r\n            id: windowType,\r\n            peer_type: windowType,\r\n            configuration: parameters\r\n        };\r\n        return this._gw3Session.send({\r\n            type: gwMessageAddPeerFactories,\r\n            factories: [entity]\r\n        })\r\n            .then(function () {\r\n            _this.invokeCallbacks(_this._windowTypeStatusChangeCallbacks, new entityEvent_1.EntityEvent(GW3Bridge.peerFactoryGwMessageEntityToWindowType(entity), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added)), gwMessageAddPeerFactories);\r\n        })\r\n            .catch(function () {\r\n            delete _this._peerFactoriesRegisteredByUs[windowType];\r\n        });\r\n    };\r\n    GW3Bridge.prototype.unregisterWindowFactory = function (windowType) {\r\n        var _this = this;\r\n        var factory = this._peerFactoriesRegisteredByUs[windowType];\r\n        if (!factory) {\r\n            return Promise.reject(new Error(\"Factory for windowType \" + windowType + \" not registered.\"));\r\n        }\r\n        delete this._peerFactoriesRegisteredByUs[windowType];\r\n        return this._gw3Session.send({\r\n            type: gwMessageRemovePeerFactories,\r\n            factory_ids: [windowType]\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._windowTypeStatusChangeCallbacks, new entityEvent_1.EntityEvent(new windowType_1.default(windowType, undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Removed)), gwMessageAddPeerFactories);\r\n        });\r\n    };\r\n    GW3Bridge.prototype.onActivityStatusChange = function (callback) {\r\n        this._activityChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.initiateActivity = function (activityType, context, configuration) {\r\n        var _this = this;\r\n        var initiateMsg = {\r\n            type: gwMessageCreateActivity,\r\n            activity_type: activityType,\r\n            initial_context: context,\r\n        };\r\n        if (this.isOverrideTypeDefinition(configuration)) {\r\n            initiateMsg.types_override = {\r\n                owner_type: { type: configuration.owner.type, name: configuration.owner.name, configuration: configuration.owner },\r\n                helper_types: configuration.helpers && configuration.helpers.map(function (wd) { return ({ type: wd.type, name: wd.name, configuration: wd }); })\r\n            };\r\n        }\r\n        else {\r\n            initiateMsg.configuration = configuration && configuration.map(function (wd) { return ({ type: wd.type, name: wd.name, configuration: wd }); });\r\n        }\r\n        return this.sendCreateAndMapResultingMessagesToPromise(initiateMsg, gwMessageActivityInitiated, function (msg, requestId) { return msg.request_id === requestId; }, gwMessageActivityCreated, function (msg, requestId, initMsg) { return msg.activity_id === initMsg.activity_id; }, gwMessageActivityDestroyed, function (msg, requestId, initMsg) { return msg.activity_id === initMsg.activity_id; }, function (msg) { return msg.activity_id; }).then(function (id) {\r\n            if (_this._config.mode === \"trackMyTypeAndInitiatedFromMe\") {\r\n                if (!_this._activityTypesInitiatedFromMe[activityType]) {\r\n                    _this._activityTypesInitiatedFromMe[activityType] = true;\r\n                    return _this._gw3Session\r\n                        .send({\r\n                        type: \"subscribe\",\r\n                        activity_types: [activityType]\r\n                    })\r\n                        .then(function () {\r\n                        return id;\r\n                    });\r\n                }\r\n            }\r\n            return id;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.stopActivity = function (activity) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageDestroyActivity,\r\n            activity_id: activity.id,\r\n            // #deleteme TODO: review - reason?\r\n            reason_uri: \"com.tick42.glue.activity.constants.destroyReason.general\",\r\n            reason: \"Destroying activity\"\r\n        }).then(function (_) { return true; });\r\n    };\r\n    GW3Bridge.prototype.updateActivityContext = function (activity, context, fullReplace, removedKeys) {\r\n        if (fullReplace) {\r\n            // this will currently fail on GW3\r\n            return this._contexts.set(activity.id, context);\r\n        }\r\n        else {\r\n            removedKeys = removedKeys || [];\r\n            for (var _i = 0, removedKeys_1 = removedKeys; _i < removedKeys_1.length; _i++) {\r\n                var x = removedKeys_1[_i];\r\n                context[x] = null;\r\n            }\r\n            return this._contexts.update(activity.id, context);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.announceWindow = function (windowType, activityWindowId) {\r\n        // in the GW3 case we are only joined to an activity after we announce ourselves\r\n        // so all announcement calls should go in 'registerWindow', not here\r\n        // (registerWindow registers a window that's not part of an activity, at least yet)\r\n        throw new Error(\"Invalid operation 'announceWindow' for GW3 protocol\");\r\n    };\r\n    GW3Bridge.prototype.registerWindow = function (type, name, independent) {\r\n        var shouldSendReady = this._connection.gatewayToken;\r\n        var peerId = this._connection.peerId;\r\n        // if running in GD3 (glue42gd is there) we should send ready only if we have the activityInfo object in glue\r\n        if (typeof window !== \"undefined\") {\r\n            var glue42gd = window.glue42gd;\r\n            if (glue42gd) {\r\n                shouldSendReady = glue42gd.activityInfo !== undefined;\r\n            }\r\n        }\r\n        if (shouldSendReady) {\r\n            this._gw3Session.send({\r\n                type: gwMessageReady,\r\n            });\r\n        }\r\n        this.invokeCallbacks(this._activityWindowChangeCallbacks, new entityEvent_1.EntityEvent(new activityWindow_1.default(peerId, name, type, undefined, undefined, independent, this.generateWindowGetter(peerId), undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added)), \"register window\");\r\n        return Promise.resolve(peerId);\r\n    };\r\n    GW3Bridge.prototype.onActivityWindowChange = function (callback) {\r\n        this._activityWindowChangeCallbacks.push(callback);\r\n    };\r\n    GW3Bridge.prototype.createWindow = function (activityId, windowDefinition) {\r\n        var _this = this;\r\n        // if the user hasn't provided a layout option but has some of left,top,width,height\r\n        // insert a layout\r\n        if (!windowDefinition.layout) {\r\n            if (windowDefinition.left || windowDefinition.width || windowDefinition.height || windowDefinition.top) {\r\n                windowDefinition.layout = {\r\n                    mode: \"pixels\",\r\n                    cellSize: 1,\r\n                };\r\n            }\r\n        }\r\n        return this.sendCreateAndMapResultingMessagesToPromise({\r\n            type: gwMessageCreatePeer,\r\n            peer_type: windowDefinition.type,\r\n            configuration: windowDefinition,\r\n            activity_id: activityId,\r\n        }, undefined, undefined, gwMessagePeerCreated, function (msg, requestId) { return msg.request_id === requestId; }, undefined, undefined, function (msg) { return msg.created_id; })\r\n            .then(function (id) {\r\n            return _this.joinActivity(activityId, id)\r\n                .then(function () {\r\n                return id;\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.closeWindow = function (id) {\r\n        return this._gw3Session.send({\r\n            destroy_peer_id: id\r\n        }).then(function (_) { return undefined; });\r\n    };\r\n    GW3Bridge.prototype.getAnnouncementInfo = function () {\r\n        var activityId = this._config.activityId || (this._config.announcementInfo && this._config.announcementInfo.activityId);\r\n        var activityWindowType = (this._config.announcementInfo && this._config.announcementInfo.activityWindowType);\r\n        var activityWindowIndependent = (this._config.announcementInfo && this._config.announcementInfo.activityWindowIndependent);\r\n        var activityWindowName = (this._config.announcementInfo && this._config.announcementInfo.activityWindowName);\r\n        if (typeof window !== \"undefined\" &&\r\n            typeof window.location !== \"undefined\" &&\r\n            window.location.search &&\r\n            typeof URLSearchParams === \"function\") {\r\n            var searchParams = new URLSearchParams(location.search.slice(1));\r\n            activityWindowType = activityWindowType || searchParams.get(\"t42PeerType\");\r\n            activityWindowType = activityWindowType || searchParams.get(\"t42ActivityWindowType\");\r\n            if (typeof activityWindowIndependent === \"undefined\") {\r\n                activityWindowIndependent = searchParams.get(\"t42ActivityWindowIndependent\");\r\n            }\r\n            activityWindowName = activityWindowName || searchParams.get(\"t42ActivityWindowName\");\r\n            activityId = activityId || searchParams.get(\"t42ActivityId\");\r\n        }\r\n        activityWindowType = activityWindowType || \"unknown\";\r\n        activityWindowIndependent = activityWindowIndependent || false;\r\n        activityWindowName = activityWindowName || this._connection.peerId;\r\n        return {\r\n            activityWindowId: undefined,\r\n            activityId: activityId,\r\n            activityWindowType: activityWindowType,\r\n            activityWindowIndependent: activityWindowIndependent,\r\n            activityWindowName: activityWindowName,\r\n        };\r\n    };\r\n    GW3Bridge.prototype.joinActivity = function (activityId, windowId) {\r\n        var _this = this;\r\n        return this._gw3Session.send({\r\n            type: gwMmessageJoinActivity,\r\n            target_id: windowId,\r\n            activity_id: activityId\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new entityEvent_1.EntityEvent(new activityWindow_1.default(windowId, undefined, undefined, activityId, undefined, undefined, _this.generateWindowGetter(windowId), undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowJoinedActivity)), \"activity joined - ActivityWindow\");\r\n            _this.invokeCallbacks(_this._activityChangeCallbacks, new entityEvent_1.EntityEvent(new activity_1.default(activityId, undefined, new activityStatus_1.ActivityStatus(\"created\", undefined, undefined), undefined, undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Updated)), \"activity joined - Activity\");\r\n        });\r\n    };\r\n    GW3Bridge.prototype.leaveActivity = function (activityId, windowId) {\r\n        var _this = this;\r\n        return this._gw3Session.send({\r\n            type: gwMessageLeaveActivity,\r\n            target_id: windowId,\r\n            activity_id: activityId\r\n        }).then(function () {\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new entityEvent_1.EntityEvent(new activityWindow_1.default(windowId, undefined, undefined, null, undefined, undefined, _this.generateWindowGetter(windowId), undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowLeftActivity)), \"activity left - ActivityWindow\");\r\n            _this.invokeCallbacks(_this._activityChangeCallbacks, new entityEvent_1.EntityEvent(new activity_1.default(activityId, undefined, new activityStatus_1.ActivityStatus(\"created\", undefined, undefined), undefined, undefined), new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Updated)), \"activity left - Activity\");\r\n        });\r\n    };\r\n    // purposefully returning empty arrays\r\n    GW3Bridge.prototype.getActivityTypes = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getWindowTypes = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getActivities = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    GW3Bridge.prototype.getActivityWindows = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    // N/A\r\n    // #deleteme TODO: ignore for now\r\n    // POSTPONED\r\n    GW3Bridge.prototype.createStackedWindows = function (id, windowDefinitions, timeout) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.getWindowBounds = function (id) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.setWindowBounds = function (id, bounds) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.activateWindow = function (id, focus) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.setWindowVisibility = function (id, visible) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.cloneActivity = function (id, cloneOptions) {\r\n        return undefined;\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.attachActivities = function (from, to, tag) {\r\n        return this._gw3Session.send({\r\n            type: gwNmessageMergeActivities,\r\n            into: to,\r\n            merge: from\r\n        });\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.detachActivities = function (activityId, newActivityInfo) {\r\n        return this._gw3Session.send({\r\n            type: gwMessageSplitActivities,\r\n            from: activityId,\r\n        }).then(function () { return \"\"; });\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.onActivitiesAttached = function (callback) {\r\n        // POSTPONED\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.onActivitiesDetached = function (callback) {\r\n        // POSTPONED\r\n    };\r\n    GW3Bridge.prototype.onActivityAttachedDescriptorsRefreshed = function (callback) {\r\n        // POSTPONED\r\n    };\r\n    // POSTPONED\r\n    GW3Bridge.prototype.getAttachedDescriptors = function () {\r\n        return Promise.resolve([]);\r\n    };\r\n    // helpers\r\n    // Protocol handling\r\n    GW3Bridge.prototype.getRandomRequestId = function () {\r\n        return this._connection.peerId + \":\" + Math.floor(Math.random() * 1e9) + \"\";\r\n    };\r\n    GW3Bridge.prototype.forwardAddedAndRemovedMessagesToEventHandler = function (addedMessageType, removedMessageType, mapper, handlers) {\r\n        var getGetEntityEvent = function (isAdded) { return function (entity) { return new entityEvent_1.EntityEvent(entity, new entityEvent_1.EntityEventContext(isAdded ?\r\n            entityEvent_1.EntityEventType.Added :\r\n            entityEvent_1.EntityEventType.Removed)); }; };\r\n        var sub1;\r\n        var sub2;\r\n        sub1 = addedMessageType && this.forwardMessageToEventHandler(addedMessageType, function (msg) { return mapper(msg, true); }, getGetEntityEvent(true), handlers);\r\n        sub2 = removedMessageType && this.forwardMessageToEventHandler(removedMessageType, function (msg) { return mapper(msg, false); }, getGetEntityEvent(false), handlers);\r\n        return [sub1, sub2].filter(function (x) { return x; });\r\n    };\r\n    GW3Bridge.prototype.forwardMessageToEventHandler = function (messageType, mapper, getEntityEvent, handler) {\r\n        return this.subscribe(messageType, function (msg) {\r\n            mapper(msg)\r\n                .forEach(function (ent) {\r\n                return handler.forEach(function (h) { return h(getEntityEvent(ent, msg)); });\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.sendCreateAndMapResultingMessagesToPromise = function (msg, initiatedMessageType, initiatedMessageFilter, createdMessageType, createdMessageFilter, cancelledMessageType, cancelledMessageFilter, createdMessageToPromiseResolution) {\r\n        var _this = this;\r\n        var reqId = this.getRandomRequestId();\r\n        var resolveCreatedPromise;\r\n        var rejectCreatedPromise;\r\n        var createdPromise = new Promise(function (resolve, reject) {\r\n            resolveCreatedPromise = resolve;\r\n            rejectCreatedPromise = reject;\r\n        });\r\n        var initiatedMessageAck = null;\r\n        var initiatedSubscription;\r\n        var createdSubscription;\r\n        var cancelledSubscription;\r\n        var errorSubscription;\r\n        var dropSubscriptions = function () {\r\n            _this.dropSubscription(initiatedSubscription);\r\n            _this.dropSubscription(createdSubscription);\r\n            _this.dropSubscription(cancelledSubscription);\r\n            _this.dropSubscription(errorSubscription);\r\n        };\r\n        initiatedSubscription = initiatedMessageType &&\r\n            this.subscribe(initiatedMessageType, function (msg4) {\r\n                if (!initiatedMessageFilter(msg4, reqId)) {\r\n                    return;\r\n                }\r\n                initiatedMessageAck = msg4;\r\n                _this.dropSubscription(initiatedSubscription);\r\n            });\r\n        createdSubscription =\r\n            this.subscribe(createdMessageType, function (msg1) {\r\n                if (!createdMessageFilter(msg1, reqId, initiatedMessageAck)) {\r\n                    return;\r\n                }\r\n                resolveCreatedPromise(createdMessageToPromiseResolution(msg1));\r\n            });\r\n        cancelledSubscription = cancelledMessageType &&\r\n            this.subscribe(cancelledMessageType, function (msg2) {\r\n                if (!cancelledMessageFilter(msg2, reqId, initiatedMessageAck)) {\r\n                    return;\r\n                }\r\n                rejectCreatedPromise(msg2);\r\n            });\r\n        errorSubscription = cancelledMessageType &&\r\n            this.subscribe(gwMmessageError, function (msg3) {\r\n                if (msg3.request_id !== reqId) {\r\n                    return;\r\n                }\r\n                rejectCreatedPromise(msg3);\r\n            });\r\n        msg.request_id = reqId;\r\n        var toReturn = this._gw3Session\r\n            .send(msg)\r\n            .then(function () {\r\n            return createdPromise;\r\n        });\r\n        toReturn.then(dropSubscriptions, dropSubscriptions);\r\n        return toReturn;\r\n    };\r\n    // Entity Mapping\r\n    GW3Bridge.prototype.peerFactoryIdAndOwnerIdToWindowType = function (factoryId, ownerId) {\r\n        var peerType = this._peerIdAndFactoryIdToPeerType[ownerId + \":\" + factoryId];\r\n        if (!peerType) {\r\n            return null;\r\n        }\r\n        else {\r\n            return new windowType_1.default(peerType, undefined);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribe = function (messageType, handler) {\r\n        var _this = this;\r\n        var sub = this._connection.on(\r\n        // #deleteme TODO: review first arg\r\n        \"js-activity\", messageType, function (msg) { return handler.bind(_this)(msg); });\r\n        this._gw3Subscriptions.push(sub);\r\n        return sub;\r\n    };\r\n    GW3Bridge.prototype.dropSubscription = function (subscription) {\r\n        if (subscription) {\r\n            this._connection.off(subscription);\r\n            delete this._gw3Subscriptions[this._gw3Subscriptions.indexOf(subscription)];\r\n        }\r\n    };\r\n    GW3Bridge.prototype.invokeCallbacks = function (callbacks, event, description) {\r\n        var _this = this;\r\n        callbacks.forEach(function (cb) {\r\n            try {\r\n                cb(event);\r\n            }\r\n            catch (err) {\r\n                _this._logger.error(\"Error in \" + (description || event.context.type) + \" callback: \" + JSON.stringify(err));\r\n            }\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handleActivityCreatedMessage = function (msg) {\r\n        if (!msg.context_id) {\r\n            this._logger.error(\"Activity created with unknown context_id: \" + msg.activity_id);\r\n        }\r\n        else {\r\n            if (!this._contextSubscriptions[msg.activity_id]) {\r\n                this.subscribeToContext(msg);\r\n            }\r\n        }\r\n    };\r\n    GW3Bridge.prototype.subscribeToContext = function (msg) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var activityId, _a, _b;\r\n            var _this = this;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        activityId = msg.activity_id;\r\n                        _a = this._contextSubscriptions;\r\n                        _b = activityId;\r\n                        return [4 /*yield*/, this._contexts.subscribe(activityId, function (data, updated, removed) {\r\n                                var event = new entityEvent_1.EntityEvent(new activity_1.default(activityId, undefined, undefined, data, undefined), new entityEvent_1.ActivityContextChangedEventContext(data, updated, removed));\r\n                                _this.invokeCallbacks(_this._activityChangeCallbacks, event, \"context updated\");\r\n                            })];\r\n                    case 1:\r\n                        _a[_b] =\r\n                            _c.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handleActivityDestroyedMessage = function (msg) {\r\n        var unsubscribeContext = this._contextSubscriptions[msg.activity_id];\r\n        if (typeof unsubscribeContext === \"function\") {\r\n            unsubscribeContext();\r\n        }\r\n        delete this._contextSubscriptions[msg.activity_id];\r\n    };\r\n    GW3Bridge.prototype.handlePeerFactoriesAdded = function (msg) {\r\n        var _this = this;\r\n        msg.factories.forEach(function (entity) {\r\n            _this._peerIdAndFactoryIdToPeerType[msg.owner_id + \":\" + entity.id] = entity.peer_type;\r\n        });\r\n    };\r\n    GW3Bridge.prototype.handlePeerFactoriesRemoved = function (msg) {\r\n        var _this = this;\r\n        msg.factory_ids.forEach(function (factoryId) {\r\n            delete _this._peerIdAndFactoryIdToPeerType[msg.owner_id + \":\" + factoryId];\r\n        });\r\n    };\r\n    GW3Bridge.prototype.forwardActivityTypeMessagesToStatusEventHandlers = function () {\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMmessageActivityTypesAdded, gwMessageActivityTypesRemoved, function (msg, isAdded) { return isAdded\r\n            ? msg.types.map(function (t) { return GW3Bridge.activityTypeGwMessageEntityToActivityType(t, undefined); })\r\n            : msg.types.map(function (t) { return new activityType_1.default(t.name, undefined, undefined, undefined); }); }, this._activityTypeStatusChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardActivityCreatedAndJoinedActivityToActivityWindowEventHandlers = function () {\r\n        var _this = this;\r\n        // if we're created as part of this activity, the JOINED ACTIVITY is\r\n        // the first time we'll hear about it; so let's record the participants\r\n        for (var _i = 0, _a = [gwMessageActivityCreated, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var activityCreatedMessage = _a[_i];\r\n            this.forwardMessageToEventHandler(activityCreatedMessage, function (msg) {\r\n                return ([msg.owner])\r\n                    .concat(msg.participants || [])\r\n                    .map(function (info) { return new activityWindow_1.default(info.peer_id, info.name, info.type, msg.activity_id, undefined, undefined, _this.generateWindowGetter(info.peer_id), undefined); });\r\n            }, function (ent, msg) { return new entityEvent_1.EntityEvent(ent, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowJoinedActivity)); }, this._activityWindowChangeCallbacks);\r\n        }\r\n    };\r\n    GW3Bridge.prototype.forwardActivityMessagesToStatusEventHandlers = function () {\r\n        // see dot-net-activity\\Activity\\ActivityState.cs\r\n        for (var _i = 0, _a = [gwMessageActivityCreated, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var createdMessage = _a[_i];\r\n            this.forwardMessageToEventHandler(createdMessage, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new activityStatus_1.ActivityStatus(\"started\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        }\r\n        this.forwardMessageToEventHandler(gwMessageActivityDestroyed, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new activityStatus_1.ActivityStatus(\"destroyed\", msg.reason, new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n        this.forwardMessageToEventHandler(gwMessageActivityInitiated, function (msg) { return [GW3Bridge.activityGwMessageToActivity(msg, new activityStatus_1.ActivityStatus(\"created\", \"\", new Date()))]; }, function (ent, msg) { return GW3Bridge.activityToActivityStatusChangeEvent(ent); }, this._activityChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardPeerFactoryMessagesToStatusEventHandlers = function () {\r\n        var _this = this;\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerFactoriesAdded, gwMessagePeerFactoriesRemoved, function (msg, isAdded) { return isAdded\r\n            ? msg.factories.map(GW3Bridge.peerFactoryGwMessageEntityToWindowType)\r\n            : msg.factory_ids.map(function (id) { return _this.peerFactoryIdAndOwnerIdToWindowType(id, msg.owner_id); }).filter(function (x) { return x != null; }); }, this._windowTypeStatusChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.forwardPeerFactoryMessagesToPeerFactoryRequests = function () {\r\n        var _this = this;\r\n        this.subscribe(gwMessagePeerRequested, function (msg) {\r\n            var factory = _this._peerFactoriesRegisteredByUs[msg.peer_factory];\r\n            if (!factory) {\r\n                _this._gw3Session.send({\r\n                    type: gwMmessageError,\r\n                    request_id: msg.request_id,\r\n                    reason: \"Unknown peer factory \" + msg.peer_factory\r\n                });\r\n                return;\r\n            }\r\n            try {\r\n                var configuration = msg.configuration || {};\r\n                // NB: peer factories (or whoever they're delegating to) need to support whatever activity\r\n                // environment (GW3, HC) we're targeting when they're creating peers\r\n                // the manager is env agnostic, the bridge will augment the configuration with whatever's required\r\n                // NB: also, since peers are requested in two ways (single peer with just its configuration,\r\n                // or peer created as part of new activity, where the factory receives the aggregate config of\r\n                // all peers, combined from ADD ACTIVITY TYPE and CREATE ACTIVITY), the peer factories need to\r\n                // be able to handle both configuration structures intelligently.\r\n                configuration.gateway_token = configuration.gateway_token || msg.gateway_token;\r\n                configuration.peer_factory = configuration.peer_factory || msg.peer_factory;\r\n                var promise = factory.create({\r\n                    activityId: msg.activity.id,\r\n                    type: msg.activity.type,\r\n                    gwToken: configuration.gateway_token,\r\n                    configuration: configuration,\r\n                });\r\n                if (promise && promise.then && promise.catch) {\r\n                    promise.catch(function (err) { return _this._gw3Session.send({\r\n                        type: gwMmessageError,\r\n                        request_id: msg.request_id,\r\n                        reason: err && (err.message || JSON.stringify(err))\r\n                    }); });\r\n                }\r\n            }\r\n            catch (err) {\r\n                _this._gw3Session.send({\r\n                    type: gwMmessageError,\r\n                    request_id: msg.request_id,\r\n                    reason: err && (err.message || JSON.stringify(err))\r\n                });\r\n            }\r\n        });\r\n    };\r\n    GW3Bridge.prototype.forwardActivityWindowMessagesToEventHandlers = function () {\r\n        var _this = this;\r\n        var _loop_1 = function (joinedMessage) {\r\n            this_1.subscribe(joinedMessage, function (msg) {\r\n                var joinedId = (joinedMessage === gwMessageActivityJoined) ? msg.joined_id : msg.peer_id;\r\n                var joinedType = (joinedMessage === gwMessageActivityJoined) ? msg.joined_type : msg.peer_type;\r\n                var joinedName = (joinedMessage === gwMessageActivityJoined) ? msg.joined_name : msg.peer_name;\r\n                var entity = new activityWindow_1.default(joinedId, joinedName, joinedType /* for ACTIVITY JOINED */, msg.activity_id, undefined, undefined, _this.generateWindowGetter(joinedId), undefined);\r\n                // TODO review - what if it's our activity, do we\r\n                // even need to subscribe\r\n                if (!_this._contextSubscriptions[msg.activity_id]) {\r\n                    _this.subscribeToContext(msg).then(function () {\r\n                        if (joinedMessage === gwMessageJoinedActivity) {\r\n                            _this._activityJoinedPromiseResolve({});\r\n                        }\r\n                    });\r\n                }\r\n                else if (joinedMessage === gwMessageJoinedActivity) {\r\n                    _this._activityJoinedPromiseResolve({});\r\n                }\r\n                // TODO review: we might have the context data here already\r\n                // why not update it here instead of waiting for subscribeToContext\r\n                _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new entityEvent_1.EntityEvent(entity, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowJoinedActivity)), joinedMessage);\r\n            });\r\n        };\r\n        var this_1 = this;\r\n        for (var _i = 0, _a = [gwMessageActivityJoined, gwMessageJoinedActivity]; _i < _a.length; _i++) {\r\n            var joinedMessage = _a[_i];\r\n            _loop_1(joinedMessage);\r\n        }\r\n        this.subscribe(gwMessageActivityLeft, function (msg) {\r\n            var entity = new activityWindow_1.default(msg.left_id, undefined, undefined, null, undefined, undefined, _this.generateWindowGetter(msg.left_id), undefined);\r\n            _this.invokeCallbacks(_this._activityWindowChangeCallbacks, new entityEvent_1.EntityEvent(entity, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowLeftActivity)), gwMessageActivityLeft);\r\n        });\r\n        this.forwardAddedAndRemovedMessagesToEventHandler(gwMessagePeerCreated, undefined, function (msg) { return [\r\n            new activityWindow_1.default(msg.created_id, undefined /* #deleteme TODO: review - we should know the name if any */, undefined /* #deleteme TODO: review - we should know the type */, undefined, undefined, undefined, _this.generateWindowGetter(msg.created_id), undefined)\r\n        ]; }, this._activityWindowChangeCallbacks);\r\n    };\r\n    GW3Bridge.prototype.generateWindowGetter = function (peerId) {\r\n        var _this = this;\r\n        return function () {\r\n            var server = _this._config.agm.servers().filter(function (s) { return s.peerId === peerId; })[0];\r\n            if (!server) {\r\n                return;\r\n            }\r\n            var windowId = server.windowId;\r\n            return _this._config.windows.list().filter(function (w) { return w.id === windowId; })[0];\r\n        };\r\n    };\r\n    GW3Bridge.prototype.isOverrideTypeDefinition = function (value) {\r\n        if (typeof value === \"undefined\") {\r\n            return false;\r\n        }\r\n        if (value.owner) {\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    return GW3Bridge;\r\n}());\r\nexports.default = GW3Bridge;\r\n//# sourceMappingURL=gw3Bridge.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/bridges/gw3Bridge.js\n// module id = 43\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar entityEvent_1 = require(\"../contracts/entityEvent\");\r\nvar activityType_1 = require(\"../entities/activityType\");\r\nvar promiseExtensions_1 = require(\"../helpers/promiseExtensions\");\r\nvar readyMarker_1 = require(\"../helpers/readyMarker\");\r\nvar entityObservableCollection_1 = require(\"../helpers/entityObservableCollection\");\r\nvar logger_1 = require(\"../helpers/logger\");\r\nvar util = require(\"../helpers/util\");\r\nvar localWindowFactory_1 = require(\"./localWindowFactory\");\r\nvar entityEvent_2 = require(\"../contracts/entityEvent\");\r\nvar hcBridge_1 = require(\"../bridges/hcBridge\");\r\nvar ActivityManager = /** @class */ (function () {\r\n    function ActivityManager(bridge, autoAnnounce, windows) {\r\n        var _this = this;\r\n        this._logger = logger_1.Logger.Get(\"activityManager\");\r\n        this._announcedWindows = [];\r\n        this._attachedCallbacks = [];\r\n        this._detachedCallbacks = [];\r\n        this._frameColorChangesCallbacks = [];\r\n        this._windowHandlers = [];\r\n        this._bridge = bridge;\r\n        this._activityTypes = new entityObservableCollection_1.EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._windowTypes = new entityObservableCollection_1.EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._activities = new entityObservableCollection_1.EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        this._windows = new entityObservableCollection_1.EntityObservableCollection(function (e) { return _this._grabEntity(e); });\r\n        // signals to wait for - get AT, get WT, get Activities and get Windows\r\n        this._dataReadyMarker = new readyMarker_1.ReadyMarker(\"Activity Manager Data\", [\"GetActivityTypes\", \"GetWindowTypes\", \"GetActivities\", \"GetWindows\"].length);\r\n        this._descriptorsMarker = new readyMarker_1.ReadyMarker(\"Attached Activities Descriptors\", [\"GetDescriptors\"].length);\r\n        // waiting for activity data first\r\n        // NB: in the GW3 case, we don't have the ability to request data at will\r\n        // but need wait for delta messages\r\n        // So GW3Bridge returns empty arrays from the get() calls\r\n        // We're relying on the fact that the GW3 bridge will wait\r\n        // until resolving its .ready()\r\n        if (autoAnnounce) {\r\n            // if auto announce replace the ready marker, so:\r\n            // 1) wait for data\r\n            // 2) get descriptors\r\n            // 3) announce the current window\r\n            this._readyMarker = new readyMarker_1.ReadyMarker(\"Activity Manager Announce\", [\"Announcement\"].length);\r\n            this._dataReadyMarker.setCallback(function (dataErr) {\r\n                if (dataErr) {\r\n                    _this._readyMarker.error(dataErr);\r\n                }\r\n                _this._descriptorsMarker.setCallback(function (err) {\r\n                    if (err) {\r\n                        _this._readyMarker.error(err);\r\n                    }\r\n                    _this._logger.debug(\"Auto announcing window\");\r\n                    // signal no matter if it failed or not\r\n                    _this.announceWindow()\r\n                        .then(function (w) {\r\n                        // NB: this creates glue.activities.my.window\r\n                        _this._announcedWindows.push(w);\r\n                        _this._readyMarker.signal(\"Successfully announced window with id '\" + w.id + \"'\");\r\n                    })\r\n                        .catch(function (errCatch) {\r\n                        _this._logger.debug(\"Will not announce window - \" + errCatch);\r\n                        _this._readyMarker.signal();\r\n                    });\r\n                });\r\n                _this.refreshDescriptors();\r\n            });\r\n        }\r\n        else {\r\n            // TODO: not sure if this still works\r\n            this._readyMarker = this._dataReadyMarker;\r\n        }\r\n        this._bridge.onActivitiesAttached(function (e) {\r\n            _this._handleActivitiesAttached(e);\r\n        });\r\n        this._bridge.onActivitiesDetached(function (e) {\r\n            _this._handleActivitiesDetached(e);\r\n        });\r\n        this._bridge.onActivityAttachedDescriptorsRefreshed(function (e) {\r\n            _this._handleActivityDescriptorsRefreshed(e);\r\n        });\r\n        if (windows) {\r\n            windows.onWindowFrameColorChanged(this._handleWindowFrameColorChanged.bind(this));\r\n        }\r\n        // initialize the bridge\r\n        this._bridge.init();\r\n        // NB: there is no race condition here.\r\n        // Since browser/Node JS is a single-threaded environment, assuming no events on _bridge\r\n        // fire inside .init(), this subscribe will catch anything that comes between it and the init() call\r\n        this._subscribeForData();\r\n        // NB: in GW3 case, the initial state messages after a JOIN come in before the JOIN's SUCCESS\r\n        // message (see https://confluence.tick42.com:8443/display/TD/Global+Gateway+Domain#GlobalGatewayDomain-JOIN)\r\n        // so the .initReady().then() callback will only get invoked after we've received the initial domain\r\n        // state. We need to be ready to handle events before that, hence the _subscribeForData() above.\r\n        // what's more, our own JOINED ACTIVITY will come only after we've sent our READY, hence waiting\r\n        // for bridge.ready() in the manager's ready()\r\n        // wait for it to become ready and then start getting/subscribing for data\r\n        this._bridge\r\n            .initReady()\r\n            .then(function (aw) {\r\n            _this._getInitialData();\r\n        })\r\n            .catch(function (error) {\r\n            // tslint:disable-next-line\r\n            console.log(error);\r\n        });\r\n    }\r\n    Object.defineProperty(ActivityManager.prototype, \"usingHc\", {\r\n        get: function () {\r\n            return this._bridge.bridgeType === \"HC\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ActivityManager.prototype, \"announcedWindows\", {\r\n        get: function () {\r\n            return this._announcedWindows;\r\n        },\r\n        set: function (v) {\r\n            throw new Error(\"not allowed\");\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ActivityManager.prototype.ready = function (callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._readyMarker.setCallback(function (err) {\r\n                if (!err) {\r\n                    resolve(_this);\r\n                }\r\n                else {\r\n                    reject(_this._readyMarker.getError());\r\n                }\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(Promise.all([this._bridge.ready(), promise]).then(function () { return _this; }), callback);\r\n    };\r\n    /**\r\n     * @returns All known activity types\r\n     */\r\n    ActivityManager.prototype.getActivityTypes = function () {\r\n        return this._activityTypes.get();\r\n    };\r\n    /**\r\n     * Gets ActivityType by name\r\n     * @param name  Name to search for\r\n     * @returns     If found the @type ActivityType; otherwise undefined\r\n     */\r\n    ActivityManager.prototype.getActivityType = function (name) {\r\n        return this._activityTypes.getByName(name);\r\n    };\r\n    /**\r\n     * Registers a new activity type\r\n     * @param activityTypeName      The name of the activity type to be created\r\n     * @param ownerWindowType       The type of the owner window or a WindowDefinition for the owner window\r\n     * @param helperWindowTypes     Types of helper windows (or WindowDefinitions for helper windows) for that activity type\r\n     * @param config                (HC only, deprecated) Layout config\r\n     * @param description           (HC only, deprecated) Description for the new activity type\r\n     * @param callback              (Optional) Callback for results - if not specified the method will return a promise\r\n     */\r\n    ActivityManager.prototype.registerActivityType = function (activityTypeName, ownerWindowType, helperWindowTypes, config, description, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            // activityTypeName checks\r\n            if (util.isUndefinedOrNull(activityTypeName)) {\r\n                reject(\"activityTypeName argument can not be undefined\");\r\n                return;\r\n            }\r\n            if (!util.isString(activityTypeName)) {\r\n                reject(\"activityTypeName should be string\");\r\n                return;\r\n            }\r\n            // check if type is already defined\r\n            var actType = _this.getActivityType(activityTypeName);\r\n            if (!util.isUndefinedOrNull(actType)) {\r\n                reject(\"Activity type '\" + activityTypeName + \"' already exists\");\r\n                return;\r\n            }\r\n            // ownerWindowType checks\r\n            var ownerDefinition;\r\n            if (util.isUndefined(ownerWindowType)) {\r\n                reject(\"Owner window type can not be undefined\");\r\n                return;\r\n            }\r\n            if (util.isString(ownerWindowType)) {\r\n                ownerDefinition = { type: ownerWindowType, name: \"\", isIndependent: false, arguments: {} };\r\n            }\r\n            else {\r\n                ownerDefinition = ownerWindowType;\r\n            }\r\n            // helperWindowTypes checks\r\n            var helperDefinitions = [];\r\n            if (!util.isUndefined(helperWindowTypes) && util.isArray(helperWindowTypes)) {\r\n                // tslint:disable-next-line\r\n                for (var index in helperWindowTypes) {\r\n                    var item = helperWindowTypes[index];\r\n                    if (util.isString(item)) {\r\n                        var definition = {\r\n                            type: item,\r\n                            name: \"\",\r\n                            isIndependent: false,\r\n                            arguments: {},\r\n                            relativeTo: \"\",\r\n                            relativeDirection: \"\",\r\n                            windowStyleAttributes: {}\r\n                        };\r\n                        helperDefinitions.push(definition);\r\n                    }\r\n                    else {\r\n                        helperDefinitions.push(item);\r\n                    }\r\n                }\r\n            }\r\n            // redirect to bridge\r\n            _this._bridge\r\n                .registerActivityType(activityTypeName, ownerDefinition, helperDefinitions, config, description)\r\n                .then(function (activityType) {\r\n                // add to from collections\r\n                _this._grabEntity(activityType);\r\n                resolve(activityType);\r\n            })\r\n                .catch(function (error) {\r\n                reject(error);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Unregister existing activity type\r\n     * @param type The name of the activity type to be removed\r\n     */\r\n    ActivityManager.prototype.unregisterActivityType = function (type, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            // check if type is defined\r\n            var actType = _this.getActivityType(type);\r\n            if (util.isUndefined(actType)) {\r\n                reject(\"Activity type '\" + type + \"' does not exists\");\r\n                return;\r\n            }\r\n            _this._bridge.unregisterActivityType(type).then(function () { return resolve(actType); }, reject);\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Initiates a new activity from the given type.\r\n     * @param activityType  The ActivityType to initiate\r\n     * @param context       The initial context of the activity\r\n     * @param callback      Callback for result\r\n     * @param configuration Optional configuration passed to window/peer factories for the new activity's participants\r\n     * @returns             Promise for activity\r\n     */\r\n    ActivityManager.prototype.initiate = function (activityType, context, callback, configuration) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            // check if type is defined\r\n            var actType = _this.getActivityType(activityType);\r\n            if (util.isUndefined(actType)) {\r\n                reject(\"Activity type '\" + activityType + \"' does not exists\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .initiateActivity(activityType, context, configuration)\r\n                .then(function (actId) {\r\n                _this._activities\r\n                    .getOrWait(actId)\r\n                    .then(function (act) {\r\n                    resolve(act);\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityTypeEvents = function (handler) {\r\n        this._activityTypes.subscribe(function (at, context) {\r\n            handler(at, context.type);\r\n        });\r\n    };\r\n    /**\r\n     * @returns All known WindowTypes\r\n     */\r\n    ActivityManager.prototype.getWindowTypes = function () {\r\n        return this._windowTypes.get();\r\n    };\r\n    /**\r\n     * Gets WindowType by name\r\n     * @param name  The name of the type @type WindowType\r\n     * @returns     WindowType if found; undefined otherwise\r\n     */\r\n    ActivityManager.prototype.getWindowType = function (name) {\r\n        return this._windowTypes.getByName(name);\r\n    };\r\n    /**\r\n     * Registers a factory for a given WindowType. The factory will be called once window of that type is requested\r\n     * @param windowType   Window type that will be constructed from the factory. Can be a string (name of the window type)\r\n     * or object that has name, description properties\r\n     * @param factoryMethod      The factory that will construct Windows of that type\r\n     * @param description\r\n     * @param callback\r\n     * @param configuration\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.registerWindowFactory = function (windowType, factoryMethod, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(windowType)) {\r\n                reject(\"no windowType specified\");\r\n                return;\r\n            }\r\n            if (util.isObject(windowType)) {\r\n                windowType = windowType.getName();\r\n            }\r\n            else if (!util.isString(windowType)) {\r\n                reject(\"windowType should be string or object that has getName method\");\r\n                return;\r\n            }\r\n            var factory = new localWindowFactory_1.LocalWindowFactory(factoryMethod);\r\n            _this._bridge\r\n                .registerWindowFactory(windowType, factory)\r\n                .then(function (v) {\r\n                resolve(v);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Unregisters all factories for a given WindowType.\r\n     * @param windowType   Window type that is constructed from the factory.\r\n     * @param callback\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.unregisterWindowFactory = function (windowType, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(windowType)) {\r\n                reject(\"no windowType specified\");\r\n                return;\r\n            }\r\n            if (!util.isString(windowType)) {\r\n                reject(\"windowType should be a string\");\r\n                return;\r\n            }\r\n            _this._bridge\r\n                .unregisterWindowFactory(windowType)\r\n                .then(function (v) {\r\n                resolve(v);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * @returns All started activities\r\n     * @param activityType Can be a string or @type ActivityType. If string a new activityType will be created using the string for name.\r\n     * @returns Array of Activity objects\r\n     */\r\n    ActivityManager.prototype.getActivities = function (activityType) {\r\n        var act = this._activities.get();\r\n        if (!activityType) {\r\n            return act;\r\n        }\r\n        var types = activityType;\r\n        if (util.isString(activityType)) {\r\n            types = [activityType];\r\n        }\r\n        else if (activityType instanceof activityType_1.default) {\r\n            types = [activityType.name];\r\n        }\r\n        else if (activityType instanceof Array) {\r\n            // TODO check if string array or array of ActivityTypes\r\n        }\r\n        else {\r\n            throw new Error(\"Invalid input argument 'activityType' = \" + activityType);\r\n        }\r\n        return act.filter(function (at) {\r\n            var type = at.type;\r\n            return util.some(types, function (t) {\r\n                return type.id === t.id;\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Returns Activity by ID\r\n     */\r\n    ActivityManager.prototype.getActivityById = function (id) {\r\n        return this._activities.getByName(id);\r\n    };\r\n    /**\r\n     * Initialises activity for the current window - by doing this the window is announced as activity aware to the other participants\r\n     * @param windowType            Type of window\r\n     * @param activityWindowId      The id of the window that was created\r\n     * @returns {}                  Promise for an activity window (joined to an activity, if the activity creation fails the promise will be rejected)\r\n     */\r\n    ActivityManager.prototype.announceWindow = function (activityWindowId, windowType) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            // get the announcement info from the bridge (e.g. the context in HC) - this will be used if no arguments passed\r\n            var announcementInfo = _this._bridge.getAnnouncementInfo();\r\n            if (util.isUndefined(activityWindowId)) {\r\n                activityWindowId = announcementInfo.activityWindowId;\r\n            }\r\n            if (util.isUndefined(windowType)) {\r\n                windowType = announcementInfo.activityWindowType;\r\n            }\r\n            if (util.isUndefinedOrNull(windowType)) {\r\n                throw new Error(\"Can not announce - unknown windowType\");\r\n            }\r\n            var activityId = announcementInfo && announcementInfo.activityId;\r\n            // We cover two cases here:\r\n            // * no activityWindowId supplied (neither in arguments or announcement info) - in that case we register new window by type. Most of the time this is the case when an independent window is created outside activity\r\n            // * activityWindowId supplied - window created as part of activity creation\r\n            // NB: in GW3, windows are created standalone, and receive 'JOINED' after they send a 'READY'\r\n            // so we always go in 'if' case, not 'else'\r\n            if (util.isUndefinedOrNull(activityWindowId)) {\r\n                _this._logger.debug(\"Registering window with type:'\" + windowType + \"', name:'\" + announcementInfo.activityWindowName + \"', ind.:'\" + announcementInfo.activityWindowIndependent + \"'\");\r\n                // register new window created outside activity\r\n                _this._bridge.registerWindow(windowType, announcementInfo.activityWindowName, announcementInfo.activityWindowIndependent)\r\n                    .then(_this._windows.getOrWait.bind(_this._windows))\r\n                    .then(function (w) {\r\n                    if (activityId) {\r\n                        return _this._activities.getOrWait(activityId).then(function (_) { return w; });\r\n                    }\r\n                    else {\r\n                        return w;\r\n                    }\r\n                })\r\n                    .then(function (w) {\r\n                    resolve(w);\r\n                })\r\n                    .catch(function (err) {\r\n                    _this._logger.error(err);\r\n                });\r\n            }\r\n            else {\r\n                // announce new window created in an activity creation process\r\n                _this._logger.debug(\"Announcing window with id '\" + activityWindowId + \"' and type '\" + windowType + \"'\");\r\n                // check if the window is already created -\r\n                var currentWindow = _this._windows.getByName(activityWindowId);\r\n                if (!util.isUndefinedOrNull(currentWindow)) {\r\n                    _this._logger.debug(\"Window with id '\" + activityWindowId + \"' already announced - reusing the window\");\r\n                    resolve(currentWindow);\r\n                    return;\r\n                }\r\n                // window events handler\r\n                var windowEventHandler_1 = function (a, w, e) {\r\n                    if (activityWindowId === w.id) {\r\n                        if (e === entityEvent_1.EntityEventType.ActivityWindowJoinedActivity) {\r\n                            var activity = w.activity;\r\n                            if (util.isUndefined(activity)) {\r\n                                reject(\"UNDEFINED ACTIVITY\");\r\n                            }\r\n                            _this._logger.trace(\"Got joined event for id '\" + activityWindowId + \"'\");\r\n                            resolve(w);\r\n                            _this.unsubscribeWindowEvents(windowEventHandler_1);\r\n                        }\r\n                    }\r\n                };\r\n                _this.subscribeWindowEvents(windowEventHandler_1);\r\n                _this._logger.trace(\"Waiting for joined event for id '\" + activityWindowId + \"'\");\r\n                _this._bridge.announceWindow(windowType, activityWindowId);\r\n            }\r\n        });\r\n        return promise;\r\n    };\r\n    /**\r\n     * Allows you to subscribe for windows events, e.g. window type registered\r\n     * @param handler   The handler to receive notifications\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.subscribeWindowTypeEvents = function (handler) {\r\n        this._windowTypes.subscribe(function (wt, context) {\r\n            handler(wt, context.type);\r\n        });\r\n    };\r\n    /**\r\n     * Subscribe for activity status events\r\n     * @param handler Handler function that will receive status notifications\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.subscribeActivityEvents = function (handler) {\r\n        var _this = this;\r\n        return this._activities.subscribe(function (act, context) {\r\n            if (context.type === entityEvent_1.EntityEventType.StatusChange) {\r\n                var p = context;\r\n                handler(act, p.newStatus, p.oldStatus);\r\n            }\r\n            // implicitly leave the activity on destroy\r\n            if (context.type === entityEvent_1.EntityEventType.Removed ||\r\n                (context.type === entityEvent_1.EntityEventType.StatusChange &&\r\n                    context.newStatus.getState() === entityEvent_2.ActivityState.Destroyed)) {\r\n                for (var _i = 0, _a = _this._windows.get(); _i < _a.length; _i++) {\r\n                    var window_1 = _a[_i];\r\n                    if (window_1.activity && window_1.activity.id === act.id) {\r\n                        _this._windows.process(new entityEvent_1.EntityEvent(window_1, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.ActivityWindowLeftActivity)));\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Allows you to subscribe for windows events, e.g. window joining to activity\r\n     * @param handler   The handler to receive notifications\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.subscribeWindowEvents = function (handler) {\r\n        var wrappingHandler = function (window, context) {\r\n            var eventType = context.type;\r\n            if (eventType === entityEvent_1.EntityEventType.Added) {\r\n                // rename added to opened (because added is misleading - semantically it's the opposite of remove);\r\n                eventType = \"opened\";\r\n            }\r\n            handler(window.activity, window, eventType);\r\n        };\r\n        this._windowHandlers.push([handler, wrappingHandler]);\r\n        return this._windows.subscribe(wrappingHandler);\r\n    };\r\n    ActivityManager.prototype.unsubscribeWindowEvents = function (handler) {\r\n        var found = this._windowHandlers.find(function (pair) { return pair[0] === handler; });\r\n        if (found) {\r\n            this._windowHandlers.splice(this._windowHandlers.indexOf(found), 1);\r\n            this._windows.unsubscribe(found[1]);\r\n        }\r\n    };\r\n    /**\r\n     * Creates a new window from a given type and joins it to an activity\r\n     *\r\n     * @param activity      Activity to join the window to\r\n     * @param windowType    The window type to join (string or window definition)\r\n     * @param callback      (Optional) Result callback\r\n     * @returns             Promise for ActivityWindow\r\n     */\r\n    ActivityManager.prototype.createWindow = function (activity, windowTypeOrConfiguration, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(windowTypeOrConfiguration)) {\r\n                reject(\"windowType is undefined\");\r\n            }\r\n            var windowDefinition;\r\n            if (util.isString(windowTypeOrConfiguration)) {\r\n                windowDefinition = { type: windowTypeOrConfiguration, name: \"\", isIndependent: false, arguments: {} };\r\n            }\r\n            else {\r\n                windowDefinition = windowTypeOrConfiguration;\r\n            }\r\n            var relativeToWindow;\r\n            if (!util.isUndefinedOrNull(windowDefinition.relativeTo)) {\r\n                relativeToWindow = windowDefinition.relativeTo;\r\n                if (typeof relativeToWindow === \"string\") {\r\n                    var windows = _this.getWindows({ type: relativeToWindow });\r\n                    if (!util.isUndefinedOrNull(windows) && windows.length > 0) {\r\n                        windowDefinition.relativeTo = windows[0].id;\r\n                    }\r\n                }\r\n                else if (!util.isUndefinedOrNull(relativeToWindow.type)) {\r\n                    var windows = _this.getWindows({ type: relativeToWindow.type });\r\n                    if (!util.isUndefinedOrNull(windows) && windows.length > 0) {\r\n                        windowDefinition.relativeTo = windows[0].id;\r\n                    }\r\n                }\r\n                else if (!util.isUndefinedOrNull(relativeToWindow.windowId)) {\r\n                    windowDefinition.relativeTo = relativeToWindow.windowId;\r\n                }\r\n            }\r\n            _this._bridge.createWindow(activity && activity.id, windowDefinition)\r\n                .then(function (wid) {\r\n                _this._logger.debug(\"Window created, waiting for window entity with id \" + wid);\r\n                var handler = function (window, context) {\r\n                    // wait until the window has activity property (this means it was joined)\r\n                    if (window.id === wid && (!activity || window.activity)) {\r\n                        _this._logger.debug(\"Got entity window with id \" + wid);\r\n                        resolve(window);\r\n                        _this._windows.unsubscribe(handler);\r\n                    }\r\n                };\r\n                // if we can not get the window right away, wait for event\r\n                _this._windows.subscribe(handler);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Creates relative windows from a given types and joins them to an activity\r\n     *\r\n     * @param activity               Activity to join relative windows to\r\n     * @param relativeWindowTypes    Relative window types to join (string or window definitions array)\r\n     * @param callback               (Optional) Result callback\r\n     * @returns                      Promise for ActivityWindow\r\n     */\r\n    ActivityManager.prototype.createStackedWindows = function (activity, relativeWindowTypes, timeout, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(activity)) {\r\n                reject(\"activity is undefined\");\r\n            }\r\n            if (util.isUndefinedOrNull(relativeWindowTypes)) {\r\n                reject(\"relativeWindowTypes is undefined\");\r\n            }\r\n            if (!Array.isArray(relativeWindowTypes)) {\r\n                reject(\"relativeWindowTypes has to be array\");\r\n            }\r\n            if (util.isUndefinedOrNull(timeout)) {\r\n                timeout = 20000; // default timeout: 20 seconds\r\n            }\r\n            var relativeWindows = [];\r\n            relativeWindowTypes.forEach(function (element) {\r\n                var windowDefinition;\r\n                if (util.isString(element)) {\r\n                    windowDefinition = { type: element, name: \"\", isIndependent: false, arguments: {} };\r\n                }\r\n                else {\r\n                    windowDefinition = element;\r\n                }\r\n                var relativeToWindow;\r\n                if (!util.isUndefinedOrNull(windowDefinition.relativeTo)) {\r\n                    // this can not be string, converted in the prev. layer\r\n                    relativeToWindow = windowDefinition.relativeTo;\r\n                    if (!util.isUndefinedOrNull(relativeToWindow.type)) {\r\n                        windowDefinition.relativeTo = relativeToWindow.type;\r\n                    }\r\n                    else if (!util.isUndefinedOrNull(relativeToWindow.windowId)) {\r\n                        var windows = _this.getWindows({ id: relativeToWindow.windowId });\r\n                        if (!util.isUndefinedOrNull(windows) && windows.length > 0) {\r\n                            windowDefinition.relativeTo = windows[0].type.name;\r\n                            windowDefinition.useExisting = true;\r\n                        }\r\n                    }\r\n                }\r\n                relativeWindows.push(windowDefinition);\r\n            });\r\n            _this._bridge.createStackedWindows(activity.id, relativeWindows, timeout)\r\n                .then(function (wid) {\r\n                var activityWindows = [];\r\n                var alreadyCreated = [];\r\n                var handler = function (window, context) {\r\n                    // wait until the window has activity property (this means it was joined)\r\n                    if (wid.indexOf(window.id) >= 0 && alreadyCreated.indexOf(window.id) < 0 && window.activity) {\r\n                        this._logger.debug(\"Got entity window with id \" + wid);\r\n                        activityWindows.push(window);\r\n                        alreadyCreated.push(window.id);\r\n                        if (activityWindows.length === wid.length) {\r\n                            resolve(activityWindows);\r\n                            this._windows.unsubscribe(handler);\r\n                        }\r\n                    }\r\n                }.bind(_this);\r\n                // if we can not get the window right away, wait for event\r\n                _this._windows.subscribe(handler);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Joins a new window from a given type to the activity\r\n     *\r\n     * @param activity      Activity to join the window to\r\n     * @param window        The window to join\r\n     * @param callback      (Optional) Result callback\r\n     * @returns             Promise for ActivityWindow\r\n     */\r\n    ActivityManager.prototype.addWindowToActivity = function (activity, window, callback) {\r\n        var toReturn = this._bridge.joinActivity(activity.id, window.id)\r\n            .then(function () { return window; });\r\n        promiseExtensions_1.nodeify(toReturn, callback);\r\n        return toReturn;\r\n    };\r\n    /**\r\n     * Removes a window from the activity\r\n     *\r\n     * @param activity  Activity to remove the window from\r\n     * @param           The window to remove\r\n     * @param           (Optional) Result callback\r\n     * @returns         Promise for ActivityWindow\r\n     */\r\n    ActivityManager.prototype.leaveWindowFromActivity = function (activity, window, callback) {\r\n        var toReturn = this._bridge.leaveActivity(activity.id, window.id)\r\n            .then(function () { return window; });\r\n        promiseExtensions_1.nodeify(toReturn, callback);\r\n        return toReturn;\r\n    };\r\n    /**\r\n     * Replaces the activity context\r\n     * @param activity  Activity\r\n     * @param context   The new context\r\n     * @param callback  (Optional) Result callback\r\n     * @returns         Promise for Activity\r\n     */\r\n    ActivityManager.prototype.setActivityContext = function (activity, context, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(activity)) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            // TODO: duplication with updateActivityContext\r\n            // DONE: verify is the change visible here when 'updateActivityContext' resolves?\r\n            _this._bridge\r\n                .updateActivityContext(activity, context, true)\r\n                .then(function (_) {\r\n                resolve(activity);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Updates activity context using the properties from  context argument.\r\n     * If old context is {a:1, b:2, c:3} and invoking updateContext({b:3, c:null}) will result a context\r\n     * be {a:1, b:3}\r\n     *\r\n     * @param activity\r\n     * @param context\r\n     * @param callback\r\n     */\r\n    ActivityManager.prototype.updateActivityContext = function (activity, context, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (util.isUndefinedOrNull(activity)) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            var removedKeys = [];\r\n            for (var key in context) {\r\n                if (context.hasOwnProperty(key) && context[key] === null) {\r\n                    removedKeys.push(key);\r\n                }\r\n            }\r\n            for (var _i = 0, removedKeys_1 = removedKeys; _i < removedKeys_1.length; _i++) {\r\n                var removedKey = removedKeys_1[_i];\r\n                delete context[removedKey];\r\n            }\r\n            _this._bridge\r\n                .updateActivityContext(activity, context, false, removedKeys)\r\n                .then(function (_) {\r\n                // DONE: verify is the change already visible here when 'updateActivityContext' resolves?\r\n                resolve(activity);\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Subscribe for activity context update events\r\n     *\r\n     * @param activity  Activity\r\n     * @param handler   Handler function that will receive context related events\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.subscribeActivityContextChanged = function (handler) {\r\n        this._activities.subscribe(function (act, context) {\r\n            if (context.type === entityEvent_1.EntityEventType.ActivityContextChange) {\r\n                var updateContext = context;\r\n                handler(act, updateContext.context, updateContext.updated, updateContext.removed);\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Stops an activity\r\n     * @returns {}\r\n     */\r\n    ActivityManager.prototype.stopActivity = function (activity, callback) {\r\n        var promise = this._bridge.stopActivity(activity);\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    /**\r\n     * Returns activity windows based on some filter. If no filter supplied all activity windows are returned.\r\n     * @param filter  Filter that\r\n     * @returns Array of ActivityWindows that match the filter object\r\n     */\r\n    ActivityManager.prototype.getWindows = function (filter) {\r\n        if (util.isUndefined(filter)) {\r\n            return this._windows.get();\r\n        }\r\n        if (!util.isUndefined(filter.id)) {\r\n            return [this._windows.getByName(filter.id)];\r\n        }\r\n        var allWindows = this._windows.get();\r\n        return allWindows.filter(function (w) {\r\n            if (!util.isUndefined(filter.type) && w.type.id !== filter.type) {\r\n                return false;\r\n            }\r\n            if (!util.isUndefined(filter.name) && w.name !== filter.name) {\r\n                return false;\r\n            }\r\n            if (!util.isUndefined(filter.activityId)) {\r\n                if (util.isUndefinedOrNull(w.activity)) {\r\n                    return false;\r\n                }\r\n                if (w.activity.id !== filter.activityId) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        });\r\n    };\r\n    ActivityManager.prototype.getWindowBounds = function (id) {\r\n        return this._bridge.getWindowBounds(id);\r\n    };\r\n    ActivityManager.prototype.setWindowBounds = function (id, bounds, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            _this._bridge.setWindowBounds(id, bounds)\r\n                .then(function () { return resolve(); })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.closeWindow = function (id) {\r\n        return this._bridge.closeWindow(id);\r\n    };\r\n    ActivityManager.prototype.activateWindow = function (id, focus) {\r\n        return this._bridge.activateWindow(id, focus);\r\n    };\r\n    ActivityManager.prototype.setWindowVisibility = function (id, visible) {\r\n        return this._bridge.setWindowVisibility(id, visible);\r\n    };\r\n    ActivityManager.prototype.clone = function (activity, cloneOptions, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            if (!activity) {\r\n                reject(\"activity can not be null\");\r\n            }\r\n            _this._bridge.cloneActivity(activity.id, cloneOptions)\r\n                .then(function (activityId) {\r\n                _this._activities\r\n                    .getOrWait(activityId)\r\n                    .then(function (act) {\r\n                    resolve(act);\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.attachActivities = function (from, to, tag, callback) {\r\n        var _this = this;\r\n        tag = tag || {};\r\n        var promise = new Promise(function (resolve, reject) {\r\n            var fromActivity = _this._activities.getByName(from);\r\n            if (!fromActivity) {\r\n                reject(\"can not find activity with id \" + from);\r\n                return;\r\n            }\r\n            var toActivity = _this._activities.getByName(to);\r\n            if (!toActivity) {\r\n                reject(\"can not find activity with id \" + to);\r\n                return;\r\n            }\r\n            return _this._bridge.attachActivities(from, to, tag)\r\n                .then(function (data) {\r\n                var newActId = data.to;\r\n                var state = data.descriptor;\r\n                var allStates = data.descriptors;\r\n                _this._activities.getOrWait(newActId).then(function (act) {\r\n                    act._updateDescriptors(allStates);\r\n                    var stateWrapped = act.attached.filter(function (u) { return u.ownerId === state.ownerId; })[0];\r\n                    resolve(stateWrapped);\r\n                });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.detachActivities = function (activityId, descriptor, callback) {\r\n        var _this = this;\r\n        var promise = new Promise(function (resolve, reject) {\r\n            return _this._bridge.detachActivities(activityId, descriptor)\r\n                .then(/*(params)*/ function () {\r\n                // #deleteme TODO: deal with this\r\n                var oldActId = undefined; // params.oldActivityId;\r\n                var newActId = undefined; // params.newActivityId;\r\n                var descriptors = undefined; // params.descriptors;\r\n                _this._activities\r\n                    .getOrWait(oldActId)\r\n                    .then(function (oldAct) {\r\n                    oldAct._updateDescriptors(descriptors);\r\n                    _this._activities\r\n                        .getOrWait(newActId)\r\n                        .then(function (newAct) {\r\n                        resolve(newAct);\r\n                    });\r\n                })\r\n                    .catch(function (err) { return reject(err); });\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n        return promiseExtensions_1.nodeify(promise, callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivitiesAttached = function (callback) {\r\n        this._attachedCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivitiesDetached = function (callback) {\r\n        this._detachedCallbacks.push(callback);\r\n    };\r\n    ActivityManager.prototype.subscribeActivityFrameColorChanged = function (callback) {\r\n        this._frameColorChangesCallbacks.push(callback);\r\n    };\r\n    /** Assigns a manager to a given ActivityEntity */\r\n    ActivityManager.prototype._grabEntity = function (entity) {\r\n        entity._manager = this;\r\n    };\r\n    ActivityManager.prototype._getInitialData = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"Request initial data...\");\r\n        // NB: there's no possibility for duplicate entities from events that have come\r\n        // in between _bridge.init() and _bridge.ready()'s resolve, since the ObservableCollections\r\n        // coalesce items by id.\r\n        this._bridge.getActivityTypes()\r\n            .then(function (at) {\r\n            _this._activityTypes.add(at);\r\n            _this._dataReadyMarker.signal(\"Got act types\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity types -\" + error);\r\n        });\r\n        this._bridge.getWindowTypes()\r\n            .then(function (wt) {\r\n            _this._windowTypes.add(wt);\r\n            _this._dataReadyMarker.signal(\"Got window types\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting window types  \" + error);\r\n        });\r\n        this._bridge.getActivities()\r\n            .then(function (ac) {\r\n            _this._activities.add(ac);\r\n            _this._dataReadyMarker.signal(\"Got activities\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity instances -\" + error);\r\n        });\r\n        this._bridge.getActivityWindows()\r\n            .then(function (aw) {\r\n            _this._windows.add(aw);\r\n            _this._dataReadyMarker.signal(\"Got windows\");\r\n        })\r\n            .catch(function (error) {\r\n            _this._logger.error(error);\r\n            _this._dataReadyMarker.error(\"Can not initialize ActivityManager - error getting activity windows -\" + error);\r\n        });\r\n    };\r\n    ActivityManager.prototype._subscribeForData = function () {\r\n        var _this = this;\r\n        this._logger.debug(\"Subscribe for data...\");\r\n        // NB: there's no possibility for duplicate entities from events that have come\r\n        // in between _bridge.init() and _bridge.ready()'s resolve, since the ObservableCollections\r\n        // coalesce items by id.\r\n        this._bridge.onActivityTypeStatusChange(function (event) {\r\n            _this._activityTypes.process(event);\r\n        });\r\n        this._bridge.onWindowTypeStatusChange(function (event) {\r\n            _this._windowTypes.process(event);\r\n        });\r\n        this._bridge.onActivityStatusChange(function (event) {\r\n            var activity = _this._activities.process(event);\r\n            if (event.context.type === entityEvent_1.EntityEventType.ActivityWindowJoinedActivity &&\r\n                activity &&\r\n                activity.context &&\r\n                _this._bridge instanceof hcBridge_1.default) {\r\n                // for parity with older code which explicitly sent a context update to subscribers\r\n                // upon joining an activity\r\n                _this._activities.process(new entityEvent_1.EntityEvent(activity, new entityEvent_1.ActivityContextChangedEventContext(activity.context, activity.context, [])));\r\n            }\r\n        });\r\n        this._bridge.onActivityWindowChange(function (event) {\r\n            _this._windows.process(event);\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivitiesAttached = function (data) {\r\n        var _this = this;\r\n        var newActId = data.to;\r\n        var descriptor = data.descriptor;\r\n        var descriptors = data.descriptors;\r\n        this._activities.getOrWait(newActId).then(function (act) {\r\n            act._updateDescriptors(descriptors);\r\n            var descriptorAsObjectFromAPI = act.attached.filter(function (u) { return u.ownerId === descriptor.ownerId; })[0];\r\n            _this._attachedCallbacks.forEach(function (callback) {\r\n                try {\r\n                    callback(act, descriptorAsObjectFromAPI);\r\n                }\r\n                catch (err) {\r\n                    return;\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivitiesDetached = function (data) {\r\n        var _this = this;\r\n        var oldActId = data.oldActivityId;\r\n        var newActId = data.newActivityId;\r\n        var descriptors = data.descriptors;\r\n        var descriptor = data.descriptor;\r\n        this._activities.getOrWait(oldActId).then(function (oldAct) {\r\n            oldAct._updateDescriptors(descriptors);\r\n            _this._activities.getOrWait(newActId).then(function (newAct) {\r\n                _this._detachedCallbacks.forEach(function (callback) {\r\n                    try {\r\n                        callback(newAct, oldAct, descriptor);\r\n                    }\r\n                    catch (err) {\r\n                        return;\r\n                    }\r\n                });\r\n            });\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleActivityDescriptorsRefreshed = function (data) {\r\n        var id = data.id;\r\n        var descriptors = data.descriptors;\r\n        var act = this._activities.getByName(id);\r\n        if (act) {\r\n            act._updateDescriptors(descriptors);\r\n        }\r\n    };\r\n    ActivityManager.prototype.refreshDescriptors = function () {\r\n        var _this = this;\r\n        this._bridge.getAttachedDescriptors()\r\n            .then(function (map) {\r\n            // populate descriptors\r\n            if (map) {\r\n                Object.keys(map).forEach(function (key) {\r\n                    var actId = key;\r\n                    var descriptors = map[key];\r\n                    var act = _this._activities.getByName(actId);\r\n                    if (act) {\r\n                        act._updateDescriptors(descriptors);\r\n                    }\r\n                });\r\n            }\r\n            _this._descriptorsMarker.signal(\"Successfully got descriptors\");\r\n        })\r\n            .catch(function (err) {\r\n            _this._descriptorsMarker.error(\"failed to get descriptors - \" + err);\r\n        });\r\n    };\r\n    ActivityManager.prototype._handleWindowFrameColorChanged = function (win) {\r\n        if (!win.activityId) {\r\n            return;\r\n        }\r\n        var act = this._activities.getByName(win.activityId);\r\n        if (!act) {\r\n            return;\r\n        }\r\n        // notify for the owner only\r\n        if (!act.owner) {\r\n            return;\r\n        }\r\n        if (act.owner.underlyingWindow.id !== win.id) {\r\n            return;\r\n        }\r\n        this._frameColorChangesCallbacks.forEach(function (callback) {\r\n            try {\r\n                callback(act, win.frameColor);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    return ActivityManager;\r\n}());\r\nexports.default = ActivityManager;\r\n//# sourceMappingURL=activityManager.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/core/activityManager.js\n// module id = 44\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar LocalWindowFactory = /** @class */ (function () {\r\n    function LocalWindowFactory(createFunction) {\r\n        this.createFunction = createFunction;\r\n        this.createFunction = createFunction;\r\n    }\r\n    LocalWindowFactory.prototype.create = function (activityInfo) {\r\n        return this.createFunction(activityInfo);\r\n    };\r\n    return LocalWindowFactory;\r\n}());\r\nexports.LocalWindowFactory = LocalWindowFactory;\r\n//# sourceMappingURL=localWindowFactory.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/core/localWindowFactory.js\n// module id = 45\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AttachedActivityDescriptor = /** @class */ (function () {\r\n    function AttachedActivityDescriptor(manager, ownerActivityId, state) {\r\n        this._manager = manager;\r\n        this._ownerActivityId = ownerActivityId;\r\n        this._state = state;\r\n    }\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"ownerId\", {\r\n        get: function () {\r\n            return this._state.ownerId;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"windowIds\", {\r\n        get: function () {\r\n            return this._state.windowIds;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"frameColor\", {\r\n        get: function () {\r\n            return this._state.frameColor;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"context\", {\r\n        get: function () {\r\n            return this._state.context;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(AttachedActivityDescriptor.prototype, \"tag\", {\r\n        get: function () {\r\n            return this._state.tag;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    AttachedActivityDescriptor.prototype.detach = function (descriptor) {\r\n        var _this = this;\r\n        descriptor = descriptor || {};\r\n        var merged = {};\r\n        Object.keys(this._state).forEach(function (prop) {\r\n            merged[prop] = _this._state[prop];\r\n        });\r\n        merged.context = descriptor.context || merged.context;\r\n        merged.frameColor = descriptor.frameColor || merged.frameColor;\r\n        return this._manager.detachActivities(this._ownerActivityId, merged);\r\n    };\r\n    return AttachedActivityDescriptor;\r\n}());\r\nexports.AttachedActivityDescriptor = AttachedActivityDescriptor;\r\n//# sourceMappingURL=attachedActivityDescriptor.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/entities/attachedActivityDescriptor.js\n// module id = 46\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar entityEvent_1 = require(\"../contracts/entityEvent\");\r\nvar entityEvent_2 = require(\"..//contracts/entityEvent\");\r\n/**\r\n * Collection of ActivityEntities that provides change notifications\r\n * @module entityCollection\r\n * @private\r\n */\r\nvar EntityObservableCollection = /** @class */ (function () {\r\n    function EntityObservableCollection(processNew) {\r\n        this._items = {};\r\n        this._listeners = [];\r\n        this._processNew = processNew;\r\n    }\r\n    /**\r\n     * Adds one item to the collection\r\n     */\r\n    EntityObservableCollection.prototype.addOne = function (item) {\r\n        this.add([item]);\r\n    };\r\n    /**\r\n     * Adds an array of items to the collection\r\n     */\r\n    EntityObservableCollection.prototype.add = function (items) {\r\n        var _this = this;\r\n        items.forEach(function (element) {\r\n            _this.process(new entityEvent_1.EntityEvent(element, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added)));\r\n        });\r\n    };\r\n    /**\r\n     * Process existing EntityEvent\r\n     */\r\n    EntityObservableCollection.prototype.process = function (event) {\r\n        var context = event.context;\r\n        var type = context.type;\r\n        var entity = event.entity;\r\n        // here we're populating some data which particular implementations (e.g.\r\n        // GW3) can't provide\r\n        // TODO: extract these cases into external filters\r\n        // activity status change without old status?\r\n        // grab it from the existing entity\r\n        if (type === entityEvent_1.EntityEventType.StatusChange &&\r\n            !context.oldStatus) {\r\n            var act = this._items[entity.id];\r\n            if (act) {\r\n                context.oldStatus = act.status;\r\n            }\r\n        }\r\n        // the GW3 bridge notifies us of possible status changes (it's mostly stateless so\r\n        // it can't/doesn't distinguish between JOINED ACTIVITY for an activity we already\r\n        // know about vs a brand new activity. for this reason, we just coalesce status\r\n        // updates which indicate the same state.\r\n        if (type === entityEvent_1.EntityEventType.StatusChange &&\r\n            context.oldStatus &&\r\n            context.newStatus &&\r\n            context.oldStatus.state ===\r\n                context.newStatus.state) {\r\n            context.type = entityEvent_1.EntityEventType.Updated;\r\n        }\r\n        // GW3: coalesce multiple joined/left events\r\n        if (typeof htmlContainer === \"undefined\") {\r\n            if (type === entityEvent_1.EntityEventType.ActivityWindowJoinedActivity &&\r\n                this._items[entity.id] &&\r\n                this._items[entity.id].activity) {\r\n                context.type = entityEvent_1.EntityEventType.Updated;\r\n            }\r\n            if (type === entityEvent_1.EntityEventType.ActivityWindowLeftActivity &&\r\n                this._items[entity.id] &&\r\n                !this._items[entity.id].activity) {\r\n                context.type = entityEvent_1.EntityEventType.Updated;\r\n            }\r\n        }\r\n        // update internal collections (adding the entity or updating existing entity). From that\r\n        // point start using the internalEntity\r\n        // NB: undefined properties are coalesced, null properties represent removals\r\n        var internalEntity = this._updateInternalCollections(entity, type, context);\r\n        this._notifyListeners(internalEntity, context);\r\n        return internalEntity;\r\n    };\r\n    /**\r\n     * Gets all items from the collection.\r\n     */\r\n    EntityObservableCollection.prototype.get = function () {\r\n        var result = [];\r\n        for (var key in this._items) {\r\n            if (this._items.hasOwnProperty(key)) {\r\n                var element = this._items[key];\r\n                result.push(element);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    /**\r\n     * Gets item by name/id\r\n     * @param name  Name/id of the item to get\r\n     * @returns     Item if found; undefined if not\r\n     */\r\n    EntityObservableCollection.prototype.getByName = function (name) {\r\n        // this does not work for some reason\r\n        // return this._items[name];\r\n        for (var key in this._items) {\r\n            if (key === name) {\r\n                return this._items[key];\r\n            }\r\n        }\r\n        return undefined;\r\n    };\r\n    /**\r\n     * Gets a item if in the collection or waits for it to appear\r\n     * @param name\r\n     * @returns {Promise<T>}\r\n     */\r\n    EntityObservableCollection.prototype.getOrWait = function (name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            var entityAddedHandler = function (entity) {\r\n                if (entity.id !== name) {\r\n                    return;\r\n                }\r\n                resolve(entity);\r\n                _this.unsubscribe(entityAddedHandler);\r\n            };\r\n            _this.subscribe(entityAddedHandler);\r\n            // try to get right away - if not here wait for it to appear\r\n            var window = _this.getByName(name);\r\n            if (window) {\r\n                _this.unsubscribe(entityAddedHandler);\r\n                resolve(window);\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Subscribes a listener for changes\r\n     * @param handler Callback for changes\r\n     */\r\n    EntityObservableCollection.prototype.subscribe = function (handler) {\r\n        var _this = this;\r\n        this._listeners.push(handler);\r\n        // replay existing items for new subscribers\r\n        Object.keys(this._items).forEach(function (key) {\r\n            var element = _this._items[key];\r\n            handler(element, new entityEvent_1.EntityEventContext(entityEvent_1.EntityEventType.Added.toString()));\r\n        });\r\n        return function () {\r\n            _this.unsubscribe(handler);\r\n        };\r\n    };\r\n    /**\r\n     *  Unsubscribes a listener\r\n     */\r\n    EntityObservableCollection.prototype.unsubscribe = function (handler) {\r\n        var index = this._listeners.indexOf(handler);\r\n        if (index !== -1) {\r\n            this._listeners.splice(index, 1);\r\n        }\r\n    };\r\n    /**\r\n     * Notify all listeners for some event\r\n     */\r\n    EntityObservableCollection.prototype._notifyListeners = function (entity, context) {\r\n        this._listeners.forEach(function (listener) {\r\n            try {\r\n                listener(entity, context);\r\n            }\r\n            catch (e) {\r\n                return;\r\n            }\r\n        });\r\n    };\r\n    /**\r\n     * Update internal collections (usually after some kind of modification event has arrived)\r\n     */\r\n    EntityObservableCollection.prototype._updateInternalCollections = function (entity, type, context) {\r\n        var entityAsAny = entity;\r\n        // #deleteme TODO: refactor - currently we apply some rules for each type\r\n        var isActivityDestroy = (type === entityEvent_1.EntityEventType.StatusChange &&\r\n            entityAsAny.status &&\r\n            entityAsAny.status.state === entityEvent_2.ActivityState.Destroyed) ||\r\n            (type === entityEvent_1.EntityEventType.StatusChange &&\r\n                context &&\r\n                context.newStatus &&\r\n                context.newStatus.state === entityEvent_2.ActivityState.Destroyed);\r\n        // #deleteme TODO: verify this stuff\r\n        // windows have two states - removed from activity and closed (TODO: this only works in GD 2.1 and later)\r\n        var isWindowClose = type === entityEvent_1.EntityEventType.Closed;\r\n        var isTypeRemove = type === entityEvent_1.EntityEventType.Removed && typeof entityAsAny.isIndependent === \"undefined\";\r\n        if (isTypeRemove || isWindowClose || isActivityDestroy) {\r\n            var oldEntity = this._items[entity.id];\r\n            delete this._items[entity.id];\r\n            // on remove return the input entity\r\n            this._processNew(entity);\r\n            if (oldEntity) {\r\n                entity._beforeDelete(oldEntity);\r\n            }\r\n            return entity;\r\n        }\r\n        else {\r\n            var key = entity.id;\r\n            // if new object add, otherwise clone object properties\r\n            if (!this._items.hasOwnProperty(key)) {\r\n                this._processNew(entity);\r\n                this._items[entity.id] = entity;\r\n            }\r\n            else {\r\n                this._items[entity.id]._update(entity);\r\n            }\r\n        }\r\n        return this._items[entity.id];\r\n    };\r\n    return EntityObservableCollection;\r\n}());\r\nexports.EntityObservableCollection = EntityObservableCollection;\r\n//# sourceMappingURL=entityObservableCollection.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/helpers/entityObservableCollection.js\n// module id = 47\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar activityModule_1 = require(\"./activityModule\");\r\nexports.ActivityModule = activityModule_1.ActivityModule;\r\n//# sourceMappingURL=main.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/activity/main.js\n// module id = 48\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar application_1 = require(\"./application\");\r\nvar callback_registry_1 = require(\"callback-registry\");\r\nvar instance_1 = require(\"./instance\");\r\nvar AppManagerImpl = /** @class */ (function () {\r\n    function AppManagerImpl(_agm, _activities, _windows, _logger, _gdMajorVersion) {\r\n        var _this = this;\r\n        this._agm = _agm;\r\n        this._activities = _activities;\r\n        this._windows = _windows;\r\n        this._logger = _logger;\r\n        this._gdMajorVersion = _gdMajorVersion;\r\n        this._apps = {};\r\n        this._instances = [];\r\n        this._registry = callback_registry_1.default();\r\n        this.application = function (name) {\r\n            return _this._apps[name];\r\n        };\r\n        this.applications = function () {\r\n            return Object.keys(_this._apps).map(function (k) { return _this._apps[k]; });\r\n        };\r\n        this.instances = function () {\r\n            return _this._instances;\r\n        };\r\n        this.getMyInstance = function () {\r\n            if (_this._gdMajorVersion >= 3) {\r\n                // GD3 check\r\n                var instanceId_1 = window.glue42gd.appInstanceId;\r\n                return _this._instances.filter(function (i) { return i.id === instanceId_1; })[0];\r\n            }\r\n            if (_this._gdMajorVersion === 2) {\r\n                var myWindowId_1 = window.htmlContainer.windowId;\r\n                var matchingInstances = _this._instances.filter(function (i) { return i.id === myWindowId_1; });\r\n                if (matchingInstances.length < 2) {\r\n                    return matchingInstances[0];\r\n                }\r\n                // If we have two matches - this can happen only when asking for the window\r\n                // of activity owner - so return the instance that is not activity instance\r\n                return matchingInstances.filter(function (i) { return !i.isActivityInstance; })[0];\r\n            }\r\n            return undefined;\r\n        };\r\n        this.handleAppAdded = function (props) {\r\n            var id = _this._getAppId(props);\r\n            _this._logger.trace(\"adding app \" + id);\r\n            _this._apps[id] = new application_1.default(_this, id, _this._agm);\r\n            var app = _this._updateAppFromProps(props);\r\n            _this._registry.execute(\"appAdded\", app);\r\n        };\r\n        this.handleAppUpdated = function (props) {\r\n            // TODO: check side effects, is this._apps updated?\r\n            var app = _this._updateAppFromProps(props);\r\n            _this._registry.execute(\"appChanged\", app);\r\n        };\r\n        this.handleAppRemoved = function (props) {\r\n            var id = _this._getAppId(props);\r\n            _this._logger.trace(\"removing app \" + id);\r\n            var app = _this.application(id);\r\n            // remove all instances related to the app\r\n            _this._instances = _this._instances.filter(function (i) { return i.application.name !== app.name; });\r\n            delete _this._apps[id];\r\n            _this._registry.execute(\"appRemoved\", app);\r\n        };\r\n        this.handleAppReady = function (props) {\r\n            var id = _this._getAppId(props);\r\n            var app = _this._getAppOrThrow(id);\r\n            app.updateFromProps(props);\r\n            if (app.available) {\r\n                _this._registry.execute(\"appAvailable\", app);\r\n            }\r\n            else {\r\n                _this._registry.execute(\"appUnavailable\", app);\r\n            }\r\n        };\r\n        this.handleInstanceStarted = function (props) {\r\n            _this._logger.trace(\"started app \" + props.Name + \" \" + props.Id);\r\n            var id = _this._getInstanceId(props);\r\n            var app = _this.application(_this._getInstanceAppName(props));\r\n            var instance = new instance_1.default(id, app, _this, _this._agm, _this._activities, _this._windows);\r\n            _this._updateInstanceFromProps(instance, props);\r\n            _this._instances.push(instance);\r\n            _this._registry.execute(\"instanceStarted\", instance);\r\n        };\r\n        this.handleInstanceStopped = function (props) {\r\n            _this._logger.trace(\"failed to start app \" + props.Name + \" \" + props.Id);\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, appName);\r\n            _this._instances = _this._instances.filter(function (i) { return !_this._matchInstance(i, id, appName); });\r\n            _this._registry.execute(\"instanceStopped\", instance);\r\n            instance.done();\r\n        };\r\n        this.handleInstanceAgmServerReady = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var appName = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, appName);\r\n            instance.updateAgmInstanceFromProps(props);\r\n            _this._registry.execute(\"instanceAgmServerReady\", instance);\r\n        };\r\n        this.handleInstanceStartFailed = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var app = _this.application(_this._getInstanceAppName(props));\r\n            var startFailed = true;\r\n            var instance = new instance_1.default(id, app, undefined, undefined, undefined, undefined, startFailed);\r\n            _this._updateInstanceFromProps(instance, props);\r\n            _this._registry.execute(\"instanceStartFailed\", instance);\r\n        };\r\n        this.handleInstanceUpdated = function (props) {\r\n            var id = _this._getInstanceId(props);\r\n            var app = _this._getInstanceAppName(props);\r\n            var instance = _this._getInstanceOrThrow(id, app);\r\n            _this._updateInstanceFromProps(instance, props);\r\n        };\r\n        /** Event subscription methods */\r\n        this.onInstanceStarted = function (callback) {\r\n            _this._replay(_this._instances, callback);\r\n            return _this._registry.add(\"instanceStarted\", callback);\r\n        };\r\n        this.onInstanceStartFailed = function (callback) {\r\n            return _this._registry.add(\"instanceStartFailed\", callback);\r\n        };\r\n        this.onInstanceStopped = function (callback) {\r\n            return _this._registry.add(\"instanceStopped\", callback);\r\n        };\r\n        this.onInstanceUpdated = function (callback) {\r\n            return _this._registry.add(\"instanceChanged\", callback);\r\n        };\r\n        this.onInstanceAgmServerReady = function (callback) {\r\n            return _this._registry.add(\"instanceAgmServerReady\", callback);\r\n        };\r\n        this.onAppAdded = function (callback) {\r\n            _this._replay(_this._apps, callback);\r\n            return _this._registry.add(\"appAdded\", callback);\r\n        };\r\n        this.onAppRemoved = function (callback) {\r\n            return _this._registry.add(\"appRemoved\", callback);\r\n        };\r\n        this.onAppAvailable = function (callback) {\r\n            return _this._registry.add(\"appAvailable\", callback);\r\n        };\r\n        this.onAppUnavailable = function (callback) {\r\n            return _this._registry.add(\"appUnavailable\", callback);\r\n        };\r\n        this.onAppChanged = function (callback) {\r\n            return _this._registry.add(\"appChanged\", callback);\r\n        };\r\n        //\r\n    }\r\n    AppManagerImpl.prototype._getAppOrThrow = function (id) {\r\n        var result = this.application(id);\r\n        if (!result) {\r\n            throw Error(\"app with id \" + id + \" not found\");\r\n        }\r\n        return result;\r\n    };\r\n    AppManagerImpl.prototype._getAppId = function (props) {\r\n        return props.Name;\r\n    };\r\n    AppManagerImpl.prototype._matchInstance = function (instance, id, appName) {\r\n        return instance.id === id && instance.application.name === appName;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceByIdAndName = function (id, appName) {\r\n        var _this = this;\r\n        return this._instances.filter(function (i) { return _this._matchInstance(i, id, appName); })[0];\r\n    };\r\n    AppManagerImpl.prototype._getInstanceOrThrow = function (id, appName) {\r\n        var result = this._getInstanceByIdAndName(id, appName);\r\n        if (!result) {\r\n            throw Error(\"instance with id \" + id + \" not found\");\r\n        }\r\n        return result;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceId = function (props) {\r\n        return props.Id;\r\n    };\r\n    AppManagerImpl.prototype._getInstanceAppName = function (props) {\r\n        return props.Name;\r\n    };\r\n    AppManagerImpl.prototype._updateAppFromProps = function (props) {\r\n        var id = this._getAppId(props);\r\n        this._logger.trace(\"updating app with  + \" + id + \", \" + props);\r\n        var app = this._getAppOrThrow(id);\r\n        app.updateFromProps(props);\r\n        return app;\r\n    };\r\n    AppManagerImpl.prototype._updateInstanceFromProps = function (instance, props) {\r\n        this._logger.trace(\"updating instance with \" + this._getInstanceId(props) + \" for app \" + this._getInstanceAppName(props));\r\n        instance.updateFromProps(props);\r\n    };\r\n    AppManagerImpl.prototype._replay = function (itemsToReplay, callback) {\r\n        if (itemsToReplay) {\r\n            // if not array transform to array using Object.values\r\n            if (Array.isArray(itemsToReplay)) {\r\n                itemsToReplay.forEach(function (item) { return callback(item); });\r\n            }\r\n            else {\r\n                var itemsToReplayArr = Object.keys(itemsToReplay).map(function (key) { return itemsToReplay[key]; });\r\n                itemsToReplayArr.forEach(function (item) { return callback(item); });\r\n            }\r\n        }\r\n    };\r\n    return AppManagerImpl;\r\n}());\r\nexports.default = AppManagerImpl;\r\n//# sourceMappingURL=app-manager.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/app-manager/app-manager.js\n// module id = 49\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgmNames = require(\"./const/agm-names\");\r\nvar callback_registry_1 = require(\"callback-registry\");\r\nvar helper_1 = require(\"./helper\");\r\nvar ApplicationImpl = /** @class */ (function () {\r\n    function ApplicationImpl(_appManager, _name, _agm) {\r\n        // TODO: Replace string events with constants. The string declaration of the registry event name should only ever appear once. Ever. Period.\r\n        var _this = this;\r\n        this._appManager = _appManager;\r\n        this._name = _name;\r\n        this._agm = _agm;\r\n        this._registry = callback_registry_1.default();\r\n        // subscribe for events from app-manager\r\n        _appManager.onInstanceStarted(function (instance) {\r\n            if (instance.application.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"instanceStarted\", instance);\r\n        });\r\n        _appManager.onInstanceStopped(function (instance) {\r\n            if (instance.application.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"instanceStopped\", instance);\r\n        });\r\n        _appManager.onAppRemoved(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appRemoved\", app);\r\n        });\r\n        _appManager.onAppChanged(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appChanged\", app);\r\n        });\r\n        _appManager.onAppAvailable(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appAvailable\", app);\r\n        });\r\n        _appManager.onAppUnavailable(function (app) {\r\n            if (app.name !== _this._name) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"appUnavailable\", app);\r\n        });\r\n    }\r\n    Object.defineProperty(ApplicationImpl.prototype, \"name\", {\r\n        get: function () { return this._name; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"title\", {\r\n        get: function () { return this._props.Title; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"version\", {\r\n        get: function () { return this._props.Version; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"autoStart\", {\r\n        get: function () { return this._props.AutoStart; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"isShell\", {\r\n        get: function () { return this._props.IsShell; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"caption\", {\r\n        get: function () { return this._props.Caption; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"hidden\", {\r\n        get: function () { return this._props.IsHidden; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"container\", {\r\n        get: function () { return this._props.ApplicationName; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"activityType\", {\r\n        get: function () { return this._props.ActivityType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"activityWindowType\", {\r\n        get: function () { return this._props.ActivityWindowType; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"windowSettings\", {\r\n        get: function () {\r\n            if (!this._props.Arguments) {\r\n                return {};\r\n            }\r\n            return helper_1.objectClone(this._props.Arguments);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"allowMultiple\", {\r\n        get: function () { return this._props.AllowMultiple; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"available\", {\r\n        get: function () { return this._props.IsReady || false; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"icon\", {\r\n        get: function () { return this._props.Icon; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"iconURL\", {\r\n        get: function () { return this._props.IconUrl; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"sortOrder\", {\r\n        get: function () { return this._props.SortOrder; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"userProperties\", {\r\n        get: function () {\r\n            if (!this._props.UserProperties) {\r\n                return {};\r\n            }\r\n            return helper_1.objectClone(this._props.UserProperties);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"isActivity\", {\r\n        get: function () {\r\n            return this._props.ActivityType !== undefined && this._props.ActivityType !== \"\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"configuration\", {\r\n        get: function () {\r\n            return {\r\n                autoStart: this._props.AutoStart,\r\n                caption: this._props.Caption,\r\n                hidden: this._props.IsHidden,\r\n                container: this._props.ApplicationName,\r\n                activityType: this._props.ActivityType,\r\n                allowMultiple: this._props.AllowMultiple\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"instances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances().filter(function (instance) { return instance.application.name === _this._name; });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"type\", {\r\n        get: function () {\r\n            return this._props.Type;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(ApplicationImpl.prototype, \"mode\", {\r\n        get: function () {\r\n            if (!this._props) {\r\n                // no info about the app\r\n                return \"unknown\";\r\n            }\r\n            // GD3 - we always have Mode from the stream object\r\n            if (this._props.Mode && typeof this._props.Mode === \"string\") {\r\n                return this._props.Mode.toLowerCase();\r\n            }\r\n            // GD2\r\n            // return unknown for activity applications\r\n            if (this.isActivity) {\r\n                return \"unknown\";\r\n            }\r\n            // check definition -> hc.args.mode\r\n            if (this._props.Arguments && this._props.Arguments.mode && typeof this._props.Arguments.mode === \"string\") {\r\n                return this._props.Arguments.mode.toLowerCase();\r\n            }\r\n            // if no hc.args.mode, check hc.WindowStyleAttributes\r\n            var styleAttributes = this._props.WindowStyleAttributes;\r\n            if (styleAttributes) {\r\n                // WindowStyleAttributes is not a valid JSON, we will need to find mode in the string\r\n                styleAttributes = styleAttributes.split(\" \").join(\"\");\r\n                var searchFor = \"mode:\\\"\";\r\n                var modeIndex = styleAttributes.indexOf(searchFor);\r\n                if (modeIndex !== -1) {\r\n                    var startModeIndex = modeIndex + searchFor.length;\r\n                    var stopModeIndex = styleAttributes.indexOf(\"\\\"\", startModeIndex);\r\n                    var style = styleAttributes.substr(startModeIndex, stopModeIndex - startModeIndex);\r\n                    if (style && typeof style === \"string\") {\r\n                        return style.toLowerCase();\r\n                    }\r\n                }\r\n            }\r\n            // default mode for GD2\r\n            return \"flat\";\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    ApplicationImpl.prototype.updateFromProps = function (props) {\r\n        var _this = this;\r\n        if (!this._props) {\r\n            this._props = { Name: props.Name };\r\n        }\r\n        Object.keys(props).forEach(function (key) {\r\n            _this._props[key] = props[key];\r\n        });\r\n    };\r\n    ApplicationImpl.prototype.start = function (context, options) {\r\n        var _this = this;\r\n        var name = this._name;\r\n        var startTimeout = 10000;\r\n        return new Promise(function (resolve, reject) {\r\n            options = options || {};\r\n            context = context || {};\r\n            context._t42 = { createWindowArgs: options };\r\n            if (typeof options.waitForAGMReady === \"undefined\") {\r\n                options.waitForAGMReady = true;\r\n            }\r\n            var waitForAGMInstance = options.waitForAGMReady;\r\n            var waitForInstance = !options.waitForAGMReady;\r\n            var waitForApplicationInstance = function (id) {\r\n                // fetch from the current list in app-manager\r\n                var check = function () {\r\n                    var filtered = _this._appManager.instances().filter(function (i) { return i.id === id; });\r\n                    var result;\r\n                    if (filtered.length === 2) {\r\n                        result = filtered[0].isActivityInstance ? filtered[0] : filtered[1];\r\n                    }\r\n                    result = filtered[0];\r\n                    if (result && waitForAGMInstance) {\r\n                        if (result.agm) {\r\n                            return result;\r\n                        }\r\n                        else {\r\n                            return undefined;\r\n                        }\r\n                    }\r\n                    return result;\r\n                };\r\n                var unsub;\r\n                // reject after some timeout\r\n                setTimeout(function () {\r\n                    if (unsub) {\r\n                        unsub();\r\n                        reject(\"timeout\");\r\n                    }\r\n                }, startTimeout);\r\n                var waitFunc = function (i) {\r\n                    if (i.id !== id) {\r\n                        return;\r\n                    }\r\n                    if (unsub) {\r\n                        unsub();\r\n                        unsub = undefined;\r\n                    }\r\n                    // schedule - we need this because there might be more than one\r\n                    // instance with the same id (activity case) - so this handler\r\n                    // will kick for the very first\r\n                    setTimeout(function () {\r\n                        resolve(check());\r\n                    }, 1);\r\n                };\r\n                if (waitForAGMInstance) {\r\n                    unsub = _this._appManager.onInstanceAgmServerReady(waitFunc);\r\n                }\r\n                else {\r\n                    // if not there subscribe for instance events\r\n                    unsub = _this._appManager.onInstanceStarted(waitFunc);\r\n                }\r\n                // try to find it in the current list\r\n                var instances = check();\r\n                if (instances) {\r\n                    unsub = undefined;\r\n                    resolve(instances);\r\n                }\r\n            };\r\n            _this._agm.invoke(AgmNames.StartApplicationMethodName, {\r\n                Name: name,\r\n                Context: context,\r\n                WaitForAgmInstance: waitForAGMInstance,\r\n                WaitForInstance: waitForInstance\r\n            }, \"best\", {\r\n                methodResponseTimeoutMs: startTimeout\r\n            }, function (result) {\r\n                var acsResult = result.returned.Instance_0 || result.returned;\r\n                if (acsResult && acsResult.Id) {\r\n                    // we received instance from ACS, let's wait until it appears on the stream\r\n                    waitForApplicationInstance(acsResult.Id);\r\n                }\r\n                else {\r\n                    // we haven't received instance from ACS - this might happen if the app does not\r\n                    // support tracking instances (e.g. we start internet explorer with some url)\r\n                    resolve(undefined);\r\n                }\r\n            }, function (err) {\r\n                reject(err);\r\n            });\r\n        });\r\n    };\r\n    ApplicationImpl.prototype.onInstanceStarted = function (callback) {\r\n        this._registry.add(\"instanceStarted\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onInstanceStopped = function (callback) {\r\n        this._registry.add(\"instanceStopped\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onAvailable = function (callback) {\r\n        this._registry.add(\"appAvailable\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onUnavailable = function (callback) {\r\n        this._registry.add(\"appUnavailable\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onChanged = function (callback) {\r\n        this._registry.add(\"appChanged\", callback);\r\n    };\r\n    ApplicationImpl.prototype.onRemoved = function (callback) {\r\n        this._registry.add(\"appRemoved\", callback);\r\n    };\r\n    return ApplicationImpl;\r\n}());\r\nexports.default = ApplicationImpl;\r\n//# sourceMappingURL=application.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/app-manager/application.js\n// module id = 50\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.OnNotificationEvent = \"OnNotification\";\r\nexports.OnBranchChangedEvent = \"OnBranchChanged\";\r\nexports.OnBranchesModifiedEvent = \"OnBranchesModified\";\r\nexports.OnApplicationAddedEvent = \"OnApplicationAdded\";\r\nexports.OnApplicationRemovedEvent = \"OnApplicationRemoved\";\r\nexports.OnApplicationChangedEvent = \"OnApplicationChanged\";\r\nexports.OnApplicationReadyEvent = \"OnApplicationReady\";\r\nexports.OnApplicationStartedEvent = \"OnApplicationStarted\";\r\nexports.OnApplicationRegisteredEvent = \"OnApplicationRegistered\";\r\nexports.OnApplicationAgmServerReadyEvent = \"OnApplicationAgmServerReady\";\r\nexports.OnApplicationUpdatedEvent = \"OnApplicationUpdated\";\r\nexports.OnApplicationStoppedEvent = \"OnApplicationStopped\";\r\nexports.OnApplicationStartFailedEvent = \"OnApplicationStartFailed\";\r\n//# sourceMappingURL=event-names.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/app-manager/const/event-names.js\n// module id = 51\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgmNames = require(\"./const/agm-names\");\r\nvar EventNames = require(\"./const/event-names\");\r\nvar helper_1 = require(\"./helper\");\r\n/** Subscribe for the AGM stream published by ACS and distributes events to applications and instances components */\r\nfunction createDataSubscription(agm, applications, entitlements, skipIcons) {\r\n    var subscription;\r\n    var start = function () {\r\n        var resolveFunc;\r\n        var rejectFunc;\r\n        var resultPromise = new Promise(function (resolve, reject) {\r\n            resolveFunc = resolve;\r\n            rejectFunc = reject;\r\n        });\r\n        agm.subscribe(AgmNames.OnEventMethodName, { arguments: { skipIcon: skipIcons }, waitTimeoutMs: 10000 })\r\n            .then(function (s) {\r\n            subscription = s;\r\n            subscription.onData(function (streamData) {\r\n                var events = streamData.data;\r\n                helper_1.objectValues(events[EventNames.OnApplicationAddedEvent])\r\n                    .map(function (item) { return applications.handleAppAdded(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationChangedEvent])\r\n                    .map(function (item) { return applications.handleAppUpdated(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationRemovedEvent])\r\n                    .map(function (item) { return applications.handleAppRemoved(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationReadyEvent])\r\n                    .map(function (item) { return applications.handleAppReady(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationStartedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStarted(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationStartFailedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStartFailed(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationStoppedEvent])\r\n                    .map(function (item) { return applications.handleInstanceStopped(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationUpdatedEvent])\r\n                    .map(function (item) { return applications.handleInstanceUpdated(item); });\r\n                helper_1.objectValues(events[EventNames.OnApplicationAgmServerReadyEvent])\r\n                    .map(function (item) { return applications.handleInstanceAgmServerReady(item); });\r\n                helper_1.objectValues(events[EventNames.OnBranchChangedEvent])\r\n                    .map(function (item) { return entitlements.handleBranchModified(item); });\r\n                helper_1.objectValues(events[EventNames.OnBranchesModifiedEvent])\r\n                    .map(function (item) { return entitlements.handleBranchesModified(item); });\r\n                resolveFunc();\r\n            });\r\n            subscription.onFailed(function (err) { return rejectFunc(err); });\r\n        })\r\n            .catch(function (err) { return rejectFunc(\"Error subscribing for \" + AgmNames.OnEventMethodName + \" stream. Err: \" + err); });\r\n        return resultPromise;\r\n    };\r\n    var stop = function () {\r\n        if (subscription) {\r\n            subscription.close();\r\n        }\r\n    };\r\n    return {\r\n        start: start,\r\n        stop: stop\r\n    };\r\n}\r\nexports.default = createDataSubscription;\r\n//# sourceMappingURL=data-subscription.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/app-manager/data-subscription.js\n// module id = 52\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgmNames = require(\"./const/agm-names\");\r\nvar callback_registry_1 = require(\"callback-registry\");\r\nvar promisify = require(\"tick42-promisify\");\r\nvar EntitlementsImpl = /** @class */ (function () {\r\n    function EntitlementsImpl(_agm) {\r\n        var _this = this;\r\n        this._agm = _agm;\r\n        this._registry = callback_registry_1.default();\r\n        this.handleBranchModified = function (branch) {\r\n            _this._registry.execute(\"branchChanged\", branch);\r\n        };\r\n        this.handleBranchesModified = function (branches) {\r\n            _this._registry.execute(\"branchesChanged\", branches);\r\n        };\r\n        this.getRegion = function (success, error) {\r\n            return promisify(_this._agmInvoke(AgmNames.GetConfigurationRegionMethodName, function (e) { return e.returned.Region; }), success, error);\r\n        };\r\n        this.getBranches = function (success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.GetBranchesMethodName, function (e) {\r\n                var obj = e.returned.Branches;\r\n                return Object.keys(obj).map(function (key) { return obj[key]; });\r\n            });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.getCurrentBranch = function (success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.GetCurrentBranchMethodName, function (e) { return e.returned.Branch; }, undefined);\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.setRegion = function (region, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.SetConfigurationRegionMethodName, function (e) { return e.returned.ResultMessage; }, { Region: region });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.setCurrentBranch = function (branch, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.SetCurrentBranchMethodName, function (e) { return e.returned.ResultMessage; }, { Branch: branch });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.currentUser = function (success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.GetUserMethodName);\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.getFunctionalEntitlement = function (funct, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.GetFunctionalEntitlementMethodName, function (e) { return e.returned.Entitlement; }, { Function: funct });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.getFunctionalEntitlementBranch = function (funct, branch, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.GetFunctionalEntitlementMethodName, function (e) { return e.returned.Entitlement; }, { Function: funct, Branch: branch });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.canI = function (func, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.CanIMethodName, function (e) { return e.returned.Result; }, { Function: func });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.canIBranch = function (func, branch, success, error) {\r\n            var promise = _this._agmInvoke(AgmNames.CanIMethodName, function (e) { return e.returned.Result; }, { Function: func, Branch: branch });\r\n            return promisify(promise, success, error);\r\n        };\r\n        this.onBranchesChanged = function (callback) {\r\n            _this._registry.add(\"branchesChanged\", callback);\r\n        };\r\n        this.onBranchChanged = function (callback) {\r\n            _this._registry.add(\"branchChanged\", callback);\r\n        };\r\n        this.exit = function (options) {\r\n            return _this._agmInvoke(AgmNames.ShutdownMethodName, null, options);\r\n        };\r\n        this._agmInvoke = function (method, transformFunction, args) {\r\n            args = args || {};\r\n            return new Promise(function (resolve, reject) {\r\n                var errHandler = function (error) { return reject(error); };\r\n                _this._agm.invoke(method, args)\r\n                    .then(function (result) {\r\n                    if (!transformFunction) {\r\n                        transformFunction = function (d) { return d.returned; };\r\n                    }\r\n                    resolve(transformFunction(result));\r\n                })\r\n                    .catch(errHandler);\r\n            });\r\n        };\r\n        //\r\n    }\r\n    return EntitlementsImpl;\r\n}());\r\nexports.default = EntitlementsImpl;\r\n//# sourceMappingURL=entitlements.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/app-manager/entitlements.js\n// module id = 53\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgmNames = require(\"./const/agm-names\");\r\nvar callback_registry_1 = require(\"callback-registry\");\r\nvar InstanceImpl = /** @class */ (function () {\r\n    function InstanceImpl(_id, _app, _appManager, _agm, _activities, _windows, startFailed) {\r\n        var _this = this;\r\n        this._id = _id;\r\n        this._app = _app;\r\n        this._appManager = _appManager;\r\n        this._agm = _agm;\r\n        this._activities = _activities;\r\n        this._windows = _windows;\r\n        this.onAgmReady = this._addToRegistry(\"agmReady\");\r\n        this.onStopped = this._addToRegistry(\"stopped\");\r\n        this._registry = callback_registry_1.default();\r\n        if (startFailed) {\r\n            return;\r\n        }\r\n        this._unsubscribeInstanceStopped = this._appManager.onInstanceStopped(function (instance) {\r\n            if (instance.id !== _this._id) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"stopped\", instance);\r\n        });\r\n        this._unsubscribeInstanceAgmServerReady = this._appManager.onInstanceAgmServerReady(function (instance) {\r\n            if (instance.id !== _this._id) {\r\n                return;\r\n            }\r\n            _this._registry.execute(\"agmReady\", instance);\r\n        });\r\n    }\r\n    Object.defineProperty(InstanceImpl.prototype, \"id\", {\r\n        get: function () { return this._id; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"application\", {\r\n        get: function () { return this._app; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activity\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (!this._activities) {\r\n                throw new Error(\"This method requires glue.activities library to be enabled.\");\r\n            }\r\n            return this._activities.all.instances.get()\r\n                .filter(function (activityInstance) { return activityInstance.id === _this._activityId; })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityInstances\", {\r\n        get: function () {\r\n            var _this = this;\r\n            return this._appManager.instances()\r\n                .filter(function (i) { return i.context && (i.context.activityId === _this._activityId); });\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityOwnerInstance\", {\r\n        get: function () {\r\n            return this._appManager.instances()\r\n                .filter(function (instance) {\r\n                if (instance.window && instance.window.context) {\r\n                    var instWinCntx = instance.window.context;\r\n                    if (instWinCntx._t42 && instWinCntx._t42.activityIsOwner) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            })[0];\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"window\", {\r\n        get: function () {\r\n            var _this = this;\r\n            if (!this._windows) {\r\n                throw new Error(\"This method requires glue.windows library to be enabled.\");\r\n            }\r\n            var win = this._windows.list().filter(function (w) { return w.id === _this._id; })[0];\r\n            if (!win && this.activity && this.activityOwnerInstance) {\r\n                // This is covering GD3 activity instance\r\n                win = this.activityOwnerInstance.window;\r\n            }\r\n            return win;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"context\", {\r\n        get: function () { return this._startUpContext; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"title\", {\r\n        get: function () { return this._title; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isActivityInstance\", {\r\n        get: function () { return this._isActivityInstance; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"activityId\", {\r\n        get: function () { return this._activityId; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"inActivity\", {\r\n        get: function () { return this._inActivity; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"isSingleWindowApp\", {\r\n        get: function () { return !this._inActivity; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(InstanceImpl.prototype, \"agm\", {\r\n        get: function () {\r\n            return this._agmInstance;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    InstanceImpl.prototype.updateFromProps = function (props) {\r\n        this._startUpContext = props.Context;\r\n        this._title = props.Title;\r\n        this._isActivityInstance = false;\r\n        if (props.ActivityId && props.ActivityId !== \"\") {\r\n            this._activityId = props.ActivityId;\r\n            this._isActivityInstance = true;\r\n        }\r\n        if (!this._activityId && this._startUpContext && this._startUpContext.activityId) {\r\n            this._activityId = this._startUpContext.activityId;\r\n        }\r\n        this._inActivity = Boolean(this._activityId);\r\n        this.updateAgmInstanceFromProps(props);\r\n    };\r\n    InstanceImpl.prototype.updateAgmInstanceFromProps = function (props) {\r\n        if (!props.AgmServers) {\r\n            return;\r\n        }\r\n        if (props.GD3) {\r\n            var agmInstances = props.AgmServers;\r\n            if (agmInstances) {\r\n                this._agmInstance = agmInstances[0];\r\n            }\r\n        }\r\n        else {\r\n            var gdAgmServers = props.AgmServers;\r\n            var propsAgmServer = Object.keys(gdAgmServers)[0];\r\n            if (!propsAgmServer) {\r\n                return;\r\n            }\r\n            var propsAgm = gdAgmServers[propsAgmServer];\r\n            this._agmInstance = {\r\n                machine: propsAgm.machineName,\r\n                user: propsAgm.userName,\r\n                environment: propsAgm.environment,\r\n                application: propsAgm.applicationName,\r\n            };\r\n        }\r\n    };\r\n    InstanceImpl.prototype.stop = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var unsubscribe = _this._appManager.onInstanceStopped(function (instance) {\r\n                if (instance.id === _this._id) {\r\n                    unsubscribe();\r\n                    resolve();\r\n                }\r\n            });\r\n            _this._agm.invoke(AgmNames.StopApplicationMethodName, {\r\n                Name: _this._app.name,\r\n                Id: _this._id\r\n            })\r\n                .catch(function (err) { return reject(err); });\r\n        });\r\n    };\r\n    InstanceImpl.prototype.activate = function () {\r\n        return this._agm.invoke(AgmNames.ActivateApplicationMethodName, { Name: this._app.name, Id: this._id });\r\n    };\r\n    InstanceImpl.prototype.done = function () {\r\n        // remove all handlers\r\n        this._registry.clear();\r\n        // remove subscriptions\r\n        this._unsubscribeInstanceAgmServerReady();\r\n        this._unsubscribeInstanceStopped();\r\n    };\r\n    InstanceImpl.prototype._addToRegistry = function (key) {\r\n        var _this = this;\r\n        return function (callback) {\r\n            _this._registry.add(key, callback);\r\n        };\r\n    };\r\n    return InstanceImpl;\r\n}());\r\nexports.default = InstanceImpl;\r\n//# sourceMappingURL=instance.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/app-manager/instance.js\n// module id = 54\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar app_manager_1 = require(\"./app-manager\");\r\nvar entitlements_1 = require(\"./entitlements\");\r\nvar snapshot_1 = require(\"./snapshot\");\r\nvar data_subscription_1 = require(\"./data-subscription\");\r\nexports.default = (function (config) {\r\n    if (!config) {\r\n        throw Error(\"config not set\");\r\n    }\r\n    if (!config.agm) {\r\n        throw Error(\"config.agm is missing\");\r\n    }\r\n    var START_ONLY = \"startOnly\";\r\n    var SKIP_ICONS = \"skipIcons\";\r\n    var FULL = \"full\";\r\n    var mode = config.mode || START_ONLY;\r\n    if (mode !== START_ONLY && mode !== SKIP_ICONS && mode !== FULL) {\r\n        throw new Error(\"Invalid mode for appManager lib - \" + mode + \" is not supported\");\r\n    }\r\n    var activities = config.activities;\r\n    var agm = config.agm;\r\n    var logger = config.logger;\r\n    var windows = config.windows;\r\n    var appManager = new app_manager_1.default(agm, activities, windows, logger.subLogger(\"applications\"), config.gdMajorVersion);\r\n    var entitlements = new entitlements_1.default(agm);\r\n    var readyPromise;\r\n    if (mode === START_ONLY) {\r\n        readyPromise = snapshot_1.default(agm, appManager);\r\n    }\r\n    else {\r\n        var subscription = data_subscription_1.default(agm, appManager, entitlements, mode === SKIP_ICONS);\r\n        readyPromise = subscription.start();\r\n    }\r\n    var api = {\r\n        ready: function () { return readyPromise; },\r\n        applications: appManager.applications,\r\n        application: appManager.application,\r\n        onAppAdded: appManager.onAppAdded,\r\n        onAppRemoved: appManager.onAppRemoved,\r\n        onAppChanged: appManager.onAppChanged,\r\n        onAppAvailable: appManager.onAppAvailable,\r\n        onAppUnavailable: appManager.onAppUnavailable,\r\n        instances: appManager.instances,\r\n        get myInstance() {\r\n            return appManager.getMyInstance();\r\n        },\r\n        onInstanceStarted: appManager.onInstanceStarted,\r\n        onInstanceStopped: appManager.onInstanceStopped,\r\n        onInstanceUpdated: appManager.onInstanceUpdated,\r\n        onInstanceStartFailed: appManager.onInstanceStartFailed,\r\n        getRegion: entitlements.getRegion,\r\n        getBranches: entitlements.getBranches,\r\n        getCurrentBranch: entitlements.getCurrentBranch,\r\n        getFunctionalEntitlement: entitlements.getFunctionalEntitlement,\r\n        getFunctionalEntitlementBranch: entitlements.getFunctionalEntitlementBranch,\r\n        setCurrentBranch: entitlements.setCurrentBranch,\r\n        setRegion: entitlements.setRegion,\r\n        currentUser: entitlements.currentUser,\r\n        canI: entitlements.canI,\r\n        canIBranch: entitlements.canIBranch,\r\n        onBranchesChanged: entitlements.onBranchesChanged,\r\n        exit: entitlements.exit\r\n    };\r\n    return api;\r\n});\r\n//# sourceMappingURL=main.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/app-manager/main.js\n// module id = 55\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar AgmNames = require(\"./const/agm-names\");\r\nvar helper_1 = require(\"./helper\");\r\n/** Retrieves application snapshot from ACS */\r\nfunction snapshot(agm, appManager) {\r\n    return new Promise(function (resolve, reject) {\r\n        agm.invoke(AgmNames.GetApplicationsMethodName, { skipIcon: true })\r\n            .then(function (response) {\r\n            var data = response.returned;\r\n            if (!data) {\r\n                resolve();\r\n            }\r\n            var applications = data.applications;\r\n            if (!applications) {\r\n                resolve();\r\n            }\r\n            helper_1.objectValues(applications).map(function (item) { return appManager.handleAppAdded(item); });\r\n            resolve();\r\n        })\r\n            .catch(function (err) { return reject(\"Error getting application snapshot: \" + err.message); });\r\n    });\r\n}\r\nexports.default = snapshot;\r\n//# sourceMappingURL=snapshot.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/app-manager/snapshot.js\n// module id = 56\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction setupAGM(agm, channels) {\r\n    var windowId;\r\n    if (typeof window !== \"undefined\") {\r\n        if (window.htmlContainer) {\r\n            windowId = window.htmlContainer.windowId;\r\n        }\r\n        else if (window.glue42gd) {\r\n            windowId = window.glue42gd.windowId;\r\n        }\r\n    }\r\n    if (!windowId) {\r\n        // not supported\r\n        return;\r\n    }\r\n    // agm interface is available for SW windows only\r\n    agm.invoke(\"T42.Channels.Announce\", { swId: windowId, instance: agm.instance.instance });\r\n    agm.register(\"T42.Channels.Command\", function (args) {\r\n        var command = args.command;\r\n        if (!command) {\r\n            throw new Error(\"missing command argument\");\r\n        }\r\n        if (command === \"join\") {\r\n            var id = args.channel;\r\n            if (!id) {\r\n                throw new Error(\"missing argument id\");\r\n            }\r\n            channels.join(id);\r\n            return;\r\n        }\r\n        if (command === \"leave\") {\r\n            channels.leave();\r\n            return;\r\n        }\r\n        if (command === \"get\") {\r\n            var id = channels.current();\r\n            return { id: id };\r\n        }\r\n        throw new Error(\"unknown command \" + command);\r\n    });\r\n}\r\nexports.setupAGM = setupAGM;\r\n//# sourceMappingURL=agm.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/channels/agm.js\n// module id = 57\n// module chunks = 0","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = require(\"callback-registry\");\r\nvar ChannelsImpl = /** @class */ (function () {\r\n    function ChannelsImpl(shared) {\r\n        this.shared = shared;\r\n        this.subsKey = \"subs\";\r\n        this.changedKey = \"changed\";\r\n        this.registry = callback_registry_1.default();\r\n        this.shared.subscribe(this.handler.bind(this));\r\n    }\r\n    ChannelsImpl.prototype.current = function () {\r\n        return this.currentContext;\r\n    };\r\n    ChannelsImpl.prototype.subscribe = function (callback) {\r\n        return this.registry.add(this.subsKey, callback);\r\n    };\r\n    ChannelsImpl.prototype.publish = function (data) {\r\n        if (!this.currentContext) {\r\n            throw new Error(\"not joined to any channel\");\r\n        }\r\n        return this.shared.update(this.currentContext, { data: data });\r\n    };\r\n    ChannelsImpl.prototype.join = function (id) {\r\n        this.currentContext = id;\r\n        this.registry.execute(this.changedKey, id);\r\n        return this.shared.switchChannel(id);\r\n    };\r\n    ChannelsImpl.prototype.leave = function () {\r\n        this.currentContext = undefined;\r\n        this.registry.execute(this.changedKey, undefined);\r\n        return this.shared.unsubscribe();\r\n    };\r\n    ChannelsImpl.prototype.all = function () {\r\n        return this.shared.all();\r\n    };\r\n    ChannelsImpl.prototype.changed = function (callback) {\r\n        this.registry.add(this.changedKey, callback);\r\n    };\r\n    ChannelsImpl.prototype.meta = function (name, meta) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    ChannelsImpl.prototype.add = function (info) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var context;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!info) {\r\n                            throw new Error(\"info argument can not be undefined\");\r\n                        }\r\n                        if (!info.name) {\r\n                            throw new Error(\"info.name is missing\");\r\n                        }\r\n                        context = {\r\n                            name: info.name,\r\n                            meta: info.meta || {},\r\n                            data: info.data || {}\r\n                        };\r\n                        return [4 /*yield*/, this.shared.add(info.name, context)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/, context];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    ChannelsImpl.prototype.remove = function (id) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    ChannelsImpl.prototype.onChannelAdded = function (cb) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    ChannelsImpl.prototype.onChannelRemoved = function (cb) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    ChannelsImpl.prototype.apps = function (channelId) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    ChannelsImpl.prototype.handler = function (context) {\r\n        this.registry.execute(this.subsKey, context.data, context);\r\n    };\r\n    return ChannelsImpl;\r\n}());\r\nexports.ChannelsImpl = ChannelsImpl;\r\n//# sourceMappingURL=channels.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/channels/channels.js\n// module id = 58\n// module chunks = 0","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CONTEXT_PREFIX = \"___channel___\";\r\nvar SharedContextSubscriber = /** @class */ (function () {\r\n    function SharedContextSubscriber(contexts) {\r\n        this.contexts = contexts;\r\n        this.unsubscribeFunc = undefined;\r\n        this.current = undefined;\r\n    }\r\n    SharedContextSubscriber.prototype.subscribe = function (callback) {\r\n        this.callback = callback;\r\n    };\r\n    SharedContextSubscriber.prototype.switchChannel = function (name) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var sharedContextName, _a;\r\n            var _this = this;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        this.unsubscribe();\r\n                        this.current = name;\r\n                        sharedContextName = this.createContextName(name);\r\n                        _a = this;\r\n                        return [4 /*yield*/, this.contexts.subscribe(sharedContextName, function (data) {\r\n                                if (_this.callback) {\r\n                                    _this.callback(data);\r\n                                }\r\n                            })];\r\n                    case 1:\r\n                        _a.unsubscribeFunc = _b.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.unsubscribe = function () {\r\n        if (this.unsubscribeFunc) {\r\n            this.unsubscribeFunc();\r\n        }\r\n        return Promise.resolve();\r\n    };\r\n    SharedContextSubscriber.prototype.add = function (id, data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var name;\r\n            return __generator(this, function (_a) {\r\n                name = this.createContextName(id);\r\n                return [2 /*return*/, this.contexts.set(name, data)];\r\n            });\r\n        });\r\n    };\r\n    SharedContextSubscriber.prototype.all = function () {\r\n        var allContexts = this.contexts.all();\r\n        var channels = allContexts.filter(function (c) { return c.startsWith(CONTEXT_PREFIX); });\r\n        var ids = channels.map(function (c) { return c.substr(CONTEXT_PREFIX.length); });\r\n        return Promise.resolve(ids);\r\n    };\r\n    SharedContextSubscriber.prototype.update = function (id, data) {\r\n        var name = this.createContextName(id);\r\n        return this.contexts.update(name, data);\r\n    };\r\n    SharedContextSubscriber.prototype.createContextName = function (id) {\r\n        return CONTEXT_PREFIX + id;\r\n    };\r\n    return SharedContextSubscriber;\r\n}());\r\nexports.SharedContextSubscriber = SharedContextSubscriber;\r\n//# sourceMappingURL=contexts.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/channels/contexts.js\n// module id = 59\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar agm_1 = require(\"./agm\");\r\nvar contexts_1 = require(\"./contexts\");\r\nvar channels_1 = require(\"./channels\");\r\nfunction factory(contexts, agm) {\r\n    var sharedContexts = new contexts_1.SharedContextSubscriber(contexts);\r\n    var channels = new channels_1.ChannelsImpl(sharedContexts);\r\n    agm_1.setupAGM(agm, channels);\r\n    return {\r\n        subscribe: channels.subscribe.bind(channels),\r\n        publish: channels.publish.bind(channels),\r\n        all: channels.all.bind(channels),\r\n        current: channels.current.bind(channels),\r\n        join: channels.join.bind(channels),\r\n        leave: channels.leave.bind(channels),\r\n        add: channels.add.bind(channels),\r\n        changed: channels.changed.bind(channels),\r\n        ready: function () { return contexts.ready(); }\r\n    };\r\n}\r\nexports.factory = factory;\r\n//# sourceMappingURL=main.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/channels/main.js\n// module id = 60\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.default = (function (options) {\r\n    // Possible options per lib (this is InputLibConfig type)\r\n    // * false - library is disabled (e.g. config.appManager = false)\r\n    // * true - library is enabled in running in default mode (e.g config.appManager = true).\r\n    //          Exception is if default mode is false - in that case it runs default true mode.\r\n    // * string - start in some mode (e.g. config.appManager = \"full\")\r\n    // * object - allows further customization (e.g config.appManager = {mode: \"full\", someSetting: 42})\r\n    //\r\n    // Some libs support different running modes, some do not.\r\n    //\r\n    // Currently defaults are:\r\n    // appManager: disabled\r\n    // layouts: enabled in 'slim' mode\r\n    // activities: enabled in 'trackMyTypeAndInitiatedFromMe' mode\r\n    // windows: enabled (does not support modes)\r\n    //\r\n    // InputLibConfig is transformed to LibConfigObject\r\n    /**\r\n     * Transforms InputLibConfig (the config as specified from the user)\r\n     * to LibConfigObject(internal library configuration)\r\n     */\r\n    function getLibConfig(value, defaultMode, trueMode) {\r\n        // if value is false return undefined\r\n        if (typeof value === \"boolean\" && !value) {\r\n            return undefined;\r\n        }\r\n        // find the mode of the library\r\n        var mode = getModeAsString(value, defaultMode, trueMode);\r\n        // if object we will replace the mode because appManager = {mode: true, setting: 42}\r\n        // should be turned into appManager = {mode: 'slim', setting: 42}\r\n        if (typeof value === \"object\") {\r\n            value.mode = mode;\r\n            return value;\r\n        }\r\n        return {\r\n            mode: mode,\r\n        };\r\n    }\r\n    /**\r\n     * Finds the mode based for a given library\r\n     * 1. If object we call recursively using object.mode for value\r\n     * 1. If the user hasn't specified anything we use the hard coded defaults\r\n     * 3. If the value is false or it got defaulted to false, we return undefined\r\n     * 4. If the value is true we return trueMode or defaultMode (if trueMode is undefined)\r\n     */\r\n    function getModeAsString(value, defaultMode, trueMode) {\r\n        if (typeof value === \"object\") {\r\n            // 1. if object\r\n            return getModeAsString(value.mode, defaultMode, trueMode) + \"\";\r\n        }\r\n        else if (typeof value === \"undefined\") {\r\n            // 2. if the user does not pass anything\r\n            if (typeof defaultMode === \"boolean\" && !defaultMode) {\r\n                // 3. if gets defaulted to false, the library should be off\r\n                return undefined;\r\n            }\r\n            else {\r\n                return defaultMode + \"\";\r\n            }\r\n        }\r\n        else if (typeof value === \"boolean\") {\r\n            // 4. if the user passes true, use trueMode or defaultMode\r\n            if (value) {\r\n                // if the user passes true, use trueMode or defaultMode\r\n                return ((trueMode === undefined) ? defaultMode : trueMode) + \"\";\r\n            }\r\n            else {\r\n                // 3. if the user passes false, the library should be off\r\n                return undefined;\r\n            }\r\n        }\r\n        return value + \"\";\r\n    }\r\n    var appDefaultMode = false;\r\n    var appDefaultTrueMode = \"startOnly\";\r\n    var activitiesDefaultMode = \"trackMyTypeAndInitiatedFromMe\";\r\n    var layoutsDefaultMode = \"slim\";\r\n    return {\r\n        layouts: getLibConfig(options.layouts, layoutsDefaultMode),\r\n        activities: getLibConfig(options.activities, activitiesDefaultMode),\r\n        appManager: getLibConfig(options.appManager, appDefaultMode, appDefaultTrueMode),\r\n        windows: getLibConfig(options.windows, true),\r\n        channels: getLibConfig(options.channels || false, false)\r\n    };\r\n});\r\n//# sourceMappingURL=config.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/config.js\n// module id = 61\n// module chunks = 0","\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar callback_registry_1 = require(\"callback-registry\");\r\nvar CommandMethod = \"T42.Hotkeys.Command\";\r\nvar InvokeMethod = \"T42.Hotkeys.Invoke\";\r\nvar RegisterCommand = \"register\";\r\nvar UnregisterCommand = \"unregister\";\r\nvar UnregisterAllCommand = \"unregisterAll\";\r\nvar HotkeysImpl = /** @class */ (function () {\r\n    function HotkeysImpl(agm) {\r\n        this.agm = agm;\r\n        this.registry = callback_registry_1.default();\r\n        this.firstHotkey = true;\r\n        this.hotkeys = new Map();\r\n    }\r\n    HotkeysImpl.prototype.register = function (info, callback) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var hkToLower;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof info === \"undefined\") {\r\n                            throw new Error(\"Hotkey parameter missing\");\r\n                        }\r\n                        if (typeof info === \"string\") {\r\n                            info = {\r\n                                hotkey: info\r\n                            };\r\n                        }\r\n                        else {\r\n                            if (!info.hotkey) {\r\n                                throw new Error(\"Info's hotkey parameter missing\");\r\n                            }\r\n                            info = {\r\n                                hotkey: info.hotkey,\r\n                                description: info.description\r\n                            };\r\n                        }\r\n                        hkToLower = this.formatHotkey(info.hotkey);\r\n                        if (this.hotkeys.has(hkToLower)) {\r\n                            throw new Error(\"Shortcut for \" + hkToLower + \" already registered\");\r\n                        }\r\n                        if (!this.firstHotkey) return [3 /*break*/, 2];\r\n                        this.firstHotkey = false;\r\n                        return [4 /*yield*/, this.registerInvokeAGMMethod()];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        // store the callback\r\n                        this.registry.add(hkToLower, callback);\r\n                        // invoke GD method\r\n                        return [4 /*yield*/, this.agm.invoke(CommandMethod, { command: RegisterCommand, hotkey: hkToLower, description: info.description })];\r\n                    case 3:\r\n                        // invoke GD method\r\n                        _a.sent();\r\n                        this.hotkeys.set(hkToLower, info);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.unregister = function (hotkey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var hkToLower;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof hotkey === \"undefined\") {\r\n                            throw new Error(\"hotkey parameter missing\");\r\n                        }\r\n                        if (typeof hotkey !== \"string\") {\r\n                            throw new Error(\"hotkey parameter must be string\");\r\n                        }\r\n                        hkToLower = this.formatHotkey(hotkey);\r\n                        return [4 /*yield*/, this.agm.invoke(CommandMethod, { command: UnregisterCommand, hotkey: hkToLower })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.hotkeys.delete(hkToLower);\r\n                        this.registry.clearKey(hkToLower);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.unregisterAll = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.agm.invoke(CommandMethod, { command: UnregisterAllCommand })];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this.hotkeys.clear();\r\n                        this.registry.clear();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Whether this application has registered accelerator.\r\n     * @param hotkey\r\n     */\r\n    HotkeysImpl.prototype.isRegistered = function (hotkey) {\r\n        var hkToLower = this.formatHotkey(hotkey);\r\n        return this.hotkeys.has(hkToLower);\r\n    };\r\n    HotkeysImpl.prototype.registerInvokeAGMMethod = function () {\r\n        var _this = this;\r\n        this.agm.register(InvokeMethod, function (args) {\r\n            var hkToLower = args.key.toLowerCase();\r\n            var info = _this.hotkeys.get(hkToLower);\r\n            _this.registry.execute(hkToLower, info);\r\n        });\r\n    };\r\n    HotkeysImpl.prototype.formatHotkey = function (hotkey) {\r\n        if (hotkey) {\r\n            return hotkey.replace(/\\s/g, \"\").toLowerCase();\r\n        }\r\n    };\r\n    return HotkeysImpl;\r\n}());\r\nexports.HotkeysImpl = HotkeysImpl;\r\n//# sourceMappingURL=hotkeys.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/hotkeys/hotkeys.js\n// module id = 62\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar hotkeys_1 = require(\"./hotkeys\");\r\nfunction factory(agm) {\r\n    var hotkeys = new hotkeys_1.HotkeysImpl(agm);\r\n    return {\r\n        register: hotkeys.register.bind(hotkeys),\r\n        unregister: hotkeys.unregister.bind(hotkeys),\r\n        unregisterAll: hotkeys.unregisterAll.bind(hotkeys),\r\n        isRegistered: hotkeys.isRegistered.bind(hotkeys),\r\n        ready: function () { return Promise.resolve(); }\r\n    };\r\n}\r\nexports.factory = factory;\r\n//# sourceMappingURL=main.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/hotkeys/main.js\n// module id = 63\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar SaveContextMethodName = \"T42.HC.GetSaveContext\";\r\n/**\r\n * Logic for apps that want to provide custom context on save\r\n */\r\nvar ContextProvider = /** @class */ (function () {\r\n    function ContextProvider(agm, activitiesGetter, callbacks) {\r\n        this.agm = agm;\r\n        this.activitiesGetter = activitiesGetter;\r\n        this.callbacks = callbacks;\r\n        this.registeredRequestsMethods = false;\r\n    }\r\n    ContextProvider.prototype.onSaveRequested = function (callback) {\r\n        if (!this.registeredRequestsMethods) {\r\n            this.registerRequestMethods();\r\n            this.registeredRequestsMethods = true;\r\n        }\r\n        return this.callbacks.add(\"saveRequested\", callback);\r\n    };\r\n    ContextProvider.prototype.isActivityOwner = function () {\r\n        // fallback for GD2 - remove once the bellow code is tested\r\n        if (typeof htmlContainer !== \"undefined\") {\r\n            var context = htmlContainer.getContext();\r\n            return context && context._t42 && context._t42.activityIsOwner;\r\n        }\r\n        // check if we're the activity owners\r\n        var activities = this.activitiesGetter();\r\n        if (!activities) {\r\n            return false;\r\n        }\r\n        if (!activities.inActivity) {\r\n            return false;\r\n        }\r\n        var myWindow = activities.my.window;\r\n        var myActivity = activities.my.activity;\r\n        if (!myActivity && !myWindow) {\r\n            return false;\r\n        }\r\n        // TODO - fix activities typings\r\n        return myActivity.owner.id === myWindow.id;\r\n    };\r\n    ContextProvider.prototype.registerRequestMethods = function () {\r\n        var _this = this;\r\n        this.agm.register(SaveContextMethodName, function (args) {\r\n            var requestResult = _this.callbacks.execute(\"saveRequested\", args)[0];\r\n            if (!requestResult) {\r\n                return {};\r\n            }\r\n            requestResult.activityContext = requestResult.activityContext || {};\r\n            requestResult.windowContext = requestResult.windowContext || {};\r\n            // always include the window context\r\n            var result = { windowContext: requestResult.windowContext, activityContext: undefined };\r\n            // if we're the activity owner put the context too\r\n            if (_this.isActivityOwner()) {\r\n                result.activityContext = requestResult.activityContext;\r\n            }\r\n            return result;\r\n        });\r\n    };\r\n    return ContextProvider;\r\n}());\r\nexports.default = ContextProvider;\r\n//# sourceMappingURL=contextProvider.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/layouts/contextProvider.js\n// module id = 64\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar store_1 = require(\"./store\");\r\nvar shortid_1 = require(\"shortid\");\r\nvar contextProvider_1 = require(\"./contextProvider\");\r\nvar transform_1 = require(\"./transform\");\r\nvar layout_1 = require(\"./layout\");\r\nvar LayoutsAPIImpl = /** @class */ (function () {\r\n    function LayoutsAPIImpl(config, stream, callbacks) {\r\n        this.config = config;\r\n        this.stream = stream;\r\n        this.callbacks = callbacks;\r\n        this.appManager = config.appManager;\r\n        this.onEvent = stream.onEvent;\r\n        this.provider = new contextProvider_1.default(config.agm, config.activityGetter, callbacks);\r\n        stream.subscribe();\r\n    }\r\n    LayoutsAPIImpl.prototype.ready = function () {\r\n        if (this.config.mode === \"fullWaitSnapshot\") {\r\n            return this.stream.gotSnapshot;\r\n        }\r\n        return this.stream.ready;\r\n    };\r\n    LayoutsAPIImpl.prototype.save = function (layout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!layout.name) {\r\n                throw Error(\"layout.name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                layout.type = \"Global\";\r\n            }\r\n            if (layout.activityId) {\r\n                layout.type = \"Activity\";\r\n            }\r\n            if (typeof layout.ignoreHidden === \"undefined\") {\r\n                layout.ignoreHidden = true; // default to true\r\n            }\r\n            var layoutObject = {\r\n                name: layout.name,\r\n                actIds: [],\r\n                appIds: [],\r\n                type: layout.type,\r\n                context: layout.context,\r\n                metadata: layout.metadata || {},\r\n                options: { ignoreLayoutRestrictions: false },\r\n            };\r\n            if (layout.type === \"Activity\") {\r\n                var actId = layout.activityId;\r\n                if (!actId) {\r\n                    if (!_this.appManager.myInstance.inActivity) {\r\n                        throw new Error(\"Current application is not in activity. Can not save activity layout for it\");\r\n                    }\r\n                    actId = _this.appManager.myInstance.activityId;\r\n                }\r\n                layoutObject.actIds.push(actId);\r\n                layoutObject.options = { ignoreLayoutRestrictions: true };\r\n            }\r\n            else if (layout.type === \"Global\") {\r\n                var instances = _this.appManager.instances();\r\n                if (layout.ignoreHidden) {\r\n                    instances = instances.filter(function (i) { return _this.isVisibleWindow(i); });\r\n                }\r\n                if (layout.ignoreMyInstance && _this.appManager.myInstance) {\r\n                    instances = instances.filter(function (i) { return i.id !== _this.appManager.myInstance.id; });\r\n                }\r\n                instances.reduce(function (prev, current) {\r\n                    if (!current.id) {\r\n                        return prev;\r\n                    }\r\n                    if (current.inActivity) {\r\n                        var actId = current.activityId;\r\n                        if (prev.actIds.indexOf(actId) === -1) {\r\n                            prev.actIds.push(actId);\r\n                        }\r\n                    }\r\n                    else {\r\n                        prev.appIds.push(current.id);\r\n                    }\r\n                    return prev;\r\n                }, layoutObject);\r\n            }\r\n            else {\r\n                throw new Error(\"layout type \" + layout.type + \" not supported\");\r\n            }\r\n            _this.invokeMethodAndTrack(\"T42.ACS.SaveLayout\", layoutObject, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.restore = function (options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (typeof options === \"undefined\") {\r\n                throw Error(\"options argument is required\");\r\n            }\r\n            if (!options.name) {\r\n                throw Error(\"options.name argument is required\");\r\n            }\r\n            if (!options.type) {\r\n                options.type = \"Global\";\r\n            }\r\n            if (options.activityIdToJoin) {\r\n                options.type = \"Activity\";\r\n            }\r\n            if (typeof options.restoreActivityOwner === \"undefined\") {\r\n                options.restoreActivityOwner = false;\r\n            }\r\n            if (typeof options.ignoreActivityWindowTypes === \"undefined\") {\r\n                options.ignoreActivityWindowTypes = [];\r\n            }\r\n            if (typeof options.setActivityContext === \"undefined\") {\r\n                options.setActivityContext = true;\r\n            }\r\n            // if no closeOwnRunning we set closeRunningInstance to true; if\r\n            if (typeof options.closeRunningInstance === \"undefined\") {\r\n                if (options.type === \"Global\") {\r\n                    options.closeRunningInstance = true;\r\n                }\r\n                else if (options.type === \"Activity\") {\r\n                    // we don't close anything in case of activity layout type\r\n                    options.closeRunningInstance = false;\r\n                }\r\n            }\r\n            if (typeof options.reuseWindows === \"undefined\") {\r\n                options.reuseWindows = true;\r\n            }\r\n            options.context = options.context || {};\r\n            var t42 = {\r\n                restoreOptions: {\r\n                    activityToJoin: options.activityIdToJoin,\r\n                    setActivityContext: options.setActivityContext,\r\n                    ignoreActivityWindowTypes: options.ignoreActivityWindowTypes,\r\n                    restoreActivityOwner: options.restoreActivityOwner,\r\n                    closeOldWindows: true,\r\n                    reuseExistingWindows: options.reuseWindows\r\n                }\r\n            };\r\n            var arg = {\r\n                type: options.type,\r\n                name: options.name,\r\n                context: options.context,\r\n                toClose: [],\r\n                splash: options.splash\r\n            };\r\n            if (options.closeRunningInstance) {\r\n                arg.toClose = _this.getInstancesToClose(options);\r\n            }\r\n            if (options.timeout) {\r\n                arg.timeout = options.timeout;\r\n            }\r\n            arg.context._t42 = t42;\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RestoreLayout\", arg, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.remove = function (type, name) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            var msg = {\r\n                type: type,\r\n                name: name,\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RemoveLayout\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.list = function () {\r\n        this.verifyNotSlimMode();\r\n        return store_1.default.all;\r\n    };\r\n    LayoutsAPIImpl.prototype.import = function (layouts, mode) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            var msg = {\r\n                mode: mode || \"replace\",\r\n                layouts: layouts\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ImportLayouts\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.export = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var handleResult = function (result) {\r\n                var layouts = _this.getObjectValues(result.Layouts).map(function (t) { return new layout_1.default(transform_1.default(t)); });\r\n                resolve(layouts);\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.ExportLayouts\", {}, handleResult, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.rename = function (layout, newName) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.verifyNotSlimMode();\r\n            if (!layout) {\r\n                throw Error(\"layout argument is required\");\r\n            }\r\n            if (!layout.name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            var msg = { type: layout.type, oldName: layout.name, newName: newName };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.RenameLayout\", msg, resolve, reject);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.updateMetadata = function (layout) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!layout) {\r\n                throw Error(\"layout argument is required\");\r\n            }\r\n            if (!layout.name) {\r\n                throw Error(\"name argument is required\");\r\n            }\r\n            if (!layout.type) {\r\n                throw Error(\"type argument is required\");\r\n            }\r\n            if (!layout.metadata) {\r\n                throw Error(\"metadata argument is required\");\r\n            }\r\n            var layoutObject = {\r\n                name: name,\r\n                type: layout.type,\r\n                metadata: layout.metadata\r\n            };\r\n            _this.invokeMethodAndTrack(\"T42.ACS.UpdateMetadata\", layoutObject, resolve, reject, true);\r\n        });\r\n    };\r\n    LayoutsAPIImpl.prototype.onAdded = function (callback) {\r\n        var result = this.callbacks.add(\"added\", callback);\r\n        if (store_1.default.all.length > 0) {\r\n            store_1.default.all.forEach(function (layout) {\r\n                try {\r\n                    callback(layout);\r\n                }\r\n                catch (err) { /** */ }\r\n            });\r\n        }\r\n        return result;\r\n    };\r\n    LayoutsAPIImpl.prototype.onRemoved = function (callback) {\r\n        return this.callbacks.add(\"removed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onChanged = function (callback) {\r\n        return this.callbacks.add(\"changed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onRenamed = function (callback) {\r\n        return this.callbacks.add(\"renamed\", callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onEvent = function (callback) {\r\n        return this.stream.onEvent(callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.onSaveRequested = function (callback) {\r\n        return this.provider.onSaveRequested(callback);\r\n    };\r\n    LayoutsAPIImpl.prototype.filterInstance = function (ignoreHidden, ignoreMyInstance) {\r\n        var _this = this;\r\n        var instances = this.appManager.instances();\r\n        if (ignoreHidden) {\r\n            instances = instances.filter(function (i) { return _this.isVisibleWindow(i); });\r\n        }\r\n        if (ignoreMyInstance && this.appManager.myInstance) {\r\n            instances = instances.filter(function (i) { return i.id !== _this.appManager.myInstance.id; });\r\n        }\r\n        return instances.reduce(function (prev, current) {\r\n            if (!current.id) {\r\n                return prev;\r\n            }\r\n            if (current.inActivity) {\r\n                var actId = current.activityId;\r\n                if (prev.actIds.indexOf(actId) === -1) {\r\n                    prev.actIds.push(actId);\r\n                }\r\n            }\r\n            else {\r\n                prev.appIds.push(current.id);\r\n            }\r\n            return prev;\r\n        }, { actIds: [], appIds: [] });\r\n    };\r\n    LayoutsAPIImpl.prototype.verifyNotSlimMode = function () {\r\n        if (this.config.mode === \"slim\") {\r\n            throw Error(\"Operation not allowed in slim mode. Run in full mode.\");\r\n        }\r\n    };\r\n    LayoutsAPIImpl.prototype.isVisibleWindow = function (instance) {\r\n        // GD3\r\n        // allow exes to participate in layouts (TODO - check if the app is layouts aware (has the layouts methods) - if not treat it as not visible window)\r\n        if (instance.application.type === \"exe\" || instance.application.type === \"node\") {\r\n            return true;\r\n        }\r\n        // allow activities to participate in layouts\r\n        if (instance.application.type === \"activity\") {\r\n            return true;\r\n        }\r\n        if (!instance || !instance.window) {\r\n            return false;\r\n        }\r\n        return instance.window.isVisible;\r\n    };\r\n    LayoutsAPIImpl.prototype.invokeMethodAndTrack = function (methodName, args, resolve, reject, skipStreamEvent) {\r\n        var streamEventReceived = skipStreamEvent;\r\n        var agmResult;\r\n        var token = shortid_1.generate();\r\n        args.token = token;\r\n        var handleResult = function () {\r\n            if (streamEventReceived && agmResult) {\r\n                resolve(agmResult);\r\n            }\r\n        };\r\n        if (!skipStreamEvent) {\r\n            this.stream.waitFor(token)\r\n                .then(function () {\r\n                streamEventReceived = true;\r\n                handleResult();\r\n            })\r\n                .catch(function (err) {\r\n                reject(err);\r\n            });\r\n        }\r\n        var responseHandler = function (result) {\r\n            if (!result.returned) {\r\n                reject(\"No result from method \" + methodName);\r\n            }\r\n            if (result.returned.status && (result.returned.status !== \"Success\" && result.returned.status !== \"PartialSuccess\")) {\r\n                reject(result.returned);\r\n            }\r\n            agmResult = result.returned;\r\n            handleResult();\r\n        };\r\n        this.config.agm.invoke(methodName, args, \"best\", { methodResponseTimeoutMs: 120 * 1000 })\r\n            .then(responseHandler)\r\n            .catch(function (err) { return reject(err); });\r\n    };\r\n    LayoutsAPIImpl.prototype.getInstancesToClose = function (options) {\r\n        var _this = this;\r\n        var instances = [];\r\n        var shellApp = this.appManager.applications().filter(function (a) { return a.isShell; })[0];\r\n        var shellApplicationName = shellApp ? shellApp.name : \"AppManager\";\r\n        this.appManager.instances().forEach(function (i) {\r\n            // ignore my instance\r\n            if (_this.appManager.myInstance && i.id === _this.appManager.myInstance.id) {\r\n                return;\r\n            }\r\n            // ignore shell app\r\n            if (i.application.name === shellApplicationName) {\r\n                return;\r\n            }\r\n            // ignore hidden windows\r\n            if (!_this.isVisibleWindow(i)) {\r\n                return;\r\n            }\r\n            // if activity layout stop only the instances\r\n            // running in the same activity\r\n            if (options.type === \"Activity\") {\r\n                if (i.activityId !== options.activityIdToJoin) {\r\n                    return;\r\n                }\r\n            }\r\n            instances.push({ application: i.application.name, instance: i.id });\r\n        });\r\n        return instances;\r\n    };\r\n    LayoutsAPIImpl.prototype.getObjectValues = function (obj) {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.keys(obj).map(function (k) { return obj[k]; });\r\n    };\r\n    return LayoutsAPIImpl;\r\n}());\r\nexports.default = LayoutsAPIImpl;\r\n//# sourceMappingURL=layouts.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/layouts/layouts.js\n// module id = 65\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar layouts_1 = require(\"./layouts\");\r\nvar acsStream_1 = require(\"./stream/acsStream\");\r\nvar nullStream_1 = require(\"./stream/nullStream\");\r\nvar callback_registry_1 = require(\"callback-registry\");\r\nfunction default_1(config) {\r\n    if (!config.agm) {\r\n        throw Error(\"config.agm is required\");\r\n    }\r\n    if (!config.logger) {\r\n        throw Error(\"config.logger is required\");\r\n    }\r\n    // default mode to slim\r\n    config.mode = config.mode || \"slim\";\r\n    var logger = config.logger;\r\n    var callbacks = callback_registry_1.default();\r\n    var acsStream;\r\n    if (config.mode === \"full\" || \"fullWaitSnapshot\") {\r\n        acsStream = new acsStream_1.default(config.agm, callbacks);\r\n    }\r\n    else {\r\n        acsStream = nullStream_1.default();\r\n    }\r\n    return new layouts_1.default(config, acsStream, callbacks);\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=main.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/layouts/main.js\n// module id = 66\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar store_1 = require(\"../store\");\r\nvar layout_1 = require(\"../layout\");\r\nvar transform_1 = require(\"../transform\");\r\n/**\r\n * ACS event stream related to layouts\r\n */\r\nvar ACSStream = /** @class */ (function () {\r\n    function ACSStream(agm, callbacks) {\r\n        var _this = this;\r\n        this.agm = agm;\r\n        this.callbacks = callbacks;\r\n        this.ready = new Promise(function (resolve, reject) {\r\n            _this.resolveReady = resolve;\r\n            _this.rejectReady = reject;\r\n        });\r\n        this.gotSnapshot = new Promise(function (resolve, reject) {\r\n            _this.resolveGotSnapshot = resolve;\r\n            _this.rejectGotSnapshot = reject;\r\n        });\r\n    }\r\n    ACSStream.prototype.subscribe = function (noRetry) {\r\n        var _this = this;\r\n        var transform = function (obj) {\r\n            return _this.getObjectValues(obj).map(function (t) { return transform_1.default(t); });\r\n        };\r\n        // if we don't have OnLayoutEvent stream  we're running pre 2.1 GD version or outside GD,\r\n        if (!this.checkForLayoutEventMethod()) {\r\n            // if no retry resolve right away\r\n            if (noRetry) {\r\n                this.resolveReady();\r\n            }\r\n            // if we should retry, schedule  one more time\r\n            setTimeout(function () {\r\n                _this.subscribe(true);\r\n            }, 500);\r\n        }\r\n        else {\r\n            this.agm.subscribe(\"T42.ACS.OnLayoutEvent\", { waitTimeoutMs: 10000 })\r\n                .then(function (subs) {\r\n                subs.onData(function (args) {\r\n                    var data = args.data;\r\n                    if (data.IsSnapshot) {\r\n                        _this.resolveGotSnapshot();\r\n                    }\r\n                    _this.addLayouts(transform(data.OnLayoutAdded));\r\n                    _this.removeLayouts(transform(data.OnLayoutRemoved));\r\n                    _this.changeLayouts(transform(data.OnLayoutChanged));\r\n                    _this.renameLayouts(transform(data.OnLayoutRenamed));\r\n                    _this.callbacks.execute(\"streamEvent\", data);\r\n                });\r\n                subs.onFailed(function (err) {\r\n                    var msg = \"can not subscribe to T42.ACS.OnLayoutEvent \" + err;\r\n                    _this.rejectReady(msg);\r\n                    _this.rejectGotSnapshot(msg);\r\n                });\r\n                _this.resolveReady();\r\n            })\r\n                .catch(function (err) {\r\n                var msg = \"Error subscribing for T42.ACS.OnLayoutEvent stream. Err: \" + err;\r\n                _this.rejectReady(msg);\r\n                _this.rejectGotSnapshot(msg);\r\n            });\r\n        }\r\n    };\r\n    ACSStream.prototype.onEvent = function (callback) {\r\n        return this.callbacks.add(\"streamEvent\", callback);\r\n    };\r\n    ACSStream.prototype.waitFor = function (token, timeout) {\r\n        var _this = this;\r\n        if (!timeout) {\r\n            timeout = 10000; // default timeout is 10 seconds\r\n        }\r\n        return new Promise(function (resolve, reject) {\r\n            var done = false;\r\n            var unsubscribe = _this.onEvent(function (streamEvent) {\r\n                if (streamEvent.Token === token) {\r\n                    done = true;\r\n                    unsubscribe();\r\n                    resolve();\r\n                }\r\n            });\r\n            setTimeout(function () {\r\n                if (!done) {\r\n                    reject(\"timed out\");\r\n                }\r\n            }, timeout);\r\n        });\r\n    };\r\n    ACSStream.prototype.checkForLayoutEventMethod = function () {\r\n        try {\r\n            return this.agm\r\n                .methods()\r\n                .map(function (m) { return m.name; })\r\n                .indexOf(\"T42.ACS.OnLayoutEvent\") !== -1;\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n    ACSStream.prototype.addLayouts = function (layoutsData) {\r\n        var _this = this;\r\n        if (!layoutsData) {\r\n            return;\r\n        }\r\n        layoutsData.forEach(function (layoutData) {\r\n            var layout = new layout_1.default(layoutData);\r\n            store_1.default.add(layout);\r\n            _this.callbacks.execute(\"added\", layout);\r\n        });\r\n    };\r\n    ACSStream.prototype.removeLayouts = function (removedLayouts) {\r\n        var _this = this;\r\n        if (!removedLayouts) {\r\n            return;\r\n        }\r\n        removedLayouts.forEach(function (removedLayout) {\r\n            store_1.default.removeWhere(function (existingLayout) { return !_this.compareLayouts(existingLayout, removedLayout); });\r\n            _this.callbacks.execute(\"removed\", removedLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.changeLayouts = function (changedLayouts) {\r\n        var _this = this;\r\n        if (!changedLayouts) {\r\n            return;\r\n        }\r\n        changedLayouts.forEach(function (changedLayout) {\r\n            // removed the changed layout and push it again\r\n            store_1.default.removeWhere(function (existingLayout) { return !_this.compareLayouts(existingLayout, changedLayout); });\r\n            store_1.default.add(new layout_1.default(changedLayout));\r\n            // execute callback\r\n            _this.callbacks.execute(\"changed\", changedLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.renameLayouts = function (renamedLayouts) {\r\n        var _this = this;\r\n        if (!renamedLayouts) {\r\n            return;\r\n        }\r\n        renamedLayouts.forEach(function (renamedLayout) {\r\n            var existingLayout = store_1.default.first(function (current) { return _this.compareLayouts(current, { type: renamedLayout.type, name: renamedLayout.oldName }); });\r\n            if (!existingLayout) {\r\n                throw Error(\"received rename event for unknown layout with type \" + renamedLayout.type + \" and name \" + renamedLayout.oldName);\r\n            }\r\n            existingLayout.name = renamedLayout.newName;\r\n            _this.callbacks.execute(\"renamed\", existingLayout);\r\n        });\r\n    };\r\n    ACSStream.prototype.compareLayouts = function (layout1, layout2) {\r\n        return layout1.name === layout2.name && layout1.type === layout2.type;\r\n    };\r\n    ACSStream.prototype.getObjectValues = function (obj) {\r\n        if (!obj) {\r\n            return [];\r\n        }\r\n        return Object.keys(obj).map(function (k) { return obj[k]; });\r\n    };\r\n    return ACSStream;\r\n}());\r\nexports.default = ACSStream;\r\n//# sourceMappingURL=acsStream.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/layouts/stream/acsStream.js\n// module id = 67\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction default_1() {\r\n    return {\r\n        ready: Promise.resolve(undefined),\r\n        subscribe: function () { },\r\n        onEvent: function (callback) { return function () { }; },\r\n        waitFor: function (token, timeout) { return Promise.resolve(undefined); },\r\n        gotSnapshot: Promise.resolve(undefined),\r\n    };\r\n}\r\nexports.default = default_1;\r\n//# sourceMappingURL=nullStream.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/layouts/stream/nullStream.js\n// module id = 68\n// module chunks = 0","\"use strict\";\r\nvar glue_1 = require(\"./glue\");\r\nif (typeof window !== \"undefined\") {\r\n    window.Glue = glue_1.default;\r\n}\r\n// add default library for ES6 modules\r\nglue_1.default.default = glue_1.default;\r\nmodule.exports = glue_1.default;\r\n//# sourceMappingURL=main.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/main.js\n// module id = 69\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Utils = /** @class */ (function () {\r\n    function Utils() {\r\n    }\r\n    Utils.getGDMajorVersion = function () {\r\n        if (typeof window === \"undefined\") {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop) {\r\n            return -1;\r\n        }\r\n        if (!window.glueDesktop.version) {\r\n            return -1;\r\n        }\r\n        var ver = Number(window.glueDesktop.version.substr(0, 1));\r\n        return isNaN(ver) ? -1 : ver;\r\n    };\r\n    Utils.isNode = function () {\r\n        // Only Node.JS has a process variable that is of [[Class]] process\r\n        try {\r\n            return Object.prototype.toString.call(global.process) === \"[object process]\";\r\n        }\r\n        catch (e) {\r\n            return false;\r\n        }\r\n    };\r\n    return Utils;\r\n}());\r\nexports.default = Utils;\r\n//# sourceMappingURL=utils.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/utils.js\n// module id = 70\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar gd_1 = require(\"./gd/gd\");\r\nvar hc_1 = require(\"./hc/hc\");\r\nexports.default = (function (agm, logger, appManagerGetter, gdMajorVersion) {\r\n    var _logger = logger;\r\n    return new Promise(function (resolve, reject) {\r\n        if (gdMajorVersion === 2) {\r\n            // We are running in HC\r\n            _logger.trace(\"running in HC\");\r\n            hc_1.default(agm, _logger, appManagerGetter, window.htmlContainer.containerName, window.htmlContainer.windowId)\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n        else if (gdMajorVersion >= 3) {\r\n            // We are running in GD 3\r\n            // TODO expose instance in glu42gd\r\n            _logger.trace(\"running in GD\");\r\n            var gd = new gd_1.default(agm, _logger, appManagerGetter, undefined, window.glue42gd.windowId);\r\n            gd.init()\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n        else {\r\n            // We are running in Browser or Node, we should check which stream is available\r\n            // But we need to pass the container as dependency\r\n            var hcPromise = hc_1.default(agm, _logger, appManagerGetter);\r\n            var gdPromise = new gd_1.default(agm, _logger, appManagerGetter).init();\r\n            var wait = function (ms) { return new Promise(function (res, rej) { return setTimeout(function () { rej(\"timeout waiting for streams\"); }, ms); }); };\r\n            Promise.race([hcPromise, gdPromise, wait(10000)])\r\n                .then(resolve)\r\n                .catch(reject);\r\n        }\r\n    });\r\n});\r\n//# sourceMappingURL=detector.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/environment/detector.js\n// module id = 71\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar objectAssign = require(\"object-assign\");\r\nvar GDExecutor = /** @class */ (function () {\r\n    function GDExecutor() {\r\n    }\r\n    Object.defineProperty(GDExecutor.prototype, \"hostInstance\", {\r\n        get: function () {\r\n            return this.agmTarget;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GDExecutor.prototype.init = function (agm, instance) {\r\n        this.agm = agm;\r\n        this.agmTarget = instance;\r\n    };\r\n    GDExecutor.prototype.close = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"close\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.navigate = function (resultWindow, newUrl) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"navigate\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    url: newUrl\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setStyle = function (resultWindow, style) {\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            Promise.resolve();\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTitle = function (resultWindow, newTitle) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var options = {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    title: newTitle\r\n                }\r\n            };\r\n            _this.execute(\"setTitle\", options)\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n            Promise.resolve();\r\n        });\r\n    };\r\n    GDExecutor.prototype.moveResize = function (resultWindow, dimensions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"moveResize\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    bounds: dimensions\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.addFrameButton = function (resultWindow, buttonInfo) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"addButton\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonInfo\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.removeFrameButton = function (resultWindow, buttonId) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"removeButton\", {\r\n                windowId: resultWindow.id,\r\n                options: buttonId\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.activate = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"activate\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.focus = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"focus\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.maximizeRestore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            _this.execute(\"maximizeRestore\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.maximize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"maximize\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.restore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"restore\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.minimize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"minimize\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.collapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"collapse\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.expand = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"expand\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.toggleCollapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"toggleCollapse\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.snap = function (resultWindow, target, direction) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId = resultWindow.id;\r\n            var targetWindowId;\r\n            var errorMessage = \"Invalid target parameter - should be an object with property id or a string. Invoked for source window id:\" +\r\n                resultWindow.id;\r\n            if (!target) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof target === \"string\") {\r\n                targetWindowId = target;\r\n            }\r\n            else if (typeof target.id !== \"undefined\") {\r\n                targetWindowId = target.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var args = {\r\n                targetWindowId: targetWindowId\r\n            };\r\n            if (direction) {\r\n                args.snappingEdge = direction;\r\n            }\r\n            _this.execute(\"snap\", {\r\n                windowId: resultWindow.id,\r\n                options: args\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.attachTab = function (resultWindow, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"attachTab\", {\r\n                windowId: resultWindow.id,\r\n                options: options\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.detachTab = function (resultWindow, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            _this.execute(\"detachTab\", {\r\n                windowId: resultWindow.id,\r\n                options: options\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setVisible = function (resultWindow, toBeVisible) {\r\n        var _this = this;\r\n        if (toBeVisible === void 0) { toBeVisible = true; }\r\n        return new Promise(function (resolve, reject) {\r\n            var command;\r\n            if (toBeVisible) {\r\n                command = \"show\";\r\n            }\r\n            else {\r\n                command = \"hide\";\r\n            }\r\n            _this.execute(command, { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.showLoader = function (resultWindow, loader) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"showLoadingAnimation\", { windowId: resultWindow.id, options: loader })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.hideLoader = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"hideLoadingAnimation\", { windowId: resultWindow.id })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.updateContext = function (resultWindow, context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"updateContext\", {\r\n                windowId: resultWindow.id,\r\n                context: context,\r\n                replace: Object.keys(resultWindow.context).length > 0 ? false : true\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.lock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"lockUnlock\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    isLocked: true\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.unlock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"lockUnlock\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    isLocked: false\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.getIcon = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"getIcon\", {\r\n                windowId: resultWindow.id,\r\n                options: {}\r\n            })\r\n                .then(function (result) {\r\n                resolve(result.icon);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setIcon = function (resultWindow, base64Image) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            _this.execute(\"setIcon\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    dataURL: base64Image\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setFrameColor = function (resultWindow, frameColor) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            _this.execute(\"setFrameColor\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    frameColor: frameColor\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.setTabHeaderVisible = function (resultWindow, toBeTabHeaderVisible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            _this.execute(\"setTabHeaderVisible\", {\r\n                windowId: resultWindow.id,\r\n                options: {\r\n                    toShow: toBeTabHeaderVisible\r\n                }\r\n            })\r\n                .then(function () {\r\n                resolve(resultWindow);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    };\r\n    GDExecutor.prototype.execute = function (command, options) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var args = {};\r\n            objectAssign(args, options);\r\n            args.command = command;\r\n            _this.agm\r\n                .invoke(\"T42.Wnd.Execute\", args, _this.agmTarget)\r\n                .then(function (i) {\r\n                if (i.returned && i.returned.errorMsg) {\r\n                    reject(i);\r\n                }\r\n                else {\r\n                    resolve(i.returned);\r\n                }\r\n            })\r\n                .catch(function (i) {\r\n                reject(i);\r\n            });\r\n        });\r\n    };\r\n    /** Groups */\r\n    GDExecutor.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this.execute(\"setGroupHeaderVisibility\", {\r\n            windowId: windowId,\r\n            options: {\r\n                toShow: toShow\r\n            }\r\n        });\r\n    };\r\n    return GDExecutor;\r\n}());\r\nexports.GDExecutor = GDExecutor;\r\nexports.default = new GDExecutor();\r\n//# sourceMappingURL=executor.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/environment/gd/executor.js\n// module id = 72\n// module chunks = 0","\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = require(\"callback-registry\");\r\nvar store_1 = require(\"../../store\");\r\nvar window_1 = require(\"../../window\");\r\nvar executor_1 = require(\"./executor\");\r\nvar helpers_1 = require(\"../helpers\");\r\nvar GDEnvironment = /** @class */ (function () {\r\n    function GDEnvironment(agm, logger, appManagerGetter, instance, wndId) {\r\n        this._registry = CallbackFactory();\r\n        this._waitTimeout = 10000;\r\n        this._agm = agm;\r\n        this._logger = logger.subLogger(\"gd-env\");\r\n        this._agmInstance = this.normalizeInstance(instance);\r\n        this._windowId = wndId;\r\n        this._appManagerGetter = appManagerGetter;\r\n    }\r\n    GDEnvironment.prototype.init = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // if we don't have an Instance, thats means that we are running outside from any Tick42 Containers\r\n            // so our target is best\r\n            if (typeof _this._agmInstance === \"undefined\") {\r\n                _this._agmInstance = \"best\";\r\n            }\r\n            var streamPromise = new Promise(function (streamResolve, streamReject) {\r\n                _this._agm.subscribe(\"T42.Wnd.OnEvent\", {\r\n                    waitTimeoutMs: _this._waitTimeout,\r\n                    target: _this._agmInstance,\r\n                })\r\n                    .then(function (stream) {\r\n                    stream.onData(function (streamData) {\r\n                        _this.updateWindow(streamData.data);\r\n                    });\r\n                    stream.onFailed(function (err) {\r\n                        reject(err);\r\n                    });\r\n                    _this._agmInstance = _this.normalizeInstance(stream.serverInstance);\r\n                    // Init the executor\r\n                    executor_1.default.init(_this._agm, _this._agmInstance);\r\n                    resolve(_this);\r\n                })\r\n                    .catch(function (err) {\r\n                    reject(\"Can not subscribe for stream T42.Wnd.OnEvent. Err: \" + err);\r\n                });\r\n            });\r\n        });\r\n    };\r\n    Object.defineProperty(GDEnvironment.prototype, \"executor\", {\r\n        get: function () {\r\n            return executor_1.default;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    GDEnvironment.prototype.open = function (name, url, options, success, error) {\r\n        options = options || {};\r\n        var copyOptions = Object.assign({}, options);\r\n        // relativeTo fix\r\n        if (typeof name === \"undefined\") {\r\n            if (error) {\r\n                error({ message: \"The name is undefined\" });\r\n            }\r\n            return;\r\n        }\r\n        if (typeof copyOptions.relativeTo !== \"undefined\" && typeof copyOptions.relativeTo !== \"string\") {\r\n            copyOptions.relativeTo = copyOptions.relativeTo.id || \"\";\r\n        }\r\n        copyOptions.name = name;\r\n        copyOptions.url = url;\r\n        // This is for compatability between gd2 and gd3\r\n        copyOptions.windowState = options.windowState || options.state;\r\n        // Otherwise glue desktop throws an error for extra properties\r\n        delete copyOptions.state;\r\n        this._agm.invoke(\"T42.Wnd.Create\", copyOptions, this._agmInstance)\r\n            .then(function (message) {\r\n            if (message.returned !== undefined) {\r\n                var id = message.returned.id;\r\n                success(id);\r\n            }\r\n            else {\r\n                error({ message: \"failed to execute T42.Wnd.Create - unknown reason\" });\r\n            }\r\n        }).catch(function (e) {\r\n            if (typeof error === \"function\") {\r\n                error(e);\r\n            }\r\n        });\r\n    };\r\n    GDEnvironment.prototype.tabAttached = function (callback) {\r\n        return this._registry.add(\"tab-attached\", callback);\r\n    };\r\n    GDEnvironment.prototype.tabDetached = function (callback) {\r\n        return this._registry.add(\"tab-detached\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowFrameColorChanged = function (callback) {\r\n        return this._registry.add(\"frame-color-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onEvent = function (callback) {\r\n        return this._registry.add(\"window-event\", callback);\r\n    };\r\n    GDEnvironment.prototype.my = function () {\r\n        return this._windowId;\r\n    };\r\n    GDEnvironment.prototype.execute = function (command, options) {\r\n        return this._agm.invoke(\"T42.Wnd.Execute\", {\r\n            command: command,\r\n            options: options,\r\n        });\r\n    };\r\n    /** Groups */\r\n    GDEnvironment.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this._agm.invoke(\"T42.Wnd.SetGroupHeaderVisible\", {\r\n            windowId: windowId,\r\n            toShow: toShow,\r\n        }, this._agmInstance);\r\n    };\r\n    GDEnvironment.prototype.onCompositionChanged = function (callback) {\r\n        return this._registry.add(\"composition-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onGroupHeaderVisibilityChanged = function (callback) {\r\n        return this._registry.add(\"group-header-changed\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowGotFocus = function (callback) {\r\n        return this._registry.add(\"got-focus\", callback);\r\n    };\r\n    GDEnvironment.prototype.onWindowLostFocus = function (callback) {\r\n        return this._registry.add(\"lost-focus\", callback);\r\n    };\r\n    GDEnvironment.prototype.normalizeInstance = function (instance) {\r\n        if (!instance) {\r\n            return undefined;\r\n        }\r\n        return {\r\n            application: instance.application,\r\n            machine: instance.machine,\r\n            user: instance.user,\r\n        };\r\n    };\r\n    GDEnvironment.prototype.updateWindow = function (windowInfo) {\r\n        var _this = this;\r\n        var extendedStreamEvent = this.getExtendedStreamEvent(windowInfo);\r\n        // this is the snapshot of all windows\r\n        if (windowInfo.type === \"Snapshot\") {\r\n            var windowInfoFullInfoEvent = windowInfo;\r\n            windowInfoFullInfoEvent.windows.forEach(function (w) {\r\n                var win = _this.createWindow(w.id, w);\r\n                store_1.default.markReadyToShow(win.API.id);\r\n                _this._registry.execute(\"window-event\", extendedStreamEvent);\r\n            });\r\n            return;\r\n        }\r\n        // if new window handle it separately\r\n        if (windowInfo.type === \"Created\") {\r\n            var windowInfoCreatedEvent = windowInfo;\r\n            var win = this.createWindow(windowInfoCreatedEvent.windowId, windowInfoCreatedEvent.data || {});\r\n            store_1.default.setReadyState(win.API.id);\r\n            this._registry.execute(\"window-event\", extendedStreamEvent);\r\n            return;\r\n        }\r\n        // otherwise check if the window is in our internal collections and update its state\r\n        var windowObjectAndEvents = store_1.default.get(windowInfo.windowId);\r\n        if (!windowObjectAndEvents) {\r\n            this._logger.error(\"received update for unknown window. Stream:', \" + JSON.stringify(windowInfo, null, 4));\r\n            return;\r\n        }\r\n        var theWindow = windowObjectAndEvents.API;\r\n        var theWindowEvents = windowObjectAndEvents.Events;\r\n        // handle bounds changed\r\n        if (windowInfo.type === \"BoundsChanged\") {\r\n            var windowInfoBoundsChangedEvent = windowInfo;\r\n            theWindowEvents.handleBoundsChanged(windowInfoBoundsChangedEvent.data);\r\n        }\r\n        // handle url changed\r\n        if (windowInfo.type === \"UrlChanged\") {\r\n            var windowInfoUrlChangedEvent = windowInfo;\r\n            store_1.default.setUrlChangedState(windowInfoUrlChangedEvent.windowId);\r\n            theWindowEvents.handleUrlChanged(windowInfoUrlChangedEvent.data);\r\n        }\r\n        // handle title changed\r\n        if (windowInfo.type === \"TitleChanged\") {\r\n            var windowInfoTitleChanged = windowInfo;\r\n            theWindowEvents.handleTitleChanged(windowInfoTitleChanged.data);\r\n        }\r\n        // handle visibility changed\r\n        if (windowInfo.type === \"VisibilityChanged\") {\r\n            theWindowEvents.handleVisibilityChanged(windowInfo.data);\r\n        }\r\n        // handle context changed\r\n        if (windowInfo.type === \"ContextChanged\") {\r\n            theWindowEvents.handleContextUpdated(windowInfo.data);\r\n        }\r\n        // handle window state changed\r\n        if (windowInfo.type === \"StateChanged\") {\r\n            theWindowEvents.handleWindowChangeState(windowInfo.data);\r\n        }\r\n        // handle frame color changed\r\n        if (windowInfo.type === \"FrameColorChanged\") {\r\n            theWindowEvents.handleFrameColorChanged(windowInfo.data);\r\n            this._registry.execute(\"frame-color-changed\", theWindow);\r\n        }\r\n        // handle composition changed - groups API\r\n        if (windowInfo.type === \"CompositionChanged\") {\r\n            var windowInfoCompositionChanged = windowInfo;\r\n            theWindowEvents.handleCompositionChanged(windowInfoCompositionChanged.data.neighbors, windowInfoCompositionChanged.data.groupId);\r\n            this._registry.execute(\"composition-changed\", windowInfoCompositionChanged.data);\r\n        }\r\n        if (windowInfo.type === \"GroupHeaderVisibilityChanged\") {\r\n            var info = windowInfo;\r\n            theWindowEvents.handleGroupHeaderVisibilityChanged(info.data.groupHeaderVisible);\r\n            this._registry.execute(\"group-header-changed\", info.data);\r\n        }\r\n        // handle focus changed\r\n        if (windowInfo.type === \"FocusChanged\") {\r\n            var windowInfoFocusChanged = windowInfo;\r\n            this.focusChanged(theWindowEvents, theWindow, windowInfoFocusChanged.data);\r\n        }\r\n        if (windowInfo.type === \"WindowFrameChanged\") {\r\n            theWindowEvents.handleFrameAttached(windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n            this._registry.execute(\"frame-changed\");\r\n        }\r\n        if (windowInfo.type === \"WindowFrameAdded\") {\r\n            theWindowEvents.handleAttached(windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n            var winsToBeNotified_1 = helpers_1.getWindowsByTabGroupId(theWindow.id, windowInfo.data.frameId);\r\n            // Getting all windows, except current, with same tabGroupId\r\n            Object.keys(winsToBeNotified_1).forEach(function (id) {\r\n                var win = winsToBeNotified_1[id];\r\n                // Executing event windowAttached to all windows\r\n                win.Events.handleWindowAttached(theWindow);\r\n            });\r\n            this._registry.execute(\"tab-attached\", theWindow, windowInfo.data.frameId, windowInfo.data.isTabHeaderVisible);\r\n        }\r\n        if (windowInfo.type === \"WindowFrameRemoved\") {\r\n            // In the event, tabGroupId is empty, will be update on the next event FrameAttached\r\n            var oldTabGroupId = theWindow.tabGroupId;\r\n            theWindowEvents.handleDetached(windowInfo.data.frameId);\r\n            var winsToBeNotified_2 = helpers_1.getWindowsByTabGroupId(theWindow.id, oldTabGroupId);\r\n            Object.keys(winsToBeNotified_2).forEach(function (id) {\r\n                var win = winsToBeNotified_2[id];\r\n                win.Events.handleWindowDetached(theWindow);\r\n            });\r\n            var un_1 = this._registry.add(\"frame-changed\", function () {\r\n                un_1();\r\n                _this._registry.execute(\"tab-detached\", theWindow, windowInfo.data.frameId, theWindow.tabGroupId);\r\n            });\r\n        }\r\n        if (windowInfo.type === \"TabHeaderVisibilityChanged\") {\r\n            theWindowEvents.handleTabHeaderVisibilityChanged(windowInfo.data.isTabHeaderVisible);\r\n        }\r\n        if (windowInfo.type === \"FrameSelectionChanged\") {\r\n            theWindowEvents.handleFrameSelectionChanged(windowInfo.data.newWindowId, windowInfo.data.prevWindowId);\r\n        }\r\n        if (windowInfo.type === \"ButtonClicked\") {\r\n            theWindowEvents.handleFrameButtonClicked(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ButtonAdded\") {\r\n            theWindowEvents.handleFrameButtonAdded(windowInfo.data);\r\n        }\r\n        if (windowInfo.type === \"ButtonRemoved\") {\r\n            theWindowEvents.handleFrameButtonRemoved(windowInfo.data);\r\n        }\r\n        // Clear the window on close event\r\n        if (windowInfo.type === \"Closed\") {\r\n            store_1.default.remove(windowObjectAndEvents);\r\n            theWindowEvents.handleWindowClose();\r\n        }\r\n        // expose to external listeners\r\n        this._registry.execute(\"window-event\", extendedStreamEvent);\r\n    };\r\n    GDEnvironment.prototype.createWindow = function (windowId, options) {\r\n        var windowObjAndEvents = window_1.default(windowId, this.mapToWindowConstructorOptions(options), executor_1.default, this._logger, this._appManagerGetter);\r\n        store_1.default.add(windowObjAndEvents);\r\n        return windowObjAndEvents;\r\n    };\r\n    GDEnvironment.prototype.focusChanged = function (theWindowEvents, theWindow, focus) {\r\n        theWindowEvents.handleFocusChanged(focus);\r\n        if (focus) {\r\n            this._registry.execute(\"got-focus\", theWindow);\r\n        }\r\n        else {\r\n            this._registry.execute(\"lost-focus\", theWindow);\r\n        }\r\n    };\r\n    GDEnvironment.prototype.mapToWindowConstructorOptions = function (args) {\r\n        // TODO\r\n        return {\r\n            name: args.name,\r\n            context: args.context,\r\n            bounds: args.bounds,\r\n            url: args.url,\r\n            title: args.title,\r\n            isVisible: args.isVisible,\r\n            focus: args.isFocused,\r\n            state: args.state,\r\n            frameColor: args.frameColor,\r\n            groupId: args.groupId,\r\n            neighbours: args.neighbors,\r\n            isFocused: args.isFocused,\r\n            isGroupHeaderVisible: args.groupHeaderVisible,\r\n            isCollapsed: args.isCollapsed,\r\n            tabGroupId: args.frameId,\r\n            mode: args.mode,\r\n            isTabHeaderVisible: args.isTabHeaderVisible,\r\n            isTabSelected: args.isActiveTab,\r\n            settings: args.settings,\r\n            windowType: args.windowType,\r\n        };\r\n    };\r\n    GDEnvironment.prototype.getExtendedStreamEvent = function (streamEvent) {\r\n        try {\r\n            var result = __assign({ state: streamEvent.type, windowName: store_1.default.get(streamEvent.windowId).API.name }, streamEvent);\r\n            if (result.state === \"WindowFrameAdded\") {\r\n                result.state = \"TabAttached\";\r\n            }\r\n            if (result.state === \"StateChanged\") {\r\n                result.state = result.data.charAt(0).toUpperCase() + result.data.slice(1);\r\n            }\r\n            if (result.state === \"ButtonAdded\") {\r\n                result.state = \"FrameButtonAdded\";\r\n            }\r\n            if (result.state === \"ButtonRemoved\") {\r\n                result.state = \"FrameButtonRemoved\";\r\n            }\r\n            return result;\r\n        }\r\n        catch (error) {\r\n            return streamEvent;\r\n        }\r\n    };\r\n    return GDEnvironment;\r\n}());\r\nexports.default = GDEnvironment;\r\n//# sourceMappingURL=gd.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/environment/gd/gd.js\n// module id = 73\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar HcExecutor = /** @class */ (function () {\r\n    function HcExecutor() {\r\n    }\r\n    Object.defineProperty(HcExecutor.prototype, \"hostInstance\", {\r\n        get: function () {\r\n            return this.agmTarget;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    HcExecutor.prototype.init = function (agm, instance) {\r\n        this.agm = agm;\r\n        this.agmTarget = instance;\r\n    };\r\n    HcExecutor.prototype.close = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.url === undefined;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Close\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onClose);\r\n        });\r\n    };\r\n    HcExecutor.prototype.navigate = function (resultWindow, newUrl) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.url === newUrl;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Html.OpenUrl\", successHandler, errorHandler, { url: newUrl }, conditionFunc, resultWindow.onUrlChanged, true);\r\n        });\r\n    };\r\n    HcExecutor.prototype.setStyle = function (resultWindow, style) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetWindowStyle\", successHandler, errorHandler, { windowStyleAttributes: JSON.stringify(style) });\r\n        });\r\n    };\r\n    HcExecutor.prototype.setTitle = function (resultWindow, newTitle) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.title === newTitle;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetWindowTitle\", successHandler, errorHandler, { title: newTitle }, conditionFunc, resultWindow.onTitleChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.moveResize = function (resultWindow, dimensions) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                var b = resultWindow.bounds;\r\n                var isSame = true;\r\n                Object.keys(dimensions).forEach(function (key) {\r\n                    if (dimensions[key] !== b[key]) {\r\n                        isSame = false;\r\n                        return;\r\n                    }\r\n                });\r\n                return isSame;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.ResizeAndMove\", successHandler, errorHandler, dimensions, conditionFunc, resultWindow.onBoundsChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.addFrameButton = function (resultWindow, buttonInfo) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.AddFrameButton\", successHandler, errorHandler, { buttonInfo: buttonInfo }, conditionFunc, resultWindow.onFrameButtonAdded);\r\n        });\r\n    };\r\n    HcExecutor.prototype.removeFrameButton = function (resultWindow, buttonId) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.RemoveFrameButton\", successHandler, errorHandler, { buttonId: buttonId }, conditionFunc, resultWindow.onFrameButtonRemoved);\r\n        });\r\n    };\r\n    HcExecutor.prototype.activate = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.isFocused;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Activate\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onFocusChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.focus = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.isFocused;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Activate\", successHandler, errorHandler, { focus: true }, conditionFunc, resultWindow.onFocusChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.maximizeRestore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var eventToSubscribe = resultWindow.state !== \"maximized\" ? resultWindow.onNormal : resultWindow.onMaximized;\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.MaximizeOrRestoreDown\", successHandler, errorHandler, {}, conditionFunc, eventToSubscribe);\r\n        });\r\n    };\r\n    HcExecutor.prototype.maximize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.state === \"maximized\";\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Maximize\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onMaximized);\r\n        });\r\n    };\r\n    HcExecutor.prototype.restore = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.state === \"normal\";\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Restore\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onNormal);\r\n        });\r\n    };\r\n    HcExecutor.prototype.minimize = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.state === \"minimized\";\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Minimize\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onMinimized);\r\n        });\r\n    };\r\n    HcExecutor.prototype.collapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return resultWindow.isCollapsed;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetCollapsed\", successHandler, errorHandler, { collapsed: true }, conditionFunc, resultWindow.onCollapsed);\r\n        });\r\n    };\r\n    HcExecutor.prototype.expand = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return !resultWindow.isCollapsed;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetCollapsed\", successHandler, errorHandler, { collapsed: false }, conditionFunc, resultWindow.onExpanded);\r\n        });\r\n    };\r\n    HcExecutor.prototype.toggleCollapse = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            var subscribeFunc = resultWindow.isCollapsed ? resultWindow.onExpanded : resultWindow.onCollapsed;\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetCollapsed\", successHandler, errorHandler, { title: \"\" }, conditionFunc, subscribeFunc);\r\n        });\r\n    };\r\n    HcExecutor.prototype.snap = function (resultWindow, target, direction) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var sourceWindowId = resultWindow.id;\r\n            var targetWindowId;\r\n            var errorMessage = \"Invalid target parameter - should be an object with property id or a string. Invoked for source window id:\" + resultWindow.id;\r\n            if (!target) {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            if (typeof target === \"string\") {\r\n                targetWindowId = target;\r\n            }\r\n            else if (typeof target.id !== \"undefined\") {\r\n                targetWindowId = target.id;\r\n            }\r\n            else {\r\n                reject(errorMessage);\r\n                return;\r\n            }\r\n            var args = {\r\n                sourceWindowId: sourceWindowId,\r\n                targetWindowId: targetWindowId,\r\n            };\r\n            if (direction) {\r\n                args.snappingEdge = direction;\r\n            }\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Snap\", successHandler, errorHandler, args);\r\n        });\r\n    };\r\n    HcExecutor.prototype.attachTab = function (resultWindow, args) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.AttachTab\", successHandler, errorHandler, args);\r\n        });\r\n    };\r\n    HcExecutor.prototype.detachTab = function (resultWindow, args) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var _options = args || {};\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.DettachTab\", successHandler, errorHandler, args);\r\n        });\r\n    };\r\n    HcExecutor.prototype.setVisible = function (resultWindow, toBeVisible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof toBeVisible === \"undefined\") {\r\n                toBeVisible = true;\r\n            }\r\n            var conditionFunc = function () {\r\n                return resultWindow.isVisible === toBeVisible;\r\n            };\r\n            var styles = { Hidden: !toBeVisible };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetWindowStyle\", successHandler, errorHandler, { windowStyleAttributes: JSON.stringify(styles) }, conditionFunc, resultWindow.onVisibilityChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.showLoader = function (resultWindow, loader) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var opt = loader || {};\r\n            opt.enabled = true;\r\n            opt.timeout = opt.timeout || -1; // by default show the loader forever\r\n            var argsForSend = { loader: opt };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.UpdateLoader\", successHandler, errorHandler, argsForSend);\r\n        });\r\n    };\r\n    HcExecutor.prototype.hideLoader = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.UpdateLoader\", successHandler, errorHandler, { loader: { enabled: false } });\r\n        });\r\n    };\r\n    HcExecutor.prototype.updateContext = function (resultWindow, context) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!context) {\r\n                reject(\"Invalid context parameter - should be an object. Invoked for source window id:\" + resultWindow.id);\r\n                return;\r\n            }\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.UpdateContext\", successHandler, errorHandler, { context: context }, conditionFunc, resultWindow.onContextUpdated);\r\n        });\r\n    };\r\n    HcExecutor.prototype.lock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Lock\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onLockingChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.unlock = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.Unlock\", successHandler, errorHandler, {}, conditionFunc, resultWindow.onLockingChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.getIcon = function (resultWindow) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            // TODO check it in HC\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.GetIcon\", successHandler, errorHandler);\r\n        });\r\n    };\r\n    HcExecutor.prototype.setIcon = function (resultWindow, base64Image) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!base64Image) {\r\n                reject(\"Invalid base64Image parameter. Invoked for source window id:\" + resultWindow.id);\r\n                return;\r\n            }\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetIcon\", successHandler, errorHandler, { base64ImageSource: base64Image });\r\n        });\r\n    };\r\n    HcExecutor.prototype.setFrameColor = function (resultWindow, frameColor) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!frameColor) {\r\n                reject(\"Invalid frameColor parameter. Invoked for source window id:\" + resultWindow.id);\r\n                return;\r\n            }\r\n            var conditionFunc = function () {\r\n                return false;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetWindowStyle\", successHandler, errorHandler, { windowStyleAttributes: JSON.stringify({ stickyFrameColor: frameColor }) }, conditionFunc, resultWindow.onFrameColorChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.setTabHeaderVisible = function (resultWindow, toBeTabHeaderVisible) {\r\n        var _this = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof toBeTabHeaderVisible === \"undefined\") {\r\n                toBeTabHeaderVisible = true;\r\n            }\r\n            var conditionFunc = function () {\r\n                return resultWindow.isTabHeaderVisible === toBeTabHeaderVisible;\r\n            };\r\n            function successHandler(w) {\r\n                resolve(w);\r\n            }\r\n            function errorHandler(e) {\r\n                reject(e);\r\n            }\r\n            return _this.agmAction(resultWindow, \"T42.Wnd.SetTabHeaderVisible\", successHandler, errorHandler, { toShow: toBeTabHeaderVisible }, conditionFunc, resultWindow.onTabHeaderVisibilityChanged);\r\n        });\r\n    };\r\n    HcExecutor.prototype.execute = function (command, options) {\r\n        return this.agm.invoke(\"T42.Wnd.Execute\", {\r\n            command: command,\r\n            options: options,\r\n        });\r\n    };\r\n    /** Groups */\r\n    HcExecutor.prototype.setGroupHeaderVisible = function (windowId, toShow) {\r\n        return this.agm.invoke(\"T42.Wnd.SetGroupHeaderVisible\", {\r\n            windowId: windowId,\r\n            toShow: toShow,\r\n        }, this.agmTarget);\r\n    };\r\n    HcExecutor.prototype.agmAction = function (resultWindow, action, success, error, args, conditionFunc, subscribeFunc, ignoreTimeout) {\r\n        // Stop if the window is closed\r\n        ignoreTimeout = ignoreTimeout || false;\r\n        if (resultWindow.url === undefined) {\r\n            if (typeof error === \"function\") {\r\n                error(\"Cannot execute a command on a closed window.\");\r\n            }\r\n            return;\r\n        }\r\n        if (typeof conditionFunc === \"undefined\" || conditionFunc()) {\r\n            this.agmInvoke(resultWindow, action, args, success, error);\r\n        }\r\n        else {\r\n            var removeCallback_1 = function () {\r\n                return;\r\n            };\r\n            var isResolved_1 = false;\r\n            var successHandler = function () {\r\n                isResolved_1 = true;\r\n                removeCallback_1();\r\n                if (typeof success === \"function\") {\r\n                    success(resultWindow);\r\n                }\r\n            };\r\n            removeCallback_1 = subscribeFunc(successHandler);\r\n            if (!ignoreTimeout) {\r\n                setTimeout(function () {\r\n                    if (!isResolved_1) {\r\n                        if (typeof error === \"function\") {\r\n                            error(\"Agm invoke timeout! action: \" + action);\r\n                        }\r\n                    }\r\n                }, 2000);\r\n            }\r\n            this.agmInvoke(resultWindow, action, args, function () {\r\n                return;\r\n            }, error);\r\n        }\r\n    };\r\n    HcExecutor.prototype.agmInvoke = function (resultWindow, action, args, success, error) {\r\n        // Add the window ID to the arguments\r\n        args = args || {};\r\n        args.windowId = resultWindow.id;\r\n        // Invoke the AGM method\r\n        this.agm.invoke(action, args, this.agmTarget, {}, successHandler, errorHandler);\r\n        function successHandler() {\r\n            if (typeof success === \"function\") {\r\n                success(resultWindow);\r\n            }\r\n        }\r\n        function errorHandler(err) {\r\n            if (typeof error === \"function\") {\r\n                if (err.all_return_values && err.all_return_values.length > 0) {\r\n                    error(err.all_return_values[0].message);\r\n                }\r\n                else {\r\n                    error(err);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return HcExecutor;\r\n}());\r\nexports.HcExecutor = HcExecutor;\r\nexports.default = new HcExecutor();\r\n//# sourceMappingURL=executor.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/environment/hc/executor.js\n// module id = 74\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = require(\"callback-registry\");\r\nvar store_1 = require(\"../../store\");\r\nvar window_1 = require(\"../../window\");\r\nvar executor_1 = require(\"./executor\");\r\nvar helpers_1 = require(\"../helpers\");\r\nexports.default = (function (agm, logger, appManagerGetter, cntName, wndId) {\r\n    return new Promise(function (resolve, reject) {\r\n        var _registry = CallbackFactory();\r\n        var _logger = logger.subLogger(\"hc-env\");\r\n        var waitTimeout = 10000;\r\n        var _windowId = wndId;\r\n        var hcEnv;\r\n        var instance;\r\n        // We have two cases here:\r\n        // 1. when we are in HC\r\n        // 2. when we are in Browser/Node, but we have also started  HC/GD\r\n        if (typeof cntName !== \"undefined\") {\r\n            instance = { application: \"HtmlContainer.\" + cntName };\r\n        }\r\n        else {\r\n            instance = \"best\";\r\n        }\r\n        var streamPromise = new Promise(function (streamResolve, streamReject) {\r\n            agm.subscribe(\"T42.Wnd.WindowStateChanged\", {\r\n                waitTimeoutMs: waitTimeout,\r\n                target: instance,\r\n            })\r\n                .then(function (stream) {\r\n                stream.onData(function (streamData) {\r\n                    instance = streamData.server;\r\n                    updateWindow(streamData.data.state, streamData.data);\r\n                });\r\n                stream.onFailed(function (err) {\r\n                    streamReject(err);\r\n                });\r\n                streamResolve();\r\n            })\r\n                .catch(function (err) {\r\n                streamReject(\"Can not subscribe for stream T42.Wnd.WindowStateChanged. Err: \" + err);\r\n            });\r\n        });\r\n        var listWindowsPromise = new Promise(function (listWndResolve, listWndReject) {\r\n            agm.invoke(\"T42.Wnd.ListWindows\", {}, instance, { waitTimeoutMs: waitTimeout })\r\n                .then(function (result) {\r\n                // add the server object\r\n                instance = result.executed_by;\r\n                // populate windows\r\n                Object.keys(result.returned).forEach(function (existingWindow) {\r\n                    var windowInfo = result.returned[existingWindow];\r\n                    var windowObjAndEvents = createWindow(windowInfo.windowId, windowInfo);\r\n                    // Added to store, showing to world\r\n                    store_1.default.markReadyToShow(windowObjAndEvents.API.id);\r\n                });\r\n                listWndResolve();\r\n            })\r\n                .catch(function (e) {\r\n                listWndReject(\"Can not invoke T42.Wnd.ListWindows method. Err: \" + e);\r\n            });\r\n        });\r\n        Promise.all([streamPromise, listWindowsPromise])\r\n            .then(function () {\r\n            // Init the executor, if we have container name - use it, if not get the first one from the collection\r\n            executor_1.default.init(agm, instance);\r\n            resolve(hcEnv);\r\n        })\r\n            .catch(function (e) {\r\n            reject(\"can not subscribe for stream T42.Wnd.WindowStateChanged or can not invoke T42.Wnd.ListWindows \");\r\n        });\r\n        function updateWindow(eventType, windowInfo) {\r\n            // if new window handle it separately\r\n            if (eventType === \"Created\") {\r\n                var win = createWindow(windowInfo.windowId, windowInfo);\r\n                _registry.execute(\"window-event\", windowInfo);\r\n                // if the window has focus, trigger got focus event\r\n                if (windowInfo.focus) {\r\n                    focusChanged(win.Events, win.API, true);\r\n                }\r\n                return;\r\n            }\r\n            // otherwise check if the window is in our internal collections and update its state\r\n            var windowObjectAndEvents = store_1.default.get(windowInfo.windowId);\r\n            if (!windowObjectAndEvents) {\r\n                _logger.error(\"received update for unknown window. Stream:', \" + JSON.stringify(windowInfo, null, 4));\r\n                return;\r\n            }\r\n            var theWindow = windowObjectAndEvents.API;\r\n            var theWindowEvents = windowObjectAndEvents.Events;\r\n            var oldFrameColor = theWindow.frameColor;\r\n            // const property: string = \"handle\" + eventType;\r\n            // // Try the generic handlers\r\n            // if (theWindowEvents.hasOwnProperty(property)) {\r\n            //     theWindowEvents[property](windowInfo);\r\n            // }\r\n            if (eventType === \"Ready\") {\r\n                store_1.default.setReadyState(windowObjectAndEvents.API.id);\r\n            }\r\n            if (eventType === \"TitleChanged\") {\r\n                theWindowEvents.handleTitleChanged(windowInfo.windowTitle);\r\n            }\r\n            if (eventType === \"UrlChanged\") {\r\n                store_1.default.setUrlChangedState(windowObjectAndEvents.API.id);\r\n                theWindowEvents.handleUrlChanged(windowInfo.url);\r\n            }\r\n            if (eventType === \"WindowStyleChanged\") {\r\n                var parsedWsa = parseWindowStyleAttributes(windowInfo.windowStyleAttributes);\r\n                theWindowEvents.handleWindowSettingsChanged(parsedWsa);\r\n                theWindowEvents.handleVisibilityChanged(!parsedWsa.hidden);\r\n            }\r\n            if (eventType === \"Normal\" ||\r\n                eventType === \"Maximized\" ||\r\n                eventType === \"Minimized\" ||\r\n                eventType === \"Collapsed\" ||\r\n                eventType === \"Expanded\") {\r\n                var state = eventType.toLowerCase();\r\n                theWindowEvents.handleWindowChangeState(state);\r\n            }\r\n            if (eventType === \"ContextUpdated\") {\r\n                theWindowEvents.handleContextUpdated(windowInfo.context);\r\n            }\r\n            if (eventType === \"FrameButtonAdded\") {\r\n                theWindowEvents.handleFrameButtonAdded(windowInfo);\r\n            }\r\n            if (eventType === \"FrameButtonRemoved\") {\r\n                theWindowEvents.handleFrameButtonRemoved(windowInfo.buttonId);\r\n            }\r\n            if (eventType === \"FrameButtonClicked\") {\r\n                theWindowEvents.handleFrameButtonClicked(windowInfo);\r\n            }\r\n            if (eventType === \"FrameSelectionChanged\") {\r\n                theWindowEvents.handleFrameSelectionChanged(windowInfo.newWindow, windowInfo.prevWindow);\r\n            }\r\n            if (eventType === \"FrameIsLockedChanged\") {\r\n                theWindowEvents.handleFrameIsLockedChanged(windowInfo.isLocked);\r\n            }\r\n            if (eventType === \"TabHeaderVisibilityChanged\") {\r\n                theWindowEvents.handleTabHeaderVisibilityChanged(windowInfo.tabHeaderVisible);\r\n            }\r\n            if (eventType === \"BoundsChanged\") {\r\n                var bounds = {\r\n                    height: windowInfo.height,\r\n                    left: windowInfo.left,\r\n                    top: windowInfo.top,\r\n                    width: windowInfo.width,\r\n                };\r\n                theWindowEvents.handleBoundsChanged(bounds);\r\n            }\r\n            if (eventType === \"FocusChanged\") {\r\n                focusChanged(theWindowEvents, theWindow, windowInfo.focus);\r\n            }\r\n            if (eventType === \"FrameColorChanged\") {\r\n                if (oldFrameColor !== windowInfo.frameColor) {\r\n                    theWindowEvents.handleFrameColorChanged(windowInfo.frameColor);\r\n                    _registry.execute(\"frame-color-changed\", theWindow);\r\n                }\r\n            }\r\n            if (eventType === \"FrameAttached\") {\r\n                theWindowEvents.handleFrameAttached(windowInfo.tabGroupId, windowInfo.tabHeaderVisible);\r\n            }\r\n            if (eventType === \"TabAttached\") {\r\n                theWindowEvents.handleAttached(windowInfo.tabGroupId, windowInfo.tabHeaderVisible);\r\n                var winsToBeNotified_1 = helpers_1.getWindowsByTabGroupId(theWindow.id, windowInfo.tabGroupId);\r\n                // Getting all windows, except current, with same tabGroupId\r\n                Object.keys(winsToBeNotified_1).forEach(function (id) {\r\n                    var win = winsToBeNotified_1[id];\r\n                    // Executing event windowAttached to all windows\r\n                    win.Events.handleWindowAttached(theWindow);\r\n                });\r\n                _registry.execute(\"tab-attached\", theWindow, windowInfo.tabGroupId, windowInfo.tabHeaderVisible);\r\n            }\r\n            if (eventType === \"TabDettached\") {\r\n                // In the event, tabGroupId is empty, will be update on the next event FrameAttached\r\n                var oldTabGroupId = theWindow.tabGroupId;\r\n                theWindowEvents.handleDetached(windowInfo.tabGroupId);\r\n                var winsToBeNotified_2 = helpers_1.getWindowsByTabGroupId(theWindow.id, oldTabGroupId);\r\n                Object.keys(winsToBeNotified_2).forEach(function (id) {\r\n                    var win = winsToBeNotified_2[id];\r\n                    win.Events.handleWindowDetached(theWindow);\r\n                });\r\n                _registry.execute(\"tab-detached\", theWindow, windowInfo.tabGroupId, theWindow.tabGroupId);\r\n            }\r\n            if (eventType === \"CompositionChanged\") {\r\n                theWindowEvents.handleCompositionChanged(windowInfo.neighbours, windowInfo.groupId);\r\n                _registry.execute(\"composition-changed\", windowInfo);\r\n            }\r\n            if (eventType === \"GroupHeaderVisibilityChanged\") {\r\n                theWindowEvents.handleGroupHeaderVisibilityChanged(windowInfo.groupHeaderVisible);\r\n                _registry.execute(\"group-header-changed\", windowInfo);\r\n            }\r\n            // Clear the window on close event\r\n            if (eventType === \"Closed\") {\r\n                if (windowInfo.focus) {\r\n                    // raise lost focus event\r\n                    focusChanged(theWindowEvents, theWindow, false);\r\n                }\r\n                store_1.default.remove(windowObjectAndEvents);\r\n                theWindowEvents.handleWindowClose();\r\n            }\r\n            // expose to external listeners\r\n            _registry.execute(\"window-event\", windowInfo);\r\n        }\r\n        function focusChanged(theWindowEvents, theWindow, focus) {\r\n            theWindowEvents.handleFocusChanged(focus);\r\n            if (focus) {\r\n                _registry.execute(\"got-focus\", theWindow);\r\n            }\r\n            else {\r\n                _registry.execute(\"lost-focus\", theWindow);\r\n            }\r\n        }\r\n        function createWindow(windowId, args) {\r\n            var windowObjAndEvents = window_1.default(windowId, mapToWindowConstructorOptions(args), executor_1.default, _logger, appManagerGetter);\r\n            store_1.default.add(windowObjAndEvents);\r\n            return windowObjAndEvents;\r\n        }\r\n        function open(name, url, options, success, error) {\r\n            options = options || {};\r\n            // relativeTo fix\r\n            if (typeof options.relativeTo !== \"undefined\" && typeof options.relativeTo !== \"string\") {\r\n                options.relativeTo = options.relativeTo.id || \"\";\r\n            }\r\n            options.windowName = name;\r\n            options.url = url;\r\n            agm.invoke(\"T42.Html.CreateWindow\", options)\r\n                .then(function (message) {\r\n                if (message.returned !== undefined) {\r\n                    var id = message.returned.id;\r\n                    success(id);\r\n                }\r\n                else {\r\n                    error(\"failed to execute T42.Html.CreateWindow - unknown reason\");\r\n                }\r\n            }).catch(function (e) {\r\n                if (typeof error === \"function\") {\r\n                    error(e);\r\n                }\r\n            });\r\n        }\r\n        function tabAttached(callback) {\r\n            return _registry.add(\"tab-attached\", callback);\r\n        }\r\n        function tabDetached(callback) {\r\n            return _registry.add(\"tab-detached\", callback);\r\n        }\r\n        function onWindowFrameColorChanged(callback) {\r\n            return _registry.add(\"frame-color-changed\", callback);\r\n        }\r\n        function onWindowGotFocus(callback) {\r\n            return _registry.add(\"got-focus\", callback);\r\n        }\r\n        function onWindowLostFocus(callback) {\r\n            return _registry.add(\"lost-focus\", callback);\r\n        }\r\n        function onEvent(callback) {\r\n            return _registry.add(\"window-event\", callback);\r\n        }\r\n        function my() {\r\n            return _windowId;\r\n        }\r\n        function onCompositionChanged(callback) {\r\n            return _registry.add(\"composition-changed\", callback);\r\n        }\r\n        function onGroupHeaderVisibilityChanged(callback) {\r\n            return _registry.add(\"group-header-changed\", callback);\r\n        }\r\n        function mapToWindowConstructorOptions(args) {\r\n            var _state = typeof args.WindowState !== \"undefined\" ? args.WindowState.toLowerCase() : \"normal\";\r\n            var windowStyleAttributes = parseWindowStyleAttributes(args.windowStyleAttributes);\r\n            return {\r\n                name: args.windowName,\r\n                url: args.url,\r\n                title: args.windowTitle,\r\n                context: args.context,\r\n                bounds: {\r\n                    height: args.height,\r\n                    left: args.left,\r\n                    top: args.top,\r\n                    width: args.width,\r\n                },\r\n                focus: args.focus,\r\n                frameColor: args.frameColor,\r\n                groupId: args.groupId,\r\n                isCollapsed: args.isCollapsed,\r\n                isGroupHeaderVisible: args.isGroupHeaderVisible,\r\n                isLocked: args.isLocked,\r\n                isTabHeaderVisible: args.isTabHeaderVisible,\r\n                isTabSelected: args.isTabSelected,\r\n                isVisible: !windowStyleAttributes.hidden,\r\n                isFocused: windowStyleAttributes.focus,\r\n                mode: windowStyleAttributes.mode,\r\n                settings: windowStyleAttributes,\r\n                state: _state,\r\n                tabGroupId: args.tabGroupId,\r\n                neighbours: args.neighbours,\r\n            };\r\n        }\r\n        function parseWindowStyleAttributes(windowStyles) {\r\n            if (windowStyles === undefined) {\r\n                return {};\r\n            }\r\n            if (typeof windowStyles !== \"object\") {\r\n                return JSON.parse(windowStyles);\r\n            }\r\n            return windowStyles;\r\n        }\r\n        hcEnv = {\r\n            my: my,\r\n            onEvent: onEvent,\r\n            open: open,\r\n            tabAttached: tabAttached,\r\n            tabDetached: tabDetached,\r\n            onWindowFrameColorChanged: onWindowFrameColorChanged,\r\n            executor: executor_1.default,\r\n            onCompositionChanged: onCompositionChanged,\r\n            onGroupHeaderVisibilityChanged: onGroupHeaderVisibilityChanged,\r\n            onWindowGotFocus: onWindowGotFocus,\r\n            onWindowLostFocus: onWindowLostFocus,\r\n        };\r\n    });\r\n});\r\n//# sourceMappingURL=hc.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/environment/hc/hc.js\n// module id = 75\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = require(\"callback-registry\");\r\nvar store_1 = require(\"./store\");\r\nexports.default = (function (id, executor) {\r\n    var _registry = CallbackFactory();\r\n    var _windowsId = [];\r\n    var isGroupHeaderVisibleCalled;\r\n    //#region \"API functions\"\r\n    function addWindow(winId) {\r\n        if (_windowsId.indexOf(winId) === -1) {\r\n            _windowsId.push(winId);\r\n            var window_1 = store_1.default.get(winId);\r\n            window_1.Events.handleGroupAssociation(groupObject);\r\n            _registry.execute(\"window-added\", groupObject, window_1.API);\r\n        }\r\n    }\r\n    function removeWindow(winId) {\r\n        var index = _windowsId.indexOf(winId);\r\n        if (index !== -1) {\r\n            _windowsId.splice(index, 1);\r\n            var window_2 = _mapToWindowObject(winId);\r\n            _registry.execute(\"window-removed\", groupObject, window_2);\r\n        }\r\n    }\r\n    function find(window, success) {\r\n        var winId;\r\n        if (typeof window === \"string\") {\r\n            winId = window;\r\n        }\r\n        else {\r\n            winId = window.id;\r\n        }\r\n        var index = _windowsId.indexOf(winId);\r\n        if (index !== -1) {\r\n            var mappedWindow = _mapToWindowObject(_windowsId[index]);\r\n            if (typeof success === \"function\") {\r\n                success(mappedWindow);\r\n            }\r\n            return mappedWindow;\r\n        }\r\n    }\r\n    function windows(success) {\r\n        var mappedWindows = _mapToWindowObjects();\r\n        if (typeof success === \"function\") {\r\n            success(mappedWindows);\r\n        }\r\n        return mappedWindows;\r\n    }\r\n    function showHeader(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setGroupHeaderVisible(_windowsId[0], true)\r\n                .then(function (w) {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    function hideHeader(success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.setGroupHeaderVisible(_windowsId[0], false)\r\n                .then(function (w) {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                return;\r\n            });\r\n        });\r\n    }\r\n    function execute(command, options, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            executor.execute(command, options)\r\n                .then(function (w) {\r\n                if (typeof success === \"function\") {\r\n                    success(groupObject);\r\n                }\r\n                resolve(groupObject);\r\n            })\r\n                .catch(function (e) {\r\n                reject(e);\r\n            });\r\n        });\r\n    }\r\n    //#endregion \"API functions\"\r\n    //#region \"Stream function\"\r\n    function handleGroupHeaderVisibilityChanged(windowInfo) {\r\n        if (isGroupHeaderVisibleCalled !== windowInfo.groupHeaderVisible) {\r\n            isGroupHeaderVisibleCalled = windowInfo.groupHeaderVisible;\r\n            _registry.execute(\"header-visibility-changed\", groupObject);\r\n        }\r\n    }\r\n    //#endregion \"Stream function\"\r\n    //#region \"Internal function\"\r\n    function _mapToWindowObjects() {\r\n        var winObjects = [];\r\n        _windowsId.forEach(function (winId) {\r\n            var windowObject = _mapToWindowObject(winId);\r\n            if (typeof windowObject !== \"undefined\") {\r\n                winObjects.push(windowObject);\r\n            }\r\n        });\r\n        return winObjects;\r\n    }\r\n    function _mapToWindowObject(windowId) {\r\n        return store_1.default.get(windowId) ? store_1.default.get(windowId).API : undefined;\r\n    }\r\n    function _getGroupHeaderVisibility() {\r\n        // if one of the windows has a flag hideGroupHeader the group header should be off.\r\n        var _isGroupHeaderVisible;\r\n        var result = _mapToWindowObjects().filter(function (w) {\r\n            return !w.isGroupHeaderVisible;\r\n        });\r\n        _isGroupHeaderVisible = result.length === 0;\r\n        return _isGroupHeaderVisible;\r\n    }\r\n    //#endregion \"Internal function\"\r\n    //#region \"Events\"\r\n    function onHeaderVisibilityChanged(callback) {\r\n        return _registry.add(\"header-visibility-changed\", callback);\r\n    }\r\n    function onWindowAdded(callback) {\r\n        return _registry.add(\"window-added\", callback);\r\n    }\r\n    function onWindowRemoved(callback) {\r\n        return _registry.add(\"window-removed\", callback);\r\n    }\r\n    //#endregion \"Events\"\r\n    //#region \"API\"\r\n    var groupObject = {\r\n        id: id,\r\n        get windows() {\r\n            return windows();\r\n        },\r\n        find: find,\r\n        get isHeaderVisible() {\r\n            return _getGroupHeaderVisibility();\r\n        },\r\n        showHeader: showHeader,\r\n        hideHeader: hideHeader,\r\n        maximize: function (success, error) {\r\n            return execute(\"maximize\", { groupId: id }, success, error);\r\n        },\r\n        restore: function (success, error) {\r\n            return execute(\"restore\", { groupId: id }, success, error);\r\n        },\r\n        onHeaderVisibilityChanged: onHeaderVisibilityChanged,\r\n        onWindowAdded: onWindowAdded,\r\n        onWindowRemoved: onWindowRemoved,\r\n    };\r\n    var internal = {\r\n        addWindow: addWindow,\r\n        removeWindow: removeWindow,\r\n        handleGroupHeaderVisibilityChanged: handleGroupHeaderVisibilityChanged,\r\n    };\r\n    return {\r\n        groupAPI: groupObject,\r\n        groupInternal: internal,\r\n    };\r\n    //#endregion \"API\"\r\n});\r\n//# sourceMappingURL=group.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/group.js\n// module id = 76\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = require(\"callback-registry\");\r\nvar group_1 = require(\"./group\");\r\nvar store_1 = require(\"./store\");\r\nexports.default = (function (environment, logger) {\r\n    var _logger = logger.subLogger(\"groups\");\r\n    var _registry = CallbackFactory();\r\n    var _groups = {};\r\n    // Getting already existing windows and create Group API for each window\r\n    var windows = store_1.default.list;\r\n    Object.keys(windows).forEach(function (k) {\r\n        addNewWindow(windows[k]);\r\n    });\r\n    environment.onCompositionChanged(function (windowInfo) {\r\n        handleCompositionChanged(windowInfo);\r\n    });\r\n    environment.onGroupHeaderVisibilityChanged(function (windowInfo) {\r\n        var windowId = windowInfo.windowId;\r\n        var group = findGroupByWindow(windowId);\r\n        if (typeof group !== \"undefined\") {\r\n            var groupEvents = _groups[group.id];\r\n            groupEvents.groupInternal.handleGroupHeaderVisibilityChanged(windowInfo);\r\n        }\r\n    });\r\n    store_1.default.onAdded(function (win) {\r\n        addNewWindow(win);\r\n    });\r\n    store_1.default.onRemoved(function (win) {\r\n        removeWindow(win);\r\n    });\r\n    // Methods\r\n    function my() {\r\n        return findGroupByWindow(environment.my());\r\n    }\r\n    function list(success) {\r\n        var result = Object.keys(_groups).map(function (groupId) {\r\n            if (_groups[groupId]) {\r\n                return _groups[groupId].groupAPI;\r\n            }\r\n        });\r\n        if (typeof success === \"function\") {\r\n            success(result);\r\n        }\r\n        return result;\r\n    }\r\n    function findGroupByWindow(winId, success) {\r\n        var windowId;\r\n        if (typeof winId === \"undefined\") {\r\n            logger.debug(\"trying to find a group by a window, but winId is undefined\");\r\n            return;\r\n        }\r\n        if (typeof winId === \"string\") {\r\n            windowId = winId;\r\n        }\r\n        else {\r\n            windowId = winId.id;\r\n        }\r\n        var groupFound;\r\n        Object.keys(_groups).forEach(function (groupId) {\r\n            var group = _groups[groupId].groupAPI;\r\n            if (group.find(windowId) !== undefined) {\r\n                groupFound = group;\r\n                return;\r\n            }\r\n        });\r\n        if (typeof success === \"function\") {\r\n            success(groupFound);\r\n        }\r\n        return groupFound;\r\n    }\r\n    // Events\r\n    function onWindowMoved(callback) {\r\n        return _registry.add(\"window-moved\", callback);\r\n    }\r\n    // Private\r\n    function createOrGetGroup(groupId) {\r\n        if (!_groups.hasOwnProperty(groupId)) {\r\n            var createdGroup = group_1.default(groupId, environment.executor);\r\n            _groups[groupId] = createdGroup;\r\n            return createdGroup;\r\n        }\r\n        else {\r\n            return _groups[groupId];\r\n        }\r\n    }\r\n    function deleteGroup(groupId) {\r\n        if (_groups.hasOwnProperty(groupId) && typeof _groups[groupId] !== \"undefined\") {\r\n            if (_groups[groupId].groupAPI.windows.length === 0) {\r\n                delete _groups[groupId];\r\n            }\r\n        }\r\n    }\r\n    function addNewWindow(win) {\r\n        _logger.trace(\"Adding new window \" + win.API.id + \" to win.API.groupId \" + win.API.groupId);\r\n        var group = addWindow(win);\r\n        if (group) {\r\n            _logger.trace(\"handleGroupAssociation \" + win.API.id + \" to group.groupAPI.id \" + group.groupAPI.id);\r\n            win.Events.handleGroupAssociation(group.groupAPI);\r\n        }\r\n    }\r\n    function addWindow(win, groupId) {\r\n        var windowGroupId = groupId || win.API.groupId;\r\n        var windowId = win.API.id;\r\n        if (typeof windowGroupId === \"undefined\" || typeof windowId === \"undefined\") {\r\n            _logger.debug(\"trying to add a window without group - winId: \" + windowId);\r\n            return;\r\n        }\r\n        var group = createOrGetGroup(windowGroupId);\r\n        group.groupInternal.addWindow(windowId);\r\n        return group;\r\n    }\r\n    function removeWindow(win, groupId) {\r\n        var windowId = win.API.id;\r\n        var windowGroupId = groupId || win.API.groupId;\r\n        if (typeof windowGroupId !== \"undefined\") {\r\n            var group = _groups[windowGroupId];\r\n            group.groupInternal.removeWindow(windowId);\r\n            win.Events.handleGroupAssociation(undefined);\r\n            deleteGroup(windowGroupId);\r\n        }\r\n    }\r\n    function handleCompositionChanged(windowInfo) {\r\n        var newGroupId = windowInfo.groupId;\r\n        var windowId = windowInfo.windowId;\r\n        var oldGroup = findGroupByWindow(windowId);\r\n        var oldGroupId = oldGroup ? oldGroup.id : undefined;\r\n        _logger.trace(\"handleCompositionChanged newGroupId: \" + newGroupId + \" windowId: \" + windowId + \" oldGroup: \" + oldGroupId);\r\n        if (oldGroupId === newGroupId) {\r\n            _logger.trace(\"handleCompositionChanged newGroupId: \" + newGroupId + \" windowId: \" + windowId + \" oldGroup: \" + oldGroupId + \" are the same - returning...\");\r\n            return;\r\n        }\r\n        var win = store_1.default.get(windowId) || store_1.default.get(windowId);\r\n        var newGroup = addWindow(win, newGroupId);\r\n        if (oldGroup) {\r\n            removeWindow(win, oldGroupId);\r\n            _registry.execute(\"window-moved\", windowId, oldGroup, newGroupId);\r\n        }\r\n        win.Events.handleGroupChanged(newGroup.groupAPI, oldGroup);\r\n    }\r\n    //#region \"API\"\r\n    var groups = {\r\n        get my() {\r\n            return my();\r\n        },\r\n        list: list,\r\n        findGroupByWindow: findGroupByWindow,\r\n    };\r\n    //#endregion \"API\r\n    var events = { onWindowMoved: onWindowMoved };\r\n    return {\r\n        groupsAPI: groups,\r\n        groupsEvents: events,\r\n    };\r\n});\r\n//# sourceMappingURL=groups.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/groups.js\n// module id = 77\n// module chunks = 0","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CallbackFactory = require(\"callback-registry\");\r\nvar detector_1 = require(\"./environment/detector\");\r\nvar groups_1 = require(\"./groups\");\r\nvar store_1 = require(\"./store\");\r\nexports.default = (function (agm, logger, appManagerGetter, gdMajorVersion) {\r\n    var _registry = CallbackFactory();\r\n    var _logger = logger;\r\n    var groups;\r\n    var environment;\r\n    store_1.default.init(_logger);\r\n    var isReady = new Promise(function (resolve, reject) {\r\n        detector_1.default(agm, _logger, appManagerGetter, gdMajorVersion)\r\n            .then(function (env) {\r\n            environment = env;\r\n            groups = groups_1.default(env, _logger);\r\n            resolve();\r\n        })\r\n            .catch(function (e) {\r\n            var err = \"Environment detector fails with: \" + e;\r\n            _logger.error(err);\r\n            reject(err);\r\n        });\r\n    });\r\n    function ready() {\r\n        return isReady;\r\n    }\r\n    function my() {\r\n        var myWindow = store_1.default.getIfReady(environment.my());\r\n        return myWindow ? myWindow.API : undefined;\r\n    }\r\n    function open(name, url, options, success, error) {\r\n        return new Promise(function (resolve, reject) {\r\n            var errorHandler = function (errorResponse) {\r\n                if (typeof error === \"function\") {\r\n                    error(errorResponse);\r\n                }\r\n                reject(errorResponse);\r\n            };\r\n            var successHandler = function (id) {\r\n                store_1.default.waitFor(id)\r\n                    .then(function (win) {\r\n                    if (typeof success === \"function\") {\r\n                        success(win);\r\n                    }\r\n                    resolve(win);\r\n                })\r\n                    .catch(errorHandler);\r\n            };\r\n            environment.open(name, url, options, successHandler, errorHandler);\r\n        });\r\n    }\r\n    function find(name, success, error) {\r\n        var windows = store_1.default.list;\r\n        var windowsForListing = Object.keys(windows).reduce(function (memo, winId) {\r\n            var window = windows[winId];\r\n            if (window && window.API.name === name) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing[0];\r\n        }\r\n        if (windowsForListing.length > 0) {\r\n            success(windowsForListing[0]);\r\n        }\r\n        else {\r\n            if (typeof error === \"function\") {\r\n                error(\"There is no window with name:\" + name);\r\n            }\r\n        }\r\n    }\r\n    function findById(id, success, error) {\r\n        var windows = store_1.default.list;\r\n        var windowsForListing = Object.keys(windows).reduce(function (memo, winId) {\r\n            var window = windows[winId];\r\n            if (typeof window !== \"undefined\" && window.API.id === id) {\r\n                memo.push(window.API);\r\n            }\r\n            return memo;\r\n        }, []);\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing[0];\r\n        }\r\n        if (windowsForListing.length > 0) {\r\n            success(windowsForListing[0]);\r\n        }\r\n        else {\r\n            if (typeof error === \"function\") {\r\n                error(\"There is no window with such id:\" + id);\r\n            }\r\n        }\r\n    }\r\n    function list(success) {\r\n        var windows = store_1.default.list;\r\n        var windowsForListing = Object.keys(windows)\r\n            .map(function (k) {\r\n            return windows[k].API;\r\n        });\r\n        if (typeof success !== \"function\") {\r\n            return windowsForListing;\r\n        }\r\n        success(windowsForListing);\r\n    }\r\n    function windowAdded(callback) {\r\n        return _registry.add(\"window-added\", callback);\r\n    }\r\n    function windowRemoved(callback) {\r\n        return _registry.add(\"window-removed\", callback);\r\n    }\r\n    function tabAttached(callback) {\r\n        return isReady.then(function () {\r\n            environment.tabAttached(callback);\r\n        });\r\n    }\r\n    function tabDetached(callback) {\r\n        return isReady.then(function () {\r\n            environment.tabDetached(callback);\r\n        });\r\n    }\r\n    function onWindowFrameColorChanged(callback) {\r\n        return isReady.then(function () {\r\n            return environment.onWindowFrameColorChanged(callback);\r\n        });\r\n    }\r\n    function onWindowGotFocus(callback) {\r\n        var unsubscribe;\r\n        isReady.then(function () {\r\n            unsubscribe = environment.onWindowGotFocus(callback);\r\n        });\r\n        return function () {\r\n            if (unsubscribe) {\r\n                unsubscribe();\r\n            }\r\n        };\r\n    }\r\n    function onWindowLostFocus(callback) {\r\n        var unsubscribe;\r\n        isReady.then(function () {\r\n            unsubscribe = environment.onWindowLostFocus(callback);\r\n        });\r\n        return function () {\r\n            if (unsubscribe) {\r\n                unsubscribe();\r\n            }\r\n        };\r\n    }\r\n    function onEvent(callback) {\r\n        var unsubFunc;\r\n        var unsubscribed = false;\r\n        isReady.then(function () {\r\n            if (unsubscribed) {\r\n                return;\r\n            }\r\n            unsubFunc = environment.onEvent(callback);\r\n        });\r\n        return function () {\r\n            unsubscribed = true;\r\n            if (unsubFunc) {\r\n                unsubFunc();\r\n            }\r\n        };\r\n    }\r\n    function handleWindowAdded(w) {\r\n        _registry.execute(\"window-added\", w.API);\r\n    }\r\n    function handleWindowRemoved(w) {\r\n        _registry.execute(\"window-removed\", w.API);\r\n    }\r\n    store_1.default.onReadyWindow(handleWindowAdded);\r\n    store_1.default.onRemoved(handleWindowRemoved);\r\n    // The API itself\r\n    return {\r\n        my: my,\r\n        open: open,\r\n        find: find,\r\n        findById: findById,\r\n        list: list,\r\n        ready: ready,\r\n        onWindowAdded: windowAdded,\r\n        windowAdded: windowAdded,\r\n        onWindowRemoved: windowRemoved,\r\n        windowRemoved: windowRemoved,\r\n        onTabAttached: tabAttached,\r\n        onTabDetached: tabDetached,\r\n        onWindowFrameColorChanged: onWindowFrameColorChanged,\r\n        get groups() {\r\n            return groups.groupsAPI;\r\n        },\r\n        onWindowGotFocus: onWindowGotFocus,\r\n        onWindowLostFocus: onWindowLostFocus,\r\n        onEvent: onEvent,\r\n    };\r\n});\r\n//# sourceMappingURL=main.js.map\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src_js/windows/main.js\n// module id = 78\n// module chunks = 0"],"sourceRoot":""}